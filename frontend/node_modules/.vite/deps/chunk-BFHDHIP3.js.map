{
  "version": 3,
  "sources": ["../../../../ltm-react/node_modules/blockly/core/registry.ts", "../../../../ltm-react/node_modules/blockly/core/utils/deprecation.ts", "../../../../ltm-react/node_modules/blockly/core/utils/idgenerator.ts", "../../../../ltm-react/node_modules/blockly/core/events/predicates.ts", "../../../../ltm-react/node_modules/blockly/core/events/utils.ts", "../../../../ltm-react/node_modules/blockly/core/common.ts", "../../../../ltm-react/node_modules/blockly/core/touch.ts", "../../../../ltm-react/node_modules/blockly/core/browser_events.ts", "../../../../ltm-react/node_modules/blockly/core/utils/array.ts", "../../../../ltm-react/node_modules/blockly/core/css.ts", "../../../../ltm-react/node_modules/blockly/core/utils/dom.ts", "../../../../ltm-react/node_modules/blockly/core/utils/style.ts", "../../../../ltm-react/node_modules/blockly/core/utils/svg_math.ts", "../../../../ltm-react/node_modules/blockly/core/utils/xml.ts", "../../../../ltm-react/node_modules/blockly/core/utils/toolbox.ts", "../../../../ltm-react/node_modules/blockly/core/positionable_helpers.ts", "../../../../ltm-react/node_modules/blockly/core/serialization/registry.ts", "../../../../ltm-react/node_modules/blockly/core/serialization/workspace_comments.ts", "../../../../ltm-react/node_modules/blockly/core/clipboard/registry.ts", "../../../../ltm-react/node_modules/blockly/core/clipboard/workspace_comment_paster.ts", "../../../../ltm-react/node_modules/blockly/core/utils/aria.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_serializable.ts", "../../../../ltm-react/node_modules/blockly/core/render_management.ts", "../../../../ltm-react/node_modules/blockly/core/dialog.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_legacy_procedure_blocks.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_variable_backed_parameter_model.ts", "../../../../ltm-react/node_modules/blockly/core/variables.ts", "../../../../ltm-react/node_modules/blockly/core/serialization/blocks.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_has_bubble.ts", "../../../../ltm-react/node_modules/blockly/core/utils/math.ts", "../../../../ltm-react/node_modules/blockly/core/dropdowndiv.ts", "../../../../ltm-react/node_modules/blockly/core/utils/string.ts", "../../../../ltm-react/node_modules/blockly/core/tooltip.ts", "../../../../ltm-react/node_modules/blockly/core/utils/colour.ts", "../../../../ltm-react/node_modules/blockly/core/utils/parsing.ts", "../../../../ltm-react/node_modules/blockly/core/widgetdiv.ts", "../../../../ltm-react/node_modules/blockly/core/contextmenu.ts", "../../../../ltm-react/node_modules/blockly/core/utils/drag.ts", "../../../../ltm-react/node_modules/blockly/core/xml.ts", "../../../../ltm-react/node_modules/blockly/core/block_animations.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_draggable.ts", "../../../../ltm-react/node_modules/blockly/core/utils/object.ts", "../../../../ltm-react/node_modules/blockly/core/field_registry.ts", "../../../../ltm-react/node_modules/blockly/core/extensions.ts", "../../../../ltm-react/node_modules/blockly/core/utils/svg_paths.ts", "../../../../ltm-react/node_modules/blockly/core/icons/registry.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_procedure_block.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_observable.ts", "../../../../ltm-react/node_modules/blockly/core/procedures.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/common/constants.ts", "../../../../ltm-react/node_modules/blockly/core/connection.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_icon.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_comment_icon.ts", "../../../../ltm-react/node_modules/blockly/core/keyboard_nav/ast_node.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/common/block_rendering.ts", "../../../../ltm-react/node_modules/blockly/core/variables_dynamic.ts", "../../../../ltm-react/node_modules/blockly/core/workspace_svg.ts", "../../../../ltm-react/node_modules/blockly/core/clipboard/block_paster.ts", "../../../../ltm-react/node_modules/blockly/core/bump_objects.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_deletable.ts", "../../../../ltm-react/node_modules/blockly/core/clipboard.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_copyable.ts", "../../../../ltm-react/node_modules/blockly/core/shortcut_items.ts", "../../../../ltm-react/node_modules/blockly/core/serialization/procedures.ts", "../../../../ltm-react/node_modules/blockly/core/serialization/workspaces.ts", "../../../../ltm-react/node_modules/blockly/core/inject.ts", "../../../../ltm-react/node_modules/blockly/core/contextmenu_items.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_paster.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_rendered_element.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_selectable.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_selectable_toolbox_item.ts", "../../../../ltm-react/node_modules/blockly/core/blockly.ts", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/base.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/util/defines.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/util/defineproperty.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/util/global.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/util/shouldpolyfill.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/util/polyfill.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/util/setprototypeof.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/util/arrayiterator.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/util/makeiterator.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/generator_engine.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/execute_async_generator.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/globalthis.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/array/includes.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/symbol.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/util/iteratorfromarray.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/array/values.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/array/flat.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/array/flatmap.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/util/owns.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/object/entries.js", "../../../../ltm-react/node_modules/blockly/src/com/google/javascript/jscomp/js/es6/object/values.js", "../../../../ltm-react/node_modules/blockly/core/blocks.ts", "../../../../ltm-react/node_modules/blockly/core/events/type.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_abstract.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_ui_base.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_click.ts", "../../../../ltm-react/node_modules/blockly/core/utils/useragent.ts", "../../../../ltm-react/node_modules/blockly/core/component_manager.ts", "../../../../ltm-react/node_modules/blockly/core/utils/coordinate.ts", "../../../../ltm-react/node_modules/blockly/core/utils/svg.ts", "../../../../ltm-react/node_modules/blockly/core/utils/rect.ts", "../../../../ltm-react/node_modules/blockly/core/utils/size.ts", "../../../../ltm-react/node_modules/blockly/core/scrollbar.ts", "../../../../ltm-react/node_modules/blockly/core/sprites.ts", "../../../../ltm-react/node_modules/blockly/core/zoom_controls.ts", "../../../../ltm-react/node_modules/blockly/core/serialization/priorities.ts", "../../../../ltm-react/node_modules/blockly/core/config.ts", "../../../../ltm-react/node_modules/blockly/core/menu.ts", "../../../../ltm-react/node_modules/blockly/core/menuitem.ts", "../../../../ltm-react/node_modules/blockly/core/constants.ts", "../../../../ltm-react/node_modules/blockly/core/inputs/input_types.ts", "../../../../ltm-react/node_modules/blockly/core/msg.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_var_base.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_var_create.ts", "../../../../ltm-react/node_modules/blockly/core/variable_model.ts", "../../../../ltm-react/node_modules/blockly/core/serialization/exceptions.ts", "../../../../ltm-react/node_modules/blockly/core/icons/icon_types.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_block_base.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_block_change.ts", "../../../../ltm-react/node_modules/blockly/core/marker_manager.ts", "../../../../ltm-react/node_modules/blockly/core/field.ts", "../../../../ltm-react/node_modules/blockly/core/contextmenu_registry.ts", "../../../../ltm-react/node_modules/blockly/core/layers.ts", "../../../../ltm-react/node_modules/blockly/core/dragging/comment_drag_strategy.ts", "../../../../ltm-react/node_modules/blockly/core/comments/comment_view.ts", "../../../../ltm-react/node_modules/blockly/core/comments/workspace_comment.ts", "../../../../ltm-react/node_modules/blockly/core/comments/rendered_workspace_comment.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_block_create.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_theme_change.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_viewport.ts", "../../../../ltm-react/node_modules/blockly/core/connection_type.ts", "../../../../ltm-react/node_modules/blockly/core/connection_db.ts", "../../../../ltm-react/node_modules/blockly/core/workspace_dragger.ts", "../../../../ltm-react/node_modules/blockly/core/gesture.ts", "../../../../ltm-react/node_modules/blockly/core/grid.ts", "../../../../ltm-react/node_modules/blockly/core/layer_manager.ts", "../../../../ltm-react/node_modules/blockly/core/theme.ts", "../../../../ltm-react/node_modules/blockly/core/theme/classic.ts", "../../../../ltm-react/node_modules/blockly/core/options.ts", "../../../../ltm-react/node_modules/blockly/core/field_dropdown.ts", "../../../../ltm-react/node_modules/blockly/core/dragging/bubble_drag_strategy.ts", "../../../../ltm-react/node_modules/blockly/core/bubbles/bubble.ts", "../../../../ltm-react/node_modules/blockly/core/bubbles/mini_workspace_bubble.ts", "../../../../ltm-react/node_modules/blockly/core/icons/icon.ts", "../../../../ltm-react/node_modules/blockly/core/icons/mutator_icon.ts", "../../../../ltm-react/node_modules/blockly/core/utils/keycodes.ts", "../../../../ltm-react/node_modules/blockly/core/utils.ts", "../../../../ltm-react/node_modules/blockly/core/bubbles/textinput_bubble.ts", "../../../../ltm-react/node_modules/blockly/core/icons/comment_icon.ts", "../../../../ltm-react/node_modules/blockly/core/icons/exceptions.ts", "../../../../ltm-react/node_modules/blockly/core/bubbles/text_bubble.ts", "../../../../ltm-react/node_modules/blockly/core/icons/warning_icon.ts", "../../../../ltm-react/node_modules/blockly/core/icons.ts", "../../../../ltm-react/node_modules/blockly/core/names.ts", "../../../../ltm-react/node_modules/blockly/core/observable_procedure_map.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/types.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/base.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/row.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/bottom_row.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/connection.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/input_connection.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/external_value_input.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/field.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/hat.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/icon.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/in_row_spacer.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/inline_input.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/statement_input.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/input_row.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/jagged_edge.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/next_connection.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/output_connection.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/previous_connection.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/round_corner.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/spacer_row.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/square_corner.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/measurables/top_row.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/common/drawer.ts", "../../../../ltm-react/node_modules/blockly/core/inputs/align.ts", "../../../../ltm-react/node_modules/blockly/core/field_label.ts", "../../../../ltm-react/node_modules/blockly/core/inputs/input.ts", "../../../../ltm-react/node_modules/blockly/core/inputs/dummy_input.ts", "../../../../ltm-react/node_modules/blockly/core/inputs/end_row_input.ts", "../../../../ltm-react/node_modules/blockly/core/inputs/statement_input.ts", "../../../../ltm-react/node_modules/blockly/core/inputs/value_input.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/common/info.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_block_delete.ts", "../../../../ltm-react/node_modules/blockly/core/block.ts", "../../../../ltm-react/node_modules/blockly/core/flyout_button.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_marker_move.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/common/marker_svg.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/common/path_object.ts", "../../../../ltm-react/node_modules/blockly/core/insertion_marker_manager.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/common/renderer.ts", "../../../../ltm-react/node_modules/blockly/core/theme_manager.ts", "../../../../ltm-react/node_modules/blockly/core/internal_constants.ts", "../../../../ltm-react/node_modules/blockly/core/connection_checker.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_var_delete.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_var_rename.ts", "../../../../ltm-react/node_modules/blockly/core/variable_map.ts", "../../../../ltm-react/node_modules/blockly/core/workspace.ts", "../../../../ltm-react/node_modules/blockly/core/workspace_audio.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_selected.ts", "../../../../ltm-react/node_modules/blockly/core/dragging/block_drag_strategy.ts", "../../../../ltm-react/node_modules/blockly/core/keyboard_nav/marker.ts", "../../../../ltm-react/node_modules/blockly/core/keyboard_nav/cursor.ts", "../../../../ltm-react/node_modules/blockly/core/keyboard_nav/basic_cursor.ts", "../../../../ltm-react/node_modules/blockly/core/keyboard_nav/tab_navigate_cursor.ts", "../../../../ltm-react/node_modules/blockly/core/rendered_connection.ts", "../../../../ltm-react/node_modules/blockly/core/block_svg.ts", "../../../../ltm-react/node_modules/blockly/core/drag_target.ts", "../../../../ltm-react/node_modules/blockly/core/delete_area.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_trashcan_open.ts", "../../../../ltm-react/node_modules/blockly/core/trashcan.ts", "../../../../ltm-react/node_modules/blockly/core/shortcut_registry.ts", "../../../../ltm-react/node_modules/blockly/core/serialization/variables.ts", "../../../../ltm-react/node_modules/blockly/core/serialization.ts", "../../../../ltm-react/node_modules/blockly/core/scrollbar_pair.ts", "../../../../ltm-react/node_modules/blockly/core/metrics_manager.ts", "../../../../ltm-react/node_modules/blockly/core/main.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/zelos/constants.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/zelos/drawer.ts", "../../../../ltm-react/node_modules/blockly/core/field_image.ts", "../../../../ltm-react/node_modules/blockly/core/field_input.ts", "../../../../ltm-react/node_modules/blockly/core/field_textinput.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/zelos/measurables/bottom_row.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/zelos/measurables/inputs.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/zelos/measurables/row_elements.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/zelos/measurables/top_row.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/zelos/info.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/zelos/marker_svg.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/zelos/path_object.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/zelos/renderer.ts", "../../../../ltm-react/node_modules/blockly/core/insertion_marker_previewer.ts", "../../../../ltm-react/node_modules/blockly/core/inputs.ts", "../../../../ltm-react/node_modules/blockly/core/generator.ts", "../../../../ltm-react/node_modules/blockly/core/flyout_metrics_manager.ts", "../../../../ltm-react/node_modules/blockly/core/flyout_base.ts", "../../../../ltm-react/node_modules/blockly/core/flyout_vertical.ts", "../../../../ltm-react/node_modules/blockly/core/flyout_horizontal.ts", "../../../../ltm-react/node_modules/blockly/core/field_variable.ts", "../../../../ltm-react/node_modules/blockly/core/field_number.ts", "../../../../ltm-react/node_modules/blockly/core/field_label_serializable.ts", "../../../../ltm-react/node_modules/blockly/core/field_checkbox.ts", "../../../../ltm-react/node_modules/blockly/core/dragging/dragger.ts", "../../../../ltm-react/node_modules/blockly/core/dragging.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_block_drag.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_block_field_intermediate_change.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_block_move.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_bubble_open.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_comment_base.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_comment_change.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_comment_collapse.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_comment_create.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_comment_delete.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_comment_drag.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_comment_move.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_comment_resize.ts", "../../../../ltm-react/node_modules/blockly/core/events/events_toolbox_item_select.ts", "../../../../ltm-react/node_modules/blockly/core/events/workspace_events.ts", "../../../../ltm-react/node_modules/blockly/core/events/events.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/zelos/zelos.ts", "../../../../ltm-react/node_modules/blockly/core/comments.ts", "../../../../ltm-react/node_modules/blockly/core/bubbles.ts", "../../../../ltm-react/node_modules/blockly/core/blockly_options.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/geras/constants.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/geras/highlighter.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/geras/drawer.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/geras/highlight_constants.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/geras/measurables/inline_input.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/geras/measurables/statement_input.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/geras/info.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/geras/path_object.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/geras/renderer.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/geras/geras.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/thrasos/info.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/thrasos/renderer.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/thrasos/thrasos.ts", "../../../../ltm-react/node_modules/blockly/core/theme/zelos.ts", "../../../../ltm-react/node_modules/blockly/core/theme/themes.ts", "../../../../ltm-react/node_modules/blockly/core/toolbox/toolbox_item.ts", "../../../../ltm-react/node_modules/blockly/core/toolbox/category.ts", "../../../../ltm-react/node_modules/blockly/core/toolbox/separator.ts", "../../../../ltm-react/node_modules/blockly/core/toolbox/collapsible_category.ts", "../../../../ltm-react/node_modules/blockly/core/toolbox/toolbox.ts", "../../../../ltm-react/node_modules/blockly/core/utils/metrics.ts", "../../../../ltm-react/node_modules/blockly/core/renderers/common/i_path_object.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_toolbox_item.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_toolbox.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_styleable.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_serializer.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_registrable.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_procedure_model.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_procedure_map.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_positionable.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_parameter_model.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_movable.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_metrics_manager.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_keyboard_accessible.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_flyout.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_dragger.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_drag_target.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_delete_area.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_contextmenu.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_connection_previewer.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_connection_checker.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_component.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_collapsible_toolbox_item.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_bubble.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_bounded_element.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_autohideable.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_ast_node_location_with_block.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_ast_node_location_svg.ts", "../../../../ltm-react/node_modules/blockly/core/interfaces/i_ast_node_location.ts"],
  "sourcesContent": ["/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.registry\n\nimport type {Abstract} from './events/events_abstract.js';\nimport type {Field} from './field.js';\nimport type {Input} from './inputs/input.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport type {IConnectionPreviewer} from './interfaces/i_connection_previewer.js';\nimport type {ICopyData, ICopyable} from './interfaces/i_copyable.js';\nimport type {IDragger} from './interfaces/i_dragger.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IIcon} from './interfaces/i_icon.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IPaster} from './interfaces/i_paster.js';\nimport type {ISerializer} from './interfaces/i_serializer.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Options} from './options.js';\nimport type {Renderer} from './renderers/common/renderer.js';\nimport type {Theme} from './theme.js';\nimport type {ToolboxItem} from './toolbox/toolbox_item.js';\n\n/**\n * A map of maps. With the keys being the type and name of the class we are\n * registering and the value being the constructor function.\n * e.g. {'field': {'field_angle': Blockly.FieldAngle}}\n */\nconst typeMap: {\n  [key: string]: {\n    [key: string]: (new () => AnyDuringMigration) | AnyDuringMigration;\n  };\n} = Object.create(null);\nexport const TEST_ONLY = {typeMap};\n\n/**\n * A map of maps. With the keys being the type and caseless name of the class we\n * are registring, and the value being the most recent cased name for that\n * registration.\n */\nconst nameMap: {[key: string]: {[key: string]: string}} = Object.create(null);\n\n/**\n * The string used to register the default class for a type of plugin.\n */\nexport const DEFAULT = 'default';\n\n/**\n * A name with the type of the element stored in the generic.\n */\nexport class Type<_T> {\n  /** @param name The name of the registry type. */\n  constructor(private readonly name: string) {}\n\n  /**\n   * Returns the name of the type.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.name;\n  }\n\n  static CONNECTION_CHECKER = new Type<IConnectionChecker>('connectionChecker');\n\n  static CONNECTION_PREVIEWER = new Type<IConnectionPreviewer>(\n    'connectionPreviewer',\n  );\n\n  static CURSOR = new Type<Cursor>('cursor');\n\n  static EVENT = new Type<Abstract>('event');\n\n  static FIELD = new Type<Field>('field');\n\n  static INPUT = new Type<Input>('input');\n\n  static RENDERER = new Type<Renderer>('renderer');\n\n  static TOOLBOX = new Type<IToolbox>('toolbox');\n\n  static THEME = new Type<Theme>('theme');\n\n  static TOOLBOX_ITEM = new Type<ToolboxItem>('toolboxItem');\n\n  static FLYOUTS_VERTICAL_TOOLBOX = new Type<IFlyout>('flyoutsVerticalToolbox');\n\n  static FLYOUTS_HORIZONTAL_TOOLBOX = new Type<IFlyout>(\n    'flyoutsHorizontalToolbox',\n  );\n\n  static METRICS_MANAGER = new Type<IMetricsManager>('metricsManager');\n\n  /**\n   * Type for an IDragger. Formerly behavior was mostly covered by\n   * BlockDraggeers, which is why the name is inaccurate.\n   */\n  static BLOCK_DRAGGER = new Type<IDragger>('blockDragger');\n\n  /** @internal */\n  static SERIALIZER = new Type<ISerializer>('serializer');\n\n  /** @internal */\n  static ICON = new Type<IIcon>('icon');\n\n  /** @internal */\n  static PASTER = new Type<IPaster<ICopyData, ICopyable<ICopyData>>>('paster');\n}\n\n/**\n * Registers a class based on a type and name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param registryItem The class or object to register.\n * @param opt_allowOverrides True to prevent an error when overriding an already\n *     registered item.\n * @throws {Error} if the type or name is empty, a name with the given type has\n *     already been registered, or if the given class or object is not valid for\n *     its type.\n */\nexport function register<T>(\n  type: string | Type<T>,\n  name: string,\n  registryItem:\n    | (new (...p1: AnyDuringMigration[]) => T)\n    | null\n    | AnyDuringMigration,\n  opt_allowOverrides?: boolean,\n): void {\n  if (\n    (!(type instanceof Type) && typeof type !== 'string') ||\n    `${type}`.trim() === ''\n  ) {\n    throw Error(\n      'Invalid type \"' +\n        type +\n        '\". The type must be a' +\n        ' non-empty string or a Blockly.registry.Type.',\n    );\n  }\n  type = `${type}`.toLowerCase();\n\n  if (typeof name !== 'string' || name.trim() === '') {\n    throw Error(\n      'Invalid name \"' + name + '\". The name must be a' + ' non-empty string.',\n    );\n  }\n  const caselessName = name.toLowerCase();\n  if (!registryItem) {\n    throw Error('Can not register a null value');\n  }\n  let typeRegistry = typeMap[type];\n  let nameRegistry = nameMap[type];\n  // If the type registry has not been created, create it.\n  if (!typeRegistry) {\n    typeRegistry = typeMap[type] = Object.create(null);\n    nameRegistry = nameMap[type] = Object.create(null);\n  }\n\n  // Validate that the given class has all the required properties.\n  validate(type, registryItem);\n\n  // Don't throw an error if opt_allowOverrides is true,\n  // or if we're trying to register the same item.\n  if (\n    !opt_allowOverrides &&\n    typeRegistry[caselessName] &&\n    typeRegistry[caselessName] !== registryItem\n  ) {\n    throw Error(\n      'Name \"' +\n        caselessName +\n        '\" with type \"' +\n        type +\n        '\" already registered.',\n    );\n  }\n  typeRegistry[caselessName] = registryItem;\n  nameRegistry[caselessName] = name;\n}\n\n/**\n * Checks the given registry item for properties that are required based on the\n * type.\n *\n * @param type The type of the plugin. (e.g. Field, Renderer)\n * @param registryItem A class or object that we are checking for the required\n *     properties.\n */\nfunction validate(type: string, registryItem: AnyDuringMigration) {\n  switch (type) {\n    case String(Type.FIELD):\n      if (typeof registryItem.fromJson !== 'function') {\n        throw Error('Type \"' + type + '\" must have a fromJson function');\n      }\n      break;\n  }\n}\n\n/**\n * Unregisters the registry item with the given type and name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n */\nexport function unregister<T>(type: string | Type<T>, name: string) {\n  type = `${type}`.toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry || !typeRegistry[name]) {\n    console.warn(\n      'Unable to unregister [' +\n        name +\n        '][' +\n        type +\n        '] from the ' +\n        'registry.',\n    );\n    return;\n  }\n  delete typeMap[type][name];\n  delete nameMap[type][name];\n}\n\n/**\n * Gets the registry item for the given name and type. This can be either a\n * class or an object.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class or object with the given name and type or null if none\n *     exists.\n */\nfunction getItem<T>(\n  type: string | Type<T>,\n  name: string,\n  opt_throwIfMissing?: boolean,\n): (new (...p1: AnyDuringMigration[]) => T) | null | AnyDuringMigration {\n  type = `${type}`.toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry || !typeRegistry[name]) {\n    const msg = 'Unable to find [' + name + '][' + type + '] in the registry.';\n    if (opt_throwIfMissing) {\n      throw new Error(\n        msg + ' You must require or register a ' + type + ' plugin.',\n      );\n    } else {\n      console.warn(msg);\n    }\n    return null;\n  }\n  return typeRegistry[name];\n}\n\n/**\n * Returns whether or not the registry contains an item with the given type and\n * name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @returns True if the registry has an item with the given type and name, false\n *     otherwise.\n */\nexport function hasItem<T>(type: string | Type<T>, name: string): boolean {\n  type = `${type}`.toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry) {\n    return false;\n  }\n  return !!typeRegistry[name];\n}\n\n/**\n * Gets the class for the given name and type.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class with the given name and type or null if none exists.\n */\nexport function getClass<T>(\n  type: string | Type<T>,\n  name: string,\n  opt_throwIfMissing?: boolean,\n): (new (...p1: AnyDuringMigration[]) => T) | null {\n  return getItem(type, name, opt_throwIfMissing) as\n    | (new (...p1: AnyDuringMigration[]) => T)\n    | null;\n}\n\n/**\n * Gets the object for the given name and type.\n *\n * @param type The type of the plugin.\n *     (e.g. Category)\n * @param name The plugin's name. (Ex. logic_category)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the object.\n * @returns The object with the given name and type or null if none exists.\n */\nexport function getObject<T>(\n  type: string | Type<T>,\n  name: string,\n  opt_throwIfMissing?: boolean,\n): T | null {\n  return getItem(type, name, opt_throwIfMissing) as T;\n}\n\n/**\n * Returns a map of items registered with the given type.\n *\n * @param type The type of the plugin. (e.g. Category)\n * @param opt_cased Whether or not to return a map with cased keys (rather than\n *     caseless keys). False by default.\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the object. False by default.\n * @returns A map of objects with the given type, or null if none exists.\n */\nexport function getAllItems<T>(\n  type: string | Type<T>,\n  opt_cased?: boolean,\n  opt_throwIfMissing?: boolean,\n): {[key: string]: T | null | (new (...p1: AnyDuringMigration[]) => T)} | null {\n  type = `${type}`.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry) {\n    const msg = `Unable to find [${type}] in the registry.`;\n    if (opt_throwIfMissing) {\n      throw new Error(`${msg} You must require or register a ${type} plugin.`);\n    } else {\n      console.warn(msg);\n    }\n    return null;\n  }\n  if (!opt_cased) {\n    return typeRegistry;\n  }\n  const nameRegistry = nameMap[type];\n  const casedRegistry = Object.create(null);\n  for (const key of Object.keys(typeRegistry)) {\n    casedRegistry[nameRegistry[key]] = typeRegistry[key];\n  }\n  return casedRegistry;\n}\n\n/**\n * Gets the class from Blockly options for the given type.\n * This is used for plugins that override a built in feature. (e.g. Toolbox)\n *\n * @param type The type of the plugin.\n * @param options The option object to check for the given plugin.\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class for the plugin.\n */\nexport function getClassFromOptions<T>(\n  type: Type<T>,\n  options: Options,\n  opt_throwIfMissing?: boolean,\n): (new (...p1: AnyDuringMigration[]) => T) | null {\n  const plugin = options.plugins[String(type)] || DEFAULT;\n\n  // If the user passed in a plugin class instead of a registered plugin name.\n  if (typeof plugin === 'function') {\n    return plugin;\n  }\n  return getClass(type, plugin, opt_throwIfMissing);\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.deprecation\n\n// Set of previously-emitted warnings.\nconst previousWarnings = new Set();\n\n/**\n * Warn developers that a function or property is deprecated.\n *\n * @param name The name of the function or property.\n * @param deprecationDate The date of deprecation. Prefer 'version n.0.0'\n *     format, and fall back to 'month yyyy' or 'quarter yyyy' format.\n * @param deletionDate The date of deletion. Prefer 'version n.0.0'\n *     format, and fall back to 'month yyyy' or 'quarter yyyy' format.\n * @param opt_use The name of a function or property to use instead, if any.\n * @internal\n */\nexport function warn(\n  name: string,\n  deprecationDate: string,\n  deletionDate: string,\n  opt_use?: string,\n) {\n  let msg =\n    name +\n    ' was deprecated in ' +\n    deprecationDate +\n    ' and will be deleted in ' +\n    deletionDate +\n    '.';\n  if (opt_use) {\n    msg += '\\nUse ' + opt_use + ' instead.';\n  }\n\n  // Don't log deprecation warnings multiple times.\n  if (previousWarnings.has(msg)) {\n    return;\n  }\n\n  previousWarnings.add(msg);\n  console.warn(msg);\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.idGenerator\n\n/**\n * Legal characters for the universally unique IDs.  Should be all on\n * a US keyboard.  No characters that conflict with XML or JSON.\n * Requests to remove additional 'problematic' characters from this\n * soup will be denied.  That's your failure to properly escape in\n * your own environment.  Issues #251, #625, #682, #1304.\n */\nconst soup =\n  '!#$%()*+,-./:;=?@[]^_`{|}~' +\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n/**\n * Namespace object for internal implementations we want to be able to\n * stub in tests. Do not use externally.\n *\n * @internal\n */\nconst internal = {\n  /**\n   * Generate a random unique ID.  This should be globally unique.\n   * 87 characters ^ 20 length is greater than 128 bits (better than a UUID).\n   *\n   * @returns A globally unique ID string.\n   */\n  genUid: () => {\n    const length = 20;\n    const soupLength = soup.length;\n    const id = [];\n    for (let i = 0; i < length; i++) {\n      id[i] = soup.charAt(Math.random() * soupLength);\n    }\n    return id.join('');\n  },\n};\nexport const TEST_ONLY = internal;\n\n/** Next unique ID to use. */\nlet nextId = 0;\n\n/**\n * Generate the next unique element IDs.\n * IDs are compatible with the HTML4 'id' attribute restrictions:\n * Use only ASCII letters, digits, '_', '-' and '.'\n *\n * For UUIDs use genUid (below) instead; this ID generator should\n * primarily be used for IDs that end up in the DOM.\n *\n * @returns The next unique identifier.\n */\nexport function getNextUniqueId(): string {\n  return 'blockly-' + (nextId++).toString(36);\n}\n\n/**\n * Generate a random unique ID.\n *\n * @see internal.genUid\n * @returns A globally unique ID string.\n */\nexport function genUid(): string {\n  return internal.genUid();\n}\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file Predicates for testing Abstract event subclasses based on\n * their .type properties.  These are useful because there are places\n * where it is not possible to use instanceof <ClassConstructor> tests\n * for type narrowing due to load ordering issues that would be caused\n * by the need to import (rather than just import type) the class\n * constructors in question.\n */\n\nimport type {Abstract} from './events_abstract.js';\nimport type {BlockChange} from './events_block_change.js';\nimport type {BlockCreate} from './events_block_create.js';\nimport type {BlockDelete} from './events_block_delete.js';\nimport type {BlockDrag} from './events_block_drag.js';\nimport type {BlockFieldIntermediateChange} from './events_block_field_intermediate_change.js';\nimport type {BlockMove} from './events_block_move.js';\nimport type {BubbleOpen} from './events_bubble_open.js';\nimport type {Click} from './events_click.js';\nimport type {CommentChange} from './events_comment_change.js';\nimport type {CommentCollapse} from './events_comment_collapse.js';\nimport type {CommentCreate} from './events_comment_create.js';\nimport type {CommentDelete} from './events_comment_delete.js';\nimport type {CommentDrag} from './events_comment_drag.js';\nimport type {CommentMove} from './events_comment_move.js';\nimport type {CommentResize} from './events_comment_resize.js';\nimport type {MarkerMove} from './events_marker_move.js';\nimport type {Selected} from './events_selected.js';\nimport type {ThemeChange} from './events_theme_change.js';\nimport type {ToolboxItemSelect} from './events_toolbox_item_select.js';\nimport type {TrashcanOpen} from './events_trashcan_open.js';\nimport type {VarCreate} from './events_var_create.js';\nimport type {VarDelete} from './events_var_delete.js';\nimport type {VarRename} from './events_var_rename.js';\nimport type {ViewportChange} from './events_viewport.js';\nimport type {FinishedLoading} from './workspace_events.js';\n\nimport {EventType} from './type.js';\n\n/** @returns true iff event.type is EventType.BLOCK_CREATE */\nexport function isBlockCreate(event: Abstract): event is BlockCreate {\n  return event.type === EventType.BLOCK_CREATE;\n}\n\n/** @returns true iff event.type is EventType.BLOCK_DELETE */\nexport function isBlockDelete(event: Abstract): event is BlockDelete {\n  return event.type === EventType.BLOCK_DELETE;\n}\n\n/** @returns true iff event.type is EventType.BLOCK_CHANGE */\nexport function isBlockChange(event: Abstract): event is BlockChange {\n  return event.type === EventType.BLOCK_CHANGE;\n}\n\n/** @returns true iff event.type is EventType.BLOCK_FIELD_INTERMEDIATE_CHANGE */\nexport function isBlockFieldIntermediateChange(\n  event: Abstract,\n): event is BlockFieldIntermediateChange {\n  return event.type === EventType.BLOCK_FIELD_INTERMEDIATE_CHANGE;\n}\n\n/** @returns true iff event.type is EventType.BLOCK_MOVE */\nexport function isBlockMove(event: Abstract): event is BlockMove {\n  return event.type === EventType.BLOCK_MOVE;\n}\n\n/** @returns true iff event.type is EventType.VAR_CREATE */\nexport function isVarCreate(event: Abstract): event is VarCreate {\n  return event.type === EventType.VAR_CREATE;\n}\n\n/** @returns true iff event.type is EventType.VAR_DELETE */\nexport function isVarDelete(event: Abstract): event is VarDelete {\n  return event.type === EventType.VAR_DELETE;\n}\n\n/** @returns true iff event.type is EventType.VAR_RENAME */\nexport function isVarRename(event: Abstract): event is VarRename {\n  return event.type === EventType.VAR_RENAME;\n}\n\n/** @returns true iff event.type is EventType.BLOCK_DRAG */\nexport function isBlockDrag(event: Abstract): event is BlockDrag {\n  return event.type === EventType.BLOCK_DRAG;\n}\n\n/** @returns true iff event.type is EventType.SELECTED */\nexport function isSelected(event: Abstract): event is Selected {\n  return event.type === EventType.SELECTED;\n}\n\n/** @returns true iff event.type is EventType.CLICK */\nexport function isClick(event: Abstract): event is Click {\n  return event.type === EventType.CLICK;\n}\n\n/** @returns true iff event.type is EventType.MARKER_MOVE */\nexport function isMarkerMove(event: Abstract): event is MarkerMove {\n  return event.type === EventType.MARKER_MOVE;\n}\n\n/** @returns true iff event.type is EventType.BUBBLE_OPEN */\nexport function isBubbleOpen(event: Abstract): event is BubbleOpen {\n  return event.type === EventType.BUBBLE_OPEN;\n}\n\n/** @returns true iff event.type is EventType.TRASHCAN_OPEN */\nexport function isTrashcanOpen(event: Abstract): event is TrashcanOpen {\n  return event.type === EventType.TRASHCAN_OPEN;\n}\n\n/** @returns true iff event.type is EventType.TOOLBOX_ITEM_SELECT */\nexport function isToolboxItemSelect(\n  event: Abstract,\n): event is ToolboxItemSelect {\n  return event.type === EventType.TOOLBOX_ITEM_SELECT;\n}\n\n/** @returns true iff event.type is EventType.THEME_CHANGE */\nexport function isThemeChange(event: Abstract): event is ThemeChange {\n  return event.type === EventType.THEME_CHANGE;\n}\n\n/** @returns true iff event.type is EventType.VIEWPORT_CHANGE */\nexport function isViewportChange(event: Abstract): event is ViewportChange {\n  return event.type === EventType.VIEWPORT_CHANGE;\n}\n\n/** @returns true iff event.type is EventType.COMMENT_CREATE */\nexport function isCommentCreate(event: Abstract): event is CommentCreate {\n  return event.type === EventType.COMMENT_CREATE;\n}\n\n/** @returns true iff event.type is EventType.COMMENT_DELETE */\nexport function isCommentDelete(event: Abstract): event is CommentDelete {\n  return event.type === EventType.COMMENT_DELETE;\n}\n\n/** @returns true iff event.type is EventType.COMMENT_CHANGE */\nexport function isCommentChange(event: Abstract): event is CommentChange {\n  return event.type === EventType.COMMENT_CHANGE;\n}\n\n/** @returns true iff event.type is EventType.COMMENT_MOVE */\nexport function isCommentMove(event: Abstract): event is CommentMove {\n  return event.type === EventType.COMMENT_MOVE;\n}\n\n/** @returns true iff event.type is EventType.COMMENT_RESIZE */\nexport function isCommentResize(event: Abstract): event is CommentResize {\n  return event.type === EventType.COMMENT_RESIZE;\n}\n\n/** @returns true iff event.type is EventType.COMMENT_DRAG */\nexport function isCommentDrag(event: Abstract): event is CommentDrag {\n  return event.type === EventType.COMMENT_DRAG;\n}\n\n/** @returns true iff event.type is EventType.COMMENT_COLLAPSE */\nexport function isCommentCollapse(event: Abstract): event is CommentCollapse {\n  return event.type === EventType.COMMENT_COLLAPSE;\n}\n\n/** @returns true iff event.type is EventType.FINISHED_LOADING */\nexport function isFinishedLoading(event: Abstract): event is FinishedLoading {\n  return event.type === EventType.FINISHED_LOADING;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Events.utils\n\nimport type {Block} from '../block.js';\nimport * as common from '../common.js';\nimport * as registry from '../registry.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport type {Workspace} from '../workspace.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport type {Abstract} from './events_abstract.js';\nimport type {BlockCreate} from './events_block_create.js';\nimport type {BlockMove} from './events_block_move.js';\nimport type {CommentCreate} from './events_comment_create.js';\nimport type {CommentMove} from './events_comment_move.js';\nimport type {CommentResize} from './events_comment_resize.js';\nimport {\n  isBlockChange,\n  isBlockCreate,\n  isBlockMove,\n  isBubbleOpen,\n  isClick,\n  isViewportChange,\n} from './predicates.js';\n\n/** Group ID for new events.  Grouped events are indivisible. */\nlet group = '';\n\n/** Sets whether the next event should be added to the undo stack. */\nlet recordUndo = true;\n\n/**\n * Sets whether events should be added to the undo stack.\n *\n * @param newValue True if events should be added to the undo stack.\n */\nexport function setRecordUndo(newValue: boolean) {\n  recordUndo = newValue;\n}\n\n/**\n * Returns whether or not events will be added to the undo stack.\n *\n * @returns True if events will be added to the undo stack.\n */\nexport function getRecordUndo(): boolean {\n  return recordUndo;\n}\n\n/** Allow change events to be created and fired. */\nlet disabled = 0;\n\n/**\n * The language-neutral ID for when the reason why a block is disabled is\n * because the block is not descended from a root block.\n */\nconst ORPHANED_BLOCK_DISABLED_REASON = 'ORPHANED_BLOCK';\n\n/**\n * Type of events that cause objects to be bumped back into the visible\n * portion of the workspace.\n *\n * Not to be confused with bumping so that disconnected connections do not\n * appear connected.\n */\nexport type BumpEvent =\n  | BlockCreate\n  | BlockMove\n  | CommentCreate\n  | CommentMove\n  | CommentResize;\n\n/** List of events queued for firing. */\nconst FIRE_QUEUE: Abstract[] = [];\n\n/**\n * Enqueue an event to be dispatched to change listeners.\n *\n * Notes:\n *\n * - Events are enqueued until a timeout, generally after rendering is\n *   complete or at the end of the current microtask, if not running\n *   in a browser.\n * - Queued events are subject to destructive modification by being\n *   combined with later-enqueued events, but only until they are\n *   fired.\n * - Events are dispatched via the fireChangeListener method on the\n *   affected workspace.\n *\n * @param event Any Blockly event.\n */\nexport function fire(event: Abstract) {\n  TEST_ONLY.fireInternal(event);\n}\n\n/**\n * Private version of fireInternal for stubbing in tests.\n */\nfunction fireInternal(event: Abstract) {\n  if (!isEnabled()) {\n    return;\n  }\n  if (!FIRE_QUEUE.length) {\n    // First event added; schedule a firing of the event queue.\n    try {\n      // If we are in a browser context, we want to make sure that the event\n      // fires after blocks have been rerendered this frame.\n      requestAnimationFrame(() => {\n        setTimeout(fireNow, 0);\n      });\n    } catch {\n      // Otherwise we just want to delay so events can be coallesced.\n      // requestAnimationFrame will error triggering this.\n      setTimeout(fireNow, 0);\n    }\n  }\n  enqueueEvent(event);\n}\n\n/** Dispatch all queued events. */\nfunction fireNow() {\n  const queue = filter(FIRE_QUEUE, true);\n  FIRE_QUEUE.length = 0;\n  for (const event of queue) {\n    if (!event.workspaceId) continue;\n    common.getWorkspaceById(event.workspaceId)?.fireChangeListener(event);\n  }\n}\n\n/**\n * Enqueue an event on FIRE_QUEUE.\n *\n * Normally this is equivalent to FIRE_QUEUE.push(event), but if the\n * enqueued event is a BlockChange event and the most recent event(s)\n * on the queue are BlockMove events that (re)connect other blocks to\n * the changed block (and belong to the same event group) then the\n * enqueued event will be enqueued before those events rather than\n * after.\n *\n * This is a workaround for a problem caused by the fact that\n * MutatorIcon.prototype.recomposeSourceBlock can only fire a\n * BlockChange event after the mutating block's compose method\n * returns, meaning that if the compose method reconnects child blocks\n * the corresponding BlockMove events are emitted _before_ the\n * BlockChange event, causing issues with undo, mirroring, etc.; see\n * https://github.com/google/blockly/issues/8225#issuecomment-2195751783\n * (and following) for details.\n */\nfunction enqueueEvent(event: Abstract) {\n  if (isBlockChange(event) && event.element === 'mutation') {\n    let i;\n    for (i = FIRE_QUEUE.length; i > 0; i--) {\n      const otherEvent = FIRE_QUEUE[i - 1];\n      if (\n        otherEvent.group !== event.group ||\n        otherEvent.workspaceId !== event.workspaceId ||\n        !isBlockMove(otherEvent) ||\n        otherEvent.newParentId !== event.blockId\n      ) {\n        break;\n      }\n    }\n    FIRE_QUEUE.splice(i, 0, event);\n    return;\n  }\n\n  FIRE_QUEUE.push(event);\n}\n\n/**\n * Filter the queued events by merging duplicates, removing null\n * events and reording BlockChange events.\n *\n * History of this function:\n *\n * This function was originally added in commit cf257ea5 with the\n * intention of dramatically reduing the total number of dispatched\n * events.  Initialy it affected only BlockMove events but others were\n * added over time.\n *\n * Code was added to reorder BlockChange events added in commit\n * 5578458, for uncertain reasons but most probably as part of an\n * only-partially-successful attemp to fix problems with event\n * ordering during block mutations.  This code should probably have\n * been added to the top of the function, before merging and\n * null-removal, but was added at the bottom for now-forgotten\n * reasons.  See these bug investigations for a fuller discussion of\n * the underlying issue and some of the failures that arose because of\n * this incomplete/incorrect fix:\n *\n * https://github.com/google/blockly/issues/8225#issuecomment-2195751783\n * https://github.com/google/blockly/issues/2037#issuecomment-2209696351\n *\n * Later, in PR #1205 the original O(n^2) implementation was replaced\n * by a linear-time implementation, though additonal fixes were made\n * subsequently.\n *\n * In August 2024 a number of significant simplifications were made:\n *\n * This function was previously called from Workspace.prototype.undo,\n * but the mutation of events by this function was the cause of issue\n * #7026 (note that events would combine differently in reverse order\n * vs. forward order).  The originally-chosen fix for this was the\n * addition (in PR #7069) of code to fireNow to post-filter the\n * .undoStack_ and .redoStack_ of any workspace that had just been\n * involved in dispatching events; this apparently resolved the issue\n * but added considerable additional complexity and made it difficult\n * to reason about how events are processed for undo/redo, so both the\n * call from undo and the post-processing code was removed, and\n * forward=true was made the default while calling the function with\n * forward=false was deprecated.\n *\n * At the same time, the buggy code to reorder BlockChange events was\n * replaced by a less-buggy version of the same functionality in a new\n * function, enqueueEvent, called from fireInternal, thus assuring\n * that events will be in the correct order at the time filter is\n * called.\n *\n * Additionally, the event merging code was modified so that only\n * immediately adjacent events would be merged.  This simplified the\n * implementation while ensuring that the merging of events cannot\n * cause them to be reordered.\n *\n * @param queue Array of events.\n * @param forward True if forward (redo), false if backward (undo).\n *     This parameter is deprecated: true is now the default and\n *     calling filter with it set to false will in future not be\n *     supported.\n * @returns Array of filtered events.\n */\nexport function filter(queue: Abstract[], forward = true): Abstract[] {\n  if (!forward) {\n    deprecation.warn('filter(queue, /*forward=*/false)', 'v11.2', 'v12');\n    // Undo was merged in reverse order.\n    queue = queue.slice().reverse(); // Copy before reversing in place.\n  }\n  const mergedQueue: Abstract[] = [];\n  // Merge duplicates.\n  for (const event of queue) {\n    const lastEvent = mergedQueue[mergedQueue.length - 1];\n    if (event.isNull()) continue;\n    if (\n      !lastEvent ||\n      lastEvent.workspaceId !== event.workspaceId ||\n      lastEvent.group !== event.group\n    ) {\n      mergedQueue.push(event);\n      continue;\n    }\n    if (\n      isBlockMove(event) &&\n      isBlockMove(lastEvent) &&\n      event.blockId === lastEvent.blockId\n    ) {\n      // Merge move events.\n      lastEvent.newParentId = event.newParentId;\n      lastEvent.newInputName = event.newInputName;\n      lastEvent.newCoordinate = event.newCoordinate;\n      // Concatenate reasons without duplicates.\n      if (lastEvent.reason || event.reason) {\n        lastEvent.reason = Array.from(\n          new Set((lastEvent.reason ?? []).concat(event.reason ?? [])),\n        );\n      }\n    } else if (\n      isBlockChange(event) &&\n      isBlockChange(lastEvent) &&\n      event.blockId === lastEvent.blockId &&\n      event.element === lastEvent.element &&\n      event.name === lastEvent.name\n    ) {\n      // Merge change events.\n      lastEvent.newValue = event.newValue;\n    } else if (isViewportChange(event) && isViewportChange(lastEvent)) {\n      // Merge viewport change events.\n      lastEvent.viewTop = event.viewTop;\n      lastEvent.viewLeft = event.viewLeft;\n      lastEvent.scale = event.scale;\n      lastEvent.oldScale = event.oldScale;\n    } else if (isClick(event) && isBubbleOpen(lastEvent)) {\n      // Drop click events caused by opening/closing bubbles.\n    } else {\n      mergedQueue.push(event);\n    }\n  }\n  // Filter out any events that have become null due to merging.\n  queue = mergedQueue.filter((e) => !e.isNull());\n  if (!forward) {\n    // Restore undo order.\n    queue.reverse();\n  }\n  return queue;\n}\n\n/**\n * Modify pending undo events so that when they are fired they don't land\n * in the undo stack.  Called by Workspace.clearUndo.\n */\nexport function clearPendingUndo() {\n  for (let i = 0, event; (event = FIRE_QUEUE[i]); i++) {\n    event.recordUndo = false;\n  }\n}\n\n/**\n * Stop sending events.  Every call to this function MUST also call enable.\n */\nexport function disable() {\n  disabled++;\n}\n\n/**\n * Start sending events.  Unless events were already disabled when the\n * corresponding call to disable was made.\n */\nexport function enable() {\n  disabled--;\n}\n\n/**\n * Returns whether events may be fired or not.\n *\n * @returns True if enabled.\n */\nexport function isEnabled(): boolean {\n  return disabled === 0;\n}\n\n/**\n * Current group.\n *\n * @returns ID string.\n */\nexport function getGroup(): string {\n  return group;\n}\n\n/**\n * Start or stop a group.\n *\n * @param state True to start new group, false to end group.\n *   String to set group explicitly.\n */\nexport function setGroup(state: boolean | string) {\n  TEST_ONLY.setGroupInternal(state);\n}\n\n/**\n * Private version of setGroup for stubbing in tests.\n */\nfunction setGroupInternal(state: boolean | string) {\n  if (typeof state === 'boolean') {\n    group = state ? idGenerator.genUid() : '';\n  } else {\n    group = state;\n  }\n}\n\n/**\n * Compute a list of the IDs of the specified block and all its descendants.\n *\n * @param block The root block.\n * @returns List of block IDs.\n * @internal\n */\nexport function getDescendantIds(block: Block): string[] {\n  const ids = [];\n  const descendants = block.getDescendants(false);\n  for (let i = 0, descendant; (descendant = descendants[i]); i++) {\n    ids[i] = descendant.id;\n  }\n  return ids;\n}\n\n/**\n * Decode the JSON into an event.\n *\n * @param json JSON representation.\n * @param workspace Target workspace for event.\n * @returns The event represented by the JSON.\n * @throws {Error} if an event type is not found in the registry.\n */\nexport function fromJson(\n  json: AnyDuringMigration,\n  workspace: Workspace,\n): Abstract {\n  const eventClass = get(json['type']);\n  if (!eventClass) throw Error('Unknown event type.');\n\n  return (eventClass as any).fromJson(json, workspace);\n}\n\n/**\n * Gets the class for a specific event type from the registry.\n *\n * @param eventType The type of the event to get.\n * @returns The event class with the given type.\n */\nexport function get(\n  eventType: string,\n): new (...p1: AnyDuringMigration[]) => Abstract {\n  const event = registry.getClass(registry.Type.EVENT, eventType);\n  if (!event) {\n    throw new Error(`Event type ${eventType} not found in registry.`);\n  }\n  return event;\n}\n\n/**\n * Set if a block is disabled depending on whether it is properly connected.\n * Use this on applications where all blocks should be connected to a top block.\n *\n * @param event Custom data for event.\n */\nexport function disableOrphans(event: Abstract) {\n  if (isBlockMove(event) || isBlockCreate(event)) {\n    const blockEvent = event as BlockMove | BlockCreate;\n    if (!blockEvent.workspaceId) {\n      return;\n    }\n    const eventWorkspace = common.getWorkspaceById(\n      blockEvent.workspaceId,\n    ) as WorkspaceSvg;\n    if (!blockEvent.blockId) {\n      throw new Error('Encountered a blockEvent without a proper blockId');\n    }\n    let block = eventWorkspace.getBlockById(blockEvent.blockId);\n    if (block) {\n      // Changing blocks as part of this event shouldn't be undoable.\n      const initialUndoFlag = recordUndo;\n      try {\n        recordUndo = false;\n        const parent = block.getParent();\n        if (\n          parent &&\n          !parent.hasDisabledReason(ORPHANED_BLOCK_DISABLED_REASON)\n        ) {\n          const children = block.getDescendants(false);\n          for (let i = 0, child; (child = children[i]); i++) {\n            child.setDisabledReason(false, ORPHANED_BLOCK_DISABLED_REASON);\n          }\n        } else if (\n          (block.outputConnection || block.previousConnection) &&\n          !eventWorkspace.isDragging()\n        ) {\n          do {\n            block.setDisabledReason(true, ORPHANED_BLOCK_DISABLED_REASON);\n            block = block.getNextBlock();\n          } while (block);\n        }\n      } finally {\n        recordUndo = initialUndoFlag;\n      }\n    }\n  }\n}\n\nexport const TEST_ONLY = {\n  FIRE_QUEUE,\n  enqueueEvent,\n  fireNow,\n  fireInternal,\n  setGroupInternal,\n};\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.common\n\nimport type {Block} from './block.js';\nimport {ISelectable} from './blockly.js';\nimport {BlockDefinition, Blocks} from './blocks.js';\nimport type {Connection} from './connection.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/** Database of all workspaces. */\nconst WorkspaceDB_ = Object.create(null);\n\n/**\n * Find the workspace with the specified ID.\n *\n * @param id ID of workspace to find.\n * @returns The sought after workspace or null if not found.\n */\nexport function getWorkspaceById(id: string): Workspace | null {\n  return WorkspaceDB_[id] || null;\n}\n\n/**\n * Find all workspaces.\n *\n * @returns Array of workspaces.\n */\nexport function getAllWorkspaces(): Workspace[] {\n  const workspaces = [];\n  for (const workspaceId in WorkspaceDB_) {\n    workspaces.push(WorkspaceDB_[workspaceId]);\n  }\n  return workspaces;\n}\n\n/**\n * Register a workspace in the workspace db.\n *\n * @param workspace\n */\nexport function registerWorkspace(workspace: Workspace) {\n  WorkspaceDB_[workspace.id] = workspace;\n}\n\n/**\n * Unregister a workspace from the workspace db.\n *\n * @param workspace\n */\nexport function unregisterWorkpace(workspace: Workspace) {\n  delete WorkspaceDB_[workspace.id];\n}\n\n/**\n * The main workspace most recently used.\n * Set by Blockly.WorkspaceSvg.prototype.markFocused\n */\nlet mainWorkspace: Workspace;\n\n/**\n * Returns the last used top level workspace (based on focus).  Try not to use\n * this function, particularly if there are multiple Blockly instances on a\n * page.\n *\n * @returns The main workspace.\n */\nexport function getMainWorkspace(): Workspace {\n  return mainWorkspace;\n}\n\n/**\n * Sets last used main workspace.\n *\n * @param workspace The most recently used top level workspace.\n */\nexport function setMainWorkspace(workspace: Workspace) {\n  mainWorkspace = workspace;\n}\n\n/**\n * Currently selected copyable object.\n */\nlet selected: ISelectable | null = null;\n\n/**\n * Returns the currently selected copyable object.\n */\nexport function getSelected(): ISelectable | null {\n  return selected;\n}\n\n/**\n * Sets the currently selected block. This function does not visually mark the\n * block as selected or fire the required events. If you wish to\n * programmatically select a block, use `BlockSvg#select`.\n *\n * @param newSelection The newly selected block.\n * @internal\n */\nexport function setSelected(newSelection: ISelectable | null) {\n  if (selected === newSelection) return;\n\n  const event = new (eventUtils.get(EventType.SELECTED))(\n    selected?.id ?? null,\n    newSelection?.id ?? null,\n    newSelection?.workspace.id ?? selected?.workspace.id ?? '',\n  );\n  eventUtils.fire(event);\n\n  selected?.unselect();\n  selected = newSelection;\n  selected?.select();\n}\n\n/**\n * Container element in which to render the WidgetDiv, DropDownDiv and Tooltip.\n */\nlet parentContainer: Element | null;\n\n/**\n * Get the container element in which to render the WidgetDiv, DropDownDiv and\n * Tooltip.\n *\n * @returns The parent container.\n */\nexport function getParentContainer(): Element | null {\n  return parentContainer;\n}\n\n/**\n * Set the parent container.  This is the container element that the WidgetDiv,\n * DropDownDiv, and Tooltip are rendered into the first time `Blockly.inject`\n * is called.\n * This method is a NOP if called after the first `Blockly.inject`.\n *\n * @param newParent The container element.\n */\nexport function setParentContainer(newParent: Element) {\n  parentContainer = newParent;\n}\n\n/**\n * Size the SVG image to completely fill its container. Call this when the view\n * actually changes sizes (e.g. on a window resize/device orientation change).\n * See workspace.resizeContents to resize the workspace when the contents\n * change (e.g. when a block is added or removed).\n * Record the height/width of the SVG image.\n *\n * @param workspace Any workspace in the SVG.\n */\nexport function svgResize(workspace: WorkspaceSvg) {\n  let mainWorkspace = workspace;\n  while (mainWorkspace.options.parentWorkspace) {\n    mainWorkspace = mainWorkspace.options.parentWorkspace;\n  }\n  const svg = mainWorkspace.getParentSvg();\n  const cachedSize = mainWorkspace.getCachedParentSvgSize();\n  const div = svg.parentElement;\n  if (!(div instanceof HTMLElement)) {\n    // Workspace deleted, or something.\n    return;\n  }\n\n  const width = div.offsetWidth;\n  const height = div.offsetHeight;\n  if (cachedSize.width !== width) {\n    svg.setAttribute('width', width + 'px');\n    mainWorkspace.setCachedParentSvgSize(width, null);\n  }\n  if (cachedSize.height !== height) {\n    svg.setAttribute('height', height + 'px');\n    mainWorkspace.setCachedParentSvgSize(null, height);\n  }\n  mainWorkspace.resize();\n}\n\n/**\n * All of the connections on blocks that are currently being dragged.\n */\nexport const draggingConnections: Connection[] = [];\n\n/**\n * Get a map of all the block's descendants mapping their type to the number of\n *    children with that type.\n *\n * @param block The block to map.\n * @param opt_stripFollowing Optionally ignore all following\n *    statements (blocks that are not inside a value or statement input\n *    of the block).\n * @returns Map of types to type counts for descendants of the bock.\n */\nexport function getBlockTypeCounts(\n  block: Block,\n  opt_stripFollowing?: boolean,\n): {[key: string]: number} {\n  const typeCountsMap = Object.create(null);\n  const descendants = block.getDescendants(true);\n  if (opt_stripFollowing) {\n    const nextBlock = block.getNextBlock();\n    if (nextBlock) {\n      const index = descendants.indexOf(nextBlock);\n      descendants.splice(index, descendants.length - index);\n    }\n  }\n  for (let i = 0, checkBlock; (checkBlock = descendants[i]); i++) {\n    if (typeCountsMap[checkBlock.type]) {\n      typeCountsMap[checkBlock.type]++;\n    } else {\n      typeCountsMap[checkBlock.type] = 1;\n    }\n  }\n  return typeCountsMap;\n}\n\n/**\n * Helper function for defining a block from JSON.  The resulting function has\n * the correct value of jsonDef at the point in code where jsonInit is called.\n *\n * @param jsonDef The JSON definition of a block.\n * @returns A function that calls jsonInit with the correct value\n *     of jsonDef.\n */\nfunction jsonInitFactory(jsonDef: AnyDuringMigration): () => void {\n  return function (this: Block) {\n    this.jsonInit(jsonDef);\n  };\n}\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n */\nexport function defineBlocksWithJsonArray(jsonArray: AnyDuringMigration[]) {\n  TEST_ONLY.defineBlocksWithJsonArrayInternal(jsonArray);\n}\n\n/**\n * Private version of defineBlocksWithJsonArray for stubbing in tests.\n */\nfunction defineBlocksWithJsonArrayInternal(jsonArray: AnyDuringMigration[]) {\n  defineBlocks(createBlockDefinitionsFromJsonArray(jsonArray));\n}\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n * @returns A map of the block\n *     definitions created.\n */\nexport function createBlockDefinitionsFromJsonArray(\n  jsonArray: AnyDuringMigration[],\n): {[key: string]: BlockDefinition} {\n  const blocks: {[key: string]: BlockDefinition} = {};\n  for (let i = 0; i < jsonArray.length; i++) {\n    const elem = jsonArray[i];\n    if (!elem) {\n      console.warn(`Block definition #${i} in JSON array is ${elem}. Skipping`);\n      continue;\n    }\n    const type = elem['type'];\n    if (!type) {\n      console.warn(\n        `Block definition #${i} in JSON array is missing a type attribute. ` +\n          'Skipping.',\n      );\n      continue;\n    }\n    blocks[type] = {init: jsonInitFactory(elem)};\n  }\n  return blocks;\n}\n\n/**\n * Add the specified block definitions to the block definitions\n * dictionary (Blockly.Blocks).\n *\n * @param blocks A map of block\n *     type names to block definitions.\n */\nexport function defineBlocks(blocks: {[key: string]: BlockDefinition}) {\n  // Iterate over own enumerable properties.\n  for (const type of Object.keys(blocks)) {\n    const definition = blocks[type];\n    if (type in Blocks) {\n      console.warn(\n        `Block definition \"${type}\" overwrites previous definition.`,\n      );\n    }\n    Blocks[type] = definition;\n  }\n}\n\nexport const TEST_ONLY = {defineBlocksWithJsonArrayInternal};\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Touch\n\nimport type {Gesture} from './gesture.js';\n\n/** Length in ms for a touch to become a long press. */\nconst LONGPRESS = 750;\n\n/**\n * Whether touch is enabled in the browser.\n * Copied from Closure's goog.events.BrowserFeature.TOUCH_ENABLED\n */\nexport const TOUCH_ENABLED =\n  'ontouchstart' in globalThis ||\n  !!(\n    globalThis['document'] &&\n    document.documentElement &&\n    'ontouchstart' in document.documentElement\n  ) || // IE10 uses non-standard touch events,\n  // so it has a different check.\n  !!(\n    globalThis['navigator'] &&\n    (globalThis['navigator']['maxTouchPoints'] ||\n      (globalThis['navigator'] as any)['msMaxTouchPoints'])\n  );\n\n/** Which touch events are we currently paying attention to? */\nlet touchIdentifier_: string | null = null;\n\n/**\n * The TOUCH_MAP lookup dictionary specifies additional touch events to fire,\n * in conjunction with mouse events.\n */\nexport const TOUCH_MAP: {[key: string]: string[]} = {\n  'mousedown': ['pointerdown'],\n  'mouseenter': ['pointerenter'],\n  'mouseleave': ['pointerleave'],\n  'mousemove': ['pointermove'],\n  'mouseout': ['pointerout'],\n  'mouseover': ['pointerover'],\n  'mouseup': ['pointerup', 'pointercancel'],\n  'touchend': ['pointerup'],\n  'touchcancel': ['pointercancel'],\n};\n\n/** PID of queued long-press task. */\nlet longPid_: AnyDuringMigration = 0;\n\n/**\n * Context menus on touch devices are activated using a long-press.\n * Unfortunately the contextmenu touch event is currently (2015) only supported\n * by Chrome.  This function is fired on any touchstart event, queues a task,\n * which after about a second opens the context menu.  The tasks is killed\n * if the touch event terminates early.\n *\n * @param e Touch start event.\n * @param gesture The gesture that triggered this longStart.\n * @internal\n */\nexport function longStart(e: PointerEvent, gesture: Gesture) {\n  longStop();\n  longPid_ = setTimeout(function () {\n    // Let the gesture route the right-click correctly.\n    if (gesture) {\n      gesture.handleRightClick(e);\n    }\n  }, LONGPRESS);\n}\n\n/**\n * Nope, that's not a long-press.  Either touchend or touchcancel was fired,\n * or a drag hath begun.  Kill the queued long-press task.\n *\n * @internal\n */\nexport function longStop() {\n  if (longPid_) {\n    clearTimeout(longPid_);\n    longPid_ = 0;\n  }\n}\n\n/**\n * Clear the touch identifier that tracks which touch stream to pay attention\n * to.  This ends the current drag/gesture and allows other pointers to be\n * captured.\n */\nexport function clearTouchIdentifier() {\n  touchIdentifier_ = null;\n}\n\n/**\n * Decide whether Blockly should handle or ignore this event.\n * Mouse and touch events require special checks because we only want to deal\n * with one touch stream at a time.  All other events should always be handled.\n *\n * @param e The event to check.\n * @returns True if this event should be passed through to the registered\n *     handler; false if it should be blocked.\n */\nexport function shouldHandleEvent(e: Event): boolean {\n  // Do not replace the startsWith with a check for `instanceof PointerEvent`.\n  // `click` and `contextmenu` are PointerEvents in some browsers,\n  // despite not starting with `pointer`, but we want to always handle them\n  // without worrying about touch identifiers.\n  return (\n    !e.type.startsWith('pointer') ||\n    (e instanceof PointerEvent && checkTouchIdentifier(e))\n  );\n}\n\n/**\n * Get the pointer identifier from the given event.\n *\n * @param e Pointer event.\n * @returns The pointerId of the event.\n */\nexport function getTouchIdentifierFromEvent(e: PointerEvent): string {\n  return `${e.pointerId}`;\n}\n\n/**\n * Check whether the pointer identifier on the event matches the current saved\n * identifier. If the current identifier was unset, save the identifier from\n * the event. This starts a drag/gesture, during which pointer events with\n * other identifiers will be silently ignored.\n *\n * @param e Pointer event.\n * @returns Whether the identifier on the event matches the current saved\n *     identifier.\n */\nexport function checkTouchIdentifier(e: PointerEvent): boolean {\n  const identifier = getTouchIdentifierFromEvent(e);\n\n  if (touchIdentifier_) {\n    // We're already tracking some touch/mouse event.  Is this from the same\n    // source?\n    return touchIdentifier_ === identifier;\n  }\n  if (e.type === 'pointerdown') {\n    // No identifier set yet, and this is the start of a drag.  Set it and\n    // return.\n    touchIdentifier_ = identifier;\n    return true;\n  }\n  // There was no identifier yet, but this wasn't a start event so we're going\n  // to ignore it.  This probably means that another drag finished while this\n  // pointer was down.\n  return false;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.browserEvents\n\n// Theoretically we could figure out a way to type the event params correctly,\n// but it's not high priority.\n/* eslint-disable @typescript-eslint/no-unsafe-function-type */\n\nimport * as Touch from './touch.js';\nimport * as userAgent from './utils/useragent.js';\n\n/**\n * Blockly opaque event data used to unbind events when using\n * `bind` and `conditionalBind`.\n */\nexport type Data = [EventTarget, string, (e: Event) => void][];\n\n/**\n * The multiplier for scroll wheel deltas using the line delta mode.\n * See https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent/deltaMode\n * for more information on deltaMode.\n */\nconst LINE_MODE_MULTIPLIER = 40;\n\n/**\n * The multiplier for scroll wheel deltas using the page delta mode.\n * See https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent/deltaMode\n * for more information on deltaMode.\n */\nconst PAGE_MODE_MULTIPLIER = 125;\n\n/**\n * Bind an event handler that can be ignored if it is not part of the active\n * touch stream.\n * Use this for events that either start or continue a multi-part gesture (e.g.\n * mousedown or mousemove, which may be part of a drag or click).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @param opt_noCaptureIdentifier True if triggering on this event should not\n *     block execution of other event handlers on this touch or other\n *     simultaneous touches.  False by default.\n * @returns Opaque data that can be passed to unbindEvent_.\n */\nexport function conditionalBind(\n  node: EventTarget,\n  name: string,\n  thisObject: object | null,\n  func: Function,\n  opt_noCaptureIdentifier?: boolean,\n): Data {\n  /**\n   *\n   * @param e\n   */\n  function wrapFunc(e: Event) {\n    const captureIdentifier = !opt_noCaptureIdentifier;\n\n    if (!(captureIdentifier && !Touch.shouldHandleEvent(e))) {\n      if (thisObject) {\n        func.call(thisObject, e);\n      } else {\n        func(e);\n      }\n    }\n  }\n\n  const bindData: Data = [];\n  if (name in Touch.TOUCH_MAP) {\n    for (let i = 0; i < Touch.TOUCH_MAP[name].length; i++) {\n      const type = Touch.TOUCH_MAP[name][i];\n      node.addEventListener(type, wrapFunc, false);\n      bindData.push([node, type, wrapFunc]);\n    }\n  } else {\n    node.addEventListener(name, wrapFunc, false);\n    bindData.push([node, name, wrapFunc]);\n  }\n  return bindData;\n}\n\n/**\n * Bind an event handler that should be called regardless of whether it is part\n * of the active touch stream.\n * Use this for events that are not part of a multi-part gesture (e.g.\n * mouseover for tooltips).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @returns Opaque data that can be passed to unbindEvent_.\n */\nexport function bind(\n  node: EventTarget,\n  name: string,\n  thisObject: object | null,\n  func: Function,\n): Data {\n  /**\n   *\n   * @param e\n   */\n  function wrapFunc(e: Event) {\n    if (thisObject) {\n      func.call(thisObject, e);\n    } else {\n      func(e);\n    }\n  }\n\n  const bindData: Data = [];\n  if (name in Touch.TOUCH_MAP) {\n    for (let i = 0; i < Touch.TOUCH_MAP[name].length; i++) {\n      const type = Touch.TOUCH_MAP[name][i];\n      node.addEventListener(type, wrapFunc, false);\n      bindData.push([node, type, wrapFunc]);\n    }\n  } else {\n    node.addEventListener(name, wrapFunc, false);\n    bindData.push([node, name, wrapFunc]);\n  }\n  return bindData;\n}\n\n/**\n * Unbind one or more events event from a function call.\n *\n * @param bindData Opaque data from bindEvent_.\n *     This list is emptied during the course of calling this function.\n * @returns The function call.\n */\nexport function unbind(bindData: Data): (e: Event) => void {\n  // Accessing an element of the last property of the array is unsafe if the\n  // bindData is an empty array. But that should never happen because developers\n  // should only pass Data from bind or conditionalBind.\n  const callback = bindData[bindData.length - 1][2];\n  while (bindData.length) {\n    const [node, name, func] = bindData.pop()!;\n    node.removeEventListener(name, func, false);\n  }\n  return callback;\n}\n\n/**\n * Returns true if this event is targeting a text input widget?\n *\n * @param e An event.\n * @returns True if text input.\n */\nexport function isTargetInput(e: Event): boolean {\n  if (e.target instanceof HTMLElement) {\n    if (\n      e.target.isContentEditable ||\n      e.target.getAttribute('data-is-text-input') === 'true'\n    ) {\n      return true;\n    }\n\n    if (e.target instanceof HTMLInputElement) {\n      const target = e.target;\n      return (\n        target.type === 'text' ||\n        target.type === 'number' ||\n        target.type === 'email' ||\n        target.type === 'password' ||\n        target.type === 'search' ||\n        target.type === 'tel' ||\n        target.type === 'url'\n      );\n    }\n\n    if (e.target instanceof HTMLTextAreaElement) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Returns true this event is a right-click.\n *\n * @param e Mouse event.\n * @returns True if right-click.\n */\nexport function isRightButton(e: MouseEvent): boolean {\n  if (e.ctrlKey && userAgent.MAC) {\n    // Control-clicking on Mac OS X is treated as a right-click.\n    // WebKit on Mac OS X fails to change button to 2 (but Gecko does).\n    return true;\n  }\n  return e.button === 2;\n}\n\n/**\n * Returns the converted coordinates of the given mouse event.\n * The origin (0,0) is the top-left corner of the Blockly SVG.\n *\n * @param e Mouse event.\n * @param svg SVG element.\n * @param matrix Inverted screen CTM to use.\n * @returns Object with .x and .y properties.\n */\nexport function mouseToSvg(\n  e: MouseEvent,\n  svg: SVGSVGElement,\n  matrix: SVGMatrix | null,\n): SVGPoint {\n  const svgPoint = svg.createSVGPoint();\n  svgPoint.x = e.clientX;\n  svgPoint.y = e.clientY;\n\n  if (!matrix) {\n    matrix = svg.getScreenCTM()!.inverse();\n  }\n  return svgPoint.matrixTransform(matrix);\n}\n\n/**\n * Returns the scroll delta of a mouse event in pixel units.\n *\n * @param e Mouse event.\n * @returns Scroll delta object with .x and .y properties.\n */\nexport function getScrollDeltaPixels(e: WheelEvent): {x: number; y: number} {\n  switch (e.deltaMode) {\n    case 0x00: // Pixel mode.\n    default:\n      return {x: e.deltaX, y: e.deltaY};\n    case 0x01: // Line mode.\n      return {\n        x: e.deltaX * LINE_MODE_MULTIPLIER,\n        y: e.deltaY * LINE_MODE_MULTIPLIER,\n      };\n    case 0x02: // Page mode.\n      return {\n        x: e.deltaX * PAGE_MODE_MULTIPLIER,\n        y: e.deltaY * PAGE_MODE_MULTIPLIER,\n      };\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.array\n\n/**\n * Removes the first occurrence of a particular value from an array.\n *\n * @param arr Array from which to remove value.\n * @param value Value to remove.\n * @returns True if an element was removed.\n * @internal\n */\nexport function removeElem<T>(arr: Array<T>, value: T): boolean {\n  const i = arr.indexOf(value);\n  if (i === -1) {\n    return false;\n  }\n  arr.splice(i, 1);\n  return true;\n}\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Css\n\n/** Has CSS already been injected? */\nlet injected = false;\n\n/**\n * Add some CSS to the blob that will be injected later.  Allows optional\n * components such as fields and the toolbox to store separate CSS.\n *\n * @param cssContent Multiline CSS string or an array of single lines of CSS.\n */\nexport function register(cssContent: string) {\n  if (injected) {\n    throw Error('CSS already injected');\n  }\n  content += '\\n' + cssContent;\n}\n\n/**\n * Inject the CSS into the DOM.  This is preferable over using a regular CSS\n * file since:\n * a) It loads synchronously and doesn't force a redraw later.\n * b) It speeds up loading by not blocking on a separate HTTP transfer.\n * c) The CSS content may be made dynamic depending on init options.\n *\n * @param hasCss If false, don't inject CSS (providing CSS becomes the\n *     document's responsibility).\n * @param pathToMedia Path from page to the Blockly media directory.\n */\nexport function inject(hasCss: boolean, pathToMedia: string) {\n  // Only inject the CSS once.\n  if (injected) {\n    return;\n  }\n  injected = true;\n  if (!hasCss) {\n    return;\n  }\n  // Strip off any trailing slash (either Unix or Windows).\n  const mediaPath = pathToMedia.replace(/[\\\\/]$/, '');\n  const cssContent = content.replace(/<<<PATH>>>/g, mediaPath);\n  // Cleanup the collected css content after injecting it to the DOM.\n  content = '';\n\n  // Inject CSS tag at start of head.\n  const cssNode = document.createElement('style');\n  cssNode.id = 'blockly-common-style';\n  const cssTextNode = document.createTextNode(cssContent);\n  cssNode.appendChild(cssTextNode);\n  document.head.insertBefore(cssNode, document.head.firstChild);\n}\n\n/**\n * The CSS content for Blockly.\n */\nlet content = `\n.blocklySvg {\n  background-color: #fff;\n  outline: none;\n  overflow: hidden;  /* IE overflows by default. */\n  position: absolute;\n  display: block;\n}\n\n.blocklyWidgetDiv {\n  display: none;\n  position: absolute;\n  z-index: 99999;  /* big value for bootstrap3 compatibility */\n}\n\n.injectionDiv {\n  height: 100%;\n  position: relative;\n  overflow: hidden;  /* So blocks in drag surface disappear at edges */\n  touch-action: none;\n  user-select: none;\n  -webkit-user-select: none;\n}\n\n.blocklyNonSelectable {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n}\n\n.blocklyBlockCanvas.blocklyCanvasTransitioning,\n.blocklyBubbleCanvas.blocklyCanvasTransitioning {\n  transition: transform .5s;\n}\n\n.blocklyTooltipDiv {\n  background-color: #ffffc7;\n  border: 1px solid #ddc;\n  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);\n  color: #000;\n  display: none;\n  font: 9pt sans-serif;\n  opacity: .9;\n  padding: 2px;\n  position: absolute;\n  z-index: 100000;  /* big value for bootstrap3 compatibility */\n}\n\n.blocklyDropDownDiv {\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 1000;\n  display: none;\n  border: 1px solid;\n  border-color: #dadce0;\n  background-color: #fff;\n  border-radius: 2px;\n  padding: 4px;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownContent {\n  max-height: 300px;  /* @todo: spec for maximum height. */\n  overflow: auto;\n  overflow-x: hidden;\n  position: relative;\n}\n\n.blocklyDropDownArrow {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 16px;\n  height: 16px;\n  z-index: -1;\n  background-color: inherit;\n  border-color: inherit;\n}\n\n.blocklyDropDownButton {\n  display: inline-block;\n  float: left;\n  padding: 0;\n  margin: 4px;\n  border-radius: 4px;\n  outline: none;\n  border: 1px solid;\n  transition: box-shadow .1s;\n  cursor: pointer;\n}\n\n.blocklyArrowTop {\n  border-top: 1px solid;\n  border-left: 1px solid;\n  border-top-left-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyArrowBottom {\n  border-bottom: 1px solid;\n  border-right: 1px solid;\n  border-bottom-right-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyResizeSE {\n  cursor: se-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeSW {\n  cursor: sw-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeLine {\n  stroke: #515A5A;\n  stroke-width: 1;\n}\n\n.blocklyHighlightedConnectionPath {\n  fill: none;\n  stroke: #fc3;\n  stroke-width: 4px;\n}\n\n.blocklyPathLight {\n  fill: none;\n  stroke-linecap: round;\n  stroke-width: 1;\n}\n\n.blocklySelected>.blocklyPathLight {\n  display: none;\n}\n\n.blocklyDraggable {\n  cursor: grab;\n  cursor: -webkit-grab;\n}\n\n.blocklyDragging {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n  /* Drag surface disables events to not block the toolbox, so we have to\n   * reenable them here for the cursor values to work. */\n  pointer-events: auto;\n}\n\n  /* Changes cursor on mouse down. Not effective in Firefox because of\n     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */\n.blocklyDraggable:active {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n.blocklyDragging.blocklyDraggingDelete {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyDragging>.blocklyPath,\n.blocklyDragging>.blocklyPathLight {\n  fill-opacity: .8;\n  stroke-opacity: .8;\n}\n\n.blocklyDragging>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyDisabled>.blocklyPath {\n  fill-opacity: .5;\n  stroke-opacity: .5;\n}\n\n.blocklyDisabled>.blocklyPathLight,\n.blocklyDisabled>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyInsertionMarker>.blocklyPath,\n.blocklyInsertionMarker>.blocklyPathLight,\n.blocklyInsertionMarker>.blocklyPathDark {\n  fill-opacity: .2;\n  stroke: none;\n}\n\n.blocklyNonEditableText>text {\n  pointer-events: none;\n}\n\n.blocklyFlyout {\n  position: absolute;\n  z-index: 20;\n}\n\n.blocklyText text {\n  cursor: default;\n}\n\n.blocklyHidden {\n  display: none;\n}\n\n.blocklyFieldDropdown:not(.blocklyHidden) {\n  display: block;\n}\n\n.blocklyIconGroup {\n  cursor: default;\n}\n\n.blocklyIconGroup:not(:hover),\n.blocklyIconGroupReadonly {\n  opacity: .6;\n}\n\n.blocklyIconShape {\n  fill: #00f;\n  stroke: #fff;\n  stroke-width: 1px;\n}\n\n.blocklyIconSymbol {\n  fill: #fff;\n}\n\n.blocklyMinimalBody {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n}\n\n.blocklyHtmlInput {\n  border: none;\n  border-radius: 4px;\n  height: 100%;\n  margin: 0;\n  outline: none;\n  padding: 0;\n  width: 100%;\n  text-align: center;\n  display: block;\n  box-sizing: border-box;\n}\n\n/* Remove the increase and decrease arrows on the field number editor */\ninput.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,\ninput.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\ninput[type=number] {\n  -moz-appearance: textfield;\n}\n\n.blocklyMainBackground {\n  stroke-width: 1;\n  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */\n}\n\n.blocklyMutatorBackground {\n  fill: #fff;\n  stroke: #ddd;\n  stroke-width: 1;\n}\n\n.blocklyFlyoutBackground {\n  fill: #ddd;\n  fill-opacity: .8;\n}\n\n.blocklyMainWorkspaceScrollbar {\n  z-index: 20;\n}\n\n.blocklyFlyoutScrollbar {\n  z-index: 30;\n}\n\n.blocklyScrollbarHorizontal,\n.blocklyScrollbarVertical {\n  position: absolute;\n  outline: none;\n}\n\n.blocklyScrollbarBackground {\n  opacity: 0;\n  pointer-events: none;\n}\n\n.blocklyScrollbarHandle {\n  fill: #ccc;\n}\n\n.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyScrollbarHandle:hover {\n  fill: #bbb;\n}\n\n/* Darken flyout scrollbars due to being on a grey background. */\n/* By contrast, workspace scrollbars are on a white background. */\n.blocklyFlyout .blocklyScrollbarHandle {\n  fill: #bbb;\n}\n\n.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyFlyout .blocklyScrollbarHandle:hover {\n  fill: #aaa;\n}\n\n.blocklyInvalidInput {\n  background: #faa;\n}\n\n.blocklyVerticalMarker {\n  stroke-width: 3px;\n  fill: rgba(255,255,255,.5);\n  pointer-events: none;\n}\n\n.blocklyComputeCanvas {\n  position: absolute;\n  width: 0;\n  height: 0;\n}\n\n.blocklyNoPointerEvents {\n  pointer-events: none;\n}\n\n.blocklyContextMenu {\n  border-radius: 4px;\n  max-height: 100%;\n}\n\n.blocklyDropdownMenu {\n  border-radius: 2px;\n  padding: 0 !important;\n}\n\n.blocklyDropdownMenu .blocklyMenuItem {\n  /* 28px on the left for icon or checkbox. */\n  padding-left: 28px;\n}\n\n/* BiDi override for the resting state. */\n.blocklyDropdownMenu .blocklyMenuItemRtl {\n  /* Flip left/right padding for BiDi. */\n  padding-left: 5px;\n  padding-right: 28px;\n}\n\n.blocklyWidgetDiv .blocklyMenu {\n  background: #fff;\n  border: 1px solid transparent;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n  font: normal 13px Arial, sans-serif;\n  margin: 0;\n  outline: none;\n  padding: 4px 0;\n  position: absolute;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n.blocklyWidgetDiv .blocklyMenu.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv .blocklyMenu {\n  background: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  border: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  font: normal 13px \"Helvetica Neue\", Helvetica, sans-serif;\n  outline: none;\n  position: relative;  /* Compatibility with gapi, reset from goog-menu */\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n/* State: resting. */\n.blocklyMenuItem {\n  border: none;\n  color: #000;\n  cursor: pointer;\n  list-style: none;\n  margin: 0;\n  /* 7em on the right for shortcut. */\n  min-width: 7em;\n  padding: 6px 15px;\n  white-space: nowrap;\n}\n\n/* State: disabled. */\n.blocklyMenuItemDisabled {\n  color: #ccc;\n  cursor: inherit;\n}\n\n/* State: hover. */\n.blocklyMenuItemHighlight {\n  background-color: rgba(0,0,0,.1);\n}\n\n/* State: selected/checked. */\n.blocklyMenuItemCheckbox {\n  height: 16px;\n  position: absolute;\n  width: 16px;\n}\n\n.blocklyMenuItemSelected .blocklyMenuItemCheckbox {\n  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;\n  float: left;\n  margin-left: -24px;\n  position: static;  /* Scroll with the menu. */\n}\n\n.blocklyMenuItemRtl .blocklyMenuItemCheckbox {\n  float: right;\n  margin-right: -24px;\n}\n\n.blocklyBlockDragSurface, .blocklyAnimationLayer {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: visible !important;\n  z-index: 80;\n  pointer-events: none;\n}\n`;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.dom\n\nimport type {Svg} from './svg.js';\n\n/**\n * Required name space for SVG elements.\n */\nexport const SVG_NS = 'http://www.w3.org/2000/svg';\n\n/**\n * Required name space for HTML elements.\n */\nexport const HTML_NS = 'http://www.w3.org/1999/xhtml';\n\n/**\n * Required name space for XLINK elements.\n */\nexport const XLINK_NS = 'http://www.w3.org/1999/xlink';\n\n/**\n * Node type constants.\n * https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\n */\nexport enum NodeType {\n  ELEMENT_NODE = 1,\n  TEXT_NODE = 3,\n  COMMENT_NODE = 8,\n}\n\n/** Temporary cache of text widths. */\nlet cacheWidths: {[key: string]: number} | null = null;\n\n/** Number of current references to cache. */\nlet cacheReference = 0;\n\n/** A HTML canvas context used for computing text width. */\nlet canvasContext: CanvasRenderingContext2D | null = null;\n\n/**\n * Helper method for creating SVG elements.\n *\n * @param name Element's tag name.\n * @param attrs Dictionary of attribute names and values.\n * @param opt_parent Optional parent on which to append the element.\n * @returns if name is a string or a more specific type if it a member of Svg.\n */\nexport function createSvgElement<T extends SVGElement>(\n  name: string | Svg<T>,\n  attrs: {[key: string]: string | number},\n  opt_parent?: Element | null,\n): T {\n  const e = document.createElementNS(SVG_NS, `${name}`) as T;\n  for (const key in attrs) {\n    e.setAttribute(key, `${attrs[key]}`);\n  }\n  if (opt_parent) {\n    opt_parent.appendChild(e);\n  }\n  return e;\n}\n\n/**\n * Add a CSS class to a element.\n *\n * Handles multiple space-separated classes for legacy reasons.\n *\n * @param element DOM element to add class to.\n * @param className Name of class to add.\n * @returns True if class was added, false if already present.\n */\nexport function addClass(element: Element, className: string): boolean {\n  const classNames = className.split(' ');\n  if (classNames.every((name) => element.classList.contains(name))) {\n    return false;\n  }\n  element.classList.add(...classNames);\n  return true;\n}\n\n/**\n * Removes multiple classes from an element.\n *\n * @param element DOM element to remove classes from.\n * @param classNames A string of one or multiple class names for an element.\n */\nexport function removeClasses(element: Element, classNames: string) {\n  element.classList.remove(...classNames.split(' '));\n}\n\n/**\n * Remove a CSS class from a element.\n *\n * Handles multiple space-separated classes for legacy reasons.\n *\n * @param element DOM element to remove class from.\n * @param className Name of class to remove.\n * @returns True if class was removed, false if never present.\n */\nexport function removeClass(element: Element, className: string): boolean {\n  const classNames = className.split(' ');\n  if (classNames.every((name) => !element.classList.contains(name))) {\n    return false;\n  }\n  element.classList.remove(...classNames);\n  return true;\n}\n\n/**\n * Checks if an element has the specified CSS class.\n *\n * @param element DOM element to check.\n * @param className Name of class to check.\n * @returns True if class exists, false otherwise.\n */\nexport function hasClass(element: Element, className: string): boolean {\n  return element.classList.contains(className);\n}\n\n/**\n * Removes a node from its parent. No-op if not attached to a parent.\n *\n * @param node The node to remove.\n * @returns The node removed if removed; else, null.\n */\n// Copied from Closure goog.dom.removeNode\nexport function removeNode(node: Node | null): Node | null {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * Insert a node after a reference node.\n * Contrast with node.insertBefore function.\n *\n * @param newNode New element to insert.\n * @param refNode Existing element to precede new node.\n */\nexport function insertAfter(newNode: Element, refNode: Element) {\n  const siblingNode = refNode.nextSibling;\n  const parentNode = refNode.parentNode;\n  if (!parentNode) {\n    throw Error('Reference node has no parent.');\n  }\n  if (siblingNode) {\n    parentNode.insertBefore(newNode, siblingNode);\n  } else {\n    parentNode.appendChild(newNode);\n  }\n}\n\n/**\n * Sets the CSS transform property on an element. This function sets the\n * non-vendor-prefixed and vendor-prefixed versions for backwards compatibility\n * with older browsers. See https://caniuse.com/#feat=transforms2d\n *\n * @param element Element to which the CSS transform will be applied.\n * @param transform The value of the CSS `transform` property.\n */\nexport function setCssTransform(\n  element: HTMLElement | SVGElement,\n  transform: string,\n) {\n  element.style['transform'] = transform;\n  element.style['-webkit-transform' as any] = transform;\n}\n\n/**\n * Start caching text widths. Every call to this function MUST also call\n * stopTextWidthCache. Caches must not survive between execution threads.\n */\nexport function startTextWidthCache() {\n  cacheReference++;\n  if (!cacheWidths) {\n    cacheWidths = Object.create(null);\n  }\n}\n\n/**\n * Stop caching field widths. Unless caching was already on when the\n * corresponding call to startTextWidthCache was made.\n */\nexport function stopTextWidthCache() {\n  cacheReference--;\n  if (!cacheReference) {\n    cacheWidths = null;\n  }\n}\n\n/**\n * Gets the width of a text element, caching it in the process.\n *\n * @param textElement An SVG 'text' element.\n * @returns Width of element.\n */\nexport function getTextWidth(textElement: SVGTextElement): number {\n  const key = textElement.textContent + '\\n' + textElement.className.baseVal;\n  let width;\n  // Return the cached width if it exists.\n  if (cacheWidths) {\n    width = cacheWidths[key];\n    if (width) {\n      return width;\n    }\n  }\n\n  // Attempt to compute fetch the width of the SVG text element.\n  try {\n    width = textElement.getComputedTextLength();\n  } catch {\n    // In other cases where we fail to get the computed text. Instead, use an\n    // approximation and do not cache the result. At some later point in time\n    // when the block is inserted into the visible DOM, this method will be\n    // called again and, at that point in time, will not throw an exception.\n    return textElement.textContent!.length * 8;\n  }\n\n  // Cache the computed width and return.\n  if (cacheWidths) {\n    cacheWidths[key] = width;\n  }\n  return width;\n}\n\n/**\n * Gets the width of a text element using a faster method than `getTextWidth`.\n * This method requires that we know the text element's font family and size in\n * advance. Similar to `getTextWidth`, we cache the width we compute.\n *\n * @param textElement An SVG 'text' element.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Width of element.\n */\nexport function getFastTextWidth(\n  textElement: SVGTextElement,\n  fontSize: number,\n  fontWeight: string,\n  fontFamily: string,\n): number {\n  return getFastTextWidthWithSizeString(\n    textElement,\n    fontSize + 'pt',\n    fontWeight,\n    fontFamily,\n  );\n}\n\n/**\n * Gets the width of a text element using a faster method than `getTextWidth`.\n * This method requires that we know the text element's font family and size in\n * advance. Similar to `getTextWidth`, we cache the width we compute.\n * This method is similar to `getFastTextWidth` but expects the font size\n * parameter to be a string.\n *\n * @param textElement An SVG 'text' element.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Width of element.\n */\nexport function getFastTextWidthWithSizeString(\n  textElement: SVGTextElement,\n  fontSize: string,\n  fontWeight: string,\n  fontFamily: string,\n): number {\n  const text = textElement.textContent;\n  const key = text + '\\n' + textElement.className.baseVal;\n  let width;\n\n  // Return the cached width if it exists.\n  if (cacheWidths) {\n    width = cacheWidths[key];\n    if (width) {\n      return width;\n    }\n  }\n\n  if (!canvasContext) {\n    // Inject the canvas element used for computing text widths.\n    const computeCanvas = document.createElement('canvas');\n    computeCanvas.className = 'blocklyComputeCanvas';\n    document.body.appendChild(computeCanvas);\n\n    // Initialize the HTML canvas context and set the font.\n    // The context font must match blocklyText's fontsize and font-family\n    // set in CSS.\n    canvasContext = computeCanvas.getContext('2d') as CanvasRenderingContext2D;\n  }\n  // Set the desired font size and family.\n  canvasContext.font = fontWeight + ' ' + fontSize + ' ' + fontFamily;\n\n  // Measure the text width using the helper canvas context.\n  if (text) {\n    width = canvasContext.measureText(text).width;\n  } else {\n    width = 0;\n  }\n\n  // Cache the computed width and return.\n  if (cacheWidths) {\n    cacheWidths[key] = width;\n  }\n  return width;\n}\n\n/**\n * Measure a font's metrics. The height and baseline values.\n *\n * @param text Text to measure the font dimensions of.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Font measurements.\n */\nexport function measureFontMetrics(\n  text: string,\n  fontSize: string,\n  fontWeight: string,\n  fontFamily: string,\n): {height: number; baseline: number} {\n  const span = document.createElement('span');\n  span.style.font = fontWeight + ' ' + fontSize + ' ' + fontFamily;\n  span.textContent = text;\n\n  const block = document.createElement('div');\n  block.style.width = '1px';\n  block.style.height = '0';\n\n  const div = document.createElement('div');\n  div.style.display = 'flex';\n  div.style.position = 'fixed';\n  div.style.top = '0';\n  div.style.left = '0';\n  div.appendChild(span);\n  div.appendChild(block);\n\n  document.body.appendChild(div);\n  const result = {\n    height: 0,\n    baseline: 0,\n  };\n  try {\n    div.style.alignItems = 'baseline';\n    result.baseline = block.offsetTop - span.offsetTop;\n    div.style.alignItems = 'flex-end';\n    result.height = block.offsetTop - span.offsetTop;\n  } finally {\n    document.body.removeChild(div);\n  }\n  return result;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.style\n\nimport {Coordinate} from './coordinate.js';\nimport {Rect} from './rect.js';\nimport {Size} from './size.js';\n\n/**\n * Gets the height and width of an element.\n * Similar to Closure's goog.style.getSize\n *\n * @param element Element to get size of.\n * @returns Object with width/height properties.\n */\nexport function getSize(element: Element): Size {\n  return TEST_ONLY.getSizeInternal(element);\n}\n\n/**\n * Private version of getSize for stubbing in tests.\n */\nfunction getSizeInternal(element: Element): Size {\n  if (getComputedStyle(element, 'display') !== 'none') {\n    return getSizeWithDisplay(element);\n  }\n\n  // Evaluate size with a temporary element.\n  // AnyDuringMigration because:  Property 'style' does not exist on type\n  // 'Element'.\n  const style = (element as AnyDuringMigration).style;\n  const originalDisplay = style.display;\n  const originalVisibility = style.visibility;\n  const originalPosition = style.position;\n\n  style.visibility = 'hidden';\n  style.position = 'absolute';\n  style.display = 'inline';\n\n  const offsetWidth = (element as HTMLElement).offsetWidth;\n  const offsetHeight = (element as HTMLElement).offsetHeight;\n\n  style.display = originalDisplay;\n  style.position = originalPosition;\n  style.visibility = originalVisibility;\n\n  return new Size(offsetWidth, offsetHeight);\n}\n\n/**\n * Gets the height and width of an element when the display is not none.\n *\n * @param element Element to get size of.\n * @returns Object with width/height properties.\n */\nfunction getSizeWithDisplay(element: Element): Size {\n  const offsetWidth = (element as HTMLElement).offsetWidth;\n  const offsetHeight = (element as HTMLElement).offsetHeight;\n  return new Size(offsetWidth, offsetHeight);\n}\n\n/**\n * Retrieves a computed style value of a node. It returns empty string\n * if the property requested is an SVG one and it has not been\n * explicitly set (firefox and webkit).\n *\n * Copied from Closure's goog.style.getComputedStyle\n *\n * @param element Element to get style of.\n * @param property Property to get (camel-case).\n * @returns Style value.\n */\nexport function getComputedStyle(element: Element, property: string): string {\n  const styles = window.getComputedStyle(element);\n  // element.style[..] is undefined for browser specific styles\n  // as 'filter'.\n  return (\n    (styles as AnyDuringMigration)[property] ||\n    styles.getPropertyValue(property)\n  );\n}\n\n/**\n * Returns a Coordinate object relative to the top-left of the HTML document.\n * Similar to Closure's goog.style.getPageOffset\n *\n * @param el Element to get the page offset for.\n * @returns The page offset.\n */\nexport function getPageOffset(el: Element): Coordinate {\n  const pos = new Coordinate(0, 0);\n  const box = el.getBoundingClientRect();\n  const documentElement = document.documentElement;\n  // Must add the scroll coordinates in to get the absolute page offset\n  // of element since getBoundingClientRect returns relative coordinates to\n  // the viewport.\n  const scrollCoord = new Coordinate(\n    window.pageXOffset || documentElement.scrollLeft,\n    window.pageYOffset || documentElement.scrollTop,\n  );\n  pos.x = box.left + scrollCoord.x;\n  pos.y = box.top + scrollCoord.y;\n\n  return pos;\n}\n\n/**\n * Calculates the viewport coordinates relative to the document.\n * Similar to Closure's goog.style.getViewportPageOffset\n *\n * @returns The page offset of the viewport.\n */\nexport function getViewportPageOffset(): Coordinate {\n  const body = document.body;\n  const documentElement = document.documentElement;\n  const scrollLeft = body.scrollLeft || documentElement.scrollLeft;\n  const scrollTop = body.scrollTop || documentElement.scrollTop;\n  return new Coordinate(scrollLeft, scrollTop);\n}\n\n/**\n * Gets the computed border widths (on all sides) in pixels\n * Copied from Closure's goog.style.getBorderBox\n *\n * @param element  The element to get the border widths for.\n * @returns The computed border widths.\n */\nexport function getBorderBox(element: Element): Rect {\n  const left = parseFloat(getComputedStyle(element, 'borderLeftWidth'));\n  const right = parseFloat(getComputedStyle(element, 'borderRightWidth'));\n  const top = parseFloat(getComputedStyle(element, 'borderTopWidth'));\n  const bottom = parseFloat(getComputedStyle(element, 'borderBottomWidth'));\n\n  return new Rect(top, bottom, left, right);\n}\n\n/**\n * Changes the scroll position of `container` with the minimum amount so\n * that the content and the borders of the given `element` become visible.\n * If the element is bigger than the container, its top left corner will be\n * aligned as close to the container's top left corner as possible.\n * Copied from Closure's goog.style.scrollIntoContainerView\n *\n * @param element The element to make visible.\n * @param container The container to scroll. If not set, then the document\n *     scroll element will be used.\n * @param opt_center Whether to center the element in the container.\n *     Defaults to false.\n */\nexport function scrollIntoContainerView(\n  element: Element,\n  container: Element,\n  opt_center?: boolean,\n) {\n  const offset = getContainerOffsetToScrollInto(element, container, opt_center);\n  container.scrollLeft = offset.x;\n  container.scrollTop = offset.y;\n}\n\n/**\n * Calculate the scroll position of `container` with the minimum amount so\n * that the content and the borders of the given `element` become visible.\n * If the element is bigger than the container, its top left corner will be\n * aligned as close to the container's top left corner as possible.\n * Copied from Closure's goog.style.getContainerOffsetToScrollInto\n *\n * @param element The element to make visible.\n * @param container The container to scroll. If not set, then the document\n *     scroll element will be used.\n * @param opt_center Whether to center the element in the container.\n *     Defaults to false.\n * @returns The new scroll position of the container.\n */\nexport function getContainerOffsetToScrollInto(\n  element: Element,\n  container: Element,\n  opt_center?: boolean,\n): Coordinate {\n  // Absolute position of the element's border's top left corner.\n  const elementPos = getPageOffset(element);\n  // Absolute position of the container's border's top left corner.\n  const containerPos = getPageOffset(container);\n  const containerBorder = getBorderBox(container);\n  // Relative pos. of the element's border box to the container's content box.\n  const relX = elementPos.x - containerPos.x - containerBorder.left;\n  const relY = elementPos.y - containerPos.y - containerBorder.top;\n  // How much the element can move in the container, i.e. the difference between\n  // the element's bottom-right-most and top-left-most position where it's\n  // fully visible.\n  const elementSize = getSizeWithDisplay(element);\n  const spaceX = container.clientWidth - elementSize.width;\n  const spaceY = container.clientHeight - elementSize.height;\n  let scrollLeft = container.scrollLeft;\n  let scrollTop = container.scrollTop;\n  if (opt_center) {\n    // All browsers round non-integer scroll positions down.\n    scrollLeft += relX - spaceX / 2;\n    scrollTop += relY - spaceY / 2;\n  } else {\n    // This formula was designed to give the correct scroll values in the\n    // following cases:\n    // - element is higher than container (spaceY < 0) => scroll down by relY\n    // - element is not higher that container (spaceY >= 0):\n    //   - it is above container (relY < 0) => scroll up by abs(relY)\n    //   - it is below container (relY > spaceY) => scroll down by relY - spaceY\n    //   - it is in the container => don't scroll\n    scrollLeft += Math.min(relX, Math.max(relX - spaceX, 0));\n    scrollTop += Math.min(relY, Math.max(relY - spaceY, 0));\n  }\n  return new Coordinate(scrollLeft, scrollTop);\n}\n\nexport const TEST_ONLY = {\n  getSizeInternal,\n};\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.svgMath\n\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport {Coordinate} from './coordinate.js';\nimport {Rect} from './rect.js';\nimport * as style from './style.js';\n\n/**\n * Static regex to pull the x,y values out of an SVG translate() directive.\n * Note that Firefox and IE (9,10) return 'translate(12)' instead of\n * 'translate(12, 0)'.\n * Note that IE (9,10) returns 'translate(16 8)' instead of 'translate(16, 8)'.\n * Note that IE has been reported to return scientific notation (0.123456e-42).\n */\nconst XY_REGEX = /translate\\(\\s*([-+\\d.e]+)([ ,]\\s*([-+\\d.e]+)\\s*)?/;\n\n/**\n * Static regex to pull the x,y values out of a translate() or translate3d()\n * style property.\n * Accounts for same exceptions as XY_REGEX.\n */\nconst XY_STYLE_REGEX =\n  /transform:\\s*translate(?:3d)?\\(\\s*([-+\\d.e]+)\\s*px([ ,]\\s*([-+\\d.e]+)\\s*px)?/;\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * its parent.  Only for SVG elements and children (e.g. rect, g, path).\n *\n * @param element SVG element to find the coordinates of.\n * @returns Object with .x and .y properties.\n */\nexport function getRelativeXY(element: Element): Coordinate {\n  const xy = new Coordinate(0, 0);\n  // First, check for x and y attributes.\n  // Checking for the existence of x/y properties is faster than getAttribute.\n  // However, x/y contains an SVGAnimatedLength object, so rely on getAttribute\n  // to get the number.\n  const x = (element as any).x && element.getAttribute('x');\n  const y = (element as any).y && element.getAttribute('y');\n  if (x) {\n    xy.x = parseInt(x);\n  }\n  if (y) {\n    xy.y = parseInt(y);\n  }\n  // Second, check for transform=\"translate(...)\" attribute.\n  const transform = element.getAttribute('transform');\n  const r = transform && transform.match(XY_REGEX);\n  if (r) {\n    xy.x += Number(r[1]);\n    if (r[3]) {\n      xy.y += Number(r[3]);\n    }\n  }\n\n  // Then check for style = transform: translate(...) or translate3d(...)\n  const style = element.getAttribute('style');\n  if (style && style.includes('translate')) {\n    const styleComponents = style.match(XY_STYLE_REGEX);\n    if (styleComponents) {\n      xy.x += Number(styleComponents[1]);\n      if (styleComponents[3]) {\n        xy.y += Number(styleComponents[3]);\n      }\n    }\n  }\n  return xy;\n}\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * the div Blockly was injected into.\n *\n * @param element SVG element to find the coordinates of. If this is not a child\n *     of the div Blockly was injected into, the behaviour is undefined.\n * @returns Object with .x and .y properties.\n */\nexport function getInjectionDivXY(element: Element): Coordinate {\n  let x = 0;\n  let y = 0;\n  while (element) {\n    const xy = getRelativeXY(element);\n    x += xy.x;\n    y += xy.y;\n    const classes = element.getAttribute('class') || '';\n    if ((' ' + classes + ' ').includes(' injectionDiv ')) {\n      break;\n    }\n    element = element.parentNode as Element;\n  }\n  return new Coordinate(x, y);\n}\n\n/**\n * Get the position of the current viewport in window coordinates.  This takes\n * scroll into account.\n *\n * @returns An object containing window width, height, and scroll position in\n *     window coordinates.\n * @internal\n */\nexport function getViewportBBox(): Rect {\n  // Pixels, in window coordinates.\n  const scrollOffset = style.getViewportPageOffset();\n  return new Rect(\n    scrollOffset.y,\n    document.documentElement.clientHeight + scrollOffset.y,\n    scrollOffset.x,\n    document.documentElement.clientWidth + scrollOffset.x,\n  );\n}\n\n/**\n * Gets the document scroll distance as a coordinate object.\n * Copied from Closure's goog.dom.getDocumentScroll.\n *\n * @returns Object with values 'x' and 'y'.\n */\nexport function getDocumentScroll(): Coordinate {\n  const el = document.documentElement;\n  const win = window;\n  return new Coordinate(\n    win.pageXOffset || el.scrollLeft,\n    win.pageYOffset || el.scrollTop,\n  );\n}\n\n/**\n * Converts screen coordinates to workspace coordinates.\n *\n * @param ws The workspace to find the coordinates on.\n * @param screenCoordinates The screen coordinates to be converted to workspace\n *     coordinates\n * @returns The workspace coordinates.\n */\nexport function screenToWsCoordinates(\n  ws: WorkspaceSvg,\n  screenCoordinates: Coordinate,\n): Coordinate {\n  const screenX = screenCoordinates.x;\n  const screenY = screenCoordinates.y;\n\n  const injectionDiv = ws.getInjectionDiv();\n  // Bounding rect coordinates are in client coordinates, meaning that they\n  // are in pixels relative to the upper left corner of the visible browser\n  // window.  These coordinates change when you scroll the browser window.\n  const boundingRect = injectionDiv.getBoundingClientRect();\n\n  // The client coordinates offset by the injection div's upper left corner.\n  const clientOffsetPixels = new Coordinate(\n    screenX - boundingRect.left,\n    screenY - boundingRect.top,\n  );\n\n  // The offset in pixels between the main workspace's origin and the upper\n  // left corner of the injection div.\n  const mainOffsetPixels = ws.getOriginOffsetInPixels();\n\n  // The position of the new comment in pixels relative to the origin of the\n  // main workspace.\n  const finalOffsetPixels = Coordinate.difference(\n    clientOffsetPixels,\n    mainOffsetPixels,\n  );\n  // The position in main workspace coordinates.\n  const finalOffsetMainWs = finalOffsetPixels.scale(1 / ws.scale);\n  return finalOffsetMainWs;\n}\n\n/**\n * Converts workspace coordinates to screen coordinates.\n *\n * @param ws The workspace to get the coordinates out of.\n * @param workspaceCoordinates  The workspace coordinates to be converted\n *     to screen coordinates.\n * @returns The screen coordinates.\n */\nexport function wsToScreenCoordinates(\n  ws: WorkspaceSvg,\n  workspaceCoordinates: Coordinate,\n): Coordinate {\n  // Fix workspace scale vs browser scale.\n  const screenCoordinates = workspaceCoordinates.scale(ws.scale);\n  const screenX = screenCoordinates.x;\n  const screenY = screenCoordinates.y;\n\n  const injectionDiv = ws.getInjectionDiv();\n  const boundingRect = injectionDiv.getBoundingClientRect();\n  const mainOffset = ws.getOriginOffsetInPixels();\n\n  // Fix workspace origin vs browser origin.\n  return new Coordinate(\n    screenX + boundingRect.left + mainOffset.x,\n    screenY + boundingRect.top + mainOffset.y,\n  );\n}\n\nexport const TEST_ONLY = {\n  XY_REGEX,\n  XY_STYLE_REGEX,\n};\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.xml\n\nlet domParser: DOMParser = {\n  parseFromString: function () {\n    throw new Error(\n      'DOMParser was not found in the global scope and was not properly ' +\n        'injected using injectDependencies',\n    );\n  },\n};\n\nlet xmlSerializer: XMLSerializer = {\n  serializeToString: function () {\n    throw new Error(\n      'XMLSerializer was not foundin the global scope and was not properly ' +\n        'injected using injectDependencies',\n    );\n  },\n};\n\n/**\n * Injected dependencies.  By default these are just (and have the\n * same types as) the corresponding DOM Window properties, but the\n * Node.js wrapper for Blockly (see scripts/package/node/core.js)\n * calls injectDependencies to supply implementations from the jsdom\n * package instead.\n */\nlet {document, DOMParser, XMLSerializer} = globalThis;\nif (DOMParser) domParser = new DOMParser();\nif (XMLSerializer) xmlSerializer = new XMLSerializer();\n\n/**\n * Inject implementations of document, DOMParser and/or XMLSerializer\n * to use instead of the default ones.\n *\n * Used by the Node.js wrapper for Blockly (see\n * scripts/package/node/core.js) to supply implementations from the\n * jsdom package instead.\n *\n * While they may be set individually, it is normally the case that\n * all three will be sourced from the same JSDOM instance.  They MUST\n * at least come from the same copy of the jsdom package.  (Typically\n * this is hard to avoid satsifying this requirement, but it can be\n * inadvertently violated by using webpack to build multiple bundles\n * containing Blockly and jsdom, and then loading more than one into\n * the same JavaScript runtime.  See\n * https://github.com/google/blockly-samples/pull/1452#issuecomment-1364442135\n * for an example of how this happened.)\n *\n * @param dependencies Options object containing dependencies to set.\n */\nexport function injectDependencies(dependencies: {\n  document?: Document;\n  DOMParser?: typeof DOMParser;\n  XMLSerializer?: typeof XMLSerializer;\n}) {\n  ({\n    // Default to existing value if option not supplied.\n    document = document,\n    DOMParser = DOMParser,\n    XMLSerializer = XMLSerializer,\n  } = dependencies);\n\n  domParser = new DOMParser();\n  xmlSerializer = new XMLSerializer();\n}\n\n/**\n * Namespace for Blockly's XML.\n */\nexport const NAME_SPACE = 'https://developers.google.com/blockly/xml';\n\n// eslint-disable-next-line no-control-regex\nconst INVALID_CONTROL_CHARS = /[\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F]/g;\n\n/**\n * Create DOM element for XML.\n *\n * @param tagName Name of DOM element.\n * @returns New DOM element.\n */\nexport function createElement(tagName: string): Element {\n  return document.createElementNS(NAME_SPACE, tagName);\n}\n\n/**\n * Create text element for XML.\n *\n * @param text Text content.\n * @returns New DOM text node.\n */\nexport function createTextNode(text: string): Text {\n  return document.createTextNode(text);\n}\n\n/**\n * Converts an XML string into a DOM structure.\n *\n * Control characters should be escaped. (But we will try to best-effort parse\n * unescaped characters.)\n *\n * Note that even when escaped, U+0000 will be parsed as U+FFFD (the\n * \"replacement character\") because U+0000 is never a valid XML character\n * (even in XML 1.1).\n * https://www.w3.org/TR/xml11/#charsets\n *\n * @param text An XML string.\n * @returns A DOM object representing the singular child of the document\n *     element.\n * @throws if the text doesn't parse.\n */\nexport function textToDom(text: string): Element {\n  let doc = domParser.parseFromString(text, 'text/xml');\n  if (\n    doc &&\n    doc.documentElement &&\n    !doc.getElementsByTagName('parsererror').length\n  ) {\n    return doc.documentElement;\n  }\n\n  // Attempt to parse as HTML to deserialize control characters that were\n  // serialized before the serializer did proper escaping.\n  doc = domParser.parseFromString(text, 'text/html');\n  if (\n    doc &&\n    doc.body.firstChild &&\n    doc.body.firstChild.nodeName.toLowerCase() === 'xml'\n  ) {\n    return doc.body.firstChild as Element;\n  }\n\n  throw new Error(`DOMParser was unable to parse: ${text}`);\n}\n\n/**\n * Converts a DOM structure into plain text.\n * Currently the text format is fairly ugly: all one line with no whitespace.\n *\n * Control characters are escaped using their decimal encodings. This includes\n * U+0000 even though it is technically never a valid XML character (even in\n * XML 1.1).\n * https://www.w3.org/TR/xml11/#charsets\n *\n * When decoded U+0000 will be parsed as U+FFFD (the \"replacement character\").\n *\n * @param dom A tree of XML nodes.\n * @returns Text representation.\n */\nexport function domToText(dom: Node): string {\n  return sanitizeText(xmlSerializer.serializeToString(dom));\n}\n\nfunction sanitizeText(text: string) {\n  return text.replace(\n    INVALID_CONTROL_CHARS,\n    (match) => `&#${match.charCodeAt(0)};`,\n  );\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.toolbox\n\nimport type {ConnectionState} from '../serialization/blocks.js';\nimport type {CssConfig as CategoryCssConfig} from '../toolbox/category.js';\nimport type {CssConfig as SeparatorCssConfig} from '../toolbox/separator.js';\nimport * as utilsXml from './xml.js';\n\n/**\n * The information needed to create a block in the toolbox.\n * Note that disabled has a different type for backwards compatibility.\n */\nexport interface BlockInfo {\n  kind: string;\n  blockxml?: string | Node;\n  type?: string;\n  gap?: string | number;\n  disabled?: string | boolean;\n  disabledReasons?: string[];\n  enabled?: boolean;\n  id?: string;\n  x?: number;\n  y?: number;\n  collapsed?: boolean;\n  inline?: boolean;\n  data?: string;\n  extraState?: AnyDuringMigration;\n  icons?: {[key: string]: AnyDuringMigration};\n  fields?: {[key: string]: AnyDuringMigration};\n  inputs?: {[key: string]: ConnectionState};\n  next?: ConnectionState;\n}\n\n/**\n * The information needed to create a separator in the toolbox.\n */\nexport interface SeparatorInfo {\n  kind: string;\n  id: string | undefined;\n  gap: number | undefined;\n  cssconfig: SeparatorCssConfig | undefined;\n}\n\n/**\n * The information needed to create a button in the toolbox.\n */\nexport interface ButtonInfo {\n  kind: string;\n  text: string;\n  callbackkey: string;\n}\n\n/**\n * The information needed to create a label in the toolbox.\n */\nexport interface LabelInfo {\n  kind: string;\n  text: string;\n  id: string | undefined;\n}\n\n/**\n * The information needed to create either a button or a label in the flyout.\n */\nexport type ButtonOrLabelInfo = ButtonInfo | LabelInfo;\n\n/**\n * The information needed to create a category in the toolbox.\n */\nexport interface StaticCategoryInfo {\n  kind: string;\n  name: string;\n  contents: ToolboxItemInfo[];\n  id: string | undefined;\n  categorystyle: string | undefined;\n  colour: string | undefined;\n  cssconfig: CategoryCssConfig | undefined;\n  hidden: string | undefined;\n  expanded?: string | boolean;\n}\n\n/**\n * The information needed to create a custom category.\n */\nexport interface DynamicCategoryInfo {\n  kind: string;\n  custom: string;\n  id: string | undefined;\n  categorystyle: string | undefined;\n  colour: string | undefined;\n  cssconfig: CategoryCssConfig | undefined;\n  hidden: string | undefined;\n  expanded?: string | boolean;\n}\n\n/**\n * The information needed to create either a dynamic or static category.\n */\nexport type CategoryInfo = StaticCategoryInfo | DynamicCategoryInfo;\n\n/**\n * Any information that can be used to create an item in the toolbox.\n */\nexport type ToolboxItemInfo = FlyoutItemInfo | StaticCategoryInfo;\n\n/**\n * All the different types that can be displayed in a flyout.\n */\nexport type FlyoutItemInfo =\n  | BlockInfo\n  | SeparatorInfo\n  | ButtonInfo\n  | LabelInfo\n  | DynamicCategoryInfo;\n\n/**\n * The JSON definition of a toolbox.\n */\nexport interface ToolboxInfo {\n  kind?: string;\n  contents: ToolboxItemInfo[];\n}\n\n/**\n * An array holding flyout items.\n */\nexport type FlyoutItemInfoArray = FlyoutItemInfo[];\n\n/**\n * All of the different types that can create a toolbox.\n */\nexport type ToolboxDefinition = Node | ToolboxInfo | string;\n\n/**\n * All of the different types that can be used to show items in a flyout.\n */\nexport type FlyoutDefinition =\n  | FlyoutItemInfoArray\n  | NodeList\n  | ToolboxInfo\n  | Node[];\n\n/**\n * The name used to identify a toolbox that has category like items.\n * This only needs to be used if a toolbox wants to be treated like a category\n * toolbox but does not actually contain any toolbox items with the kind\n * 'category'.\n */\nconst CATEGORY_TOOLBOX_KIND = 'categoryToolbox';\n\n/**\n * The name used to identify a toolbox that has no categories and is displayed\n * as a simple flyout displaying blocks, buttons, or labels.\n */\nconst FLYOUT_TOOLBOX_KIND = 'flyoutToolbox';\n\n/**\n * Position of the toolbox and/or flyout relative to the workspace.\n */\nexport enum Position {\n  TOP,\n  BOTTOM,\n  LEFT,\n  RIGHT,\n}\n\n/**\n * Converts the toolbox definition into toolbox JSON.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns Object holding information for creating a toolbox.\n * @internal\n */\nexport function convertToolboxDefToJson(\n  toolboxDef: ToolboxDefinition | null,\n): ToolboxInfo | null {\n  if (!toolboxDef) {\n    return null;\n  }\n\n  if (toolboxDef instanceof Element || typeof toolboxDef === 'string') {\n    toolboxDef = parseToolboxTree(toolboxDef);\n    // AnyDuringMigration because:  Argument of type 'Node | null' is not\n    // assignable to parameter of type 'Node'.\n    toolboxDef = convertToToolboxJson(toolboxDef as AnyDuringMigration);\n  }\n\n  const toolboxJson = toolboxDef as ToolboxInfo;\n  validateToolbox(toolboxJson);\n  return toolboxJson;\n}\n\n/**\n * Validates the toolbox JSON fields have been set correctly.\n *\n * @param toolboxJson Object holding information for creating a toolbox.\n * @throws {Error} if the toolbox is not the correct format.\n */\nfunction validateToolbox(toolboxJson: ToolboxInfo) {\n  const toolboxKind = toolboxJson['kind'];\n  const toolboxContents = toolboxJson['contents'];\n\n  if (toolboxKind) {\n    if (\n      toolboxKind !== FLYOUT_TOOLBOX_KIND &&\n      toolboxKind !== CATEGORY_TOOLBOX_KIND\n    ) {\n      throw Error(\n        'Invalid toolbox kind ' +\n          toolboxKind +\n          '.' +\n          ' Please supply either ' +\n          FLYOUT_TOOLBOX_KIND +\n          ' or ' +\n          CATEGORY_TOOLBOX_KIND,\n      );\n    }\n  }\n  if (!toolboxContents) {\n    throw Error('Toolbox must have a contents attribute.');\n  }\n}\n\n/**\n * Converts the flyout definition into a list of flyout items.\n *\n * @param flyoutDef The definition of the flyout in one of its many forms.\n * @returns A list of flyout items.\n * @internal\n */\nexport function convertFlyoutDefToJsonArray(\n  flyoutDef: FlyoutDefinition | null,\n): FlyoutItemInfoArray {\n  if (!flyoutDef) {\n    return [];\n  }\n\n  if ((flyoutDef as AnyDuringMigration)['contents']) {\n    return (flyoutDef as AnyDuringMigration)['contents'];\n  }\n  // If it is already in the correct format return the flyoutDef.\n  // AnyDuringMigration because:  Property 'nodeType' does not exist on type\n  // 'Node | FlyoutItemInfo'.\n  if (\n    Array.isArray(flyoutDef) &&\n    flyoutDef.length > 0 &&\n    !(flyoutDef[0] as AnyDuringMigration).nodeType\n  ) {\n    // AnyDuringMigration because:  Type 'FlyoutItemInfoArray | Node[]' is not\n    // assignable to type 'FlyoutItemInfoArray'.\n    return flyoutDef as AnyDuringMigration;\n  }\n\n  // AnyDuringMigration because:  Type 'ToolboxItemInfo[] | FlyoutItemInfoArray'\n  // is not assignable to type 'FlyoutItemInfoArray'.\n  return xmlToJsonArray(flyoutDef as Node[] | NodeList) as AnyDuringMigration;\n}\n\n/**\n * Whether or not the toolbox definition has categories.\n *\n * @param toolboxJson Object holding information for creating a toolbox.\n * @returns True if the toolbox has categories.\n * @internal\n */\nexport function hasCategories(toolboxJson: ToolboxInfo | null): boolean {\n  return TEST_ONLY.hasCategoriesInternal(toolboxJson);\n}\n\n/**\n * Private version of hasCategories for stubbing in tests.\n */\nfunction hasCategoriesInternal(toolboxJson: ToolboxInfo | null): boolean {\n  if (!toolboxJson) {\n    return false;\n  }\n\n  const toolboxKind = toolboxJson['kind'];\n  if (toolboxKind) {\n    return toolboxKind === CATEGORY_TOOLBOX_KIND;\n  }\n\n  const categories = toolboxJson['contents'].filter(\n    (item) => item['kind'].toUpperCase() === 'CATEGORY',\n  );\n  return !!categories.length;\n}\n\n/**\n * Whether or not the category is collapsible.\n *\n * @param categoryInfo Object holing information for creating a category.\n * @returns True if the category has subcategories.\n * @internal\n */\nexport function isCategoryCollapsible(categoryInfo: CategoryInfo): boolean {\n  if (!categoryInfo || !(categoryInfo as AnyDuringMigration)['contents']) {\n    return false;\n  }\n\n  const categories = (categoryInfo as AnyDuringMigration)['contents'].filter(\n    function (item: AnyDuringMigration) {\n      return item['kind'].toUpperCase() === 'CATEGORY';\n    },\n  );\n  return !!categories.length;\n}\n\n/**\n * Parses the provided toolbox definition into a consistent format.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns Object holding information for creating a toolbox.\n */\nfunction convertToToolboxJson(toolboxDef: Node): ToolboxInfo {\n  const contents = xmlToJsonArray(toolboxDef as Node | Node[]);\n  const toolboxJson = {'contents': contents};\n  if (toolboxDef instanceof Node) {\n    addAttributes(toolboxDef, toolboxJson);\n  }\n  return toolboxJson;\n}\n\n/**\n * Converts the xml for a toolbox to JSON.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns A list of objects in the toolbox.\n */\nfunction xmlToJsonArray(\n  toolboxDef: Node | Node[] | NodeList,\n): FlyoutItemInfoArray | ToolboxItemInfo[] {\n  const arr = [];\n  // If it is a node it will have children.\n  // AnyDuringMigration because:  Property 'childNodes' does not exist on type\n  // 'Node | NodeList | Node[]'.\n  let childNodes = (toolboxDef as AnyDuringMigration).childNodes;\n  if (!childNodes) {\n    // Otherwise the toolboxDef is an array or collection.\n    childNodes = toolboxDef;\n  }\n  for (let i = 0, child; (child = childNodes[i]); i++) {\n    if (!child.tagName) {\n      continue;\n    }\n    const obj = {};\n    const tagName = child.tagName.toUpperCase();\n    (obj as AnyDuringMigration)['kind'] = tagName;\n\n    // Store the XML for a block.\n    if (tagName === 'BLOCK') {\n      (obj as AnyDuringMigration)['blockxml'] = child;\n    } else if (child.childNodes && child.childNodes.length > 0) {\n      // Get the contents of a category\n      (obj as AnyDuringMigration)['contents'] = xmlToJsonArray(child);\n    }\n\n    // Add XML attributes to object\n    addAttributes(child, obj);\n    arr.push(obj);\n  }\n  // AnyDuringMigration because:  Type '{}[]' is not assignable to type\n  // 'ToolboxItemInfo[] | FlyoutItemInfoArray'.\n  return arr as AnyDuringMigration;\n}\n\n/**\n * Adds the attributes on the node to the given object.\n *\n * @param node The node to copy the attributes from.\n * @param obj The object to copy the attributes to.\n */\nfunction addAttributes(node: Node, obj: AnyDuringMigration) {\n  // AnyDuringMigration because:  Property 'attributes' does not exist on type\n  // 'Node'.\n  for (let j = 0; j < (node as AnyDuringMigration).attributes.length; j++) {\n    // AnyDuringMigration because:  Property 'attributes' does not exist on type\n    // 'Node'.\n    const attr = (node as AnyDuringMigration).attributes[j];\n    if (attr.nodeName.includes('css-')) {\n      obj['cssconfig'] = obj['cssconfig'] || {};\n      obj['cssconfig'][attr.nodeName.replace('css-', '')] = attr.value;\n    } else {\n      obj[attr.nodeName] = attr.value;\n    }\n  }\n}\n\n/**\n * Parse the provided toolbox tree into a consistent DOM format.\n *\n * @param toolboxDef DOM tree of blocks, or text representation of same.\n * @returns DOM tree of blocks, or null.\n */\nexport function parseToolboxTree(\n  toolboxDef: Element | null | string,\n): Element | null {\n  let parsedToolboxDef: Element | null = null;\n  if (toolboxDef) {\n    if (typeof toolboxDef === 'string') {\n      parsedToolboxDef = utilsXml.textToDom(toolboxDef);\n      if (parsedToolboxDef.nodeName.toLowerCase() !== 'xml') {\n        throw TypeError('Toolbox should be an <xml> document.');\n      }\n    } else if (toolboxDef instanceof Element) {\n      parsedToolboxDef = toolboxDef;\n    }\n  }\n  return parsedToolboxDef;\n}\n\nexport const TEST_ONLY = {\n  hasCategoriesInternal,\n};\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.uiPosition\n\nimport type {UiMetrics} from './metrics_manager.js';\nimport {Scrollbar} from './scrollbar.js';\nimport {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Enum for vertical positioning.\n *\n * @internal\n */\nexport enum verticalPosition {\n  TOP,\n  BOTTOM,\n}\n\n/**\n * Enum for horizontal positioning.\n *\n * @internal\n */\nexport enum horizontalPosition {\n  LEFT,\n  RIGHT,\n}\n\n/**\n * An object defining a horizontal and vertical positioning.\n *\n * @internal\n */\nexport interface Position {\n  horizontal: horizontalPosition;\n  vertical: verticalPosition;\n}\n\n/**\n * Enum for bump rules to use for dealing with collisions.\n *\n * @internal\n */\nexport enum bumpDirection {\n  UP,\n  DOWN,\n}\n\n/**\n * Returns a rectangle representing reasonable position for where to place a UI\n * element of the specified size given the restraints and locations of the\n * scrollbars. This method does not take into account any already placed UI\n * elements.\n *\n * @param position The starting horizontal and vertical position.\n * @param size the size of the UI element to get a start position for.\n * @param horizontalPadding The horizontal padding to use.\n * @param verticalPadding The vertical padding to use.\n * @param metrics The workspace UI metrics.\n * @param workspace The workspace.\n * @returns The suggested start position.\n * @internal\n */\nexport function getStartPositionRect(\n  position: Position,\n  size: Size,\n  horizontalPadding: number,\n  verticalPadding: number,\n  metrics: UiMetrics,\n  workspace: WorkspaceSvg,\n): Rect {\n  // Horizontal positioning.\n  let left = 0;\n  const hasVerticalScrollbar =\n    workspace.scrollbar && workspace.scrollbar.canScrollVertically();\n  if (position.horizontal === horizontalPosition.LEFT) {\n    left = metrics.absoluteMetrics.left + horizontalPadding;\n    if (hasVerticalScrollbar && workspace.RTL) {\n      left += Scrollbar.scrollbarThickness;\n    }\n  } else {\n    // position.horizontal === horizontalPosition.RIGHT\n    left =\n      metrics.absoluteMetrics.left +\n      metrics.viewMetrics.width -\n      size.width -\n      horizontalPadding;\n    if (hasVerticalScrollbar && !workspace.RTL) {\n      left -= Scrollbar.scrollbarThickness;\n    }\n  }\n  // Vertical positioning.\n  let top = 0;\n  if (position.vertical === verticalPosition.TOP) {\n    top = metrics.absoluteMetrics.top + verticalPadding;\n  } else {\n    // position.vertical === verticalPosition.BOTTOM\n    top =\n      metrics.absoluteMetrics.top +\n      metrics.viewMetrics.height -\n      size.height -\n      verticalPadding;\n    if (workspace.scrollbar && workspace.scrollbar.canScrollHorizontally()) {\n      // The scrollbars are always positioned on the bottom if they exist.\n      top -= Scrollbar.scrollbarThickness;\n    }\n  }\n  return new Rect(top, top + size.height, left, left + size.width);\n}\n\n/**\n * Returns a corner position that is on the opposite side of the workspace from\n * the toolbox.\n * If in horizontal orientation, defaults to the bottom corner. If in vertical\n * orientation, defaults to the right corner.\n *\n * @param workspace The workspace.\n * @param metrics The workspace metrics.\n * @returns The suggested corner position.\n * @internal\n */\nexport function getCornerOppositeToolbox(\n  workspace: WorkspaceSvg,\n  metrics: UiMetrics,\n): Position {\n  const leftCorner =\n    metrics.toolboxMetrics.position !== toolbox.Position.LEFT &&\n    (!workspace.horizontalLayout || workspace.RTL);\n  const topCorner = metrics.toolboxMetrics.position === toolbox.Position.BOTTOM;\n  const hPosition = leftCorner\n    ? horizontalPosition.LEFT\n    : horizontalPosition.RIGHT;\n  const vPosition = topCorner ? verticalPosition.TOP : verticalPosition.BOTTOM;\n  return {horizontal: hPosition, vertical: vPosition};\n}\n\n/**\n * Returns a position Rect based on a starting position that is bumped\n * so that it doesn't intersect with any of the provided savedPositions. This\n * method does not check that the bumped position is still within bounds.\n *\n * @param startRect The starting position to use.\n * @param margin The margin to use between elements when bumping.\n * @param bumpDir The direction to bump if there is a collision with an existing\n *     UI element.\n * @param savedPositions List of rectangles that represent the positions of UI\n *     elements already placed.\n * @returns The suggested position rectangle.\n * @internal\n */\nexport function bumpPositionRect(\n  startRect: Rect,\n  margin: number,\n  bumpDir: bumpDirection,\n  savedPositions: Rect[],\n): Rect {\n  let top = startRect.top;\n  const left = startRect.left;\n  const width = startRect.right - startRect.left;\n  const height = startRect.bottom - startRect.top;\n\n  // Check for collision and bump if needed.\n  let boundingRect = startRect;\n  for (let i = 0; i < savedPositions.length; i++) {\n    const otherEl = savedPositions[i];\n    if (boundingRect.intersects(otherEl)) {\n      if (bumpDir === bumpDirection.UP) {\n        top = otherEl.top - height - margin;\n      } else {\n        // bumpDir === bumpDirection.DOWN\n        top = otherEl.bottom + margin;\n      }\n      // Recheck other savedPositions\n      boundingRect = new Rect(top, top + height, left, left + width);\n      i = -1;\n    }\n  }\n  return boundingRect;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.registry\n\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\n\n/**\n * Registers the given serializer so that it can be used for serialization and\n * deserialization.\n *\n * @param name The name of the serializer to register.\n * @param serializer The serializer to register.\n */\nexport function register(name: string, serializer: ISerializer) {\n  registry.register(registry.Type.SERIALIZER, name, serializer);\n}\n\n/**\n * Unregisters the serializer associated with the given name.\n *\n * @param name The name of the serializer to unregister.\n */\nexport function unregister(name: string) {\n  registry.unregister(registry.Type.SERIALIZER, name);\n}\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as eventUtils from '../events/utils.js';\nimport {ISerializer} from '../interfaces/i_serializer.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport {Size} from '../utils/size.js';\nimport {Workspace} from '../workspace.js';\nimport * as priorities from './priorities.js';\nimport * as serializationRegistry from './registry.js';\n\nexport interface State {\n  id?: string;\n  text?: string;\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  collapsed?: boolean;\n  editable?: boolean;\n  movable?: boolean;\n  deletable?: boolean;\n}\n\n/** Serializes the state of the given comment to JSON. */\nexport function save(\n  comment: WorkspaceComment,\n  {\n    addCoordinates = false,\n    saveIds = true,\n  }: {\n    addCoordinates?: boolean;\n    saveIds?: boolean;\n  } = {},\n): State {\n  const workspace = comment.workspace;\n  const state: State = Object.create(null);\n\n  state.height = comment.getSize().height;\n  state.width = comment.getSize().width;\n\n  if (saveIds) state.id = comment.id;\n  if (addCoordinates) {\n    const loc = comment.getRelativeToSurfaceXY();\n    state.x = workspace.RTL ? workspace.getWidth() - loc.x : loc.x;\n    state.y = loc.y;\n  }\n\n  if (comment.getText()) state.text = comment.getText();\n  if (comment.isCollapsed()) state.collapsed = true;\n  if (!comment.isOwnEditable()) state.editable = false;\n  if (!comment.isOwnMovable()) state.movable = false;\n  if (!comment.isOwnDeletable()) state.deletable = false;\n\n  return state;\n}\n\n/** Appends the comment defined by the given state to the given workspace. */\nexport function append(\n  state: State,\n  workspace: Workspace,\n  {recordUndo = false}: {recordUndo?: boolean} = {},\n): WorkspaceComment {\n  const prevRecordUndo = eventUtils.getRecordUndo();\n  eventUtils.setRecordUndo(recordUndo);\n\n  const comment = workspace.newComment(state.id);\n\n  if (state.text !== undefined) comment.setText(state.text);\n  if (state.x !== undefined || state.y !== undefined) {\n    const defaultLoc = comment.getRelativeToSurfaceXY();\n    let x = state.x ?? defaultLoc.x;\n    x = workspace.RTL ? workspace.getWidth() - x : x;\n    const y = state.y ?? defaultLoc.y;\n    comment.moveTo(new Coordinate(x, y));\n  }\n  if (state.width !== undefined || state.height) {\n    const defaultSize = comment.getSize();\n    comment.setSize(\n      new Size(\n        state.width ?? defaultSize.width,\n        state.height ?? defaultSize.height,\n      ),\n    );\n  }\n  if (state.collapsed !== undefined) comment.setCollapsed(state.collapsed);\n  if (state.editable !== undefined) comment.setEditable(state.editable);\n  if (state.movable !== undefined) comment.setMovable(state.movable);\n  if (state.deletable !== undefined) comment.setDeletable(state.deletable);\n\n  eventUtils.setRecordUndo(prevRecordUndo);\n\n  return comment;\n}\n\n// Alias to disambiguate saving within the serializer.\nconst saveComment = save;\n\n/** Serializer for saving and loading workspace comment state. */\nexport class WorkspaceCommentSerializer implements ISerializer {\n  priority = priorities.WORKSPACE_COMMENTS;\n\n  /**\n   * Returns the state of all workspace comments in the given workspace.\n   */\n  save(workspace: Workspace): State[] | null {\n    const commentStates = [];\n    for (const comment of workspace.getTopComments()) {\n      const state = saveComment(comment as AnyDuringMigration, {\n        addCoordinates: true,\n        saveIds: true,\n      });\n      if (state) commentStates.push(state);\n    }\n    return commentStates.length ? commentStates : null;\n  }\n\n  /**\n   * Deserializes the comments defined by the given state into the given\n   * workspace.\n   */\n  load(state: State[], workspace: Workspace) {\n    for (const commentState of state) {\n      append(commentState, workspace, {recordUndo: eventUtils.getRecordUndo()});\n    }\n  }\n\n  /** Disposes of any comments that exist on the given workspace. */\n  clear(workspace: Workspace) {\n    for (const comment of workspace.getTopComments()) {\n      comment.dispose();\n    }\n  }\n}\n\nserializationRegistry.register(\n  'workspaceComments',\n  new WorkspaceCommentSerializer(),\n);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {ICopyable, ICopyData} from '../interfaces/i_copyable.js';\nimport type {IPaster} from '../interfaces/i_paster.js';\nimport * as registry from '../registry.js';\n\n/**\n * Registers the given paster so that it cna be used for pasting.\n *\n * @param type The type of the paster to register, e.g. 'block', 'comment', etc.\n * @param paster The paster to register.\n */\nexport function register<U extends ICopyData, T extends ICopyable<U>>(\n  type: string,\n  paster: IPaster<U, T>,\n) {\n  registry.register(registry.Type.PASTER, type, paster);\n}\n\n/**\n * Unregisters the paster associated with the given type.\n *\n * @param type The type of the paster to unregister.\n */\nexport function unregister(type: string) {\n  registry.unregister(registry.Type.PASTER, type);\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {RenderedWorkspaceComment} from '../comments/rendered_workspace_comment.js';\nimport * as common from '../common.js';\nimport {EventType} from '../events/type.js';\nimport * as eventUtils from '../events/utils.js';\nimport {ICopyData} from '../interfaces/i_copyable.js';\nimport {IPaster} from '../interfaces/i_paster.js';\nimport * as commentSerialiation from '../serialization/workspace_comments.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport * as registry from './registry.js';\n\nexport class WorkspaceCommentPaster\n  implements IPaster<WorkspaceCommentCopyData, RenderedWorkspaceComment>\n{\n  static TYPE = 'workspace-comment';\n\n  paste(\n    copyData: WorkspaceCommentCopyData,\n    workspace: WorkspaceSvg,\n    coordinate?: Coordinate,\n  ): RenderedWorkspaceComment | null {\n    const state = copyData.commentState;\n\n    if (coordinate) {\n      state['x'] = coordinate.x;\n      state['y'] = coordinate.y;\n    }\n\n    eventUtils.disable();\n    let comment;\n    try {\n      comment = commentSerialiation.append(\n        state,\n        workspace,\n      ) as RenderedWorkspaceComment;\n      moveCommentToNotConflict(comment);\n    } finally {\n      eventUtils.enable();\n    }\n\n    if (!comment) return null;\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(EventType.COMMENT_CREATE))(comment));\n    }\n    common.setSelected(comment);\n    return comment;\n  }\n}\n\nfunction moveCommentToNotConflict(comment: RenderedWorkspaceComment) {\n  const workspace = comment.workspace;\n  const translateDistance = 30;\n  const coord = comment.getRelativeToSurfaceXY();\n  const offset = new Coordinate(0, 0);\n  // getRelativeToSurfaceXY is really expensive, so we want to cache this.\n  const otherCoords = workspace\n    .getTopComments(false)\n    .filter((otherComment) => otherComment.id !== comment.id)\n    .map((c) => c.getRelativeToSurfaceXY());\n\n  while (\n    commentOverlapsOtherExactly(Coordinate.sum(coord, offset), otherCoords)\n  ) {\n    offset.translate(\n      workspace.RTL ? -translateDistance : translateDistance,\n      translateDistance,\n    );\n  }\n\n  comment.moveTo(Coordinate.sum(coord, offset));\n}\n\nfunction commentOverlapsOtherExactly(\n  coord: Coordinate,\n  otherCoords: Coordinate[],\n): boolean {\n  return otherCoords.some(\n    (otherCoord) =>\n      Math.abs(otherCoord.x - coord.x) <= 1 &&\n      Math.abs(otherCoord.y - coord.y) <= 1,\n  );\n}\n\nexport interface WorkspaceCommentCopyData extends ICopyData {\n  commentState: commentSerialiation.State;\n}\n\nregistry.register(WorkspaceCommentPaster.TYPE, new WorkspaceCommentPaster());\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.aria\n\n/** ARIA states/properties prefix. */\nconst ARIA_PREFIX = 'aria-';\n\n/** ARIA role attribute. */\nconst ROLE_ATTRIBUTE = 'role';\n\n/**\n * ARIA role values.\n * Copied from Closure's goog.a11y.aria.Role\n */\nexport enum Role {\n  // ARIA role for an interactive control of tabular data.\n  GRID = 'grid',\n\n  // ARIA role for a cell in a grid.\n  GRIDCELL = 'gridcell',\n  // ARIA role for a group of related elements like tree item siblings.\n  GROUP = 'group',\n\n  // ARIA role for a listbox.\n  LISTBOX = 'listbox',\n\n  // ARIA role for a popup menu.\n  MENU = 'menu',\n\n  // ARIA role for menu item elements.\n  MENUITEM = 'menuitem',\n  // ARIA role for a checkbox box element inside a menu.\n  MENUITEMCHECKBOX = 'menuitemcheckbox',\n  // ARIA role for option items that are  children of combobox, listbox, menu,\n  // radiogroup, or tree elements.\n  OPTION = 'option',\n  // ARIA role for ignorable cosmetic elements with no semantic significance.\n  PRESENTATION = 'presentation',\n\n  // ARIA role for a row of cells in a grid.\n  ROW = 'row',\n  // ARIA role for a tree.\n  TREE = 'tree',\n\n  // ARIA role for a tree item that sometimes may be expanded or collapsed.\n  TREEITEM = 'treeitem',\n}\n\n/**\n * ARIA states and properties.\n * Copied from Closure's goog.a11y.aria.State\n */\nexport enum State {\n  // ARIA property for setting the currently active descendant of an element,\n  // for example the selected item in a list box. Value: ID of an element.\n  ACTIVEDESCENDANT = 'activedescendant',\n  // ARIA property defines the total number of columns in a table, grid, or\n  // treegrid.\n  // Value: integer.\n  COLCOUNT = 'colcount',\n  // ARIA state for a disabled item. Value: one of {true, false}.\n  DISABLED = 'disabled',\n\n  // ARIA state for setting whether the element like a tree node is expanded.\n  // Value: one of {true, false, undefined}.\n  EXPANDED = 'expanded',\n\n  // ARIA state indicating that the entered value does not conform. Value:\n  // one of {false, true, 'grammar', 'spelling'}\n  INVALID = 'invalid',\n\n  // ARIA property that provides a label to override any other text, value, or\n  // contents used to describe this element. Value: string.\n  LABEL = 'label',\n  // ARIA property for setting the element which labels another element.\n  // Value: space-separated IDs of elements.\n  LABELLEDBY = 'labelledby',\n\n  // ARIA property for setting the level of an element in the hierarchy.\n  // Value: integer.\n  LEVEL = 'level',\n  // ARIA property indicating if the element is horizontal or vertical.\n  // Value: one of {'vertical', 'horizontal'}.\n  ORIENTATION = 'orientation',\n\n  // ARIA property that defines an element's number of position in a list.\n  // Value: integer.\n  POSINSET = 'posinset',\n\n  // ARIA property defines the total number of rows in a table, grid, or\n  // treegrid.\n  // Value: integer.\n  ROWCOUNT = 'rowcount',\n\n  // ARIA state for setting the currently selected item in the list.\n  // Value: one of {true, false, undefined}.\n  SELECTED = 'selected',\n  // ARIA property defining the number of items in a list. Value: integer.\n  SETSIZE = 'setsize',\n\n  // ARIA property for slider maximum value. Value: number.\n  VALUEMAX = 'valuemax',\n\n  // ARIA property for slider minimum value. Value: number.\n  VALUEMIN = 'valuemin',\n}\n\n/**\n * Sets the role of an element.\n *\n * Similar to Closure's goog.a11y.aria\n *\n * @param element DOM node to set role of.\n * @param roleName Role name.\n */\nexport function setRole(element: Element, roleName: Role) {\n  element.setAttribute(ROLE_ATTRIBUTE, roleName);\n}\n\n/**\n * Sets the state or property of an element.\n * Copied from Closure's goog.a11y.aria\n *\n * @param element DOM node where we set state.\n * @param stateName State attribute being set.\n *     Automatically adds prefix 'aria-' to the state name if the attribute is\n * not an extra attribute.\n * @param value Value for the state attribute.\n */\nexport function setState(\n  element: Element,\n  stateName: State,\n  value: string | boolean | number | string[],\n) {\n  if (Array.isArray(value)) {\n    value = value.join(' ');\n  }\n  const attrStateName = ARIA_PREFIX + stateName;\n  element.setAttribute(attrStateName, `${value}`);\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport interface ISerializable {\n  /**\n   * @param doFullSerialization If true, this signals that any backing data\n   *     structures used by this ISerializable should also be serialized. This\n   *     is used for copy-paste.\n   * @returns a JSON serializable value that records the ISerializable's state.\n   */\n  saveState(doFullSerialization: boolean): any;\n\n  /**\n   * Takes in a JSON serializable value and sets the ISerializable's state\n   * based on that.\n   *\n   * @param state The state to apply to the ISerializable.\n   */\n  loadState(state: any): void;\n}\n\n/** Type guard that checks whether the given object is a ISerializable. */\nexport function isSerializable(obj: any): obj is ISerializable {\n  return obj.saveState !== undefined && obj.loadState !== undefined;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {BlockSvg} from './block_svg.js';\nimport * as eventUtils from './events/utils.js';\nimport * as userAgent from './utils/useragent.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/** The set of all blocks in need of rendering which don't have parents. */\nconst rootBlocks = new Set<BlockSvg>();\n\n/** The set of all blocks in need of rendering. */\nconst dirtyBlocks = new WeakSet<BlockSvg>();\n\n/** A map from queued blocks to the event group from when they were queued. */\nconst eventGroups = new WeakMap<BlockSvg, string>();\n\n/**\n * The promise which resolves after the current set of renders is completed. Or\n * null if there are no queued renders.\n *\n * Stored so that we can return it from afterQueuedRenders.\n */\nlet afterRendersPromise: Promise<void> | null = null;\n\n/** The function to call to resolve the `afterRendersPromise`. */\nlet afterRendersResolver: (() => void) | null = null;\n\n/**\n * The ID of the current animation frame request. Used to cancel the request\n * if necessary.\n */\nlet animationRequestId = 0;\n\n/**\n * Registers that the given block and all of its parents need to be rerendered,\n * and registers a callback to do so after a delay, to allowf or batching.\n *\n * @param block The block to rerender.\n * @returns A promise that resolves after the currently queued renders have been\n *     completed. Used for triggering other behavior that relies on updated\n *     size/position location for the block.\n * @internal\n */\nexport function queueRender(block: BlockSvg): Promise<void> {\n  queueBlock(block);\n\n  if (alwaysImmediatelyRender()) {\n    doRenders();\n    return Promise.resolve();\n  }\n\n  if (!afterRendersPromise) {\n    afterRendersPromise = new Promise((resolve) => {\n      afterRendersResolver = resolve;\n      animationRequestId = window.requestAnimationFrame(() => {\n        doRenders();\n        resolve();\n      });\n    });\n  }\n  return afterRendersPromise;\n}\n\n/**\n * @returns A promise that resolves after the currently queued renders have\n *     been completed.\n */\nexport function finishQueuedRenders(): Promise<void> {\n  // If there are no queued renders, return a resolved promise so `then`\n  // callbacks trigger immediately.\n  return afterRendersPromise ? afterRendersPromise : Promise.resolve();\n}\n\n/**\n * Triggers an immediate render of all queued renders. Should only be used in\n * cases where queueing renders breaks functionality + backwards compatibility\n * (such as rendering icons).\n *\n * @param workspace If provided, only rerender blocks in this workspace.\n *\n * @internal\n */\nexport function triggerQueuedRenders(workspace?: WorkspaceSvg) {\n  if (!workspace) window.cancelAnimationFrame(animationRequestId);\n  doRenders(workspace);\n  if (!workspace && afterRendersResolver) afterRendersResolver();\n}\n\n/**\n * @returns True if we should always trigger an immediate render.\n *     Some platforms don't properly support `requestAnimationFrame`, so to\n *     avoid glitchiness, we give up the performance improvements.\n */\nfunction alwaysImmediatelyRender() {\n  return userAgent.JavaFx;\n}\n\n/**\n * Adds the given block and its parents to the render queue. Adds the root block\n * to the list of root blocks.\n *\n * @param block The block to queue.\n */\nfunction queueBlock(block: BlockSvg) {\n  dirtyBlocks.add(block);\n  eventGroups.set(block, eventUtils.getGroup());\n  const parent = block.getParent();\n  if (parent) {\n    queueBlock(parent);\n  } else {\n    rootBlocks.add(block);\n  }\n}\n\n/**\n * Rerenders all of the blocks in the queue.\n *\n * @param workspace If provided, only rerender blocks in this workspace.\n */\nfunction doRenders(workspace?: WorkspaceSvg) {\n  const workspaces = workspace\n    ? new Set([workspace])\n    : new Set([...rootBlocks].map((block) => block.workspace));\n  const blocks = [...rootBlocks]\n    .filter(shouldRenderRootBlock)\n    .filter((b) => workspaces.has(b.workspace));\n  for (const block of blocks) {\n    renderBlock(block);\n  }\n  for (const workspace of workspaces) {\n    workspace.resizeContents();\n  }\n  for (const block of blocks) {\n    const blockOrigin = block.getRelativeToSurfaceXY();\n    block.updateComponentLocations(blockOrigin);\n  }\n  for (const block of blocks) {\n    const oldGroup = eventUtils.getGroup();\n    const newGroup = eventGroups.get(block);\n    if (newGroup) eventUtils.setGroup(newGroup);\n\n    block.bumpNeighbours();\n\n    eventUtils.setGroup(oldGroup);\n  }\n\n  for (const block of blocks) {\n    dequeueBlock(block);\n  }\n  if (!workspace) afterRendersPromise = null;\n}\n\n/** Removes the given block and children from the render queue. */\nfunction dequeueBlock(block: BlockSvg) {\n  rootBlocks.delete(block);\n  dirtyBlocks.delete(block);\n  eventGroups.delete(block);\n  for (const child of block.getChildren(false)) {\n    dequeueBlock(child);\n  }\n}\n\n/**\n * Returns true if the block should be rendered.\n *\n * No need to render dead blocks.\n *\n * No need to render blocks with parents. A render for the block may have been\n * queued, and the block was connected to a parent, so it is no longer a\n * root block. Rendering will be triggered through the real root block.\n */\nfunction shouldRenderRootBlock(block: BlockSvg): boolean {\n  return !block.isDisposed() && !block.getParent();\n}\n\n/**\n * Recursively renders all of the dirty children of the given block, and\n * then renders the block.\n *\n * @param block The block to rerender.\n */\nfunction renderBlock(block: BlockSvg) {\n  if (!dirtyBlocks.has(block)) return;\n  if (!block.initialized) return;\n  for (const child of block.getChildren(false)) {\n    renderBlock(child);\n  }\n  block.renderEfficiently();\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.dialog\n\nlet alertImplementation = function (\n  message: string,\n  opt_callback?: () => void,\n) {\n  window.alert(message);\n  if (opt_callback) {\n    opt_callback();\n  }\n};\n\nlet confirmImplementation = function (\n  message: string,\n  callback: (result: boolean) => void,\n) {\n  callback(window.confirm(message));\n};\n\nlet promptImplementation = function (\n  message: string,\n  defaultValue: string,\n  callback: (result: string | null) => void,\n) {\n  callback(window.prompt(message, defaultValue));\n};\n\n/**\n * Wrapper to window.alert() that app developers may override via setAlert to\n * provide alternatives to the modal browser window.\n *\n * @param message The message to display to the user.\n * @param opt_callback The callback when the alert is dismissed.\n */\nexport function alert(message: string, opt_callback?: () => void) {\n  alertImplementation(message, opt_callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.alert() is called.\n *\n * @param alertFunction The function to be run.\n * @see Blockly.dialog.alert\n */\nexport function setAlert(alertFunction: (p1: string, p2?: () => void) => void) {\n  alertImplementation = alertFunction;\n}\n\n/**\n * Wrapper to window.confirm() that app developers may override via setConfirm\n * to provide alternatives to the modal browser window.\n *\n * @param message The message to display to the user.\n * @param callback The callback for handling user response.\n */\nexport function confirm(message: string, callback: (p1: boolean) => void) {\n  TEST_ONLY.confirmInternal(message, callback);\n}\n\n/**\n * Private version of confirm for stubbing in tests.\n */\nfunction confirmInternal(message: string, callback: (p1: boolean) => void) {\n  confirmImplementation(message, callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.confirm() is called.\n *\n * @param confirmFunction The function to be run.\n * @see Blockly.dialog.confirm\n */\nexport function setConfirm(\n  confirmFunction: (p1: string, p2: (p1: boolean) => void) => void,\n) {\n  confirmImplementation = confirmFunction;\n}\n\n/**\n * Wrapper to window.prompt() that app developers may override via setPrompt to\n * provide alternatives to the modal browser window. Built-in browser prompts\n * are often used for better text input experience on mobile device. We strongly\n * recommend testing mobile when overriding this.\n *\n * @param message The message to display to the user.\n * @param defaultValue The value to initialize the prompt with.\n * @param callback The callback for handling user response.\n */\nexport function prompt(\n  message: string,\n  defaultValue: string,\n  callback: (p1: string | null) => void,\n) {\n  promptImplementation(message, defaultValue, callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.prompt() is called.\n *\n * @param promptFunction The function to be run.\n * @see Blockly.dialog.prompt\n */\nexport function setPrompt(\n  promptFunction: (\n    p1: string,\n    p2: string,\n    p3: (p1: string | null) => void,\n  ) => void,\n) {\n  promptImplementation = promptFunction;\n}\n\nexport const TEST_ONLY = {\n  confirmInternal,\n};\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Legacy means of representing a procedure signature. The elements are\n * respectively: name, parameter names, and whether it has a return value.\n */\nexport type ProcedureTuple = [string, string[], boolean];\n\n/**\n * Procedure block type.\n *\n * @internal\n */\nexport interface ProcedureBlock {\n  getProcedureCall: () => string;\n  renameProcedure: (p1: string, p2: string) => void;\n  getProcedureDef: () => ProcedureTuple;\n}\n\n/** @internal */\nexport interface LegacyProcedureDefBlock {\n  getProcedureDef: () => ProcedureTuple;\n}\n\n/** @internal */\nexport function isLegacyProcedureDefBlock(\n  block: object,\n): block is LegacyProcedureDefBlock {\n  return (block as any).getProcedureDef !== undefined;\n}\n\n/** @internal */\nexport interface LegacyProcedureCallBlock {\n  getProcedureCall: () => string;\n  renameProcedure: (p1: string, p2: string) => void;\n}\n\n/** @internal */\nexport function isLegacyProcedureCallBlock(\n  block: object,\n): block is LegacyProcedureCallBlock {\n  return (\n    (block as any).getProcedureCall !== undefined &&\n    (block as any).renameProcedure !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {VariableModel} from '../variable_model.js';\nimport {IParameterModel} from './i_parameter_model.js';\n\n/** Interface for a parameter model that holds a variable model. */\nexport interface IVariableBackedParameterModel extends IParameterModel {\n  /** Returns the variable model held by this type. */\n  getVariableModel(): VariableModel;\n}\n\n/**\n * Returns whether the given object is a variable holder or not.\n */\nexport function isVariableBackedParameterModel(\n  param: IParameterModel,\n): param is IVariableBackedParameterModel {\n  return (param as any).getVariableModel !== undefined;\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Variables\n\nimport {Blocks} from './blocks.js';\nimport * as dialog from './dialog.js';\nimport {isLegacyProcedureDefBlock} from './interfaces/i_legacy_procedure_blocks.js';\nimport {isVariableBackedParameterModel} from './interfaces/i_variable_backed_parameter_model.js';\nimport {Msg} from './msg.js';\nimport * as utilsXml from './utils/xml.js';\nimport {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n * See also Blockly.Procedures.CATEGORY_NAME and\n * Blockly.VariablesDynamic.CATEGORY_NAME.\n */\nexport const CATEGORY_NAME = 'VARIABLE';\n\n/**\n * Find all user-created variables that are in use in the workspace.\n * For use by generators.\n * To get a list of all variables on a workspace, including unused variables,\n * call Workspace.getAllVariables.\n *\n * @param ws The workspace to search for variables.\n * @returns Array of variable models.\n */\nexport function allUsedVarModels(ws: Workspace): VariableModel[] {\n  const blocks = ws.getAllBlocks(false);\n  const variables = new Set<VariableModel>();\n  // Iterate through every block and add each variable to the set.\n  for (let i = 0; i < blocks.length; i++) {\n    const blockVariables = blocks[i].getVarModels();\n    if (blockVariables) {\n      for (let j = 0; j < blockVariables.length; j++) {\n        const variable = blockVariables[j];\n        const id = variable.getId();\n        if (id) {\n          variables.add(variable);\n        }\n      }\n    }\n  }\n  // Convert the set into a list.\n  return Array.from(variables.values());\n}\n\n/**\n * Find all developer variables used by blocks in the workspace.\n * Developer variables are never shown to the user, but are declared as global\n * variables in the generated code.\n * To declare developer variables, define the getDeveloperVariables function on\n * your block and return a list of variable names.\n * For use by generators.\n *\n * @param workspace The workspace to search.\n * @returns A list of non-duplicated variable names.\n */\nexport function allDeveloperVariables(workspace: Workspace): string[] {\n  const blocks = workspace.getAllBlocks(false);\n  const variables = new Set<string>();\n  for (let i = 0, block; (block = blocks[i]); i++) {\n    const getDeveloperVariables = block.getDeveloperVariables;\n    if (getDeveloperVariables) {\n      const devVars = getDeveloperVariables();\n      for (let j = 0; j < devVars.length; j++) {\n        variables.add(devVars[j]);\n      }\n    }\n  }\n  // Convert the set into a list.\n  return Array.from(variables.values());\n}\n\n/**\n * Construct the elements (blocks and button) required by the flyout for the\n * variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML elements.\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  let xmlList = new Array<Element>();\n  const button = document.createElement('button');\n  button.setAttribute('text', '%{BKY_NEW_VARIABLE}');\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE');\n\n  workspace.registerButtonCallback('CREATE_VARIABLE', function (button) {\n    createVariableButtonHandler(button.getTargetWorkspace());\n  });\n\n  xmlList.push(button);\n\n  const blockList = flyoutCategoryBlocks(workspace);\n  xmlList = xmlList.concat(blockList);\n  return xmlList;\n}\n\n/**\n * Construct the blocks required by the flyout for the variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML block elements.\n */\nexport function flyoutCategoryBlocks(workspace: Workspace): Element[] {\n  const variableModelList = workspace.getVariablesOfType('');\n\n  const xmlList = [];\n  if (variableModelList.length > 0) {\n    // New variables are added to the end of the variableModelList.\n    const mostRecentVariable = variableModelList[variableModelList.length - 1];\n    if (Blocks['variables_set']) {\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', 'variables_set');\n      block.setAttribute('gap', Blocks['math_change'] ? '8' : '24');\n      block.appendChild(generateVariableFieldDom(mostRecentVariable));\n      xmlList.push(block);\n    }\n    if (Blocks['math_change']) {\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', 'math_change');\n      block.setAttribute('gap', Blocks['variables_get'] ? '20' : '8');\n      block.appendChild(generateVariableFieldDom(mostRecentVariable));\n      const value = utilsXml.textToDom(\n        '<value name=\"DELTA\">' +\n          '<shadow type=\"math_number\">' +\n          '<field name=\"NUM\">1</field>' +\n          '</shadow>' +\n          '</value>',\n      );\n      block.appendChild(value);\n      xmlList.push(block);\n    }\n\n    if (Blocks['variables_get']) {\n      variableModelList.sort(VariableModel.compareByName);\n      for (let i = 0, variable; (variable = variableModelList[i]); i++) {\n        const block = utilsXml.createElement('block');\n        block.setAttribute('type', 'variables_get');\n        block.setAttribute('gap', '8');\n        block.appendChild(generateVariableFieldDom(variable));\n        xmlList.push(block);\n      }\n    }\n  }\n  return xmlList;\n}\n\nexport const VAR_LETTER_OPTIONS = 'ijkmnopqrstuvwxyzabcdefgh';\n\n/**\n * Return a new variable name that is not yet being used. This will try to\n * generate single letter variable names in the range 'i' to 'z' to start with.\n * If no unique name is located it will try 'i' to 'z', 'a' to 'h',\n * then 'i2' to 'z2' etc.  Skip 'l'.\n *\n * @param workspace The workspace to be unique in.\n * @returns New variable name.\n */\nexport function generateUniqueName(workspace: Workspace): string {\n  return TEST_ONLY.generateUniqueNameInternal(workspace);\n}\n\n/**\n * Private version of generateUniqueName for stubbing in tests.\n */\nfunction generateUniqueNameInternal(workspace: Workspace): string {\n  return generateUniqueNameFromOptions(\n    VAR_LETTER_OPTIONS.charAt(0),\n    workspace.getAllVariableNames(),\n  );\n}\n\n/**\n * Returns a unique name that is not present in the usedNames array. This\n * will try to generate single letter names in the range a - z (skip l). It\n * will start with the character passed to startChar.\n *\n * @param startChar The character to start the search at.\n * @param usedNames A list of all of the used names.\n * @returns A unique name that is not present in the usedNames array.\n */\nexport function generateUniqueNameFromOptions(\n  startChar: string,\n  usedNames: string[],\n): string {\n  if (!usedNames.length) {\n    return startChar;\n  }\n\n  const letters = VAR_LETTER_OPTIONS;\n  let suffix = '';\n  let letterIndex = letters.indexOf(startChar);\n  let potName = startChar;\n\n  while (true) {\n    let inUse = false;\n    for (let i = 0; i < usedNames.length; i++) {\n      if (usedNames[i].toLowerCase() === potName) {\n        inUse = true;\n        break;\n      }\n    }\n    if (!inUse) {\n      break;\n    }\n\n    letterIndex++;\n    if (letterIndex === letters.length) {\n      // Reached the end of the character sequence so back to 'i'.\n      letterIndex = 0;\n      suffix = `${Number(suffix) + 1}`;\n    }\n    potName = letters.charAt(letterIndex) + suffix;\n  }\n  return potName;\n}\n\n/**\n * Handles \"Create Variable\" button in the default variables toolbox category.\n * It will prompt the user for a variable name, including re-prompts if a name\n * is already in use among the workspace's variables.\n *\n * Custom button handlers can delegate to this function, allowing variables\n * types and after-creation processing. More complex customization (e.g.,\n * prompting for variable type) is beyond the scope of this function.\n *\n * @param workspace The workspace on which to create the variable.\n * @param opt_callback A callback. It will be passed an acceptable new variable\n *     name, or null if change is to be aborted (cancel button), or undefined if\n *     an existing variable was chosen.\n * @param opt_type The type of the variable like 'int', 'string', or ''. This\n *     will default to '', which is a specific type.\n */\nexport function createVariableButtonHandler(\n  workspace: Workspace,\n  opt_callback?: (p1?: string | null) => void,\n  opt_type?: string,\n) {\n  const type = opt_type || '';\n  // This function needs to be named so it can be called recursively.\n  function promptAndCheckWithAlert(defaultName: string) {\n    promptName(Msg['NEW_VARIABLE_TITLE'], defaultName, function (text) {\n      if (!text) {\n        // User canceled prompt.\n        if (opt_callback) opt_callback(null);\n        return;\n      }\n\n      const existing = nameUsedWithAnyType(text, workspace);\n      if (!existing) {\n        // No conflict\n        workspace.createVariable(text, type);\n        if (opt_callback) opt_callback(text);\n        return;\n      }\n\n      let msg;\n      if (existing.type === type) {\n        msg = Msg['VARIABLE_ALREADY_EXISTS'].replace('%1', existing.name);\n      } else {\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE'];\n        msg = msg.replace('%1', existing.name).replace('%2', existing.type);\n      }\n      dialog.alert(msg, function () {\n        promptAndCheckWithAlert(text);\n      });\n    });\n  }\n  promptAndCheckWithAlert('');\n}\n\n/**\n * Opens a prompt that allows the user to enter a new name for a variable.\n * Triggers a rename if the new name is valid. Or re-prompts if there is a\n * collision.\n *\n * @param workspace The workspace on which to rename the variable.\n * @param variable Variable to rename.\n * @param opt_callback A callback. It will be passed an acceptable new variable\n *     name, or null if change is to be aborted (cancel button), or undefined if\n *     an existing variable was chosen.\n */\nexport function renameVariable(\n  workspace: Workspace,\n  variable: VariableModel,\n  opt_callback?: (p1?: string | null) => void,\n) {\n  // This function needs to be named so it can be called recursively.\n  function promptAndCheckWithAlert(defaultName: string) {\n    const promptText = Msg['RENAME_VARIABLE_TITLE'].replace(\n      '%1',\n      variable.name,\n    );\n    promptName(promptText, defaultName, function (newName) {\n      if (!newName) {\n        // User canceled prompt.\n        if (opt_callback) opt_callback(null);\n        return;\n      }\n\n      const existing = nameUsedWithOtherType(newName, variable.type, workspace);\n      const procedure = nameUsedWithConflictingParam(\n        variable.name,\n        newName,\n        workspace,\n      );\n      if (!existing && !procedure) {\n        // No conflict.\n        workspace.renameVariableById(variable.getId(), newName);\n        if (opt_callback) opt_callback(newName);\n        return;\n      }\n\n      let msg = '';\n      if (existing) {\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE']\n          .replace('%1', existing.name)\n          .replace('%2', existing.type);\n      } else if (procedure) {\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER']\n          .replace('%1', newName)\n          .replace('%2', procedure);\n      }\n      dialog.alert(msg, function () {\n        promptAndCheckWithAlert(newName);\n      });\n    });\n  }\n  promptAndCheckWithAlert('');\n}\n\n/**\n * Prompt the user for a new variable name.\n *\n * @param promptText The string of the prompt.\n * @param defaultText The default value to show in the prompt's field.\n * @param callback A callback. It will be passed the new variable name, or null\n *     if the user picked something illegal.\n */\nexport function promptName(\n  promptText: string,\n  defaultText: string,\n  callback: (p1: string | null) => void,\n) {\n  dialog.prompt(promptText, defaultText, function (newVar) {\n    // Merge runs of whitespace.  Strip leading and trailing whitespace.\n    // Beyond this, all names are legal.\n    if (newVar) {\n      newVar = newVar.replace(/[\\s\\xa0]+/g, ' ').trim();\n      if (newVar === Msg['RENAME_VARIABLE'] || newVar === Msg['NEW_VARIABLE']) {\n        // Ok, not ALL names are legal...\n        newVar = null;\n      }\n    }\n    callback(newVar);\n  });\n}\n/**\n * Check whether there exists a variable with the given name but a different\n * type.\n *\n * @param name The name to search for.\n * @param type The type to exclude from the search.\n * @param workspace The workspace to search for the variable.\n * @returns The variable with the given name and a different type, or null if\n *     none was found.\n */\nfunction nameUsedWithOtherType(\n  name: string,\n  type: string,\n  workspace: Workspace,\n): VariableModel | null {\n  const allVariables = workspace.getVariableMap().getAllVariables();\n\n  name = name.toLowerCase();\n  for (let i = 0, variable; (variable = allVariables[i]); i++) {\n    if (variable.name.toLowerCase() === name && variable.type !== type) {\n      return variable;\n    }\n  }\n  return null;\n}\n\n/**\n * Check whether there exists a variable with the given name of any type.\n *\n * @param name The name to search for.\n * @param workspace The workspace to search for the variable.\n * @returns The variable with the given name, or null if none was found.\n */\nexport function nameUsedWithAnyType(\n  name: string,\n  workspace: Workspace,\n): VariableModel | null {\n  const allVariables = workspace.getVariableMap().getAllVariables();\n\n  name = name.toLowerCase();\n  for (let i = 0, variable; (variable = allVariables[i]); i++) {\n    if (variable.name.toLowerCase() === name) {\n      return variable;\n    }\n  }\n  return null;\n}\n\n/**\n * Returns the name of the procedure with a conflicting parameter name, or null\n * if one does not exist.\n *\n * This checks the procedure map if it contains models, and the legacy procedure\n * blocks otherwise.\n *\n * @param oldName The old name of the variable.\n * @param newName The proposed name of the variable.\n * @param workspace The workspace to search for conflicting parameters.\n * @internal\n */\nexport function nameUsedWithConflictingParam(\n  oldName: string,\n  newName: string,\n  workspace: Workspace,\n): string | null {\n  return workspace.getProcedureMap().getProcedures().length\n    ? checkForConflictingParamWithProcedureModels(oldName, newName, workspace)\n    : checkForConflictingParamWithLegacyProcedures(oldName, newName, workspace);\n}\n\n/**\n * Returns the name of the procedure model with a conflicting param name, or\n * null if one does not exist.\n */\nfunction checkForConflictingParamWithProcedureModels(\n  oldName: string,\n  newName: string,\n  workspace: Workspace,\n): string | null {\n  oldName = oldName.toLowerCase();\n  newName = newName.toLowerCase();\n\n  const procedures = workspace.getProcedureMap().getProcedures();\n  for (const procedure of procedures) {\n    const params = procedure\n      .getParameters()\n      .filter(isVariableBackedParameterModel)\n      .map((param) => param.getVariableModel().name);\n    if (!params) continue;\n    const procHasOld = params.some((param) => param.toLowerCase() === oldName);\n    const procHasNew = params.some((param) => param.toLowerCase() === newName);\n    if (procHasOld && procHasNew) return procedure.getName();\n  }\n  return null;\n}\n\n/**\n * Returns the name of the procedure block with a conflicting param name, or\n * null if one does not exist.\n */\nfunction checkForConflictingParamWithLegacyProcedures(\n  oldName: string,\n  newName: string,\n  workspace: Workspace,\n): string | null {\n  oldName = oldName.toLowerCase();\n  newName = newName.toLowerCase();\n\n  const blocks = workspace.getAllBlocks(false);\n  for (const block of blocks) {\n    if (!isLegacyProcedureDefBlock(block)) continue;\n    const def = block.getProcedureDef();\n    const params = def[1];\n    const blockHasOld = params.some((param) => param.toLowerCase() === oldName);\n    const blockHasNew = params.some((param) => param.toLowerCase() === newName);\n    if (blockHasOld && blockHasNew) return def[0];\n  }\n  return null;\n}\n\n/**\n * Generate DOM objects representing a variable field.\n *\n * @param variableModel The variable model to represent.\n * @returns The generated DOM.\n */\nexport function generateVariableFieldDom(\n  variableModel: VariableModel,\n): Element {\n  /* Generates the following XML:\n   * <field name=\"VAR\" id=\"goKTKmYJ8DhVHpruv\" variabletype=\"int\">foo</field>\n   */\n  const field = utilsXml.createElement('field');\n  field.setAttribute('name', 'VAR');\n  field.setAttribute('id', variableModel.getId());\n  field.setAttribute('variabletype', variableModel.type);\n  const name = utilsXml.createTextNode(variableModel.name);\n  field.appendChild(name);\n  return field;\n}\n\n/**\n * Helper function to look up or create a variable on the given workspace.\n * If no variable exists, creates and returns it.\n *\n * @param workspace The workspace to search for the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to look up or create the variable, or null.\n * @param opt_name The string to use to look up or create the variable.\n * @param opt_type The type to use to look up or create the variable.\n * @returns The variable corresponding to the given ID or name + type\n *     combination.\n */\nexport function getOrCreateVariablePackage(\n  workspace: Workspace,\n  id: string | null,\n  opt_name?: string,\n  opt_type?: string,\n): VariableModel {\n  let variable = getVariable(workspace, id, opt_name, opt_type);\n  if (!variable) {\n    variable = createVariable(workspace, id, opt_name, opt_type);\n  }\n  return variable;\n}\n\n/**\n * Look up  a variable on the given workspace.\n * Always looks in the main workspace before looking in the flyout workspace.\n * Always prefers lookup by ID to lookup by name + type.\n *\n * @param workspace The workspace to search for the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to look up the variable, or null.\n * @param opt_name The string to use to look up the variable.\n *     Only used if lookup by ID fails.\n * @param opt_type The type to use to look up the variable.\n *     Only used if lookup by ID fails.\n * @returns The variable corresponding to the given ID or name + type\n *     combination, or null if not found.\n */\nexport function getVariable(\n  workspace: Workspace,\n  id: string | null,\n  opt_name?: string,\n  opt_type?: string,\n): VariableModel | null {\n  const potentialVariableMap = workspace.getPotentialVariableMap();\n  let variable = null;\n  // Try to just get the variable, by ID if possible.\n  if (id) {\n    // Look in the real variable map before checking the potential variable map.\n    variable = workspace.getVariableById(id);\n    if (!variable && potentialVariableMap) {\n      variable = potentialVariableMap.getVariableById(id);\n    }\n    if (variable) {\n      return variable;\n    }\n  }\n  // If there was no ID, or there was an ID but it didn't match any variables,\n  // look up by name and type.\n  if (opt_name) {\n    if (opt_type === undefined) {\n      throw Error('Tried to look up a variable by name without a type');\n    }\n    // Otherwise look up by name and type.\n    variable = workspace.getVariable(opt_name, opt_type);\n    if (!variable && potentialVariableMap) {\n      variable = potentialVariableMap.getVariable(opt_name, opt_type);\n    }\n  }\n  return variable;\n}\n\n/**\n * Helper function to create a variable on the given workspace.\n *\n * @param workspace The workspace in which to create the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to create the variable, or null.\n * @param opt_name The string to use to create the variable.\n * @param opt_type The type to use to create the variable.\n * @returns The variable corresponding to the given ID or name + type\n *     combination.\n */\nfunction createVariable(\n  workspace: Workspace,\n  id: string | null,\n  opt_name?: string,\n  opt_type?: string,\n): VariableModel {\n  const potentialVariableMap = workspace.getPotentialVariableMap();\n  // Variables without names get uniquely named for this workspace.\n  if (!opt_name) {\n    const ws = workspace.isFlyout\n      ? (workspace as WorkspaceSvg).targetWorkspace\n      : workspace;\n    opt_name = generateUniqueName(ws!);\n  }\n\n  // Create a potential variable if in the flyout.\n  let variable = null;\n  if (potentialVariableMap) {\n    variable = potentialVariableMap.createVariable(opt_name, opt_type, id);\n  } else {\n    // In the main workspace, create a real variable.\n    variable = workspace.createVariable(opt_name, opt_type, id);\n  }\n  return variable;\n}\n\n/**\n * Helper function to get the list of variables that have been added to the\n * workspace after adding a new block, using the given list of variables that\n * were in the workspace before the new block was added.\n *\n * @param workspace The workspace to inspect.\n * @param originalVariables The array of variables that existed in the workspace\n *     before adding the new block.\n * @returns The new array of variables that were freshly added to the workspace\n *     after creating the new block, or [] if no new variables were added to the\n *     workspace.\n * @internal\n */\nexport function getAddedVariables(\n  workspace: Workspace,\n  originalVariables: VariableModel[],\n): VariableModel[] {\n  const allCurrentVariables = workspace.getAllVariables();\n  const addedVariables = [];\n  if (originalVariables.length !== allCurrentVariables.length) {\n    for (let i = 0; i < allCurrentVariables.length; i++) {\n      const variable = allCurrentVariables[i];\n      // For any variable that is present in allCurrentVariables but not\n      // present in originalVariables, add the variable to addedVariables.\n      if (!originalVariables.includes(variable)) {\n        addedVariables.push(variable);\n      }\n    }\n  }\n  return addedVariables;\n}\n\nexport const TEST_ONLY = {\n  generateUniqueNameInternal,\n};\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.blocks\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport type {Connection} from '../connection.js';\nimport {MANUALLY_DISABLED} from '../constants.js';\nimport {EventType} from '../events/type.js';\nimport * as eventUtils from '../events/utils.js';\nimport {inputTypes} from '../inputs/input_types.js';\nimport {isSerializable} from '../interfaces/i_serializable.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\nimport * as renderManagement from '../render_management.js';\nimport * as utilsXml from '../utils/xml.js';\nimport {VariableModel} from '../variable_model.js';\nimport * as Variables from '../variables.js';\nimport type {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\nimport {\n  BadConnectionCheck,\n  MissingBlockType,\n  MissingConnection,\n  RealChildOfShadow,\n  UnregisteredIcon,\n} from './exceptions.js';\nimport * as priorities from './priorities.js';\nimport * as serializationRegistry from './registry.js';\n\n/**\n * Represents the state of a connection.\n */\nexport interface ConnectionState {\n  shadow?: State;\n  block?: State;\n}\n\n/**\n * Represents the state of a given block.\n */\nexport interface State {\n  type: string;\n  id?: string;\n  x?: number;\n  y?: number;\n  collapsed?: boolean;\n  deletable?: boolean;\n  movable?: boolean;\n  editable?: boolean;\n  enabled?: boolean;\n  disabledReasons?: string[];\n  inline?: boolean;\n  data?: string;\n  extraState?: AnyDuringMigration;\n  icons?: {[key: string]: AnyDuringMigration};\n  fields?: {[key: string]: AnyDuringMigration};\n  inputs?: {[key: string]: ConnectionState};\n  next?: ConnectionState;\n}\n\n/**\n * Returns the state of the given block as a plain JavaScript object.\n *\n * @param block The block to serialize.\n * @param param1 addCoordinates: If true, the coordinates of the block are added\n *     to the serialized state. False by default. addinputBlocks: If true,\n *     children of the block which are connected to inputs will be serialized.\n *     True by default. addNextBlocks: If true, children of the block which are\n *     connected to the block's next connection (if it exists) will be\n *     serialized. True by default. doFullSerialization: If true, fields that\n *     normally just save a reference to some external state (eg variables) will\n *     instead serialize all of the info about that state. This supports\n *     deserializing the block into a workspace where that state doesn't yet\n *     exist. True by default.\n * @returns The serialized state of the block, or null if the block could not be\n *     serialied (eg it was an insertion marker).\n */\nexport function save(\n  block: Block,\n  {\n    addCoordinates = false,\n    addInputBlocks = true,\n    addNextBlocks = true,\n    doFullSerialization = true,\n    saveIds = true,\n  }: {\n    addCoordinates?: boolean;\n    addInputBlocks?: boolean;\n    addNextBlocks?: boolean;\n    doFullSerialization?: boolean;\n    saveIds?: boolean;\n  } = {},\n): State | null {\n  if (block.isInsertionMarker()) {\n    return null;\n  }\n  const state = {\n    'type': block.type,\n    'id': saveIds ? block.id : undefined,\n  };\n\n  if (addCoordinates) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveCoords(block, state as AnyDuringMigration);\n  }\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveAttributes(block, state as AnyDuringMigration);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveExtraState(block, state as AnyDuringMigration, doFullSerialization);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveIcons(block, state as AnyDuringMigration, doFullSerialization);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveFields(block, state as AnyDuringMigration, doFullSerialization);\n  if (addInputBlocks) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveInputBlocks(\n      block,\n      state as AnyDuringMigration,\n      doFullSerialization,\n      saveIds,\n    );\n  }\n  if (addNextBlocks) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveNextBlocks(\n      block,\n      state as AnyDuringMigration,\n      doFullSerialization,\n      saveIds,\n    );\n  }\n\n  // AnyDuringMigration because:  Type '{ type: string; id: string; }' is not\n  // assignable to type 'State'.\n  return state as AnyDuringMigration;\n}\n\n/**\n * Adds attributes to the given state object based on the state of the block.\n * Eg collapsed, disabled, inline, etc.\n *\n * @param block The block to base the attributes on.\n * @param state The state object to append to.\n */\nfunction saveAttributes(block: Block, state: State) {\n  if (block.isCollapsed()) {\n    state['collapsed'] = true;\n  }\n  if (!block.isEnabled()) {\n    state['disabledReasons'] = Array.from(block.getDisabledReasons());\n  }\n  if (!block.isOwnDeletable()) {\n    state['deletable'] = false;\n  }\n  if (!block.isOwnMovable()) {\n    state['movable'] = false;\n  }\n  if (!block.isOwnEditable()) {\n    state['editable'] = false;\n  }\n  if (\n    block.inputsInline !== undefined &&\n    block.inputsInline !== block.inputsInlineDefault\n  ) {\n    state['inline'] = block.inputsInline;\n  }\n  // Data is a nullable string, so we don't need to worry about falsy values.\n  if (block.data) {\n    state['data'] = block.data;\n  }\n}\n\n/**\n * Adds the coordinates of the given block to the given state object.\n *\n * @param block The block to base the coordinates on.\n * @param state The state object to append to.\n */\nfunction saveCoords(block: Block, state: State) {\n  const workspace = block.workspace;\n  const xy = block.getRelativeToSurfaceXY();\n  state['x'] = Math.round(workspace.RTL ? workspace.getWidth() - xy.x : xy.x);\n  state['y'] = Math.round(xy.y);\n}\n\n/**\n * Adds any extra state the block may provide to the given state object.\n *\n * @param block The block to serialize the extra state of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to serialize the full state of the\n *     extra state (rather than possibly saving a reference to some state).\n */\nfunction saveExtraState(\n  block: Block,\n  state: State,\n  doFullSerialization: boolean,\n) {\n  if (block.saveExtraState) {\n    const extraState = block.saveExtraState(doFullSerialization);\n    if (extraState !== null) {\n      state['extraState'] = extraState;\n    }\n  } else if (block.mutationToDom) {\n    const extraState = block.mutationToDom();\n    if (extraState !== null) {\n      state['extraState'] = Xml.domToText(extraState).replace(\n        ' xmlns=\"https://developers.google.com/blockly/xml\"',\n        '',\n      );\n    }\n  }\n}\n\n/**\n * Adds the state of all of the icons on the block to the given state object.\n *\n * @param block The block to serialize the icon state of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to serialize the full state of the\n *     icon (rather than possibly saving a reference to some state).\n */\nfunction saveIcons(block: Block, state: State, doFullSerialization: boolean) {\n  const icons = Object.create(null);\n  for (const icon of block.getIcons()) {\n    if (isSerializable(icon)) {\n      const state = icon.saveState(doFullSerialization);\n      if (state) icons[icon.getType().toString()] = state;\n    }\n  }\n\n  if (Object.keys(icons).length) {\n    state['icons'] = icons;\n  }\n}\n\n/**\n * Adds the state of all of the fields on the block to the given state object.\n *\n * @param block The block to serialize the field state of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to serialize the full state of the\n *     field (rather than possibly saving a reference to some state).\n */\nfunction saveFields(block: Block, state: State, doFullSerialization: boolean) {\n  const fields = Object.create(null);\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    for (let j = 0; j < input.fieldRow.length; j++) {\n      const field = input.fieldRow[j];\n      if (field.isSerializable()) {\n        fields[field.name!] = field.saveState(doFullSerialization);\n      }\n    }\n  }\n  if (Object.keys(fields).length) {\n    state['fields'] = fields;\n  }\n}\n\n/**\n * Adds the state of all of the child blocks of the given block (which are\n * connected to inputs) to the given state object.\n *\n * @param block The block to serialize the input blocks of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveInputBlocks(\n  block: Block,\n  state: State,\n  doFullSerialization: boolean,\n  saveIds: boolean,\n) {\n  const inputs = Object.create(null);\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    if (!input.connection) continue;\n    const connectionState = saveConnection(\n      input.connection as Connection,\n      doFullSerialization,\n      saveIds,\n    );\n    if (connectionState) {\n      inputs[input.name] = connectionState;\n    }\n  }\n\n  if (Object.keys(inputs).length) {\n    state['inputs'] = inputs;\n  }\n}\n\n/**\n * Adds the state of all of the next blocks of the given block to the given\n * state object.\n *\n * @param block The block to serialize the next blocks of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveNextBlocks(\n  block: Block,\n  state: State,\n  doFullSerialization: boolean,\n  saveIds: boolean,\n) {\n  if (!block.nextConnection) {\n    return;\n  }\n  const connectionState = saveConnection(\n    block.nextConnection,\n    doFullSerialization,\n    saveIds,\n  );\n  if (connectionState) {\n    state['next'] = connectionState;\n  }\n}\n\n/**\n * Returns the state of the given connection (ie the state of any connected\n * shadow or real blocks).\n *\n * @param connection The connection to serialize the connected blocks of.\n * @returns An object containing the state of any connected shadow block, or any\n *     connected real block.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveConnection(\n  connection: Connection,\n  doFullSerialization: boolean,\n  saveIds: boolean,\n): ConnectionState | null {\n  const shadow = connection.getShadowState(true);\n  const child = connection.targetBlock();\n  if (!shadow && !child) {\n    return null;\n  }\n  const state = Object.create(null);\n  if (shadow) {\n    state['shadow'] = shadow;\n  }\n  if (child && !child.isShadow()) {\n    state['block'] = save(child, {doFullSerialization, saveIds});\n  }\n  return state;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 recordUndo: If true, events triggered by this function will be\n *     undo-able by the user. False by default.\n * @returns The block that was just loaded.\n */\nexport function append(\n  state: State,\n  workspace: Workspace,\n  {recordUndo = false}: {recordUndo?: boolean} = {},\n): Block {\n  const block = appendInternal(state, workspace, {recordUndo});\n  if (workspace.rendered) renderManagement.triggerQueuedRenders();\n  return block;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n * This is defined internally so that the extra parameters don't clutter our\n * external API.\n * But it is exported so that other places within Blockly can call it directly\n * with the extra parameters.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 parentConnection: If provided, the system will attempt to\n *     connect the block to this connection after it is created. Undefined by\n *     default. isShadow: If true, the block will be set to a shadow block after\n *     it is created. False by default. recordUndo: If true, events triggered by\n *     this function will be undo-able by the user. False by default.\n * @returns The block that was just appended.\n * @internal\n */\nexport function appendInternal(\n  state: State,\n  workspace: Workspace,\n  {\n    parentConnection = undefined,\n    isShadow = false,\n    recordUndo = false,\n  }: {\n    parentConnection?: Connection;\n    isShadow?: boolean;\n    recordUndo?: boolean;\n  } = {},\n): Block {\n  const prevRecordUndo = eventUtils.getRecordUndo();\n  eventUtils.setRecordUndo(recordUndo);\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n  eventUtils.disable();\n\n  const variablesBeforeCreation = workspace.getAllVariables();\n  let block;\n  try {\n    block = appendPrivate(state, workspace, {parentConnection, isShadow});\n  } finally {\n    eventUtils.enable();\n  }\n\n  // Fire a VarCreate event for each (if any) new variable created.\n  checkNewVariables(workspace, variablesBeforeCreation);\n\n  if (eventUtils.isEnabled()) {\n    // Block events come after var events, in case they refer to newly created\n    // variables.\n    eventUtils.fire(new (eventUtils.get(EventType.BLOCK_CREATE))(block));\n  }\n  eventUtils.setGroup(existingGroup);\n  eventUtils.setRecordUndo(prevRecordUndo);\n\n  // Adding connections to the connection db is expensive. This defers that\n  // operation to decrease load time.\n  if (workspace.rendered) {\n    const blockSvg = block as BlockSvg;\n    setTimeout(() => {\n      if (!blockSvg.disposed) {\n        blockSvg.setConnectionTracking(true);\n      }\n    }, 1);\n  }\n\n  return block;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n * This is defined privately so that it can be called recursively without firing\n * eroneous events. Events (and other things we only want to occur on the top\n * block) are handled by appendInternal.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 parentConnection: If provided, the system will attempt to\n *     connect the block to this connection after it is created. Undefined by\n *     default. isShadow: The block will be set to a shadow block after it is\n *     created. False by default.\n * @returns The block that was just appended.\n */\nfunction appendPrivate(\n  state: State,\n  workspace: Workspace,\n  {\n    parentConnection = undefined,\n    isShadow = false,\n  }: {parentConnection?: Connection; isShadow?: boolean} = {},\n): Block {\n  if (!state['type']) {\n    throw new MissingBlockType(state);\n  }\n\n  const block = workspace.newBlock(state['type'], state['id']);\n  block.setShadow(isShadow);\n  loadCoords(block, state);\n  loadAttributes(block, state);\n  loadExtraState(block, state);\n  tryToConnectParent(parentConnection, block, state);\n  loadIcons(block, state);\n  loadFields(block, state);\n  loadInputBlocks(block, state);\n  loadNextBlocks(block, state);\n  initBlock(block, workspace.rendered);\n\n  return block;\n}\n\n/**\n * Checks the workspace for any new variables that were created during the\n * deserialization of a block and fires a VarCreate event for each.\n *\n * @param workspace The workspace where new variables are being created\n * @param originalVariables The array of variables that existed in the workspace\n *     before adding the new block.\n */\nfunction checkNewVariables(\n  workspace: Workspace,\n  originalVariables: VariableModel[],\n) {\n  if (eventUtils.isEnabled()) {\n    const newVariables = Variables.getAddedVariables(\n      workspace,\n      originalVariables,\n    );\n    // Fire a VarCreate event for each (if any) new variable created.\n    for (let i = 0; i < newVariables.length; i++) {\n      const thisVariable = newVariables[i];\n      eventUtils.fire(new (eventUtils.get(EventType.VAR_CREATE))(thisVariable));\n    }\n  }\n}\n\n/**\n * Applies any coordinate information available on the state object to the\n * block.\n *\n * @param block The block to set the position of.\n * @param state The state object to reference.\n */\nfunction loadCoords(block: Block, state: State) {\n  let x = state['x'] === undefined ? 0 : state['x'];\n  const y = state['y'] === undefined ? 0 : state['y'];\n\n  const workspace = block.workspace;\n  x = workspace.RTL ? workspace.getWidth() - x : x;\n\n  block.moveBy(x, y);\n}\n\n/**\n * Applies any attribute information available on the state object to the block.\n *\n * @param block The block to set the attributes of.\n * @param state The state object to reference.\n */\nfunction loadAttributes(block: Block, state: State) {\n  if (state['collapsed']) {\n    block.setCollapsed(true);\n  }\n  if (state['deletable'] === false) {\n    block.setDeletable(false);\n  }\n  if (state['movable'] === false) {\n    block.setMovable(false);\n  }\n  if (state['editable'] === false) {\n    block.setEditable(false);\n  }\n  if (state['enabled'] === false) {\n    // Before May 2024 we just used 'enabled', with no reasons.\n    // Contiune to support this syntax.\n    block.setDisabledReason(true, MANUALLY_DISABLED);\n  }\n  if (Array.isArray(state['disabledReasons'])) {\n    for (const reason of state['disabledReasons']) {\n      block.setDisabledReason(true, reason);\n    }\n  }\n  if (state['inline'] !== undefined) {\n    block.setInputsInline(state['inline']);\n  }\n  if (state['data'] !== undefined) {\n    block.data = state['data'];\n  }\n}\n\n/**\n * Applies any extra state information available on the state object to the\n * block.\n *\n * @param block The block to set the extra state of.\n * @param state The state object to reference.\n */\nfunction loadExtraState(block: Block, state: State) {\n  if (!state['extraState']) {\n    return;\n  }\n  if (block.loadExtraState) {\n    block.loadExtraState(state['extraState']);\n  } else if (block.domToMutation) {\n    block.domToMutation(utilsXml.textToDom(state['extraState']));\n  }\n}\n\n/**\n * Attempts to connect the block to the parent connection, if it exists.\n *\n * @param parentConnection The parent connection to try to connect the block to.\n * @param child The block to try to connect to the parent.\n * @param state The state which defines the given block\n */\nfunction tryToConnectParent(\n  parentConnection: Connection | undefined,\n  child: Block,\n  state: State,\n) {\n  if (!parentConnection) {\n    return;\n  }\n\n  if (parentConnection.getSourceBlock().isShadow() && !child.isShadow()) {\n    throw new RealChildOfShadow(state);\n  }\n\n  let connected = false;\n  let childConnection;\n  if (parentConnection.type === inputTypes.VALUE) {\n    childConnection = child.outputConnection;\n    if (!childConnection) {\n      throw new MissingConnection('output', child, state);\n    }\n    connected = parentConnection.connect(childConnection);\n  } else {\n    // Statement type.\n    childConnection = child.previousConnection;\n    if (!childConnection) {\n      throw new MissingConnection('previous', child, state);\n    }\n    connected = parentConnection.connect(childConnection);\n  }\n\n  if (!connected) {\n    const checker = child.workspace.connectionChecker;\n    throw new BadConnectionCheck(\n      checker.getErrorMessage(\n        checker.canConnectWithReason(childConnection, parentConnection, false),\n        childConnection,\n        parentConnection,\n      ),\n      parentConnection.type === inputTypes.VALUE\n        ? 'output connection'\n        : 'previous connection',\n      child,\n      state,\n    );\n  }\n}\n\n/**\n * Applies icon state to the icons on the block, based on the given state\n * object.\n *\n * @param block The block to set the icon state of.\n * @param state The state object to reference.\n */\nfunction loadIcons(block: Block, state: State) {\n  if (!state['icons']) return;\n\n  const iconTypes = Object.keys(state['icons']);\n  for (const iconType of iconTypes) {\n    const iconState = state['icons'][iconType];\n    let icon = block.getIcon(iconType);\n    if (!icon) {\n      const constructor = registry.getClass(\n        registry.Type.ICON,\n        iconType,\n        false,\n      );\n      if (!constructor) throw new UnregisteredIcon(iconType, block, state);\n      icon = new constructor(block);\n      block.addIcon(icon);\n    }\n    if (isSerializable(icon)) icon.loadState(iconState);\n  }\n}\n\n/**\n * Applies any field information available on the state object to the block.\n *\n * @param block The block to set the field state of.\n * @param state The state object to reference.\n */\nfunction loadFields(block: Block, state: State) {\n  if (!state['fields']) {\n    return;\n  }\n  const keys = Object.keys(state['fields']);\n  for (let i = 0; i < keys.length; i++) {\n    const fieldName = keys[i];\n    const fieldState = state['fields'][fieldName];\n    const field = block.getField(fieldName);\n    if (!field) {\n      console.warn(\n        `Ignoring non-existant field ${fieldName} in block ${block.type}`,\n      );\n      continue;\n    }\n    field.loadState(fieldState);\n  }\n}\n\n/**\n * Creates any child blocks (attached to inputs) defined by the given state\n * and attaches them to the given block.\n *\n * @param block The block to attach input blocks to.\n * @param state The state object to reference.\n */\nfunction loadInputBlocks(block: Block, state: State) {\n  if (!state['inputs']) {\n    return;\n  }\n  const keys = Object.keys(state['inputs']);\n  for (let i = 0; i < keys.length; i++) {\n    const inputName = keys[i];\n    const input = block.getInput(inputName);\n    if (!input || !input.connection) {\n      throw new MissingConnection(inputName, block, state);\n    }\n    loadConnection(input.connection, state['inputs'][inputName]);\n  }\n}\n\n/**\n * Creates any next blocks defined by the given state and attaches them to the\n * given block.\n *\n * @param block The block to attach next blocks to.\n * @param state The state object to reference.\n */\nfunction loadNextBlocks(block: Block, state: State) {\n  if (!state['next']) {\n    return;\n  }\n  if (!block.nextConnection) {\n    throw new MissingConnection('next', block, state);\n  }\n  loadConnection(block.nextConnection, state['next']);\n}\n/**\n * Applies the state defined by connectionState to the given connection, ie\n * assigns shadows and attaches child blocks.\n *\n * @param connection The connection to deserialize the connected blocks of.\n * @param connectionState The object containing the state of any connected\n *     shadow block, or any connected real block.\n */\nfunction loadConnection(\n  connection: Connection,\n  connectionState: ConnectionState,\n) {\n  if (connectionState['shadow']) {\n    connection.setShadowState(connectionState['shadow']);\n  }\n  if (connectionState['block']) {\n    appendPrivate(\n      connectionState['block'],\n      connection.getSourceBlock().workspace,\n      {parentConnection: connection},\n    );\n  }\n}\n\n// TODO(#5146): Remove this from the serialization system.\n/**\n * Initializes the give block, eg init the model, inits the svg, renders, etc.\n *\n * @param block The block to initialize.\n * @param rendered Whether the block is a rendered or headless block.\n */\nfunction initBlock(block: Block, rendered: boolean) {\n  if (rendered) {\n    const blockSvg = block as BlockSvg;\n    // Adding connections to the connection db is expensive. This defers that\n    // operation to decrease load time.\n    blockSvg.setConnectionTracking(false);\n\n    blockSvg.initSvg();\n    blockSvg.queueRender();\n\n    // fixes #6076 JSO deserialization doesn't\n    // set .iconXY_ property so here it will be set\n    for (const icon of blockSvg.getIcons()) {\n      icon.onLocationChange(blockSvg.getRelativeToSurfaceXY());\n    }\n  } else {\n    block.initModel();\n  }\n}\n\n// Alias to disambiguate saving within the serializer.\nconst saveBlock = save;\n\n/**\n * Serializer for saving and loading block state.\n */\nexport class BlockSerializer implements ISerializer {\n  priority: number;\n\n  constructor() {\n    /** The priority for deserializing blocks. */\n    this.priority = priorities.BLOCKS;\n  }\n\n  /**\n   * Serializes the blocks of the given workspace.\n   *\n   * @param workspace The workspace to save the blocks of.\n   * @returns The state of the workspace's blocks, or null if there are no\n   *     blocks.\n   */\n  save(\n    workspace: Workspace,\n  ): {languageVersion: number; blocks: State[]} | null {\n    const blockStates = [];\n    for (const block of workspace.getTopBlocks(false)) {\n      const state = saveBlock(block, {\n        addCoordinates: true,\n        doFullSerialization: false,\n      });\n      if (state) {\n        blockStates.push(state);\n      }\n    }\n    if (blockStates.length) {\n      return {\n        'languageVersion': 0, // Currently unused.\n        'blocks': blockStates,\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Deserializes the blocks defined by the given state into the given\n   * workspace.\n   *\n   * @param state The state of the blocks to deserialize.\n   * @param workspace The workspace to deserialize into.\n   */\n  load(\n    state: {languageVersion: number; blocks: State[]},\n    workspace: Workspace,\n  ) {\n    const blockStates = state['blocks'];\n    for (const state of blockStates) {\n      append(state, workspace, {recordUndo: eventUtils.getRecordUndo()});\n    }\n  }\n\n  /**\n   * Disposes of any blocks that exist on the workspace.\n   *\n   * @param workspace The workspace to clear the blocks of.\n   */\n  clear(workspace: Workspace) {\n    // Cannot use workspace.clear() because that also removes variables.\n    for (const block of workspace.getTopBlocks(false)) {\n      block.dispose(false);\n    }\n  }\n}\n\nserializationRegistry.register('blocks', new BlockSerializer());\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport interface IHasBubble {\n  /** @returns True if the bubble is currently open, false otherwise. */\n  bubbleIsVisible(): boolean;\n\n  /** Sets whether the bubble is open or not. */\n  setBubbleVisible(visible: boolean): Promise<void>;\n}\n\n/** Type guard that checks whether the given object is a IHasBubble. */\nexport function hasBubble(obj: any): obj is IHasBubble {\n  return (\n    obj.bubbleIsVisible !== undefined && obj.setBubbleVisible !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.math\n\n/**\n * Converts degrees to radians.\n * Copied from Closure's goog.math.toRadians.\n *\n * @param angleDegrees Angle in degrees.\n * @returns Angle in radians.\n */\nexport function toRadians(angleDegrees: number): number {\n  return (angleDegrees * Math.PI) / 180;\n}\n\n/**\n * Converts radians to degrees.\n * Copied from Closure's goog.math.toDegrees.\n *\n * @param angleRadians Angle in radians.\n * @returns Angle in degrees.\n */\nexport function toDegrees(angleRadians: number): number {\n  return (angleRadians * 180) / Math.PI;\n}\n\n/**\n * Clamp the provided number between the lower bound and the upper bound.\n *\n * @param lowerBound The desired lower bound.\n * @param number The number to clamp.\n * @param upperBound The desired upper bound.\n * @returns The clamped number.\n */\nexport function clamp(\n  lowerBound: number,\n  number: number,\n  upperBound: number,\n): number {\n  if (upperBound < lowerBound) {\n    const temp = upperBound;\n    upperBound = lowerBound;\n    lowerBound = temp;\n  }\n  return Math.max(lowerBound, Math.min(number, upperBound));\n}\n", "/**\n * @license\n * Copyright 2016 Massachusetts Institute of Technology\n * All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A div that floats on top of the workspace, for drop-down menus.\n *\n * @class\n */\n// Former goog.module ID: Blockly.dropDownDiv\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport type {Field} from './field.js';\nimport * as dom from './utils/dom.js';\nimport * as math from './utils/math.js';\nimport {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Arrow size in px. Should match the value in CSS\n * (need to position pre-render).\n */\nexport const ARROW_SIZE = 16;\n\n/**\n * Drop-down border size in px. Should match the value in CSS (need to position\n * the arrow).\n */\nexport const BORDER_SIZE = 1;\n\n/**\n * Amount the arrow must be kept away from the edges of the main drop-down div,\n * in px.\n */\nexport const ARROW_HORIZONTAL_PADDING = 12;\n\n/** Amount drop-downs should be padded away from the source, in px. */\nexport const PADDING_Y = 16;\n\n/** Length of animations in seconds. */\nexport const ANIMATION_TIME = 0.25;\n\n/**\n * Timer for animation out, to be cleared if we need to immediately hide\n * without disrupting new shows.\n */\nlet animateOutTimer: ReturnType<typeof setTimeout> | null = null;\n\n/** Callback for when the drop-down is hidden. */\nlet onHide: (() => void) | null = null;\n\n/** A class name representing the current owner's workspace renderer. */\nlet renderedClassName = '';\n\n/** A class name representing the current owner's workspace theme. */\nlet themeClassName = '';\n\n/** The content element. */\nlet div: HTMLDivElement;\n\n/** The content element. */\nlet content: HTMLDivElement;\n\n/** The arrow element. */\nlet arrow: HTMLDivElement;\n\n/**\n * Drop-downs will appear within the bounds of this element if possible.\n * Set in setBoundsElement.\n */\nlet boundsElement: Element | null = null;\n\n/** The object currently using the drop-down. */\nlet owner: Field | null = null;\n\n/** Whether the dropdown was positioned to a field or the source block. */\nlet positionToField: boolean | null = null;\n\n/**\n * Dropdown bounds info object used to encapsulate sizing information about a\n * bounding element (bounding box and width/height).\n */\nexport interface BoundsInfo {\n  top: number;\n  left: number;\n  bottom: number;\n  right: number;\n  width: number;\n  height: number;\n}\n\n/** Dropdown position metrics. */\nexport interface PositionMetrics {\n  initialX: number;\n  initialY: number;\n  finalX: number;\n  finalY: number;\n  arrowX: number | null;\n  arrowY: number | null;\n  arrowAtTop: boolean | null;\n  arrowVisible: boolean;\n}\n\n/**\n * Create and insert the DOM element for this div.\n *\n * @internal\n */\nexport function createDom() {\n  if (document.querySelector('.blocklyDropDownDiv')) {\n    return; // Already created.\n  }\n  div = document.createElement('div');\n  div.className = 'blocklyDropDownDiv';\n  const parentDiv = common.getParentContainer() || document.body;\n  parentDiv.appendChild(div);\n\n  content = document.createElement('div');\n  content.className = 'blocklyDropDownContent';\n  div.appendChild(content);\n\n  arrow = document.createElement('div');\n  arrow.className = 'blocklyDropDownArrow';\n  div.appendChild(arrow);\n\n  div.style.opacity = '0';\n  // Transition animation for transform: translate() and opacity.\n  div.style.transition =\n    'transform ' + ANIMATION_TIME + 's, ' + 'opacity ' + ANIMATION_TIME + 's';\n\n  // Handle focusin/out events to add a visual indicator when\n  // a child is focused or blurred.\n  div.addEventListener('focusin', function () {\n    dom.addClass(div, 'blocklyFocused');\n  });\n  div.addEventListener('focusout', function () {\n    dom.removeClass(div, 'blocklyFocused');\n  });\n}\n\n/**\n * Set an element to maintain bounds within. Drop-downs will appear\n * within the box of this element if possible.\n *\n * @param boundsElem Element to bind drop-down to.\n */\nexport function setBoundsElement(boundsElem: Element | null) {\n  boundsElement = boundsElem;\n}\n\n/**\n * @returns The field that currently owns this, or null.\n */\nexport function getOwner(): Field | null {\n  return owner;\n}\n\n/**\n * Provide the div for inserting content into the drop-down.\n *\n * @returns Div to populate with content.\n */\nexport function getContentDiv(): Element {\n  return content;\n}\n\n/** Clear the content of the drop-down. */\nexport function clearContent() {\n  content.textContent = '';\n  content.style.width = '';\n}\n\n/**\n * Set the colour for the drop-down.\n *\n * @param backgroundColour Any CSS colour for the background.\n * @param borderColour Any CSS colour for the border.\n */\nexport function setColour(backgroundColour: string, borderColour: string) {\n  div.style.backgroundColor = backgroundColour;\n  div.style.borderColor = borderColour;\n}\n\n/**\n * Shortcut to show and place the drop-down with positioning determined\n * by a particular block. The primary position will be below the block,\n * and the secondary position above the block. Drop-down will be\n * constrained to the block's workspace.\n *\n * @param field The field showing the drop-down.\n * @param block Block to position the drop-down around.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nexport function showPositionedByBlock<T>(\n  field: Field<T>,\n  block: BlockSvg,\n  opt_onHide?: () => void,\n  opt_secondaryYOffset?: number,\n): boolean {\n  return showPositionedByRect(\n    getScaledBboxOfBlock(block),\n    field as Field,\n    opt_onHide,\n    opt_secondaryYOffset,\n  );\n}\n\n/**\n * Shortcut to show and place the drop-down with positioning determined\n * by a particular field. The primary position will be below the field,\n * and the secondary position above the field. Drop-down will be\n * constrained to the block's workspace.\n *\n * @param field The field to position the dropdown against.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nexport function showPositionedByField<T>(\n  field: Field<T>,\n  opt_onHide?: () => void,\n  opt_secondaryYOffset?: number,\n): boolean {\n  positionToField = true;\n  return showPositionedByRect(\n    getScaledBboxOfField(field as Field),\n    field as Field,\n    opt_onHide,\n    opt_secondaryYOffset,\n  );\n}\n/**\n * Get the scaled bounding box of a block.\n *\n * @param block The block.\n * @returns The scaled bounding box of the block.\n */\nfunction getScaledBboxOfBlock(block: BlockSvg): Rect {\n  const blockSvg = block.getSvgRoot();\n  const scale = block.workspace.scale;\n  const scaledHeight = block.height * scale;\n  const scaledWidth = block.width * scale;\n  const xy = style.getPageOffset(blockSvg);\n  return new Rect(xy.y, xy.y + scaledHeight, xy.x, xy.x + scaledWidth);\n}\n\n/**\n * Get the scaled bounding box of a field.\n *\n * @param field The field.\n * @returns The scaled bounding box of the field.\n */\nfunction getScaledBboxOfField(field: Field): Rect {\n  const bBox = field.getScaledBBox();\n  return new Rect(bBox.top, bBox.bottom, bBox.left, bBox.right);\n}\n\n/**\n * Helper method to show and place the drop-down with positioning determined\n * by a scaled bounding box.  The primary position will be below the rect,\n * and the secondary position above the rect. Drop-down will be constrained to\n * the block's workspace.\n *\n * @param bBox The scaled bounding box.\n * @param field The field to position the dropdown against.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nfunction showPositionedByRect(\n  bBox: Rect,\n  field: Field,\n  opt_onHide?: () => void,\n  opt_secondaryYOffset?: number,\n): boolean {\n  // If we can fit it, render below the block.\n  const primaryX = bBox.left + (bBox.right - bBox.left) / 2;\n  const primaryY = bBox.bottom;\n  // If we can't fit it, render above the entire parent block.\n  const secondaryX = primaryX;\n  let secondaryY = bBox.top;\n  if (opt_secondaryYOffset) {\n    secondaryY += opt_secondaryYOffset;\n  }\n  const sourceBlock = field.getSourceBlock() as BlockSvg;\n  // Set bounds to main workspace; show the drop-down.\n  let workspace = sourceBlock.workspace;\n  while (workspace.options.parentWorkspace) {\n    workspace = workspace.options.parentWorkspace;\n  }\n  setBoundsElement(workspace.getParentSvg().parentNode as Element | null);\n  return show(\n    field,\n    sourceBlock.RTL,\n    primaryX,\n    primaryY,\n    secondaryX,\n    secondaryY,\n    opt_onHide,\n  );\n}\n\n/**\n * Show and place the drop-down.\n * The drop-down is placed with an absolute \"origin point\" (x, y) - i.e.,\n * the arrow will point at this origin and box will positioned below or above\n * it.  If we can maintain the container bounds at the primary point, the arrow\n * will point there, and the container will be positioned below it.\n * If we can't maintain the container bounds at the primary point, fall-back to\n * the secondary point and position above.\n *\n * @param newOwner The object showing the drop-down\n * @param rtl Right-to-left (true) or left-to-right (false).\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @returns True if the menu rendered at the primary origin point.\n * @internal\n */\nexport function show<T>(\n  newOwner: Field<T>,\n  rtl: boolean,\n  primaryX: number,\n  primaryY: number,\n  secondaryX: number,\n  secondaryY: number,\n  opt_onHide?: () => void,\n): boolean {\n  owner = newOwner as Field;\n  onHide = opt_onHide || null;\n  // Set direction.\n  div.style.direction = rtl ? 'rtl' : 'ltr';\n\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  renderedClassName = mainWorkspace.getRenderer().getClassName();\n  themeClassName = mainWorkspace.getTheme().getClassName();\n  if (renderedClassName) {\n    dom.addClass(div, renderedClassName);\n  }\n  if (themeClassName) {\n    dom.addClass(div, themeClassName);\n  }\n\n  // When we change `translate` multiple times in close succession,\n  // Chrome may choose to wait and apply them all at once.\n  // Since we want the translation to initial X, Y to be immediate,\n  // and the translation to final X, Y to be animated,\n  // we saw problems where both would be applied after animation was turned on,\n  // making the dropdown appear to fly in from (0, 0).\n  // Using both `left`, `top` for the initial translation and then `translate`\n  // for the animated transition to final X, Y is a workaround.\n  return positionInternal(primaryX, primaryY, secondaryX, secondaryY);\n}\n\nconst internal = {\n  /**\n   * Get sizing info about the bounding element.\n   *\n   * @returns An object containing size information about the bounding element\n   *     (bounding box and width/height).\n   */\n  getBoundsInfo: function (): BoundsInfo {\n    const boundPosition = style.getPageOffset(boundsElement as Element);\n    const boundSize = style.getSize(boundsElement as Element);\n\n    return {\n      left: boundPosition.x,\n      right: boundPosition.x + boundSize.width,\n      top: boundPosition.y,\n      bottom: boundPosition.y + boundSize.height,\n      width: boundSize.width,\n      height: boundSize.height,\n    };\n  },\n\n  /**\n   * Helper to position the drop-down and the arrow, maintaining bounds.\n   * See explanation of origin points in show.\n   *\n   * @param primaryX Desired origin point x, in absolute px.\n   * @param primaryY Desired origin point y, in absolute px.\n   * @param secondaryX Secondary/alternative origin point x, in absolute px.\n   * @param secondaryY Secondary/alternative origin point y, in absolute px.\n   * @returns Various final metrics, including rendered positions for drop-down\n   *     and arrow.\n   */\n  getPositionMetrics: function (\n    primaryX: number,\n    primaryY: number,\n    secondaryX: number,\n    secondaryY: number,\n  ): PositionMetrics {\n    const boundsInfo = internal.getBoundsInfo();\n    const divSize = style.getSize(div as Element);\n\n    // Can we fit in-bounds below the target?\n    if (primaryY + divSize.height < boundsInfo.bottom) {\n      return getPositionBelowMetrics(primaryX, primaryY, boundsInfo, divSize);\n    }\n    // Can we fit in-bounds above the target?\n    if (secondaryY - divSize.height > boundsInfo.top) {\n      return getPositionAboveMetrics(\n        secondaryX,\n        secondaryY,\n        boundsInfo,\n        divSize,\n      );\n    }\n    // Can we fit outside the workspace bounds (but inside the window)\n    // below?\n    if (primaryY + divSize.height < document.documentElement.clientHeight) {\n      return getPositionBelowMetrics(primaryX, primaryY, boundsInfo, divSize);\n    }\n    // Can we fit outside the workspace bounds (but inside the window)\n    // above?\n    if (secondaryY - divSize.height > document.documentElement.clientTop) {\n      return getPositionAboveMetrics(\n        secondaryX,\n        secondaryY,\n        boundsInfo,\n        divSize,\n      );\n    }\n\n    // Last resort, render at top of page.\n    return getPositionTopOfPageMetrics(primaryX, boundsInfo, divSize);\n  },\n};\n\n/**\n * Get the metrics for positioning the div below the source.\n *\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionBelowMetrics(\n  primaryX: number,\n  primaryY: number,\n  boundsInfo: BoundsInfo,\n  divSize: Size,\n): PositionMetrics {\n  const xCoords = getPositionX(\n    primaryX,\n    boundsInfo.left,\n    boundsInfo.right,\n    divSize.width,\n  );\n\n  const arrowY = -(ARROW_SIZE / 2 + BORDER_SIZE);\n  const finalY = primaryY + PADDING_Y;\n\n  return {\n    initialX: xCoords.divX,\n    initialY: primaryY,\n    finalX: xCoords.divX, // X position remains constant during animation.\n    finalY,\n    arrowX: xCoords.arrowX,\n    arrowY,\n    arrowAtTop: true,\n    arrowVisible: true,\n  };\n}\n\n/**\n * Get the metrics for positioning the div above the source.\n *\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionAboveMetrics(\n  secondaryX: number,\n  secondaryY: number,\n  boundsInfo: BoundsInfo,\n  divSize: Size,\n): PositionMetrics {\n  const xCoords = getPositionX(\n    secondaryX,\n    boundsInfo.left,\n    boundsInfo.right,\n    divSize.width,\n  );\n\n  const arrowY = divSize.height - BORDER_SIZE * 2 - ARROW_SIZE / 2;\n  const finalY = secondaryY - divSize.height - PADDING_Y;\n  const initialY = secondaryY - divSize.height; // No padding on Y.\n\n  return {\n    initialX: xCoords.divX,\n    initialY,\n    finalX: xCoords.divX, // X position remains constant during animation.\n    finalY,\n    arrowX: xCoords.arrowX,\n    arrowY,\n    arrowAtTop: false,\n    arrowVisible: true,\n  };\n}\n\n/**\n * Get the metrics for positioning the div at the top of the page.\n *\n * @param sourceX Desired origin point x, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionTopOfPageMetrics(\n  sourceX: number,\n  boundsInfo: BoundsInfo,\n  divSize: Size,\n): PositionMetrics {\n  const xCoords = getPositionX(\n    sourceX,\n    boundsInfo.left,\n    boundsInfo.right,\n    divSize.width,\n  );\n\n  // No need to provide arrow-specific information because it won't be visible.\n  return {\n    initialX: xCoords.divX,\n    initialY: 0,\n    finalX: xCoords.divX, // X position remains constant during animation.\n    finalY: 0, // Y position remains constant during animation.\n    arrowAtTop: null,\n    arrowX: null,\n    arrowY: null,\n    arrowVisible: false,\n  };\n}\n\n/**\n * Get the x positions for the left side of the DropDownDiv and the arrow,\n * accounting for the bounds of the workspace.\n *\n * @param sourceX Desired origin point x, in absolute px.\n * @param boundsLeft The left edge of the bounding element, in absolute px.\n * @param boundsRight The right edge of the bounding element, in absolute px.\n * @param divWidth The width of the div in px.\n * @returns An object containing metrics for the x positions of the left side of\n *     the DropDownDiv and the arrow.\n * @internal\n */\nexport function getPositionX(\n  sourceX: number,\n  boundsLeft: number,\n  boundsRight: number,\n  divWidth: number,\n): {divX: number; arrowX: number} {\n  let divX = sourceX;\n  // Offset the topLeft coord so that the dropdowndiv is centered.\n  divX -= divWidth / 2;\n  // Fit the dropdowndiv within the bounds of the workspace.\n  divX = math.clamp(boundsLeft, divX, boundsRight - divWidth);\n\n  let arrowX = sourceX;\n  // Offset the arrow coord so that the arrow is centered.\n  arrowX -= ARROW_SIZE / 2;\n  // Convert the arrow position to be relative to the top left of the div.\n  let relativeArrowX = arrowX - divX;\n  const horizPadding = ARROW_HORIZONTAL_PADDING;\n  // Clamp the arrow position so that it stays attached to the dropdowndiv.\n  relativeArrowX = math.clamp(\n    horizPadding,\n    relativeArrowX,\n    divWidth - horizPadding - ARROW_SIZE,\n  );\n\n  return {arrowX: relativeArrowX, divX};\n}\n\n/**\n * Is the container visible?\n *\n * @returns True if visible.\n */\nexport function isVisible(): boolean {\n  return !!owner;\n}\n\n/**\n * Hide the menu only if it is owned by the provided object.\n *\n * @param divOwner Object which must be owning the drop-down to hide.\n * @param opt_withoutAnimation True if we should hide the dropdown without\n *     animating.\n * @returns True if hidden.\n */\nexport function hideIfOwner<T>(\n  divOwner: Field<T>,\n  opt_withoutAnimation?: boolean,\n): boolean {\n  if (owner === divOwner) {\n    if (opt_withoutAnimation) {\n      hideWithoutAnimation();\n    } else {\n      hide();\n    }\n    return true;\n  }\n  return false;\n}\n\n/** Hide the menu, triggering animation. */\nexport function hide() {\n  // Start the animation by setting the translation and fading out.\n  // Reset to (initialX, initialY) - i.e., no translation.\n  div.style.transform = 'translate(0, 0)';\n  div.style.opacity = '0';\n  // Finish animation - reset all values to default.\n  animateOutTimer = setTimeout(function () {\n    hideWithoutAnimation();\n  }, ANIMATION_TIME * 1000);\n  if (onHide) {\n    onHide();\n    onHide = null;\n  }\n}\n\n/** Hide the menu, without animation. */\nexport function hideWithoutAnimation() {\n  if (!isVisible()) {\n    return;\n  }\n  if (animateOutTimer) {\n    clearTimeout(animateOutTimer);\n  }\n\n  // Reset style properties in case this gets called directly\n  // instead of hide() - see discussion on #2551.\n  div.style.transform = '';\n  div.style.left = '';\n  div.style.top = '';\n  div.style.opacity = '0';\n  div.style.display = 'none';\n  div.style.backgroundColor = '';\n  div.style.borderColor = '';\n\n  if (onHide) {\n    onHide();\n    onHide = null;\n  }\n  clearContent();\n  owner = null;\n\n  if (renderedClassName) {\n    dom.removeClass(div, renderedClassName);\n    renderedClassName = '';\n  }\n  if (themeClassName) {\n    dom.removeClass(div, themeClassName);\n    themeClassName = '';\n  }\n  (common.getMainWorkspace() as WorkspaceSvg).markFocused();\n}\n\n/**\n * Set the dropdown div's position.\n *\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @returns True if the menu rendered at the primary origin point.\n */\nfunction positionInternal(\n  primaryX: number,\n  primaryY: number,\n  secondaryX: number,\n  secondaryY: number,\n): boolean {\n  const metrics = internal.getPositionMetrics(\n    primaryX,\n    primaryY,\n    secondaryX,\n    secondaryY,\n  );\n\n  // Update arrow CSS.\n  if (metrics.arrowVisible) {\n    arrow.style.display = '';\n    arrow.style.transform =\n      'translate(' +\n      metrics.arrowX +\n      'px,' +\n      metrics.arrowY +\n      'px) rotate(45deg)';\n    arrow.setAttribute(\n      'class',\n      metrics.arrowAtTop\n        ? 'blocklyDropDownArrow blocklyArrowTop'\n        : 'blocklyDropDownArrow blocklyArrowBottom',\n    );\n  } else {\n    arrow.style.display = 'none';\n  }\n\n  const initialX = Math.floor(metrics.initialX);\n  const initialY = Math.floor(metrics.initialY);\n  const finalX = Math.floor(metrics.finalX);\n  const finalY = Math.floor(metrics.finalY);\n\n  // First apply initial translation.\n  div.style.left = initialX + 'px';\n  div.style.top = initialY + 'px';\n\n  // Show the div.\n  div.style.display = 'block';\n  div.style.opacity = '1';\n  // Add final translate, animated through `transition`.\n  // Coordinates are relative to (initialX, initialY),\n  // where the drop-down is absolutely positioned.\n  const dx = finalX - initialX;\n  const dy = finalY - initialY;\n  div.style.transform = 'translate(' + dx + 'px,' + dy + 'px)';\n\n  return !!metrics.arrowAtTop;\n}\n\n/**\n * Repositions the dropdownDiv on window resize. If it doesn't know how to\n * calculate the new position, it will just hide it instead.\n *\n * @internal\n */\nexport function repositionForWindowResize() {\n  // This condition mainly catches the dropdown div when it is being used as a\n  // dropdown.  It is important not to close it in this case because on Android,\n  // when a field is focused, the soft keyboard opens triggering a window resize\n  // event and we want the dropdown div to stick around so users can type into\n  // it.\n  if (owner) {\n    const block = owner.getSourceBlock() as BlockSvg;\n    const bBox = positionToField\n      ? getScaledBboxOfField(owner)\n      : getScaledBboxOfBlock(block);\n    // If we can fit it, render below the block.\n    const primaryX = bBox.left + (bBox.right - bBox.left) / 2;\n    const primaryY = bBox.bottom;\n    // If we can't fit it, render above the entire parent block.\n    const secondaryX = primaryX;\n    const secondaryY = bBox.top;\n    positionInternal(primaryX, primaryY, secondaryX, secondaryY);\n  } else {\n    hide();\n  }\n}\n\nexport const TEST_ONLY = internal;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.string\n\n/**\n * Given an array of strings, return the length of the shortest one.\n *\n * @param array Array of strings.\n * @returns Length of shortest string.\n */\nexport function shortestStringLength(array: string[]): number {\n  if (!array.length) {\n    return 0;\n  }\n  return array.reduce(function (a, b) {\n    return a.length < b.length ? a : b;\n  }).length;\n}\n\n/**\n * Given an array of strings, return the length of the common prefix.\n * Words may not be split.  Any space after a word is included in the length.\n *\n * @param array Array of strings.\n * @param opt_shortest Length of shortest string.\n * @returns Length of common prefix.\n */\nexport function commonWordPrefix(\n  array: string[],\n  opt_shortest?: number,\n): number {\n  if (!array.length) {\n    return 0;\n  } else if (array.length === 1) {\n    return array[0].length;\n  }\n  let wordPrefix = 0;\n  const max = opt_shortest || shortestStringLength(array);\n  let len;\n  for (len = 0; len < max; len++) {\n    const letter = array[0][len];\n    for (let i = 1; i < array.length; i++) {\n      if (letter !== array[i][len]) {\n        return wordPrefix;\n      }\n    }\n    if (letter === ' ') {\n      wordPrefix = len + 1;\n    }\n  }\n  for (let i = 1; i < array.length; i++) {\n    const letter = array[i][len];\n    if (letter && letter !== ' ') {\n      return wordPrefix;\n    }\n  }\n  return max;\n}\n\n/**\n * Given an array of strings, return the length of the common suffix.\n * Words may not be split.  Any space after a word is included in the length.\n *\n * @param array Array of strings.\n * @param opt_shortest Length of shortest string.\n * @returns Length of common suffix.\n */\nexport function commonWordSuffix(\n  array: string[],\n  opt_shortest?: number,\n): number {\n  if (!array.length) {\n    return 0;\n  } else if (array.length === 1) {\n    return array[0].length;\n  }\n  let wordPrefix = 0;\n  const max = opt_shortest || shortestStringLength(array);\n  let len;\n  for (len = 0; len < max; len++) {\n    const letter = array[0].substr(-len - 1, 1);\n    for (let i = 1; i < array.length; i++) {\n      if (letter !== array[i].substr(-len - 1, 1)) {\n        return wordPrefix;\n      }\n    }\n    if (letter === ' ') {\n      wordPrefix = len + 1;\n    }\n  }\n  for (let i = 1; i < array.length; i++) {\n    const letter = array[i].charAt(array[i].length - len - 1);\n    if (letter && letter !== ' ') {\n      return wordPrefix;\n    }\n  }\n  return max;\n}\n\n/**\n * Wrap text to the specified width.\n *\n * @param text Text to wrap.\n * @param limit Width to wrap each line.\n * @returns Wrapped text.\n */\nexport function wrap(text: string, limit: number): string {\n  const lines = text.split('\\n');\n  for (let i = 0; i < lines.length; i++) {\n    lines[i] = wrapLine(lines[i], limit);\n  }\n  return lines.join('\\n');\n}\n\n/**\n * Wrap single line of text to the specified width.\n *\n * @param text Text to wrap.\n * @param limit Width to wrap each line.\n * @returns Wrapped text.\n */\nfunction wrapLine(text: string, limit: number): string {\n  if (text.length <= limit) {\n    // Short text, no need to wrap.\n    return text;\n  }\n  // Split the text into words.\n  const words = text.trim().split(/\\s+/);\n  // Set limit to be the length of the largest word.\n  for (let i = 0; i < words.length; i++) {\n    if (words[i].length > limit) {\n      limit = words[i].length;\n    }\n  }\n\n  let lastScore;\n  let score = -Infinity;\n  let lastText;\n  let lineCount = 1;\n  do {\n    lastScore = score;\n    lastText = text;\n    // Create a list of booleans representing if a space (false) or\n    // a break (true) appears after each word.\n    let wordBreaks = [];\n    // Seed the list with evenly spaced linebreaks.\n    const steps = words.length / lineCount;\n    let insertedBreaks = 1;\n    for (let i = 0; i < words.length - 1; i++) {\n      if (insertedBreaks < (i + 1.5) / steps) {\n        insertedBreaks++;\n        wordBreaks[i] = true;\n      } else {\n        wordBreaks[i] = false;\n      }\n    }\n    wordBreaks = wrapMutate(words, wordBreaks, limit);\n    score = wrapScore(words, wordBreaks, limit);\n    text = wrapToText(words, wordBreaks);\n    lineCount++;\n  } while (score > lastScore);\n  return lastText;\n}\n\n/**\n * Compute a score for how good the wrapping is.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @param limit Width to wrap each line.\n * @returns Larger the better.\n */\nfunction wrapScore(\n  words: string[],\n  wordBreaks: boolean[],\n  limit: number,\n): number {\n  // If this function becomes a performance liability, add caching.\n  // Compute the length of each line.\n  const lineLengths = [0];\n  const linePunctuation = [];\n  for (let i = 0; i < words.length; i++) {\n    lineLengths[lineLengths.length - 1] += words[i].length;\n    if (wordBreaks[i] === true) {\n      lineLengths.push(0);\n      linePunctuation.push(words[i].charAt(words[i].length - 1));\n    } else if (wordBreaks[i] === false) {\n      lineLengths[lineLengths.length - 1]++;\n    }\n  }\n  const maxLength = Math.max(...lineLengths);\n\n  let score = 0;\n  for (let i = 0; i < lineLengths.length; i++) {\n    // Optimize for width.\n    // -2 points per char over limit (scaled to the power of 1.5).\n    score -= Math.pow(Math.abs(limit - lineLengths[i]), 1.5) * 2;\n    // Optimize for even lines.\n    // -1 point per char smaller than max (scaled to the power of 1.5).\n    score -= Math.pow(maxLength - lineLengths[i], 1.5);\n    // Optimize for structure.\n    // Add score to line endings after punctuation.\n    if ('.?!'.includes(linePunctuation[i])) {\n      score += limit / 3;\n    } else if (',;)]}'.includes(linePunctuation[i])) {\n      score += limit / 4;\n    }\n  }\n  // All else being equal, the last line should not be longer than the\n  // previous line.  For example, this looks wrong:\n  // aaa bbb\n  // ccc ddd eee\n  if (\n    lineLengths.length > 1 &&\n    lineLengths[lineLengths.length - 1] <= lineLengths[lineLengths.length - 2]\n  ) {\n    score += 0.5;\n  }\n  return score;\n}\n/**\n * Mutate the array of line break locations until an optimal solution is found.\n * No line breaks are added or deleted, they are simply moved around.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @param limit Width to wrap each line.\n * @returns New array of optimal line breaks.\n */\nfunction wrapMutate(\n  words: string[],\n  wordBreaks: boolean[],\n  limit: number,\n): boolean[] {\n  let bestScore = wrapScore(words, wordBreaks, limit);\n  let bestBreaks;\n  // Try shifting every line break forward or backward.\n  for (let i = 0; i < wordBreaks.length - 1; i++) {\n    if (wordBreaks[i] === wordBreaks[i + 1]) {\n      continue;\n    }\n    const mutatedWordBreaks = new Array<boolean>().concat(wordBreaks);\n    mutatedWordBreaks[i] = !mutatedWordBreaks[i];\n    mutatedWordBreaks[i + 1] = !mutatedWordBreaks[i + 1];\n    const mutatedScore = wrapScore(words, mutatedWordBreaks, limit);\n    if (mutatedScore > bestScore) {\n      bestScore = mutatedScore;\n      bestBreaks = mutatedWordBreaks;\n    }\n  }\n  if (bestBreaks) {\n    // Found an improvement.  See if it may be improved further.\n    return wrapMutate(words, bestBreaks, limit);\n  }\n  // No improvements found.  Done.\n  return wordBreaks;\n}\n\n/**\n * Reassemble the array of words into text, with the specified line breaks.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @returns Plain text.\n */\nfunction wrapToText(words: string[], wordBreaks: boolean[]): string {\n  const text = [];\n  for (let i = 0; i < words.length; i++) {\n    text.push(words[i]);\n    if (wordBreaks[i] !== undefined) {\n      text.push(wordBreaks[i] ? '\\n' : ' ');\n    }\n  }\n  return text.join('');\n}\n\n/**\n * Is the given string a number (includes negative and decimals).\n *\n * @param str Input string.\n * @returns True if number, false otherwise.\n */\nexport function isNumber(str: string): boolean {\n  return /^\\s*-?\\d+(\\.\\d+)?\\s*$/.test(str);\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Tooltip\n\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport * as blocklyString from './utils/string.js';\n\n/**\n * A type which can define a tooltip.\n * Either a string, an object containing a tooltip property, or a function which\n * returns either a string, or another arbitrarily nested function which\n * eventually unwinds to a string.\n */\nexport type TipInfo =\n  | string\n  | {tooltip: AnyDuringMigration}\n  | (() => TipInfo | string);\n\n/**\n * A function that renders custom tooltip UI.\n * 1st parameter: the div element to render content into.\n * 2nd parameter: the element being moused over (i.e., the element for which the\n * tooltip should be shown).\n */\nexport type CustomTooltip = (p1: Element, p2: Element) => AnyDuringMigration;\n\n/**\n * An optional function that renders custom tooltips into the provided DIV. If\n * this is defined, the function will be called instead of rendering the default\n * tooltip UI.\n */\nlet customTooltip: CustomTooltip | undefined = undefined;\n\n/**\n * Sets a custom function that will be called if present instead of the default\n * tooltip UI.\n *\n * @param customFn A custom tooltip used to render an alternate tooltip UI.\n */\nexport function setCustomTooltip(customFn: CustomTooltip) {\n  customTooltip = customFn;\n}\n\n/**\n * Gets the custom tooltip function.\n *\n * @returns The custom tooltip function, if defined.\n */\nexport function getCustomTooltip(): CustomTooltip | undefined {\n  return customTooltip;\n}\n\n/** Is a tooltip currently showing? */\nlet visible = false;\n\n/**\n * Returns whether or not a tooltip is showing\n *\n * @returns True if a tooltip is showing\n */\nexport function isVisible(): boolean {\n  return visible;\n}\n\n/** Is someone else blocking the tooltip from being shown? */\nlet blocked = false;\n\n/**\n * Maximum width (in characters) of a tooltip.\n */\nexport const LIMIT = 50;\n\n/** PID of suspended thread to clear tooltip on mouse out. */\nlet mouseOutPid: AnyDuringMigration = 0;\n\n/** PID of suspended thread to show the tooltip. */\nlet showPid: AnyDuringMigration = 0;\n\n/**\n * Last observed X location of the mouse pointer (freezes when tooltip appears).\n */\nlet lastX = 0;\n\n/**\n * Last observed Y location of the mouse pointer (freezes when tooltip appears).\n */\nlet lastY = 0;\n\n/** Current element being pointed at. */\nlet element: AnyDuringMigration = null;\n\n/**\n * Once a tooltip has opened for an element, that element is 'poisoned' and\n * cannot respawn a tooltip until the pointer moves over a different element.\n */\nlet poisonedElement: AnyDuringMigration = null;\n\n/**\n * Horizontal offset between mouse cursor and tooltip.\n */\nexport const OFFSET_X = 0;\n\n/**\n * Vertical offset between mouse cursor and tooltip.\n */\nexport const OFFSET_Y = 10;\n\n/**\n * Radius mouse can move before killing tooltip.\n */\nexport const RADIUS_OK = 10;\n\n/**\n * Delay before tooltip appears.\n */\nexport const HOVER_MS = 750;\n\n/**\n * Horizontal padding between tooltip and screen edge.\n */\nexport const MARGINS = 5;\n\n/** The HTML container.  Set once by createDom. */\nlet containerDiv: HTMLDivElement | null = null;\n\n/**\n * Returns the HTML tooltip container.\n *\n * @returns The HTML tooltip container.\n */\nexport function getDiv(): HTMLDivElement | null {\n  return containerDiv;\n}\n\n/**\n * Returns the tooltip text for the given element.\n *\n * @param object The object to get the tooltip text of.\n * @returns The tooltip text of the element.\n */\nexport function getTooltipOfObject(object: AnyDuringMigration | null): string {\n  const obj = getTargetObject(object);\n  if (obj) {\n    let tooltip = obj.tooltip;\n    while (typeof tooltip === 'function') {\n      tooltip = tooltip();\n    }\n    if (typeof tooltip !== 'string') {\n      throw Error('Tooltip function must return a string.');\n    }\n    return tooltip;\n  }\n  return '';\n}\n\n/**\n * Returns the target object that the given object is targeting for its\n * tooltip. Could be the object itself.\n *\n * @param obj The object are trying to find the target tooltip object of.\n * @returns The target tooltip object.\n */\nfunction getTargetObject(\n  obj: object | null,\n): {tooltip: AnyDuringMigration} | null {\n  while (obj && (obj as any).tooltip) {\n    if (\n      typeof (obj as any).tooltip === 'string' ||\n      typeof (obj as any).tooltip === 'function'\n    ) {\n      return obj as {tooltip: string | (() => string)};\n    }\n    obj = (obj as any).tooltip;\n  }\n  return null;\n}\n\n/**\n * Create the tooltip div and inject it onto the page.\n */\nexport function createDom() {\n  if (document.querySelector('.blocklyTooltipDiv')) {\n    return; // Already created.\n  }\n  // Create an HTML container for popup overlays (e.g. editor widgets).\n  containerDiv = document.createElement('div');\n  containerDiv.className = 'blocklyTooltipDiv';\n  const container = common.getParentContainer() || document.body;\n  container.appendChild(containerDiv);\n}\n\n/**\n * Binds the required mouse events onto an SVG element.\n *\n * @param element SVG element onto which tooltip is to be bound.\n */\nexport function bindMouseEvents(element: Element) {\n  // TODO (#6097): Don't stash wrapper info on the DOM.\n  (element as AnyDuringMigration).mouseOverWrapper_ = browserEvents.bind(\n    element,\n    'pointerover',\n    null,\n    onMouseOver,\n  );\n  (element as AnyDuringMigration).mouseOutWrapper_ = browserEvents.bind(\n    element,\n    'pointerout',\n    null,\n    onMouseOut,\n  );\n\n  // Don't use bindEvent_ for mousemove since that would create a\n  // corresponding touch handler, even though this only makes sense in the\n  // context of a mouseover/mouseout.\n  element.addEventListener('pointermove', onMouseMove, false);\n}\n\n/**\n * Unbinds tooltip mouse events from the SVG element.\n *\n * @param element SVG element onto which tooltip is bound.\n */\nexport function unbindMouseEvents(element: Element | null) {\n  if (!element) {\n    return;\n  }\n  // TODO (#6097): Don't stash wrapper info on the DOM.\n  browserEvents.unbind((element as AnyDuringMigration).mouseOverWrapper_);\n  browserEvents.unbind((element as AnyDuringMigration).mouseOutWrapper_);\n  element.removeEventListener('pointermove', onMouseMove);\n}\n\n/**\n * Hide the tooltip if the mouse is over a different object.\n * Initialize the tooltip to potentially appear for this object.\n *\n * @param e Mouse event.\n */\nfunction onMouseOver(e: PointerEvent) {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  // If the tooltip is an object, treat it as a pointer to the next object in\n  // the chain to look at.  Terminate when a string or function is found.\n  const newElement = getTargetObject(e.currentTarget);\n  if (element !== newElement) {\n    hide();\n    poisonedElement = null;\n    element = newElement;\n  }\n  // Forget about any immediately preceding mouseOut event.\n  clearTimeout(mouseOutPid);\n}\n\n/**\n * Hide the tooltip if the mouse leaves the object and enters the workspace.\n *\n * @param _e Mouse event.\n */\nfunction onMouseOut(_e: PointerEvent) {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  // Moving from one element to another (overlapping or with no gap) generates\n  // a mouseOut followed instantly by a mouseOver.  Fork off the mouseOut\n  // event and kill it if a mouseOver is received immediately.\n  // This way the task only fully executes if mousing into the void.\n  mouseOutPid = setTimeout(function () {\n    element = null;\n    poisonedElement = null;\n    hide();\n  }, 1);\n  clearTimeout(showPid);\n  showPid = 0;\n}\n\n/**\n * When hovering over an element, schedule a tooltip to be shown.  If a tooltip\n * is already visible, hide it if the mouse strays out of a certain radius.\n *\n * @param e Mouse event.\n */\nfunction onMouseMove(e: Event) {\n  if (!element || !(element as AnyDuringMigration).tooltip) {\n    // No tooltip here to show.\n    return;\n  } else if (blocked) {\n    // Someone doesn't want us to show tooltips.  We are probably handling a\n    // user gesture, such as a click or drag.\n    return;\n  }\n  if (visible) {\n    // Compute the distance between the mouse position when the tooltip was\n    // shown and the current mouse position.  Pythagorean theorem.\n    // AnyDuringMigration because:  Property 'pageX' does not exist on type\n    // 'Event'.\n    const dx = lastX - (e as AnyDuringMigration).pageX;\n    // AnyDuringMigration because:  Property 'pageY' does not exist on type\n    // 'Event'.\n    const dy = lastY - (e as AnyDuringMigration).pageY;\n    if (Math.sqrt(dx * dx + dy * dy) > RADIUS_OK) {\n      hide();\n    }\n  } else if (poisonedElement !== element) {\n    // The mouse moved, clear any previously scheduled tooltip.\n    clearTimeout(showPid);\n    // Maybe this time the mouse will stay put.  Schedule showing of tooltip.\n    // AnyDuringMigration because:  Property 'pageX' does not exist on type\n    // 'Event'.\n    lastX = (e as AnyDuringMigration).pageX;\n    // AnyDuringMigration because:  Property 'pageY' does not exist on type\n    // 'Event'.\n    lastY = (e as AnyDuringMigration).pageY;\n    showPid = setTimeout(show, HOVER_MS);\n  }\n}\n\n/**\n * Dispose of the tooltip.\n *\n * @internal\n */\nexport function dispose() {\n  element = null;\n  poisonedElement = null;\n  hide();\n}\n\n/**\n * Hide the tooltip.\n */\nexport function hide() {\n  if (visible) {\n    visible = false;\n    if (containerDiv) {\n      containerDiv.style.display = 'none';\n    }\n  }\n  if (showPid) {\n    clearTimeout(showPid);\n    showPid = 0;\n  }\n}\n\n/**\n * Hide any in-progress tooltips and block showing new tooltips until the next\n * call to unblock().\n *\n * @internal\n */\nexport function block() {\n  hide();\n  blocked = true;\n}\n\n/**\n * Unblock tooltips: allow them to be scheduled and shown according to their own\n * logic.\n *\n * @internal\n */\nexport function unblock() {\n  blocked = false;\n}\n\n/** Renders the tooltip content into the tooltip div. */\nfunction renderContent() {\n  if (!containerDiv || !element) {\n    // This shouldn't happen, but if it does, we can't render.\n    return;\n  }\n  if (typeof customTooltip === 'function') {\n    customTooltip(containerDiv, element);\n  } else {\n    renderDefaultContent();\n  }\n}\n\n/** Renders the default tooltip UI. */\nfunction renderDefaultContent() {\n  let tip = getTooltipOfObject(element);\n  tip = blocklyString.wrap(tip, LIMIT);\n  // Create new text, line by line.\n  const lines = tip.split('\\n');\n  for (let i = 0; i < lines.length; i++) {\n    const div = document.createElement('div');\n    div.appendChild(document.createTextNode(lines[i]));\n    containerDiv!.appendChild(div);\n  }\n}\n\n/**\n * Gets the coordinates for the tooltip div, taking into account the edges of\n * the screen to prevent showing the tooltip offscreen.\n *\n * @param rtl True if the tooltip should be in right-to-left layout.\n * @returns Coordinates at which the tooltip div should be placed.\n */\nfunction getPosition(rtl: boolean): {x: number; y: number} {\n  // Position the tooltip just below the cursor.\n  const windowWidth = document.documentElement.clientWidth;\n  const windowHeight = document.documentElement.clientHeight;\n\n  let anchorX = lastX;\n  if (rtl) {\n    anchorX -= OFFSET_X + containerDiv!.offsetWidth;\n  } else {\n    anchorX += OFFSET_X;\n  }\n\n  let anchorY = lastY + OFFSET_Y;\n  if (anchorY + containerDiv!.offsetHeight > windowHeight + window.scrollY) {\n    // Falling off the bottom of the screen; shift the tooltip up.\n    anchorY -= containerDiv!.offsetHeight + 2 * OFFSET_Y;\n  }\n\n  if (rtl) {\n    // Prevent falling off left edge in RTL mode.\n    anchorX = Math.max(MARGINS - window.scrollX, anchorX);\n  } else {\n    if (\n      anchorX + containerDiv!.offsetWidth >\n      windowWidth + window.scrollX - 2 * MARGINS\n    ) {\n      // Falling off the right edge of the screen;\n      // clamp the tooltip on the edge.\n      anchorX = windowWidth - containerDiv!.offsetWidth - 2 * MARGINS;\n    }\n  }\n\n  return {x: anchorX, y: anchorY};\n}\n\n/** Create the tooltip and show it. */\nfunction show() {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  poisonedElement = element;\n  if (!containerDiv) {\n    return;\n  }\n  // Erase all existing text.\n  containerDiv.textContent = '';\n\n  // Add new content.\n  renderContent();\n\n  // Display the tooltip.\n  const rtl = (element as any).RTL;\n  containerDiv.style.direction = rtl ? 'rtl' : 'ltr';\n  containerDiv.style.display = 'block';\n  visible = true;\n\n  const {x, y} = getPosition(rtl);\n  containerDiv.style.left = x + 'px';\n  containerDiv.style.top = y + 'px';\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.colour\n\n/**\n * The richness of block colours, regardless of the hue.\n * Must be in the range of 0 (inclusive) to 1 (exclusive).\n */\nlet hsvSaturation = 0.45;\n\n/**\n * Get the richness of block colours, regardless of the hue.\n *\n * @returns The current richness.\n * @internal\n */\nexport function getHsvSaturation(): number {\n  return hsvSaturation;\n}\n\n/**\n * Set the richness of block colours, regardless of the hue.\n *\n * @param newSaturation The new richness, in the range of  0 (inclusive) to 1\n *     (exclusive)\n * @internal\n */\nexport function setHsvSaturation(newSaturation: number) {\n  hsvSaturation = newSaturation;\n}\n\n/**\n * The intensity of block colours, regardless of the hue.\n * Must be in the range of 0 (inclusive) to 1 (exclusive).\n */\nlet hsvValue = 0.65;\n\n/**\n * Get the intensity of block colours, regardless of the hue.\n *\n * @returns The current intensity.\n * @internal\n */\nexport function getHsvValue(): number {\n  return hsvValue;\n}\n\n/**\n * Set the intensity of block colours, regardless of the hue.\n *\n * @param newValue The new intensity, in the range of  0 (inclusive) to 1\n *     (exclusive)\n * @internal\n */\nexport function setHsvValue(newValue: number) {\n  hsvValue = newValue;\n}\n\n/**\n * Parses a colour from a string.\n * .parse('red') = '#ff0000'\n * .parse('#f00') = '#ff0000'\n * .parse('#ff0000') = '#ff0000'\n * .parse('0xff0000') = '#ff0000'\n * .parse('rgb(255, 0, 0)') = '#ff0000'\n *\n * @param str Colour in some CSS format.\n * @returns A string containing a hex representation of the colour, or null if\n *     can't be parsed.\n */\nexport function parse(str: string | number): string | null {\n  str = `${str}`.toLowerCase().trim();\n  let hex = names[str];\n  if (hex) {\n    // e.g. 'red'\n    return hex;\n  }\n  hex = str.substring(0, 2) === '0x' ? '#' + str.substring(2) : str;\n  hex = hex[0] === '#' ? hex : '#' + hex;\n  if (/^#[0-9a-f]{6}$/.test(hex)) {\n    // e.g. '#00ff88'\n    return hex;\n  }\n  if (/^#[0-9a-f]{3}$/.test(hex)) {\n    // e.g. '#0f8'\n    return ['#', hex[1], hex[1], hex[2], hex[2], hex[3], hex[3]].join('');\n  }\n  const rgb = str.match(/^(?:rgb)?\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/);\n  if (rgb) {\n    // e.g. 'rgb(0, 128, 255)'\n    const r = Number(rgb[1]);\n    const g = Number(rgb[2]);\n    const b = Number(rgb[3]);\n    if (r >= 0 && r < 256 && g >= 0 && g < 256 && b >= 0 && b < 256) {\n      return rgbToHex(r, g, b);\n    }\n  }\n  return null;\n}\n\n/**\n * Converts a colour from RGB to hex representation.\n *\n * @param r Amount of red, int between 0 and 255.\n * @param g Amount of green, int between 0 and 255.\n * @param b Amount of blue, int between 0 and 255.\n * @returns Hex representation of the colour.\n */\nexport function rgbToHex(r: number, g: number, b: number): string {\n  const rgb = (r << 16) | (g << 8) | b;\n  if (r < 0x10) {\n    return '#' + (0x1000000 | rgb).toString(16).substr(1);\n  }\n  return '#' + rgb.toString(16);\n}\n\n/**\n * Converts a colour to RGB.\n *\n * @param colour String representing colour in any colour format ('#ff0000',\n *     'red', '0xff000', etc).\n * @returns RGB representation of the colour.\n */\nexport function hexToRgb(colour: string): number[] {\n  const hex = parse(colour);\n  if (!hex) {\n    return [0, 0, 0];\n  }\n\n  const rgb = parseInt(hex.substr(1), 16);\n  const r = rgb >> 16;\n  const g = (rgb >> 8) & 255;\n  const b = rgb & 255;\n\n  return [r, g, b];\n}\n\n/**\n * Converts an HSV triplet to hex representation.\n *\n * @param h Hue value in [0, 360].\n * @param s Saturation value in [0, 1].\n * @param v Brightness in [0, 255].\n * @returns Hex representation of the colour.\n */\nexport function hsvToHex(h: number, s: number, v: number): string {\n  let red = 0;\n  let green = 0;\n  let blue = 0;\n  if (s === 0) {\n    red = v;\n    green = v;\n    blue = v;\n  } else {\n    const sextant = Math.floor(h / 60);\n    const remainder = h / 60 - sextant;\n    const val1 = v * (1 - s);\n    const val2 = v * (1 - s * remainder);\n    const val3 = v * (1 - s * (1 - remainder));\n    switch (sextant) {\n      case 1:\n        red = val2;\n        green = v;\n        blue = val1;\n        break;\n      case 2:\n        red = val1;\n        green = v;\n        blue = val3;\n        break;\n      case 3:\n        red = val1;\n        green = val2;\n        blue = v;\n        break;\n      case 4:\n        red = val3;\n        green = val1;\n        blue = v;\n        break;\n      case 5:\n        red = v;\n        green = val1;\n        blue = val2;\n        break;\n      case 6:\n      case 0:\n        red = v;\n        green = val3;\n        blue = val1;\n        break;\n    }\n  }\n  return rgbToHex(Math.floor(red), Math.floor(green), Math.floor(blue));\n}\n\n/**\n * Blend two colours together, using the specified factor to indicate the\n * weight given to the first colour.\n *\n * @param colour1 First colour.\n * @param colour2 Second colour.\n * @param factor The weight to be given to colour1 over colour2.\n *     Values should be in the range [0, 1].\n * @returns Combined colour represented in hex.\n */\nexport function blend(\n  colour1: string,\n  colour2: string,\n  factor: number,\n): string | null {\n  const hex1 = parse(colour1);\n  if (!hex1) {\n    return null;\n  }\n  const hex2 = parse(colour2);\n  if (!hex2) {\n    return null;\n  }\n  const rgb1 = hexToRgb(hex1);\n  const rgb2 = hexToRgb(hex2);\n  const r = Math.round(rgb2[0] + factor * (rgb1[0] - rgb2[0]));\n  const g = Math.round(rgb2[1] + factor * (rgb1[1] - rgb2[1]));\n  const b = Math.round(rgb2[2] + factor * (rgb1[2] - rgb2[2]));\n  return rgbToHex(r, g, b);\n}\n\n/**\n * A map that contains the 16 basic colour keywords as defined by W3C:\n * https://www.w3.org/TR/2018/REC-css-color-3-20180619/#html4\n * The keys of this map are the lowercase \"readable\" names of the colours,\n * while the values are the \"hex\" values.\n */\nexport const names: {[key: string]: string} = {\n  'aqua': '#00ffff',\n  'black': '#000000',\n  'blue': '#0000ff',\n  'fuchsia': '#ff00ff',\n  'gray': '#808080',\n  'green': '#008000',\n  'lime': '#00ff00',\n  'maroon': '#800000',\n  'navy': '#000080',\n  'olive': '#808000',\n  'purple': '#800080',\n  'red': '#ff0000',\n  'silver': '#c0c0c0',\n  'teal': '#008080',\n  'white': '#ffffff',\n  'yellow': '#ffff00',\n};\n\n/**\n * Convert a hue (HSV model) into an RGB hex triplet.\n *\n * @param hue Hue on a colour wheel (0-360).\n * @returns RGB code, e.g. '#5ba65b'.\n */\nexport function hueToHex(hue: number): string {\n  return hsvToHex(hue, hsvSaturation, hsvValue * 255);\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.parsing\n\nimport {Msg} from '../msg.js';\nimport * as colourUtils from './colour.js';\n\n/**\n * Internal implementation of the message reference and interpolation token\n * parsing used by tokenizeInterpolation() and replaceMessageReferences().\n *\n * @param message Text which might contain string table references and\n *     interpolation tokens.\n * @param parseInterpolationTokens Option to parse numeric interpolation\n *     tokens (%1, %2, ...) when true.\n * @param tokenizeNewlines Split individual newline characters into separate\n *     tokens when true.\n * @returns Array of strings and numbers.\n */\nfunction tokenizeInterpolationInternal(\n  message: string,\n  parseInterpolationTokens: boolean,\n  tokenizeNewlines: boolean,\n): (string | number)[] {\n  const tokens = [];\n  const chars = message.split('');\n  chars.push(''); // End marker.\n  // Parse the message with a finite state machine.\n  // 0 - Base case.\n  // 1 - % found.\n  // 2 - Digit found.\n  // 3 - Message ref found.\n  let state = 0;\n  const buffer = new Array<string>();\n  let number = null;\n  for (let i = 0; i < chars.length; i++) {\n    const c = chars[i];\n    if (state === 0) {\n      // Start escape.\n      if (c === '%') {\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n        state = 1;\n      } else if (tokenizeNewlines && c === '\\n') {\n        // Output newline characters as single-character tokens, to be replaced\n        // with endOfRow dummies during interpolation.\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n        tokens.push(c);\n      } else {\n        buffer.push(c); // Regular char.\n      }\n    } else if (state === 1) {\n      if (c === '%') {\n        buffer.push(c); // Escaped %: %%\n        state = 0;\n      } else if (parseInterpolationTokens && '0' <= c && c <= '9') {\n        state = 2;\n        number = c;\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n      } else if (c === '{') {\n        state = 3;\n      } else {\n        buffer.push('%', c); // Not recognized. Return as literal.\n        state = 0;\n      }\n    } else if (state === 2) {\n      if ('0' <= c && c <= '9') {\n        number += c; // Multi-digit number.\n      } else {\n        tokens.push(parseInt(number ?? '', 10));\n        i--; // Parse this char again.\n        state = 0;\n      }\n    } else if (state === 3) {\n      // String table reference\n      if (c === '') {\n        // Premature end before closing '}'\n        buffer.splice(0, 0, '%{'); // Re-insert leading delimiter\n        i--; // Parse this char again.\n        state = 0; // and parse as string literal.\n      } else if (c !== '}') {\n        buffer.push(c);\n      } else {\n        const rawKey = buffer.join('');\n        if (/[A-Z]\\w*/i.test(rawKey)) {\n          // Strict matching\n          // Found a valid string key. Attempt case insensitive match.\n          const keyUpper = rawKey.toUpperCase();\n\n          // BKY_ is the prefix used to namespace the strings used in\n          // Blockly core files and the predefined blocks in ../blocks/.\n          // These strings are defined in ../msgs/ files.\n          const bklyKey = keyUpper.startsWith('BKY_')\n            ? keyUpper.substring(4)\n            : null;\n          if (bklyKey && bklyKey in Msg) {\n            const rawValue = Msg[bklyKey];\n            if (typeof rawValue === 'string') {\n              // Attempt to dereference substrings, too, appending to the\n              // end.\n              Array.prototype.push.apply(\n                tokens,\n                tokenizeInterpolationInternal(\n                  rawValue,\n                  parseInterpolationTokens,\n                  tokenizeNewlines,\n                ),\n              );\n            } else if (parseInterpolationTokens) {\n              // When parsing interpolation tokens, numbers are special\n              // placeholders (%1, %2, etc). Make sure all other values are\n              // strings.\n              tokens.push(`${rawValue}`);\n            } else {\n              tokens.push(rawValue);\n            }\n          } else {\n            // No entry found in the string table. Pass reference as string.\n            tokens.push('%{' + rawKey + '}');\n          }\n          buffer.length = 0; // Clear the array\n          state = 0;\n        } else {\n          tokens.push('%{' + rawKey + '}');\n          buffer.length = 0;\n          state = 0; // and parse as string literal.\n        }\n      }\n    }\n  }\n  let text = buffer.join('');\n  if (text) {\n    tokens.push(text);\n  }\n\n  // Merge adjacent text tokens into a single string (but if newlines should be\n  // tokenized, don't merge those with adjacent text).\n  const mergedTokens = [];\n  buffer.length = 0;\n  for (let i = 0; i < tokens.length; i++) {\n    if (\n      typeof tokens[i] === 'string' &&\n      !(tokenizeNewlines && tokens[i] === '\\n')\n    ) {\n      buffer.push(tokens[i] as string);\n    } else {\n      text = buffer.join('');\n      if (text) {\n        mergedTokens.push(text);\n      }\n      buffer.length = 0;\n      mergedTokens.push(tokens[i]);\n    }\n  }\n  text = buffer.join('');\n  if (text) {\n    mergedTokens.push(text);\n  }\n  buffer.length = 0;\n\n  return mergedTokens;\n}\n\n/**\n * Parse a string with any number of interpolation tokens (%1, %2, ...).\n * It will also replace string table references (e.g., %{bky_my_msg} and\n * %{BKY_MY_MSG} will both be replaced with the value in\n * Msg['MY_MSG']). Percentage sign characters '%' may be self-escaped\n * (e.g., '%%'). Newline characters will also be output as string tokens\n * containing a single newline character.\n *\n * @param message Text which might contain string table references and\n *     interpolation tokens.\n * @returns Array of strings and numbers.\n */\nexport function tokenizeInterpolation(message: string): (string | number)[] {\n  return tokenizeInterpolationInternal(message, true, true);\n}\n\n/**\n * Replaces string table references in a message, if the message is a string.\n * For example, \"%{bky_my_msg}\" and \"%{BKY_MY_MSG}\" will both be replaced with\n * the value in Msg['MY_MSG'].\n *\n * @param message Message, which may be a string that contains\n *     string table references.\n * @returns String with message references replaced.\n */\nexport function replaceMessageReferences(message: string | any): string {\n  if (typeof message !== 'string') {\n    return message;\n  }\n  const interpolatedResult = tokenizeInterpolationInternal(\n    message,\n    false,\n    false,\n  );\n  // When parseInterpolationTokens and tokenizeNewlines are false,\n  // interpolatedResult should be at most length 1.\n  return interpolatedResult.length ? String(interpolatedResult[0]) : '';\n}\n\n/**\n * Validates that any %{MSG_KEY} references in the message refer to keys of\n * the Msg string table.\n *\n * @param message Text which might contain string table references.\n * @returns True if all message references have matching values.\n *     Otherwise, false.\n */\nexport function checkMessageReferences(message: string): boolean {\n  let validSoFar = true;\n\n  const msgTable = Msg;\n  // TODO (#1169): Implement support for other string tables,\n  // prefixes other than BKY_.\n  const m = message.match(/%{BKY_[A-Z]\\w*}/gi);\n  if (m) {\n    for (let i = 0; i < m.length; i++) {\n      const msgKey = m[i].toUpperCase();\n      if (msgTable[msgKey.slice(6, -1)] === undefined) {\n        console.warn('No message string for ' + m[i] + ' in ' + message);\n        validSoFar = false; // Continue to report other errors.\n      }\n    }\n  }\n\n  return validSoFar;\n}\n\n/**\n * Parse a block colour from a number or string, as provided in a block\n * definition.\n *\n * @param colour HSV hue value (0 to 360), #RRGGBB string,\n *     or a message reference string pointing to one of those two values.\n * @returns An object containing the colour as\n *     a #RRGGBB string, and the hue if the input was an HSV hue value.\n * @throws {Error} If the colour cannot be parsed.\n */\nexport function parseBlockColour(colour: number | string): {\n  hue: number | null;\n  hex: string;\n} {\n  const dereferenced =\n    typeof colour === 'string' ? replaceMessageReferences(colour) : colour;\n\n  const hue = Number(dereferenced);\n  if (!isNaN(hue) && 0 <= hue && hue <= 360) {\n    return {\n      hue: hue,\n      hex: colourUtils.hsvToHex(\n        hue,\n        colourUtils.getHsvSaturation(),\n        colourUtils.getHsvValue() * 255,\n      ),\n    };\n  } else {\n    const hex = colourUtils.parse(dereferenced);\n    if (hex) {\n      // Only store hue if colour is set as a hue.\n      return {hue: null, hex: hex};\n    } else {\n      let errorMsg = 'Invalid colour: \"' + dereferenced + '\"';\n      if (colour !== dereferenced) {\n        errorMsg += ' (from \"' + colour + '\")';\n      }\n      throw Error(errorMsg);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.WidgetDiv\n\nimport * as common from './common.js';\nimport {Field} from './field.js';\nimport * as dom from './utils/dom.js';\nimport type {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/** The object currently using this container. */\nlet owner: unknown = null;\n\n/** The workspace associated with the owner currently using this container. */\nlet ownerWorkspace: WorkspaceSvg | null = null;\n\n/** Optional cleanup function set by whichever object uses the widget. */\nlet dispose: (() => void) | null = null;\n\n/** A class name representing the current owner's workspace container. */\nconst containerClassName = 'blocklyWidgetDiv';\n\n/** A class name representing the current owner's workspace renderer. */\nlet rendererClassName = '';\n\n/** A class name representing the current owner's workspace theme. */\nlet themeClassName = '';\n\n/** The HTML container for popup overlays (e.g. editor widgets). */\nlet containerDiv: HTMLDivElement | null;\n\n/**\n * Returns the HTML container for editor widgets.\n *\n * @returns The editor widget container.\n */\nexport function getDiv(): HTMLDivElement | null {\n  return containerDiv;\n}\n\n/**\n * Allows unit tests to reset the div. Do not use outside of tests.\n *\n * @param newDiv The new value for the DIV field.\n * @internal\n */\nexport function testOnly_setDiv(newDiv: HTMLDivElement | null) {\n  containerDiv = newDiv;\n  if (newDiv === null) {\n    document.querySelector('.' + containerClassName)?.remove();\n  }\n}\n\n/**\n * Create the widget div and inject it onto the page.\n */\nexport function createDom() {\n  const container = common.getParentContainer() || document.body;\n\n  if (document.querySelector('.' + containerClassName)) {\n    containerDiv = document.querySelector('.' + containerClassName);\n  } else {\n    containerDiv = document.createElement('div') as HTMLDivElement;\n    containerDiv.className = containerClassName;\n  }\n\n  container.appendChild(containerDiv!);\n}\n\n/**\n * Initialize and display the widget div.  Close the old one if needed.\n *\n * @param newOwner The object that will be using this container.\n * @param rtl Right-to-left (true) or left-to-right (false).\n * @param newDispose Optional cleanup function to be run when the widget is\n *     closed.\n * @param workspace The workspace associated with the widget owner.\n */\nexport function show(\n  newOwner: unknown,\n  rtl: boolean,\n  newDispose: () => void,\n  workspace?: WorkspaceSvg | null,\n) {\n  hide();\n  owner = newOwner;\n  dispose = newDispose;\n  const div = containerDiv;\n  if (!div) return;\n  div.style.direction = rtl ? 'rtl' : 'ltr';\n  div.style.display = 'block';\n  if (!workspace && newOwner instanceof Field) {\n    // For backward compatibility with plugin fields that do not provide a\n    // workspace to this function, attempt to derive it from the field.\n    workspace = (newOwner as Field).getSourceBlock()?.workspace as WorkspaceSvg;\n  }\n  ownerWorkspace = workspace ?? null;\n  const rendererWorkspace =\n    workspace ?? (common.getMainWorkspace() as WorkspaceSvg);\n  rendererClassName = rendererWorkspace.getRenderer().getClassName();\n  themeClassName = rendererWorkspace.getTheme().getClassName();\n  if (rendererClassName) {\n    dom.addClass(div, rendererClassName);\n  }\n  if (themeClassName) {\n    dom.addClass(div, themeClassName);\n  }\n}\n\n/**\n * Destroy the widget and hide the div.\n */\nexport function hide() {\n  if (!isVisible()) {\n    return;\n  }\n  owner = null;\n\n  const div = containerDiv;\n  if (!div) return;\n  div.style.display = 'none';\n  div.style.left = '';\n  div.style.top = '';\n  if (dispose) dispose();\n  dispose = null;\n  div.textContent = '';\n\n  if (rendererClassName) {\n    dom.removeClass(div, rendererClassName);\n    rendererClassName = '';\n  }\n  if (themeClassName) {\n    dom.removeClass(div, themeClassName);\n    themeClassName = '';\n  }\n  (common.getMainWorkspace() as WorkspaceSvg).markFocused();\n}\n\n/**\n * Is the container visible?\n *\n * @returns True if visible.\n */\nexport function isVisible(): boolean {\n  return !!owner;\n}\n\n/**\n * Destroy the widget and hide the div if it is being used by the specified\n * object.\n *\n * @param oldOwner The object that was using this container.\n */\nexport function hideIfOwner(oldOwner: unknown) {\n  if (owner === oldOwner) {\n    hide();\n  }\n}\n\n/**\n * Destroy the widget and hide the div if it is being used by an object in the\n * specified workspace, or if it is used by an unknown workspace.\n *\n * @param oldOwnerWorkspace The workspace that was using this container.\n */\nexport function hideIfOwnerIsInWorkspace(oldOwnerWorkspace: WorkspaceSvg) {\n  if (ownerWorkspace === null || ownerWorkspace === oldOwnerWorkspace) {\n    hide();\n  }\n}\n\n/**\n * Set the widget div's position and height.  This function does nothing clever:\n * it will not ensure that your widget div ends up in the visible window.\n *\n * @param x Horizontal location (window coordinates, not body).\n * @param y Vertical location (window coordinates, not body).\n * @param height The height of the widget div (pixels).\n */\nfunction positionInternal(x: number, y: number, height: number) {\n  containerDiv!.style.left = x + 'px';\n  containerDiv!.style.top = y + 'px';\n  containerDiv!.style.height = height + 'px';\n}\n\n/**\n * Position the widget div based on an anchor rectangle.\n * The widget should be placed adjacent to but not overlapping the anchor\n * rectangle.  The preferred position is directly below and aligned to the left\n * (LTR) or right (RTL) side of the anchor.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The size of the widget that is inside the widget div, in\n *     window coordinates.\n * @param rtl Whether the workspace is in RTL mode.  This determines horizontal\n *     alignment.\n * @internal\n */\nexport function positionWithAnchor(\n  viewportBBox: Rect,\n  anchorBBox: Rect,\n  widgetSize: Size,\n  rtl: boolean,\n) {\n  const y = calculateY(viewportBBox, anchorBBox, widgetSize);\n  const x = calculateX(viewportBBox, anchorBBox, widgetSize, rtl);\n\n  if (y < 0) {\n    positionInternal(x, 0, widgetSize.height + y);\n  } else {\n    positionInternal(x, y, widgetSize.height);\n  }\n}\n\n/**\n * Calculate an x position (in window coordinates) such that the widget will not\n * be offscreen on the right or left.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The dimensions of the widget inside the widget div.\n * @param rtl Whether the Blockly workspace is in RTL mode.\n * @returns A valid x-coordinate for the top left corner of the widget div, in\n *     window coordinates.\n */\nfunction calculateX(\n  viewportBBox: Rect,\n  anchorBBox: Rect,\n  widgetSize: Size,\n  rtl: boolean,\n): number {\n  if (rtl) {\n    // Try to align the right side of the field and the right side of widget.\n    const widgetLeft = anchorBBox.right - widgetSize.width;\n    // Don't go offscreen left.\n    const x = Math.max(widgetLeft, viewportBBox.left);\n    // But really don't go offscreen right:\n    return Math.min(x, viewportBBox.right - widgetSize.width);\n  } else {\n    // Try to align the left side of the field and the left side of widget.\n    // Don't go offscreen right.\n    const x = Math.min(anchorBBox.left, viewportBBox.right - widgetSize.width);\n    // But left is more important, because that's where the text is.\n    return Math.max(x, viewportBBox.left);\n  }\n}\n\n/**\n * Calculate a y position (in window coordinates) such that the widget will not\n * be offscreen on the top or bottom.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The dimensions of the widget inside the widget div.\n * @returns A valid y-coordinate for the top left corner of the widget div, in\n *     window coordinates.\n */\nfunction calculateY(\n  viewportBBox: Rect,\n  anchorBBox: Rect,\n  widgetSize: Size,\n): number {\n  // Flip the widget vertically if off the bottom.\n  // The widget could go off the top of the window, but it would also go off\n  // the bottom.  The window is just too small.\n  if (anchorBBox.bottom + widgetSize.height >= viewportBBox.bottom) {\n    // The bottom of the widget is at the top of the field.\n    return anchorBBox.top - widgetSize.height;\n  } else {\n    // The top of the widget is at the bottom of the field.\n    return anchorBBox.bottom;\n  }\n}\n\n/**\n * Determine if the owner is a field for purposes of repositioning.\n * We can't simply check `instanceof Field` as that would introduce a circular\n * dependency.\n */\nfunction isRepositionable(item: any): item is Field {\n  return !!item?.repositionForWindowResize;\n}\n\n/**\n * Reposition the widget div if the owner of it says to.\n * If the owner isn't a field, just give up and hide it.\n */\nexport function repositionForWindowResize(): void {\n  if (!isRepositionable(owner) || !owner.repositionForWindowResize()) {\n    // If the owner is not a Field, or if the owner returns false from the\n    // reposition method, we should hide the widget div. Otherwise, we'll assume\n    // the owner handled any needed resize.\n    hide();\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ContextMenu\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport type {\n  ContextMenuOption,\n  LegacyContextMenuOption,\n} from './contextmenu_registry.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport * as serializationBlocks from './serialization/blocks.js';\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\n\n/**\n * Which block is the context menu attached to?\n */\nlet currentBlock: Block | null = null;\n\nconst dummyOwner = {};\n\n/**\n * Gets the block the context menu is currently attached to.\n *\n * @returns The block the context menu is attached to.\n */\nexport function getCurrentBlock(): Block | null {\n  return currentBlock;\n}\n\n/**\n * Sets the block the context menu is currently attached to.\n *\n * @param block The block the context menu is attached to.\n */\nexport function setCurrentBlock(block: Block | null) {\n  currentBlock = block;\n}\n\n/**\n * Menu object.\n */\nlet menu_: Menu | null = null;\n\n/**\n * Construct the menu based on the list of options and show the menu.\n *\n * @param e Mouse event.\n * @param options Array of menu options.\n * @param rtl True if RTL, false if LTR.\n * @param workspace The workspace associated with the context menu, if any.\n */\nexport function show(\n  e: PointerEvent,\n  options: (ContextMenuOption | LegacyContextMenuOption)[],\n  rtl: boolean,\n  workspace?: WorkspaceSvg,\n) {\n  WidgetDiv.show(dummyOwner, rtl, dispose, workspace);\n  if (!options.length) {\n    hide();\n    return;\n  }\n  const menu = populate_(options, rtl, e);\n  menu_ = menu;\n\n  position_(menu, e, rtl);\n  // 1ms delay is required for focusing on context menus because some other\n  // mouse event is still waiting in the queue and clears focus.\n  setTimeout(function () {\n    menu.focus();\n  }, 1);\n  currentBlock = null; // May be set by Blockly.Block.\n}\n\n/**\n * Create the context menu object and populate it with the given options.\n *\n * @param options Array of menu options.\n * @param rtl True if RTL, false if LTR.\n * @param e The event that triggered the context menu to open.\n * @returns The menu that will be shown on right click.\n */\nfunction populate_(\n  options: (ContextMenuOption | LegacyContextMenuOption)[],\n  rtl: boolean,\n  e: PointerEvent,\n): Menu {\n  /* Here's what one option object looks like:\n      {text: 'Make It So',\n       enabled: true,\n       callback: Blockly.MakeItSo}\n    */\n  const menu = new Menu();\n  menu.setRole(aria.Role.MENU);\n  for (let i = 0; i < options.length; i++) {\n    const option = options[i];\n    const menuItem = new MenuItem(option.text);\n    menuItem.setRightToLeft(rtl);\n    menuItem.setRole(aria.Role.MENUITEM);\n    menu.addChild(menuItem);\n    menuItem.setEnabled(option.enabled);\n    if (option.enabled) {\n      const actionHandler = function () {\n        hide();\n        requestAnimationFrame(() => {\n          setTimeout(() => {\n            // If .scope does not exist on the option, then the callback\n            // will not be expecting a scope parameter, so there should be\n            // no problems. Just assume it is a ContextMenuOption and we'll\n            // pass undefined if it's not.\n            option.callback((option as ContextMenuOption).scope, e);\n          }, 0);\n        });\n      };\n      menuItem.onAction(actionHandler, {});\n    }\n  }\n  return menu;\n}\n\n/**\n * Add the menu to the page and position it correctly.\n *\n * @param menu The menu to add and position.\n * @param e Mouse event for the right click that is making the context\n *     menu appear.\n * @param rtl True if RTL, false if LTR.\n */\nfunction position_(menu: Menu, e: Event, rtl: boolean) {\n  // Record windowSize and scrollOffset before adding menu.\n  const viewportBBox = svgMath.getViewportBBox();\n  const mouseEvent = e as MouseEvent;\n  // This one is just a point, but we'll pretend that it's a rect so we can use\n  // some helper functions.\n  const anchorBBox = new Rect(\n    mouseEvent.clientY + viewportBBox.top,\n    mouseEvent.clientY + viewportBBox.top,\n    mouseEvent.clientX + viewportBBox.left,\n    mouseEvent.clientX + viewportBBox.left,\n  );\n\n  createWidget_(menu);\n  const menuSize = menu.getSize();\n\n  if (rtl) {\n    anchorBBox.left += menuSize.width;\n    anchorBBox.right += menuSize.width;\n    viewportBBox.left += menuSize.width;\n    viewportBBox.right += menuSize.width;\n  }\n\n  WidgetDiv.positionWithAnchor(viewportBBox, anchorBBox, menuSize, rtl);\n  // Calling menuDom.focus() has to wait until after the menu has been placed\n  // correctly.  Otherwise it will cause a page scroll to get the misplaced menu\n  // in view.  See issue #1329.\n  menu.focus();\n}\n\n/**\n * Create and render the menu widget inside Blockly's widget div.\n *\n * @param menu The menu to add to the widget div.\n */\nfunction createWidget_(menu: Menu) {\n  const div = WidgetDiv.getDiv();\n  if (!div) {\n    throw Error('Attempting to create a context menu when widget div is null');\n  }\n  const menuDom = menu.render(div);\n  dom.addClass(menuDom, 'blocklyContextMenu');\n  // Prevent system context menu when right-clicking a Blockly context menu.\n  browserEvents.conditionalBind(\n    menuDom as EventTarget,\n    'contextmenu',\n    null,\n    haltPropagation,\n  );\n  // Focus only after the initial render to avoid issue #1329.\n  menu.focus();\n}\n/**\n * Halts the propagation of the event without doing anything else.\n *\n * @param e An event.\n */\nfunction haltPropagation(e: Event) {\n  // This event has been handled.  No need to bubble up to the document.\n  e.preventDefault();\n  e.stopPropagation();\n}\n\n/**\n * Hide the context menu.\n */\nexport function hide() {\n  WidgetDiv.hideIfOwner(dummyOwner);\n  currentBlock = null;\n}\n\n/**\n * Dispose of the menu.\n */\nexport function dispose() {\n  if (menu_) {\n    menu_.dispose();\n    menu_ = null;\n  }\n}\n\n/**\n * Create a callback function that creates and configures a block,\n *   then places the new block next to the original and returns it.\n *\n * @param block Original block.\n * @param state XML or JSON object representation of the new block.\n * @returns Function that creates a block.\n */\nexport function callbackFactory(\n  block: Block,\n  state: Element | serializationBlocks.State,\n): () => BlockSvg {\n  return () => {\n    eventUtils.disable();\n    let newBlock: BlockSvg;\n    try {\n      if (state instanceof Element) {\n        newBlock = Xml.domToBlockInternal(state, block.workspace!) as BlockSvg;\n      } else {\n        newBlock = serializationBlocks.appendInternal(\n          state,\n          block.workspace,\n        ) as BlockSvg;\n      }\n      // Move the new block next to the old block.\n      const xy = block.getRelativeToSurfaceXY();\n      if (block.RTL) {\n        xy.x -= config.snapRadius;\n      } else {\n        xy.x += config.snapRadius;\n      }\n      xy.y += config.snapRadius * 2;\n      newBlock.moveBy(xy.x, xy.y);\n    } finally {\n      eventUtils.enable();\n    }\n    if (eventUtils.isEnabled() && !newBlock.isShadow()) {\n      eventUtils.fire(new (eventUtils.get(EventType.BLOCK_CREATE))(newBlock));\n    }\n    common.setSelected(newBlock);\n    return newBlock;\n  };\n}\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as browserEvents from '../browser_events.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport {Coordinate} from './coordinate.js';\n\nconst workspaceToDragDelta: WeakMap<WorkspaceSvg, Coordinate> = new WeakMap();\n\n/**\n * Convert from mouse coordinates to workspace coordinates.\n *\n * @param workspace The workspace where the pointer event is occurring.\n * @param e The pointer event with the source coordinates.\n */\nfunction mouseToWorkspacePoint(\n  workspace: WorkspaceSvg,\n  e: PointerEvent,\n): SVGPoint {\n  const point = browserEvents.mouseToSvg(\n    e,\n    workspace.getParentSvg(),\n    workspace.getInverseScreenCTM(),\n  );\n  // Fix scale of mouse event.\n  point.x /= workspace.scale;\n  point.y /= workspace.scale;\n  return point;\n}\n\n/**\n * Start tracking a drag of an object on this workspace by recording the offset\n * between the pointer's current location and the object's starting location.\n *\n * Used for resizing block comments and workspace comments.\n *\n * @param workspace The workspace where the drag is occurring.\n * @param e Pointer down event.\n * @param xy Starting location of object.\n */\nexport function start(\n  workspace: WorkspaceSvg,\n  e: PointerEvent,\n  xy: Coordinate,\n) {\n  const point = mouseToWorkspacePoint(workspace, e);\n  // Record the starting offset between the bubble's location and the mouse.\n  workspaceToDragDelta.set(workspace, Coordinate.difference(xy, point));\n}\n\n/**\n * Compute the new position of a dragged object in this workspace based on the\n * current pointer position and the offset between the pointer's starting\n * location and the object's starting location.\n *\n * The start function should have be called previously, when the drag started.\n *\n * Used for resizing block comments and workspace comments.\n *\n * @param workspace The workspace where the drag is occurring.\n * @param e Pointer move event.\n * @returns New location of object.\n */\nexport function move(workspace: WorkspaceSvg, e: PointerEvent): Coordinate {\n  const point = mouseToWorkspacePoint(workspace, e);\n  const dragDelta = workspaceToDragDelta.get(workspace);\n  if (!dragDelta) {\n    throw new Error('Drag not initialized');\n  }\n  return Coordinate.sum(dragDelta, point);\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Xml\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport {RenderedWorkspaceComment} from './comments/rendered_workspace_comment.js';\nimport {WorkspaceComment} from './comments/workspace_comment.js';\nimport type {Connection} from './connection.js';\nimport {MANUALLY_DISABLED} from './constants.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport {IconType} from './icons/icon_types.js';\nimport {inputTypes} from './inputs/input_types.js';\nimport * as renderManagement from './render_management.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Size} from './utils/size.js';\nimport * as utilsXml from './utils/xml.js';\nimport type {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Encode a block tree as XML.\n *\n * @param workspace The workspace containing blocks.\n * @param skipId True if the encoder should skip the block IDs. False by\n *     default.\n * @returns XML DOM element.\n */\nexport function workspaceToDom(workspace: Workspace, skipId = false): Element {\n  const treeXml = utilsXml.createElement('xml');\n  const variablesElement = variablesToDom(\n    Variables.allUsedVarModels(workspace),\n  );\n  if (variablesElement.hasChildNodes()) {\n    treeXml.appendChild(variablesElement);\n  }\n  for (const comment of workspace.getTopComments()) {\n    treeXml.appendChild(\n      saveWorkspaceComment(comment as AnyDuringMigration, skipId),\n    );\n  }\n  const blocks = workspace.getTopBlocks(true);\n  for (let i = 0; i < blocks.length; i++) {\n    const block = blocks[i];\n    treeXml.appendChild(blockToDomWithXY(block, skipId));\n  }\n  return treeXml;\n}\n\n/** Serializes the given workspace comment to XML. */\nexport function saveWorkspaceComment(\n  comment: WorkspaceComment,\n  skipId = false,\n): Element {\n  const elem = utilsXml.createElement('comment');\n  if (!skipId) elem.setAttribute('id', comment.id);\n\n  const workspace = comment.workspace;\n  const loc = comment.getRelativeToSurfaceXY();\n  loc.x = workspace.RTL ? workspace.getWidth() - loc.x : loc.x;\n  elem.setAttribute('x', `${loc.x}`);\n  elem.setAttribute('y', `${loc.y}`);\n  elem.setAttribute('w', `${comment.getSize().width}`);\n  elem.setAttribute('h', `${comment.getSize().height}`);\n\n  if (comment.getText()) elem.textContent = comment.getText();\n  if (comment.isCollapsed()) elem.setAttribute('collapsed', 'true');\n  if (!comment.isOwnEditable()) elem.setAttribute('editable', 'false');\n  if (!comment.isOwnMovable()) elem.setAttribute('movable', 'false');\n  if (!comment.isOwnDeletable()) elem.setAttribute('deletable', 'false');\n\n  return elem;\n}\n\n/**\n * Encode a list of variables as XML.\n *\n * @param variableList List of all variable models.\n * @returns Tree of XML elements.\n */\nexport function variablesToDom(variableList: VariableModel[]): Element {\n  const variables = utilsXml.createElement('variables');\n  for (let i = 0; i < variableList.length; i++) {\n    const variable = variableList[i];\n    const element = utilsXml.createElement('variable');\n    element.appendChild(utilsXml.createTextNode(variable.name));\n    if (variable.type) {\n      element.setAttribute('type', variable.type);\n    }\n    element.id = variable.getId();\n    variables.appendChild(element);\n  }\n  return variables;\n}\n\n/**\n * Encode a block subtree as XML with XY coordinates.\n *\n * @param block The root block to encode.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns Tree of XML elements or an empty document fragment if the block was\n *     an insertion marker.\n */\nexport function blockToDomWithXY(\n  block: Block,\n  opt_noId?: boolean,\n): Element | DocumentFragment {\n  if (block.isInsertionMarker()) {\n    // Skip over insertion markers.\n    block = block.getChildren(false)[0];\n    if (!block) {\n      // Disappears when appended.\n      return new DocumentFragment();\n    }\n  }\n\n  let width = 0; // Not used in LTR.\n  if (block.workspace.RTL) {\n    width = block.workspace.getWidth();\n  }\n\n  const element = blockToDom(block, opt_noId);\n  if (isElement(element)) {\n    const xy = block.getRelativeToSurfaceXY();\n    element.setAttribute(\n      'x',\n      String(Math.round(block.workspace.RTL ? width - xy.x : xy.x)),\n    );\n    element.setAttribute('y', String(Math.round(xy.y)));\n  }\n  return element;\n}\n\n/**\n * Encode a field as XML.\n *\n * @param field The field to encode.\n * @returns XML element, or null if the field did not need to be serialized.\n */\nfunction fieldToDom(field: Field): Element | null {\n  if (field.isSerializable()) {\n    const container = utilsXml.createElement('field');\n    container.setAttribute('name', field.name || '');\n    return field.toXml(container);\n  }\n  return null;\n}\n\n/**\n * Encode all of a block's fields as XML and attach them to the given tree of\n * XML elements.\n *\n * @param block A block with fields to be encoded.\n * @param element The XML element to which the field DOM should be attached.\n */\nfunction allFieldsToDom(block: Block, element: Element) {\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    for (let j = 0; j < input.fieldRow.length; j++) {\n      const field = input.fieldRow[j];\n      const fieldDom = fieldToDom(field);\n      if (fieldDom) {\n        element.appendChild(fieldDom);\n      }\n    }\n  }\n}\n\n/**\n * Encode a block subtree as XML.\n *\n * @param block The root block to encode.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns Tree of XML elements or an empty document fragment if the block was\n *     an insertion marker.\n */\nexport function blockToDom(\n  block: Block,\n  opt_noId?: boolean,\n): Element | DocumentFragment {\n  // Skip over insertion markers.\n  if (block.isInsertionMarker()) {\n    const child = block.getChildren(false)[0];\n    if (child) {\n      return blockToDom(child);\n    } else {\n      // Disappears when appended.\n      return new DocumentFragment();\n    }\n  }\n\n  const element = utilsXml.createElement(block.isShadow() ? 'shadow' : 'block');\n  element.setAttribute('type', block.type);\n  if (!opt_noId) {\n    element.id = block.id;\n  }\n  if (block.mutationToDom) {\n    // Custom data for an advanced block.\n    const mutation = block.mutationToDom();\n    if (mutation && (mutation.hasChildNodes() || mutation.hasAttributes())) {\n      element.appendChild(mutation);\n    }\n  }\n\n  allFieldsToDom(block, element);\n\n  const commentText = block.getCommentText();\n  if (commentText) {\n    const comment = block.getIcon(IconType.COMMENT)!;\n    const size = comment.getBubbleSize();\n    const pinned = comment.bubbleIsVisible();\n\n    const commentElement = utilsXml.createElement('comment');\n    commentElement.appendChild(utilsXml.createTextNode(commentText));\n    commentElement.setAttribute('pinned', `${pinned}`);\n    commentElement.setAttribute('h', String(size.height));\n    commentElement.setAttribute('w', String(size.width));\n\n    element.appendChild(commentElement);\n  }\n\n  if (block.data) {\n    const dataElement = utilsXml.createElement('data');\n    dataElement.appendChild(utilsXml.createTextNode(block.data));\n    element.appendChild(dataElement);\n  }\n\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    let container: Element;\n    let empty = true;\n    if (input.type === inputTypes.DUMMY || input.type === inputTypes.END_ROW) {\n      continue;\n    } else {\n      const childBlock = input.connection!.targetBlock();\n      if (input.type === inputTypes.VALUE) {\n        container = utilsXml.createElement('value');\n      } else if (input.type === inputTypes.STATEMENT) {\n        container = utilsXml.createElement('statement');\n      }\n      const childShadow = input.connection!.getShadowDom();\n      if (childShadow && (!childBlock || !childBlock.isShadow())) {\n        container!.appendChild(cloneShadow(childShadow, opt_noId));\n      }\n      if (childBlock) {\n        const childElem = blockToDom(childBlock, opt_noId);\n        if (childElem.nodeType === dom.NodeType.ELEMENT_NODE) {\n          container!.appendChild(childElem);\n          empty = false;\n        }\n      }\n    }\n    container!.setAttribute('name', input.name);\n    if (!empty) {\n      element.appendChild(container!);\n    }\n  }\n  if (\n    block.inputsInline !== undefined &&\n    block.inputsInline !== block.inputsInlineDefault\n  ) {\n    element.setAttribute('inline', String(block.inputsInline));\n  }\n  if (block.isCollapsed()) {\n    element.setAttribute('collapsed', 'true');\n  }\n  if (!block.isEnabled()) {\n    // Set the value of the attribute to a comma-separated list of reasons.\n    // Use encodeURIComponent to escape commas in the reasons so that they\n    // won't be confused with separator commas.\n    element.setAttribute(\n      'disabled-reasons',\n      Array.from(block.getDisabledReasons()).map(encodeURIComponent).join(','),\n    );\n  }\n  if (!block.isOwnDeletable()) {\n    element.setAttribute('deletable', 'false');\n  }\n  if (!block.isOwnMovable()) {\n    element.setAttribute('movable', 'false');\n  }\n  if (!block.isOwnEditable()) {\n    element.setAttribute('editable', 'false');\n  }\n\n  const nextBlock = block.getNextBlock();\n  let container: Element;\n  if (nextBlock) {\n    const nextElem = blockToDom(nextBlock, opt_noId);\n    if (nextElem.nodeType === dom.NodeType.ELEMENT_NODE) {\n      container = utilsXml.createElement('next');\n      container.appendChild(nextElem);\n      element.appendChild(container);\n    }\n  }\n  const nextShadow =\n    block.nextConnection && block.nextConnection.getShadowDom();\n  if (nextShadow && (!nextBlock || !nextBlock.isShadow())) {\n    container!.appendChild(cloneShadow(nextShadow, opt_noId));\n  }\n\n  return element;\n}\n\n/**\n * Deeply clone the shadow's DOM so that changes don't back-wash to the block.\n *\n * @param shadow A tree of XML elements.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns A tree of XML elements.\n */\nfunction cloneShadow(shadow: Element, opt_noId?: boolean): Element {\n  shadow = shadow.cloneNode(true) as Element;\n  // Walk the tree looking for whitespace.  Don't prune whitespace in a tag.\n  let node: Node | null = shadow;\n  let textNode;\n  while (node) {\n    if (opt_noId && node.nodeName === 'shadow') {\n      // Strip off IDs from shadow blocks.  There should never be a 'block' as\n      // a child of a 'shadow', so no need to check that.\n      (node as Element).removeAttribute('id');\n    }\n    if (node.firstChild) {\n      node = node.firstChild;\n    } else {\n      while (node && !node.nextSibling) {\n        textNode = node;\n        node = node.parentNode;\n        if (\n          textNode.nodeType === dom.NodeType.TEXT_NODE &&\n          (textNode as Text).data.trim() === '' &&\n          node?.firstChild !== textNode\n        ) {\n          // Prune whitespace after a tag.\n          dom.removeNode(textNode);\n        }\n      }\n      if (node) {\n        textNode = node;\n        node = node.nextSibling;\n        if (\n          textNode.nodeType === dom.NodeType.TEXT_NODE &&\n          (textNode as Text).data.trim() === ''\n        ) {\n          // Prune whitespace before a tag.\n          dom.removeNode(textNode);\n        }\n      }\n    }\n  }\n  return shadow;\n}\n\n/**\n * Converts a DOM structure into plain text.\n * Currently the text format is fairly ugly: all one line with no whitespace,\n * unless the DOM itself has whitespace built-in.\n *\n * @param dom A tree of XML nodes.\n * @returns Text representation.\n */\nexport function domToText(dom: Node): string {\n  const text = utilsXml.domToText(dom);\n  // Unpack self-closing tags.  These tags fail when embedded in HTML.\n  // <block name=\"foo\"/> -> <block name=\"foo\"></block>\n  return text.replace(/<(\\w+)([^<]*)\\/>/g, '<$1$2></$1>');\n}\n\n/**\n * Converts a DOM structure into properly indented text.\n *\n * @param dom A tree of XML elements.\n * @returns Text representation.\n */\nexport function domToPrettyText(dom: Node): string {\n  // This function is not guaranteed to be correct for all XML.\n  // But it handles the XML that Blockly generates.\n  const blob = domToText(dom);\n  // Place every open and close tag on its own line.\n  const lines = blob.split('<');\n  // Indent every line.\n  let indent = '';\n  for (let i = 1; i < lines.length; i++) {\n    const line = lines[i];\n    if (line[0] === '/') {\n      indent = indent.substring(2);\n    }\n    lines[i] = indent + '<' + line;\n    if (line[0] !== '/' && line.slice(-2) !== '/>') {\n      indent += '  ';\n    }\n  }\n  // Pull simple tags back together.\n  // E.g. <foo></foo>\n  let text = lines.join('\\n');\n  text = text.replace(/(<(\\w+)\\b[^>]*>[^\\n]*)\\n *<\\/\\2>/g, '$1</$2>');\n  // Trim leading blank line.\n  return text.replace(/^\\n/, '');\n}\n\n/**\n * Clear the given workspace then decode an XML DOM and\n * create blocks on the workspace.\n *\n * @param xml XML DOM.\n * @param workspace The workspace.\n * @returns An array containing new block IDs.\n */\nexport function clearWorkspaceAndLoadFromXml(\n  xml: Element,\n  workspace: WorkspaceSvg,\n): string[] {\n  workspace.setResizesEnabled(false);\n  workspace.clear();\n  const blockIds = domToWorkspace(xml, workspace);\n  workspace.setResizesEnabled(true);\n  return blockIds;\n}\n\n/**\n * Decode an XML DOM and create blocks on the workspace.\n *\n * @param xml XML DOM.\n * @param workspace The workspace.\n * @returns An array containing new block IDs.\n */\nexport function domToWorkspace(xml: Element, workspace: Workspace): string[] {\n  let width = 0; // Not used in LTR.\n  if (workspace.RTL) {\n    width = workspace.getWidth();\n  }\n  const newBlockIds = []; // A list of block IDs added by this call.\n  dom.startTextWidthCache();\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n\n  // Disable workspace resizes as an optimization.\n  // Assume it is rendered so we can check.\n  if ((workspace as WorkspaceSvg).setResizesEnabled) {\n    (workspace as WorkspaceSvg).setResizesEnabled(false);\n  }\n  let variablesFirst = true;\n  try {\n    for (let i = 0, xmlChild; (xmlChild = xml.childNodes[i]); i++) {\n      const name = xmlChild.nodeName.toLowerCase();\n      const xmlChildElement = xmlChild as Element;\n      if (\n        name === 'block' ||\n        (name === 'shadow' && !eventUtils.getRecordUndo())\n      ) {\n        // Allow top-level shadow blocks if recordUndo is disabled since\n        // that means an undo is in progress.  Such a block is expected\n        // to be moved to a nested destination in the next operation.\n        const block = domToBlockInternal(xmlChildElement, workspace);\n        newBlockIds.push(block.id);\n        const blockX = parseInt(xmlChildElement.getAttribute('x') ?? '10', 10);\n        const blockY = parseInt(xmlChildElement.getAttribute('y') ?? '10', 10);\n        if (!isNaN(blockX) && !isNaN(blockY)) {\n          block.moveBy(workspace.RTL ? width - blockX : blockX, blockY, [\n            'create',\n          ]);\n        }\n        variablesFirst = false;\n      } else if (name === 'shadow') {\n        throw TypeError('Shadow block cannot be a top-level block.');\n      } else if (name === 'comment') {\n        loadWorkspaceComment(xmlChildElement, workspace);\n      } else if (name === 'variables') {\n        if (variablesFirst) {\n          domToVariables(xmlChildElement, workspace);\n        } else {\n          throw Error(\n            \"'variables' tag must exist once before block and \" +\n              'shadow tag elements in the workspace XML, but it was found in ' +\n              'another location.',\n          );\n        }\n        variablesFirst = false;\n      }\n    }\n  } finally {\n    eventUtils.setGroup(existingGroup);\n    if ((workspace as WorkspaceSvg).setResizesEnabled) {\n      (workspace as WorkspaceSvg).setResizesEnabled(true);\n    }\n    if (workspace.rendered) renderManagement.triggerQueuedRenders();\n    dom.stopTextWidthCache();\n  }\n  // Re-enable workspace resizing.\n  eventUtils.fire(new (eventUtils.get(EventType.FINISHED_LOADING))(workspace));\n  return newBlockIds;\n}\n\n/** Deserializes the given comment state into the given workspace. */\nexport function loadWorkspaceComment(\n  elem: Element,\n  workspace: Workspace,\n): WorkspaceComment {\n  const id = elem.getAttribute('id') ?? undefined;\n  const comment = workspace.rendered\n    ? new RenderedWorkspaceComment(workspace as WorkspaceSvg, id)\n    : new WorkspaceComment(workspace, id);\n\n  comment.setText(elem.textContent ?? '');\n\n  let x = parseInt(elem.getAttribute('x') ?? '', 10);\n  const y = parseInt(elem.getAttribute('y') ?? '', 10);\n  if (!isNaN(x) && !isNaN(y)) {\n    x = workspace.RTL ? workspace.getWidth() - x : x;\n    comment.moveTo(new Coordinate(x, y));\n  }\n\n  const w = parseInt(elem.getAttribute('w') ?? '', 10);\n  const h = parseInt(elem.getAttribute('h') ?? '', 10);\n  if (!isNaN(w) && !isNaN(h)) comment.setSize(new Size(w, h));\n\n  if (elem.getAttribute('collapsed') === 'true') comment.setCollapsed(true);\n  if (elem.getAttribute('editable') === 'false') comment.setEditable(false);\n  if (elem.getAttribute('movable') === 'false') comment.setMovable(false);\n  if (elem.getAttribute('deletable') === 'false') comment.setDeletable(false);\n\n  return comment;\n}\n\n/**\n * Decode an XML DOM and create blocks on the workspace. Position the new\n * blocks immediately below prior blocks, aligned by their starting edge.\n *\n * @param xml The XML DOM.\n * @param workspace The workspace to add to.\n * @returns An array containing new block IDs.\n */\nexport function appendDomToWorkspace(\n  xml: Element,\n  workspace: WorkspaceSvg,\n): string[] {\n  // First check if we have a WorkspaceSvg, otherwise the blocks have no shape\n  // and the position does not matter.\n  // Assume it is rendered so we can check.\n  if (!(workspace as WorkspaceSvg).getBlocksBoundingBox) {\n    return domToWorkspace(xml, workspace);\n  }\n\n  const bbox = (workspace as WorkspaceSvg).getBlocksBoundingBox();\n  // Load the new blocks into the workspace and get the IDs of the new blocks.\n  const newBlockIds = domToWorkspace(xml, workspace);\n  if (bbox && bbox.top !== bbox.bottom) {\n    // Check if any previous block.\n    let offsetY = 0; // Offset to add to y of the new block.\n    let offsetX = 0;\n    const farY = bbox.bottom; // Bottom position.\n    const topX = workspace.RTL ? bbox.right : bbox.left; // X of bounding box.\n    // Check position of the new blocks.\n    let newLeftX = Infinity; // X of top left corner.\n    let newRightX = -Infinity; // X of top right corner.\n    let newY = Infinity; // Y of top corner.\n    const ySeparation = 10;\n    for (let i = 0; i < newBlockIds.length; i++) {\n      const blockXY = workspace\n        .getBlockById(newBlockIds[i])!\n        .getRelativeToSurfaceXY();\n      if (blockXY.y < newY) {\n        newY = blockXY.y;\n      }\n      if (blockXY.x < newLeftX) {\n        // if we left align also on x\n        newLeftX = blockXY.x;\n      }\n      if (blockXY.x > newRightX) {\n        // if we right align also on x\n        newRightX = blockXY.x;\n      }\n    }\n    offsetY = farY - newY + ySeparation;\n    offsetX = workspace.RTL ? topX - newRightX : topX - newLeftX;\n    for (let i = 0; i < newBlockIds.length; i++) {\n      const block = workspace.getBlockById(newBlockIds[i]);\n      block!.moveBy(offsetX, offsetY, ['create']);\n    }\n  }\n  return newBlockIds;\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @returns The root block created.\n */\nexport function domToBlock(xmlBlock: Element, workspace: Workspace): Block {\n  const block = domToBlockInternal(xmlBlock, workspace);\n  if (workspace.rendered) renderManagement.triggerQueuedRenders();\n  return block;\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * This is defined internally so that it doesn't trigger an immediate render,\n * which we do want to happen for external calls.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @returns The root block created.\n * @internal\n */\nexport function domToBlockInternal(\n  xmlBlock: Element,\n  workspace: Workspace,\n): Block {\n  // Create top-level block.\n  eventUtils.disable();\n  const variablesBeforeCreation = workspace.getAllVariables();\n  let topBlock;\n  try {\n    topBlock = domToBlockHeadless(xmlBlock, workspace);\n    // Generate list of all blocks.\n    if (workspace.rendered) {\n      const topBlockSvg = topBlock as BlockSvg;\n      const blocks = topBlock.getDescendants(false);\n      topBlockSvg.setConnectionTracking(false);\n      // Render each block.\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        (blocks[i] as BlockSvg).initSvg();\n      }\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        (blocks[i] as BlockSvg).queueRender();\n      }\n      // Populating the connection database may be deferred until after the\n      // blocks have rendered.\n      setTimeout(function () {\n        if (!topBlockSvg.disposed) {\n          topBlockSvg.setConnectionTracking(true);\n        }\n      }, 1);\n      // Allow the scrollbars to resize and move based on the new contents.\n      // TODO(@picklesrus): #387. Remove when domToBlock avoids resizing.\n      (workspace as WorkspaceSvg).resizeContents();\n    } else {\n      const blocks = topBlock.getDescendants(false);\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        blocks[i].initModel();\n      }\n    }\n  } finally {\n    eventUtils.enable();\n  }\n  if (eventUtils.isEnabled()) {\n    const newVariables = Variables.getAddedVariables(\n      workspace,\n      variablesBeforeCreation,\n    );\n    // Fire a VarCreate event for each (if any) new variable created.\n    for (let i = 0; i < newVariables.length; i++) {\n      const thisVariable = newVariables[i];\n      eventUtils.fire(new (eventUtils.get(EventType.VAR_CREATE))(thisVariable));\n    }\n    // Block events come after var events, in case they refer to newly created\n    // variables.\n    eventUtils.fire(new (eventUtils.get(EventType.BLOCK_CREATE))(topBlock));\n  }\n  return topBlock;\n}\n\n/**\n * Decode an XML list of variables and add the variables to the workspace.\n *\n * @param xmlVariables List of XML variable elements.\n * @param workspace The workspace to which the variable should be added.\n */\nexport function domToVariables(xmlVariables: Element, workspace: Workspace) {\n  for (let i = 0; i < xmlVariables.children.length; i++) {\n    const xmlChild = xmlVariables.children[i];\n    const type = xmlChild.getAttribute('type');\n    const id = xmlChild.getAttribute('id');\n    const name = xmlChild.textContent;\n\n    if (!name) return;\n    workspace.createVariable(name, type, id);\n  }\n}\n\n/** A mapping of nodeName to node for child nodes of xmlBlock. */\ninterface childNodeTagMap {\n  mutation: Element[];\n  comment: Element[];\n  data: Element[];\n  field: Element[];\n  input: Element[];\n  next: Element[];\n}\n\n/**\n * Creates a mapping of childNodes for each supported XML tag for the provided\n * xmlBlock. Logs a warning for any encountered unsupported tags.\n *\n * @param xmlBlock XML block element.\n * @returns The childNode map from nodeName to node.\n */\nfunction mapSupportedXmlTags(xmlBlock: Element): childNodeTagMap {\n  const childNodeMap = {\n    mutation: new Array<Element>(),\n    comment: new Array<Element>(),\n    data: new Array<Element>(),\n    field: new Array<Element>(),\n    input: new Array<Element>(),\n    next: new Array<Element>(),\n  };\n  for (let i = 0; i < xmlBlock.children.length; i++) {\n    const xmlChild = xmlBlock.children[i];\n    if (xmlChild.nodeType === dom.NodeType.TEXT_NODE) {\n      // Ignore any text at the <block> level.  It's all whitespace anyway.\n      continue;\n    }\n    switch (xmlChild.nodeName.toLowerCase()) {\n      case 'mutation':\n        childNodeMap.mutation.push(xmlChild);\n        break;\n      case 'comment':\n        childNodeMap.comment.push(xmlChild);\n        break;\n      case 'data':\n        childNodeMap.data.push(xmlChild);\n        break;\n      case 'title':\n      // Titles were renamed to field in December 2013.\n      // Fall through.\n      case 'field':\n        childNodeMap.field.push(xmlChild);\n        break;\n      case 'value':\n      case 'statement':\n        childNodeMap.input.push(xmlChild);\n        break;\n      case 'next':\n        childNodeMap.next.push(xmlChild);\n        break;\n      default:\n        // Unknown tag; ignore.  Same principle as HTML parsers.\n        console.warn('Ignoring unknown tag: ' + xmlChild.nodeName);\n    }\n  }\n  return childNodeMap;\n}\n\n/**\n * Applies mutation tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n * @returns True if mutation may have added some elements that need\n *     initialization (requiring initSvg call).\n */\nfunction applyMutationTagNodes(xmlChildren: Element[], block: Block): boolean {\n  let shouldCallInitSvg = false;\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    // Custom data for an advanced block.\n    if (block.domToMutation) {\n      block.domToMutation(xmlChild);\n      if ((block as BlockSvg).initSvg) {\n        // Mutation may have added some elements that need initializing.\n        shouldCallInitSvg = true;\n      }\n    }\n  }\n  return shouldCallInitSvg;\n}\n\n/**\n * Applies comment tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyCommentTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const text = xmlChild.textContent;\n    const pinned = xmlChild.getAttribute('pinned') === 'true';\n    const width = parseInt(xmlChild.getAttribute('w') ?? '50', 10);\n    const height = parseInt(xmlChild.getAttribute('h') ?? '50', 10);\n\n    block.setCommentText(text);\n    const comment = block.getIcon(IconType.COMMENT)!;\n    if (!isNaN(width) && !isNaN(height)) {\n      comment.setBubbleSize(new Size(width, height));\n    }\n    // Set the pinned state of the bubble.\n    comment.setBubbleVisible(pinned);\n    // Actually show the bubble after the block has been rendered.\n    setTimeout(() => comment.setBubbleVisible(pinned), 1);\n  }\n}\n\n/**\n * Applies data tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyDataTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    block.data = xmlChild.textContent;\n  }\n}\n\n/**\n * Applies field tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyFieldTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const nodeName = xmlChild.getAttribute('name');\n    if (!nodeName) {\n      console.warn(`Ignoring unnamed field in block ${block.type}`);\n      continue;\n    }\n    domToField(block, nodeName, xmlChild);\n  }\n}\n\n/**\n * Finds any enclosed blocks or shadows within this XML node.\n *\n * @param xmlNode The XML node to extract child block info from.\n * @returns Any found child block.\n */\nfunction findChildBlocks(xmlNode: Element): {\n  childBlockElement: Element | null;\n  childShadowElement: Element | null;\n} {\n  let childBlockElement: Element | null = null;\n  let childShadowElement: Element | null = null;\n  for (let i = 0; i < xmlNode.childNodes.length; i++) {\n    const xmlChild = xmlNode.childNodes[i];\n    if (isElement(xmlChild)) {\n      if (xmlChild.nodeName.toLowerCase() === 'block') {\n        childBlockElement = xmlChild;\n      } else if (xmlChild.nodeName.toLowerCase() === 'shadow') {\n        childShadowElement = xmlChild;\n      }\n    }\n  }\n  return {childBlockElement, childShadowElement};\n}\n/**\n * Applies input child nodes (value or statement) to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param workspace The workspace containing the given block.\n * @param block The block to apply the child nodes on.\n * @param prototypeName The prototype name of the block.\n */\nfunction applyInputTagNodes(\n  xmlChildren: Element[],\n  workspace: Workspace,\n  block: Block,\n  prototypeName: string,\n) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const nodeName = xmlChild.getAttribute('name');\n    const input = nodeName ? block.getInput(nodeName) : null;\n    if (!input) {\n      console.warn(\n        'Ignoring non-existent input ' +\n          nodeName +\n          ' in block ' +\n          prototypeName,\n      );\n      break;\n    }\n    const childBlockInfo = findChildBlocks(xmlChild);\n    if (childBlockInfo.childBlockElement) {\n      if (!input.connection) {\n        throw TypeError('Input connection does not exist.');\n      }\n      domToBlockHeadless(\n        childBlockInfo.childBlockElement,\n        workspace,\n        input.connection,\n        false,\n      );\n    }\n    // Set shadow after so we don't create a shadow we delete immediately.\n    if (childBlockInfo.childShadowElement) {\n      input.connection?.setShadowDom(childBlockInfo.childShadowElement);\n    }\n  }\n}\n\n/**\n * Applies next child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param workspace The workspace containing the given block.\n * @param block The block to apply the child nodes on.\n */\nfunction applyNextTagNodes(\n  xmlChildren: Element[],\n  workspace: Workspace,\n  block: Block,\n) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const childBlockInfo = findChildBlocks(xmlChild);\n    if (childBlockInfo.childBlockElement) {\n      if (!block.nextConnection) {\n        throw TypeError('Next statement does not exist.');\n      }\n      // If there is more than one XML 'next' tag.\n      if (block.nextConnection.isConnected()) {\n        throw TypeError('Next statement is already connected.');\n      }\n      // Create child block.\n      domToBlockHeadless(\n        childBlockInfo.childBlockElement,\n        workspace,\n        block.nextConnection,\n        true,\n      );\n    }\n    // Set shadow after so we don't create a shadow we delete immediately.\n    if (childBlockInfo.childShadowElement && block.nextConnection) {\n      block.nextConnection.setShadowDom(childBlockInfo.childShadowElement);\n    }\n  }\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @param parentConnection The parent connection to connect this block to\n *     after instantiating.\n * @param connectedToParentNext Whether the provided parent connection is a next\n *     connection, rather than output or statement.\n * @returns The root block created.\n */\nfunction domToBlockHeadless(\n  xmlBlock: Element,\n  workspace: Workspace,\n  parentConnection?: Connection,\n  connectedToParentNext?: boolean,\n): Block {\n  let block = null;\n  const prototypeName = xmlBlock.getAttribute('type');\n  if (!prototypeName) {\n    throw TypeError('Block type unspecified: ' + xmlBlock.outerHTML);\n  }\n  const id = xmlBlock.getAttribute('id') ?? undefined;\n  block = workspace.newBlock(prototypeName, id);\n\n  // Preprocess childNodes so tags can be processed in a consistent order.\n  const xmlChildNameMap = mapSupportedXmlTags(xmlBlock);\n\n  const shouldCallInitSvg = applyMutationTagNodes(\n    xmlChildNameMap.mutation,\n    block,\n  );\n  applyCommentTagNodes(xmlChildNameMap.comment, block);\n  applyDataTagNodes(xmlChildNameMap.data, block);\n\n  // Connect parent after processing mutation and before setting fields.\n  if (parentConnection) {\n    if (connectedToParentNext) {\n      if (block.previousConnection) {\n        parentConnection.connect(block.previousConnection);\n      } else {\n        throw TypeError('Next block does not have previous statement.');\n      }\n    } else {\n      if (block.outputConnection) {\n        parentConnection.connect(block.outputConnection);\n      } else if (block.previousConnection) {\n        parentConnection.connect(block.previousConnection);\n      } else {\n        throw TypeError(\n          'Child block does not have output or previous statement.',\n        );\n      }\n    }\n  }\n\n  applyFieldTagNodes(xmlChildNameMap.field, block);\n  applyInputTagNodes(xmlChildNameMap.input, workspace, block, prototypeName);\n  applyNextTagNodes(xmlChildNameMap.next, workspace, block);\n\n  if (shouldCallInitSvg) {\n    // This shouldn't even be called here\n    // (ref: https://github.com/google/blockly/pull/4296#issuecomment-884226021\n    // But the XML serializer/deserializer is iceboxed so I'm not going to fix\n    // it.\n    (block as BlockSvg).initSvg();\n  }\n\n  const inline = xmlBlock.getAttribute('inline');\n  if (inline) {\n    block.setInputsInline(inline === 'true');\n  }\n  const disabled = xmlBlock.getAttribute('disabled');\n  if (disabled) {\n    // Before May 2024 we just used 'disabled', with no reasons.\n    // Contiune to support this syntax.\n    block.setDisabledReason(\n      disabled === 'true' || disabled === 'disabled',\n      MANUALLY_DISABLED,\n    );\n  }\n  const disabledReasons = xmlBlock.getAttribute('disabled-reasons');\n  if (disabledReasons !== null) {\n    for (const reason of disabledReasons.split(',')) {\n      // Use decodeURIComponent to restore characters that were encoded in the\n      // value, such as commas.\n      block.setDisabledReason(true, decodeURIComponent(reason));\n    }\n  }\n  const deletable = xmlBlock.getAttribute('deletable');\n  if (deletable) {\n    block.setDeletable(deletable === 'true');\n  }\n  const movable = xmlBlock.getAttribute('movable');\n  if (movable) {\n    block.setMovable(movable === 'true');\n  }\n  const editable = xmlBlock.getAttribute('editable');\n  if (editable) {\n    block.setEditable(editable === 'true');\n  }\n  const collapsed = xmlBlock.getAttribute('collapsed');\n  if (collapsed) {\n    block.setCollapsed(collapsed === 'true');\n  }\n  if (xmlBlock.nodeName.toLowerCase() === 'shadow') {\n    // Ensure all children are also shadows.\n    const children = block.getChildren(false);\n    for (let i = 0; i < children.length; i++) {\n      const child = children[i];\n      if (!child.isShadow()) {\n        throw TypeError('Shadow block not allowed non-shadow child.');\n      }\n    }\n\n    block.setShadow(true);\n  }\n  return block;\n}\n\n/**\n * Decode an XML field tag and set the value of that field on the given block.\n *\n * @param block The block that is currently being deserialized.\n * @param fieldName The name of the field on the block.\n * @param xml The field tag to decode.\n */\nfunction domToField(block: Block, fieldName: string, xml: Element) {\n  const field = block.getField(fieldName);\n  if (!field) {\n    console.warn(\n      'Ignoring non-existent field ' + fieldName + ' in block ' + block.type,\n    );\n    return;\n  }\n  field.fromXml(xml);\n}\n\n/**\n * Remove any 'next' block (statements in a stack).\n *\n * @param xmlBlock XML block element or an empty DocumentFragment if the block\n *     was an insertion marker.\n */\nexport function deleteNext(xmlBlock: Element | DocumentFragment) {\n  for (let i = 0; i < xmlBlock.childNodes.length; i++) {\n    const child = xmlBlock.childNodes[i];\n    if (child.nodeName.toLowerCase() === 'next') {\n      xmlBlock.removeChild(child);\n      break;\n    }\n  }\n}\n\nfunction isElement(node: Node): node is Element {\n  return node.nodeType === dom.NodeType.ELEMENT_NODE;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockAnimations\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\n\n/** A bounding box for a cloned block. */\ninterface CloneRect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\n/** PID of disconnect UI animation.  There can only be one at a time. */\nlet disconnectPid: ReturnType<typeof setTimeout> | null = null;\n\n/** The wobbling block.  There can only be one at a time. */\nlet wobblingBlock: BlockSvg | null = null;\n\n/**\n * Play some UI effects (sound, animation) when disposing of a block.\n *\n * @param block The block being disposed of.\n * @internal\n */\nexport function disposeUiEffect(block: BlockSvg) {\n  // Disposing is going to take so long the animation won't play anyway.\n  if (block.getDescendants(false).length > 100) return;\n\n  const workspace = block.workspace;\n  const svgGroup = block.getSvgRoot();\n  workspace.getAudioManager().play('delete');\n\n  const xy = block.getRelativeToSurfaceXY();\n  // Deeply clone the current block.\n  const clone: SVGGElement = svgGroup.cloneNode(true) as SVGGElement;\n  clone.setAttribute('transform', 'translate(' + xy.x + ',' + xy.y + ')');\n  workspace.getLayerManager()?.appendToAnimationLayer({\n    getSvgRoot: () => {\n      return clone;\n    },\n  });\n  const cloneRect = {\n    'x': xy.x,\n    'y': xy.y,\n    'width': block.width,\n    'height': block.height,\n  };\n  disposeUiStep(clone, cloneRect, workspace.RTL, new Date());\n}\n/**\n * Animate a cloned block and eventually dispose of it.\n * This is a class method, not an instance method since the original block has\n * been destroyed and is no longer accessible.\n *\n * @param clone SVG element to animate and dispose of.\n * @param rect Starting rect of the clone.\n * @param rtl True if RTL, false if LTR.\n * @param start Date of animation's start.\n */\nfunction disposeUiStep(\n  clone: Element,\n  rect: CloneRect,\n  rtl: boolean,\n  start: Date,\n) {\n  const ms = new Date().getTime() - start.getTime();\n  const percent = ms / 150;\n  if (percent > 1) {\n    dom.removeNode(clone);\n  } else {\n    const x = rect.x + (((rtl ? -1 : 1) * rect.width) / 2) * percent;\n    const y = rect.y + (rect.height / 2) * percent;\n    const scale = 1 - percent;\n    clone.setAttribute(\n      'transform',\n      'translate(' + x + ',' + y + ')' + ' scale(' + scale + ')',\n    );\n    setTimeout(disposeUiStep, 10, clone, rect, rtl, start);\n  }\n}\n\n/**\n * Play some UI effects (sound, ripple) after a connection has been established.\n *\n * @param block The block being connected.\n * @internal\n */\nexport function connectionUiEffect(block: BlockSvg) {\n  const workspace = block.workspace;\n  const scale = workspace.scale;\n  workspace.getAudioManager().play('click');\n  if (scale < 1) {\n    return; // Too small to care about visual effects.\n  }\n  // Determine the absolute coordinates of the inferior block.\n  const xy = workspace.getSvgXY(block.getSvgRoot());\n  // Offset the coordinates based on the two connection types, fix scale.\n  if (block.outputConnection) {\n    xy.x += (block.RTL ? 3 : -3) * scale;\n    xy.y += 13 * scale;\n  } else if (block.previousConnection) {\n    xy.x += (block.RTL ? -23 : 23) * scale;\n    xy.y += 3 * scale;\n  }\n  const ripple = dom.createSvgElement(\n    Svg.CIRCLE,\n    {\n      'cx': xy.x,\n      'cy': xy.y,\n      'r': 0,\n      'fill': 'none',\n      'stroke': '#888',\n      'stroke-width': 10,\n    },\n    workspace.getParentSvg(),\n  );\n\n  const scaleAnimation = dom.createSvgElement(\n    Svg.ANIMATE,\n    {\n      'id': 'animationCircle',\n      'begin': 'indefinite',\n      'attributeName': 'r',\n      'dur': '150ms',\n      'from': 0,\n      'to': 25 * scale,\n    },\n    ripple,\n  );\n  const opacityAnimation = dom.createSvgElement(\n    Svg.ANIMATE,\n    {\n      'id': 'animationOpacity',\n      'begin': 'indefinite',\n      'attributeName': 'opacity',\n      'dur': '150ms',\n      'from': 1,\n      'to': 0,\n    },\n    ripple,\n  );\n\n  scaleAnimation.beginElement();\n  opacityAnimation.beginElement();\n\n  setTimeout(() => void dom.removeNode(ripple), 150);\n}\n\n/**\n * Play some UI effects (sound, animation) when disconnecting a block.\n *\n * @param block The block being disconnected.\n * @internal\n */\nexport function disconnectUiEffect(block: BlockSvg) {\n  disconnectUiStop();\n  block.workspace.getAudioManager().play('disconnect');\n  if (block.workspace.scale < 1) {\n    return; // Too small to care about visual effects.\n  }\n  // Horizontal distance for bottom of block to wiggle.\n  const DISPLACEMENT = 10;\n  // Scale magnitude of skew to height of block.\n  const height = block.getHeightWidth().height;\n  let magnitude = (Math.atan(DISPLACEMENT / height) / Math.PI) * 180;\n  if (!block.RTL) {\n    magnitude *= -1;\n  }\n  // Start the animation.\n  wobblingBlock = block;\n  disconnectUiStep(block, magnitude, new Date(), 0);\n}\n\n/**\n * Animate a brief wiggle of a disconnected block.\n *\n * @param block Block to animate.\n * @param magnitude Maximum degrees skew (reversed for RTL).\n * @param start Date of animation's start for deciding when to stop.\n * @param step Which step of the animation we're on.\n */\nfunction disconnectUiStep(\n  block: BlockSvg,\n  magnitude: number,\n  start: Date,\n  step: number,\n) {\n  const DURATION = 200; // Milliseconds.\n  const WIGGLES = [0.66, 1, 0.66, 0, -0.66, -1, -0.66, 0]; // Single cycle\n\n  let skew = '';\n  if (start.getTime() + DURATION > new Date().getTime()) {\n    const val = Math.round(WIGGLES[step % WIGGLES.length] * magnitude);\n    skew = `skewX(${val})`;\n    disconnectPid = setTimeout(\n      disconnectUiStep,\n      15,\n      block,\n      magnitude,\n      start,\n      step + 1,\n    );\n  }\n\n  block\n    .getSvgRoot()\n    .setAttribute('transform', `${block.getTranslation()} ${skew}`);\n}\n\n/**\n * Stop the disconnect UI animation immediately.\n *\n * @internal\n */\nexport function disconnectUiStop() {\n  if (!wobblingBlock) return;\n  if (disconnectPid) {\n    clearTimeout(disconnectPid);\n    disconnectPid = null;\n  }\n  wobblingBlock\n    .getSvgRoot()\n    .setAttribute('transform', wobblingBlock.getTranslation());\n  wobblingBlock = null;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Coordinate} from '../utils/coordinate';\n\n/**\n * Represents an object that can be dragged.\n */\nexport interface IDraggable extends IDragStrategy {\n  /**\n   * Returns the current location of the draggable in workspace\n   * coordinates.\n   *\n   * @returns Coordinate of current location on workspace.\n   */\n  getRelativeToSurfaceXY(): Coordinate;\n}\n\nexport interface IDragStrategy {\n  /** Returns true iff the element is currently movable. */\n  isMovable(): boolean;\n\n  /**\n   * Handles any drag startup (e.g moving elements to the front of the\n   * workspace).\n   *\n   * @param e PointerEvent that started the drag; can be used to\n   *     check modifier keys, etc.  May be missing when dragging is\n   *     triggered programatically rather than by user.\n   */\n  startDrag(e?: PointerEvent): void;\n\n  /**\n   * Handles moving elements to the new location, and updating any\n   * visuals based on that (e.g connection previews for blocks).\n   *\n   * @param newLoc Workspace coordinate to which the draggable has\n   *     been dragged.\n   * @param e PointerEvent that continued the drag.  Can be\n   *     used to check modifier keys, etc.\n   */\n  drag(newLoc: Coordinate, e?: PointerEvent): void;\n\n  /**\n   * Handles any drag cleanup, including e.g. connecting or deleting\n   * blocks.\n   *\n   * @param newLoc Workspace coordinate at which the drag finished.\n   *     been dragged.\n   * @param e PointerEvent that finished the drag.  Can be\n   *     used to check modifier keys, etc.\n   */\n  endDrag(e?: PointerEvent): void;\n\n  /** Moves the draggable back to where it was at the start of the drag. */\n  revertDrag(): void;\n}\n\n/** Returns whether the given object is an IDraggable or not. */\nexport function isDraggable(obj: any): obj is IDraggable {\n  return (\n    obj.getRelativeToSurfaceXY !== undefined &&\n    obj.isMovable !== undefined &&\n    obj.startDrag !== undefined &&\n    obj.drag !== undefined &&\n    obj.endDrag !== undefined &&\n    obj.revertDrag !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.object\n\n/**\n * Complete a deep merge of all members of a source object with a target object.\n *\n * @param target Target.\n * @param source Source.\n * @returns The resulting object.\n */\nexport function deepMerge(\n  target: AnyDuringMigration,\n  source: AnyDuringMigration,\n): AnyDuringMigration {\n  for (const x in source) {\n    if (source[x] !== null && typeof source[x] === 'object') {\n      target[x] = deepMerge(target[x] || Object.create(null), source[x]);\n    } else {\n      target[x] = source[x];\n    }\n  }\n  return target;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.fieldRegistry\n\nimport type {Field, FieldConfig} from './field.js';\nimport * as registry from './registry.js';\n\n/**\n * When constructing a field from JSON using the registry, the\n * `fromJson` method in this file is called with an options parameter\n * object consisting of the \"type\" which is the name of the field, and\n * other options that are part of the field's config object.\n *\n * These options are then passed to the field's static `fromJson`\n * method. That method accepts an options parameter with a type that usually\n * extends from FieldConfig, and may or may not have a \"type\" attribute (in\n * fact, it shouldn't, because we'd overwrite it as described above!)\n *\n * Unfortunately the registry has no way of knowing the actual Field subclass\n * that will be returned from passing in the name of the field. Therefore it\n * also has no way of knowing that the options object not only implements\n * `FieldConfig`, but it also should satisfy the Config that belongs to that\n * specific class's `fromJson` method.\n *\n * Because of this uncertainty, we just give up on type checking the properties\n * passed to the `fromJson` method, and allow arbitrary string keys with\n * unknown types.\n */\ntype RegistryOptions = FieldConfig & {\n  // The name of the field, e.g. field_dropdown\n  type: string;\n  [key: string]: unknown;\n};\n\n/**\n * Represents the static methods that must be defined on any\n * field that is registered, i.e. the constructor and fromJson methods.\n *\n * Because we don't know which Field subclass will be registered, we\n * are unable to typecheck the parameters of the constructor.\n */\nexport interface RegistrableField {\n  new (...args: any[]): Field;\n  fromJson(options: FieldConfig): Field;\n}\n\n/**\n * Registers a field type.\n * fieldRegistry.fromJson uses this registry to\n * find the appropriate field type.\n *\n * @param type The field type name as used in the JSON definition.\n * @param fieldClass The field class containing a fromJson function that can\n *     construct an instance of the field.\n * @throws {Error} if the type name is empty, the field is already registered,\n *     or the fieldClass is not an object containing a fromJson function.\n */\nexport function register(type: string, fieldClass: RegistrableField) {\n  registry.register(registry.Type.FIELD, type, fieldClass);\n}\n\n/**\n * Unregisters the field registered with the given type.\n *\n * @param type The field type name as used in the JSON definition.\n */\nexport function unregister(type: string) {\n  registry.unregister(registry.Type.FIELD, type);\n}\n\n/**\n * Construct a Field from a JSON arg object.\n * Finds the appropriate registered field by the type name as registered using\n * fieldRegistry.register.\n *\n * @param options A JSON object with a type and options specific to the field\n *     type.\n * @returns The new field instance or null if a field wasn't found with the\n *     given type name\n * @internal\n */\nexport function fromJson<T>(options: RegistryOptions): Field<T> | null {\n  return TEST_ONLY.fromJsonInternal(options);\n}\n\n/**\n * Private version of fromJson for stubbing in tests.\n *\n * @param options\n */\nfunction fromJsonInternal<T>(options: RegistryOptions): Field<T> | null {\n  const fieldObject = registry.getObject(\n    registry.Type.FIELD,\n    options.type,\n  ) as unknown as RegistrableField;\n  if (!fieldObject) {\n    console.warn(\n      'Blockly could not create a field of type ' +\n        options['type'] +\n        '. The field is probably not being registered. This could be because' +\n        ' the file is not loaded, the field does not register itself (Issue' +\n        ' #1584), or the registration is not being reached.',\n    );\n    return null;\n  }\n  return fieldObject.fromJson(options);\n}\n\nexport const TEST_ONLY = {\n  fromJsonInternal,\n};\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Extensions\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport {FieldDropdown} from './field_dropdown.js';\nimport {MutatorIcon} from './icons/mutator_icon.js';\nimport * as parsing from './utils/parsing.js';\n\n/** The set of all registered extensions, keyed by extension name/id. */\nconst allExtensions = Object.create(null);\nexport const TEST_ONLY = {allExtensions};\n\n/**\n * Registers a new extension function. Extensions are functions that help\n * initialize blocks, usually adding dynamic behavior such as onchange\n * handlers and mutators. These are applied using Block.applyExtension(), or\n * the JSON \"extensions\" array attribute.\n *\n * @param name The name of this extension.\n * @param initFn The function to initialize an extended block.\n * @throws {Error} if the extension name is empty, the extension is already\n *     registered, or extensionFn is not a function.\n */\nexport function register<T extends Block>(\n  name: string,\n  initFn: (this: T) => void,\n) {\n  if (typeof name !== 'string' || name.trim() === '') {\n    throw Error('Error: Invalid extension name \"' + name + '\"');\n  }\n  if (allExtensions[name]) {\n    throw Error('Error: Extension \"' + name + '\" is already registered.');\n  }\n  if (typeof initFn !== 'function') {\n    throw Error('Error: Extension \"' + name + '\" must be a function');\n  }\n  allExtensions[name] = initFn;\n}\n\n/**\n * Registers a new extension function that adds all key/value of mixinObj.\n *\n * @param name The name of this extension.\n * @param mixinObj The values to mix in.\n * @throws {Error} if the extension name is empty or the extension is already\n *     registered.\n */\nexport function registerMixin(name: string, mixinObj: AnyDuringMigration) {\n  if (!mixinObj || typeof mixinObj !== 'object') {\n    throw Error('Error: Mixin \"' + name + '\" must be a object');\n  }\n  register(name, function (this: Block) {\n    this.mixin(mixinObj);\n  });\n}\n\n/**\n * Registers a new extension function that adds a mutator to the block.\n * At register time this performs some basic sanity checks on the mutator.\n * The wrapper may also add a mutator dialog to the block, if both compose and\n * decompose are defined on the mixin.\n *\n * @param name The name of this mutator extension.\n * @param mixinObj The values to mix in.\n * @param opt_helperFn An optional function to apply after mixing in the object.\n * @param opt_blockList A list of blocks to appear in the flyout of the mutator\n *     dialog.\n * @throws {Error} if the mutation is invalid or can't be applied to the block.\n */\nexport function registerMutator(\n  name: string,\n  mixinObj: AnyDuringMigration,\n  opt_helperFn?: () => AnyDuringMigration,\n  opt_blockList?: string[],\n) {\n  const errorPrefix = 'Error when registering mutator \"' + name + '\": ';\n\n  checkHasMutatorProperties(errorPrefix, mixinObj);\n  const hasMutatorDialog = checkMutatorDialog(mixinObj, errorPrefix);\n\n  if (opt_helperFn && typeof opt_helperFn !== 'function') {\n    throw Error(errorPrefix + 'Extension \"' + name + '\" is not a function');\n  }\n\n  // Sanity checks passed.\n  register(name, function (this: Block) {\n    if (hasMutatorDialog) {\n      this.setMutator(new MutatorIcon(opt_blockList || [], this as BlockSvg));\n    }\n    // Mixin the object.\n    this.mixin(mixinObj);\n\n    if (opt_helperFn) {\n      opt_helperFn.apply(this);\n    }\n  });\n}\n\n/**\n * Unregisters the extension registered with the given name.\n *\n * @param name The name of the extension to unregister.\n */\nexport function unregister(name: string) {\n  if (isRegistered(name)) {\n    delete allExtensions[name];\n  } else {\n    console.warn(\n      'No extension mapping for name \"' + name + '\" found to unregister',\n    );\n  }\n}\n\n/**\n * Returns whether an extension is registered with the given name.\n *\n * @param name The name of the extension to check for.\n * @returns True if the extension is registered.  False if it is not registered.\n */\nexport function isRegistered(name: string): boolean {\n  return !!allExtensions[name];\n}\n\n/**\n * Applies an extension method to a block. This should only be called during\n * block construction.\n *\n * @param name The name of the extension.\n * @param block The block to apply the named extension to.\n * @param isMutator True if this extension defines a mutator.\n * @throws {Error} if the extension is not found.\n */\nexport function apply(name: string, block: Block, isMutator: boolean) {\n  const extensionFn = allExtensions[name];\n  if (typeof extensionFn !== 'function') {\n    throw Error('Error: Extension \"' + name + '\" not found.');\n  }\n  let mutatorProperties;\n  if (isMutator) {\n    // Fail early if the block already has mutation properties.\n    checkNoMutatorProperties(name, block);\n  } else {\n    // Record the old properties so we can make sure they don't change after\n    // applying the extension.\n    mutatorProperties = getMutatorProperties(block);\n  }\n  extensionFn.apply(block);\n\n  if (isMutator) {\n    const errorPrefix = 'Error after applying mutator \"' + name + '\": ';\n    checkHasMutatorProperties(errorPrefix, block);\n  } else {\n    if (\n      !mutatorPropertiesMatch(mutatorProperties as AnyDuringMigration[], block)\n    ) {\n      throw Error(\n        'Error when applying extension \"' +\n          name +\n          '\": ' +\n          'mutation properties changed when applying a non-mutator extension.',\n      );\n    }\n  }\n}\n\n/**\n * Check that the given block does not have any of the four mutator properties\n * defined on it.  This function should be called before applying a mutator\n * extension to a block, to make sure we are not overwriting properties.\n *\n * @param mutationName The name of the mutation to reference in error messages.\n * @param block The block to check.\n * @throws {Error} if any of the properties already exist on the block.\n */\nfunction checkNoMutatorProperties(mutationName: string, block: Block) {\n  const properties = getMutatorProperties(block);\n  if (properties.length) {\n    throw Error(\n      'Error: tried to apply mutation \"' +\n        mutationName +\n        '\" to a block that already has mutator functions.' +\n        '  Block id: ' +\n        block.id,\n    );\n  }\n}\n\n/**\n * Checks if the given object has both the 'mutationToDom' and 'domToMutation'\n * functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkXmlHooks(\n  object: AnyDuringMigration,\n  errorPrefix: string,\n): boolean {\n  return checkHasFunctionPair(\n    object.mutationToDom,\n    object.domToMutation,\n    errorPrefix + ' mutationToDom/domToMutation',\n  );\n}\n/**\n * Checks if the given object has both the 'saveExtraState' and 'loadExtraState'\n * functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkJsonHooks(\n  object: AnyDuringMigration,\n  errorPrefix: string,\n): boolean {\n  return checkHasFunctionPair(\n    object.saveExtraState,\n    object.loadExtraState,\n    errorPrefix + ' saveExtraState/loadExtraState',\n  );\n}\n\n/**\n * Checks if the given object has both the 'compose' and 'decompose' functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkMutatorDialog(\n  object: AnyDuringMigration,\n  errorPrefix: string,\n): boolean {\n  return checkHasFunctionPair(\n    object.compose,\n    object.decompose,\n    errorPrefix + ' compose/decompose',\n  );\n}\n\n/**\n * Checks that both or neither of the given functions exist and that they are\n * indeed functions.\n *\n * @param func1 The first function in the pair.\n * @param func2 The second function in the pair.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} If the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkHasFunctionPair(\n  func1: AnyDuringMigration,\n  func2: AnyDuringMigration,\n  errorPrefix: string,\n): boolean {\n  if (func1 && func2) {\n    if (typeof func1 !== 'function' || typeof func2 !== 'function') {\n      throw Error(errorPrefix + ' must be a function');\n    }\n    return true;\n  } else if (!func1 && !func2) {\n    return false;\n  }\n  throw Error(errorPrefix + 'Must have both or neither functions');\n}\n\n/**\n * Checks that the given object required mutator properties.\n *\n * @param errorPrefix The string to prepend to any error message.\n * @param object The object to inspect.\n */\nfunction checkHasMutatorProperties(\n  errorPrefix: string,\n  object: AnyDuringMigration,\n) {\n  const hasXmlHooks = checkXmlHooks(object, errorPrefix);\n  const hasJsonHooks = checkJsonHooks(object, errorPrefix);\n  if (!hasXmlHooks && !hasJsonHooks) {\n    throw Error(\n      errorPrefix +\n        'Mutations must contain either XML hooks, or JSON hooks, or both',\n    );\n  }\n  // A block with a mutator isn't required to have a mutation dialog, but\n  // it should still have both or neither of compose and decompose.\n  checkMutatorDialog(object, errorPrefix);\n}\n\n/**\n * Get a list of values of mutator properties on the given block.\n *\n * @param block The block to inspect.\n * @returns A list with all of the defined properties, which should be\n *     functions, but may be anything other than undefined.\n */\nfunction getMutatorProperties(block: Block): AnyDuringMigration[] {\n  const result = [];\n  // List each function explicitly by reference to allow for renaming\n  // during compilation.\n  if (block.domToMutation !== undefined) {\n    result.push(block.domToMutation);\n  }\n  if (block.mutationToDom !== undefined) {\n    result.push(block.mutationToDom);\n  }\n  if (block.saveExtraState !== undefined) {\n    result.push(block.saveExtraState);\n  }\n  if (block.loadExtraState !== undefined) {\n    result.push(block.loadExtraState);\n  }\n  if (block.compose !== undefined) {\n    result.push(block.compose);\n  }\n  if (block.decompose !== undefined) {\n    result.push(block.decompose);\n  }\n  return result;\n}\n\n/**\n * Check that the current mutator properties match a list of old mutator\n * properties.  This should be called after applying a non-mutator extension,\n * to verify that the extension didn't change properties it shouldn't.\n *\n * @param oldProperties The old values to compare to.\n * @param block The block to inspect for new values.\n * @returns True if the property lists match.\n */\nfunction mutatorPropertiesMatch(\n  oldProperties: AnyDuringMigration[],\n  block: Block,\n): boolean {\n  const newProperties = getMutatorProperties(block);\n  if (newProperties.length !== oldProperties.length) {\n    return false;\n  }\n  for (let i = 0; i < newProperties.length; i++) {\n    if (oldProperties[i] !== newProperties[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Calls a function after the page has loaded, possibly immediately.\n *\n * @param fn Function to run.\n * @throws Error Will throw if no global document can be found (e.g., Node.js).\n * @internal\n */\nexport function runAfterPageLoad(fn: () => void) {\n  if (typeof document !== 'object') {\n    throw Error('runAfterPageLoad() requires browser document.');\n  }\n  if (document.readyState === 'complete') {\n    fn(); // Page has already loaded. Call immediately.\n  } else {\n    // Poll readyState.\n    const readyStateCheckInterval = setInterval(function () {\n      if (document.readyState === 'complete') {\n        clearInterval(readyStateCheckInterval);\n        fn();\n      }\n    }, 10);\n  }\n}\n\n/**\n * Builds an extension function that will map a dropdown value to a tooltip\n * string.\n *\n * @param dropdownName The name of the field whose value is the key to the\n *     lookup table.\n * @param lookupTable The table of field values to tooltip text.\n * @returns The extension function.\n */\nexport function buildTooltipForDropdown(\n  dropdownName: string,\n  lookupTable: {[key: string]: string},\n): (this: Block) => void {\n  // List of block types already validated, to minimize duplicate warnings.\n  const blockTypesChecked: string[] = [];\n\n  return function (this: Block) {\n    if (!blockTypesChecked.includes(this.type)) {\n      checkDropdownOptionsInTable(this, dropdownName, lookupTable);\n      blockTypesChecked.push(this.type);\n    }\n\n    this.setTooltip(\n      function (this: Block) {\n        const value = String(this.getFieldValue(dropdownName));\n        return parsing.replaceMessageReferences(lookupTable[value]);\n      }.bind(this),\n    );\n  };\n}\n\n/**\n * Checks all options keys are present in the provided string lookup table.\n * Emits console warnings when they are not.\n *\n * @param block The block containing the dropdown\n * @param dropdownName The name of the dropdown\n * @param lookupTable The string lookup table\n */\nfunction checkDropdownOptionsInTable(\n  block: Block,\n  dropdownName: string,\n  lookupTable: {[key: string]: string},\n) {\n  const dropdown = block.getField(dropdownName);\n  if (!(dropdown instanceof FieldDropdown) || dropdown.isOptionListDynamic()) {\n    return;\n  }\n\n  const options = dropdown.getOptions();\n  for (const [, key] of options) {\n    if (lookupTable[key] === undefined) {\n      console.warn(\n        `No tooltip mapping for value ${key} of field ` +\n          `${dropdownName} of block type ${block.type}.`,\n      );\n    }\n  }\n}\n\n/**\n * Builds an extension function that will install a dynamic tooltip. The\n * tooltip message should include the string '%1' and that string will be\n * replaced with the text of the named field.\n *\n * @param msgTemplate The template form to of the message text, with %1\n *     placeholder.\n * @param fieldName The field with the replacement text.\n * @returns The extension function.\n */\nexport function buildTooltipWithFieldText(\n  msgTemplate: string,\n  fieldName: string,\n): (this: Block) => void {\n  return function (this: Block) {\n    this.setTooltip(\n      function (this: Block) {\n        const field = this.getField(fieldName);\n        return parsing\n          .replaceMessageReferences(msgTemplate)\n          .replace('%1', field ? field.getText() : '');\n      }.bind(this),\n    );\n  };\n}\n\n/**\n * Configures the tooltip to mimic the parent block when connected. Otherwise,\n * uses the tooltip text at the time this extension is initialized. This takes\n * advantage of the fact that all other values from JSON are initialized before\n * extensions.\n */\nfunction extensionParentTooltip(this: Block) {\n  const tooltipWhenNotConnected = this.tooltip;\n  this.setTooltip(\n    function (this: Block) {\n      const parent = this.getParent();\n      return (\n        (parent && parent.getInputsInline() && parent.tooltip) ||\n        tooltipWhenNotConnected\n      );\n    }.bind(this),\n  );\n}\nregister('parent_tooltip_when_inline', extensionParentTooltip);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.svgPaths\n\n/**\n * Create a string representing the given x, y pair.  It does not matter whether\n * the coordinate is relative or absolute.  The result has leading\n * and trailing spaces, and separates the x and y coordinates with a comma but\n * no space.\n *\n * @param x The x coordinate.\n * @param y The y coordinate.\n * @returns A string of the format ' x,y '\n */\nexport function point(x: number, y: number): string {\n  return ' ' + x + ',' + y + ' ';\n}\n\n/**\n * Draw a cubic or quadratic curve.  See\n * developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Cubic_B%C3%A9zier_Curve\n * These coordinates are unitless and hence in the user coordinate system.\n *\n * @param command The command to use.\n *     Should be one of: c, C, s, S, q, Q.\n * @param points  An array containing all of the points to pass to the curve\n *     command, in order.  The points are represented as strings of the format '\n *     x, y '.\n * @returns A string defining one or more Bezier curves.  See the MDN\n *     documentation for exact format.\n */\nexport function curve(command: string, points: string[]): string {\n  return ' ' + command + points.join('');\n}\n\n/**\n * Move the cursor to the given position without drawing a line.\n * The coordinates are absolute.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param x The absolute x coordinate.\n * @param y The absolute y coordinate.\n * @returns A string of the format ' M x,y '\n */\nexport function moveTo(x: number, y: number): string {\n  return ' M ' + x + ',' + y + ' ';\n}\n\n/**\n * Move the cursor to the given position without drawing a line.\n * Coordinates are relative.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param dx The relative x coordinate.\n * @param dy The relative y coordinate.\n * @returns A string of the format ' m dx,dy '\n */\nexport function moveBy(dx: number, dy: number): string {\n  return ' m ' + dx + ',' + dy + ' ';\n}\n\n/**\n * Draw a line from the current point to the end point, which is the current\n * point shifted by dx along the x-axis and dy along the y-axis.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param dx The relative x coordinate.\n * @param dy The relative y coordinate.\n * @returns A string of the format ' l dx,dy '\n */\nexport function lineTo(dx: number, dy: number): string {\n  return ' l ' + dx + ',' + dy + ' ';\n}\n\n/**\n * Draw multiple lines connecting all of the given points in order.  This is\n * equivalent to a series of 'l' commands.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param points An array containing all of the points to draw lines to, in\n *     order.  The points are represented as strings of the format ' dx,dy '.\n * @returns A string of the format ' l (dx,dy)+ '\n */\nexport function line(points: string[]): string {\n  return ' l' + points.join('');\n}\n\n/**\n * Draw a horizontal or vertical line.\n * The first argument specifies the direction and whether the given position is\n * relative or absolute.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#LineTo_path_commands\n *\n * @param command The command to prepend to the coordinate.  This should be one\n *     of: V, v, H, h.\n * @param val The coordinate to pass to the command.  It may be absolute or\n *     relative.\n * @returns A string of the format ' command val '\n */\nexport function lineOnAxis(command: string, val: number): string {\n  return ' ' + command + ' ' + val + ' ';\n}\n\n/**\n * Draw an elliptical arc curve.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Elliptical_Arc_Curve\n *\n * @param command The command string.  Either 'a' or 'A'.\n * @param flags The flag string.  See the MDN documentation for a description\n *     and examples.\n * @param radius The radius of the arc to draw.\n * @param point The point to move the cursor to after drawing the arc, specified\n *     either in absolute or relative coordinates depending on the command.\n * @returns A string of the format 'command radius radius flags point'\n */\nexport function arc(\n  command: string,\n  flags: string,\n  radius: number,\n  point: string,\n): string {\n  return command + ' ' + radius + ' ' + radius + ' ' + flags + point;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport type {IIcon} from '../interfaces/i_icon.js';\nimport * as registry from '../registry.js';\nimport {IconType} from './icon_types.js';\n\n/**\n * Registers the given icon so that it can be deserialized.\n *\n * @param type The type of the icon to register. This should be the same string\n *     that is returned from its `getType` method.\n * @param iconConstructor The icon class/constructor to register.\n */\nexport function register(\n  type: IconType<IIcon>,\n  iconConstructor: new (block: Block) => IIcon,\n) {\n  registry.register(registry.Type.ICON, type.toString(), iconConstructor);\n}\n\n/**\n * Unregisters the icon associated with the given type.\n *\n * @param type The type of the icon to unregister.\n */\nexport function unregister(type: string) {\n  registry.unregister(registry.Type.ICON, type);\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.procedures.IProcedureBlock\n\nimport type {Block} from '../block.js';\nimport {IProcedureModel} from './i_procedure_model.js';\n\n/** The interface for a block which models a procedure. */\nexport interface IProcedureBlock {\n  getProcedureModel(): IProcedureModel;\n  doProcedureUpdate(): void;\n  isProcedureDef(): boolean;\n}\n\n/** A type guard which checks if the given block is a procedure block. */\nexport function isProcedureBlock(\n  block: Block | IProcedureBlock,\n): block is IProcedureBlock {\n  return (\n    (block as IProcedureBlock).getProcedureModel !== undefined &&\n    (block as IProcedureBlock).doProcedureUpdate !== undefined &&\n    (block as IProcedureBlock).isProcedureDef !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that fires events optionally.\n *\n * @internal\n */\nexport interface IObservable {\n  startPublishing(): void;\n  stopPublishing(): void;\n}\n\n/**\n * Type guard for checking if an object fulfills IObservable.\n *\n * @internal\n */\nexport function isObservable(obj: any): obj is IObservable {\n  return obj.startPublishing !== undefined && obj.stopPublishing !== undefined;\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Procedures\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport {Blocks} from './blocks.js';\nimport * as common from './common.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BubbleOpen} from './events/events_bubble_open.js';\nimport {\n  isBlockChange,\n  isBlockCreate,\n  isBlockDelete,\n  isBlockFieldIntermediateChange,\n  isBubbleOpen,\n} from './events/predicates.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport {Field, UnattachedFieldError} from './field.js';\nimport {MutatorIcon} from './icons.js';\nimport {\n  isLegacyProcedureCallBlock,\n  isLegacyProcedureDefBlock,\n  ProcedureBlock,\n  ProcedureTuple,\n} from './interfaces/i_legacy_procedure_blocks.js';\nimport {IParameterModel} from './interfaces/i_parameter_model.js';\nimport {\n  IProcedureBlock,\n  isProcedureBlock,\n} from './interfaces/i_procedure_block.js';\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport {IProcedureModel} from './interfaces/i_procedure_model.js';\nimport {Msg} from './msg.js';\nimport {Names} from './names.js';\nimport {ObservableProcedureMap} from './observable_procedure_map.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * procedure blocks.\n * See also Blockly.Variables.CATEGORY_NAME and\n * Blockly.VariablesDynamic.CATEGORY_NAME.\n */\nexport const CATEGORY_NAME = 'PROCEDURE';\n\n/**\n * The default argument for a procedures_mutatorarg block.\n */\nexport const DEFAULT_ARG = 'x';\n\n/**\n * Find all user-created procedure definitions in a workspace.\n *\n * @param root Root workspace.\n * @returns Pair of arrays, the first contains procedures without return\n *     variables, the second with. Each procedure is defined by a three-element\n *     list of name, parameter list, and return value boolean.\n */\nexport function allProcedures(\n  root: Workspace,\n): [ProcedureTuple[], ProcedureTuple[]] {\n  const proceduresNoReturn: ProcedureTuple[] = root\n    .getProcedureMap()\n    .getProcedures()\n    .filter((p) => !p.getReturnTypes())\n    .map((p) => [\n      p.getName(),\n      p.getParameters().map((pa) => pa.getName()),\n      false,\n    ]);\n  root.getBlocksByType('procedures_defnoreturn', false).forEach((b) => {\n    if (!isProcedureBlock(b) && isLegacyProcedureDefBlock(b)) {\n      proceduresNoReturn.push(b.getProcedureDef());\n    }\n  });\n\n  const proceduresReturn: ProcedureTuple[] = root\n    .getProcedureMap()\n    .getProcedures()\n    .filter((p) => !!p.getReturnTypes())\n    .map((p) => [\n      p.getName(),\n      p.getParameters().map((pa) => pa.getName()),\n      true,\n    ]);\n  root.getBlocksByType('procedures_defreturn', false).forEach((b) => {\n    if (!isProcedureBlock(b) && isLegacyProcedureDefBlock(b)) {\n      proceduresReturn.push(b.getProcedureDef());\n    }\n  });\n  proceduresNoReturn.sort(procTupleComparator);\n  proceduresReturn.sort(procTupleComparator);\n  return [proceduresNoReturn, proceduresReturn];\n}\n\n/**\n * Comparison function for case-insensitive sorting of the first element of\n * a tuple.\n *\n * @param ta First tuple.\n * @param tb Second tuple.\n * @returns -1, 0, or 1 to signify greater than, equality, or less than.\n */\nfunction procTupleComparator(ta: ProcedureTuple, tb: ProcedureTuple): number {\n  return ta[0].localeCompare(tb[0], undefined, {sensitivity: 'base'});\n}\n\n/**\n * Ensure two identically-named procedures don't exist.\n * Take the proposed procedure name, and return a legal name i.e. one that\n * is not empty and doesn't collide with other procedures.\n *\n * @param name Proposed procedure name.\n * @param block Block to disambiguate.\n * @returns Non-colliding name.\n */\nexport function findLegalName(name: string, block: Block): string {\n  if (block.isInFlyout) {\n    // Flyouts can have multiple procedures called 'do something'.\n    return name;\n  }\n  name = name || Msg['UNNAMED_KEY'] || 'unnamed';\n  while (!isLegalName(name, block.workspace, block)) {\n    // Collision with another procedure.\n    const r = name.match(/^(.*?)(\\d+)$/);\n    if (!r) {\n      name += '2';\n    } else {\n      name = r[1] + (parseInt(r[2]) + 1);\n    }\n  }\n  return name;\n}\n/**\n * Does this procedure have a legal name?  Illegal names include names of\n * procedures already defined.\n *\n * @param name The questionable name.\n * @param workspace The workspace to scan for collisions.\n * @param opt_exclude Optional block to exclude from comparisons (one doesn't\n *     want to collide with oneself).\n * @returns True if the name is legal.\n */\nfunction isLegalName(\n  name: string,\n  workspace: Workspace,\n  opt_exclude?: Block,\n): boolean {\n  return !isNameUsed(name, workspace, opt_exclude);\n}\n\n/**\n * Return if the given name is already a procedure name.\n *\n * @param name The questionable name.\n * @param workspace The workspace to scan for collisions.\n * @param opt_exclude Optional block to exclude from comparisons (one doesn't\n *     want to collide with oneself).\n * @returns True if the name is used, otherwise return false.\n */\nexport function isNameUsed(\n  name: string,\n  workspace: Workspace,\n  opt_exclude?: Block,\n): boolean {\n  for (const block of workspace.getAllBlocks(false)) {\n    if (block === opt_exclude) continue;\n\n    if (\n      isLegacyProcedureDefBlock(block) &&\n      Names.equals(block.getProcedureDef()[0], name)\n    ) {\n      return true;\n    }\n  }\n\n  const excludeModel =\n    opt_exclude && isProcedureBlock(opt_exclude)\n      ? opt_exclude?.getProcedureModel()\n      : undefined;\n  for (const model of workspace.getProcedureMap().getProcedures()) {\n    if (model === excludeModel) continue;\n    if (Names.equals(model.getName(), name)) return true;\n  }\n  return false;\n}\n\n/**\n * Rename a procedure.  Called by the editable field.\n *\n * @param name The proposed new name.\n * @returns The accepted name.\n */\nexport function rename(this: Field, name: string): string {\n  const block = this.getSourceBlock();\n  if (!block) {\n    throw new UnattachedFieldError();\n  }\n\n  // Strip leading and trailing whitespace.  Beyond this, all names are legal.\n  name = name.trim();\n\n  const legalName = findLegalName(name, block);\n  if (isProcedureBlock(block) && !block.isInsertionMarker()) {\n    block.getProcedureModel().setName(legalName);\n  }\n  const oldName = this.getValue();\n  if (oldName !== name && oldName !== legalName) {\n    // Rename any callers.\n    const blocks = block.workspace.getAllBlocks(false);\n    for (let i = 0; i < blocks.length; i++) {\n      // Assume it is a procedure so we can check.\n      const procedureBlock = blocks[i] as unknown as ProcedureBlock;\n      if (procedureBlock.renameProcedure) {\n        procedureBlock.renameProcedure(oldName as string, legalName);\n      }\n    }\n  }\n  return legalName;\n}\n\n/**\n * Construct the blocks required by the flyout for the procedure category.\n *\n * @param workspace The workspace containing procedures.\n * @returns Array of XML block elements.\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  const xmlList = [];\n  if (Blocks['procedures_defnoreturn']) {\n    // <block type=\"procedures_defnoreturn\" gap=\"16\">\n    //     <field name=\"NAME\">do something</field>\n    // </block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_defnoreturn');\n    block.setAttribute('gap', '16');\n    const nameField = utilsXml.createElement('field');\n    nameField.setAttribute('name', 'NAME');\n    nameField.appendChild(\n      utilsXml.createTextNode(Msg['PROCEDURES_DEFNORETURN_PROCEDURE']),\n    );\n    block.appendChild(nameField);\n    xmlList.push(block);\n  }\n  if (Blocks['procedures_defreturn']) {\n    // <block type=\"procedures_defreturn\" gap=\"16\">\n    //     <field name=\"NAME\">do something</field>\n    // </block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_defreturn');\n    block.setAttribute('gap', '16');\n    const nameField = utilsXml.createElement('field');\n    nameField.setAttribute('name', 'NAME');\n    nameField.appendChild(\n      utilsXml.createTextNode(Msg['PROCEDURES_DEFRETURN_PROCEDURE']),\n    );\n    block.appendChild(nameField);\n    xmlList.push(block);\n  }\n  if (Blocks['procedures_ifreturn']) {\n    // <block type=\"procedures_ifreturn\" gap=\"16\"></block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_ifreturn');\n    block.setAttribute('gap', '16');\n    xmlList.push(block);\n  }\n  if (xmlList.length) {\n    // Add slightly larger gap between system blocks and user calls.\n    xmlList[xmlList.length - 1].setAttribute('gap', '24');\n  }\n\n  /**\n   * Add items to xmlList for each listed procedure.\n   *\n   * @param procedureList A list of procedures, each of which is defined by a\n   *     three-element list of name, parameter list, and return value boolean.\n   * @param templateName The type of the block to generate.\n   */\n  function populateProcedures(\n    procedureList: ProcedureTuple[],\n    templateName: string,\n  ) {\n    for (let i = 0; i < procedureList.length; i++) {\n      const name = procedureList[i][0];\n      const args = procedureList[i][1];\n      // <block type=\"procedures_callnoreturn\" gap=\"16\">\n      //   <mutation name=\"do something\">\n      //     <arg name=\"x\"></arg>\n      //   </mutation>\n      // </block>\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', templateName);\n      block.setAttribute('gap', '16');\n      const mutation = utilsXml.createElement('mutation');\n      mutation.setAttribute('name', name);\n      block.appendChild(mutation);\n      for (let j = 0; j < args.length; j++) {\n        const arg = utilsXml.createElement('arg');\n        arg.setAttribute('name', args[j]);\n        mutation.appendChild(arg);\n      }\n      xmlList.push(block);\n    }\n  }\n\n  const tuple = allProcedures(workspace);\n  populateProcedures(tuple[0], 'procedures_callnoreturn');\n  populateProcedures(tuple[1], 'procedures_callreturn');\n  return xmlList;\n}\n\n/**\n * Updates the procedure mutator's flyout so that the arg block is not a\n * duplicate of another arg.\n *\n * @param workspace The procedure mutator's workspace. This workspace's flyout\n *     is what is being updated.\n */\nfunction updateMutatorFlyout(workspace: WorkspaceSvg) {\n  const usedNames = [];\n  const blocks = workspace.getBlocksByType('procedures_mutatorarg', false);\n  for (let i = 0, block; (block = blocks[i]); i++) {\n    usedNames.push(block.getFieldValue('NAME'));\n  }\n\n  const xmlElement = utilsXml.createElement('xml');\n  const argBlock = utilsXml.createElement('block');\n  argBlock.setAttribute('type', 'procedures_mutatorarg');\n  const nameField = utilsXml.createElement('field');\n  nameField.setAttribute('name', 'NAME');\n  const argValue = Variables.generateUniqueNameFromOptions(\n    DEFAULT_ARG,\n    usedNames,\n  );\n  const fieldContent = utilsXml.createTextNode(argValue);\n\n  nameField.appendChild(fieldContent);\n  argBlock.appendChild(nameField);\n  xmlElement.appendChild(argBlock);\n\n  workspace.updateToolbox(xmlElement);\n}\n\n/**\n * Listens for when a procedure mutator is opened. Then it triggers a flyout\n * update and adds a mutator change listener to the mutator workspace.\n *\n * @param e The event that triggered this listener.\n * @internal\n */\nexport function mutatorOpenListener(e: Abstract) {\n  if (!isBubbleOpen(e)) return;\n\n  const bubbleEvent = e as BubbleOpen;\n  if (\n    !(bubbleEvent.bubbleType === 'mutator' && bubbleEvent.isOpen) ||\n    !bubbleEvent.blockId\n  ) {\n    return;\n  }\n  const workspaceId = bubbleEvent.workspaceId;\n  const block = common\n    .getWorkspaceById(workspaceId)!\n    .getBlockById(bubbleEvent.blockId) as BlockSvg;\n  const type = block.type;\n  if (type !== 'procedures_defnoreturn' && type !== 'procedures_defreturn') {\n    return;\n  }\n  const workspace = (\n    block.getIcon(MutatorIcon.TYPE) as MutatorIcon\n  ).getWorkspace()!;\n  updateMutatorFlyout(workspace);\n  workspace.addChangeListener(mutatorChangeListener);\n}\n/**\n * Listens for changes in a procedure mutator and triggers flyout updates when\n * necessary.\n *\n * @param e The event that triggered this listener.\n */\nfunction mutatorChangeListener(e: Abstract) {\n  if (\n    !isBlockCreate(e) &&\n    !isBlockDelete(e) &&\n    !isBlockChange(e) &&\n    !isBlockFieldIntermediateChange(e)\n  ) {\n    return;\n  }\n  const workspaceId = e.workspaceId as string;\n  const workspace = common.getWorkspaceById(workspaceId) as WorkspaceSvg;\n  updateMutatorFlyout(workspace);\n}\n\n/**\n * Find all the callers of a named procedure.\n *\n * @param name Name of procedure.\n * @param workspace The workspace to find callers in.\n * @returns Array of caller blocks.\n */\nexport function getCallers(name: string, workspace: Workspace): Block[] {\n  return workspace.getAllBlocks(false).filter((block) => {\n    return (\n      blockIsModernCallerFor(block, name) ||\n      (isLegacyProcedureCallBlock(block) &&\n        Names.equals(block.getProcedureCall(), name))\n    );\n  });\n}\n\n/**\n * @returns True if the given block is a modern-style caller block of the given\n *     procedure name.\n */\nfunction blockIsModernCallerFor(block: Block, procName: string): boolean {\n  return (\n    isProcedureBlock(block) &&\n    !block.isProcedureDef() &&\n    block.getProcedureModel() &&\n    Names.equals(block.getProcedureModel().getName(), procName)\n  );\n}\n\n/**\n * When a procedure definition changes its parameters, find and edit all its\n * callers.\n *\n * @param defBlock Procedure definition block.\n */\nexport function mutateCallers(defBlock: Block) {\n  const oldRecordUndo = eventUtils.getRecordUndo();\n  const procedureBlock = defBlock as unknown as ProcedureBlock;\n  const name = procedureBlock.getProcedureDef()[0];\n  const xmlElement = defBlock.mutationToDom!(true);\n  const callers = getCallers(name, defBlock.workspace);\n  for (let i = 0, caller; (caller = callers[i]); i++) {\n    const oldMutationDom = caller.mutationToDom!();\n    const oldMutation = oldMutationDom && utilsXml.domToText(oldMutationDom);\n    if (caller.domToMutation) {\n      caller.domToMutation(xmlElement);\n    }\n    const newMutationDom = caller.mutationToDom!();\n    const newMutation = newMutationDom && utilsXml.domToText(newMutationDom);\n    if (oldMutation !== newMutation) {\n      // Fire a mutation on every caller block.  But don't record this as an\n      // undo action since it is deterministically tied to the procedure's\n      // definition mutation.\n      eventUtils.setRecordUndo(false);\n      eventUtils.fire(\n        new (eventUtils.get(EventType.BLOCK_CHANGE))(\n          caller,\n          'mutation',\n          null,\n          oldMutation,\n          newMutation,\n        ),\n      );\n      eventUtils.setRecordUndo(oldRecordUndo);\n    }\n  }\n}\n\n/**\n * Find the definition block for the named procedure.\n *\n * @param name Name of procedure.\n * @param workspace The workspace to search.\n * @returns The procedure definition block, or null not found.\n */\nexport function getDefinition(\n  name: string,\n  workspace: Workspace,\n): Block | null {\n  // Do not assume procedure is a top block. Some languages allow nested\n  // procedures. Also do not assume it is one of the built-in blocks. Only\n  // rely on isProcedureDef and getProcedureDef.\n  for (const block of workspace.getAllBlocks(false)) {\n    if (\n      isProcedureBlock(block) &&\n      block.isProcedureDef() &&\n      Names.equals(block.getProcedureModel().getName(), name)\n    ) {\n      return block;\n    }\n    if (\n      isLegacyProcedureDefBlock(block) &&\n      Names.equals(block.getProcedureDef()[0], name)\n    ) {\n      return block;\n    }\n  }\n  return null;\n}\n\nexport {\n  IParameterModel,\n  IProcedureBlock,\n  IProcedureMap,\n  IProcedureModel,\n  isProcedureBlock,\n  ObservableProcedureMap,\n  ProcedureTuple,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.ConstantProvider\n\nimport {ConnectionType} from '../../connection_type.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport * as colour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport * as parsing from '../../utils/parsing.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\n\n/** An object containing sizing and path information about outside corners. */\nexport interface OutsideCorners {\n  topLeft: string;\n  topRight: string;\n  bottomRight: string;\n  bottomLeft: string;\n  rightHeight: number;\n}\n\n/** An object containing sizing and path information about inside corners. */\nexport interface InsideCorners {\n  width: number;\n  height: number;\n  pathTop: string;\n  pathBottom: string;\n}\n\n/** An object containing sizing and path information about a start hat. */\nexport interface StartHat {\n  height: number;\n  width: number;\n  path: string;\n}\n\n/** An object containing sizing and path information about a notch. */\nexport interface Notch {\n  type: number;\n  width: number;\n  height: number;\n  pathLeft: string;\n  pathRight: string;\n}\n\n/** An object containing sizing and path information about a puzzle tab. */\nexport interface PuzzleTab {\n  type: number;\n  width: number;\n  height: number;\n  pathDown: string;\n  pathUp: string;\n}\n\n/**\n * An object containing sizing and path information about collapsed block\n * indicators.\n */\nexport interface JaggedTeeth {\n  height: number;\n  width: number;\n  path: string;\n}\n\nexport type BaseShape = {\n  type: number;\n  width: number;\n  height: number;\n};\n\n/** An object containing sizing and type information about a dynamic shape. */\nexport type DynamicShape = {\n  type: number;\n  width: (p1: number) => number;\n  height: (p1: number) => number;\n  isDynamic: true;\n  connectionOffsetY: (p1: number) => number;\n  connectionOffsetX: (p1: number) => number;\n  pathDown: (p1: number) => string;\n  pathUp: (p1: number) => string;\n  pathRightDown: (p1: number) => string;\n  pathRightUp: (p1: number) => string;\n};\n\n/** An object containing sizing and type information about a shape. */\nexport type Shape = BaseShape | DynamicShape;\n\n/**\n * Returns whether the shape is dynamic or not.\n *\n * @param shape The shape to check for dynamic-ness.\n * @returns Whether the shape is a dynamic shape or not.\n */\nexport function isDynamicShape(shape: Shape): shape is DynamicShape {\n  return (shape as DynamicShape).isDynamic;\n}\n\n/** Returns whether the shape is a puzzle tab or not. */\nexport function isPuzzleTab(shape: Shape): shape is PuzzleTab {\n  return (\n    (shape as PuzzleTab).pathDown !== undefined &&\n    (shape as PuzzleTab).pathUp !== undefined\n  );\n}\n\n/** Returns whether the shape is a notch or not. */\nexport function isNotch(shape: Shape): shape is Notch {\n  return (\n    (shape as Notch).pathLeft !== undefined &&\n    (shape as Notch).pathRight !== undefined\n  );\n}\n\n/**\n * An object that provides constants for rendering blocks.\n */\nexport class ConstantProvider {\n  /** The size of an empty spacer. */\n  NO_PADDING = 0;\n\n  /** The size of small padding. */\n  SMALL_PADDING = 3;\n\n  /** The size of medium padding. */\n  MEDIUM_PADDING = 5;\n\n  /** The size of medium-large padding. */\n  MEDIUM_LARGE_PADDING = 8;\n\n  /** The size of large padding. */\n  LARGE_PADDING = 10;\n  TALL_INPUT_FIELD_OFFSET_Y: number;\n\n  /** The height of the puzzle tab used for input and output connections. */\n  TAB_HEIGHT = 15;\n\n  /**\n   * The offset from the top of the block at which a puzzle tab is positioned.\n   */\n  TAB_OFFSET_FROM_TOP = 5;\n\n  /**\n   * Vertical overlap of the puzzle tab, used to make it look more like a\n   * puzzle piece.\n   */\n  TAB_VERTICAL_OVERLAP = 2.5;\n\n  /** The width of the puzzle tab used for input and output connections. */\n  TAB_WIDTH = 8;\n\n  /** The width of the notch used for previous and next connections. */\n  NOTCH_WIDTH = 15;\n\n  /** The height of the notch used for previous and next connections. */\n  NOTCH_HEIGHT = 4;\n\n  /** The minimum width of the block. */\n  MIN_BLOCK_WIDTH = 12;\n  EMPTY_BLOCK_SPACER_HEIGHT = 16;\n  DUMMY_INPUT_MIN_HEIGHT: number;\n  DUMMY_INPUT_SHADOW_MIN_HEIGHT: number;\n\n  /** Rounded corner radius. */\n  CORNER_RADIUS = 8;\n\n  /**\n   * Offset from the left side of a block or the inside of a statement input\n   * to the left side of the notch.\n   */\n  NOTCH_OFFSET_LEFT = 15;\n  STATEMENT_INPUT_NOTCH_OFFSET: number;\n\n  STATEMENT_BOTTOM_SPACER = 0;\n  STATEMENT_INPUT_PADDING_LEFT = 20;\n\n  /** Vertical padding between consecutive statement inputs. */\n  BETWEEN_STATEMENT_PADDING_Y = 4;\n  TOP_ROW_MIN_HEIGHT: number;\n  TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT: number;\n  BOTTOM_ROW_MIN_HEIGHT: number;\n  BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT: number;\n\n  /**\n   * Whether to add a 'hat' on top of all blocks with no previous or output\n   * connections. Can be overridden by 'hat' property on Theme.BlockStyle.\n   */\n  ADD_START_HATS = false;\n\n  /** Height of the top hat. */\n  START_HAT_HEIGHT = 15;\n\n  /** Width of the top hat. */\n  START_HAT_WIDTH = 100;\n\n  SPACER_DEFAULT_HEIGHT = 15;\n\n  MIN_BLOCK_HEIGHT = 24;\n\n  EMPTY_INLINE_INPUT_PADDING = 14.5;\n  EMPTY_INLINE_INPUT_HEIGHT: number;\n\n  EXTERNAL_VALUE_INPUT_PADDING = 2;\n  EMPTY_STATEMENT_INPUT_HEIGHT: number;\n  START_POINT: string;\n\n  /** Height of SVG path for jagged teeth at the end of collapsed blocks. */\n  JAGGED_TEETH_HEIGHT = 12;\n\n  /** Width of SVG path for jagged teeth at the end of collapsed blocks. */\n  JAGGED_TEETH_WIDTH = 6;\n\n  /** Point size of text. */\n  FIELD_TEXT_FONTSIZE = 11;\n\n  /** Text font weight. */\n  FIELD_TEXT_FONTWEIGHT = 'normal';\n\n  /** Text font family. */\n  FIELD_TEXT_FONTFAMILY = 'sans-serif';\n\n  /**\n   * Height of text.  This constant is dynamically set in\n   * `setFontConstants_` to be the height of the text based on the font\n   * used.\n   */\n  FIELD_TEXT_HEIGHT = -1; // Dynamically set.\n\n  /**\n   * Text baseline.  This constant is dynamically set in `setFontConstants_`\n   * to be the baseline of the text based on the font used.\n   */\n  FIELD_TEXT_BASELINE = -1; // Dynamically set.\n\n  /** A field's border rect corner radius. */\n  FIELD_BORDER_RECT_RADIUS = 4;\n\n  /** A field's border rect default height. */\n  FIELD_BORDER_RECT_HEIGHT = 16;\n\n  /** A field's border rect X padding. */\n  FIELD_BORDER_RECT_X_PADDING = 5;\n\n  /** A field's border rect Y padding. */\n  FIELD_BORDER_RECT_Y_PADDING = 3;\n\n  /**\n   * The backing colour of a field's border rect.\n   */\n  FIELD_BORDER_RECT_COLOUR = '#fff';\n  FIELD_TEXT_BASELINE_CENTER: boolean;\n  FIELD_DROPDOWN_BORDER_RECT_HEIGHT: number;\n\n  /**\n   * Whether or not a dropdown field should add a border rect when in a shadow\n   * block.\n   */\n  FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW = false;\n\n  /**\n   * Whether or not a dropdown field's div should be coloured to match the\n   * block colours.\n   */\n  FIELD_DROPDOWN_COLOURED_DIV = false;\n\n  /** Whether or not a dropdown field uses a text or SVG arrow. */\n  FIELD_DROPDOWN_SVG_ARROW = false;\n  FIELD_DROPDOWN_SVG_ARROW_PADDING: number;\n\n  /** A dropdown field's SVG arrow size. */\n  FIELD_DROPDOWN_SVG_ARROW_SIZE = 12;\n  FIELD_DROPDOWN_SVG_ARROW_DATAURI: string;\n\n  /**\n   * Whether or not to show a box shadow around the widget div. This is only a\n   * feature of full block fields.\n   */\n  FIELD_TEXTINPUT_BOX_SHADOW = false;\n\n  /**\n   * Whether or not the colour field should display its colour value on the\n   * entire block.\n   */\n  FIELD_COLOUR_FULL_BLOCK = false;\n\n  /** A colour field's default width. */\n  FIELD_COLOUR_DEFAULT_WIDTH = 26;\n  FIELD_COLOUR_DEFAULT_HEIGHT: number;\n  FIELD_CHECKBOX_X_OFFSET: number;\n  randomIdentifier: string;\n\n  /**\n   * The defs tag that contains all filters and patterns for this Blockly\n   * instance.\n   */\n  private defs: SVGElement | null = null;\n\n  /**\n   * The ID of the emboss filter, or the empty string if no filter is set.\n   */\n  embossFilterId = '';\n\n  /** The <filter> element to use for highlighting, or null if not set. */\n  private embossFilter: SVGElement | null = null;\n\n  /**\n   * The ID of the disabled pattern, or the empty string if no pattern is set.\n   */\n  disabledPatternId = '';\n\n  /**\n   * The <pattern> element to use for disabled blocks, or null if not set.\n   */\n  private disabledPattern: SVGElement | null = null;\n\n  /**\n   * The ID of the debug filter, or the empty string if no pattern is set.\n   */\n  debugFilterId = '';\n\n  /**\n   * The <filter> element to use for a debug highlight, or null if not set.\n   */\n  private debugFilter: SVGElement | null = null;\n\n  /** The <style> element to use for injecting renderer specific CSS. */\n  private cssNode: HTMLStyleElement | null = null;\n\n  /**\n   * Cursor colour.\n   */\n  CURSOR_COLOUR = '#cc0a0a';\n\n  /**\n   * Immovable marker colour.\n   */\n  MARKER_COLOUR = '#4286f4';\n\n  /**\n   * Width of the horizontal cursor.\n   */\n  CURSOR_WS_WIDTH = 100;\n\n  /**\n   * Height of the horizontal cursor.\n   */\n  WS_CURSOR_HEIGHT = 5;\n\n  /**\n   * Padding around a stack.\n   */\n  CURSOR_STACK_PADDING = 10;\n\n  /**\n   * Padding around a block.\n   */\n  CURSOR_BLOCK_PADDING = 2;\n\n  /**\n   * Stroke of the cursor.\n   */\n  CURSOR_STROKE_WIDTH = 4;\n\n  /**\n   * Whether text input and colour fields fill up the entire source block.\n   */\n  FULL_BLOCK_FIELDS = false;\n\n  /**\n   * The main colour of insertion markers, in hex.  The block is rendered a\n   * transparent grey by changing the fill opacity in CSS.\n   */\n  INSERTION_MARKER_COLOUR = '#000000';\n\n  /**\n   * The insertion marker opacity.\n   */\n  INSERTION_MARKER_OPACITY = 0.2;\n\n  SHAPES: {[key: string]: number} = {PUZZLE: 1, NOTCH: 2};\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  JAGGED_TEETH!: JaggedTeeth;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  NOTCH!: Notch;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  START_HAT!: StartHat;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  PUZZLE_TAB!: PuzzleTab;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  INSIDE_CORNERS!: InsideCorners;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  OUTSIDE_CORNERS!: OutsideCorners;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n\n  blockStyles!: {[key: string]: BlockStyle};\n\n  constructor() {\n    /**\n     * Offset from the top of the row for placing fields on inline input rows\n     * and statement input rows.\n     * Matches existing rendering (in 2019).\n     */\n    this.TALL_INPUT_FIELD_OFFSET_Y = this.MEDIUM_PADDING;\n\n    /** The minimum height of a dummy input row. */\n    this.DUMMY_INPUT_MIN_HEIGHT = this.TAB_HEIGHT;\n\n    /** The minimum height of a dummy input row in a shadow block. */\n    this.DUMMY_INPUT_SHADOW_MIN_HEIGHT = this.TAB_HEIGHT;\n\n    /**\n     * Additional offset added to the statement input's width to account for the\n     * notch.\n     */\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT;\n\n    /** The top row's minimum height. */\n    this.TOP_ROW_MIN_HEIGHT = this.MEDIUM_PADDING;\n\n    /** The top row's minimum height if it precedes a statement. */\n    this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    /** The bottom row's minimum height. */\n    this.BOTTOM_ROW_MIN_HEIGHT = this.MEDIUM_PADDING;\n\n    /** The bottom row's minimum height if it follows a statement input. */\n    this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    /** The height of an empty inline input. */\n    this.EMPTY_INLINE_INPUT_HEIGHT = this.TAB_HEIGHT + 11;\n\n    /**\n     * The height of an empty statement input.  Note that in the old rendering\n     * this varies slightly depending on whether the block has external or\n     * inline inputs. In the new rendering this is consistent.  It seems\n     * unlikely that the old behaviour was intentional.\n     */\n    this.EMPTY_STATEMENT_INPUT_HEIGHT = this.MIN_BLOCK_HEIGHT;\n\n    this.START_POINT = svgPaths.moveBy(0, 0);\n\n    /**\n     * A field's text element's dominant baseline. Pre-2022 this could be false\n     * for certain browsers.\n     */\n    this.FIELD_TEXT_BASELINE_CENTER = true;\n\n    /** A dropdown field's border rect height. */\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n\n    /** A dropdown field's SVG arrow padding. */\n    this.FIELD_DROPDOWN_SVG_ARROW_PADDING = this.FIELD_BORDER_RECT_X_PADDING;\n\n    /** A dropdown field's SVG arrow datauri. */\n    this.FIELD_DROPDOWN_SVG_ARROW_DATAURI =\n      'data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllci' +\n      'AxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaG' +\n      'VpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLW' +\n      'Fycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuND' +\n      'EsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTD' +\n      'AuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNz' +\n      'FDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMC' +\n      'wxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNz' +\n      'lhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYz' +\n      'AuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMz' +\n      'dBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=';\n\n    /** A colour field's default height. */\n    this.FIELD_COLOUR_DEFAULT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n\n    /** A checkbox field's X offset. */\n    this.FIELD_CHECKBOX_X_OFFSET = this.FIELD_BORDER_RECT_X_PADDING - 3;\n\n    /**\n     * A random identifier used to ensure a unique ID is used for each\n     * filter/pattern for the case of multiple Blockly instances on a page.\n     */\n    this.randomIdentifier = String(Math.random()).substring(2);\n  }\n\n  /**\n   * Initialize shape objects based on the constants set in the constructor.\n   */\n  init() {\n    /**\n     * An object containing sizing and path information about collapsed block\n     * indicators.\n     */\n    this.JAGGED_TEETH = this.makeJaggedTeeth();\n\n    /** An object containing sizing and path information about notches. */\n    this.NOTCH = this.makeNotch();\n\n    /** An object containing sizing and path information about start hats */\n    this.START_HAT = this.makeStartHat();\n\n    /**\n     * An object containing sizing and path information about puzzle tabs.\n     */\n    this.PUZZLE_TAB = this.makePuzzleTab();\n\n    /**\n     * An object containing sizing and path information about inside corners\n     */\n    this.INSIDE_CORNERS = this.makeInsideCorners();\n\n    /**\n     * An object containing sizing and path information about outside corners.\n     */\n    this.OUTSIDE_CORNERS = this.makeOutsideCorners();\n  }\n\n  /**\n   * Refresh constants properties that depend on the theme.\n   *\n   * @param theme The current workspace theme.\n   */\n  setTheme(theme: Theme) {\n    /** The block styles map. */\n    this.blockStyles = Object.create(null);\n\n    const blockStyles = theme.blockStyles;\n    for (const key in blockStyles) {\n      this.blockStyles[key] = this.validatedBlockStyle_(blockStyles[key]);\n    }\n\n    this.setDynamicProperties_(theme);\n  }\n\n  /**\n   * Sets dynamic properties that depend on other values or theme properties.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setDynamicProperties_(theme: Theme) {\n    this.setFontConstants_(theme);\n    this.setComponentConstants_(theme);\n\n    this.ADD_START_HATS =\n      theme.startHats !== undefined ? theme.startHats : this.ADD_START_HATS;\n  }\n\n  /**\n   * Set constants related to fonts.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setFontConstants_(theme: Theme) {\n    if (theme.fontStyle && theme.fontStyle['family']) {\n      this.FIELD_TEXT_FONTFAMILY = theme.fontStyle['family'];\n    }\n\n    if (theme.fontStyle && theme.fontStyle['weight']) {\n      this.FIELD_TEXT_FONTWEIGHT = theme.fontStyle['weight'];\n    }\n\n    if (theme.fontStyle && theme.fontStyle['size']) {\n      this.FIELD_TEXT_FONTSIZE = theme.fontStyle['size'];\n    }\n\n    const fontMetrics = dom.measureFontMetrics(\n      'Hg',\n      this.FIELD_TEXT_FONTSIZE + 'pt',\n      this.FIELD_TEXT_FONTWEIGHT,\n      this.FIELD_TEXT_FONTFAMILY,\n    );\n\n    this.FIELD_TEXT_HEIGHT = fontMetrics.height;\n    this.FIELD_TEXT_BASELINE = fontMetrics.baseline;\n  }\n\n  /**\n   * Set constants from a theme's component styles.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setComponentConstants_(theme: Theme) {\n    this.CURSOR_COLOUR =\n      theme.getComponentStyle('cursorColour') || this.CURSOR_COLOUR;\n    this.MARKER_COLOUR =\n      theme.getComponentStyle('markerColour') || this.MARKER_COLOUR;\n    this.INSERTION_MARKER_COLOUR =\n      theme.getComponentStyle('insertionMarkerColour') ||\n      this.INSERTION_MARKER_COLOUR;\n    this.INSERTION_MARKER_OPACITY =\n      Number(theme.getComponentStyle('insertionMarkerOpacity')) ||\n      this.INSERTION_MARKER_OPACITY;\n  }\n\n  /**\n   * Get or create a block style based on a single colour value.  Generate a\n   * name for the style based on the colour.\n   *\n   * @param colour #RRGGBB colour string.\n   * @returns An object containing the style and an autogenerated name for that\n   *     style.\n   */\n  getBlockStyleForColour(colour: string): {style: BlockStyle; name: string} {\n    const name = 'auto_' + colour;\n    if (!this.blockStyles[name]) {\n      this.blockStyles[name] = this.createBlockStyle_(colour);\n    }\n    return {style: this.blockStyles[name], name};\n  }\n\n  /**\n   * Gets the BlockStyle for the given block style name.\n   *\n   * @param blockStyleName The name of the block style.\n   * @returns The named block style, or a default style if no style with the\n   *     given name was found.\n   */\n  getBlockStyle(blockStyleName: string | null): BlockStyle {\n    return (\n      this.blockStyles[blockStyleName || ''] ||\n      (blockStyleName && blockStyleName.startsWith('auto_')\n        ? this.getBlockStyleForColour(blockStyleName.substring(5)).style\n        : this.createBlockStyle_('#000000'))\n    );\n  }\n\n  /**\n   * Create a block style object based on the given colour.\n   *\n   * @param colour #RRGGBB colour string.\n   * @returns A populated block style based on the given colour.\n   */\n  protected createBlockStyle_(colour: string): BlockStyle {\n    return this.validatedBlockStyle_({'colourPrimary': colour});\n  }\n\n  /**\n   * Get a full block style object based on the input style object.  Populate\n   * any missing values.\n   *\n   * @param blockStyle A full or partial block style object.\n   * @returns A full block style object, with all required properties populated.\n   */\n  protected validatedBlockStyle_(blockStyle: Partial<BlockStyle>): BlockStyle {\n    // Make a new object with all of the same properties.\n    const valid = {} as BlockStyle;\n    if (blockStyle) {\n      Object.assign(valid, blockStyle);\n    }\n    // Validate required properties.\n    const parsedColour = parsing.parseBlockColour(\n      valid['colourPrimary'] || '#000',\n    );\n    valid.colourPrimary = parsedColour.hex;\n    valid.colourSecondary = valid['colourSecondary']\n      ? parsing.parseBlockColour(valid['colourSecondary']).hex\n      : this.generateSecondaryColour_(valid.colourPrimary);\n    valid.colourTertiary = valid['colourTertiary']\n      ? parsing.parseBlockColour(valid['colourTertiary']).hex\n      : this.generateTertiaryColour_(valid.colourPrimary);\n\n    valid.hat = valid['hat'] || '';\n    return valid;\n  }\n\n  /**\n   * Generate a secondary colour from the passed in primary colour.\n   *\n   * @param inputColour Primary colour.\n   * @returns The generated secondary colour.\n   */\n  protected generateSecondaryColour_(inputColour: string): string {\n    return colour.blend('#fff', inputColour, 0.6) || inputColour;\n  }\n\n  /**\n   * Generate a tertiary colour from the passed in primary colour.\n   *\n   * @param inputColour Primary colour.\n   * @returns The generated tertiary colour.\n   */\n  protected generateTertiaryColour_(inputColour: string): string {\n    return colour.blend('#fff', inputColour, 0.3) || inputColour;\n  }\n\n  /**\n   * Dispose of this constants provider.\n   * Delete all DOM elements that this provider created.\n   */\n  dispose() {\n    if (this.embossFilter) {\n      dom.removeNode(this.embossFilter);\n    }\n    if (this.disabledPattern) {\n      dom.removeNode(this.disabledPattern);\n    }\n    if (this.debugFilter) {\n      dom.removeNode(this.debugFilter);\n    }\n    this.cssNode = null;\n  }\n\n  /**\n   * @returns An object containing sizing and path information about collapsed\n   *     block indicators.\n   */\n  protected makeJaggedTeeth(): JaggedTeeth {\n    const height = this.JAGGED_TEETH_HEIGHT;\n    const width = this.JAGGED_TEETH_WIDTH;\n\n    const mainPath = svgPaths.line([\n      svgPaths.point(width, height / 4),\n      svgPaths.point(-width * 2, height / 2),\n      svgPaths.point(width, height / 4),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about start hats.\n   */\n  protected makeStartHat(): StartHat {\n    const height = this.START_HAT_HEIGHT;\n    const width = this.START_HAT_WIDTH;\n\n    const mainPath = svgPaths.curve('c', [\n      svgPaths.point(30, -height),\n      svgPaths.point(70, -height),\n      svgPaths.point(width, 0),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about puzzle\n   *     tabs.\n   */\n  protected makePuzzleTab(): PuzzleTab {\n    const width = this.TAB_WIDTH;\n    const height = this.TAB_HEIGHT;\n\n    /**\n     * Make the main path for the puzzle tab made out of a few curves (c and s).\n     * Those curves are defined with relative positions.  The 'up' and 'down'\n     * versions of the paths are the same, but the Y sign flips.  Forward and\n     * back are the signs to use to move the cursor in the direction that the\n     * path is being drawn.\n     *\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @returns A path fragment describing a puzzle tab.\n     */\n    function makeMainPath(up: boolean): string {\n      const forward = up ? -1 : 1;\n      const back = -forward;\n\n      const overlap = 2.5;\n      const halfHeight = height / 2;\n      const control1Y = halfHeight + overlap;\n      const control2Y = halfHeight + 0.5;\n      const control3Y = overlap; // 2.5\n\n      const endPoint1 = svgPaths.point(-width, forward * halfHeight);\n      const endPoint2 = svgPaths.point(width, forward * halfHeight);\n\n      return (\n        svgPaths.curve('c', [\n          svgPaths.point(0, forward * control1Y),\n          svgPaths.point(-width, back * control2Y),\n          endPoint1,\n        ]) +\n        svgPaths.curve('s', [\n          svgPaths.point(width, back * control3Y),\n          endPoint2,\n        ])\n      );\n    }\n\n    // c 0,-10  -8,8  -8,-7.5  s 8,2.5  8,-7.5\n    const pathUp = makeMainPath(true);\n    // c 0,10  -8,-8  -8,7.5  s 8,-2.5  8,7.5\n    const pathDown = makeMainPath(false);\n\n    return {\n      type: this.SHAPES.PUZZLE,\n      width,\n      height,\n      pathDown,\n      pathUp,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about notches.\n   */\n  protected makeNotch(): Notch {\n    const width = this.NOTCH_WIDTH;\n    const height = this.NOTCH_HEIGHT;\n    const innerWidth = 3;\n    const outerWidth = (width - innerWidth) / 2;\n\n    /**\n     * Make the main path for the notch.\n     *\n     * @param dir Direction multiplier to apply to horizontal offsets along the\n     *     path. Either 1 or -1.\n     * @returns A path fragment describing a notch.\n     */\n    function makeMainPath(dir: number): string {\n      return svgPaths.line([\n        svgPaths.point(dir * outerWidth, height),\n        svgPaths.point(dir * innerWidth, 0),\n        svgPaths.point(dir * outerWidth, -height),\n      ]);\n    }\n    const pathLeft = makeMainPath(1);\n    const pathRight = makeMainPath(-1);\n\n    return {\n      type: this.SHAPES.NOTCH,\n      width,\n      height,\n      pathLeft,\n      pathRight,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about inside\n   *     corners.\n   */\n  protected makeInsideCorners(): InsideCorners {\n    const radius = this.CORNER_RADIUS;\n\n    const innerTopLeftCorner = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius,\n      svgPaths.point(-radius, radius),\n    );\n\n    const innerBottomLeftCorner = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius,\n      svgPaths.point(radius, radius),\n    );\n\n    return {\n      width: radius,\n      height: radius,\n      pathTop: innerTopLeftCorner,\n      pathBottom: innerBottomLeftCorner,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about outside\n   *     corners.\n   */\n  protected makeOutsideCorners(): OutsideCorners {\n    const radius = this.CORNER_RADIUS;\n    /** SVG path for drawing the rounded top-left corner. */\n    const topLeft =\n      svgPaths.moveBy(0, radius) +\n      svgPaths.arc('a', '0 0,1', radius, svgPaths.point(radius, -radius));\n\n    /** SVG path for drawing the rounded top-right corner. */\n    const topRight = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(radius, radius),\n    );\n\n    /** SVG path for drawing the rounded bottom-left corner. */\n    const bottomLeft = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(-radius, -radius),\n    );\n\n    /** SVG path for drawing the rounded bottom-right corner. */\n    const bottomRight = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(-radius, radius),\n    );\n\n    return {\n      topLeft,\n      topRight,\n      bottomRight,\n      bottomLeft,\n      rightHeight: radius,\n    };\n  }\n\n  /**\n   * Get an object with connection shape and sizing information based on the\n   * type of the connection.\n   *\n   * @param connection The connection to find a shape object for\n   * @returns The shape object for the connection.\n   */\n  shapeFor(connection: RenderedConnection): Shape {\n    switch (connection.type) {\n      case ConnectionType.INPUT_VALUE:\n      case ConnectionType.OUTPUT_VALUE:\n        return this.PUZZLE_TAB;\n      case ConnectionType.PREVIOUS_STATEMENT:\n      case ConnectionType.NEXT_STATEMENT:\n        return this.NOTCH;\n      default:\n        throw Error('Unknown connection type');\n    }\n  }\n\n  /**\n   * Create any DOM elements that this renderer needs (filters, patterns, etc).\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param tagName The name to use for the CSS style tag.\n   * @param selector The CSS selector to use.\n   */\n  createDom(svg: SVGElement, tagName: string, selector: string) {\n    this.injectCSS_(tagName, selector);\n\n    /*\n        <defs>\n          ... filters go here ...\n        </defs>\n        */\n    this.defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n    /*\n          <filter id=\"blocklyEmbossFilter837493\">\n            <feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"1\" result=\"blur\" />\n            <feSpecularLighting in=\"blur\" surfaceScale=\"1\"\n       specularConstant=\"0.5\" specularExponent=\"10\" lighting-color=\"white\"\n                                result=\"specOut\">\n              <fePointLight x=\"-5000\" y=\"-10000\" z=\"20000\" />\n            </feSpecularLighting>\n            <feComposite in=\"specOut\" in2=\"SourceAlpha\" operator=\"in\"\n                         result=\"specOut\" />\n            <feComposite in=\"SourceGraphic\" in2=\"specOut\" operator=\"arithmetic\"\n                         k1=\"0\" k2=\"1\" k3=\"1\" k4=\"0\" />\n          </filter>\n        */\n    const embossFilter = dom.createSvgElement(\n      Svg.FILTER,\n      {'id': 'blocklyEmbossFilter' + this.randomIdentifier},\n      this.defs,\n    );\n    dom.createSvgElement(\n      Svg.FEGAUSSIANBLUR,\n      {'in': 'SourceAlpha', 'stdDeviation': 1, 'result': 'blur'},\n      embossFilter,\n    );\n    const feSpecularLighting = dom.createSvgElement(\n      Svg.FESPECULARLIGHTING,\n      {\n        'in': 'blur',\n        'surfaceScale': 1,\n        'specularConstant': 0.5,\n        'specularExponent': 10,\n        'lighting-color': 'white',\n        'result': 'specOut',\n      },\n      embossFilter,\n    );\n    dom.createSvgElement(\n      Svg.FEPOINTLIGHT,\n      {'x': -5000, 'y': -10000, 'z': 20000},\n      feSpecularLighting,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'specOut',\n        'in2': 'SourceAlpha',\n        'operator': 'in',\n        'result': 'specOut',\n      },\n      embossFilter,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'SourceGraphic',\n        'in2': 'specOut',\n        'operator': 'arithmetic',\n        'k1': 0,\n        'k2': 1,\n        'k3': 1,\n        'k4': 0,\n      },\n      embossFilter,\n    );\n    this.embossFilterId = embossFilter.id;\n    this.embossFilter = embossFilter;\n\n    /*\n          <pattern id=\"blocklyDisabledPattern837493\"\n       patternUnits=\"userSpaceOnUse\" width=\"10\" height=\"10\"> <rect width=\"10\"\n       height=\"10\" fill=\"#aaa\" /> <path d=\"M 0 0 L 10 10 M 10 0 L 0 10\"\n       stroke=\"#cc0\" />\n          </pattern>\n        */\n    const disabledPattern = dom.createSvgElement(\n      Svg.PATTERN,\n      {\n        'id': 'blocklyDisabledPattern' + this.randomIdentifier,\n        'patternUnits': 'userSpaceOnUse',\n        'width': 10,\n        'height': 10,\n      },\n      this.defs,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {'width': 10, 'height': 10, 'fill': '#aaa'},\n      disabledPattern,\n    );\n    dom.createSvgElement(\n      Svg.PATH,\n      {'d': 'M 0 0 L 10 10 M 10 0 L 0 10', 'stroke': '#cc0'},\n      disabledPattern,\n    );\n    this.disabledPatternId = disabledPattern.id;\n    this.disabledPattern = disabledPattern;\n\n    this.createDebugFilter();\n  }\n\n  /**\n   * Create a filter for highlighting the currently rendering block during\n   * render debugging.\n   */\n  private createDebugFilter() {\n    // Only create the debug filter once.\n    if (!this.debugFilter) {\n      const debugFilter = dom.createSvgElement(\n        Svg.FILTER,\n        {\n          'id': 'blocklyDebugFilter' + this.randomIdentifier,\n          'height': '160%',\n          'width': '180%',\n          'y': '-30%',\n          'x': '-40%',\n        },\n        this.defs,\n      );\n      // Set all gaussian blur pixels to 1 opacity before applying flood\n      const debugComponentTransfer = dom.createSvgElement(\n        Svg.FECOMPONENTTRANSFER,\n        {'result': 'outBlur'},\n        debugFilter,\n      );\n      dom.createSvgElement(\n        Svg.FEFUNCA,\n        {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n        debugComponentTransfer,\n      );\n      // Color the highlight\n      dom.createSvgElement(\n        Svg.FEFLOOD,\n        {\n          'flood-color': '#ff0000',\n          'flood-opacity': 0.5,\n          'result': 'outColor',\n        },\n        debugFilter,\n      );\n      dom.createSvgElement(\n        Svg.FECOMPOSITE,\n        {\n          'in': 'outColor',\n          'in2': 'outBlur',\n          'operator': 'in',\n          'result': 'outGlow',\n        },\n        debugFilter,\n      );\n      this.debugFilterId = debugFilter.id;\n      this.debugFilter = debugFilter;\n    }\n  }\n\n  /**\n   * Inject renderer specific CSS into the page.\n   *\n   * @param tagName The name of the style tag to use.\n   * @param selector The CSS selector to use.\n   */\n  protected injectCSS_(tagName: string, selector: string) {\n    const cssArray = this.getCSS_(selector);\n    const cssNodeId = 'blockly-renderer-style-' + tagName;\n    this.cssNode = document.getElementById(cssNodeId) as HTMLStyleElement;\n    const text = cssArray.join('\\n');\n    if (this.cssNode) {\n      // Already injected, update if the theme changed.\n      this.cssNode.firstChild!.textContent = text;\n      return;\n    }\n    // Inject CSS tag at start of head.\n    const cssNode = document.createElement('style');\n    cssNode.id = cssNodeId;\n    const cssTextNode = document.createTextNode(text);\n    cssNode.appendChild(cssTextNode);\n    document.head.insertBefore(cssNode, document.head.firstChild);\n    this.cssNode = cssNode;\n  }\n\n  /**\n   * Get any renderer specific CSS to inject when the renderer is initialized.\n   *\n   * @param selector CSS selector to use.\n   * @returns Array of CSS strings.\n   */\n  protected getCSS_(selector: string): string[] {\n    // prettier-ignore\n    return [\n      // Text.\n      `${selector} .blocklyText, `,\n      `${selector} .blocklyFlyoutLabelText {`,\n        `font: ${this.FIELD_TEXT_FONTWEIGHT} ` +\n            `${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n\n      // Fields.\n      `${selector} .blocklyText {`,\n        `fill: #fff;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>rect,`,\n      `${selector} .blocklyEditableText>rect {`,\n        `fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\n        `fill-opacity: .6;`,\n        `stroke: none;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>text,`,\n      `${selector} .blocklyEditableText>text {`,\n        `fill: #000;`,\n      `}`,\n\n      // Flyout labels.\n      `${selector} .blocklyFlyoutLabelText {`,\n        `fill: #000;`,\n      `}`,\n\n      // Bubbles.\n      `${selector} .blocklyText.blocklyBubbleText {`,\n        `fill: #000;`,\n      `}`,\n\n      // Editable field hover.\n      `${selector} .blocklyEditableText:not(.editing):hover>rect {`,\n        `stroke: #fff;`,\n        `stroke-width: 2;`,\n      `}`,\n\n      // Text field input.\n      `${selector} .blocklyHtmlInput {`,\n        `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n        `font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\n      `}`,\n\n      // Selection highlight.\n      `${selector} .blocklySelected>.blocklyPath {`,\n        `stroke: #fc3;`,\n        `stroke-width: 3px;`,\n      `}`,\n\n      // Connection highlight.\n      `${selector} .blocklyHighlightedConnectionPath {`,\n        `stroke: #fc3;`,\n      `}`,\n\n      // Replaceable highlight.\n      `${selector} .blocklyReplaceable .blocklyPath {`,\n        `fill-opacity: .5;`,\n      `}`,\n      `${selector} .blocklyReplaceable .blocklyPathLight,`,\n      `${selector} .blocklyReplaceable .blocklyPathDark {`,\n        `display: none;`,\n      `}`,\n\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPath {`,\n        `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n        `stroke: none;`,\n      `}`,\n    ];\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for creating connections between blocks.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Connection\n\nimport type {Block} from './block.js';\nimport {ConnectionType} from './connection_type.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Input} from './inputs/input.js';\nimport type {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as Xml from './xml.js';\n\n/**\n * Class for a connection between blocks.\n */\nexport class Connection implements IASTNodeLocationWithBlock {\n  /** Constants for checking whether two connections are compatible. */\n  static CAN_CONNECT = 0;\n  static REASON_SELF_CONNECTION = 1;\n  static REASON_WRONG_TYPE = 2;\n  static REASON_TARGET_NULL = 3;\n  static REASON_CHECKS_FAILED = 4;\n  static REASON_DIFFERENT_WORKSPACES = 5;\n  static REASON_SHADOW_PARENT = 6;\n  static REASON_DRAG_CHECKS_FAILED = 7;\n  static REASON_PREVIOUS_AND_OUTPUT = 8;\n\n  protected sourceBlock_: Block;\n\n  /** Connection this connection connects to.  Null if not connected. */\n  targetConnection: Connection | null = null;\n\n  /**\n   * Has this connection been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /** List of compatible value types.  Null if all types are compatible. */\n  private check: string[] | null = null;\n\n  /** DOM representation of a shadow block, or null if none. */\n  private shadowDom: Element | null = null;\n\n  /**\n   * Horizontal location of this connection.\n   *\n   * @internal\n   */\n  x = 0;\n\n  /**\n   * Vertical location of this connection.\n   *\n   * @internal\n   */\n  y = 0;\n\n  private shadowState: blocks.State | null = null;\n\n  /**\n   * @param source The block establishing this connection.\n   * @param type The type of the connection.\n   */\n  constructor(\n    source: Block,\n    public type: number,\n  ) {\n    this.sourceBlock_ = source;\n  }\n\n  /**\n   * Connect two connections together.  This is the connection on the superior\n   * block.\n   *\n   * @param childConnection Connection on inferior block.\n   */\n  protected connect_(childConnection: Connection) {\n    const INPUT = ConnectionType.INPUT_VALUE;\n    const parentBlock = this.getSourceBlock();\n    const childBlock = childConnection.getSourceBlock();\n\n    // Make sure the childConnection is available.\n    if (childConnection.isConnected()) {\n      childConnection.disconnectInternal(false);\n    }\n\n    // Make sure the parentConnection is available.\n    let orphan;\n    if (this.isConnected()) {\n      const shadowState = this.stashShadowState();\n      const target = this.targetBlock();\n      if (target!.isShadow()) {\n        target!.dispose(false);\n      } else {\n        this.disconnectInternal();\n        orphan = target;\n      }\n      this.applyShadowState(shadowState);\n    }\n\n    // Connect the new connection to the parent.\n    let event;\n    if (eventUtils.isEnabled()) {\n      event = new (eventUtils.get(EventType.BLOCK_MOVE))(\n        childBlock,\n      ) as BlockMove;\n      event.setReason(['connect']);\n    }\n    connectReciprocally(this, childConnection);\n    childBlock.setParent(parentBlock);\n    if (event) {\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n\n    // Deal with the orphan if it exists.\n    if (orphan) {\n      const orphanConnection =\n        this.type === INPUT\n          ? orphan.outputConnection\n          : orphan.previousConnection;\n      if (!orphanConnection) return;\n      const connection = Connection.getConnectionForOrphanedConnection(\n        childBlock,\n        orphanConnection,\n      );\n      if (connection) {\n        orphanConnection.connect(connection);\n      } else {\n        orphanConnection.onFailedConnect(this);\n      }\n    }\n  }\n\n  /**\n   * Dispose of this connection and deal with connected blocks.\n   *\n   * @internal\n   */\n  dispose() {\n    // isConnected returns true for shadows and non-shadows.\n    if (this.isConnected()) {\n      if (this.isSuperior()) {\n        // Destroy the attached shadow block & its children (if it exists).\n        this.setShadowStateInternal();\n      }\n\n      const targetBlock = this.targetBlock();\n      if (targetBlock && !targetBlock.isDeadOrDying()) {\n        // Disconnect the attached normal block.\n        targetBlock.unplug();\n      }\n    }\n\n    this.disposed = true;\n  }\n\n  /**\n   * Get the source block for this connection.\n   *\n   * @returns The source block.\n   */\n  getSourceBlock(): Block {\n    return this.sourceBlock_;\n  }\n\n  /**\n   * Does the connection belong to a superior block (higher in the source\n   * stack)?\n   *\n   * @returns True if connection faces down or right.\n   */\n  isSuperior(): boolean {\n    return (\n      this.type === ConnectionType.INPUT_VALUE ||\n      this.type === ConnectionType.NEXT_STATEMENT\n    );\n  }\n\n  /**\n   * Is the connection connected?\n   *\n   * @returns True if connection is connected to another connection.\n   */\n  isConnected(): boolean {\n    return !!this.targetConnection;\n  }\n\n  /**\n   * Get the workspace's connection type checker object.\n   *\n   * @returns The connection type checker for the source block's workspace.\n   * @internal\n   */\n  getConnectionChecker(): IConnectionChecker {\n    return this.sourceBlock_.workspace.connectionChecker;\n  }\n\n  /**\n   * Called when an attempted connection fails. NOP by default (i.e. for\n   * headless workspaces).\n   *\n   * @param _superiorConnection Connection that this connection failed to connect\n   *     to. The provided connection should be the superior connection.\n   * @internal\n   */\n  onFailedConnect(_superiorConnection: Connection) {}\n  // NOP\n\n  /**\n   * Connect this connection to another connection.\n   *\n   * @param otherConnection Connection to connect to.\n   * @returns Whether the blocks are now connected or not.\n   */\n  connect(otherConnection: Connection): boolean {\n    if (this.targetConnection === otherConnection) {\n      // Already connected together.  NOP.\n      return true;\n    }\n\n    const checker = this.getConnectionChecker();\n    if (checker.canConnect(this, otherConnection, false)) {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      // Determine which block is superior (higher in the source stack).\n      if (this.isSuperior()) {\n        // Superior block.\n        this.connect_(otherConnection);\n      } else {\n        // Inferior block.\n        otherConnection.connect_(this);\n      }\n      eventUtils.setGroup(existingGroup);\n    }\n\n    return this.isConnected();\n  }\n\n  /**\n   * Disconnect this connection.\n   */\n  disconnect() {\n    this.disconnectInternal();\n  }\n\n  /**\n   * Disconnect two blocks that are connected by this connection.\n   *\n   * @param setParent Whether to set the parent of the disconnected block or\n   *     not, defaults to true.\n   *     If you do not set the parent, ensure that a subsequent action does,\n   *     otherwise the view and model will be out of sync.\n   */\n  protected disconnectInternal(setParent = true) {\n    const {parentConnection, childConnection} =\n      this.getParentAndChildConnections();\n    if (!parentConnection || !childConnection) {\n      throw Error('Source connection not connected.');\n    }\n\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n\n    let event;\n    if (eventUtils.isEnabled()) {\n      event = new (eventUtils.get(EventType.BLOCK_MOVE))(\n        childConnection.getSourceBlock(),\n      ) as BlockMove;\n      event.setReason(['disconnect']);\n    }\n    const otherConnection = this.targetConnection;\n    if (otherConnection) {\n      otherConnection.targetConnection = null;\n    }\n    this.targetConnection = null;\n    if (setParent) childConnection.getSourceBlock().setParent(null);\n    if (event) {\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n\n    if (!childConnection.getSourceBlock().isShadow()) {\n      // If we were disconnecting a shadow, no need to spawn a new one.\n      parentConnection.respawnShadow_();\n    }\n\n    eventUtils.setGroup(existingGroup);\n  }\n\n  /**\n   * Returns the parent connection (superior) and child connection (inferior)\n   * given this connection and the connection it is connected to.\n   *\n   * @returns The parent connection and child connection, given this connection\n   *     and the connection it is connected to.\n   */\n  protected getParentAndChildConnections(): {\n    parentConnection?: Connection;\n    childConnection?: Connection;\n  } {\n    if (!this.targetConnection) return {};\n    if (this.isSuperior()) {\n      return {\n        parentConnection: this,\n        childConnection: this.targetConnection,\n      };\n    }\n    return {\n      parentConnection: this.targetConnection,\n      childConnection: this,\n    };\n  }\n\n  /**\n   * Respawn the shadow block if there was one connected to the this connection.\n   */\n  protected respawnShadow_() {\n    // Have to keep respawnShadow_ for backwards compatibility.\n    this.createShadowBlock(true);\n  }\n\n  /**\n   * Reconnects this connection to the input with the given name on the given\n   * block. If there is already a connection connected to that input, that\n   * connection is disconnected.\n   *\n   * @param block The block to connect this connection to.\n   * @param inputName The name of the input to connect this connection to.\n   * @returns True if this connection was able to connect, false otherwise.\n   */\n  reconnect(block: Block, inputName: string): boolean {\n    // No need to reconnect if this connection's block is deleted.\n    if (this.getSourceBlock().isDeadOrDying()) return false;\n\n    const connectionParent = block.getInput(inputName)?.connection;\n    const currentParent = this.targetBlock();\n    if (\n      (!currentParent || currentParent === block) &&\n      connectionParent &&\n      connectionParent.targetConnection !== this\n    ) {\n      if (connectionParent.isConnected()) {\n        // There's already something connected here.  Get rid of it.\n        connectionParent.disconnect();\n      }\n      connectionParent.connect(this);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the block that this connection connects to.\n   *\n   * @returns The connected block or null if none is connected.\n   */\n  targetBlock(): Block | null {\n    if (this.isConnected()) {\n      return this.targetConnection?.getSourceBlock() ?? null;\n    }\n    return null;\n  }\n\n  /**\n   * Function to be called when this connection's compatible types have changed.\n   */\n  protected onCheckChanged_() {\n    // The new value type may not be compatible with the existing connection.\n    if (\n      this.isConnected() &&\n      (!this.targetConnection ||\n        !this.getConnectionChecker().canConnect(\n          this,\n          this.targetConnection,\n          false,\n        ))\n    ) {\n      const child = this.isSuperior() ? this.targetBlock() : this.sourceBlock_;\n      child!.unplug();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   *\n   * @param check Compatible value type or list of value types. Null if all\n   *     types are compatible.\n   * @returns The connection being modified (to allow chaining).\n   */\n  setCheck(check: string | string[] | null): Connection {\n    if (check) {\n      if (!Array.isArray(check)) {\n        check = [check];\n      }\n      this.check = check;\n      this.onCheckChanged_();\n    } else {\n      this.check = null;\n    }\n    return this;\n  }\n\n  /**\n   * Get a connection's compatibility.\n   *\n   * @returns List of compatible value types.\n   *     Null if all types are compatible.\n   */\n  getCheck(): string[] | null {\n    return this.check;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadowDom DOM representation of a block or null.\n   */\n  setShadowDom(shadowDom: Element | null) {\n    this.setShadowStateInternal({shadowDom});\n  }\n\n  /**\n   * Returns the xml representation of the connection's shadow block.\n   *\n   * @param returnCurrent If true, and the shadow block is currently attached to\n   *     this connection, this serializes the state of that block and returns it\n   *     (so that field values are correct). Otherwise the saved shadowDom is\n   *     just returned.\n   * @returns Shadow DOM representation of a block or null.\n   */\n  getShadowDom(returnCurrent?: boolean): Element | null {\n    return returnCurrent && this.targetBlock()!.isShadow()\n      ? (Xml.blockToDom(this.targetBlock() as Block) as Element)\n      : this.shadowDom;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadowState An state represetation of the block or null.\n   */\n  setShadowState(shadowState: blocks.State | null) {\n    this.setShadowStateInternal({shadowState});\n  }\n\n  /**\n   * Returns the serialized object representation of the connection's shadow\n   * block.\n   *\n   * @param returnCurrent If true, and the shadow block is currently attached to\n   *     this connection, this serializes the state of that block and returns it\n   *     (so that field values are correct). Otherwise the saved state is just\n   *     returned.\n   * @returns Serialized object representation of the block, or null.\n   */\n  getShadowState(returnCurrent?: boolean): blocks.State | null {\n    if (returnCurrent && this.targetBlock() && this.targetBlock()!.isShadow()) {\n      return blocks.save(this.targetBlock() as Block);\n    }\n    return this.shadowState;\n  }\n\n  /**\n   * Find all nearby compatible connections to this connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * Headless configurations (the default) do not have neighboring connection,\n   * and always return an empty list (the default).\n   * {@link RenderedConnection#neighbours} overrides this behavior with a list\n   * computed from the rendered positioning.\n   *\n   * @param _maxLimit The maximum radius to another connection.\n   * @returns List of connections.\n   * @internal\n   */\n  neighbours(_maxLimit: number): Connection[] {\n    return [];\n  }\n\n  /**\n   * Get the parent input of a connection.\n   *\n   * @returns The input that the connection belongs to or null if no parent\n   *     exists.\n   * @internal\n   */\n  getParentInput(): Input | null {\n    let parentInput = null;\n    const inputs = this.sourceBlock_.inputList;\n    for (let i = 0; i < inputs.length; i++) {\n      if (inputs[i].connection === this) {\n        parentInput = inputs[i];\n        break;\n      }\n    }\n    return parentInput;\n  }\n\n  /**\n   * This method returns a string describing this Connection in developer terms\n   * (English only). Intended to on be used in console logs and errors.\n   *\n   * @returns The description.\n   */\n  toString(): string {\n    const block = this.sourceBlock_;\n    if (!block) {\n      return 'Orphan Connection';\n    }\n    let msg;\n    if (block.outputConnection === this) {\n      msg = 'Output Connection of ';\n    } else if (block.previousConnection === this) {\n      msg = 'Previous Connection of ';\n    } else if (block.nextConnection === this) {\n      msg = 'Next Connection of ';\n    } else {\n      let parentInput = null;\n      for (let i = 0, input; (input = block.inputList[i]); i++) {\n        if (input.connection === this) {\n          parentInput = input;\n          break;\n        }\n      }\n      if (parentInput) {\n        msg = 'Input \"' + parentInput.name + '\" connection on ';\n      } else {\n        console.warn('Connection not actually connected to sourceBlock_');\n        return 'Orphan Connection';\n      }\n    }\n    return msg + block.toDevString();\n  }\n\n  /**\n   * Returns the state of the shadowDom_ and shadowState_ properties, then\n   * temporarily sets those properties to null so no shadow respawns.\n   *\n   * @returns The state of both the shadowDom_ and shadowState_ properties.\n   */\n  private stashShadowState(): {\n    shadowDom: Element | null;\n    shadowState: blocks.State | null;\n  } {\n    const shadowDom = this.getShadowDom(true);\n    const shadowState = this.getShadowState(true);\n    // Set to null so it doesn't respawn.\n    this.shadowDom = null;\n    this.shadowState = null;\n    return {shadowDom, shadowState};\n  }\n\n  /**\n   * Reapplies the stashed state of the shadowDom_ and shadowState_ properties.\n   *\n   * @param param0 The state to reapply to the shadowDom_ and shadowState_\n   *     properties.\n   */\n  private applyShadowState({\n    shadowDom,\n    shadowState,\n  }: {\n    shadowDom: Element | null;\n    shadowState: blocks.State | null;\n  }) {\n    this.shadowDom = shadowDom;\n    this.shadowState = shadowState;\n  }\n\n  /**\n   * Sets the state of the shadow of this connection.\n   *\n   * @param param0 The state to set the shadow of this connection to.\n   */\n  private setShadowStateInternal({\n    shadowDom = null,\n    shadowState = null,\n  }: {\n    shadowDom?: Element | null;\n    shadowState?: blocks.State | null;\n  } = {}) {\n    // One or both of these should always be null.\n    // If neither is null, the shadowState will get priority.\n    this.shadowDom = shadowDom;\n    this.shadowState = shadowState;\n\n    if (this.getSourceBlock().isDeadOrDying()) return;\n\n    const target = this.targetBlock();\n    if (!target) {\n      this.respawnShadow_();\n      if (this.targetBlock() && this.targetBlock()!.isShadow()) {\n        this.serializeShadow(this.targetBlock());\n      }\n    } else if (target.isShadow()) {\n      target.dispose(false);\n      this.respawnShadow_();\n      if (this.targetBlock() && this.targetBlock()!.isShadow()) {\n        this.serializeShadow(this.targetBlock());\n      }\n    } else {\n      const shadow = this.createShadowBlock(false);\n      this.serializeShadow(shadow);\n      if (shadow) {\n        shadow.dispose(false);\n      }\n    }\n  }\n\n  /**\n   * Creates a shadow block based on the current shadowState_ or shadowDom_.\n   * shadowState_ gets priority.\n   *\n   * @param attemptToConnect Whether to try to connect the shadow block to this\n   *     connection or not.\n   * @returns The shadow block that was created, or null if both the\n   *     shadowState_ and shadowDom_ are null.\n   */\n  private createShadowBlock(attemptToConnect: boolean): Block | null {\n    const parentBlock = this.getSourceBlock();\n    const shadowState = this.getShadowState();\n    const shadowDom = this.getShadowDom();\n    if (parentBlock.isDeadOrDying() || (!shadowState && !shadowDom)) {\n      return null;\n    }\n\n    let blockShadow;\n    if (shadowState) {\n      blockShadow = blocks.appendInternal(shadowState, parentBlock.workspace, {\n        parentConnection: attemptToConnect ? this : undefined,\n        isShadow: true,\n        recordUndo: false,\n      });\n      return blockShadow;\n    }\n\n    if (shadowDom) {\n      blockShadow = Xml.domToBlockInternal(shadowDom, parentBlock.workspace);\n      if (attemptToConnect) {\n        if (this.type === ConnectionType.INPUT_VALUE) {\n          if (!blockShadow.outputConnection) {\n            throw new Error('Shadow block is missing an output connection');\n          }\n          if (!this.connect(blockShadow.outputConnection)) {\n            throw new Error('Could not connect shadow block to connection');\n          }\n        } else if (this.type === ConnectionType.NEXT_STATEMENT) {\n          if (!blockShadow.previousConnection) {\n            throw new Error('Shadow block is missing previous connection');\n          }\n          if (!this.connect(blockShadow.previousConnection)) {\n            throw new Error('Could not connect shadow block to connection');\n          }\n        } else {\n          throw new Error(\n            'Cannot connect a shadow block to a previous/output connection',\n          );\n        }\n      }\n      return blockShadow;\n    }\n    return null;\n  }\n\n  /**\n   * Saves the given shadow block to both the shadowDom_ and shadowState_\n   * properties, in their respective serialized forms.\n   *\n   * @param shadow The shadow to serialize, or null.\n   */\n  private serializeShadow(shadow: Block | null) {\n    if (!shadow) {\n      return;\n    }\n    this.shadowDom = Xml.blockToDom(shadow) as Element;\n    this.shadowState = blocks.save(shadow);\n  }\n\n  /**\n   * Returns the connection (starting at the startBlock) which will accept\n   * the given connection. This includes compatible connection types and\n   * connection checks.\n   *\n   * @param startBlock The block on which to start the search.\n   * @param orphanConnection The connection that is looking for a home.\n   * @returns The suitable connection point on the chain of blocks, or null.\n   */\n  static getConnectionForOrphanedConnection(\n    startBlock: Block,\n    orphanConnection: Connection,\n  ): Connection | null {\n    if (orphanConnection.type === ConnectionType.OUTPUT_VALUE) {\n      return getConnectionForOrphanedOutput(\n        startBlock,\n        orphanConnection.getSourceBlock(),\n      );\n    }\n    // Otherwise we're dealing with a stack.\n    const connection = startBlock.lastConnectionInStack(true);\n    const checker = orphanConnection.getConnectionChecker();\n    if (connection && checker.canConnect(orphanConnection, connection, false)) {\n      return connection;\n    }\n    return null;\n  }\n}\n\n/**\n * Update two connections to target each other.\n *\n * @param first The first connection to update.\n * @param second The second connection to update.\n */\nfunction connectReciprocally(first: Connection, second: Connection) {\n  if (!first || !second) {\n    throw Error('Cannot connect null connections.');\n  }\n  first.targetConnection = second;\n  second.targetConnection = first;\n}\n/**\n * Returns the single connection on the block that will accept the orphaned\n * block, if one can be found. If the block has multiple compatible connections\n * (even if they are filled) this returns null. If the block has no compatible\n * connections, this returns null.\n *\n * @param block The superior block.\n * @param orphanBlock The inferior block.\n * @returns The suitable connection point on 'block', or null.\n */\nfunction getSingleConnection(\n  block: Block,\n  orphanBlock: Block,\n): Connection | null {\n  let foundConnection = null;\n  const output = orphanBlock.outputConnection;\n  const typeChecker = output?.getConnectionChecker();\n\n  for (let i = 0, input; (input = block.inputList[i]); i++) {\n    const connection = input.connection;\n    if (connection && typeChecker?.canConnect(output, connection, false)) {\n      if (foundConnection) {\n        return null; // More than one connection.\n      }\n      foundConnection = connection;\n    }\n  }\n  return foundConnection;\n}\n\n/**\n * Walks down a row a blocks, at each stage checking if there are any\n * connections that will accept the orphaned block.  If at any point there\n * are zero or multiple eligible connections, returns null.  Otherwise\n * returns the only input on the last block in the chain.\n * Terminates early for shadow blocks.\n *\n * @param startBlock The block on which to start the search.\n * @param orphanBlock The block that is looking for a home.\n * @returns The suitable connection point on the chain of blocks, or null.\n */\nfunction getConnectionForOrphanedOutput(\n  startBlock: Block,\n  orphanBlock: Block,\n): Connection | null {\n  let newBlock: Block | null = startBlock;\n  let connection;\n  while ((connection = getSingleConnection(newBlock, orphanBlock))) {\n    newBlock = connection.targetBlock();\n    if (!newBlock || newBlock.isShadow()) {\n      return connection;\n    }\n  }\n  return null;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IconType} from '../icons/icon_types.js';\nimport type {Coordinate} from '../utils/coordinate.js';\nimport type {Size} from '../utils/size.js';\n\nexport interface IIcon {\n  /**\n   * @returns the IconType representing the type of the icon. This value should\n   *     also be used to register the icon via `Blockly.icons.registry.register`.\n   */\n  getType(): IconType<IIcon>;\n\n  /**\n   * Creates the SVG elements for the icon that will live on the block.\n   *\n   * @param pointerdownListener An event listener that must be attached to the\n   *     root SVG element by the implementation of `initView`. Used by Blockly's\n   *     gesture system to properly handle clicks and drags.\n   */\n  initView(pointerdownListener: (e: PointerEvent) => void): void;\n\n  /**\n   * Disposes of any elements of the icon.\n   *\n   * @remarks\n   *\n   * In particular, if this icon is currently showing a bubble, this should be\n   * used to hide it.\n   */\n  dispose(): void;\n\n  /**\n   * @returns the \"weight\" of the icon, which determines the static order which\n   *     icons should be rendered in. More positive numbers are rendered farther\n   *     toward the end of the block.\n   */\n  getWeight(): number;\n\n  /** @returns The dimensions of the icon for use in rendering. */\n  getSize(): Size;\n\n  /** Updates the icon's color when the block's color changes.. */\n  applyColour(): void;\n\n  /** Hides the icon when it is part of an insertion marker. */\n  hideForInsertionMarker(): void;\n\n  /** Updates the icon's editability when the block's editability changes. */\n  updateEditable(): void;\n\n  /**\n   * Updates the icon's collapsed-ness/view when the block's collapsed-ness\n   * changes.\n   */\n  updateCollapsed(): void;\n\n  /**\n   * @returns Whether this icon is shown when the block is collapsed. Used\n   *     to allow renderers to account for padding.\n   */\n  isShownWhenCollapsed(): boolean;\n\n  /**\n   * Notifies the icon where it is relative to its block's top-start, in\n   * workspace units.\n   */\n  setOffsetInBlock(offset: Coordinate): void;\n\n  /**\n   * Notifies the icon that it has changed locations.\n   *\n   * @param blockOrigin The location of this icon's block's top-start corner\n   *     in workspace coordinates.\n   */\n  onLocationChange(blockOrigin: Coordinate): void;\n\n  /**\n   * Notifies the icon that it has been clicked.\n   */\n  onClick(): void;\n\n  /**\n   * Check whether the icon should be clickable while the block is in a flyout.\n   * If this function is not defined, the icon will be clickable in all flyouts.\n   *\n   * @param autoClosingFlyout true if the containing flyout is an auto-closing one.\n   * @returns Whether the icon should be clickable while the block is in a flyout.\n   */\n  isClickableInFlyout?(autoClosingFlyout: boolean): boolean;\n}\n\n/** Type guard that checks whether the given object is an IIcon. */\nexport function isIcon(obj: any): obj is IIcon {\n  return (\n    obj.getType !== undefined &&\n    obj.initView !== undefined &&\n    obj.dispose !== undefined &&\n    obj.getWeight !== undefined &&\n    obj.getSize !== undefined &&\n    obj.applyColour !== undefined &&\n    obj.hideForInsertionMarker !== undefined &&\n    obj.updateEditable !== undefined &&\n    obj.updateCollapsed !== undefined &&\n    obj.isShownWhenCollapsed !== undefined &&\n    obj.setOffsetInBlock !== undefined &&\n    obj.onLocationChange !== undefined &&\n    obj.onClick !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {CommentState} from '../icons/comment_icon.js';\nimport {IconType} from '../icons/icon_types.js';\nimport {Size} from '../utils/size.js';\nimport {IHasBubble, hasBubble} from './i_has_bubble.js';\nimport {IIcon, isIcon} from './i_icon.js';\nimport {ISerializable, isSerializable} from './i_serializable.js';\n\nexport interface ICommentIcon extends IIcon, IHasBubble, ISerializable {\n  setText(text: string): void;\n\n  getText(): string;\n\n  setBubbleSize(size: Size): void;\n\n  getBubbleSize(): Size;\n\n  saveState(): CommentState;\n\n  loadState(state: CommentState): void;\n}\n\n/** Checks whether the given object is an ICommentIcon. */\nexport function isCommentIcon(obj: object): obj is ICommentIcon {\n  return (\n    isIcon(obj) &&\n    hasBubble(obj) &&\n    isSerializable(obj) &&\n    (obj as any)['setText'] !== undefined &&\n    (obj as any)['getText'] !== undefined &&\n    (obj as any)['setBubbleSize'] !== undefined &&\n    (obj as any)['getBubbleSize'] !== undefined &&\n    obj.getType() === IconType.COMMENT\n  );\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing an AST node.\n * Used to traverse the Blockly AST.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ASTNode\n\nimport {Block} from '../block.js';\nimport type {Connection} from '../connection.js';\nimport {ConnectionType} from '../connection_type.js';\nimport type {Field} from '../field.js';\nimport {FlyoutItem} from '../flyout_base.js';\nimport {FlyoutButton} from '../flyout_button.js';\nimport type {Input} from '../inputs/input.js';\nimport type {IASTNodeLocation} from '../interfaces/i_ast_node_location.js';\nimport type {IASTNodeLocationWithBlock} from '../interfaces/i_ast_node_location_with_block.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport type {Workspace} from '../workspace.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * Class for an AST node.\n * It is recommended that you use one of the createNode methods instead of\n * creating a node directly.\n */\nexport class ASTNode {\n  /**\n   * True to navigate to all fields. False to only navigate to clickable fields.\n   */\n  static NAVIGATE_ALL_FIELDS = false;\n\n  /**\n   * The default y offset to use when moving the cursor from a stack to the\n   * workspace.\n   */\n  private static readonly DEFAULT_OFFSET_Y: number = -20;\n  private readonly type: string;\n  private readonly isConnectionLocation: boolean;\n  private readonly location: IASTNodeLocation;\n\n  /** The coordinate on the workspace. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'Coordinate'.\n  private wsCoordinate: Coordinate = null as AnyDuringMigration;\n\n  /**\n   * @param type The type of the location.\n   *     Must be in ASTNode.types.\n   * @param location The position in the AST.\n   * @param opt_params Optional dictionary of options.\n   */\n  constructor(type: string, location: IASTNodeLocation, opt_params?: Params) {\n    if (!location) {\n      throw Error('Cannot create a node without a location.');\n    }\n\n    /**\n     * The type of the location.\n     * One of ASTNode.types\n     */\n    this.type = type;\n\n    /** Whether the location points to a connection. */\n    this.isConnectionLocation = ASTNode.isConnectionType(type);\n\n    /** The location of the AST node. */\n    this.location = location;\n\n    this.processParams(opt_params || null);\n  }\n\n  /**\n   * Parse the optional parameters.\n   *\n   * @param params The user specified parameters.\n   */\n  private processParams(params: Params | null) {\n    if (!params) {\n      return;\n    }\n    if (params.wsCoordinate) {\n      this.wsCoordinate = params.wsCoordinate;\n    }\n  }\n\n  /**\n   * Gets the value pointed to by this node.\n   * It is the callers responsibility to check the node type to figure out what\n   * type of object they get back from this.\n   *\n   * @returns The current field, connection, workspace, or block the cursor is\n   *     on.\n   */\n  getLocation(): IASTNodeLocation {\n    return this.location;\n  }\n\n  /**\n   * The type of the current location.\n   * One of ASTNode.types\n   *\n   * @returns The type of the location.\n   */\n  getType(): string {\n    return this.type;\n  }\n\n  /**\n   * The coordinate on the workspace.\n   *\n   * @returns The workspace coordinate or null if the location is not a\n   *     workspace.\n   */\n  getWsCoordinate(): Coordinate {\n    return this.wsCoordinate;\n  }\n\n  /**\n   * Whether the node points to a connection.\n   *\n   * @returns [description]\n   * @internal\n   */\n  isConnection(): boolean {\n    return this.isConnectionLocation;\n  }\n\n  /**\n   * Given an input find the next editable field or an input with a non null\n   * connection in the same block. The current location must be an input\n   * connection.\n   *\n   * @returns The AST node holding the next field or connection or null if there\n   *     is no editable field or input connection after the given input.\n   */\n  private findNextForInput(): ASTNode | null {\n    const location = this.location as Connection;\n    const parentInput = location.getParentInput();\n    const block = parentInput!.getSourceBlock();\n    // AnyDuringMigration because:  Argument of type 'Input | null' is not\n    // assignable to parameter of type 'Input'.\n    const curIdx = block!.inputList.indexOf(parentInput as AnyDuringMigration);\n    for (let i = curIdx + 1; i < block!.inputList.length; i++) {\n      const input = block!.inputList[i];\n      const fieldRow = input.fieldRow;\n      for (let j = 0; j < fieldRow.length; j++) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n      if (input.connection) {\n        return ASTNode.createInputNode(input);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given a field find the next editable field or an input with a non null\n   * connection in the same block. The current location must be a field.\n   *\n   * @returns The AST node pointing to the next field or connection or null if\n   *     there is no editable field or input connection after the given input.\n   */\n  private findNextForField(): ASTNode | null {\n    const location = this.location as Field;\n    const input = location.getParentInput();\n    const block = location.getSourceBlock();\n    if (!block) {\n      throw new Error(\n        'The current AST location is not associated with a block',\n      );\n    }\n    const curIdx = block.inputList.indexOf(input);\n    let fieldIdx = input.fieldRow.indexOf(location) + 1;\n    for (let i = curIdx; i < block.inputList.length; i++) {\n      const newInput = block.inputList[i];\n      const fieldRow = newInput.fieldRow;\n      while (fieldIdx < fieldRow.length) {\n        if (fieldRow[fieldIdx].isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(fieldRow[fieldIdx]);\n        }\n        fieldIdx++;\n      }\n      fieldIdx = 0;\n      if (newInput.connection) {\n        return ASTNode.createInputNode(newInput);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given an input find the previous editable field or an input with a non null\n   * connection in the same block. The current location must be an input\n   * connection.\n   *\n   * @returns The AST node holding the previous field or connection.\n   */\n  private findPrevForInput(): ASTNode | null {\n    const location = this.location as Connection;\n    const parentInput = location.getParentInput();\n    const block = parentInput!.getSourceBlock();\n    // AnyDuringMigration because:  Argument of type 'Input | null' is not\n    // assignable to parameter of type 'Input'.\n    const curIdx = block!.inputList.indexOf(parentInput as AnyDuringMigration);\n    for (let i = curIdx; i >= 0; i--) {\n      const input = block!.inputList[i];\n      if (input.connection && input !== parentInput) {\n        return ASTNode.createInputNode(input);\n      }\n      const fieldRow = input.fieldRow;\n      for (let j = fieldRow.length - 1; j >= 0; j--) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given a field find the previous editable field or an input with a non null\n   * connection in the same block. The current location must be a field.\n   *\n   * @returns The AST node holding the previous input or field.\n   */\n  private findPrevForField(): ASTNode | null {\n    const location = this.location as Field;\n    const parentInput = location.getParentInput();\n    const block = location.getSourceBlock();\n    if (!block) {\n      throw new Error(\n        'The current AST location is not associated with a block',\n      );\n    }\n    const curIdx = block.inputList.indexOf(parentInput);\n    let fieldIdx = parentInput.fieldRow.indexOf(location) - 1;\n    for (let i = curIdx; i >= 0; i--) {\n      const input = block.inputList[i];\n      if (input.connection && input !== parentInput) {\n        return ASTNode.createInputNode(input);\n      }\n      const fieldRow = input.fieldRow;\n      while (fieldIdx > -1) {\n        if (fieldRow[fieldIdx].isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(fieldRow[fieldIdx]);\n        }\n        fieldIdx--;\n      }\n      // Reset the fieldIdx to the length of the field row of the previous\n      // input.\n      if (i - 1 >= 0) {\n        fieldIdx = block.inputList[i - 1].fieldRow.length - 1;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Navigate between stacks of blocks on the workspace.\n   *\n   * @param forward True to go forward. False to go backwards.\n   * @returns The first block of the next stack or null if there are no blocks\n   *     on the workspace.\n   */\n  private navigateBetweenStacks(forward: boolean): ASTNode | null {\n    let curLocation = this.getLocation();\n    // TODO(#6097): Use instanceof checks to exit early for values of\n    // curLocation that don't make sense.\n    if ((curLocation as IASTNodeLocationWithBlock).getSourceBlock) {\n      const block = (curLocation as IASTNodeLocationWithBlock).getSourceBlock();\n      if (block) {\n        curLocation = block;\n      }\n    }\n    // TODO(#6097): Use instanceof checks to exit early for values of\n    // curLocation that don't make sense.\n    const curLocationAsBlock = curLocation as Block;\n    if (!curLocationAsBlock || curLocationAsBlock.isDeadOrDying()) {\n      return null;\n    }\n    if (curLocationAsBlock.workspace.isFlyout) {\n      return this.navigateFlyoutContents(forward);\n    }\n    const curRoot = curLocationAsBlock.getRootBlock();\n    const topBlocks = curRoot.workspace.getTopBlocks(true);\n    for (let i = 0; i < topBlocks.length; i++) {\n      const topBlock = topBlocks[i];\n      if (curRoot.id === topBlock.id) {\n        const offset = forward ? 1 : -1;\n        const resultIndex = i + offset;\n        if (resultIndex === -1 || resultIndex === topBlocks.length) {\n          return null;\n        }\n        return ASTNode.createStackNode(topBlocks[resultIndex]);\n      }\n    }\n    throw Error(\n      \"Couldn't find \" + (forward ? 'next' : 'previous') + ' stack?!',\n    );\n  }\n\n  /**\n   * Navigate between buttons and stacks of blocks on the flyout workspace.\n   *\n   * @param forward True to go forward. False to go backwards.\n   * @returns The next button, or next stack's first block, or null\n   */\n  private navigateFlyoutContents(forward: boolean): ASTNode | null {\n    const nodeType = this.getType();\n    let location;\n    let targetWorkspace;\n\n    switch (nodeType) {\n      case ASTNode.types.STACK: {\n        location = this.getLocation() as Block;\n        const workspace = location.workspace as WorkspaceSvg;\n        targetWorkspace = workspace.targetWorkspace as WorkspaceSvg;\n        break;\n      }\n      case ASTNode.types.BUTTON: {\n        location = this.getLocation() as FlyoutButton;\n        targetWorkspace = location.getTargetWorkspace() as WorkspaceSvg;\n        break;\n      }\n      default:\n        return null;\n    }\n\n    const flyout = targetWorkspace.getFlyout();\n    if (!flyout) return null;\n\n    const nextItem = this.findNextLocationInFlyout(\n      flyout.getContents(),\n      location,\n      forward,\n    );\n    if (!nextItem) return null;\n\n    if (nextItem.type === 'button' && nextItem.button) {\n      return ASTNode.createButtonNode(nextItem.button);\n    } else if (nextItem.type === 'block' && nextItem.block) {\n      return ASTNode.createStackNode(nextItem.block);\n    }\n\n    return null;\n  }\n\n  /**\n   * Finds the next (or previous if navigating backward) item in the flyout that should be navigated to.\n   *\n   * @param flyoutContents Contents of the current flyout.\n   * @param currentLocation Current ASTNode location.\n   * @param forward True if we're navigating forward, else false.\n   * @returns The next (or previous) FlyoutItem, or null if there is none.\n   */\n  private findNextLocationInFlyout(\n    flyoutContents: FlyoutItem[],\n    currentLocation: IASTNodeLocation,\n    forward: boolean,\n  ): FlyoutItem | null {\n    const currentIndex = flyoutContents.findIndex((item: FlyoutItem) => {\n      if (currentLocation instanceof Block && item.block === currentLocation) {\n        return true;\n      }\n      if (\n        currentLocation instanceof FlyoutButton &&\n        item.button === currentLocation\n      ) {\n        return true;\n      }\n      return false;\n    });\n\n    if (currentIndex < 0) return null;\n\n    const resultIndex = forward ? currentIndex + 1 : currentIndex - 1;\n    if (resultIndex === -1 || resultIndex === flyoutContents.length) {\n      return null;\n    }\n\n    return flyoutContents[resultIndex];\n  }\n\n  /**\n   * Finds the top most AST node for a given block.\n   * This is either the previous connection, output connection or block\n   * depending on what kind of connections the block has.\n   *\n   * @param block The block that we want to find the top connection on.\n   * @returns The AST node containing the top connection.\n   */\n  private findTopASTNodeForBlock(block: Block): ASTNode | null {\n    const topConnection = getParentConnection(block);\n    if (topConnection) {\n      return ASTNode.createConnectionNode(topConnection);\n    } else {\n      return ASTNode.createBlockNode(block);\n    }\n  }\n\n  /**\n   * Get the AST node pointing to the input that the block is nested under or if\n   * the block is not nested then get the stack AST node.\n   *\n   * @param block The source block of the current location.\n   * @returns The AST node pointing to the input connection or the top block of\n   *     the stack this block is in.\n   */\n  private getOutAstNodeForBlock(block: Block): ASTNode | null {\n    if (!block) {\n      return null;\n    }\n    // If the block doesn't have a previous connection then it is the top of the\n    // substack.\n    const topBlock = block.getTopStackBlock();\n    const topConnection = getParentConnection(topBlock);\n    // If the top connection has a parentInput, create an AST node pointing to\n    // that input.\n    if (\n      topConnection &&\n      topConnection.targetConnection &&\n      topConnection.targetConnection.getParentInput()\n    ) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n        topConnection.targetConnection.getParentInput() as AnyDuringMigration,\n      );\n    } else {\n      // Go to stack level if you are not underneath an input.\n      return ASTNode.createStackNode(topBlock);\n    }\n  }\n\n  /**\n   * Find the first editable field or input with a connection on a given block.\n   *\n   * @param block The source block of the current location.\n   * @returns An AST node pointing to the first field or input.\n   * Null if there are no editable fields or inputs with connections on the\n   * block.\n   */\n  private findFirstFieldOrInput(block: Block): ASTNode | null {\n    const inputs = block.inputList;\n    for (let i = 0; i < inputs.length; i++) {\n      const input = inputs[i];\n      const fieldRow = input.fieldRow;\n      for (let j = 0; j < fieldRow.length; j++) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n      if (input.connection) {\n        return ASTNode.createInputNode(input);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Finds the source block of the location of this node.\n   *\n   * @returns The source block of the location, or null if the node is of type\n   *     workspace or button.\n   */\n  getSourceBlock(): Block | null {\n    if (this.getType() === ASTNode.types.BLOCK) {\n      return this.getLocation() as Block;\n    } else if (this.getType() === ASTNode.types.STACK) {\n      return this.getLocation() as Block;\n    } else if (this.getType() === ASTNode.types.WORKSPACE) {\n      return null;\n    } else if (this.getType() === ASTNode.types.BUTTON) {\n      return null;\n    } else {\n      return (this.getLocation() as IASTNodeLocationWithBlock).getSourceBlock();\n    }\n  }\n\n  /**\n   * Find the element to the right of the current element in the AST.\n   *\n   * @returns An AST node that wraps the next field, connection, block, or\n   *     workspace. Or null if there is no node to the right.\n   */\n  next(): ASTNode | null {\n    switch (this.type) {\n      case ASTNode.types.STACK:\n        return this.navigateBetweenStacks(true);\n\n      case ASTNode.types.OUTPUT: {\n        const connection = this.location as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.FIELD:\n        return this.findNextForField();\n\n      case ASTNode.types.INPUT:\n        return this.findNextForInput();\n\n      case ASTNode.types.BLOCK: {\n        const block = this.location as Block;\n        const nextConnection = block.nextConnection;\n        if (!nextConnection) return null;\n        return ASTNode.createConnectionNode(nextConnection);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location as Connection;\n        const targetConnection = connection.targetConnection;\n        return ASTNode.createConnectionNode(targetConnection!);\n      }\n      case ASTNode.types.BUTTON:\n        return this.navigateFlyoutContents(true);\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the element one level below and all the way to the left of the current\n   * location.\n   *\n   * @returns An AST node that wraps the next field, connection, workspace, or\n   *     block. Or null if there is nothing below this node.\n   */\n  in(): ASTNode | null {\n    switch (this.type) {\n      case ASTNode.types.WORKSPACE: {\n        const workspace = this.location as Workspace;\n        const topBlocks = workspace.getTopBlocks(true);\n        if (topBlocks.length > 0) {\n          return ASTNode.createStackNode(topBlocks[0]);\n        }\n        break;\n      }\n      case ASTNode.types.STACK: {\n        const block = this.location as Block;\n        return this.findTopASTNodeForBlock(block);\n      }\n      case ASTNode.types.BLOCK: {\n        const block = this.location as Block;\n        return this.findFirstFieldOrInput(block);\n      }\n      case ASTNode.types.INPUT: {\n        const connection = this.location as Connection;\n        const targetConnection = connection.targetConnection;\n        return ASTNode.createConnectionNode(targetConnection!);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the element to the left of the current element in the AST.\n   *\n   * @returns An AST node that wraps the previous field, connection, workspace\n   *     or block. Or null if no node exists to the left. null.\n   */\n  prev(): ASTNode | null {\n    switch (this.type) {\n      case ASTNode.types.STACK:\n        return this.navigateBetweenStacks(false);\n\n      case ASTNode.types.OUTPUT:\n        return null;\n\n      case ASTNode.types.FIELD:\n        return this.findPrevForField();\n\n      case ASTNode.types.INPUT:\n        return this.findPrevForInput();\n\n      case ASTNode.types.BLOCK: {\n        const block = this.location as Block;\n        const topConnection = getParentConnection(block);\n        if (!topConnection) return null;\n        return ASTNode.createConnectionNode(topConnection);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location as Connection;\n        const targetConnection = connection.targetConnection;\n        if (targetConnection && !targetConnection.getParentInput()) {\n          return ASTNode.createConnectionNode(targetConnection);\n        }\n        break;\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.BUTTON:\n        return this.navigateFlyoutContents(false);\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the next element that is one position above and all the way to the\n   * left of the current location.\n   *\n   * @returns An AST node that wraps the next field, connection, workspace or\n   *     block. Or null if we are at the workspace level.\n   */\n  out(): ASTNode | null {\n    switch (this.type) {\n      case ASTNode.types.STACK: {\n        const block = this.location as Block;\n        const blockPos = block.getRelativeToSurfaceXY();\n        // TODO: Make sure this is in the bounds of the workspace.\n        const wsCoordinate = new Coordinate(\n          blockPos.x,\n          blockPos.y + ASTNode.DEFAULT_OFFSET_Y,\n        );\n        return ASTNode.createWorkspaceNode(block.workspace, wsCoordinate);\n      }\n      case ASTNode.types.OUTPUT: {\n        const connection = this.location as Connection;\n        const target = connection.targetConnection;\n        if (target) {\n          return ASTNode.createConnectionNode(target);\n        }\n        return ASTNode.createStackNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.FIELD: {\n        const field = this.location as Field;\n        const block = field.getSourceBlock();\n        if (!block) {\n          throw new Error(\n            'The current AST location is not associated with a block',\n          );\n        }\n        return ASTNode.createBlockNode(block);\n      }\n      case ASTNode.types.INPUT: {\n        const connection = this.location as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.BLOCK: {\n        const block = this.location as Block;\n        return this.getOutAstNodeForBlock(block);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location as Connection;\n        return this.getOutAstNodeForBlock(connection.getSourceBlock());\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location as Connection;\n        return this.getOutAstNodeForBlock(connection.getSourceBlock());\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Whether an AST node of the given type points to a connection.\n   *\n   * @param type The type to check.  One of ASTNode.types.\n   * @returns True if a node of the given type points to a connection.\n   */\n  private static isConnectionType(type: string): boolean {\n    switch (type) {\n      case ASTNode.types.PREVIOUS:\n      case ASTNode.types.NEXT:\n      case ASTNode.types.INPUT:\n      case ASTNode.types.OUTPUT:\n        return true;\n    }\n    return false;\n  }\n\n  /**\n   * Create an AST node pointing to a field.\n   *\n   * @param field The location of the AST node.\n   * @returns An AST node pointing to a field.\n   */\n  static createFieldNode(field: Field): ASTNode | null {\n    if (!field) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.FIELD, field);\n  }\n\n  /**\n   * Creates an AST node pointing to a connection. If the connection has a\n   * parent input then create an AST node of type input that will hold the\n   * connection.\n   *\n   * @param connection This is the connection the node will point to.\n   * @returns An AST node pointing to a connection.\n   */\n  static createConnectionNode(connection: Connection): ASTNode | null {\n    if (!connection) {\n      return null;\n    }\n    const type = connection.type;\n    if (type === ConnectionType.INPUT_VALUE) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n        connection.getParentInput() as AnyDuringMigration,\n      );\n    } else if (\n      type === ConnectionType.NEXT_STATEMENT &&\n      connection.getParentInput()\n    ) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n        connection.getParentInput() as AnyDuringMigration,\n      );\n    } else if (type === ConnectionType.NEXT_STATEMENT) {\n      return new ASTNode(ASTNode.types.NEXT, connection);\n    } else if (type === ConnectionType.OUTPUT_VALUE) {\n      return new ASTNode(ASTNode.types.OUTPUT, connection);\n    } else if (type === ConnectionType.PREVIOUS_STATEMENT) {\n      return new ASTNode(ASTNode.types.PREVIOUS, connection);\n    }\n    return null;\n  }\n\n  /**\n   * Creates an AST node pointing to an input. Stores the input connection as\n   * the location.\n   *\n   * @param input The input used to create an AST node.\n   * @returns An AST node pointing to a input.\n   */\n  static createInputNode(input: Input): ASTNode | null {\n    if (!input || !input.connection) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.INPUT, input.connection);\n  }\n\n  /**\n   * Creates an AST node pointing to a block.\n   *\n   * @param block The block used to create an AST node.\n   * @returns An AST node pointing to a block.\n   */\n  static createBlockNode(block: Block): ASTNode | null {\n    if (!block) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.BLOCK, block);\n  }\n\n  /**\n   * Create an AST node of type stack. A stack, represented by its top block, is\n   *     the set of all blocks connected to a top block, including the top\n   * block.\n   *\n   * @param topBlock A top block has no parent and can be found in the list\n   *     returned by workspace.getTopBlocks().\n   * @returns An AST node of type stack that points to the top block on the\n   *     stack.\n   */\n  static createStackNode(topBlock: Block): ASTNode | null {\n    if (!topBlock) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.STACK, topBlock);\n  }\n\n  /**\n   * Create an AST node of type button. A button in this case refers\n   * specifically to a button in a flyout.\n   *\n   * @param button A top block has no parent and can be found in the list\n   *     returned by workspace.getTopBlocks().\n   * @returns An AST node of type stack that points to the top block on the\n   *     stack.\n   */\n  static createButtonNode(button: FlyoutButton): ASTNode | null {\n    if (!button) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.BUTTON, button);\n  }\n\n  /**\n   * Creates an AST node pointing to a workspace.\n   *\n   * @param workspace The workspace that we are on.\n   * @param wsCoordinate The position on the workspace for this node.\n   * @returns An AST node pointing to a workspace and a position on the\n   *     workspace.\n   */\n  static createWorkspaceNode(\n    workspace: Workspace | null,\n    wsCoordinate: Coordinate | null,\n  ): ASTNode | null {\n    if (!wsCoordinate || !workspace) {\n      return null;\n    }\n    const params = {wsCoordinate};\n    return new ASTNode(ASTNode.types.WORKSPACE, workspace, params);\n  }\n\n  /**\n   * Creates an AST node for the top position on a block.\n   * This is either an output connection, previous connection, or block.\n   *\n   * @param block The block to find the top most AST node on.\n   * @returns The AST node holding the top most position on the block.\n   */\n  static createTopNode(block: Block): ASTNode | null {\n    let astNode;\n    const topConnection = getParentConnection(block);\n    if (topConnection) {\n      astNode = ASTNode.createConnectionNode(topConnection);\n    } else {\n      astNode = ASTNode.createBlockNode(block);\n    }\n    return astNode;\n  }\n}\n\nexport namespace ASTNode {\n  export interface Params {\n    wsCoordinate: Coordinate;\n  }\n\n  export enum types {\n    FIELD = 'field',\n    BLOCK = 'block',\n    INPUT = 'input',\n    OUTPUT = 'output',\n    NEXT = 'next',\n    PREVIOUS = 'previous',\n    STACK = 'stack',\n    WORKSPACE = 'workspace',\n    BUTTON = 'button',\n  }\n}\n\nexport type Params = ASTNode.Params;\n// No need to export ASTNode.types from the module at this time because (1) it\n// wasn't automatically converted by the automatic migration script, (2) the\n// name doesn't follow the styleguide.\n\n/**\n * Gets the parent connection on a block.\n * This is either an output connection, previous connection or undefined.\n * If both connections exist return the one that is actually connected\n * to another block.\n *\n * @param block The block to find the parent connection on.\n * @returns The connection connecting to the parent of the block.\n */\nfunction getParentConnection(block: Block): Connection | null {\n  let topConnection = block.outputConnection;\n  if (\n    !topConnection ||\n    (block.previousConnection && block.previousConnection.isConnected())\n  ) {\n    topConnection = block.previousConnection;\n  }\n  return topConnection;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering\n\nimport * as registry from '../../registry.js';\nimport type {Theme} from '../../theme.js';\nimport {Measurable} from '../measurables/base.js';\nimport {BottomRow} from '../measurables/bottom_row.js';\nimport {Connection} from '../measurables/connection.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport {Field} from '../measurables/field.js';\nimport {Hat} from '../measurables/hat.js';\nimport {Icon} from '../measurables/icon.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InlineInput} from '../measurables/inline_input.js';\nimport {InputConnection} from '../measurables/input_connection.js';\nimport {InputRow} from '../measurables/input_row.js';\nimport {JaggedEdge} from '../measurables/jagged_edge.js';\nimport {NextConnection} from '../measurables/next_connection.js';\nimport {OutputConnection} from '../measurables/output_connection.js';\nimport {PreviousConnection} from '../measurables/previous_connection.js';\nimport {RoundCorner} from '../measurables/round_corner.js';\nimport {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport {SquareCorner} from '../measurables/square_corner.js';\nimport {StatementInput} from '../measurables/statement_input.js';\nimport {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\nimport {Drawer} from './drawer.js';\nimport type {IPathObject} from './i_path_object.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\n/**\n * Registers a new renderer.\n *\n * @param name The name of the renderer.\n * @param rendererClass The new renderer class to register.\n * @throws {Error} if a renderer with the same name has already been registered.\n */\nexport function register(\n  name: string,\n  rendererClass: new (name: string) => Renderer,\n) {\n  registry.register(registry.Type.RENDERER, name, rendererClass);\n}\n\n/**\n * Unregisters the renderer registered with the given name.\n *\n * @param name The name of the renderer.\n */\nexport function unregister(name: string) {\n  registry.unregister(registry.Type.RENDERER, name);\n}\n\n/**\n * Initialize anything needed for rendering (constants, etc).\n *\n * @param name Name of the renderer to initialize.\n * @param theme The workspace theme object.\n * @param opt_rendererOverrides Rendering constant overrides.\n * @returns The new instance of a renderer.\n *     Already initialized.\n * @internal\n */\nexport function init(\n  name: string,\n  theme: Theme,\n  opt_rendererOverrides?: {[rendererConstant: string]: any},\n): Renderer {\n  const rendererClass = registry.getClass(registry.Type.RENDERER, name);\n  const renderer = new rendererClass!(name);\n  renderer.init(theme, opt_rendererOverrides);\n  return renderer;\n}\nexport {\n  BottomRow,\n  Connection,\n  Drawer,\n  ExternalValueInput,\n  Field,\n  Hat,\n  Icon,\n  InlineInput,\n  InputConnection,\n  InputRow,\n  InRowSpacer,\n  IPathObject,\n  JaggedEdge,\n  MarkerSvg,\n  Measurable,\n  NextConnection,\n  OutputConnection,\n  PathObject,\n  PreviousConnection,\n  Renderer,\n  RenderInfo,\n  RoundCorner,\n  Row,\n  SpacerRow,\n  SquareCorner,\n  StatementInput,\n  TopRow,\n  Types,\n};\n\nexport {\n  BaseShape,\n  ConstantProvider,\n  DynamicShape,\n  InsideCorners,\n  JaggedTeeth,\n  Notch,\n  OutsideCorners,\n  PuzzleTab,\n  StartHat,\n} from './constants.js';\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.VariablesDynamic\n\nimport {Blocks} from './blocks.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport {Msg} from './msg.js';\nimport * as xml from './utils/xml.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n * See also Blockly.Variables.CATEGORY_NAME and\n * Blockly.Procedures.CATEGORY_NAME.\n */\nexport const CATEGORY_NAME = 'VARIABLE_DYNAMIC';\n\n/**\n * Click handler for a button that creates String variables.\n *\n * @param button\n */\nfunction stringButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n    button.getTargetWorkspace(),\n    undefined,\n    'String',\n  );\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_String = stringButtonClickHandler;\n\n/**\n * Click handler for a button that creates Number variables.\n *\n * @param button\n */\nfunction numberButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n    button.getTargetWorkspace(),\n    undefined,\n    'Number',\n  );\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_Number = numberButtonClickHandler;\n\n/**\n * Click handler for a button that creates Colour variables.\n *\n * @param button\n */\nfunction colourButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n    button.getTargetWorkspace(),\n    undefined,\n    'Colour',\n  );\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_Colour = colourButtonClickHandler;\n\n/**\n * Construct the elements (blocks and button) required by the flyout for the\n * variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML elements.\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  let xmlList = new Array<Element>();\n  let button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_STRING_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_STRING');\n  xmlList.push(button);\n  button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_NUMBER_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_NUMBER');\n  xmlList.push(button);\n  button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_COLOUR_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_COLOUR');\n  xmlList.push(button);\n\n  workspace.registerButtonCallback(\n    'CREATE_VARIABLE_STRING',\n    stringButtonClickHandler,\n  );\n  workspace.registerButtonCallback(\n    'CREATE_VARIABLE_NUMBER',\n    numberButtonClickHandler,\n  );\n  workspace.registerButtonCallback(\n    'CREATE_VARIABLE_COLOUR',\n    colourButtonClickHandler,\n  );\n\n  const blockList = flyoutCategoryBlocks(workspace);\n  xmlList = xmlList.concat(blockList);\n  return xmlList;\n}\n\n/**\n * Construct the blocks required by the flyout for the variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML block elements.\n */\nexport function flyoutCategoryBlocks(workspace: Workspace): Element[] {\n  const variableModelList = workspace.getAllVariables();\n\n  const xmlList = [];\n  if (variableModelList.length > 0) {\n    if (Blocks['variables_set_dynamic']) {\n      const firstVariable = variableModelList[variableModelList.length - 1];\n      const block = xml.createElement('block');\n      block.setAttribute('type', 'variables_set_dynamic');\n      block.setAttribute('gap', '24');\n      block.appendChild(Variables.generateVariableFieldDom(firstVariable));\n      xmlList.push(block);\n    }\n    if (Blocks['variables_get_dynamic']) {\n      variableModelList.sort(VariableModel.compareByName);\n      for (let i = 0, variable; (variable = variableModelList[i]); i++) {\n        const block = xml.createElement('block');\n        block.setAttribute('type', 'variables_get_dynamic');\n        block.setAttribute('gap', '8');\n        block.appendChild(Variables.generateVariableFieldDom(variable));\n        xmlList.push(block);\n      }\n    }\n  }\n  return xmlList;\n}\n", "/**\n * @license\n * Copyright 2014 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a workspace rendered as SVG.\n *\n * @class\n */\n// Former goog.module ID: Blockly.WorkspaceSvg\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_theme_change.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_viewport.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport {RenderedWorkspaceComment} from './comments/rendered_workspace_comment.js';\nimport {WorkspaceComment} from './comments/workspace_comment.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {ConnectionDB} from './connection_db.js';\nimport * as ContextMenu from './contextmenu.js';\nimport {\n  ContextMenuOption,\n  ContextMenuRegistry,\n} from './contextmenu_registry.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport {Gesture} from './gesture.js';\nimport {Grid} from './grid.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Marker} from './keyboard_nav/marker.js';\nimport {LayerManager} from './layer_manager.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Options} from './options.js';\nimport * as Procedures from './procedures.js';\nimport * as registry from './registry.js';\nimport * as renderManagement from './render_management.js';\nimport * as blockRendering from './renderers/common/block_rendering.js';\nimport type {Renderer} from './renderers/common/renderer.js';\nimport type {ScrollbarPair} from './scrollbar_pair.js';\nimport type {Theme} from './theme.js';\nimport {Classic} from './theme/classic.js';\nimport {ThemeManager} from './theme_manager.js';\nimport * as Tooltip from './tooltip.js';\nimport type {Trashcan} from './trashcan.js';\nimport * as arrayUtils from './utils/array.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as drag from './utils/drag.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as userAgent from './utils/useragent.js';\nimport type {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as VariablesDynamic from './variables_dynamic.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {Workspace} from './workspace.js';\nimport {WorkspaceAudio} from './workspace_audio.js';\nimport {ZoomControls} from './zoom_controls.js';\n\n/** Margin around the top/bottom/left/right after a zoomToFit call. */\nconst ZOOM_TO_FIT_MARGIN = 20;\n\n/**\n * Class for a workspace.  This is an onscreen area with optional trashcan,\n * scrollbars, bubbles, and dragging.\n */\nexport class WorkspaceSvg extends Workspace implements IASTNodeLocationSvg {\n  /**\n   * A wrapper function called when a resize event occurs.\n   * You can pass the result to `eventHandling.unbind`.\n   */\n  private resizeHandlerWrapper: browserEvents.Data | null = null;\n\n  /**\n   * The render status of an SVG workspace.\n   * Returns `false` for headless workspaces and true for instances of\n   * `WorkspaceSvg`.\n   */\n  override rendered = true;\n\n  /**\n   * Whether the workspace is visible.  False if the workspace has been hidden\n   * by calling `setVisible(false)`.\n   */\n  private visible = true;\n\n  /**\n   * Whether this workspace has resizes enabled.\n   * Disable during batch operations for a performance improvement.\n   */\n  private resizesEnabled = true;\n\n  /**\n   * Current horizontal scrolling offset in pixel units, relative to the\n   * workspace origin.\n   *\n   * It is useful to think about a view, and a canvas moving beneath that\n   * view. As the canvas moves right, this value becomes more positive, and\n   * the view is now \"seeing\" the left side of the canvas. As the canvas moves\n   * left, this value becomes more negative, and the view is now \"seeing\" the\n   * right side of the canvas.\n   *\n   * The confusing thing about this value is that it does not, and must not\n   * include the absoluteLeft offset. This is because it is used to calculate\n   * the viewLeft value.\n   *\n   * The viewLeft is relative to the workspace origin (although in pixel\n   * units). The workspace origin is the top-left corner of the workspace (at\n   * least when it is enabled). It is shifted from the top-left of the\n   * blocklyDiv so as not to be beneath the toolbox.\n   *\n   * When the workspace is enabled the viewLeft and workspace origin are at\n   * the same X location. As the canvas slides towards the right beneath the\n   * view this value (scrollX) becomes more positive, and the viewLeft becomes\n   * more negative relative to the workspace origin (imagine the workspace\n   * origin as a dot on the canvas sliding to the right as the canvas moves).\n   *\n   * So if the scrollX were to include the absoluteLeft this would in a way\n   * \"unshift\" the workspace origin. This means that the viewLeft would be\n   * representing the left edge of the blocklyDiv, rather than the left edge\n   * of the workspace.\n   */\n  scrollX = 0;\n\n  /**\n   * Current vertical scrolling offset in pixel units, relative to the\n   * workspace origin.\n   *\n   * It is useful to think about a view, and a canvas moving beneath that\n   * view. As the canvas moves down, this value becomes more positive, and the\n   * view is now \"seeing\" the upper part of the canvas. As the canvas moves\n   * up, this value becomes more negative, and the view is \"seeing\" the lower\n   * part of the canvas.\n   *\n   * This confusing thing about this value is that it does not, and must not\n   * include the absoluteTop offset. This is because it is used to calculate\n   * the viewTop value.\n   *\n   * The viewTop is relative to the workspace origin (although in pixel\n   * units). The workspace origin is the top-left corner of the workspace (at\n   * least when it is enabled). It is shifted from the top-left of the\n   * blocklyDiv so as not to be beneath the toolbox.\n   *\n   * When the workspace is enabled the viewTop and workspace origin are at the\n   * same Y location. As the canvas slides towards the bottom this value\n   * (scrollY) becomes more positive, and the viewTop becomes more negative\n   * relative to the workspace origin (image in the workspace origin as a dot\n   * on the canvas sliding downwards as the canvas moves).\n   *\n   * So if the scrollY were to include the absoluteTop this would in a way\n   * \"unshift\" the workspace origin. This means that the viewTop would be\n   * representing the top edge of the blocklyDiv, rather than the top edge of\n   * the workspace.\n   */\n  scrollY = 0;\n\n  /** Horizontal scroll value when scrolling started in pixel units. */\n  startScrollX = 0;\n\n  /** Vertical scroll value when scrolling started in pixel units. */\n  startScrollY = 0;\n\n  /** Current scale. */\n  scale = 1;\n\n  /** Cached scale value. Used to detect changes in viewport. */\n  private oldScale = 1;\n\n  /** Cached viewport top value. Used to detect changes in viewport. */\n  private oldTop = 0;\n\n  /** Cached viewport left value. Used to detect changes in viewport. */\n  private oldLeft = 0;\n\n  /** The workspace's trashcan (if any). */\n  trashcan: Trashcan | null = null;\n\n  /** This workspace's scrollbars, if they exist. */\n  scrollbar: ScrollbarPair | null = null;\n\n  /**\n   * Fixed flyout providing blocks which may be dragged into this workspace.\n   */\n  private flyout: IFlyout | null = null;\n\n  /**\n   * Category-based toolbox providing blocks which may be dragged into this\n   * workspace.\n   */\n  private toolbox: IToolbox | null = null;\n\n  /**\n   * The current gesture in progress on this workspace, if any.\n   *\n   * @internal\n   */\n  currentGesture_: Gesture | null = null;\n\n  /**\n   * The first parent div with 'injectionDiv' in the name, or null if not set.\n   * Access this with getInjectionDiv.\n   */\n  private injectionDiv: Element | null = null;\n\n  /**\n   * Last known position of the page scroll.\n   * This is used to determine whether we have recalculated screen coordinate\n   * stuff since the page scrolled.\n   */\n  private lastRecordedPageScroll: Coordinate | null = null;\n\n  /**\n   * Developers may define this function to add custom menu options to the\n   * workspace's context menu or edit the workspace-created set of menu\n   * options.\n   *\n   * @param options List of menu options to add to.\n   * @param e The right-click event that triggered the context menu.\n   */\n  configureContextMenu:\n    | ((menuOptions: ContextMenuOption[], e: Event) => void)\n    | null = null;\n\n  /**\n   * A dummy wheel event listener used as a workaround for a Safari scrolling issue.\n   * Set in createDom and used for removal in dispose to ensure proper cleanup.\n   */\n  private dummyWheelListener: (() => void) | null = null;\n\n  /**\n   * In a flyout, the target workspace where blocks should be placed after a\n   * drag. Otherwise null.\n   *\n   * @internal\n   */\n  targetWorkspace: WorkspaceSvg | null = null;\n\n  /** Inverted screen CTM, for use in mouseToSvg. */\n  private inverseScreenCTM: SVGMatrix | null = null;\n\n  /** Inverted screen CTM is dirty, recalculate it. */\n  private inverseScreenCTMDirty = true;\n  private metricsManager: IMetricsManager;\n  /** @internal */\n  getMetrics: () => Metrics;\n  /** @internal */\n  setMetrics: (p1: {x?: number; y?: number}) => void;\n  private readonly componentManager: ComponentManager;\n\n  /**\n   * List of currently highlighted blocks.  Block highlighting is often used\n   * to visually mark blocks currently being executed.\n   */\n  private readonly highlightedBlocks: BlockSvg[] = [];\n  private audioManager: WorkspaceAudio;\n  private grid: Grid | null;\n  private markerManager: MarkerManager;\n\n  /**\n   * Map from function names to callbacks, for deciding what to do when a\n   * custom toolbox category is opened.\n   */\n  private toolboxCategoryCallbacks = new Map<\n    string,\n    (p1: WorkspaceSvg) => toolbox.FlyoutDefinition\n  >();\n\n  /**\n   * Map from function names to callbacks, for deciding what to do when a\n   * button is clicked.\n   */\n  private flyoutButtonCallbacks = new Map<string, (p1: FlyoutButton) => void>();\n  protected themeManager_: ThemeManager;\n  private readonly renderer: Renderer;\n\n  /** Cached parent SVG. */\n  private cachedParentSvg: SVGElement | null = null;\n\n  /** True if keyboard accessibility mode is on, false otherwise. */\n  keyboardAccessibilityMode = false;\n\n  /** The list of top-level bounded elements on the workspace. */\n  private topBoundedElements: IBoundedElement[] = [];\n\n  /** The recorded drag targets. */\n  private dragTargetAreas: Array<{component: IDragTarget; clientRect: Rect}> =\n    [];\n  private readonly cachedParentSvgSize: Size;\n  private layerManager: LayerManager | null = null;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgGroup_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBackground_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBlockCanvas_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBubbleCanvas_!: SVGElement;\n  zoomControls_: ZoomControls | null = null;\n\n  /**\n   * @param options Dictionary of options.\n   */\n  constructor(options: Options) {\n    super(options);\n\n    const MetricsManagerClass = registry.getClassFromOptions(\n      registry.Type.METRICS_MANAGER,\n      options,\n      true,\n    );\n    /** Object in charge of calculating metrics for the workspace. */\n    this.metricsManager = new MetricsManagerClass!(this);\n\n    /** Method to get all the metrics that have to do with a workspace. */\n    this.getMetrics =\n      options.getMetrics ||\n      this.metricsManager.getMetrics.bind(this.metricsManager);\n\n    /** Translates the workspace. */\n    this.setMetrics =\n      options.setMetrics || WorkspaceSvg.setTopLevelWorkspaceMetrics;\n\n    this.componentManager = new ComponentManager();\n\n    this.connectionDBList = ConnectionDB.init(this.connectionChecker);\n\n    /**\n     * Object in charge of loading, storing, and playing audio for a workspace.\n     */\n    this.audioManager = new WorkspaceAudio(\n      options.parentWorkspace as WorkspaceSvg,\n    );\n\n    /** This workspace's grid object or null. */\n    this.grid = this.options.gridPattern\n      ? new Grid(this.options.gridPattern, options.gridOptions)\n      : null;\n\n    /** Manager in charge of markers and cursors. */\n    this.markerManager = new MarkerManager(this);\n\n    if (Variables && Variables.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n        Variables.CATEGORY_NAME,\n        Variables.flyoutCategory,\n      );\n    }\n\n    if (VariablesDynamic && VariablesDynamic.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n        VariablesDynamic.CATEGORY_NAME,\n        VariablesDynamic.flyoutCategory,\n      );\n    }\n\n    if (Procedures && Procedures.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n        Procedures.CATEGORY_NAME,\n        Procedures.flyoutCategory,\n      );\n      this.addChangeListener(Procedures.mutatorOpenListener);\n    }\n\n    /** Object in charge of storing and updating the workspace theme. */\n    this.themeManager_ = this.options.parentWorkspace\n      ? this.options.parentWorkspace.getThemeManager()\n      : new ThemeManager(this, this.options.theme || Classic);\n    this.themeManager_.subscribeWorkspace(this);\n\n    /** The block renderer used for rendering blocks on this workspace. */\n    this.renderer = blockRendering.init(\n      this.options.renderer || 'geras',\n      this.getTheme(),\n      this.options.rendererOverrides ?? undefined,\n    );\n\n    /**\n     * The cached size of the parent svg element.\n     * Used to compute svg metrics.\n     */\n    this.cachedParentSvgSize = new Size(0, 0);\n  }\n\n  /**\n   * Get the marker manager for this workspace.\n   *\n   * @returns The marker manager.\n   */\n  getMarkerManager(): MarkerManager {\n    return this.markerManager;\n  }\n\n  /**\n   * Gets the metrics manager for this workspace.\n   *\n   * @returns The metrics manager.\n   */\n  getMetricsManager(): IMetricsManager {\n    return this.metricsManager;\n  }\n\n  /**\n   * Sets the metrics manager for the workspace.\n   *\n   * @param metricsManager The metrics manager.\n   * @internal\n   */\n  setMetricsManager(metricsManager: IMetricsManager) {\n    this.metricsManager = metricsManager;\n    this.getMetrics = this.metricsManager.getMetrics.bind(this.metricsManager);\n  }\n\n  /**\n   * Gets the component manager for this workspace.\n   *\n   * @returns The component manager.\n   */\n  getComponentManager(): ComponentManager {\n    return this.componentManager;\n  }\n\n  /**\n   * Add the cursor SVG to this workspaces SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    this.markerManager.setCursorSvg(cursorSvg);\n  }\n\n  /**\n   * Add the marker SVG to this workspaces SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    this.markerManager.setMarkerSvg(markerSvg);\n  }\n\n  /**\n   * Get the marker with the given ID.\n   *\n   * @param id The ID of the marker.\n   * @returns The marker with the given ID or null if no marker with the given\n   *     ID exists.\n   * @internal\n   */\n  getMarker(id: string): Marker | null {\n    if (this.markerManager) {\n      return this.markerManager.getMarker(id);\n    }\n    return null;\n  }\n\n  /**\n   * The cursor for this workspace.\n   *\n   * @returns The cursor for the workspace.\n   */\n  getCursor(): Cursor | null {\n    if (this.markerManager) {\n      return this.markerManager.getCursor();\n    }\n    return null;\n  }\n\n  /**\n   * Get the block renderer attached to this workspace.\n   *\n   * @returns The renderer attached to this workspace.\n   */\n  getRenderer(): Renderer {\n    return this.renderer;\n  }\n\n  /**\n   * Get the theme manager for this workspace.\n   *\n   * @returns The theme manager for this workspace.\n   * @internal\n   */\n  getThemeManager(): ThemeManager {\n    return this.themeManager_;\n  }\n\n  /**\n   * Get the workspace theme object.\n   *\n   * @returns The workspace theme object.\n   */\n  getTheme(): Theme {\n    return this.themeManager_.getTheme();\n  }\n\n  /**\n   * Set the workspace theme object.\n   * If no theme is passed, default to the `Classic` theme.\n   *\n   * @param theme The workspace theme object.\n   */\n  setTheme(theme: Theme) {\n    if (!theme) {\n      theme = Classic as Theme;\n    }\n    this.themeManager_.setTheme(theme);\n  }\n\n  /**\n   * Refresh all blocks on the workspace after a theme update.\n   */\n  refreshTheme() {\n    if (this.svgGroup_) {\n      this.renderer.refreshDom(this.svgGroup_, this.getTheme());\n    }\n\n    // Update all blocks in workspace that have a style name.\n    this.updateBlockStyles(\n      this.getAllBlocks(false).filter((block) => !!block.getStyleName()),\n    );\n\n    // Update current toolbox selection.\n    this.refreshToolboxSelection();\n    if (this.toolbox) {\n      this.toolbox.refreshTheme();\n    }\n\n    // Re-render if workspace is visible\n    if (this.isVisible()) {\n      this.setVisible(true);\n    }\n\n    const event = new (eventUtils.get(EventType.THEME_CHANGE))(\n      this.getTheme().name,\n      this.id,\n    );\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Updates all the blocks with new style.\n   *\n   * @param blocks List of blocks to update the style on.\n   */\n  private updateBlockStyles(blocks: Block[]) {\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      const blockStyleName = block.getStyleName();\n      if (blockStyleName) {\n        const blockSvg = block as BlockSvg;\n        blockSvg.setStyle(blockStyleName);\n      }\n    }\n  }\n\n  /**\n   * Getter for the inverted screen CTM.\n   *\n   * @returns The matrix to use in mouseToSvg\n   */\n  getInverseScreenCTM(): SVGMatrix | null {\n    // Defer getting the screen CTM until we actually need it, this should\n    // avoid forced reflows from any calls to updateInverseScreenCTM.\n    if (this.inverseScreenCTMDirty) {\n      const ctm = this.getParentSvg().getScreenCTM();\n      if (ctm) {\n        this.inverseScreenCTM = ctm.inverse();\n        this.inverseScreenCTMDirty = false;\n      }\n    }\n\n    return this.inverseScreenCTM;\n  }\n\n  /** Mark the inverse screen CTM as dirty. */\n  updateInverseScreenCTM() {\n    this.inverseScreenCTMDirty = true;\n  }\n\n  /**\n   * Getter for isVisible\n   *\n   * @returns Whether the workspace is visible.\n   *     False if the workspace has been hidden by calling `setVisible(false)`.\n   */\n  isVisible(): boolean {\n    return this.visible;\n  }\n\n  /**\n   * Return the absolute coordinates of the top-left corner of this element,\n   * scales that after canvas SVG element, if it's a descendant.\n   * The origin (0,0) is the top-left corner of the Blockly SVG.\n   *\n   * @param element SVG element to find the coordinates of.\n   * @returns Object with .x and .y properties.\n   * @internal\n   */\n  getSvgXY(element: SVGElement): Coordinate {\n    let x = 0;\n    let y = 0;\n    let scale = 1;\n    if (\n      this.getCanvas().contains(element) ||\n      this.getBubbleCanvas().contains(element)\n    ) {\n      // Before the SVG canvas, scale the coordinates.\n      scale = this.scale;\n    }\n    do {\n      // Loop through this block and every parent.\n      const xy = svgMath.getRelativeXY(element);\n      if (element === this.getCanvas() || element === this.getBubbleCanvas()) {\n        // After the SVG canvas, don't scale the coordinates.\n        scale = 1;\n      }\n      x += xy.x * scale;\n      y += xy.y * scale;\n      element = element.parentNode as SVGElement;\n    } while (\n      element &&\n      element !== this.getParentSvg() &&\n      element !== this.getInjectionDiv()\n    );\n    return new Coordinate(x, y);\n  }\n\n  /**\n   * Gets the size of the workspace's parent SVG element.\n   *\n   * @returns The cached width and height of the workspace's parent SVG element.\n   * @internal\n   */\n  getCachedParentSvgSize(): Size {\n    const size = this.cachedParentSvgSize;\n    return new Size(size.width, size.height);\n  }\n\n  /**\n   * Return the position of the workspace origin relative to the injection div\n   * origin in pixels.\n   * The workspace origin is where a block would render at position (0, 0).\n   * It is not the upper left corner of the workspace SVG.\n   *\n   * @returns Offset in pixels.\n   * @internal\n   */\n  getOriginOffsetInPixels(): Coordinate {\n    return svgMath.getInjectionDivXY(this.getCanvas());\n  }\n\n  /**\n   * Return the injection div that is a parent of this workspace.\n   * Walks the DOM the first time it's called, then returns a cached value.\n   * Note: We assume this is only called after the workspace has been injected\n   * into the DOM.\n   *\n   * @returns The first parent div with 'injectionDiv' in the name.\n   * @internal\n   */\n  getInjectionDiv(): Element {\n    // NB: it would be better to pass this in at createDom, but is more likely\n    // to break existing uses of Blockly.\n    if (!this.injectionDiv) {\n      let element: Element = this.svgGroup_;\n      while (element) {\n        const classes = element.getAttribute('class') || '';\n        if ((' ' + classes + ' ').includes(' injectionDiv ')) {\n          this.injectionDiv = element;\n          break;\n        }\n        element = element.parentNode as Element;\n      }\n    }\n    return this.injectionDiv!;\n  }\n\n  /**\n   * Returns the SVG group for the workspace.\n   *\n   * @returns The SVG group for the workspace.\n   */\n  getSvgGroup(): Element {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Get the SVG block canvas for the workspace.\n   *\n   * @returns The SVG group for the workspace.\n   * @internal\n   */\n  getBlockCanvas(): SVGElement | null {\n    return this.getCanvas();\n  }\n\n  /**\n   * Save resize handler data so we can delete it later in dispose.\n   *\n   * @param handler Data that can be passed to eventHandling.unbind.\n   */\n  setResizeHandlerWrapper(handler: browserEvents.Data) {\n    this.resizeHandlerWrapper = handler;\n  }\n\n  /**\n   * Create the workspace DOM elements.\n   *\n   * @param opt_backgroundClass Either 'blocklyMainBackground' or\n   *     'blocklyMutatorBackground'.\n   * @returns The workspace's SVG group.\n   */\n  createDom(opt_backgroundClass?: string, injectionDiv?: Element): Element {\n    if (!this.injectionDiv) {\n      this.injectionDiv = injectionDiv ?? null;\n    }\n\n    /**\n     * <g class=\"blocklyWorkspace\">\n     *   <rect class=\"blocklyMainBackground\" height=\"100%\" width=\"100%\"></rect>\n     *   [Trashcan and/or flyout may go here]\n     *   <g class=\"blocklyBlockCanvas\"></g>\n     *   <g class=\"blocklyBubbleCanvas\"></g>\n     * </g>\n     */\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': 'blocklyWorkspace'});\n\n    // Note that a <g> alone does not receive mouse events--it must have a\n    // valid target inside it.  If no background class is specified, as in the\n    // flyout, the workspace will not receive mouse events.\n    if (opt_backgroundClass) {\n      this.svgBackground_ = dom.createSvgElement(\n        Svg.RECT,\n        {'height': '100%', 'width': '100%', 'class': opt_backgroundClass},\n        this.svgGroup_,\n      );\n\n      if (opt_backgroundClass === 'blocklyMainBackground' && this.grid) {\n        this.svgBackground_.style.fill =\n          'url(#' + this.grid.getPatternId() + ')';\n      } else {\n        this.themeManager_.subscribe(\n          this.svgBackground_,\n          'workspaceBackgroundColour',\n          'fill',\n        );\n      }\n    }\n\n    this.layerManager = new LayerManager(this);\n    // Assign the canvases for backwards compatibility.\n    this.svgBlockCanvas_ = this.layerManager.getBlockLayer();\n    this.svgBubbleCanvas_ = this.layerManager.getBubbleLayer();\n\n    if (!this.isFlyout) {\n      browserEvents.conditionalBind(\n        this.svgGroup_,\n        'pointerdown',\n        this,\n        this.onMouseDown,\n        false,\n      );\n      // This no-op works around https://bugs.webkit.org/show_bug.cgi?id=226683,\n      // which otherwise prevents zoom/scroll events from being observed in\n      // Safari. Once that bug is fixed it should be removed.\n      this.dummyWheelListener = () => {};\n      document.body.addEventListener('wheel', this.dummyWheelListener);\n      browserEvents.conditionalBind(\n        this.svgGroup_,\n        'wheel',\n        this,\n        this.onMouseWheel,\n      );\n    }\n\n    // Determine if there needs to be a category tree, or a simple list of\n    // blocks.  This cannot be changed later, since the UI is very different.\n    if (this.options.hasCategories) {\n      const ToolboxClass = registry.getClassFromOptions(\n        registry.Type.TOOLBOX,\n        this.options,\n        true,\n      );\n      this.toolbox = new ToolboxClass!(this);\n    }\n    if (this.grid) {\n      this.grid.update(this.scale);\n    }\n    this.recordDragTargets();\n    const CursorClass = registry.getClassFromOptions(\n      registry.Type.CURSOR,\n      this.options,\n    );\n\n    if (CursorClass) this.markerManager.setCursor(new CursorClass());\n\n    this.renderer.createDom(this.svgGroup_, this.getTheme());\n    return this.svgGroup_;\n  }\n\n  /**\n   * Dispose of this workspace.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  override dispose() {\n    // Stop rerendering.\n    this.rendered = false;\n    if (this.currentGesture_) {\n      this.currentGesture_.cancel();\n    }\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n    if (this.toolbox) {\n      this.toolbox.dispose();\n      this.toolbox = null;\n    }\n    if (this.flyout) {\n      this.flyout.dispose();\n      this.flyout = null;\n    }\n    if (this.trashcan) {\n      this.trashcan.dispose();\n      this.trashcan = null;\n    }\n    if (this.scrollbar) {\n      this.scrollbar.dispose();\n      this.scrollbar = null;\n    }\n    if (this.zoomControls_) {\n      this.zoomControls_.dispose();\n    }\n\n    if (this.audioManager) {\n      this.audioManager.dispose();\n    }\n\n    if (this.grid) {\n      this.grid = null;\n    }\n\n    this.renderer.dispose();\n\n    if (this.markerManager) {\n      this.markerManager.dispose();\n    }\n\n    super.dispose();\n\n    // Dispose of theme manager after all blocks and mutators are disposed of.\n    if (this.themeManager_) {\n      this.themeManager_.unsubscribeWorkspace(this);\n      this.themeManager_.unsubscribe(this.svgBackground_);\n      if (!this.options.parentWorkspace) {\n        this.themeManager_.dispose();\n      }\n    }\n\n    this.connectionDBList.length = 0;\n\n    this.toolboxCategoryCallbacks.clear();\n    this.flyoutButtonCallbacks.clear();\n\n    if (!this.options.parentWorkspace) {\n      // Top-most workspace.  Dispose of the div that the\n      // SVG is injected into (i.e. injectionDiv).\n      const parentSvg = this.getParentSvg();\n      if (parentSvg && parentSvg.parentNode) {\n        dom.removeNode(parentSvg.parentNode);\n      }\n    }\n    if (this.resizeHandlerWrapper) {\n      browserEvents.unbind(this.resizeHandlerWrapper);\n      this.resizeHandlerWrapper = null;\n    }\n\n    // Remove the dummy wheel listener\n    if (this.dummyWheelListener) {\n      document.body.removeEventListener('wheel', this.dummyWheelListener);\n      this.dummyWheelListener = null;\n    }\n  }\n\n  /**\n   * Add a trashcan.\n   *\n   * @internal\n   */\n  addTrashcan() {\n    this.trashcan = WorkspaceSvg.newTrashcan(this);\n    const svgTrashcan = this.trashcan.createDom();\n    this.svgGroup_.insertBefore(svgTrashcan, this.getCanvas());\n  }\n\n  /**\n   * @param _workspace\n   * @internal\n   */\n  static newTrashcan(_workspace: WorkspaceSvg): Trashcan {\n    throw new Error(\n      'The implementation of newTrashcan should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n\n  /**\n   * Add zoom controls.\n   *\n   * @internal\n   */\n  addZoomControls() {\n    this.zoomControls_ = new ZoomControls(this);\n    const svgZoomControls = this.zoomControls_.createDom();\n    this.svgGroup_.appendChild(svgZoomControls);\n  }\n\n  /**\n   * Add a flyout element in an element with the given tag name.\n   *\n   * @param tagName What type of tag the flyout belongs in.\n   * @returns The element containing the flyout DOM.\n   * @internal\n   */\n  addFlyout(tagName: string | Svg<SVGSVGElement> | Svg<SVGGElement>): Element {\n    const workspaceOptions = new Options({\n      'parentWorkspace': this,\n      'rtl': this.RTL,\n      'oneBasedIndex': this.options.oneBasedIndex,\n      'horizontalLayout': this.horizontalLayout,\n      'renderer': this.options.renderer,\n      'rendererOverrides': this.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions);\n    workspaceOptions.toolboxPosition = this.options.toolboxPosition;\n    if (this.horizontalLayout) {\n      const HorizontalFlyout = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n        this.options,\n        true,\n      );\n      this.flyout = new HorizontalFlyout!(workspaceOptions);\n    } else {\n      const VerticalFlyout = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n        this.options,\n        true,\n      );\n      this.flyout = new VerticalFlyout!(workspaceOptions);\n    }\n    this.flyout.autoClose = false;\n    this.flyout.getWorkspace().setVisible(true);\n\n    // Return the element so that callers can place it in their desired\n    // spot in the DOM.  For example, mutator flyouts do not go in the same\n    // place as main workspace flyouts.\n    return this.flyout.createDom(tagName);\n  }\n\n  /**\n   * Getter for the flyout associated with this workspace.  This flyout may be\n   * owned by either the toolbox or the workspace, depending on toolbox\n   * configuration.  It will be null if there is no flyout.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout.\n   * @returns The flyout on this workspace.\n   */\n  getFlyout(opt_own?: boolean): IFlyout | null {\n    if (this.flyout || opt_own) {\n      return this.flyout;\n    }\n    if (this.toolbox) {\n      return this.toolbox.getFlyout();\n    }\n    return null;\n  }\n\n  /**\n   * Getter for the toolbox associated with this workspace, if one exists.\n   *\n   * @returns The toolbox on this workspace.\n   */\n  getToolbox(): IToolbox | null {\n    return this.toolbox;\n  }\n\n  /**\n   * Update items that use screen coordinate calculations\n   * because something has changed (e.g. scroll position, window size).\n   */\n  private updateScreenCalculations() {\n    this.updateInverseScreenCTM();\n    this.recordDragTargets();\n  }\n\n  /**\n   * If enabled, resize the parts of the workspace that change when the\n   * workspace contents (e.g. block positions) change.  This will also scroll\n   * the workspace contents if needed.\n   *\n   * @internal\n   */\n  resizeContents() {\n    if (!this.resizesEnabled || !this.rendered) {\n      return;\n    }\n    if (this.scrollbar) {\n      this.scrollbar.resize();\n    }\n    this.updateInverseScreenCTM();\n  }\n\n  /**\n   * Resize and reposition all of the workspace chrome (toolbox,\n   * trash, scrollbars etc.)\n   * This should be called when something changes that\n   * requires recalculating dimensions and positions of the\n   * trash, zoom, toolbox, etc. (e.g. window resize).\n   */\n  resize() {\n    if (this.toolbox) {\n      this.toolbox.position();\n    }\n    if (this.flyout) {\n      this.flyout.position();\n    }\n\n    const positionables = this.componentManager.getComponents(\n      ComponentManager.Capability.POSITIONABLE,\n      true,\n    );\n    const metrics = this.getMetricsManager().getUiMetrics();\n    const savedPositions = [];\n    for (let i = 0, positionable; (positionable = positionables[i]); i++) {\n      positionable.position(metrics, savedPositions);\n      const boundingRect = positionable.getBoundingRectangle();\n      if (boundingRect) {\n        savedPositions.push(boundingRect);\n      }\n    }\n\n    if (this.scrollbar) {\n      this.scrollbar.resize();\n    }\n    this.updateScreenCalculations();\n  }\n\n  /**\n   * Resizes and repositions workspace chrome if the page has a new\n   * scroll position.\n   *\n   * @internal\n   */\n  updateScreenCalculationsIfScrolled() {\n    const currScroll = svgMath.getDocumentScroll();\n    if (!Coordinate.equals(this.lastRecordedPageScroll, currScroll)) {\n      this.lastRecordedPageScroll = currScroll;\n      this.updateScreenCalculations();\n    }\n  }\n\n  /**\n   * @returns The layer manager for this workspace.\n   */\n  getLayerManager(): LayerManager | null {\n    return this.layerManager;\n  }\n\n  /**\n   * Get the SVG element that forms the drawing surface.\n   *\n   * @returns SVG group element.\n   */\n  getCanvas(): SVGGElement {\n    return this.layerManager!.getBlockLayer();\n  }\n\n  /**\n   * Caches the width and height of the workspace's parent SVG element for use\n   * with getSvgMetrics.\n   *\n   * @param width The width of the parent SVG element.\n   * @param height The height of the parent SVG element\n   * @internal\n   */\n  setCachedParentSvgSize(width: number | null, height: number | null) {\n    const svg = this.getParentSvg();\n    if (width != null) {\n      this.cachedParentSvgSize.width = width;\n      // This is set to support the public (but deprecated) Blockly.svgSize\n      // method.\n      svg.setAttribute('data-cached-width', `${width}`);\n    }\n    if (height != null) {\n      this.cachedParentSvgSize.height = height;\n      // This is set to support the public (but deprecated) Blockly.svgSize\n      // method.\n      svg.setAttribute('data-cached-height', `${height}`);\n    }\n  }\n\n  /**\n   * Get the SVG element that forms the bubble surface.\n   *\n   * @returns SVG group element.\n   */\n  getBubbleCanvas(): SVGGElement {\n    return this.layerManager!.getBubbleLayer();\n  }\n\n  /**\n   * Get the SVG element that contains this workspace.\n   * Note: We assume this is only called after the workspace has been injected\n   * into the DOM.\n   *\n   * @returns SVG element.\n   */\n  getParentSvg(): SVGSVGElement {\n    if (!this.cachedParentSvg) {\n      let element = this.svgGroup_;\n      while (element) {\n        if (element.tagName === 'svg') {\n          this.cachedParentSvg = element;\n          break;\n        }\n        element = element.parentNode as SVGSVGElement;\n      }\n    }\n    return this.cachedParentSvg as SVGSVGElement;\n  }\n\n  /**\n   * Fires a viewport event if events are enabled and there is a change in\n   * viewport values.\n   *\n   * @internal\n   */\n  maybeFireViewportChangeEvent() {\n    if (!eventUtils.isEnabled()) {\n      return;\n    }\n    const scale = this.scale;\n    const top = -this.scrollY;\n    const left = -this.scrollX;\n    if (\n      scale === this.oldScale &&\n      Math.abs(top - this.oldTop) < 1 &&\n      Math.abs(left - this.oldLeft) < 1\n    ) {\n      // Ignore sub-pixel changes in top and left. Due to #4192 there are a lot\n      // of negligible changes in viewport top/left.\n      return;\n    }\n    const event = new (eventUtils.get(EventType.VIEWPORT_CHANGE))(\n      top,\n      left,\n      scale,\n      this.id,\n      this.oldScale,\n    );\n    this.oldScale = scale;\n    this.oldTop = top;\n    this.oldLeft = left;\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Translate this workspace to new coordinates.\n   *\n   * @param x Horizontal translation, in pixel units relative to the top left of\n   *     the Blockly div.\n   * @param y Vertical translation, in pixel units relative to the top left of\n   *     the Blockly div.\n   */\n  translate(x: number, y: number) {\n    this.layerManager?.translateLayers(new Coordinate(x, y), this.scale);\n    this.grid?.moveTo(x, y);\n    this.maybeFireViewportChangeEvent();\n  }\n\n  /**\n   * Returns the horizontal offset of the workspace.\n   * Intended for LTR/RTL compatibility in XML.\n   *\n   * @returns Width.\n   */\n  override getWidth(): number {\n    const metrics = this.getMetrics();\n    return metrics ? metrics.viewWidth / this.scale : 0;\n  }\n\n  /**\n   * Toggles the visibility of the workspace.\n   * Currently only intended for main workspace.\n   *\n   * @param isVisible True if workspace should be visible.\n   */\n  setVisible(isVisible: boolean) {\n    this.visible = isVisible;\n    if (!this.svgGroup_) {\n      return;\n    }\n\n    // Tell the scrollbar whether its container is visible so it can\n    // tell when to hide itself.\n    if (this.scrollbar) {\n      this.scrollbar.setContainerVisible(isVisible);\n    }\n\n    // Tell the flyout whether its container is visible so it can\n    // tell when to hide itself.\n    if (this.getFlyout()) {\n      this.getFlyout()!.setContainerVisible(isVisible);\n    }\n\n    this.getParentSvg().style.display = isVisible ? 'block' : 'none';\n    if (this.toolbox) {\n      // Currently does not support toolboxes in mutators.\n      this.toolbox.setVisible(isVisible);\n    }\n    if (!isVisible) {\n      this.hideChaff(true);\n    }\n  }\n\n  /**\n   * Render all blocks in workspace.\n   */\n  render() {\n    // Generate list of all blocks.\n    const blocks = this.getAllBlocks(false);\n    // Render each block.\n    for (let i = blocks.length - 1; i >= 0; i--) {\n      blocks[i].queueRender();\n    }\n\n    this.getTopBlocks()\n      .flatMap((block) => block.getDescendants(false))\n      .filter((block) => block.isInsertionMarker())\n      .forEach((block) => block.queueRender());\n\n    renderManagement\n      .finishQueuedRenders()\n      .then(() => void this.markerManager.updateMarkers());\n  }\n\n  /**\n   * Highlight or unhighlight a block in the workspace.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param id ID of block to highlight/unhighlight, or null for no block (used\n   *     to unhighlight all blocks).\n   * @param opt_state If undefined, highlight specified block and automatically\n   *     unhighlight all others.  If true or false, manually\n   *     highlight/unhighlight the specified block.\n   */\n  highlightBlock(id: string | null, opt_state?: boolean) {\n    if (opt_state === undefined) {\n      // Unhighlight all blocks.\n      for (let i = 0, block; (block = this.highlightedBlocks[i]); i++) {\n        block.setHighlighted(false);\n      }\n      this.highlightedBlocks.length = 0;\n    }\n    // Highlight/unhighlight the specified block.\n    const block = id ? this.getBlockById(id) : null;\n    if (block) {\n      const state = opt_state === undefined || opt_state;\n      // Using Set here would be great, but at the cost of IE10 support.\n      if (!state) {\n        arrayUtils.removeElem(this.highlightedBlocks, block);\n      } else if (!this.highlightedBlocks.includes(block)) {\n        this.highlightedBlocks.push(block);\n      }\n      block.setHighlighted(state);\n    }\n  }\n\n  /**\n   * Refresh the toolbox unless there's a drag in progress.\n   *\n   * @internal\n   */\n  refreshToolboxSelection() {\n    const ws = this.isFlyout ? this.targetWorkspace : this;\n    if (ws && !ws.currentGesture_ && ws.toolbox && ws.toolbox.getFlyout()) {\n      ws.toolbox.refreshSelection();\n    }\n  }\n\n  /**\n   * Rename a variable by updating its name in the variable map.  Update the\n   *     flyout to show the renamed variable immediately.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  override renameVariableById(id: string, newName: string) {\n    super.renameVariableById(id, newName);\n    this.refreshToolboxSelection();\n  }\n\n  /**\n   * Delete a variable by the passed in ID.   Update the flyout to show\n   *     immediately that the variable is deleted.\n   *\n   * @param id ID of variable to delete.\n   */\n  override deleteVariableById(id: string) {\n    super.deleteVariableById(id);\n    this.refreshToolboxSelection();\n  }\n\n  /**\n   * Create a new variable with the given name.  Update the flyout to show the\n   *     new variable immediately.\n   *\n   * @param name The new variable's name.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  override createVariable(\n    name: string,\n    opt_type?: string | null,\n    opt_id?: string | null,\n  ): VariableModel {\n    const newVar = super.createVariable(name, opt_type, opt_id);\n    this.refreshToolboxSelection();\n    return newVar;\n  }\n\n  /** Make a list of all the delete areas for this workspace. */\n  recordDragTargets() {\n    const dragTargets = this.componentManager.getComponents(\n      ComponentManager.Capability.DRAG_TARGET,\n      true,\n    );\n\n    this.dragTargetAreas = [];\n    for (let i = 0, targetArea; (targetArea = dragTargets[i]); i++) {\n      const rect = targetArea.getClientRect();\n      if (rect) {\n        this.dragTargetAreas.push({\n          component: targetArea,\n          clientRect: rect,\n        });\n      }\n    }\n  }\n  /* eslint-disable jsdoc/require-returns-check */\n  /* eslint-disable @typescript-eslint/no-unused-vars */\n  /**\n   * Obtain a newly created block.\n   *\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created block.\n   */\n  override newBlock(prototypeName: string, opt_id?: string): BlockSvg {\n    throw new Error(\n      'The implementation of newBlock should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n\n  /**\n   * Obtain a newly created comment.\n   *\n   * @param id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created comment.\n   */\n  newComment(id?: string): WorkspaceComment {\n    throw new Error(\n      'The implementation of newComment should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n  /* eslint-enable */\n\n  /**\n   * Returns the drag target the pointer event is over.\n   *\n   * @param e Pointer move event.\n   * @returns Null if not over a drag target, or the drag target the event is\n   *     over.\n   */\n  getDragTarget(e: PointerEvent): IDragTarget | null {\n    for (let i = 0, targetArea; (targetArea = this.dragTargetAreas[i]); i++) {\n      if (targetArea.clientRect.contains(e.clientX, e.clientY)) {\n        return targetArea.component;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Handle a pointerdown on SVG drawing surface.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown(e: PointerEvent) {\n    const gesture = this.getGesture(e);\n    if (gesture) {\n      gesture.handleWsStart(e, this);\n    }\n  }\n\n  /**\n   * Start tracking a drag of an object on this workspace.\n   *\n   * @param e Pointer down event.\n   * @param xy Starting location of object.\n   */\n  startDrag(e: PointerEvent, xy: Coordinate) {\n    drag.start(this, e, xy);\n  }\n\n  /**\n   * Track a drag of an object on this workspace.\n   *\n   * @param e Pointer move event.\n   * @returns New location of object.\n   */\n  moveDrag(e: PointerEvent): Coordinate {\n    return drag.move(this, e);\n  }\n\n  /**\n   * Is the user currently dragging a block or scrolling the flyout/workspace?\n   *\n   * @returns True if currently dragging or scrolling.\n   */\n  isDragging(): boolean {\n    return this.currentGesture_ !== null && this.currentGesture_.isDragging();\n  }\n\n  /**\n   * Is this workspace draggable?\n   *\n   * @returns True if this workspace may be dragged.\n   */\n  isDraggable(): boolean {\n    return this.options.moveOptions && this.options.moveOptions.drag;\n  }\n\n  /**\n   * Is this workspace movable?\n   *\n   * This means the user can reposition the X Y coordinates of the workspace\n   * through input. This can be through scrollbars, scroll wheel, dragging, or\n   * through zooming with the scroll wheel or pinch (since the zoom is centered\n   * on the mouse position). This does not include zooming with the zoom\n   * controls since the X Y coordinates are decided programmatically.\n   *\n   * @returns True if the workspace is movable, false otherwise.\n   */\n  isMovable(): boolean {\n    return (\n      (this.options.moveOptions && !!this.options.moveOptions.scrollbars) ||\n      (this.options.moveOptions && this.options.moveOptions.wheel) ||\n      (this.options.moveOptions && this.options.moveOptions.drag) ||\n      (this.options.zoomOptions && this.options.zoomOptions.wheel) ||\n      (this.options.zoomOptions && this.options.zoomOptions.pinch)\n    );\n  }\n\n  /**\n   * Is this workspace movable horizontally?\n   *\n   * @returns True if the workspace is movable horizontally, false otherwise.\n   */\n  isMovableHorizontally(): boolean {\n    const hasScrollbars = !!this.scrollbar;\n    return (\n      this.isMovable() &&\n      (!hasScrollbars ||\n        (hasScrollbars && this.scrollbar!.canScrollHorizontally()))\n    );\n  }\n\n  /**\n   * Is this workspace movable vertically?\n   *\n   * @returns True if the workspace is movable vertically, false otherwise.\n   */\n  isMovableVertically(): boolean {\n    const hasScrollbars = !!this.scrollbar;\n    return (\n      this.isMovable() &&\n      (!hasScrollbars ||\n        (hasScrollbars && this.scrollbar!.canScrollVertically()))\n    );\n  }\n\n  /**\n   * Handle a mouse-wheel on SVG drawing surface.\n   *\n   * @param e Mouse wheel event.\n   */\n  private onMouseWheel(e: WheelEvent) {\n    // Don't scroll or zoom anything if drag is in progress.\n    if (Gesture.inProgress()) {\n      e.preventDefault();\n      e.stopPropagation();\n      return;\n    }\n    const canWheelZoom =\n      this.options.zoomOptions && this.options.zoomOptions.wheel;\n    const canWheelMove =\n      this.options.moveOptions && this.options.moveOptions.wheel;\n    if (!canWheelZoom && !canWheelMove) {\n      return;\n    }\n\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n\n    // Zoom should also be enabled by the command key on Mac devices,\n    // but not super on Unix.\n    let commandKey;\n    if (userAgent.MAC) {\n      commandKey = e.metaKey;\n    }\n\n    if (canWheelZoom && (e.ctrlKey || commandKey || !canWheelMove)) {\n      // Zoom.\n      // The vertical scroll distance that corresponds to a click of a zoom\n      // button.\n      const PIXELS_PER_ZOOM_STEP = 50;\n      const delta = -scrollDelta.y / PIXELS_PER_ZOOM_STEP;\n      const position = browserEvents.mouseToSvg(\n        e,\n        this.getParentSvg(),\n        this.getInverseScreenCTM(),\n      );\n      this.zoom(position.x, position.y, delta);\n    } else {\n      // Scroll.\n      let x = this.scrollX - scrollDelta.x;\n      let y = this.scrollY - scrollDelta.y;\n\n      if (e.shiftKey && !scrollDelta.x) {\n        // Scroll horizontally (based on vertical scroll delta).\n        // This is needed as for some browser/system combinations which do not\n        // set deltaX.\n        x = this.scrollX - scrollDelta.y;\n        y = this.scrollY; // Don't scroll vertically.\n      }\n      this.scroll(x, y);\n    }\n    e.preventDefault();\n  }\n\n  /**\n   * Calculate the bounding box for the blocks on the workspace.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Contains the position and size of the bounding box containing the\n   *     blocks on the workspace.\n   */\n  getBlocksBoundingBox(): Rect {\n    const topElements = this.getTopBoundedElements();\n    // There are no blocks, return empty rectangle.\n    if (!topElements.length) {\n      return new Rect(0, 0, 0, 0);\n    }\n\n    // Initialize boundary using the first block.\n    const boundary = topElements[0].getBoundingRectangle();\n\n    // Start at 1 since the 0th block was used for initialization.\n    for (let i = 1; i < topElements.length; i++) {\n      const topElement = topElements[i];\n      if (\n        (topElement as any).isInsertionMarker &&\n        (topElement as any).isInsertionMarker()\n      ) {\n        continue;\n      }\n      const blockBoundary = topElement.getBoundingRectangle();\n      if (blockBoundary.top < boundary.top) {\n        boundary.top = blockBoundary.top;\n      }\n      if (blockBoundary.bottom > boundary.bottom) {\n        boundary.bottom = blockBoundary.bottom;\n      }\n      if (blockBoundary.left < boundary.left) {\n        boundary.left = blockBoundary.left;\n      }\n      if (blockBoundary.right > boundary.right) {\n        boundary.right = blockBoundary.right;\n      }\n    }\n    return boundary;\n  }\n\n  /** Clean up the workspace by ordering all the blocks in a column such that none overlap. */\n  cleanUp() {\n    this.setResizesEnabled(false);\n    eventUtils.setGroup(true);\n\n    const topBlocks = this.getTopBlocks(true);\n    const movableBlocks = topBlocks.filter((block) => block.isMovable());\n    const immovableBlocks = topBlocks.filter((block) => !block.isMovable());\n\n    const immovableBlockBounds = immovableBlocks.map((block) =>\n      block.getBoundingRectangle(),\n    );\n\n    const getNextIntersectingImmovableBlock = function (\n      rect: Rect,\n    ): Rect | null {\n      for (const immovableRect of immovableBlockBounds) {\n        if (rect.intersects(immovableRect)) {\n          return immovableRect;\n        }\n      }\n      return null;\n    };\n\n    let cursorY = 0;\n    const minBlockHeight = this.renderer.getConstants().MIN_BLOCK_HEIGHT;\n    for (const block of movableBlocks) {\n      // Make the initial movement of shifting the block to its best possible position.\n      let boundingRect = block.getBoundingRectangle();\n      block.moveBy(-boundingRect.left, cursorY - boundingRect.top, ['cleanup']);\n      block.snapToGrid();\n\n      boundingRect = block.getBoundingRectangle();\n      let conflictingRect = getNextIntersectingImmovableBlock(boundingRect);\n      while (conflictingRect != null) {\n        // If the block intersects with an immovable block, move it down past that immovable block.\n        cursorY =\n          conflictingRect.top + conflictingRect.getHeight() + minBlockHeight;\n        block.moveBy(0, cursorY - boundingRect.top, ['cleanup']);\n        block.snapToGrid();\n        boundingRect = block.getBoundingRectangle();\n        conflictingRect = getNextIntersectingImmovableBlock(boundingRect);\n      }\n\n      // Ensure all next blocks start past the most recent (which will also put them past all\n      // previously intersecting immovable blocks).\n      cursorY =\n        block.getRelativeToSurfaceXY().y +\n        block.getHeightWidth().height +\n        minBlockHeight;\n    }\n    eventUtils.setGroup(false);\n    this.setResizesEnabled(true);\n  }\n\n  /**\n   * Show the context menu for the workspace.\n   *\n   * @param e Mouse event.\n   * @internal\n   */\n  showContextMenu(e: PointerEvent) {\n    if (this.options.readOnly || this.isFlyout) {\n      return;\n    }\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\n      ContextMenuRegistry.ScopeType.WORKSPACE,\n      {workspace: this},\n    );\n\n    // Allow the developer to add or modify menuOptions.\n    if (this.configureContextMenu) {\n      this.configureContextMenu(menuOptions, e);\n    }\n\n    ContextMenu.show(e, menuOptions, this.RTL, this);\n  }\n\n  /**\n   * Modify the block tree on the existing toolbox.\n   *\n   * @param toolboxDef DOM tree of toolbox contents, string of toolbox contents,\n   *     or JSON representing toolbox definition.\n   */\n  updateToolbox(toolboxDef: toolbox.ToolboxDefinition | null) {\n    const parsedToolboxDef = toolbox.convertToolboxDefToJson(toolboxDef);\n\n    if (!parsedToolboxDef) {\n      if (this.options.languageTree) {\n        throw Error(\"Can't nullify an existing toolbox.\");\n      }\n      return; // No change (null to null).\n    }\n    if (!this.options.languageTree) {\n      throw Error(\"Existing toolbox is null.  Can't create new toolbox.\");\n    }\n\n    if (toolbox.hasCategories(parsedToolboxDef)) {\n      if (!this.toolbox) {\n        throw Error(\"Existing toolbox has no categories.  Can't change mode.\");\n      }\n      this.options.languageTree = parsedToolboxDef;\n      this.toolbox.render(parsedToolboxDef);\n    } else {\n      if (!this.flyout) {\n        throw Error(\"Existing toolbox has categories.  Can't change mode.\");\n      }\n      this.options.languageTree = parsedToolboxDef;\n      this.flyout.show(parsedToolboxDef);\n    }\n  }\n\n  /** Mark this workspace as the currently focused main workspace. */\n  markFocused() {\n    if (this.options.parentWorkspace) {\n      this.options.parentWorkspace.markFocused();\n    } else {\n      common.setMainWorkspace(this);\n      // We call e.preventDefault in many event handlers which means we\n      // need to explicitly grab focus (e.g from a textarea) because\n      // the browser will not do it for us.\n      this.getParentSvg().focus({preventScroll: true});\n    }\n  }\n\n  /**\n   * Zooms the workspace in or out relative to/centered on the given (x, y)\n   * coordinate.\n   *\n   * @param x X coordinate of center, in pixel units relative to the top-left\n   *     corner of the parentSVG.\n   * @param y Y coordinate of center, in pixel units relative to the top-left\n   *     corner of the parentSVG.\n   * @param amount Amount of zooming. The formula for the new scale is newScale\n   *     = currentScale * (scaleSpeed^amount). scaleSpeed is set in the\n   *     workspace options. Negative amount values zoom out, and positive amount\n   *     values zoom in.\n   */\n  zoom(x: number, y: number, amount: number) {\n    // Scale factor.\n    const speed = this.options.zoomOptions.scaleSpeed;\n    let scaleChange = Math.pow(speed, amount);\n    const newScale = this.scale * scaleChange;\n    if (this.scale === newScale) {\n      return; // No change in zoom.\n    }\n\n    // Clamp scale within valid range.\n    if (newScale > this.options.zoomOptions.maxScale) {\n      scaleChange = this.options.zoomOptions.maxScale / this.scale;\n    } else if (newScale < this.options.zoomOptions.minScale) {\n      scaleChange = this.options.zoomOptions.minScale / this.scale;\n    }\n\n    // Transform the x/y coordinates from the parentSVG's space into the\n    // canvas' space, so that they are in workspace units relative to the top\n    // left of the visible portion of the workspace.\n    let matrix = this.getCanvas().getCTM();\n    let center = this.getParentSvg().createSVGPoint();\n    center.x = x;\n    center.y = y;\n    center = center.matrixTransform(matrix!.inverse());\n    x = center.x;\n    y = center.y;\n\n    // Find the new scrollX/scrollY so that the center remains in the same\n    // position (relative to the center) after we zoom.\n    // newScale and matrix.a should be identical (within a rounding error).\n    matrix = matrix!\n      .translate(x * (1 - scaleChange), y * (1 - scaleChange))\n      .scale(scaleChange);\n    // scrollX and scrollY are in pixels.\n    // The scrollX and scrollY still need to have absoluteLeft and absoluteTop\n    // subtracted from them, but we'll leave that for setScale so that they're\n    // correctly updated for the new flyout size if we have a simple toolbox.\n    this.scrollX = matrix.e;\n    this.scrollY = matrix.f;\n    this.setScale(newScale);\n  }\n\n  /**\n   * Zooming the blocks centered in the center of view with zooming in or out.\n   *\n   * @param type Type of zooming (-1 zooming out and 1 zooming in).\n   */\n  zoomCenter(type: number) {\n    const metrics = this.getMetrics();\n    let x;\n    let y;\n    if (this.flyout) {\n      // If you want blocks in the center of the view (visible portion of the\n      // workspace) to stay centered when the size of the view decreases (i.e.\n      // when the size of the flyout increases) you need the center of the\n      // *blockly div* to stay in the same pixel-position.\n      // Note: This only works because of how scrollCenter positions blocks.\n      x = metrics.svgWidth ? metrics.svgWidth / 2 : 0;\n      y = metrics.svgHeight ? metrics.svgHeight / 2 : 0;\n    } else {\n      x = metrics.viewWidth / 2 + metrics.absoluteLeft;\n      y = metrics.viewHeight / 2 + metrics.absoluteTop;\n    }\n    this.zoom(x, y, type);\n  }\n\n  /** Zoom the blocks to fit in the workspace if possible. */\n  zoomToFit() {\n    if (!this.isMovable()) {\n      console.warn(\n        'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.',\n      );\n      return;\n    }\n\n    const metrics = this.getMetrics();\n    let workspaceWidth = metrics.viewWidth;\n    let workspaceHeight = metrics.viewHeight;\n    const blocksBox = this.getBlocksBoundingBox();\n    const doubleMargin = ZOOM_TO_FIT_MARGIN * 2;\n    let blocksWidth = blocksBox.right - blocksBox.left + doubleMargin;\n    let blocksHeight = blocksBox.bottom - blocksBox.top + doubleMargin;\n    if (!blocksWidth) {\n      return; // Prevents zooming to infinity.\n    }\n    if (this.flyout) {\n      // We have to add the flyout size to both the workspace size and the\n      // block size because the blocks we want to resize include the blocks in\n      // the flyout, and the area we want to fit them includes the portion of\n      // the workspace that is behind the flyout.\n      if (this.horizontalLayout) {\n        workspaceHeight += this.flyout.getHeight();\n        // Convert from pixels to workspace coordinates.\n        blocksHeight += this.flyout.getHeight() / this.scale;\n      } else {\n        workspaceWidth += this.flyout.getWidth();\n        // Convert from pixels to workspace coordinates.\n        blocksWidth += this.flyout.getWidth() / this.scale;\n      }\n    }\n\n    // Scale Units: (pixels / workspaceUnit)\n    const ratioX = workspaceWidth / blocksWidth;\n    const ratioY = workspaceHeight / blocksHeight;\n    eventUtils.disable();\n    try {\n      this.setScale(Math.min(ratioX, ratioY));\n      this.scrollCenter();\n    } finally {\n      eventUtils.enable();\n    }\n    this.maybeFireViewportChangeEvent();\n  }\n\n  /**\n   * Add a transition class to the block and bubble canvas, to animate any\n   * transform changes.\n   *\n   * @internal\n   */\n  beginCanvasTransition() {\n    dom.addClass(this.getCanvas(), 'blocklyCanvasTransitioning');\n    dom.addClass(this.getBubbleCanvas(), 'blocklyCanvasTransitioning');\n  }\n\n  /**\n   * Remove transition class from the block and bubble canvas.\n   *\n   * @internal\n   */\n  endCanvasTransition() {\n    dom.removeClass(this.getCanvas(), 'blocklyCanvasTransitioning');\n    dom.removeClass(this.getBubbleCanvas(), 'blocklyCanvasTransitioning');\n  }\n\n  /** Center the workspace. */\n  scrollCenter() {\n    if (!this.isMovable()) {\n      console.warn(\n        'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.',\n      );\n      return;\n    }\n\n    const metrics = this.getMetrics();\n    let x = (metrics.scrollWidth - metrics.viewWidth) / 2;\n    let y = (metrics.scrollHeight - metrics.viewHeight) / 2;\n\n    // Convert from workspace directions to canvas directions.\n    x = -x - metrics.scrollLeft;\n    y = -y - metrics.scrollTop;\n    this.scroll(x, y);\n  }\n\n  /**\n   * Scroll the workspace to center on the given block. If the block has other\n   * blocks stacked below it, the workspace will be centered on the stack,\n   * unless blockOnly is true.\n   *\n   * @param id ID of block center on.\n   * @param blockOnly True to center only on the block itself, not its stack.\n   */\n  centerOnBlock(id: string | null, blockOnly?: boolean) {\n    if (!this.isMovable()) {\n      console.warn(\n        'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.',\n      );\n      return;\n    }\n\n    const block = id ? this.getBlockById(id) : null;\n    if (!block) {\n      return;\n    }\n\n    // XY is in workspace coordinates.\n    const xy = block.getRelativeToSurfaceXY();\n    // Height/width is in workspace units.\n    const heightWidth = blockOnly\n      ? {height: block.height, width: block.width}\n      : block.getHeightWidth();\n\n    // Find the enter of the block in workspace units.\n    const blockCenterY = xy.y + heightWidth.height / 2;\n\n    // In RTL the block's position is the top right of the block, not top left.\n    const multiplier = this.RTL ? -1 : 1;\n    const blockCenterX = xy.x + (multiplier * heightWidth.width) / 2;\n\n    // Workspace scale, used to convert from workspace coordinates to pixels.\n    const scale = this.scale;\n\n    // Center of block in pixels, relative to workspace origin (center 0,0).\n    // Scrolling to here would put the block in the top-left corner of the\n    // visible workspace.\n    const pixelX = blockCenterX * scale;\n    const pixelY = blockCenterY * scale;\n\n    const metrics = this.getMetrics();\n\n    // viewHeight and viewWidth are in pixels.\n    const halfViewWidth = metrics.viewWidth / 2;\n    const halfViewHeight = metrics.viewHeight / 2;\n\n    // Put the block in the center of the visible workspace instead.\n    const scrollToCenterX = pixelX - halfViewWidth;\n    const scrollToCenterY = pixelY - halfViewHeight;\n\n    // Convert from workspace directions to canvas directions.\n    const x = -scrollToCenterX;\n    const y = -scrollToCenterY;\n\n    this.scroll(x, y);\n  }\n\n  /**\n   * Set the workspace's zoom factor.\n   *\n   * @param newScale Zoom factor. Units: (pixels / workspaceUnit).\n   */\n  setScale(newScale: number) {\n    if (\n      this.options.zoomOptions.maxScale &&\n      newScale > this.options.zoomOptions.maxScale\n    ) {\n      newScale = this.options.zoomOptions.maxScale;\n    } else if (\n      this.options.zoomOptions.minScale &&\n      newScale < this.options.zoomOptions.minScale\n    ) {\n      newScale = this.options.zoomOptions.minScale;\n    }\n    this.scale = newScale;\n\n    this.hideChaff(false);\n    // Get the flyout, if any, whether our own or owned by the toolbox.\n    const flyout = this.getFlyout(false);\n    if (flyout && flyout.isVisible()) {\n      flyout.reflow();\n      this.recordDragTargets();\n    }\n    if (this.grid) {\n      this.grid.update(this.scale);\n    }\n\n    // We call scroll instead of scrollbar.resize() so that we can center the\n    // zoom correctly without scrollbars, but scroll does not resize the\n    // scrollbars so we have to call resizeView/resizeContent as well.\n    const metrics = this.getMetrics();\n\n    this.scrollX -= metrics.absoluteLeft;\n    this.scrollY -= metrics.absoluteTop;\n    // The scroll values and the view values are additive inverses of\n    // each other, so when we subtract from one we have to add to the other.\n    metrics.viewLeft += metrics.absoluteLeft;\n    metrics.viewTop += metrics.absoluteTop;\n\n    this.scroll(this.scrollX, this.scrollY);\n    if (this.scrollbar) {\n      if (this.flyout) {\n        this.scrollbar.resizeView(metrics);\n      } else {\n        this.scrollbar.resizeContent(metrics);\n      }\n    }\n  }\n\n  /**\n   * Get the workspace's zoom factor.  If the workspace has a parent, we call\n   * into the parent to get the workspace scale.\n   *\n   * @returns The workspace zoom factor. Units: (pixels / workspaceUnit).\n   */\n  getScale(): number {\n    if (this.options.parentWorkspace) {\n      return this.options.parentWorkspace.getScale();\n    }\n    return this.scale;\n  }\n\n  /**\n   * Scroll the workspace to a specified offset (in pixels), keeping in the\n   * workspace bounds. See comment on workspaceSvg.scrollX for more detail on\n   * the meaning of these values.\n   *\n   * @param x Target X to scroll to.\n   * @param y Target Y to scroll to.\n   */\n  scroll(x: number, y: number) {\n    this.hideChaff(/* opt_onlyClosePopups= */ true);\n\n    // Keep scrolling within the bounds of the content.\n    const metrics = this.getMetrics();\n    // Canvas coordinates (aka scroll coordinates) have inverse directionality\n    // to workspace coordinates so we have to inverse them.\n    x = Math.min(x, -metrics.scrollLeft);\n    y = Math.min(y, -metrics.scrollTop);\n    const maxXDisplacement = Math.max(\n      0,\n      metrics.scrollWidth - metrics.viewWidth,\n    );\n    const maxXScroll = metrics.scrollLeft + maxXDisplacement;\n    const maxYDisplacement = Math.max(\n      0,\n      metrics.scrollHeight - metrics.viewHeight,\n    );\n    const maxYScroll = metrics.scrollTop + maxYDisplacement;\n    x = Math.max(x, -maxXScroll);\n    y = Math.max(y, -maxYScroll);\n    this.scrollX = x;\n    this.scrollY = y;\n\n    if (this.scrollbar) {\n      // The content position (displacement from the content's top-left to the\n      // origin) plus the scroll position (displacement from the view's top-left\n      // to the origin) gives us the distance from the view's top-left to the\n      // content's top-left. Then we negate this so we get the displacement from\n      // the content's top-left to the view's top-left, matching the\n      // directionality of the scrollbars.\n      this.scrollbar.set(\n        -(x + metrics.scrollLeft),\n        -(y + metrics.scrollTop),\n        false,\n      );\n    }\n    // We have to shift the translation so that when the canvas is at 0, 0 the\n    // workspace origin is not underneath the toolbox.\n    x += metrics.absoluteLeft;\n    y += metrics.absoluteTop;\n    this.translate(x, y);\n  }\n\n  /**\n   * Find the block on this workspace with the specified ID.\n   *\n   * @param id ID of block to find.\n   * @returns The sought after block, or null if not found.\n   */\n  override getBlockById(id: string): BlockSvg | null {\n    return super.getBlockById(id) as BlockSvg;\n  }\n\n  /**\n   * Find all blocks in workspace.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  override getAllBlocks(ordered = false): BlockSvg[] {\n    return super.getAllBlocks(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Finds the top-level blocks and returns them.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level block objects.\n   */\n  override getTopBlocks(ordered = false): BlockSvg[] {\n    return super.getTopBlocks(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Adds a block to the list of top blocks.\n   *\n   * @param block Block to add.\n   */\n  override addTopBlock(block: Block) {\n    this.addTopBoundedElement(block as BlockSvg);\n    super.addTopBlock(block);\n  }\n\n  /**\n   * Removes a block from the list of top blocks.\n   *\n   * @param block Block to remove.\n   */\n  override removeTopBlock(block: Block) {\n    this.removeTopBoundedElement(block as BlockSvg);\n    super.removeTopBlock(block);\n  }\n\n  /**\n   * Adds a comment to the list of top comments.\n   *\n   * @param comment comment to add.\n   */\n  override addTopComment(comment: WorkspaceComment) {\n    this.addTopBoundedElement(comment as RenderedWorkspaceComment);\n    super.addTopComment(comment);\n  }\n\n  /**\n   * Removes a comment from the list of top comments.\n   *\n   * @param comment comment to remove.\n   */\n  override removeTopComment(comment: WorkspaceComment) {\n    this.removeTopBoundedElement(comment as RenderedWorkspaceComment);\n    super.removeTopComment(comment);\n  }\n\n  override getRootWorkspace(): WorkspaceSvg | null {\n    return super.getRootWorkspace() as WorkspaceSvg | null;\n  }\n\n  /**\n   * Adds a bounded element to the list of top bounded elements.\n   *\n   * @param element Bounded element to add.\n   */\n  addTopBoundedElement(element: IBoundedElement) {\n    this.topBoundedElements.push(element);\n  }\n\n  /**\n   * Removes a bounded element from the list of top bounded elements.\n   *\n   * @param element Bounded element to remove.\n   */\n  removeTopBoundedElement(element: IBoundedElement) {\n    arrayUtils.removeElem(this.topBoundedElements, element);\n  }\n\n  /**\n   * Finds the top-level bounded elements and returns them.\n   *\n   * @returns The top-level bounded elements.\n   */\n  getTopBoundedElements(): IBoundedElement[] {\n    return new Array<IBoundedElement>().concat(this.topBoundedElements);\n  }\n\n  /**\n   * Update whether this workspace has resizes enabled.\n   * If enabled, workspace will resize when appropriate.\n   * If disabled, workspace will not resize until re-enabled.\n   * Use to avoid resizing during a batch operation, for performance.\n   *\n   * @param enabled Whether resizes should be enabled.\n   */\n  setResizesEnabled(enabled: boolean) {\n    const reenabled = !this.resizesEnabled && enabled;\n    this.resizesEnabled = enabled;\n    if (reenabled) {\n      // Newly enabled.  Trigger a resize.\n      this.resizeContents();\n    }\n  }\n\n  /**\n   * Dispose of all blocks in workspace, with an optimization to prevent\n   * resizes.\n   */\n  override clear() {\n    this.setResizesEnabled(false);\n    super.clear();\n    this.topBoundedElements = [];\n    this.setResizesEnabled(true);\n  }\n\n  /**\n   * Register a callback function associated with a given key, for clicks on\n   * buttons and labels in the flyout.\n   * For instance, a button specified by the XML\n   * <button text=\"create variable\" callbackKey=\"CREATE_VARIABLE\"></button>\n   * should be matched by a call to\n   * registerButtonCallback(\"CREATE_VARIABLE\", yourCallbackFunction).\n   *\n   * @param key The name to use to look up this function.\n   * @param func The function to call when the given button is clicked.\n   */\n  registerButtonCallback(key: string, func: (p1: FlyoutButton) => void) {\n    if (typeof func !== 'function') {\n      throw TypeError('Button callbacks must be functions.');\n    }\n    this.flyoutButtonCallbacks.set(key, func);\n  }\n\n  /**\n   * Get the callback function associated with a given key, for clicks on\n   * buttons and labels in the flyout.\n   *\n   * @param key The name to use to look up the function.\n   * @returns The function corresponding to the given key for this workspace;\n   *     null if no callback is registered.\n   */\n  getButtonCallback(key: string): ((p1: FlyoutButton) => void) | null {\n    return this.flyoutButtonCallbacks.get(key) ?? null;\n  }\n\n  /**\n   * Remove a callback for a click on a button in the flyout.\n   *\n   * @param key The name associated with the callback function.\n   */\n  removeButtonCallback(key: string) {\n    this.flyoutButtonCallbacks.delete(key);\n  }\n\n  /**\n   * Register a callback function associated with a given key, for populating\n   * custom toolbox categories in this workspace.  See the variable and\n   * procedure categories as an example.\n   *\n   * @param key The name to use to look up this function.\n   * @param func The function to call when the given toolbox category is opened.\n   */\n  registerToolboxCategoryCallback(\n    key: string,\n    func: (p1: WorkspaceSvg) => toolbox.FlyoutDefinition,\n  ) {\n    if (typeof func !== 'function') {\n      throw TypeError('Toolbox category callbacks must be functions.');\n    }\n    this.toolboxCategoryCallbacks.set(key, func);\n  }\n\n  /**\n   * Get the callback function associated with a given key, for populating\n   * custom toolbox categories in this workspace.\n   *\n   * @param key The name to use to look up the function.\n   * @returns The function corresponding to the given key for this workspace, or\n   *     null if no function is registered.\n   */\n  getToolboxCategoryCallback(\n    key: string,\n  ): ((p1: WorkspaceSvg) => toolbox.FlyoutDefinition) | null {\n    return this.toolboxCategoryCallbacks.get(key) || null;\n  }\n\n  /**\n   * Remove a callback for a click on a custom category's name in the toolbox.\n   *\n   * @param key The name associated with the callback function.\n   */\n  removeToolboxCategoryCallback(key: string) {\n    this.toolboxCategoryCallbacks.delete(key);\n  }\n\n  /**\n   * Look up the gesture that is tracking this touch stream on this workspace.\n   * May create a new gesture.\n   *\n   * @param e Pointer event.\n   * @returns The gesture that is tracking this touch stream, or null if no\n   *     valid gesture exists.\n   * @internal\n   */\n  getGesture(e: PointerEvent): Gesture | null {\n    const isStart = e.type === 'pointerdown';\n\n    const gesture = this.currentGesture_;\n    if (gesture) {\n      if (isStart && gesture.hasStarted()) {\n        console.warn('Tried to start the same gesture twice.');\n        // That's funny.  We must have missed a mouse up.\n        // Cancel it, rather than try to retrieve all of the state we need.\n        gesture.cancel();\n        return null;\n      }\n      return gesture;\n    }\n\n    // No gesture existed on this workspace, but this looks like the start of a\n    // new gesture.\n    if (isStart) {\n      this.currentGesture_ = new Gesture(e, this);\n      return this.currentGesture_;\n    }\n    // No gesture existed and this event couldn't be the start of a new gesture.\n    return null;\n  }\n\n  /**\n   * Clear the reference to the current gesture.\n   *\n   * @internal\n   */\n  clearGesture() {\n    this.currentGesture_ = null;\n  }\n\n  /**\n   * Cancel the current gesture, if one exists.\n   *\n   * @internal\n   */\n  cancelCurrentGesture() {\n    if (this.currentGesture_) {\n      this.currentGesture_.cancel();\n    }\n  }\n\n  /**\n   * Get the audio manager for this workspace.\n   *\n   * @returns The audio manager for this workspace.\n   */\n  getAudioManager(): WorkspaceAudio {\n    return this.audioManager;\n  }\n\n  /**\n   * Get the grid object for this workspace, or null if there is none.\n   *\n   * @returns The grid object for this workspace.\n   */\n  getGrid(): Grid | null {\n    return this.grid;\n  }\n\n  /**\n   * Close tooltips, context menus, dropdown selections, etc.\n   *\n   * @param onlyClosePopups Whether only popups should be closed. Defaults to\n   *     false.\n   */\n  hideChaff(onlyClosePopups = false) {\n    Tooltip.hide();\n    WidgetDiv.hideIfOwnerIsInWorkspace(this);\n    dropDownDiv.hideWithoutAnimation();\n\n    this.hideComponents(onlyClosePopups);\n  }\n\n  /**\n   * Hide any autohideable components (like flyout, trashcan, and any\n   * user-registered components).\n   *\n   * @param onlyClosePopups Whether only popups should be closed. Defaults to\n   *     false.\n   */\n  hideComponents(onlyClosePopups = false) {\n    const autoHideables = this.getComponentManager().getComponents(\n      ComponentManager.Capability.AUTOHIDEABLE,\n      true,\n    );\n    autoHideables.forEach((autoHideable) =>\n      autoHideable.autoHide(onlyClosePopups),\n    );\n  }\n\n  /**\n   * Sets the X/Y translations of a top level workspace.\n   *\n   * @param xyRatio Contains an x and/or y property which is a float between 0\n   *     and 1 specifying the degree of scrolling.\n   */\n  private static setTopLevelWorkspaceMetrics(\n    this: WorkspaceSvg,\n    xyRatio: {x?: number; y?: number},\n  ) {\n    const metrics = this.getMetrics();\n\n    if (typeof xyRatio.x === 'number') {\n      this.scrollX = -(\n        metrics.scrollLeft +\n        (metrics.scrollWidth - metrics.viewWidth) * xyRatio.x\n      );\n    }\n    if (typeof xyRatio.y === 'number') {\n      this.scrollY = -(\n        metrics.scrollTop +\n        (metrics.scrollHeight - metrics.viewHeight) * xyRatio.y\n      );\n    }\n    // We have to shift the translation so that when the canvas is at 0, 0 the\n    // workspace origin is not underneath the toolbox.\n    const x = this.scrollX + metrics.absoluteLeft;\n    const y = this.scrollY + metrics.absoluteTop;\n    // We could call scroll here, but that has extra checks we don't need to do.\n    this.translate(x, y);\n  }\n}\n\n/**\n * Size the workspace when the contents change.  This also updates\n * scrollbars accordingly.\n *\n * @param workspace The workspace to resize.\n * @internal\n */\nexport function resizeSvgContents(workspace: WorkspaceSvg) {\n  workspace.resizeContents();\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {BlockSvg} from '../block_svg.js';\nimport * as common from '../common.js';\nimport {config} from '../config.js';\nimport {EventType} from '../events/type.js';\nimport * as eventUtils from '../events/utils.js';\nimport {ICopyData} from '../interfaces/i_copyable.js';\nimport {IPaster} from '../interfaces/i_paster.js';\nimport {State, append} from '../serialization/blocks.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport * as registry from './registry.js';\n\nexport class BlockPaster implements IPaster<BlockCopyData, BlockSvg> {\n  static TYPE = 'block';\n\n  paste(\n    copyData: BlockCopyData,\n    workspace: WorkspaceSvg,\n    coordinate?: Coordinate,\n  ): BlockSvg | null {\n    if (!workspace.isCapacityAvailable(copyData.typeCounts!)) return null;\n\n    if (coordinate) {\n      copyData.blockState['x'] = coordinate.x;\n      copyData.blockState['y'] = coordinate.y;\n    }\n\n    // After appending the block to the workspace, it will be bumped from its neighbors\n    // However, the algorithm for deciding where to paste a block depends on\n    // the starting position of the copied block, so we'll pass those coordinates along\n    const initialCoordinates =\n      coordinate ||\n      new Coordinate(\n        copyData.blockState['x'] || 0,\n        copyData.blockState['y'] || 0,\n      );\n\n    eventUtils.disable();\n    let block;\n    try {\n      block = append(copyData.blockState, workspace) as BlockSvg;\n      moveBlockToNotConflict(block, initialCoordinates);\n    } finally {\n      eventUtils.enable();\n    }\n\n    if (!block) return block;\n\n    if (eventUtils.isEnabled() && !block.isShadow()) {\n      eventUtils.fire(new (eventUtils.get(EventType.BLOCK_CREATE))(block));\n    }\n    common.setSelected(block);\n    return block;\n  }\n}\n\n/**\n * Moves the given block to a location where it does not: (1) overlap exactly\n * with any other blocks, or (2) look like it is connected to any other blocks.\n *\n * Exported for testing.\n *\n * @param block The block to move to an unambiguous location.\n * @param originalPosition The initial coordinate to start searching from,\n *    likely the position of the copied block.\n * @internal\n */\nexport function moveBlockToNotConflict(\n  block: BlockSvg,\n  originalPosition: Coordinate,\n) {\n  const workspace = block.workspace;\n  const snapRadius = config.snapRadius;\n  const bumpOffset = Coordinate.difference(\n    originalPosition,\n    block.getRelativeToSurfaceXY(),\n  );\n  const offset = new Coordinate(0, 0);\n  // getRelativeToSurfaceXY is really expensive, so we want to cache this.\n  const otherCoords = workspace\n    .getAllBlocks(false)\n    .filter((otherBlock) => otherBlock.id != block.id)\n    .map((b) => b.getRelativeToSurfaceXY());\n\n  while (\n    blockOverlapsOtherExactly(\n      Coordinate.sum(originalPosition, offset),\n      otherCoords,\n    ) ||\n    blockIsInSnapRadius(block, Coordinate.sum(bumpOffset, offset), snapRadius)\n  ) {\n    if (workspace.RTL) {\n      offset.translate(-snapRadius, snapRadius * 2);\n    } else {\n      offset.translate(snapRadius, snapRadius * 2);\n    }\n  }\n\n  block!.moveTo(Coordinate.sum(originalPosition, offset));\n}\n\n/**\n * @returns true if the given block coordinates are less than a delta of 1 from\n *     any of the other coordinates.\n */\nfunction blockOverlapsOtherExactly(\n  coord: Coordinate,\n  otherCoords: Coordinate[],\n): boolean {\n  return otherCoords.some(\n    (otherCoord) =>\n      Math.abs(otherCoord.x - coord.x) <= 1 &&\n      Math.abs(otherCoord.y - coord.y) <= 1,\n  );\n}\n\n/**\n * @returns true if the given block (when offset by the given amount) is close\n *     enough to any other connections (within the snap radius) that it looks\n *     like they could connect.\n */\nfunction blockIsInSnapRadius(\n  block: BlockSvg,\n  offset: Coordinate,\n  snapRadius: number,\n): boolean {\n  return block\n    .getConnections_(false)\n    .some((connection) => !!connection.closest(snapRadius, offset).connection);\n}\n\nexport interface BlockCopyData extends ICopyData {\n  blockState: State;\n  typeCounts: {[key: string]: number};\n}\n\nregistry.register(BlockPaster.TYPE, new BlockPaster());\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.bumpObjects\n\nimport {RenderedWorkspaceComment} from './comments/rendered_workspace_comment.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockCreate} from './events/events_block_create.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport type {CommentCreate} from './events/events_comment_create.js';\nimport type {CommentMove} from './events/events_comment_move.js';\nimport type {CommentResize} from './events/events_comment_resize.js';\nimport {isViewportChange} from './events/predicates.js';\nimport {BUMP_EVENTS, EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {ContainerRegion} from './metrics_manager.js';\nimport * as mathUtils from './utils/math.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Bumps the given object that has passed out of bounds.\n *\n * @param workspace The workspace containing the object.\n * @param bounds The region to bump an object into. For example, pass\n *     ScrollMetrics to bump a block into the scrollable region of the\n *     workspace, or pass ViewMetrics to bump a block into the visible region of\n *     the workspace. This should be specified in workspace coordinates.\n * @param object The object to bump.\n * @returns True if object was bumped.\n */\nfunction bumpObjectIntoBounds(\n  workspace: WorkspaceSvg,\n  bounds: ContainerRegion,\n  object: IBoundedElement,\n): boolean {\n  // Compute new top/left position for object.\n  const objectMetrics = object.getBoundingRectangle();\n  const height = objectMetrics.bottom - objectMetrics.top;\n  const width = objectMetrics.right - objectMetrics.left;\n\n  const topClamp = bounds.top;\n  const boundsBottom = bounds.top + bounds.height;\n  const bottomClamp = boundsBottom - height;\n  // If the object is taller than the workspace we want to\n  // top-align the block\n  const newYPosition = mathUtils.clamp(\n    topClamp,\n    objectMetrics.top,\n    bottomClamp,\n  );\n  const deltaY = newYPosition - objectMetrics.top;\n\n  // Note: Even in RTL mode the \"anchor\" of the object is the\n  // top-left corner of the object.\n  let leftClamp = bounds.left;\n  const boundsRight = bounds.left + bounds.width;\n  let rightClamp = boundsRight - width;\n  if (workspace.RTL) {\n    // If the object is wider than the workspace and we're in RTL\n    // mode we want to right-align the block, which means setting\n    // the left clamp to match.\n    leftClamp = Math.min(rightClamp, leftClamp);\n  } else {\n    // If the object is wider than the workspace and we're in LTR\n    // mode we want to left-align the block, which means setting\n    // the right clamp to match.\n    rightClamp = Math.max(leftClamp, rightClamp);\n  }\n  const newXPosition = mathUtils.clamp(\n    leftClamp,\n    objectMetrics.left,\n    rightClamp,\n  );\n  const deltaX = newXPosition - objectMetrics.left;\n\n  if (deltaX || deltaY) {\n    object.moveBy(deltaX, deltaY, ['inbounds']);\n    return true;\n  }\n  return false;\n}\nexport const bumpIntoBounds = bumpObjectIntoBounds;\n\n/**\n * Creates a handler for bumping objects when they cross fixed bounds.\n *\n * @param workspace The workspace to handle.\n * @returns The event handler.\n */\nexport function bumpIntoBoundsHandler(\n  workspace: WorkspaceSvg,\n): (p1: Abstract) => void {\n  return (e) => {\n    const metricsManager = workspace.getMetricsManager();\n    if (!metricsManager.hasFixedEdges() || workspace.isDragging()) {\n      return;\n    }\n\n    if (BUMP_EVENTS.includes(e.type ?? '')) {\n      const scrollMetricsInWsCoords = metricsManager.getScrollMetrics(true);\n\n      // Triggered by move/create event\n      const object = extractObjectFromEvent(\n        workspace,\n        e as eventUtils.BumpEvent,\n      );\n      if (!object) {\n        return;\n      }\n      // Handle undo.\n      const existingGroup = eventUtils.getGroup() || false;\n      eventUtils.setGroup(e.group);\n\n      const wasBumped = bumpObjectIntoBounds(\n        workspace,\n        scrollMetricsInWsCoords,\n        object as IBoundedElement,\n      );\n\n      if (wasBumped && !e.group) {\n        console.warn(\n          'Moved object in bounds but there was no' +\n            ' event group. This may break undo.',\n        );\n      }\n      eventUtils.setGroup(existingGroup);\n    } else if (isViewportChange(e)) {\n      if (e.scale && e.oldScale && e.scale > e.oldScale) {\n        bumpTopObjectsIntoBounds(workspace);\n      }\n    }\n  };\n}\n\n/**\n * Extracts the object from the given event.\n *\n * @param workspace The workspace the event originated\n *    from.\n * @param e An event containing an object.\n * @returns The extracted\n *    object.\n */\nfunction extractObjectFromEvent(\n  workspace: WorkspaceSvg,\n  e: eventUtils.BumpEvent,\n): IBoundedElement | null {\n  let object = null;\n  switch (e.type) {\n    case EventType.BLOCK_CREATE:\n    case EventType.BLOCK_MOVE:\n      object = workspace.getBlockById((e as BlockCreate | BlockMove).blockId!);\n      if (object) {\n        object = object.getRootBlock();\n      }\n      break;\n    case EventType.COMMENT_CREATE:\n    case EventType.COMMENT_MOVE:\n    case EventType.COMMENT_RESIZE:\n      object = workspace.getCommentById(\n        (e as CommentCreate | CommentMove | CommentResize).commentId!,\n      ) as RenderedWorkspaceComment;\n      break;\n  }\n  return object;\n}\n\n/**\n * Bumps the top objects in the given workspace into bounds.\n *\n * @param workspace The workspace.\n */\nexport function bumpTopObjectsIntoBounds(workspace: WorkspaceSvg) {\n  const metricsManager = workspace.getMetricsManager();\n  if (!metricsManager.hasFixedEdges() || workspace.isDragging()) {\n    return;\n  }\n\n  const scrollMetricsInWsCoords = metricsManager.getScrollMetrics(true);\n  const topBlocks = workspace.getTopBoundedElements();\n  for (let i = 0, block; (block = topBlocks[i]); i++) {\n    bumpObjectIntoBounds(workspace, scrollMetricsInWsCoords, block);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IDeletable\n\n/**\n * The interface for an object that can be deleted.\n */\nexport interface IDeletable {\n  /**\n   * Get whether this object is deletable or not.\n   *\n   * @returns True if deletable.\n   */\n  isDeletable(): boolean;\n\n  /** Disposes of this object, cleaning up any references or DOM elements. */\n  dispose(): void;\n\n  /** Visually indicates that the object is pending deletion. */\n  setDeleteStyle(wouldDelete: boolean): void;\n}\n\n/** Returns whether the given object is an IDeletable. */\nexport function isDeletable(obj: any): obj is IDeletable {\n  return (\n    obj['isDeletable'] !== undefined &&\n    obj['dispose'] !== undefined &&\n    obj['setDeleteStyle'] !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.clipboard\n\nimport {BlockPaster} from './clipboard/block_paster.js';\nimport * as registry from './clipboard/registry.js';\nimport type {ICopyData, ICopyable} from './interfaces/i_copyable.js';\nimport * as globalRegistry from './registry.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\n/** Metadata about the object that is currently on the clipboard. */\nlet stashedCopyData: ICopyData | null = null;\n\nlet stashedWorkspace: WorkspaceSvg | null = null;\n\n/**\n * Private version of copy for stubbing in tests.\n */\nfunction copyInternal<T extends ICopyData>(toCopy: ICopyable<T>): T | null {\n  const data = toCopy.toCopyData();\n  stashedCopyData = data;\n  stashedWorkspace = (toCopy as any).workspace ?? null;\n  return data;\n}\n\n/**\n * Paste a pasteable element into the workspace.\n *\n * @param copyData The data to paste into the workspace.\n * @param workspace The workspace to paste the data into.\n * @param coordinate The location to paste the thing at.\n * @returns The pasted thing if the paste was successful, null otherwise.\n */\nexport function paste<T extends ICopyData>(\n  copyData: T,\n  workspace: WorkspaceSvg,\n  coordinate?: Coordinate,\n): ICopyable<T> | null;\n\n/**\n * Pastes the last copied ICopyable into the workspace.\n *\n * @returns the pasted thing if the paste was successful, null otherwise.\n */\nexport function paste(): ICopyable<ICopyData> | null;\n\n/**\n * Pastes the given data into the workspace, or the last copied ICopyable if\n * no data is passed.\n *\n * @param copyData The data to paste into the workspace.\n * @param workspace The workspace to paste the data into.\n * @param coordinate The location to paste the thing at.\n * @returns The pasted thing if the paste was successful, null otherwise.\n */\nexport function paste<T extends ICopyData>(\n  copyData?: T,\n  workspace?: WorkspaceSvg,\n  coordinate?: Coordinate,\n): ICopyable<ICopyData> | null {\n  if (!copyData || !workspace) {\n    if (!stashedCopyData || !stashedWorkspace) return null;\n    return pasteFromData(stashedCopyData, stashedWorkspace);\n  }\n  return pasteFromData(copyData, workspace, coordinate);\n}\n\n/**\n * Paste a pasteable element into the workspace.\n *\n * @param copyData The data to paste into the workspace.\n * @param workspace The workspace to paste the data into.\n * @param coordinate The location to paste the thing at.\n * @returns The pasted thing if the paste was successful, null otherwise.\n */\nfunction pasteFromData<T extends ICopyData>(\n  copyData: T,\n  workspace: WorkspaceSvg,\n  coordinate?: Coordinate,\n): ICopyable<T> | null {\n  workspace = workspace.isMutator\n    ? workspace\n    : (workspace.getRootWorkspace() ?? workspace);\n  return (globalRegistry\n    .getObject(globalRegistry.Type.PASTER, copyData.paster, false)\n    ?.paste(copyData, workspace, coordinate) ?? null) as ICopyable<T> | null;\n}\n\n/**\n * Private version of duplicate for stubbing in tests.\n */\nfunction duplicateInternal<\n  U extends ICopyData,\n  T extends ICopyable<U> & IHasWorkspace,\n>(toDuplicate: T): T | null {\n  const data = toDuplicate.toCopyData();\n  if (!data) return null;\n  return paste(data, toDuplicate.workspace) as T;\n}\n\ninterface IHasWorkspace {\n  workspace: WorkspaceSvg;\n}\n\nexport const TEST_ONLY = {\n  duplicateInternal,\n  copyInternal,\n};\n\nexport {BlockPaster, registry};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ICopyable\n\nimport type {ISelectable} from './i_selectable.js';\n\nexport interface ICopyable<T extends ICopyData> extends ISelectable {\n  /**\n   * Encode for copying.\n   *\n   * @returns Copy metadata.\n   */\n  toCopyData(): T | null;\n}\n\nexport namespace ICopyable {\n  export interface ICopyData {\n    paster: string;\n  }\n}\n\nexport type ICopyData = ICopyable.ICopyData;\n\n/** @returns true if the given object is copyable. */\nexport function isCopyable(obj: any): obj is ICopyable<ICopyData> {\n  return obj.toCopyData !== undefined;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ShortcutItems\n\nimport {BlockSvg} from './block_svg.js';\nimport * as clipboard from './clipboard.js';\nimport * as common from './common.js';\nimport * as eventUtils from './events/utils.js';\nimport {Gesture} from './gesture.js';\nimport {ICopyData, isCopyable} from './interfaces/i_copyable.js';\nimport {isDeletable} from './interfaces/i_deletable.js';\nimport {isDraggable} from './interfaces/i_draggable.js';\nimport {KeyboardShortcut, ShortcutRegistry} from './shortcut_registry.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport {Rect} from './utils/rect.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Object holding the names of the default shortcut items.\n */\nexport enum names {\n  ESCAPE = 'escape',\n  DELETE = 'delete',\n  COPY = 'copy',\n  CUT = 'cut',\n  PASTE = 'paste',\n  UNDO = 'undo',\n  REDO = 'redo',\n}\n\n/**\n * Keyboard shortcut to hide chaff on escape.\n */\nexport function registerEscape() {\n  const escapeAction: KeyboardShortcut = {\n    name: names.ESCAPE,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly;\n    },\n    callback(workspace) {\n      // AnyDuringMigration because:  Property 'hideChaff' does not exist on\n      // type 'Workspace'.\n      (workspace as AnyDuringMigration).hideChaff();\n      return true;\n    },\n    keyCodes: [KeyCodes.ESC],\n  };\n  ShortcutRegistry.registry.register(escapeAction);\n}\n\n/**\n * Keyboard shortcut to delete a block on delete or backspace\n */\nexport function registerDelete() {\n  const deleteShortcut: KeyboardShortcut = {\n    name: names.DELETE,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return (\n        !workspace.options.readOnly &&\n        selected != null &&\n        isDeletable(selected) &&\n        selected.isDeletable() &&\n        !Gesture.inProgress()\n      );\n    },\n    callback(workspace, e) {\n      // Delete or backspace.\n      // Stop the browser from going back to the previous page.\n      // Do this first to prevent an error in the delete code from resulting in\n      // data loss.\n      e.preventDefault();\n      const selected = common.getSelected();\n      if (selected instanceof BlockSvg) {\n        selected.checkAndDelete();\n      } else if (isDeletable(selected) && selected.isDeletable()) {\n        eventUtils.setGroup(true);\n        selected.dispose();\n        eventUtils.setGroup(false);\n      }\n      return true;\n    },\n    keyCodes: [KeyCodes.DELETE, KeyCodes.BACKSPACE],\n  };\n  ShortcutRegistry.registry.register(deleteShortcut);\n}\n\nlet copyData: ICopyData | null = null;\nlet copyWorkspace: WorkspaceSvg | null = null;\nlet copyCoords: Coordinate | null = null;\n\n/**\n * Keyboard shortcut to copy a block on ctrl+c, cmd+c, or alt+c.\n */\nexport function registerCopy() {\n  const ctrlC = ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [\n    KeyCodes.CTRL,\n  ]);\n  const altC = ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [\n    KeyCodes.ALT,\n  ]);\n  const metaC = ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [\n    KeyCodes.META,\n  ]);\n\n  const copyShortcut: KeyboardShortcut = {\n    name: names.COPY,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return (\n        !workspace.options.readOnly &&\n        !Gesture.inProgress() &&\n        selected != null &&\n        isDeletable(selected) &&\n        selected.isDeletable() &&\n        isDraggable(selected) &&\n        selected.isMovable() &&\n        isCopyable(selected)\n      );\n    },\n    callback(workspace, e) {\n      // Prevent the default copy behavior, which may beep or otherwise indicate\n      // an error due to the lack of a selection.\n      e.preventDefault();\n      workspace.hideChaff();\n      const selected = common.getSelected();\n      if (!selected || !isCopyable(selected)) return false;\n      copyData = selected.toCopyData();\n      copyWorkspace =\n        selected.workspace instanceof WorkspaceSvg\n          ? selected.workspace\n          : workspace;\n      copyCoords = isDraggable(selected)\n        ? selected.getRelativeToSurfaceXY()\n        : null;\n      return !!copyData;\n    },\n    keyCodes: [ctrlC, altC, metaC],\n  };\n  ShortcutRegistry.registry.register(copyShortcut);\n}\n\n/**\n * Keyboard shortcut to copy and delete a block on ctrl+x, cmd+x, or alt+x.\n */\nexport function registerCut() {\n  const ctrlX = ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [\n    KeyCodes.CTRL,\n  ]);\n  const altX = ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [\n    KeyCodes.ALT,\n  ]);\n  const metaX = ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [\n    KeyCodes.META,\n  ]);\n\n  const cutShortcut: KeyboardShortcut = {\n    name: names.CUT,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return (\n        !workspace.options.readOnly &&\n        !Gesture.inProgress() &&\n        selected != null &&\n        isDeletable(selected) &&\n        selected.isDeletable() &&\n        isDraggable(selected) &&\n        selected.isMovable() &&\n        !selected.workspace!.isFlyout\n      );\n    },\n    callback(workspace) {\n      const selected = common.getSelected();\n\n      if (selected instanceof BlockSvg) {\n        copyData = selected.toCopyData();\n        copyWorkspace = workspace;\n        copyCoords = selected.getRelativeToSurfaceXY();\n        selected.checkAndDelete();\n        return true;\n      } else if (\n        isDeletable(selected) &&\n        selected.isDeletable() &&\n        isCopyable(selected)\n      ) {\n        copyData = selected.toCopyData();\n        copyWorkspace = workspace;\n        copyCoords = isDraggable(selected)\n          ? selected.getRelativeToSurfaceXY()\n          : null;\n        selected.dispose();\n        return true;\n      }\n      return false;\n    },\n    keyCodes: [ctrlX, altX, metaX],\n  };\n\n  ShortcutRegistry.registry.register(cutShortcut);\n}\n\n/**\n * Keyboard shortcut to paste a block on ctrl+v, cmd+v, or alt+v.\n */\nexport function registerPaste() {\n  const ctrlV = ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [\n    KeyCodes.CTRL,\n  ]);\n  const altV = ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [\n    KeyCodes.ALT,\n  ]);\n  const metaV = ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [\n    KeyCodes.META,\n  ]);\n\n  const pasteShortcut: KeyboardShortcut = {\n    name: names.PASTE,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly && !Gesture.inProgress();\n    },\n    callback() {\n      if (!copyData || !copyWorkspace) return false;\n      if (!copyCoords) {\n        // If we don't have location data about the original copyable, let the\n        // paster determine position.\n        return !!clipboard.paste(copyData, copyWorkspace);\n      }\n\n      const {left, top, width, height} = copyWorkspace\n        .getMetricsManager()\n        .getViewMetrics(true);\n      const viewportRect = new Rect(top, top + height, left, left + width);\n\n      if (viewportRect.contains(copyCoords.x, copyCoords.y)) {\n        // If the original copyable is inside the viewport, let the paster\n        // determine position.\n        return !!clipboard.paste(copyData, copyWorkspace);\n      }\n\n      // Otherwise, paste in the middle of the viewport.\n      const centerCoords = new Coordinate(left + width / 2, top + height / 2);\n      return !!clipboard.paste(copyData, copyWorkspace, centerCoords);\n    },\n    keyCodes: [ctrlV, altV, metaV],\n  };\n\n  ShortcutRegistry.registry.register(pasteShortcut);\n}\n\n/**\n * Keyboard shortcut to undo the previous action on ctrl+z, cmd+z, or alt+z.\n */\nexport function registerUndo() {\n  const ctrlZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.CTRL,\n  ]);\n  const altZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.ALT,\n  ]);\n  const metaZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.META,\n  ]);\n\n  const undoShortcut: KeyboardShortcut = {\n    name: names.UNDO,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly && !Gesture.inProgress();\n    },\n    callback(workspace, e) {\n      // 'z' for undo 'Z' is for redo.\n      (workspace as WorkspaceSvg).hideChaff();\n      workspace.undo(false);\n      e.preventDefault();\n      return true;\n    },\n    keyCodes: [ctrlZ, altZ, metaZ],\n  };\n  ShortcutRegistry.registry.register(undoShortcut);\n}\n\n/**\n * Keyboard shortcut to redo the previous action on ctrl+shift+z, cmd+shift+z,\n * or alt+shift+z.\n */\nexport function registerRedo() {\n  const ctrlShiftZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.SHIFT,\n    KeyCodes.CTRL,\n  ]);\n  const altShiftZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.SHIFT,\n    KeyCodes.ALT,\n  ]);\n  const metaShiftZ = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [\n    KeyCodes.SHIFT,\n    KeyCodes.META,\n  ]);\n  // Ctrl-y is redo in Windows.  Command-y is never valid on Macs.\n  const ctrlY = ShortcutRegistry.registry.createSerializedKey(KeyCodes.Y, [\n    KeyCodes.CTRL,\n  ]);\n\n  const redoShortcut: KeyboardShortcut = {\n    name: names.REDO,\n    preconditionFn(workspace) {\n      return !Gesture.inProgress() && !workspace.options.readOnly;\n    },\n    callback(workspace, e) {\n      // 'z' for undo 'Z' is for redo.\n      (workspace as WorkspaceSvg).hideChaff();\n      workspace.undo(true);\n      e.preventDefault();\n      return true;\n    },\n    keyCodes: [ctrlShiftZ, altShiftZ, metaShiftZ, ctrlY],\n  };\n  ShortcutRegistry.registry.register(redoShortcut);\n}\n\n/**\n * Registers all default keyboard shortcut item. This should be called once per\n * instance of KeyboardShortcutRegistry.\n *\n * @internal\n */\nexport function registerDefaultShortcuts() {\n  registerEscape();\n  registerDelete();\n  registerCopy();\n  registerCut();\n  registerPaste();\n  registerUndo();\n  registerRedo();\n}\n\nregisterDefaultShortcuts();\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IParameterModel} from '../interfaces/i_parameter_model.js';\nimport {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport type {Workspace} from '../workspace.js';\nimport * as priorities from './priorities.js';\n\n/** Represents the state of a procedure model. */\nexport interface State {\n  id: string;\n  name: string;\n  returnTypes: string[] | null;\n  parameters?: ParameterState[];\n  [key: string]: unknown;\n}\n\n/** Represents the state of a parameter model. */\nexport interface ParameterState {\n  id: string;\n  name: string;\n  types?: string[];\n  [key: string]: unknown;\n}\n\n/**\n * A newable signature for an IProcedureModel.\n *\n * Refer to\n * https://www.typescriptlang.org/docs/handbook/interfaces.html#difference-between-the-static-and-instance-sides-of-classes\n * for what is going on with this.\n */\ninterface ProcedureModelConstructor<ProcedureModel extends IProcedureModel> {\n  new (workspace: Workspace, name: string, id: string): ProcedureModel;\n\n  /**\n   * Deserializes the JSON state and returns a procedure model.\n   *\n   * @param state The state to deserialize.\n   * @param workspace The workspace to load the procedure model into.\n   * @returns The constructed procedure model.\n   */\n  loadState(state: object, workspace: Workspace): ProcedureModel;\n}\n\n/**\n * A newable signature for an IParameterModel.\n *\n * Refer to\n * https://www.typescriptlang.org/docs/handbook/interfaces.html#difference-between-the-static-and-instance-sides-of-classes\n * for what is going on with this.\n */\ninterface ParameterModelConstructor<ParameterModel extends IParameterModel> {\n  new (workspace: Workspace, name: string, id: string): ParameterModel;\n\n  /**\n   * Deserializes the JSON state and returns a parameter model.\n   *\n   * @param state The state to deserialize.\n   * @param workspace The workspace to load the parameter model into.\n   * @returns The constructed parameter model.\n   */\n  loadState(state: object, workspace: Workspace): ParameterModel;\n}\n\n/**\n * Serializes the given IProcedureModel to JSON.\n */\nexport function saveProcedure(proc: IProcedureModel): State {\n  const state: State = proc.saveState();\n  if (!proc.getParameters().length) return state;\n  state.parameters = proc.getParameters().map((param) => param.saveState());\n  return state;\n}\n\n/**\n * Deserializes the given procedure model State from JSON.\n */\nexport function loadProcedure<\n  ProcedureModel extends IProcedureModel,\n  ParameterModel extends IParameterModel,\n>(\n  procedureModelClass: ProcedureModelConstructor<ProcedureModel>,\n  parameterModelClass: ParameterModelConstructor<ParameterModel>,\n  state: State,\n  workspace: Workspace,\n): ProcedureModel {\n  const proc = procedureModelClass.loadState(state, workspace);\n  if (!state.parameters) return proc;\n  for (const [index, param] of state.parameters.entries()) {\n    proc.insertParameter(\n      parameterModelClass.loadState(param, workspace),\n      index,\n    );\n  }\n  return proc;\n}\n\n/** Serializer for saving and loading procedure state. */\nexport class ProcedureSerializer<\n  ProcedureModel extends IProcedureModel,\n  ParameterModel extends IParameterModel,\n> implements ISerializer\n{\n  public priority = priorities.PROCEDURES;\n\n  /**\n   * Constructs the procedure serializer.\n   *\n   * Example usage:\n   *   new ProcedureSerializer(MyProcedureModelClass, MyParameterModelClass)\n   *\n   * @param procedureModelClass The class (implementing IProcedureModel) that\n   *     you want this serializer to deserialize.\n   * @param parameterModelClass The class (implementing IParameterModel) that\n   *     you want this serializer to deserialize.\n   */\n  constructor(\n    private readonly procedureModelClass: ProcedureModelConstructor<ProcedureModel>,\n    private readonly parameterModelClass: ParameterModelConstructor<ParameterModel>,\n  ) {}\n\n  /** Serializes the procedure models of the given workspace. */\n  save(workspace: Workspace): State[] | null {\n    const save = workspace\n      .getProcedureMap()\n      .getProcedures()\n      .map((proc) => saveProcedure(proc));\n    return save.length ? save : null;\n  }\n\n  /**\n   * Deserializes the procedures models defined by the given state into the\n   * workspace.\n   */\n  load(state: State[], workspace: Workspace) {\n    const map = workspace.getProcedureMap();\n    for (const procState of state) {\n      map.add(\n        loadProcedure(\n          this.procedureModelClass,\n          this.parameterModelClass,\n          procState,\n          workspace,\n        ),\n      );\n    }\n  }\n\n  /** Disposes of any procedure models that exist on the workspace. */\n  clear(workspace: Workspace) {\n    workspace.getProcedureMap().clear();\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.workspaces\n\nimport {EventType} from '../events/type.js';\nimport * as eventUtils from '../events/utils.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\nimport * as dom from '../utils/dom.js';\nimport type {Workspace} from '../workspace.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * Returns the state of the workspace as a plain JavaScript object.\n *\n * @param workspace The workspace to serialize.\n * @returns The serialized state of the workspace.\n */\nexport function save(workspace: Workspace): {\n  [key: string]: AnyDuringMigration;\n} {\n  const state = Object.create(null);\n  const serializerMap = registry.getAllItems(registry.Type.SERIALIZER, true);\n  for (const key in serializerMap) {\n    const save = (serializerMap[key] as ISerializer)?.save(workspace);\n    if (save) {\n      state[key] = save;\n    }\n  }\n  return state;\n}\n\n/**\n * Loads the variable represented by the given state into the given workspace.\n *\n * @param state The state of the workspace to deserialize into the workspace.\n * @param workspace The workspace to add the new state to.\n * @param param1 recordUndo: If true, events triggered by this function will be\n *     undo-able by the user. False by default.\n */\nexport function load(\n  state: {[key: string]: AnyDuringMigration},\n  workspace: Workspace,\n  {recordUndo = false}: {recordUndo?: boolean} = {},\n) {\n  const serializerMap = registry.getAllItems(registry.Type.SERIALIZER, true);\n  if (!serializerMap) {\n    return;\n  }\n\n  const deserializers = Object.entries(serializerMap).sort(\n    (a, b) => (b[1] as ISerializer)!.priority - (a[1] as ISerializer)!.priority,\n  );\n\n  const prevRecordUndo = eventUtils.getRecordUndo();\n  eventUtils.setRecordUndo(recordUndo);\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n\n  dom.startTextWidthCache();\n  if (workspace instanceof WorkspaceSvg) {\n    workspace.setResizesEnabled(false);\n  }\n\n  // We want to trigger clearing in reverse priority order so plugins don't end\n  // up missing dependencies.\n  for (const [, deserializer] of deserializers.reverse()) {\n    (deserializer as ISerializer)?.clear(workspace);\n  }\n\n  // reverse() is destructive, so we have to re-reverse to correct the order.\n  for (const [name, deserializer] of deserializers.reverse()) {\n    const pluginState = state[name];\n    if (pluginState) {\n      (deserializer as ISerializer)?.load(state[name], workspace);\n    }\n  }\n\n  if (workspace instanceof WorkspaceSvg) {\n    workspace.setResizesEnabled(true);\n  }\n  dom.stopTextWidthCache();\n\n  eventUtils.fire(new (eventUtils.get(EventType.FINISHED_LOADING))(workspace));\n\n  eventUtils.setGroup(existingGroup);\n  eventUtils.setRecordUndo(prevRecordUndo);\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.inject\n\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as common from './common.js';\nimport * as Css from './css.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Grid} from './grid.js';\nimport {Msg} from './msg.js';\nimport {Options} from './options.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport {ShortcutRegistry} from './shortcut_registry.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Inject a Blockly editor into the specified container element (usually a div).\n *\n * @param container Containing element, or its ID, or a CSS selector.\n * @param opt_options Optional dictionary of options.\n * @returns Newly created main workspace.\n */\nexport function inject(\n  container: Element | string,\n  opt_options?: BlocklyOptions,\n): WorkspaceSvg {\n  let containerElement: Element | null = null;\n  if (typeof container === 'string') {\n    containerElement =\n      document.getElementById(container) || document.querySelector(container);\n  } else {\n    containerElement = container;\n  }\n  // Verify that the container is in document.\n  if (\n    !document.contains(containerElement) &&\n    document !== containerElement?.ownerDocument\n  ) {\n    throw Error('Error: container is not in current document');\n  }\n  const options = new Options(opt_options || ({} as BlocklyOptions));\n  const subContainer = document.createElement('div');\n  dom.addClass(subContainer, 'injectionDiv');\n  if (opt_options?.rtl) {\n    dom.addClass(subContainer, 'blocklyRTL');\n  }\n  subContainer.tabIndex = 0;\n  aria.setState(subContainer, aria.State.LABEL, Msg['WORKSPACE_ARIA_LABEL']);\n\n  containerElement!.appendChild(subContainer);\n  const svg = createDom(subContainer, options);\n\n  const workspace = createMainWorkspace(subContainer, svg, options);\n\n  init(workspace);\n\n  // Keep focus on the first workspace so entering keyboard navigation looks\n  // correct.\n  common.setMainWorkspace(workspace);\n\n  common.svgResize(workspace);\n\n  subContainer.addEventListener('focusin', function () {\n    common.setMainWorkspace(workspace);\n  });\n\n  browserEvents.conditionalBind(subContainer, 'keydown', null, onKeyDown);\n  browserEvents.conditionalBind(\n    dropDownDiv.getContentDiv(),\n    'keydown',\n    null,\n    onKeyDown,\n  );\n  const widgetContainer = WidgetDiv.getDiv();\n  if (widgetContainer) {\n    browserEvents.conditionalBind(widgetContainer, 'keydown', null, onKeyDown);\n  }\n\n  return workspace;\n}\n\n/**\n * Create the SVG image.\n *\n * @param container Containing element.\n * @param options Dictionary of options.\n * @returns Newly created SVG image.\n */\nfunction createDom(container: Element, options: Options): SVGElement {\n  // Sadly browsers (Chrome vs Firefox) are currently inconsistent in laying\n  // out content in RTL mode.  Therefore Blockly forces the use of LTR,\n  // then manually positions content in RTL as needed.\n  container.setAttribute('dir', 'LTR');\n\n  // Load CSS.\n  Css.inject(options.hasCss, options.pathToMedia);\n\n  // Build the SVG DOM.\n  /*\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlns:html=\"http://www.w3.org/1999/xhtml\"\n      xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n      version=\"1.1\"\n      class=\"blocklySvg\">\n      ...\n    </svg>\n    */\n  const svg = dom.createSvgElement(\n    Svg.SVG,\n    {\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n      'class': 'blocklySvg',\n      'tabindex': '0',\n    },\n    container,\n  );\n  /*\n    <defs>\n      ... filters go here ...\n    </defs>\n    */\n  const defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n  // Each filter/pattern needs a unique ID for the case of multiple Blockly\n  // instances on a page.  Browser behaviour becomes undefined otherwise.\n  // https://neil.fraser.name/news/2015/11/01/\n  const rnd = String(Math.random()).substring(2);\n\n  options.gridPattern = Grid.createDom(rnd, options.gridOptions, defs);\n  return svg;\n}\n\n/**\n * Create a main workspace and add it to the SVG.\n *\n * @param svg SVG element with pattern defined.\n * @param options Dictionary of options.\n * @returns Newly created main workspace.\n */\nfunction createMainWorkspace(\n  injectionDiv: Element,\n  svg: SVGElement,\n  options: Options,\n): WorkspaceSvg {\n  options.parentWorkspace = null;\n  const mainWorkspace = new WorkspaceSvg(options);\n  const wsOptions = mainWorkspace.options;\n  mainWorkspace.scale = wsOptions.zoomOptions.startScale;\n  svg.appendChild(\n    mainWorkspace.createDom('blocklyMainBackground', injectionDiv),\n  );\n\n  // Set the theme name and renderer name onto the injection div.\n  const rendererClassName = mainWorkspace.getRenderer().getClassName();\n  if (rendererClassName) {\n    dom.addClass(injectionDiv, rendererClassName);\n  }\n  const themeClassName = mainWorkspace.getTheme().getClassName();\n  if (themeClassName) {\n    dom.addClass(injectionDiv, themeClassName);\n  }\n\n  if (!wsOptions.hasCategories && wsOptions.languageTree) {\n    // Add flyout as an <svg> that is a sibling of the workspace SVG.\n    const flyout = mainWorkspace.addFlyout(Svg.SVG);\n    dom.insertAfter(flyout, svg);\n  }\n  if (wsOptions.hasTrashcan) {\n    mainWorkspace.addTrashcan();\n  }\n  if (wsOptions.zoomOptions && wsOptions.zoomOptions.controls) {\n    mainWorkspace.addZoomControls();\n  }\n  // Register the workspace svg as a UI component.\n  mainWorkspace\n    .getThemeManager()\n    .subscribe(svg, 'workspaceBackgroundColour', 'background-color');\n\n  // A null translation will also apply the correct initial scale.\n  mainWorkspace.translate(0, 0);\n\n  mainWorkspace.addChangeListener(\n    bumpObjects.bumpIntoBoundsHandler(mainWorkspace),\n  );\n\n  // The SVG is now fully assembled.\n  common.svgResize(mainWorkspace);\n  WidgetDiv.createDom();\n  dropDownDiv.createDom();\n  Tooltip.createDom();\n  return mainWorkspace;\n}\n\n/**\n * Initialize Blockly with various handlers.\n *\n * @param mainWorkspace Newly created main workspace.\n */\nfunction init(mainWorkspace: WorkspaceSvg) {\n  const options = mainWorkspace.options;\n  const svg = mainWorkspace.getParentSvg();\n\n  // Suppress the browser's context menu.\n  browserEvents.conditionalBind(\n    svg.parentNode as Element,\n    'contextmenu',\n    null,\n    function (e: Event) {\n      if (!browserEvents.isTargetInput(e)) {\n        e.preventDefault();\n      }\n    },\n  );\n\n  const workspaceResizeHandler = browserEvents.conditionalBind(\n    window,\n    'resize',\n    null,\n    function () {\n      // Don't hide all the chaff. Leave the dropdown and widget divs open if\n      // possible.\n      Tooltip.hide();\n      mainWorkspace.hideComponents(true);\n      dropDownDiv.repositionForWindowResize();\n      WidgetDiv.repositionForWindowResize();\n      common.svgResize(mainWorkspace);\n      bumpObjects.bumpTopObjectsIntoBounds(mainWorkspace);\n    },\n  );\n  mainWorkspace.setResizeHandlerWrapper(workspaceResizeHandler);\n\n  bindDocumentEvents();\n\n  if (options.languageTree) {\n    const toolbox = mainWorkspace.getToolbox();\n    const flyout = mainWorkspace.getFlyout(true);\n    if (toolbox) {\n      toolbox.init();\n    } else if (flyout) {\n      // Build a fixed flyout with the root blocks.\n      flyout.init(mainWorkspace);\n      flyout.show(options.languageTree);\n      if (typeof flyout.scrollToStart === 'function') {\n        flyout.scrollToStart();\n      }\n    }\n  }\n\n  if (options.hasTrashcan) {\n    mainWorkspace.trashcan!.init();\n  }\n  if (options.zoomOptions && options.zoomOptions.controls) {\n    mainWorkspace.zoomControls_!.init();\n  }\n\n  if (options.moveOptions && options.moveOptions.scrollbars) {\n    const horizontalScroll =\n      options.moveOptions.scrollbars === true ||\n      !!options.moveOptions.scrollbars.horizontal;\n    const verticalScroll =\n      options.moveOptions.scrollbars === true ||\n      !!options.moveOptions.scrollbars.vertical;\n    mainWorkspace.scrollbar = new ScrollbarPair(\n      mainWorkspace,\n      horizontalScroll,\n      verticalScroll,\n      'blocklyMainWorkspaceScrollbar',\n    );\n    mainWorkspace.scrollbar.resize();\n  } else {\n    mainWorkspace.setMetrics({x: 0.5, y: 0.5});\n  }\n\n  // Load the sounds.\n  if (options.hasSounds) {\n    loadSounds(options.pathToMedia, mainWorkspace);\n  }\n}\n\n/**\n * Handle a key-down on SVG drawing surface. Does nothing if the main workspace\n * is not visible.\n *\n * @param e Key down event.\n */\n// TODO (https://github.com/google/blockly/issues/1998) handle cases where there\n// are multiple workspaces and non-main workspaces are able to accept input.\nfunction onKeyDown(e: KeyboardEvent) {\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  if (!mainWorkspace) {\n    return;\n  }\n\n  if (\n    browserEvents.isTargetInput(e) ||\n    (mainWorkspace.rendered && !mainWorkspace.isVisible())\n  ) {\n    // When focused on an HTML text input widget, don't trap any keys.\n    // Ignore keypresses on rendered workspaces that have been explicitly\n    // hidden.\n    return;\n  }\n  ShortcutRegistry.registry.onKeyDown(mainWorkspace, e);\n}\n\n/**\n * Whether event handlers have been bound. Document event handlers will only\n * be bound once, even if Blockly is destroyed and reinjected.\n */\nlet documentEventsBound = false;\n\n/**\n * Bind document events, but only once.  Destroying and reinjecting Blockly\n * should not bind again.\n * Bind events for scrolling the workspace.\n * Most of these events should be bound to the SVG's surface.\n * However, 'mouseup' has to be on the whole document so that a block dragged\n * out of bounds and released will know that it has been released.\n */\nfunction bindDocumentEvents() {\n  if (!documentEventsBound) {\n    browserEvents.conditionalBind(document, 'scroll', null, function () {\n      const workspaces = common.getAllWorkspaces();\n      for (let i = 0, workspace; (workspace = workspaces[i]); i++) {\n        if (workspace instanceof WorkspaceSvg) {\n          workspace.updateInverseScreenCTM();\n        }\n      }\n    });\n    // longStop needs to run to stop the context menu from showing up.  It\n    // should run regardless of what other touch event handlers have run.\n    browserEvents.bind(document, 'touchend', null, Touch.longStop);\n    browserEvents.bind(document, 'touchcancel', null, Touch.longStop);\n  }\n  documentEventsBound = true;\n}\n\n/**\n * Load sounds for the given workspace.\n *\n * @param pathToMedia The path to the media directory.\n * @param workspace The workspace to load sounds for.\n */\nfunction loadSounds(pathToMedia: string, workspace: WorkspaceSvg) {\n  const audioMgr = workspace.getAudioManager();\n  audioMgr.load(\n    [\n      pathToMedia + 'click.mp3',\n      pathToMedia + 'click.wav',\n      pathToMedia + 'click.ogg',\n    ],\n    'click',\n  );\n  audioMgr.load(\n    [\n      pathToMedia + 'disconnect.wav',\n      pathToMedia + 'disconnect.mp3',\n      pathToMedia + 'disconnect.ogg',\n    ],\n    'disconnect',\n  );\n  audioMgr.load(\n    [\n      pathToMedia + 'delete.mp3',\n      pathToMedia + 'delete.ogg',\n      pathToMedia + 'delete.wav',\n    ],\n    'delete',\n  );\n\n  // Bind temporary hooks that preload the sounds.\n  const soundBinds: browserEvents.Data[] = [];\n  /**\n   *\n   */\n  function unbindSounds() {\n    while (soundBinds.length) {\n      const oldSoundBinding = soundBinds.pop();\n      if (oldSoundBinding) {\n        browserEvents.unbind(oldSoundBinding);\n      }\n    }\n    audioMgr.preload();\n  }\n\n  // These are bound on mouse/touch events with\n  // Blockly.browserEvents.conditionalBind, so they restrict the touch\n  // identifier that will be recognized.  But this is really something that\n  // happens on a click, not a drag, so that's not necessary.\n\n  // Android ignores any sound not loaded as a result of a user action.\n  soundBinds.push(\n    browserEvents.conditionalBind(\n      document,\n      'pointermove',\n      null,\n      unbindSounds,\n      true,\n    ),\n  );\n  soundBinds.push(\n    browserEvents.conditionalBind(\n      document,\n      'touchstart',\n      null,\n      unbindSounds,\n      true,\n    ),\n  );\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ContextMenuItems\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as clipboard from './clipboard.js';\nimport {RenderedWorkspaceComment} from './comments/rendered_workspace_comment.js';\nimport * as common from './common.js';\nimport {MANUALLY_DISABLED} from './constants.js';\nimport {\n  ContextMenuRegistry,\n  RegistryItem,\n  Scope,\n} from './contextmenu_registry.js';\nimport * as dialog from './dialog.js';\nimport * as Events from './events/events.js';\nimport * as eventUtils from './events/utils.js';\nimport {CommentIcon} from './icons/comment_icon.js';\nimport {Msg} from './msg.js';\nimport {StatementInput} from './renderers/zelos/zelos.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Option to undo previous action.\n */\nexport function registerUndo() {\n  const undoOption: RegistryItem = {\n    displayText() {\n      return Msg['UNDO'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.getUndoStack().length > 0) {\n        return 'enabled';\n      }\n      return 'disabled';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.undo(false);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'undoWorkspace',\n    weight: 1,\n  };\n  ContextMenuRegistry.registry.register(undoOption);\n}\n\n/**\n * Option to redo previous action.\n */\nexport function registerRedo() {\n  const redoOption: RegistryItem = {\n    displayText() {\n      return Msg['REDO'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.getRedoStack().length > 0) {\n        return 'enabled';\n      }\n      return 'disabled';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.undo(true);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'redoWorkspace',\n    weight: 2,\n  };\n  ContextMenuRegistry.registry.register(redoOption);\n}\n\n/**\n * Option to clean up blocks.\n */\nexport function registerCleanup() {\n  const cleanOption: RegistryItem = {\n    displayText() {\n      return Msg['CLEAN_UP'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.isMovable()) {\n        if (scope.workspace!.getTopBlocks(false).length > 1) {\n          return 'enabled';\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.cleanUp();\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'cleanWorkspace',\n    weight: 3,\n  };\n  ContextMenuRegistry.registry.register(cleanOption);\n}\n/**\n * Creates a callback to collapse or expand top blocks.\n *\n * @param shouldCollapse Whether a block should collapse.\n * @param topBlocks Top blocks in the workspace.\n */\nfunction toggleOption_(shouldCollapse: boolean, topBlocks: BlockSvg[]) {\n  const DELAY = 10;\n  let ms = 0;\n  let timeoutCounter = 0;\n  function timeoutFn(block: BlockSvg) {\n    timeoutCounter--;\n    block.setCollapsed(shouldCollapse);\n    if (timeoutCounter === 0) {\n      Events.setGroup(false);\n    }\n  }\n  Events.setGroup(true);\n  for (let i = 0; i < topBlocks.length; i++) {\n    let block: BlockSvg | null = topBlocks[i];\n    while (block) {\n      timeoutCounter++;\n      setTimeout(timeoutFn.bind(null, block), ms);\n      block = block.getNextBlock();\n      ms += DELAY;\n    }\n  }\n}\n\n/**\n * Option to collapse all blocks.\n */\nexport function registerCollapse() {\n  const collapseOption: RegistryItem = {\n    displayText() {\n      return Msg['COLLAPSE_ALL'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.options.collapse) {\n        const topBlocks = scope.workspace!.getTopBlocks(false);\n        for (let i = 0; i < topBlocks.length; i++) {\n          let block: BlockSvg | null = topBlocks[i];\n          while (block) {\n            if (!block.isCollapsed()) {\n              return 'enabled';\n            }\n            block = block.getNextBlock();\n          }\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      toggleOption_(true, scope.workspace!.getTopBlocks(true));\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'collapseWorkspace',\n    weight: 4,\n  };\n  ContextMenuRegistry.registry.register(collapseOption);\n}\n\n/**\n * Option to expand all blocks.\n */\nexport function registerExpand() {\n  const expandOption: RegistryItem = {\n    displayText() {\n      return Msg['EXPAND_ALL'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.options.collapse) {\n        const topBlocks = scope.workspace!.getTopBlocks(false);\n        for (let i = 0; i < topBlocks.length; i++) {\n          let block: BlockSvg | null = topBlocks[i];\n          while (block) {\n            if (block.isCollapsed()) {\n              return 'enabled';\n            }\n            block = block.getNextBlock();\n          }\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      toggleOption_(false, scope.workspace!.getTopBlocks(true));\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'expandWorkspace',\n    weight: 5,\n  };\n  ContextMenuRegistry.registry.register(expandOption);\n}\n/**\n * Adds a block and its children to a list of deletable blocks.\n *\n * @param block to delete.\n * @param deleteList list of blocks that can be deleted.\n *     This will be modified in place with the given block and its descendants.\n */\nfunction addDeletableBlocks_(block: BlockSvg, deleteList: BlockSvg[]) {\n  if (block.isDeletable()) {\n    Array.prototype.push.apply(deleteList, block.getDescendants(false));\n  } else {\n    const children = block.getChildren(false);\n    for (let i = 0; i < children.length; i++) {\n      addDeletableBlocks_(children[i], deleteList);\n    }\n  }\n}\n\n/**\n * Constructs a list of blocks that can be deleted in the given workspace.\n *\n * @param workspace to delete all blocks from.\n * @returns list of blocks to delete.\n */\nfunction getDeletableBlocks_(workspace: WorkspaceSvg): BlockSvg[] {\n  const deleteList: BlockSvg[] = [];\n  const topBlocks = workspace.getTopBlocks(true);\n  for (let i = 0; i < topBlocks.length; i++) {\n    addDeletableBlocks_(topBlocks[i], deleteList);\n  }\n  return deleteList;\n}\n\n/**\n * Deletes the given blocks. Used to delete all blocks in the workspace.\n *\n * @param deleteList List of blocks to delete.\n * @param eventGroup Event group ID with which all delete events should be\n *     associated.  If not specified, create a new group.\n */\nfunction deleteNext_(deleteList: BlockSvg[], eventGroup?: string) {\n  const DELAY = 10;\n  if (eventGroup) {\n    eventUtils.setGroup(eventGroup);\n  } else {\n    eventUtils.setGroup(true);\n    eventGroup = eventUtils.getGroup();\n  }\n  const block = deleteList.shift();\n  if (block) {\n    if (!block.isDeadOrDying()) {\n      block.dispose(false, true);\n      setTimeout(deleteNext_, DELAY, deleteList, eventGroup);\n    } else {\n      deleteNext_(deleteList, eventGroup);\n    }\n  }\n  eventUtils.setGroup(false);\n}\n\n/**\n * Option to delete all blocks.\n */\nexport function registerDeleteAll() {\n  const deleteOption: RegistryItem = {\n    displayText(scope: Scope) {\n      if (!scope.workspace) {\n        return '';\n      }\n      const deletableBlocksLength = getDeletableBlocks_(scope.workspace).length;\n      if (deletableBlocksLength === 1) {\n        return Msg['DELETE_BLOCK'];\n      }\n      return Msg['DELETE_X_BLOCKS'].replace('%1', `${deletableBlocksLength}`);\n    },\n    preconditionFn(scope: Scope) {\n      if (!scope.workspace) {\n        return 'disabled';\n      }\n      const deletableBlocksLength = getDeletableBlocks_(scope.workspace).length;\n      return deletableBlocksLength > 0 ? 'enabled' : 'disabled';\n    },\n    callback(scope: Scope) {\n      if (!scope.workspace) {\n        return;\n      }\n      scope.workspace.cancelCurrentGesture();\n      const deletableBlocks = getDeletableBlocks_(scope.workspace);\n      if (deletableBlocks.length < 2) {\n        deleteNext_(deletableBlocks);\n      } else {\n        dialog.confirm(\n          Msg['DELETE_ALL_BLOCKS'].replace(\n            '%1',\n            String(deletableBlocks.length),\n          ),\n          function (ok) {\n            if (ok) {\n              deleteNext_(deletableBlocks);\n            }\n          },\n        );\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'workspaceDelete',\n    weight: 6,\n  };\n  ContextMenuRegistry.registry.register(deleteOption);\n}\n/** Registers all workspace-scoped context menu items. */\nfunction registerWorkspaceOptions_() {\n  registerUndo();\n  registerRedo();\n  registerCleanup();\n  registerCollapse();\n  registerExpand();\n  registerDeleteAll();\n}\n\n/**\n * Option to duplicate a block.\n */\nexport function registerDuplicate() {\n  const duplicateOption: RegistryItem = {\n    displayText() {\n      return Msg['DUPLICATE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.isDeletable() && block!.isMovable()) {\n        if (block!.isDuplicatable()) {\n          return 'enabled';\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      if (!scope.block) return;\n      const data = scope.block.toCopyData();\n      if (!data) return;\n      clipboard.paste(data, scope.block.workspace);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDuplicate',\n    weight: 1,\n  };\n  ContextMenuRegistry.registry.register(duplicateOption);\n}\n\n/**\n * Option to add or remove block-level comment.\n */\nexport function registerComment() {\n  const commentOption: RegistryItem = {\n    displayText(scope: Scope) {\n      if (scope.block!.hasIcon(CommentIcon.TYPE)) {\n        // If there's already a comment,  option is to remove.\n        return Msg['REMOVE_COMMENT'];\n      }\n      // If there's no comment yet, option is to add.\n      return Msg['ADD_COMMENT'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (\n        !block!.isInFlyout &&\n        block!.workspace.options.comments &&\n        !block!.isCollapsed() &&\n        block!.isEditable()\n      ) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      const block = scope.block;\n      if (block!.hasIcon(CommentIcon.TYPE)) {\n        block!.setCommentText(null);\n      } else {\n        block!.setCommentText('');\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockComment',\n    weight: 2,\n  };\n  ContextMenuRegistry.registry.register(commentOption);\n}\n\n/**\n * Option to inline variables.\n */\nexport function registerInline() {\n  const inlineOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.getInputsInline()\n        ? Msg['EXTERNAL_INPUTS']\n        : Msg['INLINE_INPUTS'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.isMovable() && !block!.isCollapsed()) {\n        for (let i = 1; i < block!.inputList.length; i++) {\n          // Only display this option if there are two value or dummy inputs\n          // next to each other.\n          if (\n            !(block!.inputList[i - 1] instanceof StatementInput) &&\n            !(block!.inputList[i] instanceof StatementInput)\n          ) {\n            return 'enabled';\n          }\n        }\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.setInputsInline(!scope.block!.getInputsInline());\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockInline',\n    weight: 3,\n  };\n  ContextMenuRegistry.registry.register(inlineOption);\n}\n\n/**\n * Option to collapse or expand a block.\n */\nexport function registerCollapseExpandBlock() {\n  const collapseExpandOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.isCollapsed()\n        ? Msg['EXPAND_BLOCK']\n        : Msg['COLLAPSE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (\n        !block!.isInFlyout &&\n        block!.isMovable() &&\n        block!.workspace.options.collapse\n      ) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.setCollapsed(!scope.block!.isCollapsed());\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockCollapseExpand',\n    weight: 4,\n  };\n  ContextMenuRegistry.registry.register(collapseExpandOption);\n}\n\n/**\n * Option to disable or enable a block.\n */\nexport function registerDisable() {\n  const disableOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.hasDisabledReason(MANUALLY_DISABLED)\n        ? Msg['ENABLE_BLOCK']\n        : Msg['DISABLE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (\n        !block!.isInFlyout &&\n        block!.workspace.options.disable &&\n        block!.isEditable()\n      ) {\n        // Determine whether this block is currently disabled for any reason\n        // other than the manual reason that this context menu item controls.\n        const disabledReasons = block!.getDisabledReasons();\n        const isDisabledForOtherReason =\n          disabledReasons.size >\n          (disabledReasons.has(MANUALLY_DISABLED) ? 1 : 0);\n\n        if (block!.getInheritedDisabled() || isDisabledForOtherReason) {\n          return 'disabled';\n        }\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      const block = scope.block;\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      block!.setDisabledReason(\n        !block!.hasDisabledReason(MANUALLY_DISABLED),\n        MANUALLY_DISABLED,\n      );\n      eventUtils.setGroup(existingGroup);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDisable',\n    weight: 5,\n  };\n  ContextMenuRegistry.registry.register(disableOption);\n}\n\n/**\n * Option to delete a block.\n */\nexport function registerDelete() {\n  const deleteOption: RegistryItem = {\n    displayText(scope: Scope) {\n      const block = scope.block;\n      // Count the number of blocks that are nested in this block.\n      let descendantCount = block!.getDescendants(false).length;\n      const nextBlock = block!.getNextBlock();\n      if (nextBlock) {\n        // Blocks in the current stack would survive this block's deletion.\n        descendantCount -= nextBlock.getDescendants(false).length;\n      }\n      return descendantCount === 1\n        ? Msg['DELETE_BLOCK']\n        : Msg['DELETE_X_BLOCKS'].replace('%1', `${descendantCount}`);\n    },\n    preconditionFn(scope: Scope) {\n      if (!scope.block!.isInFlyout && scope.block!.isDeletable()) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      if (scope.block) {\n        scope.block.checkAndDelete();\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDelete',\n    weight: 6,\n  };\n  ContextMenuRegistry.registry.register(deleteOption);\n}\n\n/**\n * Option to open help for a block.\n */\nexport function registerHelp() {\n  const helpOption: RegistryItem = {\n    displayText() {\n      return Msg['HELP'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      const url =\n        typeof block!.helpUrl === 'function'\n          ? block!.helpUrl()\n          : block!.helpUrl;\n      if (url) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.showHelp();\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockHelp',\n    weight: 7,\n  };\n  ContextMenuRegistry.registry.register(helpOption);\n}\n\n/** Registers an option for deleting a workspace comment. */\nexport function registerCommentDelete() {\n  const deleteOption: RegistryItem = {\n    displayText: () => Msg['REMOVE_COMMENT'],\n    preconditionFn(scope: Scope) {\n      return scope.comment?.isDeletable() ? 'enabled' : 'hidden';\n    },\n    callback(scope: Scope) {\n      eventUtils.setGroup(true);\n      scope.comment?.dispose();\n      eventUtils.setGroup(false);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.COMMENT,\n    id: 'commentDelete',\n    weight: 6,\n  };\n  ContextMenuRegistry.registry.register(deleteOption);\n}\n\n/** Registers an option for duplicating a workspace comment. */\nexport function registerCommentDuplicate() {\n  const duplicateOption: RegistryItem = {\n    displayText: () => Msg['DUPLICATE_COMMENT'],\n    preconditionFn(scope: Scope) {\n      return scope.comment?.isMovable() ? 'enabled' : 'hidden';\n    },\n    callback(scope: Scope) {\n      if (!scope.comment) return;\n      const data = scope.comment.toCopyData();\n      if (!data) return;\n      clipboard.paste(data, scope.comment.workspace);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.COMMENT,\n    id: 'commentDuplicate',\n    weight: 1,\n  };\n  ContextMenuRegistry.registry.register(duplicateOption);\n}\n\n/** Registers an option for adding a workspace comment to the workspace. */\nexport function registerCommentCreate() {\n  const createOption: RegistryItem = {\n    displayText: () => Msg['ADD_COMMENT'],\n    preconditionFn: (scope: Scope) => {\n      return scope.workspace?.isMutator ? 'hidden' : 'enabled';\n    },\n    callback: (scope: Scope, e: PointerEvent) => {\n      const workspace = scope.workspace;\n      if (!workspace) return;\n      eventUtils.setGroup(true);\n      const comment = new RenderedWorkspaceComment(workspace);\n      comment.setText(Msg['WORKSPACE_COMMENT_DEFAULT_TEXT']);\n      comment.moveTo(\n        pixelsToWorkspaceCoords(\n          new Coordinate(e.clientX, e.clientY),\n          workspace,\n        ),\n      );\n      common.setSelected(comment);\n      eventUtils.setGroup(false);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'commentCreate',\n    weight: 8,\n  };\n  ContextMenuRegistry.registry.register(createOption);\n}\n\n/**\n * Converts pixel coordinates (relative to the window) to workspace coordinates.\n */\nfunction pixelsToWorkspaceCoords(\n  pixelCoord: Coordinate,\n  workspace: WorkspaceSvg,\n): Coordinate {\n  const injectionDiv = workspace.getInjectionDiv();\n  // Bounding rect coordinates are in client coordinates, meaning that they\n  // are in pixels relative to the upper left corner of the visible browser\n  // window.  These coordinates change when you scroll the browser window.\n  const boundingRect = injectionDiv.getBoundingClientRect();\n\n  // The client coordinates offset by the injection div's upper left corner.\n  const clientOffsetPixels = new Coordinate(\n    pixelCoord.x - boundingRect.left,\n    pixelCoord.y - boundingRect.top,\n  );\n\n  // The offset in pixels between the main workspace's origin and the upper\n  // left corner of the injection div.\n  const mainOffsetPixels = workspace.getOriginOffsetInPixels();\n\n  // The position of the new comment in pixels relative to the origin of the\n  // main workspace.\n  const finalOffset = Coordinate.difference(\n    clientOffsetPixels,\n    mainOffsetPixels,\n  );\n  // The position of the new comment in main workspace coordinates.\n  finalOffset.scale(1 / workspace.scale);\n  return finalOffset;\n}\n\n/** Registers all block-scoped context menu items. */\nfunction registerBlockOptions_() {\n  registerDuplicate();\n  registerComment();\n  registerInline();\n  registerCollapseExpandBlock();\n  registerDisable();\n  registerDelete();\n  registerHelp();\n}\n\n/** Registers all workspace comment related menu items. */\nexport function registerCommentOptions() {\n  registerCommentDuplicate();\n  registerCommentDelete();\n  registerCommentCreate();\n}\n\n/**\n * Registers all default context menu items. This should be called once per\n * instance of ContextMenuRegistry.\n *\n * @internal\n */\nexport function registerDefaultOptions() {\n  registerWorkspaceOptions_();\n  registerBlockOptions_();\n}\n\nregisterDefaultOptions();\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Coordinate} from '../utils/coordinate.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {ICopyable, ICopyData} from './i_copyable.js';\n\n/** An object that can paste data into a workspace. */\nexport interface IPaster<U extends ICopyData, T extends ICopyable<U>> {\n  paste(\n    copyData: U,\n    workspace: WorkspaceSvg,\n    coordinate?: Coordinate,\n  ): T | null;\n}\n\n/** @returns True if the given object is a paster. */\nexport function isPaster(\n  obj: any,\n): obj is IPaster<ICopyData, ICopyable<ICopyData>> {\n  return obj.paste !== undefined;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/** @internal */\nexport interface IRenderedElement {\n  /**\n   * @returns The root SVG element of htis rendered element.\n   */\n  getSvgRoot(): SVGElement;\n}\n\n/**\n * @returns True if the given object is an IRenderedElement.\n *\n * @internal\n */\nexport function isRenderedElement(obj: any): obj is IRenderedElement {\n  return obj['getSvgRoot'] !== undefined;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ISelectable\n\nimport type {Workspace} from '../workspace.js';\n\n/**\n * The interface for an object that is selectable.\n */\nexport interface ISelectable {\n  id: string;\n\n  workspace: Workspace;\n\n  /** Select this.  Highlight it visually. */\n  select(): void;\n\n  /** Unselect this.  Unhighlight it visually. */\n  unselect(): void;\n}\n\n/** Checks whether the given object is an ISelectable. */\nexport function isSelectable(obj: object): obj is ISelectable {\n  return (\n    typeof (obj as any).id === 'string' &&\n    (obj as any).workspace !== undefined &&\n    (obj as any).select !== undefined &&\n    (obj as any).unselect !== undefined\n  );\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ISelectableToolboxItem\n\nimport type {FlyoutItemInfoArray} from '../utils/toolbox';\nimport type {IToolboxItem} from './i_toolbox_item.js';\n\n/**\n * Interface for an item in the toolbox that can be selected.\n */\nexport interface ISelectableToolboxItem extends IToolboxItem {\n  /**\n   * Gets the name of the toolbox item. Used for emitting events.\n   *\n   * @returns The name of the toolbox item.\n   */\n  getName(): string;\n\n  /**\n   * Gets the contents of the toolbox item. These are items that are meant to be\n   * displayed in the flyout.\n   *\n   * @returns The definition of items to be displayed in the flyout.\n   */\n  getContents(): FlyoutItemInfoArray | string;\n\n  /**\n   * Sets the current toolbox item as selected.\n   *\n   * @param _isSelected True if this category is selected, false otherwise.\n   */\n  setSelected(_isSelected: boolean): void;\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks.\n   */\n  getClickTarget(): Element;\n\n  /**\n   * Handles when the toolbox item is clicked.\n   *\n   * @param _e Click event to handle.\n   */\n  onClick(_e: Event): void;\n}\n\n/**\n * Type guard that checks whether an IToolboxItem is an ISelectableToolboxItem.\n */\nexport function isSelectableToolboxItem(\n  toolboxItem: IToolboxItem,\n): toolboxItem is ISelectableToolboxItem {\n  return toolboxItem.isSelectable();\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/workspace_events.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_ui_base.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_create.js';\n\nimport {Block} from './block.js';\nimport * as blockAnimations from './block_animations.js';\nimport {BlockSvg} from './block_svg.js';\nimport {BlocklyOptions} from './blockly_options.js';\nimport {Blocks} from './blocks.js';\nimport * as browserEvents from './browser_events.js';\nimport * as bubbles from './bubbles.js';\nimport {MiniWorkspaceBubble} from './bubbles/mini_workspace_bubble.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as clipboard from './clipboard.js';\nimport * as comments from './comments.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport {Connection} from './connection.js';\nimport {ConnectionChecker} from './connection_checker.js';\nimport {ConnectionDB} from './connection_db.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as constants from './constants.js';\nimport * as ContextMenu from './contextmenu.js';\nimport * as ContextMenuItems from './contextmenu_items.js';\nimport {ContextMenuRegistry} from './contextmenu_registry.js';\nimport * as Css from './css.js';\nimport {DeleteArea} from './delete_area.js';\nimport * as dialog from './dialog.js';\nimport {DragTarget} from './drag_target.js';\nimport * as dragging from './dragging.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as Events from './events/events.js';\nimport * as Extensions from './extensions.js';\nimport {\n  Field,\n  FieldConfig,\n  FieldValidator,\n  UnattachedFieldError,\n} from './field.js';\nimport {\n  FieldCheckbox,\n  FieldCheckboxConfig,\n  FieldCheckboxFromJsonConfig,\n  FieldCheckboxValidator,\n} from './field_checkbox.js';\nimport {\n  FieldDropdown,\n  FieldDropdownConfig,\n  FieldDropdownFromJsonConfig,\n  FieldDropdownValidator,\n  MenuGenerator,\n  MenuGeneratorFunction,\n  MenuOption,\n} from './field_dropdown.js';\nimport {\n  FieldImage,\n  FieldImageConfig,\n  FieldImageFromJsonConfig,\n} from './field_image.js';\nimport {\n  FieldLabel,\n  FieldLabelConfig,\n  FieldLabelFromJsonConfig,\n} from './field_label.js';\nimport {FieldLabelSerializable} from './field_label_serializable.js';\nimport {\n  FieldNumber,\n  FieldNumberConfig,\n  FieldNumberFromJsonConfig,\n  FieldNumberValidator,\n} from './field_number.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {\n  FieldTextInput,\n  FieldTextInputConfig,\n  FieldTextInputFromJsonConfig,\n  FieldTextInputValidator,\n} from './field_textinput.js';\nimport {\n  FieldVariable,\n  FieldVariableConfig,\n  FieldVariableFromJsonConfig,\n  FieldVariableValidator,\n} from './field_variable.js';\nimport {Flyout} from './flyout_base.js';\nimport {FlyoutButton} from './flyout_button.js';\nimport {HorizontalFlyout} from './flyout_horizontal.js';\nimport {FlyoutMetricsManager} from './flyout_metrics_manager.js';\nimport {VerticalFlyout} from './flyout_vertical.js';\nimport {CodeGenerator} from './generator.js';\nimport {Gesture} from './gesture.js';\nimport {Grid} from './grid.js';\nimport * as icons from './icons.js';\nimport {inject} from './inject.js';\nimport * as inputs from './inputs.js';\nimport {Input} from './inputs/input.js';\nimport {InsertionMarkerManager} from './insertion_marker_manager.js';\nimport {InsertionMarkerPreviewer} from './insertion_marker_previewer.js';\nimport {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport {IAutoHideable} from './interfaces/i_autohideable.js';\nimport {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport {IBubble} from './interfaces/i_bubble.js';\nimport {ICollapsibleToolboxItem} from './interfaces/i_collapsible_toolbox_item.js';\nimport {IComponent} from './interfaces/i_component.js';\nimport {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport {IConnectionPreviewer} from './interfaces/i_connection_previewer.js';\nimport {IContextMenu} from './interfaces/i_contextmenu.js';\nimport {ICopyData, ICopyable, isCopyable} from './interfaces/i_copyable.js';\nimport {IDeletable, isDeletable} from './interfaces/i_deletable.js';\nimport {IDeleteArea} from './interfaces/i_delete_area.js';\nimport {IDragTarget} from './interfaces/i_drag_target.js';\nimport {\n  IDragStrategy,\n  IDraggable,\n  isDraggable,\n} from './interfaces/i_draggable.js';\nimport {IDragger} from './interfaces/i_dragger.js';\nimport {IFlyout} from './interfaces/i_flyout.js';\nimport {IHasBubble, hasBubble} from './interfaces/i_has_bubble.js';\nimport {IIcon, isIcon} from './interfaces/i_icon.js';\nimport {IKeyboardAccessible} from './interfaces/i_keyboard_accessible.js';\nimport {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport {IMovable} from './interfaces/i_movable.js';\nimport {IObservable, isObservable} from './interfaces/i_observable.js';\nimport {IPaster, isPaster} from './interfaces/i_paster.js';\nimport {IPositionable} from './interfaces/i_positionable.js';\nimport {IRegistrable} from './interfaces/i_registrable.js';\nimport {\n  IRenderedElement,\n  isRenderedElement,\n} from './interfaces/i_rendered_element.js';\nimport {ISelectable, isSelectable} from './interfaces/i_selectable.js';\nimport {ISelectableToolboxItem} from './interfaces/i_selectable_toolbox_item.js';\nimport {ISerializable, isSerializable} from './interfaces/i_serializable.js';\nimport {IStyleable} from './interfaces/i_styleable.js';\nimport {IToolbox} from './interfaces/i_toolbox.js';\nimport {IToolboxItem} from './interfaces/i_toolbox_item.js';\nimport {\n  IVariableBackedParameterModel,\n  isVariableBackedParameterModel,\n} from './interfaces/i_variable_backed_parameter_model.js';\nimport * as internalConstants from './internal_constants.js';\nimport {ASTNode} from './keyboard_nav/ast_node.js';\nimport {BasicCursor} from './keyboard_nav/basic_cursor.js';\nimport {Cursor} from './keyboard_nav/cursor.js';\nimport {Marker} from './keyboard_nav/marker.js';\nimport {TabNavigateCursor} from './keyboard_nav/tab_navigate_cursor.js';\nimport type {LayerManager} from './layer_manager.js';\nimport * as layers from './layers.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport {MetricsManager} from './metrics_manager.js';\nimport {Msg, setLocale} from './msg.js';\nimport {Names} from './names.js';\nimport {Options} from './options.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport * as Procedures from './procedures.js';\nimport * as registry from './registry.js';\nimport * as renderManagement from './render_management.js';\nimport {RenderedConnection} from './rendered_connection.js';\nimport * as blockRendering from './renderers/common/block_rendering.js';\nimport * as geras from './renderers/geras/geras.js';\nimport * as thrasos from './renderers/thrasos/thrasos.js';\nimport * as zelos from './renderers/zelos/zelos.js';\nimport {Scrollbar} from './scrollbar.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport * as serialization from './serialization.js';\nimport * as ShortcutItems from './shortcut_items.js';\nimport {ShortcutRegistry} from './shortcut_registry.js';\nimport {Theme} from './theme.js';\nimport * as Themes from './theme/themes.js';\nimport {ThemeManager} from './theme_manager.js';\nimport {ToolboxCategory} from './toolbox/category.js';\nimport {CollapsibleToolboxCategory} from './toolbox/collapsible_category.js';\nimport {ToolboxSeparator} from './toolbox/separator.js';\nimport {Toolbox} from './toolbox/toolbox.js';\nimport {ToolboxItem} from './toolbox/toolbox_item.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport {Trashcan} from './trashcan.js';\nimport * as utils from './utils.js';\nimport * as toolbox from './utils/toolbox.js';\nimport {VariableMap} from './variable_map.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as VariablesDynamic from './variables_dynamic.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {Workspace} from './workspace.js';\nimport {WorkspaceAudio} from './workspace_audio.js';\nimport {WorkspaceDragger} from './workspace_dragger.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\nimport {ZoomControls} from './zoom_controls.js';\n\n/**\n * Blockly core version.\n * This constant is overridden by the build script (npm run build) to the value\n * of the version in package.json. This is done by the Closure Compiler in the\n * buildCompressed gulp task.\n * For local builds, you can pass --define='Blockly.VERSION=X.Y.Z' to the\n * compiler to override this constant.\n *\n * @define {string}\n */\nexport const VERSION = 'uncompiled';\n\n/*\n * Top-level functions and properties on the Blockly namespace.\n * These are used only in external code. Do not reference these\n * from internal code as importing from this file can cause circular\n * dependencies. Do not add new functions here. There is probably a better\n * namespace to put new functions on.\n */\n\n/*\n * Aliases for constants used for connection and input types.\n */\n\n/**\n * @see ConnectionType.INPUT_VALUE\n */\nexport const INPUT_VALUE = ConnectionType.INPUT_VALUE;\n\n/**\n * @see ConnectionType.OUTPUT_VALUE\n */\nexport const OUTPUT_VALUE = ConnectionType.OUTPUT_VALUE;\n\n/**\n * @see ConnectionType.NEXT_STATEMENT\n */\nexport const NEXT_STATEMENT = ConnectionType.NEXT_STATEMENT;\n\n/**\n * @see ConnectionType.PREVIOUS_STATEMENT\n */\nexport const PREVIOUS_STATEMENT = ConnectionType.PREVIOUS_STATEMENT;\n\n/** Aliases for toolbox positions. */\n\n/**\n * @see toolbox.Position.TOP\n */\nexport const TOOLBOX_AT_TOP = toolbox.Position.TOP;\n\n/**\n * @see toolbox.Position.BOTTOM\n */\nexport const TOOLBOX_AT_BOTTOM = toolbox.Position.BOTTOM;\n\n/**\n * @see toolbox.Position.LEFT\n */\nexport const TOOLBOX_AT_LEFT = toolbox.Position.LEFT;\n\n/**\n * @see toolbox.Position.RIGHT\n */\nexport const TOOLBOX_AT_RIGHT = toolbox.Position.RIGHT;\n\n/*\n * Other aliased functions.\n */\n\n/**\n * Size the SVG image to completely fill its container. Call this when the view\n * actually changes sizes (e.g. on a window resize/device orientation change).\n * See workspace.resizeContents to resize the workspace when the contents\n * change (e.g. when a block is added or removed).\n * Record the height/width of the SVG image.\n *\n * @param workspace Any workspace in the SVG.\n * @see Blockly.common.svgResize\n */\nexport const svgResize = common.svgResize;\n\n/**\n * Close tooltips, context menus, dropdown selections, etc.\n *\n * @param opt_onlyClosePopups Whether only popups should be closed.\n * @see Blockly.WorkspaceSvg.hideChaff\n */\nexport function hideChaff(opt_onlyClosePopups?: boolean) {\n  (common.getMainWorkspace() as WorkspaceSvg).hideChaff(opt_onlyClosePopups);\n}\n\n/**\n * Returns the main workspace.  Returns the last used main workspace (based on\n * focus).  Try not to use this function, particularly if there are multiple\n * Blockly instances on a page.\n *\n * @see Blockly.common.getMainWorkspace\n */\nexport const getMainWorkspace = common.getMainWorkspace;\n\n/**\n * Returns the currently selected copyable object.\n */\nexport const getSelected = common.getSelected;\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n * @see Blockly.common.defineBlocksWithJsonArray\n */\nexport const defineBlocksWithJsonArray = common.defineBlocksWithJsonArray;\n\n/**\n * Set the parent container.  This is the container element that the WidgetDiv,\n * dropDownDiv, and Tooltip are rendered into the first time `Blockly.inject`\n * is called.\n * This method is a NOP if called after the first `Blockly.inject`.\n *\n * @param container The container element.\n * @see Blockly.common.setParentContainer\n */\nexport const setParentContainer = common.setParentContainer;\n\n// Aliases to allow external code to access these values for legacy reasons.\nexport const COLLAPSE_CHARS = internalConstants.COLLAPSE_CHARS;\nexport const OPPOSITE_TYPE = internalConstants.OPPOSITE_TYPE;\nexport const RENAME_VARIABLE_ID = internalConstants.RENAME_VARIABLE_ID;\nexport const DELETE_VARIABLE_ID = internalConstants.DELETE_VARIABLE_ID;\nexport const COLLAPSED_INPUT_NAME = constants.COLLAPSED_INPUT_NAME;\nexport const COLLAPSED_FIELD_NAME = constants.COLLAPSED_FIELD_NAME;\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n */\nexport const VARIABLE_CATEGORY_NAME: string = Variables.CATEGORY_NAME;\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n */\nexport const VARIABLE_DYNAMIC_CATEGORY_NAME: string =\n  VariablesDynamic.CATEGORY_NAME;\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * procedure blocks.\n */\nexport const PROCEDURE_CATEGORY_NAME: string = Procedures.CATEGORY_NAME;\n\n// Context for why we need to monkey-patch in these functions (internal):\n//   https://docs.google.com/document/d/1MbO0LEA-pAyx1ErGLJnyUqTLrcYTo-5zga9qplnxeXo/edit?usp=sharing&resourcekey=0-5h_32-i-dHwHjf_9KYEVKg\n\n// clang-format off\nWorkspace.prototype.newBlock = function (\n  prototypeName: string,\n  opt_id?: string,\n): Block {\n  return new Block(this, prototypeName, opt_id);\n};\n\nWorkspaceSvg.prototype.newBlock = function (\n  prototypeName: string,\n  opt_id?: string,\n): BlockSvg {\n  return new BlockSvg(this, prototypeName, opt_id);\n};\n\nWorkspace.prototype.newComment = function (\n  id?: string,\n): comments.WorkspaceComment {\n  return new comments.WorkspaceComment(this, id);\n};\n\nWorkspaceSvg.prototype.newComment = function (\n  id?: string,\n): comments.RenderedWorkspaceComment {\n  return new comments.RenderedWorkspaceComment(this, id);\n};\n\nWorkspaceSvg.newTrashcan = function (workspace: WorkspaceSvg): Trashcan {\n  return new Trashcan(workspace);\n};\n\nMiniWorkspaceBubble.prototype.newWorkspaceSvg = function (\n  options: Options,\n): WorkspaceSvg {\n  return new WorkspaceSvg(options);\n};\n\nNames.prototype.populateProcedures = function (\n  this: Names,\n  workspace: Workspace,\n) {\n  const procedures = Procedures.allProcedures(workspace);\n  // Flatten the return vs no-return procedure lists.\n  const flattenedProcedures = procedures[0].concat(procedures[1]);\n  for (let i = 0; i < flattenedProcedures.length; i++) {\n    this.getName(flattenedProcedures[i][0], Names.NameType.PROCEDURE);\n  }\n};\n// clang-format on\n\n// Re-export submodules that no longer declareLegacyNamespace.\nexport {\n  ASTNode,\n  BasicCursor,\n  Block,\n  BlockSvg,\n  BlocklyOptions,\n  Blocks,\n  CollapsibleToolboxCategory,\n  ComponentManager,\n  Connection,\n  ConnectionChecker,\n  ConnectionDB,\n  ConnectionType,\n  ContextMenu,\n  ContextMenuItems,\n  ContextMenuRegistry,\n  Css,\n  Cursor,\n  DeleteArea,\n  DragTarget,\n  Events,\n  Extensions,\n  Procedures,\n  ShortcutItems,\n  Themes,\n  Tooltip,\n  Touch,\n  Variables,\n  VariablesDynamic,\n  WidgetDiv,\n  Xml,\n  blockAnimations,\n  blockRendering,\n  browserEvents,\n  bubbles,\n  bumpObjects,\n  clipboard,\n  comments,\n  common,\n  constants,\n  dialog,\n  dragging,\n  fieldRegistry,\n  geras,\n  Procedures as procedures,\n  registry,\n  thrasos,\n  uiPosition,\n  utils,\n  zelos,\n};\nexport const DropDownDiv = dropDownDiv;\nexport {\n  CodeGenerator,\n  Field,\n  FieldCheckbox,\n  FieldCheckboxConfig,\n  FieldCheckboxFromJsonConfig,\n  FieldCheckboxValidator,\n  FieldConfig,\n  FieldDropdown,\n  FieldDropdownConfig,\n  FieldDropdownFromJsonConfig,\n  FieldDropdownValidator,\n  FieldImage,\n  FieldImageConfig,\n  FieldImageFromJsonConfig,\n  FieldLabel,\n  FieldLabelConfig,\n  FieldLabelFromJsonConfig,\n  FieldLabelSerializable,\n  FieldNumber,\n  FieldNumberConfig,\n  FieldNumberFromJsonConfig,\n  FieldNumberValidator,\n  FieldTextInput,\n  FieldTextInputConfig,\n  FieldTextInputFromJsonConfig,\n  FieldTextInputValidator,\n  FieldValidator,\n  FieldVariable,\n  FieldVariableConfig,\n  FieldVariableFromJsonConfig,\n  FieldVariableValidator,\n  Flyout,\n  FlyoutButton,\n  FlyoutMetricsManager,\n  CodeGenerator as Generator,\n  Gesture,\n  Grid,\n  HorizontalFlyout,\n  IASTNodeLocation,\n  IASTNodeLocationSvg,\n  IASTNodeLocationWithBlock,\n  IAutoHideable,\n  IBoundedElement,\n  IBubble,\n  ICollapsibleToolboxItem,\n  IComponent,\n  IConnectionChecker,\n  IConnectionPreviewer,\n  IContextMenu,\n  ICopyData,\n  ICopyable,\n  IDeletable,\n  IDeleteArea,\n  IDragStrategy,\n  IDragTarget,\n  IDraggable,\n  IDragger,\n  IFlyout,\n  IHasBubble,\n  IIcon,\n  IKeyboardAccessible,\n  IMetricsManager,\n  IMovable,\n  IObservable,\n  IPaster,\n  IPositionable,\n  IRegistrable,\n  IRenderedElement,\n  ISelectable,\n  ISelectableToolboxItem,\n  ISerializable,\n  IStyleable,\n  IToolbox,\n  IToolboxItem,\n  IVariableBackedParameterModel,\n  Input,\n  InsertionMarkerManager,\n  InsertionMarkerPreviewer,\n  LayerManager,\n  Marker,\n  MarkerManager,\n  Menu,\n  MenuGenerator,\n  MenuGeneratorFunction,\n  MenuItem,\n  MenuOption,\n  MetricsManager,\n  Msg,\n  Names,\n  Options,\n  RenderedConnection,\n  Scrollbar,\n  ScrollbarPair,\n  ShortcutRegistry,\n  TabNavigateCursor,\n  Theme,\n  ThemeManager,\n  Toolbox,\n  ToolboxCategory,\n  ToolboxItem,\n  ToolboxSeparator,\n  Trashcan,\n  UnattachedFieldError,\n  VariableMap,\n  VariableModel,\n  VerticalFlyout,\n  Workspace,\n  WorkspaceAudio,\n  WorkspaceDragger,\n  WorkspaceSvg,\n  ZoomControls,\n  config,\n  hasBubble,\n  icons,\n  inject,\n  inputs,\n  isCopyable,\n  isDeletable,\n  isDraggable,\n  isIcon,\n  isObservable,\n  isPaster,\n  isRenderedElement,\n  isSelectable,\n  isSerializable,\n  isVariableBackedParameterModel,\n  layers,\n  renderManagement,\n  serialization,\n  setLocale,\n};\n", null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blocks\n\n/**\n * A block definition.  For now this very loose, but it can potentially\n * be refined e.g. by replacing this typedef with a class definition.\n */\nexport type BlockDefinition = AnyDuringMigration;\n\n/**\n * A mapping of block type names to block prototype objects.\n */\nexport const Blocks: {[key: string]: BlockDefinition} = Object.create(null);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Enum of values for the .type property for event classes (concrete subclasses\n * of Abstract).\n */\nexport enum EventType {\n  /** Type of event that creates a block. */\n  BLOCK_CREATE = 'create',\n  /** Type of event that deletes a block. */\n  BLOCK_DELETE = 'delete',\n  /** Type of event that changes a block. */\n  BLOCK_CHANGE = 'change',\n  /**\n   * Type of event representing an in-progress change to a field of a\n   * block, which is expected to be followed by a block change event.\n   */\n  BLOCK_FIELD_INTERMEDIATE_CHANGE = 'block_field_intermediate_change',\n  /** Type of event that moves a block. */\n  BLOCK_MOVE = 'move',\n  /** Type of event that creates a variable. */\n  VAR_CREATE = 'var_create',\n  /** Type of event that deletes a variable. */\n  VAR_DELETE = 'var_delete',\n  /** Type of event that renames a variable. */\n  VAR_RENAME = 'var_rename',\n  /**\n   * Type of generic event that records a UI change.\n   *\n   * @deprecated Was only ever intended for internal use.\n   */\n  UI = 'ui',\n  /** Type of event that drags a block. */\n  BLOCK_DRAG = 'drag',\n  /** Type of event that records a change in selected element. */\n  SELECTED = 'selected',\n  /** Type of event that records a click. */\n  CLICK = 'click',\n  /** Type of event that records a marker move. */\n  MARKER_MOVE = 'marker_move',\n  /** Type of event that records a bubble open. */\n  BUBBLE_OPEN = 'bubble_open',\n  /** Type of event that records a trashcan open. */\n  TRASHCAN_OPEN = 'trashcan_open',\n  /** Type of event that records a toolbox item select. */\n  TOOLBOX_ITEM_SELECT = 'toolbox_item_select',\n  /** Type of event that records a theme change. */\n  THEME_CHANGE = 'theme_change',\n  /** Type of event that records a viewport change. */\n  VIEWPORT_CHANGE = 'viewport_change',\n  /** Type of event that creates a comment. */\n  COMMENT_CREATE = 'comment_create',\n  /** Type of event that deletes a comment. */\n  COMMENT_DELETE = 'comment_delete',\n  /** Type of event that changes a comment. */\n  COMMENT_CHANGE = 'comment_change',\n  /** Type of event that moves a comment. */\n  COMMENT_MOVE = 'comment_move',\n  /** Type of event that resizes a comment. */\n  COMMENT_RESIZE = 'comment_resize',\n  /**  Type of event that drags a comment. */\n  COMMENT_DRAG = 'comment_drag',\n  /** Type of event that collapses a comment. */\n  COMMENT_COLLAPSE = 'comment_collapse',\n  /** Type of event that records a workspace load. */\n  FINISHED_LOADING = 'finished_loading',\n}\n\n/**\n * List of events that cause objects to be bumped back into the visible\n * portion of the workspace.\n *\n * Not to be confused with bumping so that disconnected connections do not\n * appear connected.\n */\nexport const BUMP_EVENTS: string[] = [\n  EventType.BLOCK_CREATE,\n  EventType.BLOCK_MOVE,\n  EventType.COMMENT_CREATE,\n  EventType.COMMENT_MOVE,\n];\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Abstract class for events fired as a result of actions in\n * Blockly's editor.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.Abstract\n\nimport * as common from '../common.js';\nimport type {Workspace} from '../workspace.js';\nimport {getGroup, getRecordUndo} from './utils.js';\n\n/**\n * Abstract class for an event.\n */\nexport abstract class Abstract {\n  /**\n   * Whether or not the event was constructed without necessary parameters\n   * (to be populated by fromJson).\n   */\n  abstract isBlank: boolean;\n\n  /** The workspace identifier for this event. */\n  workspaceId?: string = undefined;\n\n  /**\n   * An ID for the group of events this block is associated with.\n   *\n   * Groups define events that should be treated as an single action from the\n   * user's perspective, and should be undone together.\n   */\n  group: string;\n\n  /** Whether this event is undoable or not. */\n  recordUndo: boolean;\n\n  /** Whether or not the event is a UI event. */\n  isUiEvent = false;\n\n  /** Type of this event. */\n  type = '';\n\n  constructor() {\n    this.group = getGroup();\n    this.recordUndo = getRecordUndo();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): AbstractEventJson {\n    return {\n      'type': this.type,\n      'group': this.group,\n    };\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Abstract (like all events), but we can't specify that due to the\n   *     fact that parameters to static methods in subclasses must be\n   *     supertypes of parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: AbstractEventJson,\n    workspace: Workspace,\n    event: any,\n  ): Abstract {\n    event.isBlank = false;\n    event.group = json['group'] || '';\n    event.workspaceId = workspace.id;\n    return event;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns True if null, false if something changed.\n   */\n  isNull(): boolean {\n    return false;\n  }\n\n  /**\n   * Run an event.\n   *\n   * @param _forward True if run forward, false if run backward (undo).\n   */\n  run(_forward: boolean) {\n    // Defined by subclasses. Cannot be abstract b/c UI events do /not/ define\n    // this.\n  }\n\n  /**\n   * Get workspace the event belongs to.\n   *\n   * @returns The workspace the event belongs to.\n   * @throws {Error} if workspace is null.\n   */\n  getEventWorkspace_(): Workspace {\n    let workspace;\n    if (this.workspaceId) {\n      workspace = common.getWorkspaceById(this.workspaceId);\n    }\n    if (!workspace) {\n      throw Error(\n        'Workspace is null. Event must have been generated from real' +\n          ' Blockly events.',\n      );\n    }\n    return workspace;\n  }\n}\n\nexport interface AbstractEventJson {\n  type: string;\n  group: string;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for events fired as a result of UI actions in\n * Blockly's editor.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.UiBase\n\nimport {Abstract as AbstractEvent} from './events_abstract.js';\n\n/**\n * Base class for a UI event.\n * UI events are events that don't need to be sent over the wire for multi-user\n * editing to work (e.g. scrolling the workspace, zooming, opening toolbox\n * categories).\n * UI events do not undo or redo.\n */\nexport class UiBase extends AbstractEvent {\n  override isBlank = true;\n  override workspaceId: string;\n\n  // UI events do not undo or redo.\n  override recordUndo = false;\n\n  /** Whether or not the event is a UI event. */\n  override isUiEvent = true;\n\n  /**\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(opt_workspaceId?: string) {\n    super();\n\n    /** Whether or not the event is blank (to be populated by fromJson). */\n    this.isBlank = typeof opt_workspaceId === 'undefined';\n\n    /** The workspace identifier for this event. */\n    this.workspaceId = opt_workspaceId ? opt_workspaceId : '';\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of UI click in Blockly's editor.\n *\n * @class\n */\n\n// Former goog.module ID: Blockly.Events.Click\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that some blockly element was clicked.\n */\nexport class Click extends UiBase {\n  /** The ID of the block that was clicked, if a block was clicked. */\n  blockId?: string;\n\n  /**\n   * The type of element that was clicked; one of 'block', 'workspace',\n   * or 'zoom_controls'.\n   */\n  targetType?: ClickTarget;\n  override type = EventType.CLICK;\n\n  /**\n   * @param opt_block The affected block. Null for click events that do not have\n   *     an associated block (i.e. workspace click). Undefined for a blank\n   *     event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Not used if block is passed. Undefined for a blank event.\n   * @param opt_targetType The type of element targeted by this click event.\n   *     Undefined for a blank event.\n   */\n  constructor(\n    opt_block?: Block | null,\n    opt_workspaceId?: string | null,\n    opt_targetType?: ClickTarget,\n  ) {\n    let workspaceId = opt_block ? opt_block.workspace.id : opt_workspaceId;\n    if (workspaceId === null) {\n      workspaceId = undefined;\n    }\n    super(workspaceId);\n\n    this.blockId = opt_block ? opt_block.id : undefined;\n    this.targetType = opt_targetType;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ClickJson {\n    const json = super.toJson() as ClickJson;\n    if (!this.targetType) {\n      throw new Error(\n        'The click target type is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['targetType'] = this.targetType;\n    json['blockId'] = this.blockId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Click, but we can't specify that due to the fact that parameters to\n   *     static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: ClickJson, workspace: Workspace, event?: any): Click {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new Click(),\n    ) as Click;\n    newEvent.targetType = json['targetType'];\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport enum ClickTarget {\n  BLOCK = 'block',\n  WORKSPACE = 'workspace',\n  ZOOM_CONTROLS = 'zoom_controls',\n}\n\nexport interface ClickJson extends AbstractEventJson {\n  targetType: ClickTarget;\n  blockId?: string;\n}\n\nregistry.register(registry.Type.EVENT, EventType.CLICK, Click);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.userAgent\n\n/** The raw useragent string. */\nlet rawUserAgent: string;\n\nlet isJavaFx: boolean;\n\nlet isWebKit: boolean;\n\nlet isGecko: boolean;\n\nlet isAndroid: boolean;\n\nlet isIPad: boolean;\n\nlet isIPhone: boolean;\n\nlet isMac: boolean;\n\nlet isTablet: boolean;\n\nlet isMobile: boolean;\n\n(function (raw) {\n  rawUserAgent = raw;\n  const rawUpper = rawUserAgent.toUpperCase();\n  /**\n   * Case-insensitive test of whether name is in the useragent string.\n   *\n   * @param name Name to test.\n   * @returns True if name is present.\n   */\n  function has(name: string): boolean {\n    return rawUpper.includes(name.toUpperCase());\n  }\n\n  // Browsers.  Logic from:\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/browser.js\n  // Useragent for JavaFX:\n  // Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.44\n  //     (KHTML, like Gecko) JavaFX/8.0 Safari/537.44\n  isJavaFx = has('JavaFX');\n\n  // Engines.  Logic from:\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/engine.js\n  isWebKit = has('WebKit');\n  isGecko = has('Gecko') && !isWebKit;\n\n  // Platforms.  Logic from:\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/platform.js\n  // and\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/extra.js\n  isAndroid = has('Android');\n  const maxTouchPoints =\n    globalThis['navigator'] && globalThis['navigator']['maxTouchPoints'];\n  isIPad = has('iPad') || (has('Macintosh') && maxTouchPoints > 0);\n  isIPhone = has('iPhone') && !isIPad;\n  isMac = has('Macintosh');\n\n  // Devices.  Logic from:\n  // https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/device.js\n  isTablet = isIPad || (isAndroid && !has('Mobile')) || has('Silk');\n  isMobile = !isTablet && (isIPhone || isAndroid);\n})((globalThis['navigator'] && globalThis['navigator']['userAgent']) || '');\n\nexport const raw: string = rawUserAgent;\n\nexport const JavaFx: boolean = isJavaFx;\n\nexport const GECKO: boolean = isGecko;\n\nexport const ANDROID: boolean = isAndroid;\n\nexport const IPAD: boolean = isIPad;\n\nexport const IPHONE: boolean = isIPhone;\n\nexport const MAC: boolean = isMac;\n\nexport const MOBILE: boolean = isMobile;\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Manager for all items registered with the workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ComponentManager\n\nimport type {IAutoHideable} from './interfaces/i_autohideable.js';\nimport type {IComponent} from './interfaces/i_component.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport * as arrayUtils from './utils/array.js';\n\nclass Capability<_T> {\n  static POSITIONABLE = new Capability<IPositionable>('positionable');\n  static DRAG_TARGET = new Capability<IDragTarget>('drag_target');\n  static DELETE_AREA = new Capability<IDeleteArea>('delete_area');\n  static AUTOHIDEABLE = new Capability<IAutoHideable>('autohideable');\n  private readonly name: string;\n  /** @param name The name of the component capability. */\n  constructor(name: string) {\n    this.name = name;\n  }\n\n  /**\n   * Returns the name of the capability.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.name;\n  }\n}\n\n/**\n * Manager for all items registered with the workspace.\n */\nexport class ComponentManager {\n  static Capability = Capability;\n\n  /**\n   * A map of the components registered with the workspace, mapped to id.\n   */\n  private readonly componentData = new Map<string, ComponentDatum>();\n\n  /** A map of capabilities to component IDs. */\n  private readonly capabilityToComponentIds = new Map<string, string[]>();\n\n  /**\n   * Adds a component.\n   *\n   * @param componentInfo The data for the component to register.\n   * @param opt_allowOverrides True to prevent an error when overriding an\n   *     already registered item.\n   */\n  addComponent(componentInfo: ComponentDatum, opt_allowOverrides?: boolean) {\n    // Don't throw an error if opt_allowOverrides is true.\n    const id = componentInfo.component.id;\n    if (!opt_allowOverrides && this.componentData.has(id)) {\n      throw Error(\n        'Plugin \"' +\n          id +\n          '\" with capabilities \"' +\n          this.componentData.get(id)?.capabilities +\n          '\" already added.',\n      );\n    }\n    this.componentData.set(id, componentInfo);\n    const stringCapabilities = [];\n    for (let i = 0; i < componentInfo.capabilities.length; i++) {\n      const capability = String(componentInfo.capabilities[i]).toLowerCase();\n      stringCapabilities.push(capability);\n      if (!this.capabilityToComponentIds.has(capability)) {\n        this.capabilityToComponentIds.set(capability, [id]);\n      } else {\n        this.capabilityToComponentIds.get(capability)?.push(id);\n      }\n    }\n    this.componentData.get(id)!.capabilities = stringCapabilities;\n  }\n\n  /**\n   * Removes a component.\n   *\n   * @param id The ID of the component to remove.\n   */\n  removeComponent(id: string) {\n    const componentInfo = this.componentData.get(id);\n    if (!componentInfo) {\n      return;\n    }\n    for (let i = 0; i < componentInfo.capabilities.length; i++) {\n      const capability = String(componentInfo.capabilities[i]).toLowerCase();\n      arrayUtils.removeElem(this.capabilityToComponentIds.get(capability)!, id);\n    }\n    this.componentData.delete(id);\n  }\n\n  /**\n   * Adds a capability to a existing registered component.\n   *\n   * @param id The ID of the component to add the capability to.\n   * @param capability The capability to add.\n   */\n  addCapability<T>(id: string, capability: string | Capability<T>) {\n    if (!this.getComponent(id)) {\n      throw Error(\n        'Cannot add capability, \"' +\n          capability +\n          '\". Plugin \"' +\n          id +\n          '\" has not been added to the ComponentManager',\n      );\n    }\n    if (this.hasCapability(id, capability)) {\n      console.warn(\n        'Plugin \"' + id + 'already has capability \"' + capability + '\"',\n      );\n      return;\n    }\n    capability = `${capability}`.toLowerCase();\n    this.componentData.get(id)?.capabilities.push(capability);\n    this.capabilityToComponentIds.get(capability)?.push(id);\n  }\n\n  /**\n   * Removes a capability from an existing registered component.\n   *\n   * @param id The ID of the component to remove the capability from.\n   * @param capability The capability to remove.\n   */\n  removeCapability<T>(id: string, capability: string | Capability<T>) {\n    if (!this.getComponent(id)) {\n      throw Error(\n        'Cannot remove capability, \"' +\n          capability +\n          '\". Plugin \"' +\n          id +\n          '\" has not been added to the ComponentManager',\n      );\n    }\n    if (!this.hasCapability(id, capability)) {\n      console.warn(\n        'Plugin \"' +\n          id +\n          'doesn\\'t have capability \"' +\n          capability +\n          '\" to remove',\n      );\n      return;\n    }\n    capability = `${capability}`.toLowerCase();\n    arrayUtils.removeElem(this.componentData.get(id)!.capabilities, capability);\n    arrayUtils.removeElem(this.capabilityToComponentIds.get(capability)!, id);\n  }\n\n  /**\n   * Returns whether the component with this id has the specified capability.\n   *\n   * @param id The ID of the component to check.\n   * @param capability The capability to check for.\n   * @returns Whether the component has the capability.\n   */\n  hasCapability<T>(id: string, capability: string | Capability<T>): boolean {\n    capability = `${capability}`.toLowerCase();\n    return (\n      this.componentData.has(id) &&\n      this.componentData.get(id)!.capabilities.includes(capability)\n    );\n  }\n\n  /**\n   * Gets the component with the given ID.\n   *\n   * @param id The ID of the component to get.\n   * @returns The component with the given name or undefined if not found.\n   */\n  getComponent(id: string): IComponent | undefined {\n    return this.componentData.get(id)?.component;\n  }\n\n  /**\n   * Gets all the components with the specified capability.\n   *\n   * @param capability The capability of the component.\n   * @param sorted Whether to return list ordered by weights.\n   * @returns The components that match the specified capability.\n   */\n  getComponents<T extends IComponent>(\n    capability: string | Capability<T>,\n    sorted: boolean,\n  ): T[] {\n    capability = `${capability}`.toLowerCase();\n    const componentIds = this.capabilityToComponentIds.get(capability);\n    if (!componentIds) {\n      return [];\n    }\n    const components: T[] = [];\n    if (sorted) {\n      const componentDataList: ComponentDatum[] = [];\n      componentIds.forEach((id) => {\n        componentDataList.push(this.componentData.get(id)!);\n      });\n      componentDataList.sort(function (a, b) {\n        return a.weight - b.weight;\n      });\n      componentDataList.forEach(function (componentDatum) {\n        components.push(componentDatum.component as T);\n      });\n    } else {\n      componentIds.forEach((id) => {\n        components.push(this.componentData.get(id)!.component as T);\n      });\n    }\n    return components;\n  }\n}\n\nexport namespace ComponentManager {\n  export enum ComponentWeight {\n    // The toolbox weight is lower (higher precedence) than the flyout, so that\n    // if both are under the pointer, the toolbox takes precedence even though\n    // the flyout's drag target area is large enough to include the toolbox.\n    TOOLBOX_WEIGHT = 0,\n    FLYOUT_WEIGHT = 1,\n    TRASHCAN_WEIGHT = 2,\n    ZOOM_CONTROLS_WEIGHT = 3,\n  }\n\n  /** An object storing component information. */\n  export interface ComponentDatum {\n    component: IComponent;\n    capabilities: Array<string | Capability<IComponent>>;\n    weight: number;\n  }\n}\n\nexport type ComponentWeight = ComponentManager.ComponentWeight;\nexport const ComponentWeight = ComponentManager.ComponentWeight;\nexport type ComponentDatum = ComponentManager.ComponentDatum;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for coordinate manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\n// Former goog.module ID: Blockly.utils.Coordinate\n\n/**\n * Class for representing coordinates and positions.\n */\nexport class Coordinate {\n  /**\n   * @param x Left.\n   * @param y Top.\n   */\n  constructor(\n    public x: number,\n    public y: number,\n  ) {}\n\n  /**\n   * Creates a new copy of this coordinate.\n   *\n   * @returns A copy of this coordinate.\n   */\n  clone(): Coordinate {\n    return new Coordinate(this.x, this.y);\n  }\n\n  /**\n   * Scales this coordinate by the given scale factor.\n   *\n   * @param s The scale factor to use for both x and y dimensions.\n   * @returns This coordinate after scaling.\n   */\n  scale(s: number): Coordinate {\n    this.x *= s;\n    this.y *= s;\n    return this;\n  }\n\n  /**\n   * Translates this coordinate by the given offsets.\n   * respectively.\n   *\n   * @param tx The value to translate x by.\n   * @param ty The value to translate y by.\n   * @returns This coordinate after translating.\n   */\n  translate(tx: number, ty: number): Coordinate {\n    this.x += tx;\n    this.y += ty;\n    return this;\n  }\n\n  /**\n   * Compares coordinates for equality.\n   *\n   * @param a A Coordinate.\n   * @param b A Coordinate.\n   * @returns True iff the coordinates are equal, or if both are null.\n   */\n  static equals(a?: Coordinate | null, b?: Coordinate | null): boolean {\n    if (a === b) {\n      return true;\n    }\n    if (!a || !b) {\n      return false;\n    }\n    return a.x === b.x && a.y === b.y;\n  }\n\n  /**\n   * Returns the distance between two coordinates.\n   *\n   * @param a A Coordinate.\n   * @param b A Coordinate.\n   * @returns The distance between `a` and `b`.\n   */\n  static distance(a: Coordinate, b: Coordinate): number {\n    const dx = a.x - b.x;\n    const dy = a.y - b.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Returns the magnitude of a coordinate.\n   *\n   * @param a A Coordinate.\n   * @returns The distance between the origin and `a`.\n   */\n  static magnitude(a: Coordinate): number {\n    return Math.sqrt(a.x * a.x + a.y * a.y);\n  }\n\n  /**\n   * Returns the difference between two coordinates as a new\n   * Coordinate.\n   *\n   * @param a An x/y coordinate.\n   * @param b An x/y coordinate.\n   * @returns A Coordinate representing the difference between `a` and `b`.\n   */\n  static difference(\n    a: Coordinate | SVGPoint,\n    b: Coordinate | SVGPoint,\n  ): Coordinate {\n    return new Coordinate(a.x - b.x, a.y - b.y);\n  }\n\n  /**\n   * Returns the sum of two coordinates as a new Coordinate.\n   *\n   * @param a An x/y coordinate.\n   * @param b An x/y coordinate.\n   * @returns A Coordinate representing the sum of the two coordinates.\n   */\n  static sum(a: Coordinate | SVGPoint, b: Coordinate | SVGPoint): Coordinate {\n    return new Coordinate(a.x + b.x, a.y + b.y);\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Defines the Svg class. Its constants enumerate\n * all SVG tag names used by Blockly.\n *\n * @class\n */\n// Former goog.module ID: Blockly.utils.Svg\n\n/**\n * A name with the type of the SVG element stored in the generic.\n */\nexport class Svg<_T> {\n  /** @internal */\n  static ANIMATE = new Svg<SVGAnimateElement>('animate');\n  /** @internal */\n  static CIRCLE = new Svg<SVGCircleElement>('circle');\n  /** @internal */\n  static CLIPPATH = new Svg<SVGClipPathElement>('clipPath');\n  /** @internal */\n  static DEFS = new Svg<SVGDefsElement>('defs');\n  /** @internal */\n  static FECOMPOSITE = new Svg<SVGFECompositeElement>('feComposite');\n  /** @internal */\n  static FECOMPONENTTRANSFER = new Svg<SVGFEComponentTransferElement>(\n    'feComponentTransfer',\n  );\n  /** @internal */\n  static FEFLOOD = new Svg<SVGFEFloodElement>('feFlood');\n  /** @internal */\n  static FEFUNCA = new Svg<SVGFEFuncAElement>('feFuncA');\n  /** @internal */\n  static FEGAUSSIANBLUR = new Svg<SVGFEGaussianBlurElement>('feGaussianBlur');\n  /** @internal */\n  static FEPOINTLIGHT = new Svg<SVGFEPointLightElement>('fePointLight');\n  /** @internal */\n  static FESPECULARLIGHTING = new Svg<SVGFESpecularLightingElement>(\n    'feSpecularLighting',\n  );\n  /** @internal */\n  static FILTER = new Svg<SVGFilterElement>('filter');\n  /** @internal */\n  static FOREIGNOBJECT = new Svg<SVGForeignObjectElement>('foreignObject');\n  /** @internal */\n  static G = new Svg<SVGGElement>('g');\n  /** @internal */\n  static IMAGE = new Svg<SVGImageElement>('image');\n  /** @internal */\n  static LINE = new Svg<SVGLineElement>('line');\n  /** @internal */\n  static PATH = new Svg<SVGPathElement>('path');\n  /** @internal */\n  static PATTERN = new Svg<SVGPatternElement>('pattern');\n  /** @internal */\n  static POLYGON = new Svg<SVGPolygonElement>('polygon');\n  /** @internal */\n  static RECT = new Svg<SVGRectElement>('rect');\n  /** @internal */\n  static SVG = new Svg<SVGSVGElement>('svg');\n  /** @internal */\n  static TEXT = new Svg<SVGTextElement>('text');\n  /** @internal */\n  static TSPAN = new Svg<SVGTSpanElement>('tspan');\n\n  /**\n   * @param tagName The SVG element tag name.\n   * @internal\n   */\n  constructor(private readonly tagName: string) {}\n\n  /**\n   * Returns the SVG element tag name.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.tagName;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for rectangle manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\n// Former goog.module ID: Blockly.utils.Rect\n\nimport {Coordinate} from './coordinate.js';\n\n/**\n * Class for representing rectangular regions.\n */\nexport class Rect {\n  /**\n   * @param top Top.\n   * @param bottom Bottom.\n   * @param left Left.\n   * @param right Right.\n   */\n  constructor(\n    public top: number,\n    public bottom: number,\n    public left: number,\n    public right: number,\n  ) {}\n\n  /**\n   * Creates a new copy of this rectangle.\n   *\n   * @returns A copy of this Rect.\n   */\n  clone(): Rect {\n    return new Rect(this.top, this.bottom, this.left, this.right);\n  }\n\n  /** Returns the height of this rectangle. */\n  getHeight(): number {\n    return this.bottom - this.top;\n  }\n\n  /** Returns the width of this rectangle. */\n  getWidth(): number {\n    return this.right - this.left;\n  }\n\n  /**\n   * Tests whether this rectangle contains a x/y coordinate.\n   *\n   * @param x The x coordinate to test for containment.\n   * @param y The y coordinate to test for containment.\n   * @returns Whether this rectangle contains given coordinate.\n   */\n  contains(x: number, y: number): boolean {\n    return (\n      x >= this.left && x <= this.right && y >= this.top && y <= this.bottom\n    );\n  }\n\n  /**\n   * Tests whether this rectangle intersects the provided rectangle.\n   * Assumes that the coordinate system increases going down and left.\n   *\n   * @param other The other rectangle to check for intersection with.\n   * @returns Whether this rectangle intersects the provided rectangle.\n   */\n  intersects(other: Rect): boolean {\n    // The following logic can be derived and then simplified from a longer form symmetrical check\n    // of verifying each rectangle's borders with the other rectangle by checking if either end of\n    // the border's line segment is contained within the other rectangle. The simplified version\n    // used here can be logically interpreted as ensuring that each line segment of 'this' rectangle\n    // is not outside the bounds of the 'other' rectangle (proving there's an intersection).\n    return (\n      this.left <= other.right &&\n      this.right >= other.left &&\n      this.bottom >= other.top &&\n      this.top <= other.bottom\n    );\n  }\n\n  /**\n   * Compares bounding rectangles for equality.\n   *\n   * @param a A Rect.\n   * @param b A Rect.\n   * @returns True iff the bounding rectangles are equal, or if both are null.\n   */\n  static equals(a?: Rect | null, b?: Rect | null): boolean {\n    if (a === b) {\n      return true;\n    }\n    if (!a || !b) {\n      return false;\n    }\n    return (\n      a.top === b.top &&\n      a.bottom === b.bottom &&\n      a.left === b.left &&\n      a.right === b.right\n    );\n  }\n\n  /**\n   * Creates a new Rect using a position and supplied dimensions.\n   *\n   * @param position The upper left coordinate of the new rectangle.\n   * @param width The width of the rectangle, in pixels.\n   * @param height The height of the rectangle, in pixels.\n   * @returns A newly created Rect using the provided Coordinate and dimensions.\n   */\n  static createFromPoint(\n    position: Coordinate,\n    width: number,\n    height: number,\n  ): Rect {\n    const left = position.x;\n    const top = position.y;\n    return new Rect(top, top + height, left, left + width);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for size calculation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\n// Former goog.module ID: Blockly.utils.Size\n\n/**\n * Class for representing sizes consisting of a width and height.\n */\nexport class Size {\n  /**\n   * @param width Width.\n   * @param height Height.\n   */\n  constructor(\n    public width: number,\n    public height: number,\n  ) {}\n\n  /**\n   * Compares sizes for equality.\n   *\n   * @param a A Size.\n   * @param b A Size.\n   * @returns True iff the sizes have equal widths and equal heights, or if both\n   *     are null.\n   */\n  static equals(a?: Size | null, b?: Size | null): boolean {\n    if (a === b) {\n      return true;\n    }\n    if (!a || !b) {\n      return false;\n    }\n    return a.width === b.width && a.height === b.height;\n  }\n\n  /**\n   * Returns a new size with the maximum width and height values out of both\n   * sizes.\n   */\n  static max(a: Size, b: Size): Size {\n    return new Size(Math.max(a.width, b.width), Math.max(a.height, b.height));\n  }\n\n  /**\n   * Returns a new size with the minimum width and height values out of both\n   * sizes.\n   */\n  static min(a: Size, b: Size): Size {\n    return new Size(Math.min(a.width, b.width), Math.min(a.height, b.height));\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a scrollbar.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Scrollbar\n\nimport * as browserEvents from './browser_events.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * A note on units: most of the numbers that are in CSS pixels are scaled if the\n * scrollbar is in a mutator.\n */\n\n/**\n * Class for a pure SVG scrollbar.\n * This technique offers a scrollbar that is guaranteed to work, but may not\n * look or behave like the system's scrollbars.\n */\nexport class Scrollbar {\n  /**\n   * Width of vertical scrollbar or height of horizontal scrollbar in CSS\n   * pixels. Scrollbars should be larger on touch devices.\n   */\n  static scrollbarThickness = Touch.TOUCH_ENABLED ? 25 : 15;\n\n  /**\n   * Default margin around the scrollbar (between the scrollbar and the edge of\n   * the viewport in pixels).\n   *\n   * @internal\n   */\n  static readonly DEFAULT_SCROLLBAR_MARGIN = 0.5;\n\n  /** Whether this scrollbar is part of a pair. */\n  private readonly pair: boolean;\n\n  /**\n   * Margin around the scrollbar (between the scrollbar and the edge of the\n   * viewport in pixels).\n   */\n  private readonly margin: number;\n\n  /** Previously recorded metrics from the workspace. */\n  private oldHostMetrics: Metrics | null = null;\n\n  /**\n   * The ratio of handle position offset to workspace content displacement.\n   *\n   * @internal\n   */\n  ratio = 1;\n\n  /**\n   * The location of the origin of the workspace that the scrollbar is in,\n   * measured in CSS pixels relative to the injection div origin.  This is\n   * usually (0, 0).  When the scrollbar is in a flyout it may have a\n   * different origin.\n   */\n  private origin = new Coordinate(0, 0);\n\n  /**\n   * The position of the mouse along this scrollbar's major axis at the start\n   * of the most recent drag. Units are CSS pixels, with (0, 0) at the top\n   * left of the browser window. For a horizontal scrollbar this is the x\n   * coordinate of the mouse down event; for a vertical scrollbar it's the y\n   * coordinate of the mouse down event.\n   */\n  private startDragMouse = 0;\n\n  /**\n   * The length of the scrollbars (including the handle and the background),\n   * in CSS pixels. This is equivalent to scrollbar background length and the\n   * area within which the scrollbar handle can move.\n   */\n  private scrollbarLength = 0;\n\n  /** The length of the scrollbar handle in CSS pixels. */\n  private handleLength = 0;\n\n  /**\n   * The offset of the start of the handle from the scrollbar position, in CSS\n   * pixels.\n   */\n  private handlePosition = 0;\n\n  private startDragHandle = 0;\n\n  /** Whether the scrollbar handle is visible. */\n  private isHandleVisible = true;\n\n  /** Whether the workspace containing this scrollbar is visible. */\n  private containerVisible = true;\n\n  /** The transparent background behind the handle. */\n  private svgBackground: SVGRectElement;\n\n  /** The visible handle that can be dragged around. */\n  private svgHandle: SVGRectElement;\n\n  /** The outermost SVG element, which contains all parts of the scrollbar. */\n  private outerSvg: SVGSVGElement;\n\n  /**\n   * The upper left corner of the scrollbar's SVG group in CSS pixels relative\n   * to the scrollbar's origin.  This is usually relative to the injection div\n   * origin.\n   *\n   * @internal\n   */\n  position = new Coordinate(0, 0);\n\n  /**\n   * The DOM attribute that controls the length of the scrollbar. Different\n   * for horizontal and vertical scrollbars.\n   */\n  lengthAttribute_: string;\n\n  /**\n   * The DOM attribute that controls the position of the scrollbar.\n   * Different for horizontal and vertical scrollbars.\n   */\n  positionAttribute_: string;\n\n  /** Handler for mouse down events on the background of the scrollbar. */\n  onMouseDownBarWrapper_: browserEvents.Data;\n\n  /** Handler for mouse down events on the handle of the scrollbar. */\n  onMouseDownHandleWrapper_: browserEvents.Data;\n\n  /** Handler for mouse move events during scrollbar drags. */\n  onMouseUpWrapper_: browserEvents.Data | null = null;\n\n  /** Handler for mouse up events to end scrollbar drags. */\n  onMouseMoveWrapper_: browserEvents.Data | null = null;\n\n  /**\n   * @param workspace Workspace to bind the scrollbar to.\n   * @param horizontal True if horizontal, false if vertical.\n   * @param opt_pair True if scrollbar is part of a horiz/vert pair.\n   * @param opt_class A class to be applied to this scrollbar.\n   * @param opt_margin The margin to apply to this scrollbar.\n   */\n  constructor(\n    private workspace: WorkspaceSvg,\n    private readonly horizontal: boolean,\n    opt_pair?: boolean,\n    opt_class?: string,\n    opt_margin?: number,\n  ) {\n    this.pair = opt_pair || false;\n\n    this.margin =\n      opt_margin !== undefined\n        ? opt_margin\n        : Scrollbar.DEFAULT_SCROLLBAR_MARGIN;\n\n    let className =\n      'blocklyScrollbar' + (this.horizontal ? 'Horizontal' : 'Vertical');\n    if (opt_class) {\n      className += ' ' + opt_class;\n    }\n\n    /* Create the following DOM:\n      <svg class=\"blocklyScrollbarHorizontal optionalClass\">\n        <g>\n          <rect class=\"blocklyScrollbarBackground\" />\n          <rect class=\"blocklyScrollbarHandle\" rx=\"8\" ry=\"8\" />\n        </g>\n      </svg>\n    */\n    this.outerSvg = dom.createSvgElement(Svg.SVG, {'class': className});\n    // Child group to hold the handle and background together.\n    const group = dom.createSvgElement(Svg.G, {}, this.outerSvg);\n\n    this.svgBackground = dom.createSvgElement(\n      Svg.RECT,\n      {'class': 'blocklyScrollbarBackground'},\n      group,\n    );\n\n    const radius = Math.floor((Scrollbar.scrollbarThickness - 5) / 2);\n    this.svgHandle = dom.createSvgElement(\n      Svg.RECT,\n      {'class': 'blocklyScrollbarHandle', 'rx': radius, 'ry': radius},\n      group,\n    );\n\n    this.workspace\n      .getThemeManager()\n      .subscribe(this.svgHandle, 'scrollbarColour', 'fill');\n    this.workspace\n      .getThemeManager()\n      .subscribe(this.svgHandle, 'scrollbarOpacity', 'fill-opacity');\n\n    // Add everything to the DOM.\n    dom.insertAfter(this.outerSvg, this.workspace.getParentSvg());\n\n    this.setInitialThickness();\n\n    if (horizontal) {\n      this.lengthAttribute_ = 'width';\n      this.positionAttribute_ = 'x';\n    } else {\n      this.lengthAttribute_ = 'height';\n      this.positionAttribute_ = 'y';\n    }\n\n    this.onMouseDownBarWrapper_ = browserEvents.conditionalBind(\n      this.svgBackground,\n      'pointerdown',\n      this,\n      this.onMouseDownBar,\n    );\n    this.onMouseDownHandleWrapper_ = browserEvents.conditionalBind(\n      this.svgHandle,\n      'pointerdown',\n      this,\n      this.onMouseDownHandle,\n    );\n  }\n\n  /**\n   * Set the size of the scrollbar DOM elements along the minor axis.\n   */\n  private setInitialThickness() {\n    const scrollbarThickness = Scrollbar.scrollbarThickness;\n    if (this.horizontal) {\n      this.svgBackground.setAttribute('height', String(scrollbarThickness));\n      this.outerSvg.setAttribute('height', String(scrollbarThickness));\n      this.svgHandle.setAttribute('height', String(scrollbarThickness - 5));\n      this.svgHandle.setAttribute('y', '2.5');\n    } else {\n      this.svgBackground.setAttribute('width', String(scrollbarThickness));\n      this.outerSvg.setAttribute('width', String(scrollbarThickness));\n      this.svgHandle.setAttribute('width', String(scrollbarThickness - 5));\n      this.svgHandle.setAttribute('x', '2.5');\n    }\n  }\n\n  /**\n   * Dispose of this scrollbar. Remove DOM elements, event listeners,\n   * and theme subscriptions.\n   */\n  dispose() {\n    this.cleanUp();\n    browserEvents.unbind(this.onMouseDownBarWrapper_);\n    browserEvents.unbind(this.onMouseDownHandleWrapper_);\n\n    dom.removeNode(this.outerSvg);\n    this.workspace.getThemeManager().unsubscribe(this.svgHandle);\n  }\n\n  /**\n   * Constrain the handle's length within the minimum (0) and maximum\n   * (scrollbar background) values allowed for the scrollbar.\n   *\n   * @param value Value that is potentially out of bounds, in CSS pixels.\n   * @returns Constrained value, in CSS pixels.\n   */\n  private constrainHandleLength(value: number): number {\n    if (value <= 0 || isNaN(value)) {\n      value = 0;\n    } else {\n      value = Math.min(value, this.scrollbarLength);\n    }\n    return value;\n  }\n\n  /**\n   * Set the length of the scrollbar's handle and change the SVG attribute\n   * accordingly.\n   *\n   * @param newLength The new scrollbar handle length in CSS pixels.\n   */\n  private setHandleLength(newLength: number) {\n    this.handleLength = newLength;\n    this.svgHandle.setAttribute(\n      this.lengthAttribute_,\n      String(this.handleLength),\n    );\n  }\n\n  /**\n   * Constrain the handle's position within the minimum (0) and maximum values\n   * allowed for the scrollbar.\n   *\n   * @param value Value that is potentially out of bounds, in CSS pixels.\n   * @returns Constrained value, in CSS pixels.\n   */\n  private constrainHandlePosition(value: number): number {\n    if (value <= 0 || isNaN(value)) {\n      value = 0;\n    } else {\n      // Handle length should never be greater than this.scrollbarLength_.\n      // If the viewSize is greater than or equal to the scrollSize, the\n      // handleLength will end up equal to this.scrollbarLength_.\n      value = Math.min(value, this.scrollbarLength - this.handleLength);\n    }\n    return value;\n  }\n\n  /**\n   * Set the offset of the scrollbar's handle from the scrollbar's position, and\n   * change the SVG attribute accordingly.\n   *\n   * @param newPosition The new scrollbar handle offset in CSS pixels.\n   */\n  setHandlePosition(newPosition: number) {\n    this.handlePosition = newPosition;\n    this.svgHandle.setAttribute(\n      this.positionAttribute_,\n      String(this.handlePosition),\n    );\n  }\n\n  /**\n   * Set the size of the scrollbar's background and change the SVG attribute\n   * accordingly.\n   *\n   * @param newSize The new scrollbar background length in CSS pixels.\n   */\n  private setScrollbarLength(newSize: number) {\n    this.scrollbarLength = newSize;\n    this.outerSvg.setAttribute(\n      this.lengthAttribute_,\n      String(this.scrollbarLength),\n    );\n    this.svgBackground.setAttribute(\n      this.lengthAttribute_,\n      String(this.scrollbarLength),\n    );\n  }\n\n  /**\n   * Set the position of the scrollbar's SVG group in CSS pixels relative to the\n   * scrollbar's origin.  This sets the scrollbar's location within the\n   * workspace.\n   *\n   * @param x The new x coordinate.\n   * @param y The new y coordinate.\n   * @internal\n   */\n  setPosition(x: number, y: number) {\n    this.position.x = x;\n    this.position.y = y;\n\n    const tempX = this.position.x + this.origin.x;\n    const tempY = this.position.y + this.origin.y;\n    const transform = 'translate(' + tempX + 'px,' + tempY + 'px)';\n    dom.setCssTransform(this.outerSvg, transform);\n  }\n\n  /**\n   * Recalculate the scrollbar's location and its length.\n   *\n   * @param opt_metrics A data structure of from the describing all the required\n   *     dimensions.  If not provided, it will be fetched from the host object.\n   */\n  resize(opt_metrics?: Metrics) {\n    // Determine the location, height and width of the host element.\n    let hostMetrics = opt_metrics;\n    if (!hostMetrics) {\n      hostMetrics = this.workspace.getMetrics();\n      if (!hostMetrics) {\n        // Host element is likely not visible.\n        return;\n      }\n    }\n\n    if (\n      this.oldHostMetrics &&\n      Scrollbar.metricsAreEquivalent(hostMetrics, this.oldHostMetrics)\n    ) {\n      return;\n    }\n\n    if (this.horizontal) {\n      this.resizeHorizontal(hostMetrics);\n    } else {\n      this.resizeVertical(hostMetrics);\n    }\n\n    this.oldHostMetrics = hostMetrics;\n\n    // Resizing may have caused some scrolling.\n    this.updateMetrics();\n  }\n\n  /**\n   * Returns whether the a resizeView is necessary by comparing the passed\n   * hostMetrics with cached old host metrics.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   * @returns Whether a resizeView is necessary.\n   */\n  private requiresViewResize(hostMetrics: Metrics): boolean {\n    if (!this.oldHostMetrics) {\n      return true;\n    }\n    return (\n      this.oldHostMetrics.viewWidth !== hostMetrics.viewWidth ||\n      this.oldHostMetrics.viewHeight !== hostMetrics.viewHeight ||\n      this.oldHostMetrics.absoluteLeft !== hostMetrics.absoluteLeft ||\n      this.oldHostMetrics.absoluteTop !== hostMetrics.absoluteTop\n    );\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location and length.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  private resizeHorizontal(hostMetrics: Metrics) {\n    if (this.requiresViewResize(hostMetrics)) {\n      this.resizeViewHorizontal(hostMetrics);\n    } else {\n      this.resizeContentHorizontal(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location on the screen and path\n   * length. This should be called when the layout or size of the window has\n   * changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeViewHorizontal(hostMetrics: Metrics) {\n    let viewSize = hostMetrics.viewWidth - this.margin * 2;\n    if (this.pair) {\n      // Shorten the scrollbar to make room for the corner square.\n      viewSize -= Scrollbar.scrollbarThickness;\n    }\n    this.setScrollbarLength(Math.max(0, viewSize));\n\n    let xCoordinate = hostMetrics.absoluteLeft + this.margin;\n    if (this.pair && this.workspace.RTL) {\n      xCoordinate += Scrollbar.scrollbarThickness;\n    }\n\n    // Horizontal toolbar should always be just above the bottom of the\n    // workspace.\n    const yCoordinate =\n      hostMetrics.absoluteTop +\n      hostMetrics.viewHeight -\n      Scrollbar.scrollbarThickness -\n      this.margin;\n    this.setPosition(xCoordinate, yCoordinate);\n\n    // If the view has been resized, a content resize will also be necessary.\n    // The reverse is not true.\n    this.resizeContentHorizontal(hostMetrics);\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location within its path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContentHorizontal(hostMetrics: Metrics) {\n    if (hostMetrics.viewWidth >= hostMetrics.scrollWidth) {\n      // viewWidth is often greater than scrollWidth in flyouts and\n      // non-scrollable workspaces.\n      this.setHandleLength(this.scrollbarLength);\n      this.setHandlePosition(0);\n      if (!this.pair) {\n        // The scrollbar isn't needed.\n        // This doesn't apply to scrollbar pairs because interactions with the\n        // corner square aren't handled.\n        this.setVisible(false);\n      }\n      return;\n    } else if (!this.pair) {\n      // The scrollbar is needed. Only non-paired scrollbars are hidden/shown.\n      this.setVisible(true);\n    }\n\n    // Resize the handle.\n    let handleLength =\n      (this.scrollbarLength * hostMetrics.viewWidth) / hostMetrics.scrollWidth;\n    handleLength = this.constrainHandleLength(handleLength);\n    this.setHandleLength(handleLength);\n\n    // Compute the handle offset.\n    // The position of the handle can be between:\n    //     0 and this.scrollbarLength_ - handleLength\n    // If viewLeft === scrollLeft\n    //     then the offset should be 0\n    // If viewRight === scrollRight\n    //     then viewLeft = scrollLeft + scrollWidth - viewWidth\n    //     then the offset should be max offset\n\n    const maxScrollDistance = hostMetrics.scrollWidth - hostMetrics.viewWidth;\n    const contentDisplacement = hostMetrics.viewLeft - hostMetrics.scrollLeft;\n    // Percent of content to the left of our current position.\n    const offsetRatio = contentDisplacement / maxScrollDistance;\n    // Area available to scroll * percent to the left\n    const maxHandleOffset = this.scrollbarLength - this.handleLength;\n    let handleOffset = maxHandleOffset * offsetRatio;\n    handleOffset = this.constrainHandlePosition(handleOffset);\n    this.setHandlePosition(handleOffset);\n\n    // Compute ratio (for use with set calls, which pass in content\n    // displacement).\n    this.ratio = maxHandleOffset / maxScrollDistance;\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location and length.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  private resizeVertical(hostMetrics: Metrics) {\n    if (this.requiresViewResize(hostMetrics)) {\n      this.resizeViewVertical(hostMetrics);\n    } else {\n      this.resizeContentVertical(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location on the screen and path length.\n   * This should be called when the layout or size of the window has changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeViewVertical(hostMetrics: Metrics) {\n    let viewSize = hostMetrics.viewHeight - this.margin * 2;\n    if (this.pair) {\n      // Shorten the scrollbar to make room for the corner square.\n      viewSize -= Scrollbar.scrollbarThickness;\n    }\n    this.setScrollbarLength(Math.max(0, viewSize));\n\n    const xCoordinate = this.workspace.RTL\n      ? hostMetrics.absoluteLeft + this.margin\n      : hostMetrics.absoluteLeft +\n        hostMetrics.viewWidth -\n        Scrollbar.scrollbarThickness -\n        this.margin;\n\n    const yCoordinate = hostMetrics.absoluteTop + this.margin;\n    this.setPosition(xCoordinate, yCoordinate);\n\n    // If the view has been resized, a content resize will also be necessary.\n    // The reverse is not true.\n    this.resizeContentVertical(hostMetrics);\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location within its path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContentVertical(hostMetrics: Metrics) {\n    if (hostMetrics.viewHeight >= hostMetrics.scrollHeight) {\n      // viewHeight is often greater than scrollHeight in flyouts and\n      // non-scrollable workspaces.\n      this.setHandleLength(this.scrollbarLength);\n      this.setHandlePosition(0);\n      if (!this.pair) {\n        // The scrollbar isn't needed.\n        // This doesn't apply to scrollbar pairs because interactions with the\n        // corner square aren't handled.\n        this.setVisible(false);\n      }\n      return;\n    } else if (!this.pair) {\n      // The scrollbar is needed. Only non-paired scrollbars are hidden/shown.\n      this.setVisible(true);\n    }\n\n    // Resize the handle.\n    let handleLength =\n      (this.scrollbarLength * hostMetrics.viewHeight) /\n      hostMetrics.scrollHeight;\n    handleLength = this.constrainHandleLength(handleLength);\n    this.setHandleLength(handleLength);\n\n    // Compute the handle offset.\n    // The position of the handle can be between:\n    //     0 and this.scrollbarLength_ - handleLength\n    // If viewTop === scrollTop\n    //     then the offset should be 0\n    // If viewBottom === scrollBottom\n    //     then viewTop = scrollTop + scrollHeight - viewHeight\n    //     then the offset should be max offset\n\n    const maxScrollDistance = hostMetrics.scrollHeight - hostMetrics.viewHeight;\n    const contentDisplacement = hostMetrics.viewTop - hostMetrics.scrollTop;\n    // Percent of content to the left of our current position.\n    const offsetRatio = contentDisplacement / maxScrollDistance;\n    // Area available to scroll * percent to the left\n    const maxHandleOffset = this.scrollbarLength - this.handleLength;\n    let handleOffset = maxHandleOffset * offsetRatio;\n    handleOffset = this.constrainHandlePosition(handleOffset);\n    this.setHandlePosition(handleOffset);\n\n    // Compute ratio (for use with set calls, which pass in content\n    // displacement).\n    this.ratio = maxHandleOffset / maxScrollDistance;\n  }\n\n  /**\n   * Is the scrollbar visible.  Non-paired scrollbars disappear when they aren't\n   * needed.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.isHandleVisible;\n  }\n\n  /**\n   * Set whether the scrollbar's container is visible and update\n   * display accordingly if visibility has changed.\n   *\n   * @param visible Whether the container is visible\n   */\n  setContainerVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.containerVisible;\n\n    this.containerVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Set whether the scrollbar is visible.\n   * Only applies to non-paired scrollbars.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    // Ideally this would also apply to scrollbar pairs, but that's a bigger\n    // headache (due to interactions with the corner square), and the fact\n    // that telling the pair to resize itself would cause circular dependencies.\n    if (this.pair) {\n      throw Error('Unable to toggle visibility of paired scrollbars.');\n    }\n    this.setVisibleInternal(visible);\n  }\n\n  /**\n   * Set whether the scrollbar is visible. Bypasses checking whether this\n   * scrollbar is part of a pair so that it can be toggled by the scrollbar\n   * pair.\n   *\n   * @param visible True if visible.\n   * @internal\n   */\n  setVisibleInternal(visible: boolean) {\n    const visibilityChanged = visible !== this.isVisible();\n    this.isHandleVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Update visibility of scrollbar based on whether it thinks it should\n   * be visible and whether its containing workspace is visible.\n   * We cannot rely on the containing workspace being hidden to hide us\n   * because it is not necessarily our parent in the DOM.\n   */\n  updateDisplay_() {\n    let show = true;\n    // Check whether our parent/container is visible.\n    if (!this.containerVisible) {\n      show = false;\n    } else {\n      show = this.isVisible();\n    }\n    if (show) {\n      this.outerSvg.setAttribute('display', 'block');\n    } else {\n      this.outerSvg.setAttribute('display', 'none');\n    }\n  }\n\n  /**\n   * Scroll by one pageful.\n   * Called when scrollbar background is clicked.\n   *\n   * @param e Mouse down event.\n   */\n  private onMouseDownBar(e: MouseEvent) {\n    this.workspace.markFocused();\n    Touch.clearTouchIdentifier(); // This is really a click.\n    this.cleanUp();\n    if (browserEvents.isRightButton(e)) {\n      // Right-click.\n      // Scrollbars have no context menu.\n      e.stopPropagation();\n      return;\n    }\n    const mouseXY = browserEvents.mouseToSvg(\n      e,\n      this.workspace.getParentSvg(),\n      this.workspace.getInverseScreenCTM(),\n    );\n    const mouseLocation = this.horizontal ? mouseXY.x : mouseXY.y;\n\n    const handleXY = svgMath.getInjectionDivXY(this.svgHandle);\n    const handleStart = this.horizontal ? handleXY.x : handleXY.y;\n    let handlePosition = this.handlePosition;\n\n    const pageLength = this.handleLength * 0.95;\n    if (mouseLocation <= handleStart) {\n      // Decrease the scrollbar's value by a page.\n      handlePosition -= pageLength;\n    } else if (mouseLocation >= handleStart + this.handleLength) {\n      // Increase the scrollbar's value by a page.\n      handlePosition += pageLength;\n    }\n\n    this.setHandlePosition(this.constrainHandlePosition(handlePosition));\n\n    this.updateMetrics();\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  /**\n   * Start a dragging operation.\n   * Called when scrollbar handle is clicked.\n   *\n   * @param e Mouse down event.\n   */\n  private onMouseDownHandle(e: PointerEvent) {\n    this.workspace.markFocused();\n    this.cleanUp();\n    if (browserEvents.isRightButton(e)) {\n      // Right-click.\n      // Scrollbars have no context menu.\n      e.stopPropagation();\n      return;\n    }\n    // Look up the current translation and record it.\n    this.startDragHandle = this.handlePosition;\n\n    // Record the current mouse position.\n    this.startDragMouse = this.horizontal ? e.clientX : e.clientY;\n    this.onMouseUpWrapper_ = browserEvents.conditionalBind(\n      document,\n      'pointerup',\n      this,\n      this.onMouseUpHandle,\n    );\n    this.onMouseMoveWrapper_ = browserEvents.conditionalBind(\n      document,\n      'pointermove',\n      this,\n      this.onMouseMoveHandle,\n    );\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  /**\n   * Drag the scrollbar's handle.\n   *\n   * @param e Mouse move event.\n   */\n  private onMouseMoveHandle(e: PointerEvent) {\n    const currentMouse = this.horizontal ? e.clientX : e.clientY;\n    const mouseDelta = currentMouse - this.startDragMouse;\n    const handlePosition = this.startDragHandle + mouseDelta;\n    // Position the bar.\n    this.setHandlePosition(this.constrainHandlePosition(handlePosition));\n    this.updateMetrics();\n  }\n\n  /** Release the scrollbar handle and reset state accordingly. */\n  private onMouseUpHandle() {\n    Touch.clearTouchIdentifier();\n    this.cleanUp();\n  }\n\n  /**\n   * Hide chaff and stop binding to mouseup and mousemove events.  Call this to\n   * wrap up loose ends associated with the scrollbar.\n   */\n  private cleanUp() {\n    this.workspace.hideChaff(true);\n    if (this.onMouseUpWrapper_) {\n      browserEvents.unbind(this.onMouseUpWrapper_);\n      this.onMouseUpWrapper_ = null;\n    }\n    if (this.onMouseMoveWrapper_) {\n      browserEvents.unbind(this.onMouseMoveWrapper_);\n      this.onMouseMoveWrapper_ = null;\n    }\n  }\n\n  /**\n   * Helper to calculate the ratio of handle position to scrollbar view size.\n   *\n   * @returns Ratio.\n   * @internal\n   */\n  getRatio_(): number {\n    const scrollHandleRange = this.scrollbarLength - this.handleLength;\n    let ratio = this.handlePosition / scrollHandleRange;\n    if (isNaN(ratio)) {\n      ratio = 0;\n    }\n    return ratio;\n  }\n\n  /**\n   * Updates workspace metrics based on new scroll ratio. Called when scrollbar\n   * is moved.\n   */\n  private updateMetrics() {\n    const ratio = this.getRatio_();\n    if (this.horizontal) {\n      this.workspace.setMetrics({x: ratio});\n    } else {\n      this.workspace.setMetrics({y: ratio});\n    }\n  }\n\n  /**\n   * Set the scrollbar handle's position.\n   *\n   * @param value The content displacement, relative to the view in pixels.\n   * @param updateMetrics Whether to update metrics on this set call.\n   *    Defaults to true.\n   */\n  set(value: number, updateMetrics?: boolean) {\n    this.setHandlePosition(this.constrainHandlePosition(value * this.ratio));\n    if (updateMetrics || updateMetrics === undefined) {\n      this.updateMetrics();\n    }\n  }\n\n  /**\n   * Record the origin of the workspace that the scrollbar is in, in pixels\n   * relative to the injection div origin. This is for times when the scrollbar\n   * is used in an object whose origin isn't the same as the main workspace\n   * (e.g. in a flyout.)\n   *\n   * @param x The x coordinate of the scrollbar's origin, in CSS pixels.\n   * @param y The y coordinate of the scrollbar's origin, in CSS pixels.\n   */\n  setOrigin(x: number, y: number) {\n    this.origin = new Coordinate(x, y);\n  }\n\n  /**\n   * @param first An object containing computed measurements of a workspace.\n   * @param second Another object containing computed measurements of a\n   *     workspace.\n   * @returns Whether the two sets of metrics are equivalent.\n   */\n  private static metricsAreEquivalent(\n    first: Metrics,\n    second: Metrics,\n  ): boolean {\n    return (\n      first.viewWidth === second.viewWidth &&\n      first.viewHeight === second.viewHeight &&\n      first.viewLeft === second.viewLeft &&\n      first.viewTop === second.viewTop &&\n      first.absoluteTop === second.absoluteTop &&\n      first.absoluteLeft === second.absoluteLeft &&\n      first.scrollWidth === second.scrollWidth &&\n      first.scrollHeight === second.scrollHeight &&\n      first.scrollLeft === second.scrollLeft &&\n      first.scrollTop === second.scrollTop\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Contains the path to a single png tat holds the images for the trashcan\n * as well as the zoom controls.\n */\nexport const SPRITE = {\n  width: 96,\n  height: 124,\n  url: 'sprites.png',\n};\n", "/**\n * @license\n * Copyright 2015 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a zoom icons.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ZoomControls\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_click.js';\n\nimport * as browserEvents from './browser_events.js';\nimport {ComponentManager} from './component_manager.js';\nimport * as Css from './css.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport type {UiMetrics} from './metrics_manager.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport {SPRITE} from './sprites.js';\nimport * as Touch from './touch.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a zoom controls.\n */\nexport class ZoomControls implements IPositionable {\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  id = 'zoomControls';\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /** The zoom in svg <g> element. */\n  private zoomInGroup: SVGGElement | null = null;\n\n  /** The zoom out svg <g> element. */\n  private zoomOutGroup: SVGGElement | null = null;\n\n  /** The zoom reset svg <g> element. */\n  private zoomResetGroup: SVGGElement | null = null;\n\n  /** Width of the zoom controls. */\n  private readonly WIDTH = 32;\n\n  /** Height of each zoom control. */\n  private readonly HEIGHT = 32;\n\n  /** Small spacing used between the zoom in and out control, in pixels. */\n  private readonly SMALL_SPACING = 2;\n\n  /**\n   * Large spacing used between the zoom in and reset control, in pixels.\n   */\n  private readonly LARGE_SPACING = 11;\n\n  /** Distance between zoom controls and bottom or top edge of workspace. */\n  private readonly MARGIN_VERTICAL = 20;\n\n  /** Distance between zoom controls and right or left edge of workspace. */\n  private readonly MARGIN_HORIZONTAL = 20;\n\n  /** The SVG group containing the zoom controls. */\n  private svgGroup: SVGElement | null = null;\n\n  /** Left coordinate of the zoom controls. */\n  private left = 0;\n\n  /** Top coordinate of the zoom controls. */\n  private top = 0;\n\n  /** Whether this has been initialized. */\n  private initialized = false;\n\n  /** @param workspace The workspace to sit in. */\n  constructor(private readonly workspace: WorkspaceSvg) {}\n\n  /**\n   * Create the zoom controls.\n   *\n   * @returns The zoom controls SVG group.\n   */\n  createDom(): SVGElement {\n    this.svgGroup = dom.createSvgElement(Svg.G, {});\n\n    // Each filter/pattern needs a unique ID for the case of multiple Blockly\n    // instances on a page.  Browser behaviour becomes undefined otherwise.\n    // https://neil.fraser.name/news/2015/11/01/\n    const rnd = String(Math.random()).substring(2);\n    this.createZoomOutSvg(rnd);\n    this.createZoomInSvg(rnd);\n    if (this.workspace.isMovable()) {\n      // If we zoom to the center and the workspace isn't movable we could\n      // loose blocks at the edges of the workspace.\n      this.createZoomResetSvg(rnd);\n    }\n    return this.svgGroup;\n  }\n\n  /** Initializes the zoom controls. */\n  init() {\n    this.workspace.getComponentManager().addComponent({\n      component: this,\n      weight: ComponentManager.ComponentWeight.ZOOM_CONTROLS_WEIGHT,\n      capabilities: [ComponentManager.Capability.POSITIONABLE],\n    });\n    this.initialized = true;\n  }\n\n  /**\n   * Disposes of this zoom controls.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.workspace.getComponentManager().removeComponent('zoomControls');\n    if (this.svgGroup) {\n      dom.removeNode(this.svgGroup);\n    }\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n  }\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect | null {\n    let height = this.SMALL_SPACING + 2 * this.HEIGHT;\n    if (this.zoomResetGroup) {\n      height += this.LARGE_SPACING + this.HEIGHT;\n    }\n    const bottom = this.top + height;\n    const right = this.left + this.WIDTH;\n    return new Rect(this.top, bottom, this.left, right);\n  }\n\n  /**\n   * Positions the zoom controls.\n   * It is positioned in the opposite corner to the corner the\n   * categories/toolbox starts at.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]) {\n    // Not yet initialized.\n    if (!this.initialized) {\n      return;\n    }\n\n    const cornerPosition = uiPosition.getCornerOppositeToolbox(\n      this.workspace,\n      metrics,\n    );\n    let height = this.SMALL_SPACING + 2 * this.HEIGHT;\n    if (this.zoomResetGroup) {\n      height += this.LARGE_SPACING + this.HEIGHT;\n    }\n    const startRect = uiPosition.getStartPositionRect(\n      cornerPosition,\n      new Size(this.WIDTH, height),\n      this.MARGIN_HORIZONTAL,\n      this.MARGIN_VERTICAL,\n      metrics,\n      this.workspace,\n    );\n\n    const verticalPosition = cornerPosition.vertical;\n    const bumpDirection =\n      verticalPosition === uiPosition.verticalPosition.TOP\n        ? uiPosition.bumpDirection.DOWN\n        : uiPosition.bumpDirection.UP;\n    const positionRect = uiPosition.bumpPositionRect(\n      startRect,\n      this.MARGIN_VERTICAL,\n      bumpDirection,\n      savedPositions,\n    );\n\n    if (verticalPosition === uiPosition.verticalPosition.TOP) {\n      const zoomInTranslateY = this.SMALL_SPACING + this.HEIGHT;\n      this.zoomInGroup?.setAttribute(\n        'transform',\n        'translate(0, ' + zoomInTranslateY + ')',\n      );\n      if (this.zoomResetGroup) {\n        const zoomResetTranslateY =\n          zoomInTranslateY + this.LARGE_SPACING + this.HEIGHT;\n        this.zoomResetGroup.setAttribute(\n          'transform',\n          'translate(0, ' + zoomResetTranslateY + ')',\n        );\n      }\n    } else {\n      const zoomInTranslateY = this.zoomResetGroup\n        ? this.LARGE_SPACING + this.HEIGHT\n        : 0;\n      this.zoomInGroup?.setAttribute(\n        'transform',\n        'translate(0, ' + zoomInTranslateY + ')',\n      );\n      const zoomOutTranslateY =\n        zoomInTranslateY + this.SMALL_SPACING + this.HEIGHT;\n      this.zoomOutGroup?.setAttribute(\n        'transform',\n        'translate(0, ' + zoomOutTranslateY + ')',\n      );\n    }\n\n    this.top = positionRect.top;\n    this.left = positionRect.left;\n    this.svgGroup?.setAttribute(\n      'transform',\n      'translate(' + this.left + ',' + this.top + ')',\n    );\n  }\n\n  /**\n   * Create the zoom in icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomOutSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoomoutClipPath837493\">\n            <rect width=\"32\" height=\"32></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-64\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoomoutClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomOutGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': 'blocklyZoom blocklyZoomOut'},\n      this.svgGroup,\n    );\n    const clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyZoomoutClipPath' + rnd},\n      this.zoomOutGroup,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'width': 32,\n        'height': 32,\n      },\n      clip,\n    );\n    const zoomoutSvg = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'height': SPRITE.height,\n        'x': -64,\n        'y': -92,\n        'clip-path': 'url(#blocklyZoomoutClipPath' + rnd + ')',\n      },\n      this.zoomOutGroup,\n    );\n    zoomoutSvg.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    // Attach listener.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.zoomOutGroup,\n        'pointerdown',\n        null,\n        this.zoom.bind(this, -1),\n      ),\n    );\n  }\n\n  /**\n   * Create the zoom out icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomInSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoominClipPath837493\">\n            <rect width=\"32\" height=\"32\"></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-32\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoominClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomInGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': 'blocklyZoom blocklyZoomIn'},\n      this.svgGroup,\n    );\n    const clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyZoominClipPath' + rnd},\n      this.zoomInGroup,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'width': 32,\n        'height': 32,\n      },\n      clip,\n    );\n    const zoominSvg = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'height': SPRITE.height,\n        'x': -32,\n        'y': -92,\n        'clip-path': 'url(#blocklyZoominClipPath' + rnd + ')',\n      },\n      this.zoomInGroup,\n    );\n    zoominSvg.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    // Attach listener.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.zoomInGroup,\n        'pointerdown',\n        null,\n        this.zoom.bind(this, 1),\n      ),\n    );\n  }\n\n  /**\n   * Handles a mouse down event on the zoom in or zoom out buttons on the\n   *    workspace.\n   *\n   * @param amount Amount of zooming. Negative amount values zoom out, and\n   *     positive amount values zoom in.\n   * @param e A mouse down event.\n   */\n  private zoom(amount: number, e: PointerEvent) {\n    this.workspace.markFocused();\n    this.workspace.zoomCenter(amount);\n    this.fireZoomEvent();\n    Touch.clearTouchIdentifier(); // Don't block future drags.\n    e.stopPropagation(); // Don't start a workspace scroll.\n    e.preventDefault(); // Stop double-clicking from selecting text.\n  }\n\n  /**\n   * Create the zoom reset icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomResetSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoomresetClipPath837493\">\n            <rect width=\"32\" height=\"32\"></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-32\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoomresetClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomResetGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': 'blocklyZoom blocklyZoomReset'},\n      this.svgGroup,\n    );\n    const clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyZoomresetClipPath' + rnd},\n      this.zoomResetGroup,\n    );\n    dom.createSvgElement(Svg.RECT, {'width': 32, 'height': 32}, clip);\n    const zoomresetSvg = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'height': SPRITE.height,\n        'y': -92,\n        'clip-path': 'url(#blocklyZoomresetClipPath' + rnd + ')',\n      },\n      this.zoomResetGroup,\n    );\n    zoomresetSvg.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    // Attach event listeners.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.zoomResetGroup,\n        'pointerdown',\n        null,\n        this.resetZoom.bind(this),\n      ),\n    );\n  }\n\n  /**\n   * Handles a mouse down event on the reset zoom button on the workspace.\n   *\n   * @param e A mouse down event.\n   */\n  private resetZoom(e: PointerEvent) {\n    this.workspace.markFocused();\n\n    // zoom is passed amount and computes the new scale using the formula:\n    // targetScale = currentScale * Math.pow(speed, amount)\n    const targetScale = this.workspace.options.zoomOptions.startScale;\n    const currentScale = this.workspace.scale;\n    const speed = this.workspace.options.zoomOptions.scaleSpeed;\n    // To compute amount:\n    // amount = log(speed, (targetScale / currentScale))\n    // Math.log computes natural logarithm (ln), to change the base, use\n    // formula: log(base, value) = ln(value) / ln(base)\n    const amount = Math.log(targetScale / currentScale) / Math.log(speed);\n    this.workspace.beginCanvasTransition();\n    this.workspace.zoomCenter(amount);\n    this.workspace.scrollCenter();\n\n    setTimeout(this.workspace.endCanvasTransition.bind(this.workspace), 500);\n    this.fireZoomEvent();\n    Touch.clearTouchIdentifier(); // Don't block future drags.\n    e.stopPropagation(); // Don't start a workspace scroll.\n    e.preventDefault(); // Stop double-clicking from selecting text.\n  }\n\n  /** Fires a zoom control UI event. */\n  private fireZoomEvent() {\n    const uiEvent = new (eventUtils.get(EventType.CLICK))(\n      null,\n      this.workspace.id,\n      'zoom_controls',\n    );\n    eventUtils.fire(uiEvent);\n  }\n}\n\n/** CSS for zoom controls.  See css.js for use. */\nCss.register(`\n.blocklyZoom>image, .blocklyZoom>svg>image {\n  opacity: .4;\n}\n\n.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {\n  opacity: .6;\n}\n\n.blocklyZoom>image:active, .blocklyZoom>svg>image:active {\n  opacity: .8;\n}\n`);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.priorities\n\n/**\n * The priority for deserializing variables.\n */\nexport const VARIABLES = 100;\n\n/**\n * The priority for deserializing variable data.\n */\nexport const PROCEDURES = 75;\n\n/**\n * The priority for deserializing blocks.\n */\nexport const BLOCKS = 50;\n\n/** The priority for deserializing workspace comments. */\nexport const WORKSPACE_COMMENTS = 25;\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.config\n\n/**\n * All the values that we expect developers to be able to change\n * before injecting Blockly.\n */\ninterface Config {\n  dragRadius: number;\n  flyoutDragRadius: number;\n  snapRadius: number;\n  currentConnectionPreference: number;\n  bumpDelay: number;\n  connectingSnapRadius: number;\n}\n\n/** Default snap radius. */\nconst DEFAULT_SNAP_RADIUS = 28;\n\n/**\n * Object holding all the values on Blockly that we expect developers to be\n * able to change.\n */\nexport const config: Config = {\n  /**\n   * Number of pixels the mouse must move before a drag starts.\n   *\n   */\n  dragRadius: 5,\n  /**\n   * Number of pixels the mouse must move before a drag/scroll starts from the\n   * flyout.  Because the drag-intention is determined when this is reached, it\n   * is larger than dragRadius so that the drag-direction is clearer.\n   *\n   */\n  flyoutDragRadius: 10,\n  /**\n   * Maximum misalignment between connections for them to snap together.\n   *\n   */\n  snapRadius: DEFAULT_SNAP_RADIUS,\n  /**\n   * Maximum misalignment between connections for them to snap together.\n   * This should be the same as the snap radius.\n   */\n  connectingSnapRadius: DEFAULT_SNAP_RADIUS,\n  /**\n   * How much to prefer staying connected to the current connection over moving\n   * to a new connection.  The current previewed connection is considered to be\n   * this much closer to the matching connection on the block than it actually\n   * is.\n   *\n   */\n  currentConnectionPreference: 8,\n  /**\n   * Delay in ms between trigger and bumping unconnected block out of alignment.\n   *\n   */\n  bumpDelay: 250,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Blockly menu similar to Closure's goog.ui.Menu\n *\n * @class\n */\n// Former goog.module ID: Blockly.Menu\n\nimport * as browserEvents from './browser_events.js';\nimport type {MenuItem} from './menuitem.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\n\n/**\n * A basic menu class.\n */\nexport class Menu {\n  /**\n   * Array of menu items.\n   * (Nulls are never in the array, but typing the array as nullable prevents\n   * the compiler from objecting to .indexOf(null))\n   */\n  private readonly menuItems: MenuItem[] = [];\n\n  /**\n   * Coordinates of the pointerdown event that caused this menu to open. Used to\n   * prevent the consequent pointerup event due to a simple click from\n   * activating a menu item immediately.\n   */\n  openingCoords: Coordinate | null = null;\n\n  /**\n   * This is the element that we will listen to the real focus events on.\n   * A value of null means no menu item is highlighted.\n   */\n  private highlightedItem: MenuItem | null = null;\n\n  /** Pointer over event data. */\n  private pointerMoveHandler: browserEvents.Data | null = null;\n\n  /** Click event data. */\n  private clickHandler: browserEvents.Data | null = null;\n\n  /** Pointer enter event data. */\n  private pointerEnterHandler: browserEvents.Data | null = null;\n\n  /** Pointer leave event data. */\n  private pointerLeaveHandler: browserEvents.Data | null = null;\n\n  /** Key down event data. */\n  private onKeyDownHandler: browserEvents.Data | null = null;\n\n  /** The menu's root DOM element. */\n  private element: HTMLDivElement | null = null;\n\n  /** ARIA name for this menu. */\n  private roleName: aria.Role | null = null;\n\n  /** Constructs a new Menu instance. */\n  constructor() {}\n\n  /**\n   * Add a new menu item to the bottom of this menu.\n   *\n   * @param menuItem Menu item to append.\n   * @internal\n   */\n  addChild(menuItem: MenuItem) {\n    this.menuItems.push(menuItem);\n  }\n\n  /**\n   * Creates the menu DOM.\n   *\n   * @param container Element upon which to append this menu.\n   * @returns The menu's root DOM element.\n   */\n  render(container: Element): HTMLDivElement {\n    const element = document.createElement('div');\n    // goog-menu is deprecated, use blocklyMenu.  May 2020.\n    element.className = 'blocklyMenu goog-menu blocklyNonSelectable';\n    element.tabIndex = 0;\n    if (this.roleName) {\n      aria.setRole(element, this.roleName);\n    }\n    this.element = element;\n\n    // Add menu items.\n    for (let i = 0, menuItem; (menuItem = this.menuItems[i]); i++) {\n      element.appendChild(menuItem.createDom());\n    }\n\n    // Add event handlers.\n    this.pointerMoveHandler = browserEvents.conditionalBind(\n      element,\n      'pointermove',\n      this,\n      this.handlePointerMove,\n      true,\n    );\n    this.clickHandler = browserEvents.conditionalBind(\n      element,\n      'pointerup',\n      this,\n      this.handleClick,\n      true,\n    );\n    this.pointerEnterHandler = browserEvents.conditionalBind(\n      element,\n      'pointerenter',\n      this,\n      this.handlePointerEnter,\n      true,\n    );\n    this.pointerLeaveHandler = browserEvents.conditionalBind(\n      element,\n      'pointerleave',\n      this,\n      this.handlePointerLeave,\n      true,\n    );\n    this.onKeyDownHandler = browserEvents.conditionalBind(\n      element,\n      'keydown',\n      this,\n      this.handleKeyEvent,\n    );\n\n    container.appendChild(element);\n    return element;\n  }\n\n  /**\n   * Gets the menu's element.\n   *\n   * @returns The DOM element.\n   * @internal\n   */\n  getElement(): HTMLDivElement | null {\n    return this.element;\n  }\n\n  /**\n   * Focus the menu element.\n   *\n   * @internal\n   */\n  focus() {\n    const el = this.getElement();\n    if (el) {\n      el.focus({preventScroll: true});\n      dom.addClass(el, 'blocklyFocused');\n    }\n  }\n\n  /** Blur the menu element. */\n  private blur() {\n    const el = this.getElement();\n    if (el) {\n      el.blur();\n      dom.removeClass(el, 'blocklyFocused');\n    }\n  }\n\n  /**\n   * Set the menu accessibility role.\n   *\n   * @param roleName role name.\n   * @internal\n   */\n  setRole(roleName: aria.Role) {\n    this.roleName = roleName;\n  }\n\n  /** Dispose of this menu. */\n  dispose() {\n    // Remove event handlers.\n    if (this.pointerMoveHandler) {\n      browserEvents.unbind(this.pointerMoveHandler);\n      this.pointerMoveHandler = null;\n    }\n    if (this.clickHandler) {\n      browserEvents.unbind(this.clickHandler);\n      this.clickHandler = null;\n    }\n    if (this.pointerEnterHandler) {\n      browserEvents.unbind(this.pointerEnterHandler);\n      this.pointerEnterHandler = null;\n    }\n    if (this.pointerLeaveHandler) {\n      browserEvents.unbind(this.pointerLeaveHandler);\n      this.pointerLeaveHandler = null;\n    }\n    if (this.onKeyDownHandler) {\n      browserEvents.unbind(this.onKeyDownHandler);\n      this.onKeyDownHandler = null;\n    }\n\n    // Remove menu items.\n    for (let i = 0, menuItem; (menuItem = this.menuItems[i]); i++) {\n      menuItem.dispose();\n    }\n    this.element = null;\n  }\n\n  // Child component management.\n\n  /**\n   * Returns the child menu item that owns the given DOM element,\n   * or null if no such menu item is found.\n   *\n   * @param elem DOM element whose owner is to be returned.\n   * @returns Menu item for which the DOM element belongs to.\n   */\n  private getMenuItem(elem: Element): MenuItem | null {\n    const menuElem = this.getElement();\n    // Node might be the menu border (resulting in no associated menu item), or\n    // a menu item's div, or some element within the menu item.\n    // Walk up parents until one meets either the menu's root element, or\n    // a menu item's div.\n    let currentElement: Element | null = elem;\n    while (currentElement && currentElement !== menuElem) {\n      if (currentElement.classList.contains('blocklyMenuItem')) {\n        // Having found a menu item's div, locate that menu item in this menu.\n        for (let i = 0, menuItem; (menuItem = this.menuItems[i]); i++) {\n          if (menuItem.getElement() === currentElement) {\n            return menuItem;\n          }\n        }\n      }\n      currentElement = currentElement.parentElement;\n    }\n    return null;\n  }\n\n  // Highlight management.\n\n  /**\n   * Highlights the given menu item, or clears highlighting if null.\n   *\n   * @param item Item to highlight, or null.\n   * @internal\n   */\n  setHighlighted(item: MenuItem | null) {\n    const currentHighlighted = this.highlightedItem;\n    if (currentHighlighted) {\n      currentHighlighted.setHighlighted(false);\n      this.highlightedItem = null;\n    }\n    if (item) {\n      item.setHighlighted(true);\n      this.highlightedItem = item;\n      // Bring the highlighted item into view. This has no effect if the menu is\n      // not scrollable.\n      const menuElement = this.getElement();\n      const scrollingParent = menuElement?.parentElement;\n      const menuItemElement = item.getElement();\n      if (!scrollingParent || !menuItemElement) return;\n\n      style.scrollIntoContainerView(menuItemElement, scrollingParent);\n      aria.setState(menuElement, aria.State.ACTIVEDESCENDANT, item.getId());\n    }\n  }\n\n  /**\n   * Highlights the next highlightable item (or the first if nothing is\n   * currently highlighted).\n   *\n   * @internal\n   */\n  highlightNext() {\n    const index = this.highlightedItem\n      ? this.menuItems.indexOf(this.highlightedItem)\n      : -1;\n    this.highlightHelper(index, 1);\n  }\n\n  /**\n   * Highlights the previous highlightable item (or the last if nothing is\n   * currently highlighted).\n   *\n   * @internal\n   */\n  highlightPrevious() {\n    const index = this.highlightedItem\n      ? this.menuItems.indexOf(this.highlightedItem)\n      : -1;\n    this.highlightHelper(index < 0 ? this.menuItems.length : index, -1);\n  }\n\n  /** Highlights the first highlightable item. */\n  private highlightFirst() {\n    this.highlightHelper(-1, 1);\n  }\n\n  /** Highlights the last highlightable item. */\n  private highlightLast() {\n    this.highlightHelper(this.menuItems.length, -1);\n  }\n\n  /**\n   * Helper function that manages the details of moving the highlight among\n   * child menuitems in response to keyboard events.\n   *\n   * @param startIndex Start index.\n   * @param delta Step direction: 1 to go down, -1 to go up.\n   */\n  private highlightHelper(startIndex: number, delta: number) {\n    let index = startIndex + delta;\n    let menuItem;\n    while ((menuItem = this.menuItems[index])) {\n      if (menuItem.isEnabled()) {\n        this.setHighlighted(menuItem);\n        break;\n      }\n      index += delta;\n    }\n  }\n\n  // Pointer events.\n\n  /**\n   * Handles pointermove events. Highlight menu items as the user hovers over\n   * them.\n   *\n   * @param e Pointer event to handle.\n   */\n  private handlePointerMove(e: PointerEvent) {\n    // Check whether the pointer actually did move. Move events are triggered if\n    // the element underneath the pointer moves, even if the pointer itself has\n    // remained stationary. In the case where the pointer is hovering over\n    // the menu but the user is navigating through the list of items via the\n    // keyboard and causing items off the end of the menu to scroll into view,\n    // a pointermove event would be triggered due to the pointer now being over\n    // a new child, but we don't want to highlight the item that's now under the\n    // pointer.\n    const delta = Math.max(Math.abs(e.movementX), Math.abs(e.movementY));\n    if (delta === 0) return;\n\n    const menuItem = this.getMenuItem(e.target as Element);\n\n    if (menuItem) {\n      if (menuItem.isEnabled()) {\n        if (this.highlightedItem !== menuItem) {\n          this.setHighlighted(menuItem);\n        }\n      } else {\n        this.setHighlighted(null);\n      }\n    }\n  }\n\n  /**\n   * Handles click events. Pass the event onto the child menuitem to handle.\n   *\n   * @param e Click event to handle.\n   */\n  private handleClick(e: PointerEvent) {\n    const oldCoords = this.openingCoords;\n    // Clear out the saved opening coords immediately so they're not used twice.\n    this.openingCoords = null;\n    if (oldCoords && typeof e.clientX === 'number') {\n      const newCoords = new Coordinate(e.clientX, e.clientY);\n      if (Coordinate.distance(oldCoords, newCoords) < 1) {\n        // This menu was opened by a pointerdown and we're handling the\n        // consequent click event. The coords haven't changed, meaning this was\n        // the same opening event. Don't do the usual behavior because the menu\n        // just popped up under the pointer and the user didn't mean to activate\n        // this item.\n        return;\n      }\n    }\n\n    const menuItem = this.getMenuItem(e.target as Element);\n    if (menuItem) {\n      menuItem.performAction();\n    }\n  }\n\n  /**\n   * Handles pointer enter events. Focus the element.\n   *\n   * @param _e Pointer event to handle.\n   */\n  private handlePointerEnter(_e: PointerEvent) {\n    this.focus();\n  }\n\n  /**\n   * Handles pointer leave events by clearing the active highlight.\n   *\n   * @param _e Pointer event to handle.\n   */\n  private handlePointerLeave(_e: PointerEvent) {\n    if (this.getElement()) {\n      this.setHighlighted(null);\n    }\n  }\n\n  // Keyboard events.\n\n  /**\n   * Attempts to handle a keyboard event, if the menu item is enabled, by\n   * calling\n   * {@link Menu#handleKeyEventInternal_}.\n   *\n   * @param e Key event to handle.\n   */\n  private handleKeyEvent(e: Event) {\n    if (!this.menuItems.length) {\n      // Empty menu.\n      return;\n    }\n    const keyboardEvent = e as KeyboardEvent;\n    if (\n      keyboardEvent.shiftKey ||\n      keyboardEvent.ctrlKey ||\n      keyboardEvent.metaKey ||\n      keyboardEvent.altKey\n    ) {\n      // Do not handle the key event if any modifier key is pressed.\n      return;\n    }\n\n    const highlighted = this.highlightedItem;\n    switch (keyboardEvent.key) {\n      case 'Enter':\n      case ' ':\n        if (highlighted) {\n          highlighted.performAction();\n        }\n        break;\n\n      case 'ArrowUp':\n        this.highlightPrevious();\n        break;\n\n      case 'ArrowDown':\n        this.highlightNext();\n        break;\n\n      case 'PageUp':\n      case 'Home':\n        this.highlightFirst();\n        break;\n\n      case 'PageDown':\n      case 'End':\n        this.highlightLast();\n        break;\n\n      default:\n        // Not a key the menu is interested in.\n        return;\n    }\n    // The menu used this key, don't let it have secondary effects.\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  /**\n   * Get the size of a rendered menu.\n   *\n   * @returns Object with width and height properties.\n   * @internal\n   */\n  getSize(): Size {\n    const menuDom = this.getElement() as HTMLDivElement;\n    const menuSize = style.getSize(menuDom);\n    // Recalculate height for the total content, not only box height.\n    menuSize.height = menuDom.scrollHeight;\n    return menuSize;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Blockly menu item similar to Closure's goog.ui.MenuItem\n *\n * @class\n */\n// Former goog.module ID: Blockly.MenuItem\n\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\n\n/**\n * Class representing an item in a menu.\n */\nexport class MenuItem {\n  /** Is the menu item clickable, as opposed to greyed-out. */\n  private enabled = true;\n\n  /** The DOM element for the menu item. */\n  private element: HTMLDivElement | null = null;\n\n  /** Whether the menu item is rendered right-to-left. */\n  private rightToLeft = false;\n\n  /** ARIA name for this menu. */\n  private roleName: aria.Role | null = null;\n\n  /** Is this menu item checkable. */\n  private checkable = false;\n\n  /** Is this menu item currently checked. */\n  private checked = false;\n\n  /** Is this menu item currently highlighted. */\n  private highlight = false;\n\n  /** Bound function to call when this menu item is clicked. */\n  private actionHandler: ((obj: this) => void) | null = null;\n\n  /**\n   * @param content Text caption to display as the content of the item, or a\n   *     HTML element to display.\n   * @param opt_value Data/model associated with the menu item.\n   */\n  constructor(\n    private readonly content: string | HTMLElement,\n    private readonly opt_value?: string,\n  ) {}\n\n  /**\n   * Creates the menuitem's DOM.\n   *\n   * @returns Completed DOM.\n   */\n  createDom(): Element {\n    const element = document.createElement('div');\n    element.id = idGenerator.getNextUniqueId();\n    this.element = element;\n\n    // Set class and style\n    // goog-menuitem* is deprecated, use blocklyMenuItem*.  May 2020.\n    element.className =\n      'blocklyMenuItem goog-menuitem ' +\n      (this.enabled ? '' : 'blocklyMenuItemDisabled goog-menuitem-disabled ') +\n      (this.checked ? 'blocklyMenuItemSelected goog-option-selected ' : '') +\n      (this.highlight\n        ? 'blocklyMenuItemHighlight goog-menuitem-highlight '\n        : '') +\n      (this.rightToLeft ? 'blocklyMenuItemRtl goog-menuitem-rtl ' : '');\n\n    const content = document.createElement('div');\n    content.className = 'blocklyMenuItemContent goog-menuitem-content';\n    // Add a checkbox for checkable menu items.\n    if (this.checkable) {\n      const checkbox = document.createElement('div');\n      checkbox.className = 'blocklyMenuItemCheckbox goog-menuitem-checkbox';\n      content.appendChild(checkbox);\n    }\n\n    let contentDom: Node = this.content as HTMLElement;\n    if (typeof this.content === 'string') {\n      contentDom = document.createTextNode(this.content);\n    }\n    content.appendChild(contentDom);\n    element.appendChild(content);\n\n    // Initialize ARIA role and state.\n    if (this.roleName) {\n      aria.setRole(element, this.roleName);\n    }\n    aria.setState(\n      element,\n      aria.State.SELECTED,\n      (this.checkable && this.checked) || false,\n    );\n    aria.setState(element, aria.State.DISABLED, !this.enabled);\n\n    return element;\n  }\n\n  /** Dispose of this menu item. */\n  dispose() {\n    this.element = null;\n  }\n\n  /**\n   * Gets the menu item's element.\n   *\n   * @returns The DOM element.\n   * @internal\n   */\n  getElement(): Element | null {\n    return this.element;\n  }\n\n  /**\n   * Gets the unique ID for this menu item.\n   *\n   * @returns Unique component ID.\n   * @internal\n   */\n  getId(): string {\n    return this.element!.id;\n  }\n\n  /**\n   * Gets the value associated with the menu item.\n   *\n   * @returns value Value associated with the menu item.\n   * @internal\n   */\n  getValue(): string | null {\n    return this.opt_value ?? null;\n  }\n\n  /**\n   * Set menu item's rendering direction.\n   *\n   * @param rtl True if RTL, false if LTR.\n   * @internal\n   */\n  setRightToLeft(rtl: boolean) {\n    this.rightToLeft = rtl;\n  }\n\n  /**\n   * Set the menu item's accessibility role.\n   *\n   * @param roleName Role name.\n   * @internal\n   */\n  setRole(roleName: aria.Role) {\n    this.roleName = roleName;\n  }\n\n  /**\n   * Sets the menu item to be checkable or not. Set to true for menu items\n   * that represent checkable options.\n   *\n   * @param checkable Whether the menu item is checkable.\n   * @internal\n   */\n  setCheckable(checkable: boolean) {\n    this.checkable = checkable;\n  }\n\n  /**\n   * Checks or unchecks the component.\n   *\n   * @param checked Whether to check or uncheck the component.\n   * @internal\n   */\n  setChecked(checked: boolean) {\n    this.checked = checked;\n  }\n\n  /**\n   * Highlights or unhighlights the component.\n   *\n   * @param highlight Whether to highlight or unhighlight the component.\n   * @internal\n   */\n  setHighlighted(highlight: boolean) {\n    this.highlight = highlight;\n\n    const el = this.getElement();\n    if (el && this.isEnabled()) {\n      // goog-menuitem-highlight is deprecated, use blocklyMenuItemHighlight.\n      // May 2020.\n      const name = 'blocklyMenuItemHighlight';\n      const nameDep = 'goog-menuitem-highlight';\n      if (highlight) {\n        dom.addClass(el, name);\n        dom.addClass(el, nameDep);\n      } else {\n        dom.removeClass(el, name);\n        dom.removeClass(el, nameDep);\n      }\n    }\n  }\n\n  /**\n   * Returns true if the menu item is enabled, false otherwise.\n   *\n   * @returns Whether the menu item is enabled.\n   * @internal\n   */\n  isEnabled(): boolean {\n    return this.enabled;\n  }\n\n  /**\n   * Enables or disables the menu item.\n   *\n   * @param enabled Whether to enable or disable the menu item.\n   * @internal\n   */\n  setEnabled(enabled: boolean) {\n    this.enabled = enabled;\n  }\n\n  /**\n   * Performs the appropriate action when the menu item is activated\n   * by the user.\n   *\n   * @internal\n   */\n  performAction() {\n    if (this.isEnabled() && this.actionHandler) {\n      this.actionHandler(this);\n    }\n  }\n\n  /**\n   * Set the handler that's called when the menu item is activated by the user.\n   * `obj` will be used as the 'this' object in the function when called.\n   *\n   * @param fn The handler.\n   * @param obj Used as the 'this' object in fn when called.\n   * @internal\n   */\n  onAction(fn: (p1: MenuItem) => void, obj: object) {\n    this.actionHandler = fn.bind(obj);\n  }\n}\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.constants\n\n/**\n * The language-neutral ID given to the collapsed input.\n */\nexport const COLLAPSED_INPUT_NAME = '_TEMP_COLLAPSED_INPUT';\n\n/**\n * The language-neutral ID given to the collapsed field.\n */\nexport const COLLAPSED_FIELD_NAME = '_TEMP_COLLAPSED_FIELD';\n\n/**\n * The language-neutral ID for when the reason why a block is disabled is\n * because the user manually disabled it, such as via the context menu.\n */\nexport const MANUALLY_DISABLED = 'MANUALLY_DISABLED';\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.inputTypes\n\nimport {ConnectionType} from '../connection_type.js';\n\n/**\n * Enum for the type of a connection or input.\n */\nexport enum inputTypes {\n  // A right-facing value input.  E.g. 'set item to' or 'return'.\n  VALUE = ConnectionType.INPUT_VALUE,\n  // A down-facing block stack.  E.g. 'if-do' or 'else'.\n  STATEMENT = ConnectionType.NEXT_STATEMENT,\n  // A dummy input.  Used to add field(s) with no input.\n  DUMMY = 5,\n  // An unknown type of input defined by an external developer.\n  CUSTOM = 6,\n  // An input with no connections that is always the last input of a row. Any\n  // subsequent input will be rendered on the next row. Any newline character in\n  // a JSON block definition's message will be parsed as an end-row input.\n  END_ROW = 7,\n}\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Msg\n\n/** A dictionary of localised messages. */\nexport const Msg: {[key: string]: string} = Object.create(null);\n\n/**\n * Sets the locale (i.e. the localized messages/block-text/etc) to the given\n * locale.\n *\n * This is not useful/necessary when loading from a script tag, because the\n * messages are automatically cluged into the Blockly.Msg object. But we provide\n * it in both the script-tag and non-script-tag contexts so that the tscompiler\n * can properly create our type definition files.\n *\n * @param locale An object defining the messages for a given language.\n */\nexport const setLocale = function (locale: {[key: string]: string}) {\n  Object.keys(locale).forEach(function (k) {\n    Msg[k] = locale[k];\n  });\n};\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Abstract class for a variable event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.VarBase\n\nimport type {VariableModel} from '../variable_model.js';\nimport type {Workspace} from '../workspace.js';\nimport {\n  Abstract as AbstractEvent,\n  AbstractEventJson,\n} from './events_abstract.js';\n\n/**\n * Abstract class for a variable event.\n */\nexport class VarBase extends AbstractEvent {\n  override isBlank = true;\n  /** The ID of the variable this event references. */\n  varId?: string;\n\n  /**\n   * @param opt_variable The variable this event corresponds to.  Undefined for\n   *     a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super();\n    this.isBlank = typeof opt_variable === 'undefined';\n    if (!opt_variable) return;\n\n    this.varId = opt_variable.getId();\n    this.workspaceId = opt_variable.workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarBaseJson {\n    const json = super.toJson() as VarBaseJson;\n    if (!this.varId) {\n      throw new Error(\n        'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['varId'] = this.varId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarBase, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: VarBaseJson,\n    workspace: Workspace,\n    event?: any,\n  ): VarBase {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new VarBase(),\n    ) as VarBase;\n    newEvent.varId = json['varId'];\n    return newEvent;\n  }\n}\n\nexport interface VarBaseJson extends AbstractEventJson {\n  varId: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a variable creation event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.VarCreate\n\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\nimport type {Workspace} from '../workspace.js';\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that a variable model has been created.\n */\nexport class VarCreate extends VarBase {\n  override type = EventType.VAR_CREATE;\n\n  /** The type of the variable that was created. */\n  varType?: string;\n\n  /** The name of the variable that was created. */\n  varName?: string;\n\n  /**\n   * @param opt_variable The created variable. Undefined for a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return; // Blank event to be populated by fromJson.\n    }\n    this.varType = opt_variable.type;\n    this.varName = opt_variable.name;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarCreateJson {\n    const json = super.toJson() as VarCreateJson;\n    if (this.varType === undefined) {\n      throw new Error(\n        'The var type is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.varName) {\n      throw new Error(\n        'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['varType'] = this.varType;\n    json['varName'] = this.varName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarCreate, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: VarCreateJson,\n    workspace: Workspace,\n    event?: any,\n  ): VarCreate {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new VarCreate(),\n    ) as VarCreate;\n    newEvent.varType = json['varType'];\n    newEvent.varName = json['varName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n        'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.varName) {\n      throw new Error(\n        'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (forward) {\n      workspace.createVariable(this.varName, this.varType, this.varId);\n    } else {\n      workspace.deleteVariableById(this.varId);\n    }\n  }\n}\n\nexport interface VarCreateJson extends VarBaseJson {\n  varType: string;\n  varName: string;\n}\n\nregistry.register(registry.Type.EVENT, EventType.VAR_CREATE, VarCreate);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for the variable model.\n *\n * @class\n */\n// Former goog.module ID: Blockly.VariableModel\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_create.js';\n\nimport * as idGenerator from './utils/idgenerator.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Class for a variable model.\n * Holds information for the variable including name, ID, and type.\n *\n * @see {Blockly.FieldVariable}\n */\nexport class VariableModel {\n  type: string;\n  private readonly id: string;\n\n  /**\n   * @param workspace The variable's workspace.\n   * @param name The name of the variable.  This is the user-visible name (e.g.\n   *     'my var' or ''), not the generated name.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   */\n  constructor(\n    public workspace: Workspace,\n    public name: string,\n    opt_type?: string,\n    opt_id?: string,\n  ) {\n    /**\n     * The type of the variable, such as 'int' or 'sound_effect'. This may be\n     * used to build a list of variables of a specific type. By default this is\n     * the empty string '', which is a specific type.\n     *\n     * @see {Blockly.FieldVariable}\n     */\n    this.type = opt_type || '';\n\n    /**\n     * A unique ID for the variable. This should be defined at creation and\n     * not change, even if the name changes. In most cases this should be a\n     * UUID.\n     */\n    this.id = opt_id || idGenerator.genUid();\n  }\n\n  /** @returns The ID for the variable. */\n  getId(): string {\n    return this.id;\n  }\n\n  /**\n   * A custom compare function for the VariableModel objects.\n   *\n   * @param var1 First variable to compare.\n   * @param var2 Second variable to compare.\n   * @returns -1 if name of var1 is less than name of var2, 0 if equal, and 1 if\n   *     greater.\n   * @internal\n   */\n  static compareByName(var1: VariableModel, var2: VariableModel): number {\n    return var1.name.localeCompare(var2.name, undefined, {sensitivity: 'base'});\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.exceptions\n\nimport type {Block} from '../block.js';\nimport type {State} from './blocks.js';\n\nexport class DeserializationError extends Error {}\n\n/**\n * Represents an error where the serialized state is expected to provide a\n * block type, but it is not provided.\n *\n */\nexport class MissingBlockType extends DeserializationError {\n  /**\n   * @param state The state object which is missing the block type.\n   * @internal\n   */\n  constructor(public state: State) {\n    super(`Expected to find a 'type' property, defining the block type`);\n  }\n}\n\n/**\n * Represents an error where deserialization encountered a block that did\n * not have a connection that was defined in the serialized state.\n */\nexport class MissingConnection extends DeserializationError {\n  /**\n   * @param connection The name of the connection that is missing. E.g.\n   *     'IF0', or 'next'.\n   * @param block The block missing the connection.\n   * @param state The state object containing the bad connection.\n   * @internal\n   */\n  constructor(\n    connection: string,\n    public block: Block,\n    public state: State,\n  ) {\n    super(`The block ${block.toDevString()} is missing a(n) ${connection}\nconnection`);\n  }\n}\n\n/**\n * Represents an error where deserialization tried to connect two connections\n * that were not compatible.\n */\nexport class BadConnectionCheck extends DeserializationError {\n  /**\n   * @param reason The reason the connections were not compatible.\n   * @param childConnection The name of the incompatible child connection. E.g.\n   *     'output' or 'previous'.\n   * @param childBlock The child block that could not connect to its parent.\n   * @param childState The state object representing the child block.\n   * @internal\n   */\n  constructor(\n    reason: string,\n    childConnection: string,\n    public childBlock: Block,\n    public childState: State,\n  ) {\n    super(`The block ${childBlock.toDevString()} could not connect its\n${childConnection} to its parent, because: ${reason}`);\n  }\n}\n\n/**\n * Represents an error where deserialization encountered a real block as it\n * was deserializing children of a shadow.\n * This is an error because it is an invariant of Blockly that shadow blocks\n * do not have real children.\n */\nexport class RealChildOfShadow extends DeserializationError {\n  /**\n   * @param state The state object representing the real block.\n   * @internal\n   */\n  constructor(public state: State) {\n    super(`Encountered a real block which is defined as a child of a shadow\nblock. It is an invariant of Blockly that shadow blocks only have shadow\nchildren`);\n  }\n}\n\nexport class UnregisteredIcon extends DeserializationError {\n  /**\n   * @param iconType The type of the unregistered icon we are attempting to\n   *     deserialize.\n   * @param block The block we are attempting to add the unregistered icon to.\n   * @param state The state object representing the block.\n   */\n  constructor(\n    iconType: string,\n    public block: Block,\n    public state: State,\n  ) {\n    super(\n      `Cannot add an icon of type '${iconType}' to the block ` +\n        `${block.toDevString()}, because there is no icon registered with ` +\n        `type '${iconType}'. Make sure that all of your icons have been ` +\n        `registered.`,\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {ICommentIcon} from '../interfaces/i_comment_icon.js';\nimport {IIcon} from '../interfaces/i_icon.js';\nimport {MutatorIcon} from './mutator_icon.js';\nimport {WarningIcon} from './warning_icon.js';\n\n/**\n * Defines the type of an icon, so that it can be retrieved from block.getIcon\n */\nexport class IconType<_T extends IIcon> {\n  /** @param name The name of the registry type. */\n  constructor(private readonly name: string) {}\n\n  /** @returns the name of the type. */\n  toString(): string {\n    return this.name;\n  }\n\n  /** @returns true if this icon type is equivalent to the given icon type. */\n  equals(type: IconType<IIcon>): boolean {\n    return this.name === type.toString();\n  }\n\n  static MUTATOR = new IconType<MutatorIcon>('mutator');\n  static WARNING = new IconType<WarningIcon>('warning');\n  static COMMENT = new IconType<ICommentIcon>('comment');\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for all types of block events.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockBase\n\nimport type {Block} from '../block.js';\nimport type {Workspace} from '../workspace.js';\nimport {\n  Abstract as AbstractEvent,\n  AbstractEventJson,\n} from './events_abstract.js';\n\n/**\n * Abstract class for any event related to blocks.\n */\nexport class BlockBase extends AbstractEvent {\n  override isBlank = true;\n\n  /** The ID of the block associated with this event. */\n  blockId?: string;\n\n  /**\n   * @param opt_block The block this event corresponds to.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_block?: Block) {\n    super();\n    this.isBlank = !opt_block;\n\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n    this.workspaceId = opt_block.workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockBaseJson {\n    const json = super.toJson() as BlockBaseJson;\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['blockId'] = this.blockId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockBase, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockBaseJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockBase {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockBase(),\n    ) as BlockBase;\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport interface BlockBaseJson extends AbstractEventJson {\n  blockId: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block change event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockChange\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport {MANUALLY_DISABLED} from '../constants.js';\nimport {IconType} from '../icons/icon_types.js';\nimport {hasBubble} from '../interfaces/i_has_bubble.js';\nimport * as registry from '../registry.js';\nimport * as utilsXml from '../utils/xml.js';\nimport {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport {EventType} from './type.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Notifies listeners when some element of a block has changed (e.g.\n * field values, comments, etc).\n */\nexport class BlockChange extends BlockBase {\n  override type = EventType.BLOCK_CHANGE;\n  /**\n   * The element that changed; one of 'field', 'comment', 'collapsed',\n   * 'disabled', 'inline', or 'mutation'\n   */\n  element?: string;\n\n  /** The name of the field that changed, if this is a change to a field. */\n  name?: string;\n\n  /** The original value of the element. */\n  oldValue: unknown;\n\n  /** The new value of the element. */\n  newValue: unknown;\n\n  /**\n   * If element is 'disabled', this is the language-neutral identifier of the\n   * reason why the block was or was not disabled.\n   */\n  private disabledReason?: string;\n\n  /**\n   * @param opt_block The changed block.  Undefined for a blank event.\n   * @param opt_element One of 'field', 'comment', 'disabled', etc.\n   * @param opt_name Name of input or field affected, or null.\n   * @param opt_oldValue Previous value of element.\n   * @param opt_newValue New value of element.\n   */\n  constructor(\n    opt_block?: Block,\n    opt_element?: string,\n    opt_name?: string | null,\n    opt_oldValue?: unknown,\n    opt_newValue?: unknown,\n  ) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return; // Blank event to be populated by fromJson.\n    }\n    this.element = opt_element;\n    this.name = opt_name || undefined;\n    this.oldValue = opt_oldValue;\n    this.newValue = opt_newValue;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockChangeJson {\n    const json = super.toJson() as BlockChangeJson;\n    if (!this.element) {\n      throw new Error(\n        'The changed element is undefined. Either pass an ' +\n          'element to the constructor, or call fromJson',\n      );\n    }\n    json['element'] = this.element;\n    json['name'] = this.name;\n    json['oldValue'] = this.oldValue;\n    json['newValue'] = this.newValue;\n    if (this.disabledReason) {\n      json['disabledReason'] = this.disabledReason;\n    }\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockChange(),\n    ) as BlockChange;\n    newEvent.element = json['element'];\n    newEvent.name = json['name'];\n    newEvent.oldValue = json['oldValue'];\n    newEvent.newValue = json['newValue'];\n    if (json['disabledReason'] !== undefined) {\n      newEvent.disabledReason = json['disabledReason'];\n    }\n    return newEvent;\n  }\n\n  /**\n   * Set the language-neutral identifier for the reason why the block was or was\n   * not disabled. This is only valid for events where element is 'disabled'.\n   * Defaults to 'MANUALLY_DISABLED'.\n   *\n   * @param disabledReason The identifier of the reason why the block was or was\n   *     not disabled.\n   */\n  setDisabledReason(disabledReason: string) {\n    if (this.element !== 'disabled') {\n      throw new Error(\n        'Cannot set the disabled reason for a BlockChange event if the ' +\n          'element is not \"disabled\".',\n      );\n    }\n    this.disabledReason = disabledReason;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldValue === this.newValue;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n        'The associated block is undefined. Either pass a ' +\n          'block to the constructor, or call fromJson',\n      );\n    }\n    // Assume the block is rendered so that then we can check.\n    const icon = block.getIcon(IconType.MUTATOR);\n    if (icon && hasBubble(icon) && icon.bubbleIsVisible()) {\n      // Close the mutator (if open) since we don't want to update it.\n      icon.setBubbleVisible(false);\n    }\n    const value = forward ? this.newValue : this.oldValue;\n    switch (this.element) {\n      case 'field': {\n        const field = block.getField(this.name!);\n        if (field) {\n          field.setValue(value);\n        } else {\n          console.warn(\"Can't set non-existent field: \" + this.name);\n        }\n        break;\n      }\n      case 'comment':\n        block.setCommentText((value as string) || null);\n        break;\n      case 'collapsed':\n        block.setCollapsed(!!value);\n        break;\n      case 'disabled':\n        block.setDisabledReason(\n          !!value,\n          this.disabledReason ?? MANUALLY_DISABLED,\n        );\n        break;\n      case 'inline':\n        block.setInputsInline(!!value);\n        break;\n      case 'mutation': {\n        const oldState = BlockChange.getExtraBlockState_(block as BlockSvg);\n        if (block.loadExtraState) {\n          block.loadExtraState(JSON.parse((value as string) || '{}'));\n        } else if (block.domToMutation) {\n          block.domToMutation(\n            utilsXml.textToDom((value as string) || '<mutation/>'),\n          );\n        }\n        eventUtils.fire(\n          new BlockChange(block, 'mutation', null, oldState, value),\n        );\n        break;\n      }\n      default:\n        console.warn('Unknown change type: ' + this.element);\n    }\n  }\n\n  // TODO (#5397): Encapsulate this in the BlocklyMutationChange event when\n  //    refactoring change events.\n  /**\n   * Returns the extra state of the given block (either as XML or a JSO,\n   * depending on the block's definition).\n   *\n   * @param block The block to get the extra state of.\n   * @returns A stringified version of the extra state of the given block.\n   * @internal\n   */\n  static getExtraBlockState_(block: BlockSvg): string {\n    if (block.saveExtraState) {\n      const state = block.saveExtraState(true);\n      return state ? JSON.stringify(state) : '';\n    } else if (block.mutationToDom) {\n      const state = block.mutationToDom();\n      return state ? Xml.domToText(state) : '';\n    }\n    return '';\n  }\n}\n\nexport interface BlockChangeJson extends BlockBaseJson {\n  element: string;\n  name?: string;\n  newValue: unknown;\n  oldValue: unknown;\n  disabledReason?: string;\n}\n\nregistry.register(registry.Type.EVENT, EventType.BLOCK_CHANGE, BlockChange);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of managing markers and the cursor.\n *\n * @class\n */\n// Former goog.module ID: Blockly.MarkerManager\n\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Marker} from './keyboard_nav/marker.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class to manage the multiple markers and the cursor on a workspace.\n */\nexport class MarkerManager {\n  /** The name of the local marker. */\n  static readonly LOCAL_MARKER = 'local_marker_1';\n\n  /** The cursor. */\n  private cursor: Cursor | null = null;\n\n  /** The cursor's SVG element. */\n  private cursorSvg: SVGElement | null = null;\n\n  /** The map of markers for the workspace. */\n  private markers = new Map<string, Marker>();\n\n  /** The marker's SVG element. */\n  private markerSvg: SVGElement | null = null;\n\n  /**\n   * @param workspace The workspace for the marker manager.\n   * @internal\n   */\n  constructor(private readonly workspace: WorkspaceSvg) {}\n\n  /**\n   * Register the marker by adding it to the map of markers.\n   *\n   * @param id A unique identifier for the marker.\n   * @param marker The marker to register.\n   */\n  registerMarker(id: string, marker: Marker) {\n    if (this.markers.has(id)) {\n      this.unregisterMarker(id);\n    }\n    marker.setDrawer(\n      this.workspace.getRenderer().makeMarkerDrawer(this.workspace, marker),\n    );\n    this.setMarkerSvg(marker.getDrawer().createDom());\n    this.markers.set(id, marker);\n  }\n\n  /**\n   * Unregister the marker by removing it from the map of markers.\n   *\n   * @param id The ID of the marker to unregister.\n   */\n  unregisterMarker(id: string) {\n    const marker = this.markers.get(id);\n    if (marker) {\n      marker.dispose();\n      this.markers.delete(id);\n    } else {\n      throw Error(\n        'Marker with ID ' +\n          id +\n          ' does not exist. ' +\n          'Can only unregister markers that exist.',\n      );\n    }\n  }\n\n  /**\n   * Get the cursor for the workspace.\n   *\n   * @returns The cursor for this workspace.\n   */\n  getCursor(): Cursor | null {\n    return this.cursor;\n  }\n\n  /**\n   * Get a single marker that corresponds to the given ID.\n   *\n   * @param id A unique identifier for the marker.\n   * @returns The marker that corresponds to the given ID, or null if none\n   *     exists.\n   */\n  getMarker(id: string): Marker | null {\n    return this.markers.get(id) || null;\n  }\n\n  /**\n   * Sets the cursor and initializes the drawer for use with keyboard\n   * navigation.\n   *\n   * @param cursor The cursor used to move around this workspace.\n   */\n  setCursor(cursor: Cursor) {\n    if (this.cursor && this.cursor.getDrawer()) {\n      this.cursor.getDrawer().dispose();\n    }\n    this.cursor = cursor;\n    if (this.cursor) {\n      const drawer = this.workspace\n        .getRenderer()\n        .makeMarkerDrawer(this.workspace, this.cursor);\n      this.cursor.setDrawer(drawer);\n      this.setCursorSvg(this.cursor.getDrawer().createDom());\n    }\n  }\n\n  /**\n   * Add the cursor SVG to this workspace SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement | null) {\n    if (!cursorSvg) {\n      this.cursorSvg = null;\n      return;\n    }\n\n    this.workspace.getBlockCanvas()!.appendChild(cursorSvg);\n    this.cursorSvg = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this workspaces SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement | null) {\n    if (!markerSvg) {\n      this.markerSvg = null;\n      return;\n    }\n\n    if (this.workspace.getBlockCanvas()) {\n      if (this.cursorSvg) {\n        this.workspace\n          .getBlockCanvas()!\n          .insertBefore(markerSvg, this.cursorSvg);\n      } else {\n        this.workspace.getBlockCanvas()!.appendChild(markerSvg);\n      }\n    }\n  }\n\n  /**\n   * Redraw the attached cursor SVG if needed.\n   *\n   * @internal\n   */\n  updateMarkers() {\n    if (this.workspace.keyboardAccessibilityMode && this.cursorSvg) {\n      this.workspace.getCursor()!.draw();\n    }\n  }\n\n  /**\n   * Dispose of the marker manager.\n   * Go through and delete all markers associated with this marker manager.\n   *\n   * @internal\n   */\n  dispose() {\n    const markerIds = Object.keys(this.markers);\n    for (let i = 0, markerId; (markerId = markerIds[i]); i++) {\n      this.unregisterMarker(markerId);\n    }\n    this.markers.clear();\n    if (this.cursor) {\n      this.cursor.dispose();\n      this.cursor = null;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Field.  Used for editable titles, variables, etc.\n * This is an abstract class that defines the UI on the block.  Actual\n * instances would be FieldTextInput, FieldDropdown, etc.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Field\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Input} from './inputs/input.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport type {IKeyboardAccessible} from './interfaces/i_keyboard_accessible.js';\nimport type {IRegistrable} from './interfaces/i_registrable.js';\nimport {ISerializable} from './interfaces/i_serializable.js';\nimport {MarkerManager} from './marker_manager.js';\nimport type {ConstantProvider} from './renderers/common/constants.js';\nimport type {KeyboardShortcut} from './shortcut_registry.js';\nimport * as Tooltip from './tooltip.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldValidator<T = any> = (newValue: T) => T | null | undefined;\n\n/**\n * Abstract class for an editable field.\n *\n * @typeParam T - The value stored on the field.\n */\nexport abstract class Field<T = any>\n  implements\n    IASTNodeLocationSvg,\n    IASTNodeLocationWithBlock,\n    IKeyboardAccessible,\n    IRegistrable,\n    ISerializable\n{\n  /**\n   * To overwrite the default value which is set in **Field**, directly update\n   * the prototype.\n   *\n   * Example:\n   * `FieldImage.prototype.DEFAULT_VALUE = null;`\n   */\n  DEFAULT_VALUE: T | null = null;\n\n  /** Non-breaking space. */\n  static readonly NBSP = '\\u00A0';\n\n  /**\n   * A value used to signal when a field's constructor should *not* set the\n   * field's value or run configure_, and should allow a subclass to do that\n   * instead.\n   */\n  static readonly SKIP_SETUP = Symbol('SKIP_SETUP');\n\n  /**\n   * Name of field.  Unique within each block.\n   * Static labels are usually unnamed.\n   */\n  name?: string = undefined;\n  protected value_: T | null;\n\n  /** Validation function called when user edits an editable field. */\n  protected validator_: FieldValidator<T> | null = null;\n\n  /**\n   * Used to cache the field's tooltip value if setTooltip is called when the\n   * field is not yet initialized. Is *not* guaranteed to be accurate.\n   */\n  private tooltip: Tooltip.TipInfo | null = null;\n  protected size_: Size;\n\n  /**\n   * Holds the cursors svg element when the cursor is attached to the field.\n   * This is null if there is no cursor on the field.\n   */\n  private cursorSvg: SVGElement | null = null;\n\n  /**\n   * Holds the markers svg element when the marker is attached to the field.\n   * This is null if there is no marker on the field.\n   */\n  private markerSvg: SVGElement | null = null;\n\n  /** The rendered field's SVG group element. */\n  protected fieldGroup_: SVGGElement | null = null;\n\n  /** The rendered field's SVG border element. */\n  protected borderRect_: SVGRectElement | null = null;\n\n  /** The rendered field's SVG text element. */\n  protected textElement_: SVGTextElement | null = null;\n\n  /** The rendered field's text content element. */\n  protected textContent_: Text | null = null;\n\n  /** Mouse down event listener data. */\n  private mouseDownWrapper: browserEvents.Data | null = null;\n\n  /** Constants associated with the source block's renderer. */\n  protected constants_: ConstantProvider | null = null;\n\n  /**\n   * Has this field been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /** Maximum characters of text to display before adding an ellipsis. */\n  maxDisplayLength = 50;\n\n  /** Block this field is attached to.  Starts as null, then set in init. */\n  protected sourceBlock_: Block | null = null;\n\n  /** Does this block need to be re-rendered? */\n  protected isDirty_ = true;\n\n  /** Is the field visible, or hidden due to the block being collapsed? */\n  protected visible_ = true;\n\n  /**\n   * Can the field value be changed using the editor on an editable block?\n   */\n  protected enabled_ = true;\n\n  /** The element the click handler is bound to. */\n  protected clickTarget_: Element | null = null;\n\n  /**\n   * The prefix field.\n   *\n   * @internal\n   */\n  prefixField: string | null = null;\n\n  /**\n   * The suffix field.\n   *\n   * @internal\n   */\n  suffixField: string | null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. They will also be saved by the serializer.\n   */\n  EDITABLE = true;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable. This is not the\n   * case by default so that SERIALIZABLE is backwards compatible.\n   */\n  SERIALIZABLE = false;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  CURSOR = '';\n\n  /**\n   * @param value The initial value of the field.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param validator  A function that is called to validate changes to the\n   *     field's value. Takes in a value & returns a validated value, or null to\n   *     abort the change.\n   * @param config A map of options used to configure the field.\n   *    Refer to the individual field's documentation for a list of properties\n   * this parameter supports.\n   */\n  constructor(\n    value: T | typeof Field.SKIP_SETUP,\n    validator?: FieldValidator<T> | null,\n    config?: FieldConfig,\n  ) {\n    /**\n     * A generic value possessed by the field.\n     * Should generally be non-null, only null when the field is created.\n     */\n    this.value_ =\n      'DEFAULT_VALUE' in new.target.prototype\n        ? new.target.prototype.DEFAULT_VALUE\n        : this.DEFAULT_VALUE;\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(0, 0);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Process the configuration map passed to the field.\n   *\n   * @param config A map of options used to configure the field. See the\n   *     individual field's documentation for a list of properties this\n   *     parameter supports.\n   */\n  protected configure_(config: FieldConfig) {\n    // TODO (#2884): Possibly add CSS class config option.\n    // TODO (#2885): Possibly add cursor config option.\n    if (config.tooltip) {\n      this.setTooltip(parsing.replaceMessageReferences(config.tooltip));\n    }\n  }\n\n  /**\n   * Attach this field to a block.\n   *\n   * @param block The block containing this field.\n   */\n  setSourceBlock(block: Block) {\n    if (this.sourceBlock_) {\n      throw Error('Field already bound to a block');\n    }\n    this.sourceBlock_ = block;\n  }\n\n  /**\n   * Get the renderer constant provider.\n   *\n   * @returns The renderer constant provider.\n   */\n  getConstants(): ConstantProvider | null {\n    if (\n      !this.constants_ &&\n      this.sourceBlock_ &&\n      !this.sourceBlock_.isDeadOrDying() &&\n      this.sourceBlock_.workspace.rendered\n    ) {\n      this.constants_ = (this.sourceBlock_.workspace as WorkspaceSvg)\n        .getRenderer()\n        .getConstants();\n    }\n    return this.constants_;\n  }\n\n  /**\n   * Get the block this field is attached to.\n   *\n   * @returns The block containing this field.\n   * @throws An error if the source block is not defined.\n   */\n  getSourceBlock(): Block | null {\n    return this.sourceBlock_;\n  }\n\n  /**\n   * Initialize everything to render this field. Override\n   * methods initModel and initView rather than this method.\n   *\n   * @sealed\n   * @internal\n   */\n  init() {\n    if (this.fieldGroup_) {\n      // Field has already been initialized once.\n      return;\n    }\n    this.fieldGroup_ = dom.createSvgElement(Svg.G, {});\n    if (!this.isVisible()) {\n      this.fieldGroup_.style.display = 'none';\n    }\n    const sourceBlockSvg = this.sourceBlock_ as BlockSvg;\n    sourceBlockSvg.getSvgRoot().appendChild(this.fieldGroup_);\n    this.initView();\n    this.updateEditable();\n    this.setTooltip(this.tooltip);\n    this.bindEvents_();\n    this.initModel();\n    this.applyColour();\n  }\n\n  /**\n   * Create the block UI for this field.\n   */\n  protected initView() {\n    this.createBorderRect_();\n    this.createTextElement_();\n  }\n\n  /**\n   * Initializes the model of the field after it has been installed on a block.\n   * No-op by default.\n   */\n  initModel() {}\n\n  /**\n   * Defines whether this field should take up the full block or not.\n   *\n   * Be cautious when overriding this function. It may not work as you expect /\n   * intend because the behavior was kind of hacked in. If you are thinking\n   * about overriding this function, post on the forum with your intended\n   * behavior to see if there's another approach.\n   */\n  protected isFullBlockField(): boolean {\n    return !this.borderRect_;\n  }\n\n  /**\n   * Create a field border rect element. Not to be overridden by subclasses.\n   * Instead modify the result of the function inside initView, or create a\n   * separate function to call.\n   */\n  protected createBorderRect_() {\n    this.borderRect_ = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'rx': this.getConstants()!.FIELD_BORDER_RECT_RADIUS,\n        'ry': this.getConstants()!.FIELD_BORDER_RECT_RADIUS,\n        'x': 0,\n        'y': 0,\n        'height': this.size_.height,\n        'width': this.size_.width,\n        'class': 'blocklyFieldRect',\n      },\n      this.fieldGroup_,\n    );\n  }\n\n  /**\n   * Create a field text element. Not to be overridden by subclasses. Instead\n   * modify the result of the function inside initView, or create a separate\n   * function to call.\n   */\n  protected createTextElement_() {\n    this.textElement_ = dom.createSvgElement(\n      Svg.TEXT,\n      {\n        'class': 'blocklyText',\n      },\n      this.fieldGroup_,\n    );\n    if (this.getConstants()!.FIELD_TEXT_BASELINE_CENTER) {\n      this.textElement_.setAttribute('dominant-baseline', 'central');\n    }\n    this.textContent_ = document.createTextNode('');\n    this.textElement_.appendChild(this.textContent_);\n  }\n\n  /**\n   * Bind events to the field. Can be overridden by subclasses if they need to\n   * do custom input handling.\n   */\n  protected bindEvents_() {\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    Tooltip.bindMouseEvents(clickTarget);\n    this.mouseDownWrapper = browserEvents.conditionalBind(\n      clickTarget,\n      'pointerdown',\n      this,\n      this.onMouseDown_,\n    );\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  fromXml(fieldElement: Element) {\n    // Any because gremlins live here. No touchie!\n    this.setValue(fieldElement.textContent as any);\n  }\n\n  /**\n   * Serializes this field's value to XML. Should only be called by Blockly.Xml.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   * @internal\n   */\n  toXml(fieldElement: Element): Element {\n    // Any because gremlins live here. No touchie!\n    fieldElement.textContent = this.getValue() as any;\n    return fieldElement;\n  }\n\n  /**\n   * Saves this fields value as something which can be serialized to JSON.\n   * Should only be called by the serialization system.\n   *\n   * @param _doFullSerialization If true, this signals to the field that if it\n   *     normally just saves a reference to some state (eg variable fields) it\n   *     should instead serialize the full state of the thing being referenced.\n   *     See the\n   *     {@link https://developers.devsite.google.com/blockly/guides/create-custom-blocks/fields/customizing-fields/creating#full_serialization_and_backing_data | field serialization docs}\n   *     for more information.\n   * @returns JSON serializable state.\n   * @internal\n   */\n  saveState(_doFullSerialization?: boolean): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(Field);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValue();\n  }\n\n  /**\n   * Sets the field's state based on the given state value. Should only be\n   * called by the serialization system.\n   *\n   * @param state The state we want to apply to the field.\n   * @internal\n   */\n  loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(Field, state)) {\n      return;\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Returns a stringified version of the XML state, if it should be used.\n   * Otherwise this returns null, to signal the field should use its own\n   * serialization.\n   *\n   * @param callingClass The class calling this method.\n   *     Used to see if `this` has overridden any relevant hooks.\n   * @returns The stringified version of the XML state, or null.\n   */\n  protected saveLegacyState(callingClass: FieldProto): string | null {\n    if (\n      callingClass.prototype.saveState === this.saveState &&\n      callingClass.prototype.toXml !== this.toXml\n    ) {\n      const elem = utilsXml.createElement('field');\n      elem.setAttribute('name', this.name || '');\n      const text = utilsXml.domToText(this.toXml(elem));\n      return text.replace(\n        ' xmlns=\"https://developers.google.com/blockly/xml\"',\n        '',\n      );\n    }\n    // Either they called this on purpose from their saveState, or they have\n    // no implementations of either hook. Just do our thing.\n    return null;\n  }\n\n  /**\n   * Loads the given state using either the old XML hooks, if they should be\n   * used. Returns true to indicate loading has been handled, false otherwise.\n   *\n   * @param callingClass The class calling this method.\n   *     Used to see if `this` has overridden any relevant hooks.\n   * @param state The state to apply to the field.\n   * @returns Whether the state was applied or not.\n   */\n  loadLegacyState(\n    callingClass: FieldProto,\n    state: AnyDuringMigration,\n  ): boolean {\n    if (\n      callingClass.prototype.loadState === this.loadState &&\n      callingClass.prototype.fromXml !== this.fromXml\n    ) {\n      this.fromXml(utilsXml.textToDom(state as string));\n      return true;\n    }\n    // Either they called this on purpose from their loadState, or they have\n    // no implementations of either hook. Just do our thing.\n    return false;\n  }\n\n  /**\n   * Dispose of all DOM objects and events belonging to this editable field.\n   *\n   * @internal\n   */\n  dispose() {\n    dropDownDiv.hideIfOwner(this);\n    WidgetDiv.hideIfOwner(this);\n\n    if (!this.getSourceBlock()?.isDeadOrDying()) {\n      dom.removeNode(this.fieldGroup_);\n    }\n\n    this.disposed = true;\n  }\n\n  /** Add or remove the UI indicating if this field is editable or not. */\n  updateEditable() {\n    const group = this.fieldGroup_;\n    const block = this.getSourceBlock();\n    if (!this.EDITABLE || !group || !block) {\n      return;\n    }\n    if (this.enabled_ && block.isEditable()) {\n      dom.addClass(group, 'blocklyEditableText');\n      dom.removeClass(group, 'blocklyNonEditableText');\n      group.style.cursor = this.CURSOR;\n    } else {\n      dom.addClass(group, 'blocklyNonEditableText');\n      dom.removeClass(group, 'blocklyEditableText');\n      group.style.cursor = '';\n    }\n  }\n\n  /**\n   * Set whether this field's value can be changed using the editor when the\n   *     source block is editable.\n   *\n   * @param enabled True if enabled.\n   */\n  setEnabled(enabled: boolean) {\n    this.enabled_ = enabled;\n    this.updateEditable();\n  }\n\n  /**\n   * Check whether this field's value can be changed using the editor when the\n   *     source block is editable.\n   *\n   * @returns Whether this field is enabled.\n   */\n  isEnabled(): boolean {\n    return this.enabled_;\n  }\n\n  /**\n   * Check whether this field defines the showEditor_ function.\n   *\n   * @returns Whether this field is clickable.\n   */\n  isClickable(): boolean {\n    return (\n      this.enabled_ &&\n      !!this.sourceBlock_ &&\n      this.sourceBlock_.isEditable() &&\n      this.showEditor_ !== Field.prototype.showEditor_\n    );\n  }\n\n  /**\n   * Check whether the field should be clickable while the block is in a flyout.\n   * The default is that fields are clickable in always-open flyouts such as the\n   * simple toolbox, but not in autoclosing flyouts such as the category toolbox.\n   * Subclasses may override this function to change this behavior. Note that\n   * `isClickable` must also return true for this to have any effect.\n   *\n   * @param autoClosingFlyout true if the containing flyout is an auto-closing one.\n   * @returns Whether the field should be clickable while the block is in a flyout.\n   */\n  isClickableInFlyout(autoClosingFlyout: boolean): boolean {\n    return !autoClosingFlyout;\n  }\n\n  /**\n   * Check whether this field is currently editable.  Some fields are never\n   * EDITABLE (e.g. text labels). Other fields may be EDITABLE but may exist on\n   * non-editable blocks or be currently disabled.\n   *\n   * @returns Whether this field is currently enabled, editable and on an\n   *     editable block.\n   */\n  isCurrentlyEditable(): boolean {\n    return (\n      this.enabled_ &&\n      this.EDITABLE &&\n      !!this.sourceBlock_ &&\n      this.sourceBlock_.isEditable()\n    );\n  }\n\n  /**\n   * Check whether this field should be serialized by the XML renderer.\n   * Handles the logic for backwards compatibility and incongruous states.\n   *\n   * @returns Whether this field should be serialized or not.\n   */\n  isSerializable(): boolean {\n    let isSerializable = false;\n    if (this.name) {\n      if (this.SERIALIZABLE) {\n        isSerializable = true;\n      } else if (this.EDITABLE) {\n        console.warn(\n          'Detected an editable field that was not serializable.' +\n            ' Please define SERIALIZABLE property as true on all editable custom' +\n            ' fields. Proceeding with serialization.',\n        );\n        isSerializable = true;\n      }\n    }\n    return isSerializable;\n  }\n\n  /**\n   * Gets whether this editable field is visible or not.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.visible_;\n  }\n\n  /**\n   * Sets whether this editable field is visible or not. Should only be called\n   * by input.setVisible.\n   *\n   * @param visible True if visible.\n   * @internal\n   */\n  setVisible(visible: boolean) {\n    if (this.visible_ === visible) {\n      return;\n    }\n    this.visible_ = visible;\n    const root = this.fieldGroup_;\n    if (root) {\n      root.style.display = visible ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Sets a new validation function for editable fields, or clears a previously\n   * set validator.\n   *\n   * The validator function takes in the new field value, and returns\n   * validated value. The validated value could be the input value, a modified\n   * version of the input value, or null to abort the change.\n   *\n   * If the function does not return anything (or returns undefined) the new\n   * value is accepted as valid. This is to allow for fields using the\n   * validated function as a field-level change event notification.\n   *\n   * @param handler The validator function or null to clear a previous\n   *     validator.\n   */\n  setValidator(handler: FieldValidator<T>) {\n    this.validator_ = handler;\n  }\n\n  /**\n   * Gets the validation function for editable fields, or null if not set.\n   *\n   * @returns Validation function, or null.\n   */\n  getValidator(): FieldValidator<T> | null {\n    return this.validator_;\n  }\n\n  /**\n   * Gets the group element for this editable field.\n   * Used for measuring the size and for positioning.\n   *\n   * @returns The group element.\n   */\n  getSvgRoot(): SVGGElement | null {\n    return this.fieldGroup_;\n  }\n\n  /**\n   * Gets the border rectangle element.\n   *\n   * @returns The border rectangle element.\n   * @throws An error if the border rectangle element is not defined.\n   */\n  protected getBorderRect(): SVGRectElement {\n    if (!this.borderRect_) {\n      throw new Error(`The border rectangle is ${this.borderRect_}.`);\n    }\n    return this.borderRect_;\n  }\n\n  /**\n   * Gets the text element.\n   *\n   * @returns The text element.\n   * @throws An error if the text element is not defined.\n   */\n  protected getTextElement(): SVGTextElement {\n    if (!this.textElement_) {\n      throw new Error(`The text element is ${this.textElement_}.`);\n    }\n    return this.textElement_;\n  }\n\n  /**\n   * Gets the text content.\n   *\n   * @returns The text content.\n   * @throws An error if the text content is not defined.\n   */\n  protected getTextContent(): Text {\n    if (!this.textContent_) {\n      throw new Error(`The text content is ${this.textContent_}.`);\n    }\n    return this.textContent_;\n  }\n\n  /**\n   * Updates the field to match the colour/style of the block.\n   *\n   * Non-abstract sub-classes may wish to implement this if the colour of the\n   * field depends on the colour of the block. It will automatically be called\n   * at relevant times, such as when the parent block or renderer changes.\n   *\n   * See {@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/customizing-fields/creating#matching_block_colours\n   * | the field documentation} for more information, or FieldDropdown for an\n   * example.\n   */\n  applyColour() {}\n\n  /**\n   * Used by getSize() to move/resize any DOM elements, and get the new size.\n   *\n   * All rendering that has an effect on the size/shape of the block should be\n   * done here, and should be triggered by getSize().\n   */\n  protected render_() {\n    if (this.textContent_) {\n      this.textContent_.nodeValue = this.getDisplayText_();\n    }\n    this.updateSize_();\n  }\n\n  /**\n   * Calls showEditor_ when the field is clicked if the field is clickable.\n   * Do not override.\n   *\n   * @param e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @sealed\n   * @internal\n   */\n  showEditor(e?: Event) {\n    if (this.isClickable()) {\n      this.showEditor_(e);\n    }\n  }\n\n  /**\n   * A developer hook to create an editor for the field. This is no-op by\n   * default, and must be overriden to create an editor.\n   *\n   * @param _e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   */\n  protected showEditor_(_e?: Event): void {}\n  // NOP\n\n  /**\n   * A developer hook to reposition the WidgetDiv during a window resize. You\n   * need to define this hook if your field has a WidgetDiv that needs to\n   * reposition itself when the window is resized. For example, text input\n   * fields define this hook so that the input WidgetDiv can reposition itself\n   * on a window resize event. This is especially important when modal inputs\n   * have been disabled, as Android devices will fire a window resize event when\n   * the soft keyboard opens.\n   *\n   * If you want the WidgetDiv to hide itself instead of repositioning, return\n   * false. This is the default behavior.\n   *\n   * DropdownDivs already handle their own positioning logic, so you do not need\n   * to override this function if your field only has a DropdownDiv.\n   *\n   * @returns True if the field should be repositioned,\n   *    false if the WidgetDiv should hide itself instead.\n   */\n  repositionForWindowResize(): boolean {\n    return false;\n  }\n\n  /**\n   * Updates the size of the field based on the text.\n   *\n   * @param margin margin to use when positioning the text element.\n   */\n  protected updateSize_(margin?: number) {\n    const constants = this.getConstants();\n    const xOffset =\n      margin !== undefined\n        ? margin\n        : !this.isFullBlockField()\n          ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\n          : 0;\n    let totalWidth = xOffset * 2;\n    let totalHeight = constants!.FIELD_TEXT_HEIGHT;\n\n    let contentWidth = 0;\n    if (this.textElement_) {\n      contentWidth = dom.getFastTextWidth(\n        this.textElement_,\n        constants!.FIELD_TEXT_FONTSIZE,\n        constants!.FIELD_TEXT_FONTWEIGHT,\n        constants!.FIELD_TEXT_FONTFAMILY,\n      );\n      totalWidth += contentWidth;\n    }\n    if (!this.isFullBlockField()) {\n      totalHeight = Math.max(totalHeight, constants!.FIELD_BORDER_RECT_HEIGHT);\n    }\n\n    this.size_.height = totalHeight;\n    this.size_.width = totalWidth;\n\n    this.positionTextElement_(xOffset, contentWidth);\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Position a field's text element after a size change.  This handles both LTR\n   * and RTL positioning.\n   *\n   * @param xOffset x offset to use when positioning the text element.\n   * @param contentWidth The content width.\n   */\n  protected positionTextElement_(xOffset: number, contentWidth: number) {\n    if (!this.textElement_) {\n      return;\n    }\n    const constants = this.getConstants();\n    const halfHeight = this.size_.height / 2;\n\n    this.textElement_.setAttribute(\n      'x',\n      String(\n        this.getSourceBlock()?.RTL\n          ? this.size_.width - contentWidth - xOffset\n          : xOffset,\n      ),\n    );\n    this.textElement_.setAttribute(\n      'y',\n      String(\n        constants!.FIELD_TEXT_BASELINE_CENTER\n          ? halfHeight\n          : halfHeight -\n              constants!.FIELD_TEXT_HEIGHT / 2 +\n              constants!.FIELD_TEXT_BASELINE,\n      ),\n    );\n  }\n\n  /** Position a field's border rect after a size change. */\n  protected positionBorderRect_() {\n    if (!this.borderRect_) {\n      return;\n    }\n    this.borderRect_.setAttribute('width', String(this.size_.width));\n    this.borderRect_.setAttribute('height', String(this.size_.height));\n    this.borderRect_.setAttribute(\n      'rx',\n      String(this.getConstants()!.FIELD_BORDER_RECT_RADIUS),\n    );\n    this.borderRect_.setAttribute(\n      'ry',\n      String(this.getConstants()!.FIELD_BORDER_RECT_RADIUS),\n    );\n  }\n\n  /**\n   * Returns the height and width of the field.\n   *\n   * This should *in general* be the only place render_ gets called from.\n   *\n   * @returns Height and width.\n   */\n  getSize(): Size {\n    if (!this.isVisible()) {\n      return new Size(0, 0);\n    }\n\n    if (this.isDirty_) {\n      this.render_();\n      this.isDirty_ = false;\n    } else if (this.visible_ && this.size_.width === 0) {\n      // If the field is not visible the width will be 0 as well, one of the\n      // problems with the old system.\n      this.render_();\n      // Don't issue a warning if the field is actually zero width.\n      if (this.size_.width !== 0) {\n        console.warn(\n          'Deprecated use of setting size_.width to 0 to rerender a' +\n            ' field. Set field.isDirty_ to true instead.',\n        );\n      }\n    }\n    return this.size_;\n  }\n\n  /**\n   * Returns the bounding box of the rendered field, accounting for workspace\n   * scaling.\n   *\n   * @returns An object with top, bottom, left, and right in pixels relative to\n   *     the top left corner of the page (window coordinates).\n   * @internal\n   */\n  getScaledBBox(): Rect {\n    let scaledWidth;\n    let scaledHeight;\n    let xy;\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n\n    if (this.isFullBlockField()) {\n      // Browsers are inconsistent in what they return for a bounding box.\n      // - Webkit / Blink: fill-box / object bounding box\n      // - Gecko: stroke-box\n      const bBox = (this.sourceBlock_ as BlockSvg).getHeightWidth();\n      const scale = (block.workspace as WorkspaceSvg).scale;\n      xy = this.getAbsoluteXY_();\n      scaledWidth = (bBox.width + 1) * scale;\n      scaledHeight = (bBox.height + 1) * scale;\n\n      if (userAgent.GECKO) {\n        xy.x += 1.5 * scale;\n        xy.y += 1.5 * scale;\n      } else {\n        xy.x -= 0.5 * scale;\n        xy.y -= 0.5 * scale;\n      }\n    } else {\n      const bBox = this.borderRect_!.getBoundingClientRect();\n      xy = style.getPageOffset(this.borderRect_!);\n      scaledWidth = bBox.width;\n      scaledHeight = bBox.height;\n    }\n    return new Rect(xy.y, xy.y + scaledHeight, xy.x, xy.x + scaledWidth);\n  }\n\n  /**\n   * Notifies the field that it has changed locations.\n   *\n   * @param _ The location of this field's block's top-start corner\n   *     in workspace coordinates.\n   */\n  onLocationChange(_: Coordinate) {}\n\n  /**\n   * Get the text from this field to display on the block. May differ from\n   * `getText` due to ellipsis, and other formatting.\n   *\n   * @returns Text to display.\n   */\n  protected getDisplayText_(): string {\n    let text = this.getText();\n    if (!text) {\n      // Prevent the field from disappearing if empty.\n      return Field.NBSP;\n    }\n    if (text.length > this.maxDisplayLength) {\n      // Truncate displayed string and add an ellipsis ('...').\n      text = text.substring(0, this.maxDisplayLength - 2) + '';\n    }\n    // Replace whitespace with non-breaking spaces so the text doesn't collapse.\n    text = text.replace(/\\s/g, Field.NBSP);\n    if (this.sourceBlock_ && this.sourceBlock_.RTL) {\n      // The SVG is LTR, force text to be RTL by adding an RLM.\n      text += '\\u200F';\n    }\n    return text;\n  }\n\n  /**\n   * Get the text from this field.\n   * Override getText_ to provide a different behavior than simply casting the\n   * value to a string.\n   *\n   * @returns Current text.\n   * @sealed\n   */\n  getText(): string {\n    // this.getText_ was intended so that devs don't have to remember to call\n    // super when overriding how the text of the field is generated. (#2910)\n    const text = this.getText_();\n    if (text !== null) {\n      return String(text);\n    }\n    return String(this.getValue());\n  }\n\n  /**\n   * A developer hook to override the returned text of this field.\n   * Override if the text representation of the value of this field\n   * is not just a string cast of its value.\n   * Return null to resort to a string cast.\n   *\n   * @returns Current text or null.\n   */\n  protected getText_(): string | null {\n    return null;\n  }\n\n  /**\n   * Force a rerender of the block that this field is installed on, which will\n   * rerender this field and adjust for any sizing changes.\n   * Other fields on the same block will not rerender, because their sizes have\n   * already been recorded.\n   *\n   * @internal\n   */\n  markDirty() {\n    this.isDirty_ = true;\n    this.constants_ = null;\n  }\n\n  /**\n   * Force a rerender of the block that this field is installed on, which will\n   * rerender this field and adjust for any sizing changes.\n   * Other fields on the same block will not rerender, because their sizes have\n   * already been recorded.\n   *\n   * @internal\n   */\n  forceRerender() {\n    this.isDirty_ = true;\n    if (this.sourceBlock_ && this.sourceBlock_.rendered) {\n      (this.sourceBlock_ as BlockSvg).queueRender();\n    }\n  }\n\n  /**\n   * Used to change the value of the field. Handles validation and events.\n   * Subclasses should override doClassValidation_ and doValueUpdate_ rather\n   * than this method.\n   *\n   * @param newValue New value.\n   * @param fireChangeEvent Whether to fire a change event. Defaults to true.\n   *     Should usually be true unless the change will be reported some other\n   *     way, e.g. an intermediate field change event.\n   * @sealed\n   */\n  setValue(newValue: AnyDuringMigration, fireChangeEvent = true) {\n    const doLogging = false;\n    if (newValue === null) {\n      if (doLogging) console.log('null, return');\n      // Not a valid value to check.\n      return;\n    }\n\n    // Field validators are allowed to make changes to the workspace, which\n    // should get grouped with the field value change event.\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n\n    try {\n      const classValidation = this.doClassValidation_(newValue);\n      const classValue = this.processValidation(\n        newValue,\n        classValidation,\n        fireChangeEvent,\n      );\n      if (classValue instanceof Error) {\n        if (doLogging) console.log('invalid class validation, return');\n        return;\n      }\n\n      const localValidation = this.getValidator()?.call(this, classValue);\n      const localValue = this.processValidation(\n        classValue,\n        localValidation,\n        fireChangeEvent,\n      );\n      if (localValue instanceof Error) {\n        if (doLogging) console.log('invalid local validation, return');\n        return;\n      }\n\n      const source = this.sourceBlock_;\n      if (source && source.disposed) {\n        if (doLogging) console.log('source disposed, return');\n        return;\n      }\n\n      const oldValue = this.getValue();\n      if (oldValue === localValue) {\n        if (doLogging) console.log('same, doValueUpdate_, return');\n        this.doValueUpdate_(localValue);\n        return;\n      }\n\n      this.doValueUpdate_(localValue);\n      if (fireChangeEvent && source && eventUtils.isEnabled()) {\n        eventUtils.fire(\n          new (eventUtils.get(EventType.BLOCK_CHANGE))(\n            source,\n            'field',\n            this.name || null,\n            oldValue,\n            localValue,\n          ),\n        );\n      }\n      if (this.isDirty_) {\n        this.forceRerender();\n      }\n      if (doLogging) console.log(this.value_);\n    } finally {\n      eventUtils.setGroup(existingGroup);\n    }\n  }\n\n  /**\n   * Process the result of validation.\n   *\n   * @param newValue New value.\n   * @param validatedValue Validated value.\n   * @param fireChangeEvent Whether to fire a change event if the value changes.\n   * @returns New value, or an Error object.\n   */\n  private processValidation(\n    newValue: AnyDuringMigration,\n    validatedValue: T | null | undefined,\n    fireChangeEvent: boolean,\n  ): T | Error {\n    if (validatedValue === null) {\n      this.doValueInvalid_(newValue, fireChangeEvent);\n      if (this.isDirty_) {\n        this.forceRerender();\n      }\n      return Error();\n    }\n    return validatedValue === undefined ? (newValue as T) : validatedValue;\n  }\n\n  /**\n   * Get the current value of the field.\n   *\n   * @returns Current value.\n   */\n  getValue(): T | null {\n    return this.value_;\n  }\n\n  /**\n   * Validate the changes to a field's value before they are set. See\n   * **FieldDropdown** for an example of subclass implementation.\n   *\n   * **NOTE:** Validation returns one option between `T`, `null`, and\n   * `undefined`. **Field**'s implementation will never return `undefined`, but\n   * it is valid for a subclass to return `undefined` if the new value is\n   * compatible with `T`.\n   *\n   * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n   * @param newValue - The value to be validated.\n   * @returns One of three instructions for setting the new value: `T`, `null`,\n   * or `undefined`.\n   *\n   * - `T` to set this function's returned value instead of `newValue`.\n   *\n   * - `null` to invoke `doValueInvalid_` and not set a value.\n   *\n   * - `undefined` to set `newValue` as is.\n   */\n  protected doClassValidation_(newValue: T): T | null | undefined;\n  protected doClassValidation_(newValue?: AnyDuringMigration): T | null;\n  protected doClassValidation_(\n    newValue?: T | AnyDuringMigration,\n  ): T | null | undefined {\n    if (newValue === null || newValue === undefined) {\n      return null;\n    }\n\n    return newValue as T;\n  }\n\n  /**\n   * Used to update the value of a field. Can be overridden by subclasses to do\n   * custom storage of values/updating of external things.\n   *\n   * @param newValue The value to be saved.\n   */\n  protected doValueUpdate_(newValue: T) {\n    this.value_ = newValue;\n    this.isDirty_ = true;\n  }\n\n  /**\n   * Used to notify the field an invalid value was input. Can be overridden by\n   * subclasses, see FieldTextInput.\n   * No-op by default.\n   *\n   * @param _invalidValue The input value that was determined to be invalid.\n   * @param _fireChangeEvent Whether to fire a change event if the value changes.\n   */\n  protected doValueInvalid_(\n    _invalidValue: AnyDuringMigration,\n    _fireChangeEvent: boolean = true,\n  ) {}\n  // NOP\n\n  /**\n   * Handle a pointerdown event on a field.\n   *\n   * @param e Pointer down event.\n   */\n  protected onMouseDown_(e: PointerEvent) {\n    if (!this.sourceBlock_ || this.sourceBlock_.isDeadOrDying()) {\n      return;\n    }\n    const gesture = (this.sourceBlock_.workspace as WorkspaceSvg).getGesture(e);\n    if (gesture) {\n      gesture.setStartField(this);\n    }\n  }\n\n  /**\n   * Sets the tooltip for this field.\n   *\n   * @param newTip The text for the tooltip, a function that returns the text\n   *     for the tooltip, a parent object whose tooltip will be used, or null to\n   *     display the tooltip of the parent block. To not display a tooltip pass\n   *     the empty string.\n   */\n  setTooltip(newTip: Tooltip.TipInfo | null) {\n    if (!newTip && newTip !== '') {\n      // If null or undefined.\n      newTip = this.sourceBlock_;\n    }\n    const clickTarget = this.getClickTarget_();\n    if (clickTarget) {\n      (clickTarget as AnyDuringMigration).tooltip = newTip;\n    } else {\n      // Field has not been initialized yet.\n      this.tooltip = newTip;\n    }\n  }\n\n  /**\n   * Returns the tooltip text for this field.\n   *\n   * @returns The tooltip text for this field.\n   */\n  getTooltip(): string {\n    const clickTarget = this.getClickTarget_();\n    if (clickTarget) {\n      return Tooltip.getTooltipOfObject(clickTarget);\n    }\n    // Field has not been initialized yet. Return stashed this.tooltip value.\n    return Tooltip.getTooltipOfObject({tooltip: this.tooltip});\n  }\n\n  /**\n   * The element to bind the click handler to. If not set explicitly, defaults\n   * to the SVG root of the field. When this element is\n   * clicked on an editable field, the editor will open.\n   *\n   * @returns Element to bind click handler to.\n   */\n  protected getClickTarget_(): Element | null {\n    return this.clickTarget_ || this.getSvgRoot();\n  }\n\n  /**\n   * Return the absolute coordinates of the top-left corner of this field.\n   * The origin (0,0) is the top-left corner of the page body.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  protected getAbsoluteXY_(): Coordinate {\n    return style.getPageOffset(this.getClickTarget_() as SVGRectElement);\n  }\n\n  /**\n   * Whether this field references any Blockly variables.  If true it may need\n   * to be handled differently during serialization and deserialization.\n   * Subclasses may override this.\n   *\n   * @returns True if this field has any variable references.\n   * @internal\n   */\n  referencesVariables(): boolean {\n    return false;\n  }\n\n  /**\n   * Refresh the variable name referenced by this field if this field references\n   * variables.\n   *\n   * @internal\n   */\n  refreshVariableName() {}\n  // NOP\n\n  /**\n   * Search through the list of inputs and their fields in order to find the\n   * parent input of a field.\n   *\n   * @returns The input that the field belongs to.\n   * @internal\n   */\n  getParentInput(): Input {\n    let parentInput = null;\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const inputs = block.inputList;\n\n    for (let idx = 0; idx < block.inputList.length; idx++) {\n      const input = inputs[idx];\n      const fieldRows = input.fieldRow;\n      for (let j = 0; j < fieldRows.length; j++) {\n        if (fieldRows[j] === this) {\n          parentInput = input;\n          break;\n        }\n      }\n    }\n    return parentInput!;\n  }\n\n  /**\n   * Returns whether or not we should flip the field in RTL.\n   *\n   * @returns True if we should flip in RTL.\n   */\n  getFlipRtl(): boolean {\n    return false;\n  }\n\n  /**\n   * Returns whether or not the field is tab navigable.\n   *\n   * @returns True if the field is tab navigable.\n   */\n  isTabNavigable(): boolean {\n    return false;\n  }\n\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param _shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(_shortcut: KeyboardShortcut): boolean {\n    return false;\n  }\n\n  /**\n   * Add the cursor SVG to this fields SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the field group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    if (!cursorSvg) {\n      this.cursorSvg = null;\n      return;\n    }\n\n    if (!this.fieldGroup_) {\n      throw new Error(`The field group is ${this.fieldGroup_}.`);\n    }\n    this.fieldGroup_.appendChild(cursorSvg);\n    this.cursorSvg = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this fields SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the field group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    if (!markerSvg) {\n      this.markerSvg = null;\n      return;\n    }\n\n    if (!this.fieldGroup_) {\n      throw new Error(`The field group is ${this.fieldGroup_}.`);\n    }\n    this.fieldGroup_.appendChild(markerSvg);\n    this.markerSvg = markerSvg;\n  }\n\n  /**\n   * Redraw any attached marker or cursor svgs if needed.\n   *\n   * @internal\n   */\n  updateMarkers_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const workspace = block.workspace as WorkspaceSvg;\n    if (workspace.keyboardAccessibilityMode && this.cursorSvg) {\n      workspace.getCursor()!.draw();\n    }\n    if (workspace.keyboardAccessibilityMode && this.markerSvg) {\n      // TODO(#4592): Update all markers on the field.\n      workspace.getMarker(MarkerManager.LOCAL_MARKER)!.draw();\n    }\n  }\n\n  /**\n   * Subclasses should reimplement this method to construct their Field\n   * subclass from a JSON arg object.\n   *\n   * It is an error to attempt to register a field subclass in the\n   * FieldRegistry if that subclass has not overridden this method.\n   *\n   * @param _options JSON configuration object with properties needed\n   *    to configure a specific field.\n   */\n  static fromJson(_options: FieldConfig): Field {\n    throw new Error(\n      `Attempted to instantiate a field from the registry that hasn't defined a 'fromJson' method.`,\n    );\n  }\n}\n\n/**\n * Extra configuration options for the base field.\n */\nexport interface FieldConfig {\n  tooltip?: string;\n}\n\n/**\n * Represents an object that has all the prototype properties of the `Field`\n * class. This is necessary because constructors can change\n * in descendants, though they should contain all of Field's prototype methods.\n *\n * This type should only be used in places where we directly access the prototype\n * of a Field class or subclass.\n */\ntype FieldProto = Pick<typeof Field, 'prototype'>;\n\n/**\n * Represents an error where the field is trying to access its block or\n * information about its block before it has actually been attached to said\n * block.\n */\nexport class UnattachedFieldError extends Error {\n  /** @internal */\n  constructor() {\n    super(\n      'The field has not yet been attached to its input. ' +\n        'Call appendField to attach it.',\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Registry for context menu option items.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ContextMenuRegistry\n\nimport type {BlockSvg} from './block_svg.js';\nimport {RenderedWorkspaceComment} from './comments/rendered_workspace_comment.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for the registry of context menu items. This is intended to be a\n * singleton. You should not create a new instance, and only access this class\n * from ContextMenuRegistry.registry.\n */\nexport class ContextMenuRegistry {\n  static registry: ContextMenuRegistry;\n  /** Registry of all registered RegistryItems, keyed by ID. */\n  private registeredItems = new Map<string, RegistryItem>();\n\n  /** Resets the existing singleton instance of ContextMenuRegistry. */\n  constructor() {\n    this.reset();\n  }\n\n  /** Clear and recreate the registry. */\n  reset() {\n    this.registeredItems.clear();\n  }\n\n  /**\n   * Registers a RegistryItem.\n   *\n   * @param item Context menu item to register.\n   * @throws {Error} if an item with the given ID already exists.\n   */\n  register(item: RegistryItem) {\n    if (this.registeredItems.has(item.id)) {\n      throw Error('Menu item with ID \"' + item.id + '\" is already registered.');\n    }\n    this.registeredItems.set(item.id, item);\n  }\n\n  /**\n   * Unregisters a RegistryItem with the given ID.\n   *\n   * @param id The ID of the RegistryItem to remove.\n   * @throws {Error} if an item with the given ID does not exist.\n   */\n  unregister(id: string) {\n    if (!this.registeredItems.has(id)) {\n      throw new Error('Menu item with ID \"' + id + '\" not found.');\n    }\n    this.registeredItems.delete(id);\n  }\n\n  /**\n   * @param id The ID of the RegistryItem to get.\n   * @returns RegistryItem or null if not found\n   */\n  getItem(id: string): RegistryItem | null {\n    return this.registeredItems.get(id) ?? null;\n  }\n\n  /**\n   * Gets the valid context menu options for the given scope type (e.g. block or\n   * workspace) and scope. Blocks are only shown if the preconditionFn shows\n   * they should not be hidden.\n   *\n   * @param scopeType Type of scope where menu should be shown (e.g. on a block\n   *     or on a workspace)\n   * @param scope Current scope of context menu (i.e., the exact workspace or\n   *     block being clicked on)\n   * @returns the list of ContextMenuOptions\n   */\n  getContextMenuOptions(\n    scopeType: ScopeType,\n    scope: Scope,\n  ): ContextMenuOption[] {\n    const menuOptions: ContextMenuOption[] = [];\n    for (const item of this.registeredItems.values()) {\n      if (scopeType === item.scopeType) {\n        const precondition = item.preconditionFn(scope);\n        if (precondition !== 'hidden') {\n          const displayText =\n            typeof item.displayText === 'function'\n              ? item.displayText(scope)\n              : item.displayText;\n          const menuOption: ContextMenuOption = {\n            text: displayText,\n            enabled: precondition === 'enabled',\n            callback: item.callback,\n            scope,\n            weight: item.weight,\n          };\n          menuOptions.push(menuOption);\n        }\n      }\n    }\n    menuOptions.sort(function (a, b) {\n      return a.weight - b.weight;\n    });\n    return menuOptions;\n  }\n}\n\nexport namespace ContextMenuRegistry {\n  /**\n   * Where this menu item should be rendered. If the menu item should be\n   * rendered in multiple scopes, e.g. on both a block and a workspace, it\n   * should be registered for each scope.\n   */\n  export enum ScopeType {\n    BLOCK = 'block',\n    WORKSPACE = 'workspace',\n    COMMENT = 'comment',\n  }\n\n  /**\n   * The actual workspace/block where the menu is being rendered. This is passed\n   * to callback and displayText functions that depend on this information.\n   */\n  export interface Scope {\n    block?: BlockSvg;\n    workspace?: WorkspaceSvg;\n    comment?: RenderedWorkspaceComment;\n  }\n\n  /**\n   * A menu item as entered in the registry.\n   */\n  export interface RegistryItem {\n    /**\n     * @param scope Object that provides a reference to the thing that had its\n     *     context menu opened.\n     * @param e The original event that triggered the context menu to open. Not\n     *     the event that triggered the click on the option.\n     */\n    callback: (scope: Scope, e: PointerEvent) => void;\n    scopeType: ScopeType;\n    displayText: ((p1: Scope) => string | HTMLElement) | string | HTMLElement;\n    preconditionFn: (p1: Scope) => string;\n    weight: number;\n    id: string;\n  }\n\n  /**\n   * A menu item as presented to contextmenu.js.\n   */\n  export interface ContextMenuOption {\n    text: string | HTMLElement;\n    enabled: boolean;\n    /**\n     * @param scope Object that provides a reference to the thing that had its\n     *     context menu opened.\n     * @param e The original event that triggered the context menu to open. Not\n     *     the event that triggered the click on the option.\n     */\n    callback: (scope: Scope, e: PointerEvent) => void;\n    scope: Scope;\n    weight: number;\n  }\n\n  /**\n   * A subset of ContextMenuOption corresponding to what was publicly\n   * documented.  ContextMenuOption should be preferred for new code.\n   */\n  export interface LegacyContextMenuOption {\n    text: string;\n    enabled: boolean;\n    callback: (p1: Scope) => void;\n  }\n\n  /**\n   * Singleton instance of this class. All interactions with this class should\n   * be done on this object.\n   */\n  ContextMenuRegistry.registry = new ContextMenuRegistry();\n}\n\nexport type ScopeType = ContextMenuRegistry.ScopeType;\nexport const ScopeType = ContextMenuRegistry.ScopeType;\nexport type Scope = ContextMenuRegistry.Scope;\nexport type RegistryItem = ContextMenuRegistry.RegistryItem;\nexport type ContextMenuOption = ContextMenuRegistry.ContextMenuOption;\nexport type LegacyContextMenuOption =\n  ContextMenuRegistry.LegacyContextMenuOption;\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The layer to place blocks on.\n *\n */\nexport const BLOCK = 50;\n\n/**\n * The layer to place bubbles on.\n *\n */\nexport const BUBBLE = 100;\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {RenderedWorkspaceComment} from '../comments.js';\nimport {CommentMove} from '../events/events_comment_move.js';\nimport {EventType} from '../events/type.js';\nimport * as eventUtils from '../events/utils.js';\nimport {IDragStrategy} from '../interfaces/i_draggable.js';\nimport * as layers from '../layers.js';\nimport {Coordinate} from '../utils.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\nexport class CommentDragStrategy implements IDragStrategy {\n  private startLoc: Coordinate | null = null;\n\n  private workspace: WorkspaceSvg;\n\n  /** Was there already an event group in progress when the drag started? */\n  private inGroup: boolean = false;\n\n  constructor(private comment: RenderedWorkspaceComment) {\n    this.workspace = comment.workspace;\n  }\n\n  isMovable(): boolean {\n    return (\n      this.comment.isOwnMovable() &&\n      !this.comment.isDeadOrDying() &&\n      !this.workspace.options.readOnly\n    );\n  }\n\n  startDrag(): void {\n    this.inGroup = !!eventUtils.getGroup();\n    if (!this.inGroup) {\n      eventUtils.setGroup(true);\n    }\n    this.fireDragStartEvent();\n    this.startLoc = this.comment.getRelativeToSurfaceXY();\n    this.workspace.setResizesEnabled(false);\n    this.workspace.getLayerManager()?.moveToDragLayer(this.comment);\n    this.comment.setDragging(true);\n  }\n\n  drag(newLoc: Coordinate): void {\n    this.comment.moveDuringDrag(newLoc);\n  }\n\n  endDrag(): void {\n    this.fireDragEndEvent();\n    this.fireMoveEvent();\n\n    this.workspace\n      .getLayerManager()\n      ?.moveOffDragLayer(this.comment, layers.BLOCK);\n    this.comment.setDragging(false);\n\n    this.comment.snapToGrid();\n\n    this.workspace.setResizesEnabled(true);\n    if (!this.inGroup) {\n      eventUtils.setGroup(false);\n    }\n  }\n\n  /** Fire a UI event at the start of a comment drag. */\n  private fireDragStartEvent() {\n    const event = new (eventUtils.get(EventType.COMMENT_DRAG))(\n      this.comment,\n      true,\n    );\n    eventUtils.fire(event);\n  }\n\n  /** Fire a UI event at the end of a comment drag. */\n  private fireDragEndEvent() {\n    const event = new (eventUtils.get(EventType.COMMENT_DRAG))(\n      this.comment,\n      false,\n    );\n    eventUtils.fire(event);\n  }\n\n  /** Fire a move event at the end of a comment drag. */\n  private fireMoveEvent() {\n    if (this.comment.isDeadOrDying()) return;\n    const event = new (eventUtils.get(EventType.COMMENT_MOVE))(\n      this.comment,\n    ) as CommentMove;\n    event.setReason(['drag']);\n    event.oldCoordinate_ = this.startLoc!;\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  revertDrag(): void {\n    if (this.startLoc) this.comment.moveDuringDrag(this.startLoc);\n  }\n}\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as browserEvents from '../browser_events.js';\nimport * as css from '../css.js';\nimport {IRenderedElement} from '../interfaces/i_rendered_element.js';\nimport * as layers from '../layers.js';\nimport * as touch from '../touch.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport * as drag from '../utils/drag.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\nexport class CommentView implements IRenderedElement {\n  /** The root group element of the comment view. */\n  private svgRoot: SVGGElement;\n\n  /**\n   * The svg rect element that we use to create a hightlight around the comment.\n   */\n  private highlightRect: SVGRectElement;\n\n  /** The group containing all of the top bar elements. */\n  private topBarGroup: SVGGElement;\n\n  /** The rect background for the top bar. */\n  private topBarBackground: SVGRectElement;\n\n  /** The delete icon that goes in the top bar. */\n  private deleteIcon: SVGImageElement;\n\n  /** The foldout icon that goes in the top bar. */\n  private foldoutIcon: SVGImageElement;\n\n  /** The text element that goes in the top bar. */\n  private textPreview: SVGTextElement;\n\n  /** The actual text node in the text preview. */\n  private textPreviewNode: Text;\n\n  /** The resize handle element. */\n  private resizeHandle: SVGImageElement;\n\n  /** The foreignObject containing the HTML text area. */\n  private foreignObject: SVGForeignObjectElement;\n\n  /** The text area where the user can type. */\n  private textArea: HTMLTextAreaElement;\n\n  /** The current size of the comment in workspace units. */\n  private size: Size = new Size(120, 100);\n\n  /** Whether the comment is collapsed or not. */\n  private collapsed: boolean = false;\n\n  /** Whether the comment is editable or not. */\n  private editable: boolean = true;\n\n  /** The current location of the comment in workspace coordinates. */\n  private location: Coordinate = new Coordinate(0, 0);\n\n  /** The current text of the comment. Updates on  text area change. */\n  private text: string = '';\n\n  /** Listeners for changes to text. */\n  private textChangeListeners: Array<\n    (oldText: string, newText: string) => void\n  > = [];\n\n  /** Listeners for changes to size. */\n  private sizeChangeListeners: Array<(oldSize: Size, newSize: Size) => void> =\n    [];\n\n  /** Listeners for disposal. */\n  private disposeListeners: Array<() => void> = [];\n\n  /** Listeners for collapsing. */\n  private collapseChangeListeners: Array<(newCollapse: boolean) => void> = [];\n\n  /**\n   * Event data for the pointer up event on the resize handle. Used to\n   * unregister the listener.\n   */\n  private resizePointerUpListener: browserEvents.Data | null = null;\n\n  /**\n   * Event data for the pointer move event on the resize handle. Used to\n   * unregister the listener.\n   */\n  private resizePointerMoveListener: browserEvents.Data | null = null;\n\n  /** Whether this comment view is currently being disposed or not. */\n  private disposing = false;\n\n  /** Whether this comment view has been disposed or not. */\n  private disposed = false;\n\n  /** Size of this comment when the resize drag was initiated. */\n  private preResizeSize?: Size;\n\n  constructor(private readonly workspace: WorkspaceSvg) {\n    this.svgRoot = dom.createSvgElement(Svg.G, {\n      'class': 'blocklyComment blocklyEditable blocklyDraggable',\n    });\n\n    this.highlightRect = this.createHighlightRect(this.svgRoot);\n\n    ({\n      topBarGroup: this.topBarGroup,\n      topBarBackground: this.topBarBackground,\n      deleteIcon: this.deleteIcon,\n      foldoutIcon: this.foldoutIcon,\n      textPreview: this.textPreview,\n      textPreviewNode: this.textPreviewNode,\n    } = this.createTopBar(this.svgRoot, workspace));\n\n    ({foreignObject: this.foreignObject, textArea: this.textArea} =\n      this.createTextArea(this.svgRoot));\n\n    this.resizeHandle = this.createResizeHandle(this.svgRoot, workspace);\n\n    // TODO: Remove this comment before merging.\n    // I think we want comments to exist on the same layer as blocks.\n    workspace.getLayerManager()?.append(this, layers.BLOCK);\n\n    // Set size to the default size.\n    this.setSizeWithoutFiringEvents(this.size);\n\n    // Set default transform (including inverted scale for RTL).\n    this.moveTo(new Coordinate(0, 0));\n  }\n\n  /**\n   * Creates the rect we use for highlighting the comment when it's selected.\n   */\n  private createHighlightRect(svgRoot: SVGGElement): SVGRectElement {\n    return dom.createSvgElement(\n      Svg.RECT,\n      {'class': 'blocklyCommentHighlight'},\n      svgRoot,\n    );\n  }\n\n  /**\n   * Creates the top bar and the elements visually within it.\n   * Registers event listeners.\n   */\n  private createTopBar(\n    svgRoot: SVGGElement,\n    workspace: WorkspaceSvg,\n  ): {\n    topBarGroup: SVGGElement;\n    topBarBackground: SVGRectElement;\n    deleteIcon: SVGImageElement;\n    foldoutIcon: SVGImageElement;\n    textPreview: SVGTextElement;\n    textPreviewNode: Text;\n  } {\n    const topBarGroup = dom.createSvgElement(\n      Svg.G,\n      {\n        'class': 'blocklyCommentTopbar',\n      },\n      svgRoot,\n    );\n    const topBarBackground = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyCommentTopbarBackground',\n      },\n      topBarGroup,\n    );\n    // TODO: Before merging, does this mean to override an individual image,\n    // folks need to replace the whole media folder?\n    const deleteIcon = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'class': 'blocklyDeleteIcon',\n        'href': `${workspace.options.pathToMedia}delete-icon.svg`,\n      },\n      topBarGroup,\n    );\n    const foldoutIcon = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'class': 'blocklyFoldoutIcon',\n        'href': `${workspace.options.pathToMedia}foldout-icon.svg`,\n      },\n      topBarGroup,\n    );\n    const textPreview = dom.createSvgElement(\n      Svg.TEXT,\n      {\n        'class': 'blocklyCommentPreview blocklyCommentText blocklyText',\n      },\n      topBarGroup,\n    );\n    const textPreviewNode = document.createTextNode('');\n    textPreview.appendChild(textPreviewNode);\n\n    // TODO(toychest): Triggering this on pointerdown means that we can't start\n    //   drags on the foldout icon. We need to open up the gesture system\n    //   to fix this.\n    browserEvents.conditionalBind(\n      foldoutIcon,\n      'pointerdown',\n      this,\n      this.onFoldoutDown,\n    );\n    browserEvents.conditionalBind(\n      deleteIcon,\n      'pointerdown',\n      this,\n      this.onDeleteDown,\n    );\n\n    return {\n      topBarGroup,\n      topBarBackground,\n      deleteIcon,\n      foldoutIcon,\n      textPreview,\n      textPreviewNode,\n    };\n  }\n\n  /**\n   * Creates the text area where users can type. Registers event listeners.\n   */\n  private createTextArea(svgRoot: SVGGElement): {\n    foreignObject: SVGForeignObjectElement;\n    textArea: HTMLTextAreaElement;\n  } {\n    const foreignObject = dom.createSvgElement(\n      Svg.FOREIGNOBJECT,\n      {\n        'class': 'blocklyCommentForeignObject',\n      },\n      svgRoot,\n    );\n    const body = document.createElementNS(dom.HTML_NS, 'body');\n    body.setAttribute('xmlns', dom.HTML_NS);\n    body.className = 'blocklyMinimalBody';\n    const textArea = document.createElementNS(\n      dom.HTML_NS,\n      'textarea',\n    ) as HTMLTextAreaElement;\n    dom.addClass(textArea, 'blocklyCommentText');\n    dom.addClass(textArea, 'blocklyTextarea');\n    dom.addClass(textArea, 'blocklyText');\n    body.appendChild(textArea);\n    foreignObject.appendChild(body);\n\n    browserEvents.conditionalBind(textArea, 'change', this, this.onTextChange);\n\n    return {foreignObject, textArea};\n  }\n\n  /** Creates the DOM elements for the comment resize handle. */\n  private createResizeHandle(\n    svgRoot: SVGGElement,\n    workspace: WorkspaceSvg,\n  ): SVGImageElement {\n    const resizeHandle = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'class': 'blocklyResizeHandle',\n        'href': `${workspace.options.pathToMedia}resize-handle.svg`,\n      },\n      svgRoot,\n    );\n\n    browserEvents.conditionalBind(\n      resizeHandle,\n      'pointerdown',\n      this,\n      this.onResizePointerDown,\n    );\n\n    return resizeHandle;\n  }\n\n  /** Returns the root SVG group element of the comment view. */\n  getSvgRoot(): SVGGElement {\n    return this.svgRoot;\n  }\n\n  /**\n   * Returns the current size of the comment in workspace units.\n   * Respects collapsing.\n   */\n  getSize(): Size {\n    return this.collapsed ? this.topBarBackground.getBBox() : this.size;\n  }\n\n  /**\n   * Sets the size of the comment in workspace units, and updates the view\n   * elements to reflect the new size.\n   */\n  setSizeWithoutFiringEvents(size: Size) {\n    const topBarSize = this.topBarBackground.getBBox();\n    const deleteSize = this.deleteIcon.getBBox();\n    const foldoutSize = this.foldoutIcon.getBBox();\n    const textPreviewSize = this.textPreview.getBBox();\n    const resizeSize = this.resizeHandle.getBBox();\n\n    size = Size.max(\n      size,\n      this.calcMinSize(topBarSize, foldoutSize, deleteSize),\n    );\n    this.size = size;\n\n    this.svgRoot.setAttribute('height', `${size.height}`);\n    this.svgRoot.setAttribute('width', `${size.width}`);\n\n    this.updateHighlightRect(size);\n    this.updateTopBarSize(size);\n    this.updateTextAreaSize(size, topBarSize);\n    this.updateDeleteIconPosition(size, topBarSize, deleteSize);\n    this.updateFoldoutIconPosition(topBarSize, foldoutSize);\n    this.updateTextPreviewSize(\n      size,\n      topBarSize,\n      textPreviewSize,\n      deleteSize,\n      resizeSize,\n    );\n    this.updateResizeHandlePosition(size, resizeSize);\n  }\n\n  /**\n   * Sets the size of the comment in workspace units, updates the view\n   * elements to reflect the new size, and triggers size change listeners.\n   */\n  setSize(size: Size) {\n    const oldSize = this.preResizeSize || this.size;\n    this.setSizeWithoutFiringEvents(size);\n    this.onSizeChange(oldSize, this.size);\n  }\n\n  /**\n   * Calculates the minimum size for the uncollapsed comment based on text\n   * size and visible icons.\n   *\n   * The minimum width is based on the width of the truncated preview text.\n   *\n   * The minimum height is based on the height of the top bar.\n   */\n  private calcMinSize(\n    topBarSize: Size,\n    foldoutSize: Size,\n    deleteSize: Size,\n  ): Size {\n    this.updateTextPreview(this.textArea.value ?? '');\n    const textPreviewWidth = dom.getTextWidth(this.textPreview);\n\n    const foldoutMargin = this.calcFoldoutMargin(topBarSize, foldoutSize);\n    const deleteMargin = this.calcDeleteMargin(topBarSize, deleteSize);\n\n    let width = textPreviewWidth;\n    if (this.foldoutIcon.checkVisibility()) {\n      width += foldoutSize.width + foldoutMargin * 2;\n    } else if (textPreviewWidth) {\n      width += 4; // Arbitrary margin before text.\n    }\n    if (this.deleteIcon.checkVisibility()) {\n      width += deleteSize.width + deleteMargin * 2;\n    } else if (textPreviewWidth) {\n      width += 4; // Arbitrary margin after text.\n    }\n\n    // Arbitrary additional height.\n    const height = topBarSize.height + 20;\n\n    return new Size(width, height);\n  }\n\n  /** Calculates the margin that should exist around the delete icon. */\n  private calcDeleteMargin(topBarSize: Size, deleteSize: Size) {\n    return (topBarSize.height - deleteSize.height) / 2;\n  }\n\n  /** Calculates the margin that should exist around the foldout icon. */\n  private calcFoldoutMargin(topBarSize: Size, foldoutSize: Size) {\n    return (topBarSize.height - foldoutSize.height) / 2;\n  }\n\n  /** Updates the size of the highlight rect to reflect the new size. */\n  private updateHighlightRect(size: Size) {\n    this.highlightRect.setAttribute('height', `${size.height}`);\n    this.highlightRect.setAttribute('width', `${size.width}`);\n    if (this.workspace.RTL) {\n      this.highlightRect.setAttribute('x', `${-size.width}`);\n    }\n  }\n\n  /** Updates the size of the top bar to reflect the new size. */\n  private updateTopBarSize(size: Size) {\n    this.topBarBackground.setAttribute('width', `${size.width}`);\n  }\n\n  /** Updates the size of the text area elements to reflect the new size. */\n  private updateTextAreaSize(size: Size, topBarSize: Size) {\n    this.foreignObject.setAttribute(\n      'height',\n      `${size.height - topBarSize.height}`,\n    );\n    this.foreignObject.setAttribute('width', `${size.width}`);\n    this.foreignObject.setAttribute('y', `${topBarSize.height}`);\n    if (this.workspace.RTL) {\n      this.foreignObject.setAttribute('x', `${-size.width}`);\n    }\n  }\n\n  /**\n   * Updates the position of the delete icon elements to reflect the new size.\n   */\n  private updateDeleteIconPosition(\n    size: Size,\n    topBarSize: Size,\n    deleteSize: Size,\n  ) {\n    const deleteMargin = this.calcDeleteMargin(topBarSize, deleteSize);\n    this.deleteIcon.setAttribute('y', `${deleteMargin}`);\n    this.deleteIcon.setAttribute(\n      'x',\n      `${size.width - deleteSize.width - deleteMargin}`,\n    );\n  }\n\n  /**\n   * Updates the position of the foldout icon elements to reflect the new size.\n   */\n  private updateFoldoutIconPosition(topBarSize: Size, foldoutSize: Size) {\n    const foldoutMargin = this.calcFoldoutMargin(topBarSize, foldoutSize);\n    this.foldoutIcon.setAttribute('y', `${foldoutMargin}`);\n    this.foldoutIcon.setAttribute('x', `${foldoutMargin}`);\n  }\n\n  /**\n   * Updates the size and position of the text preview elements to reflect the new size.\n   */\n  private updateTextPreviewSize(\n    size: Size,\n    topBarSize: Size,\n    textPreviewSize: Size,\n    deleteSize: Size,\n    foldoutSize: Size,\n  ) {\n    const textPreviewMargin = (topBarSize.height - textPreviewSize.height) / 2;\n    const deleteMargin = this.calcDeleteMargin(topBarSize, deleteSize);\n    const foldoutMargin = this.calcFoldoutMargin(topBarSize, foldoutSize);\n\n    const textPreviewWidth =\n      size.width -\n      foldoutSize.width -\n      foldoutMargin * 2 -\n      deleteSize.width -\n      deleteMargin * 2;\n    this.textPreview.setAttribute(\n      'x',\n      `${\n        foldoutSize.width + foldoutMargin * 2 * (this.workspace.RTL ? -1 : 1)\n      }`,\n    );\n    this.textPreview.setAttribute(\n      'y',\n      `${textPreviewMargin + textPreviewSize.height / 2}`,\n    );\n    this.textPreview.setAttribute('width', `${textPreviewWidth}`);\n  }\n\n  /** Updates the position of the resize handle to reflect the new size. */\n  private updateResizeHandlePosition(size: Size, resizeSize: Size) {\n    this.resizeHandle.setAttribute('y', `${size.height - resizeSize.height}`);\n    this.resizeHandle.setAttribute('x', `${size.width - resizeSize.width}`);\n  }\n\n  /**\n   * Triggers listeners when the size of the comment changes, either\n   * programmatically or manually by the user.\n   */\n  private onSizeChange(oldSize: Size, newSize: Size) {\n    // Loop through listeners backwards in case they remove themselves.\n    for (let i = this.sizeChangeListeners.length - 1; i >= 0; i--) {\n      this.sizeChangeListeners[i](oldSize, newSize);\n    }\n  }\n\n  /**\n   * Registers a callback that listens for size changes.\n   *\n   * @param listener Receives callbacks when the size of the comment changes.\n   *     The new and old size are in workspace units.\n   */\n  addSizeChangeListener(listener: (oldSize: Size, newSize: Size) => void) {\n    this.sizeChangeListeners.push(listener);\n  }\n\n  /** Removes the given listener from the list of size change listeners. */\n  removeSizeChangeListener(listener: () => void) {\n    this.sizeChangeListeners.splice(\n      this.sizeChangeListeners.indexOf(listener),\n      1,\n    );\n  }\n\n  /**\n   * Handles starting an interaction with the resize handle to resize the\n   * comment.\n   */\n  private onResizePointerDown(e: PointerEvent) {\n    if (!this.isEditable()) return;\n\n    this.bringToFront();\n    if (browserEvents.isRightButton(e)) {\n      e.stopPropagation();\n      return;\n    }\n\n    this.preResizeSize = this.getSize();\n\n    drag.start(\n      this.workspace,\n      e,\n      new Coordinate(\n        this.workspace.RTL ? -this.getSize().width : this.getSize().width,\n        this.getSize().height,\n      ),\n    );\n\n    this.resizePointerUpListener = browserEvents.conditionalBind(\n      document,\n      'pointerup',\n      this,\n      this.onResizePointerUp,\n    );\n    this.resizePointerMoveListener = browserEvents.conditionalBind(\n      document,\n      'pointermove',\n      this,\n      this.onResizePointerMove,\n    );\n\n    this.workspace.hideChaff();\n\n    e.stopPropagation();\n  }\n\n  /** Ends an interaction with the resize handle. */\n  private onResizePointerUp(_e: PointerEvent) {\n    touch.clearTouchIdentifier();\n    if (this.resizePointerUpListener) {\n      browserEvents.unbind(this.resizePointerUpListener);\n      this.resizePointerUpListener = null;\n    }\n    if (this.resizePointerMoveListener) {\n      browserEvents.unbind(this.resizePointerMoveListener);\n      this.resizePointerMoveListener = null;\n    }\n    // When ending a resize drag, notify size change listeners to fire an event.\n    this.setSize(this.size);\n    this.preResizeSize = undefined;\n  }\n\n  /** Resizes the comment in response to a drag on the resize handle. */\n  private onResizePointerMove(e: PointerEvent) {\n    const size = drag.move(this.workspace, e);\n    this.setSizeWithoutFiringEvents(\n      new Size(this.workspace.RTL ? -size.x : size.x, size.y),\n    );\n  }\n\n  /** Returns true if the comment is currently collapsed. */\n  isCollapsed(): boolean {\n    return this.collapsed;\n  }\n\n  /** Sets whether the comment is currently collapsed or not. */\n  setCollapsed(collapsed: boolean) {\n    this.collapsed = collapsed;\n    if (collapsed) {\n      dom.addClass(this.svgRoot, 'blocklyCollapsed');\n    } else {\n      dom.removeClass(this.svgRoot, 'blocklyCollapsed');\n    }\n    // Repositions resize handle and such.\n    this.setSizeWithoutFiringEvents(this.size);\n    this.onCollapse();\n  }\n\n  /**\n   * Triggers listeners when the collapsed-ness of the comment changes, either\n   * progrmatically or manually by the user.\n   */\n  private onCollapse() {\n    // Loop through listeners backwards in case they remove themselves.\n    for (let i = this.collapseChangeListeners.length - 1; i >= 0; i--) {\n      this.collapseChangeListeners[i](this.collapsed);\n    }\n  }\n\n  /** Registers a callback that listens for collapsed-ness changes. */\n  addOnCollapseListener(listener: (newCollapse: boolean) => void) {\n    this.collapseChangeListeners.push(listener);\n  }\n\n  /** Removes the given listener from the list of on collapse listeners. */\n  removeOnCollapseListener(listener: () => void) {\n    this.collapseChangeListeners.splice(\n      this.collapseChangeListeners.indexOf(listener),\n      1,\n    );\n  }\n\n  /**\n   * Toggles the collapsedness of the block when we receive a pointer down\n   * event on the foldout icon.\n   */\n  private onFoldoutDown(e: PointerEvent) {\n    touch.clearTouchIdentifier();\n    this.bringToFront();\n    if (browserEvents.isRightButton(e)) {\n      e.stopPropagation();\n      return;\n    }\n\n    this.setCollapsed(!this.collapsed);\n\n    this.workspace.hideChaff();\n\n    e.stopPropagation();\n  }\n\n  /** Returns true if the comment is currently editable. */\n  isEditable(): boolean {\n    return this.editable;\n  }\n\n  /** Sets the editability of the comment. */\n  setEditable(editable: boolean) {\n    this.editable = editable;\n    if (this.editable) {\n      dom.addClass(this.svgRoot, 'blocklyEditable');\n      dom.removeClass(this.svgRoot, 'blocklyReadonly');\n      this.textArea.removeAttribute('readonly');\n    } else {\n      dom.removeClass(this.svgRoot, 'blocklyEditable');\n      dom.addClass(this.svgRoot, 'blocklyReadonly');\n      this.textArea.setAttribute('readonly', 'true');\n    }\n  }\n\n  /** Returns the current location of the comment in workspace coordinates. */\n  getRelativeToSurfaceXY(): Coordinate {\n    return this.location;\n  }\n\n  /**\n   * Moves the comment view to the given location.\n   *\n   * @param location The location to move to in workspace coordinates.\n   */\n  moveTo(location: Coordinate) {\n    this.location = location;\n    this.svgRoot.setAttribute(\n      'transform',\n      `translate(${location.x}, ${location.y})`,\n    );\n  }\n\n  /** Retursn the current text of the comment. */\n  getText() {\n    return this.text;\n  }\n\n  /** Sets the current text of the comment. */\n  setText(text: string) {\n    this.textArea.value = text;\n    this.onTextChange();\n  }\n\n  /** Registers a callback that listens for text changes. */\n  addTextChangeListener(listener: (oldText: string, newText: string) => void) {\n    this.textChangeListeners.push(listener);\n  }\n\n  /** Removes the given listener from the list of text change listeners. */\n  removeTextChangeListener(listener: () => void) {\n    this.textChangeListeners.splice(\n      this.textChangeListeners.indexOf(listener),\n      1,\n    );\n  }\n\n  /**\n   * Triggers listeners when the text of the comment changes, either\n   * programmatically or manually by the user.\n   */\n  private onTextChange() {\n    const oldText = this.text;\n    this.text = this.textArea.value;\n    this.updateTextPreview(this.text);\n    // Update size in case our minimum size increased.\n    this.setSize(this.size);\n    // Loop through listeners backwards in case they remove themselves.\n    for (let i = this.textChangeListeners.length - 1; i >= 0; i--) {\n      this.textChangeListeners[i](oldText, this.text);\n    }\n  }\n\n  /** Updates the preview text element to reflect the given text. */\n  private updateTextPreview(text: string) {\n    this.textPreviewNode.textContent = this.truncateText(text);\n  }\n\n  /** Truncates the text to fit within the top view. */\n  private truncateText(text: string): string {\n    return text.length >= 12 ? `${text.substring(0, 9)}...` : text;\n  }\n\n  /** Brings the workspace comment to the front of its layer. */\n  private bringToFront() {\n    const parent = this.svgRoot.parentNode;\n    const childNodes = parent!.childNodes;\n    // Avoid moving the comment if it's already at the bottom.\n    if (childNodes[childNodes.length - 1] !== this.svgRoot) {\n      parent!.appendChild(this.svgRoot);\n    }\n  }\n\n  /**\n   * Handles disposing of the comment when we get a pointer down event on the\n   * delete icon.\n   */\n  private onDeleteDown(e: PointerEvent) {\n    touch.clearTouchIdentifier();\n    if (browserEvents.isRightButton(e)) {\n      e.stopPropagation();\n      return;\n    }\n\n    this.dispose();\n    e.stopPropagation();\n  }\n\n  /** Disposes of this comment view. */\n  dispose() {\n    this.disposing = true;\n    dom.removeNode(this.svgRoot);\n    // Loop through listeners backwards in case they remove themselves.\n    for (let i = this.disposeListeners.length - 1; i >= 0; i--) {\n      this.disposeListeners[i]();\n    }\n    this.disposed = true;\n  }\n\n  /** Returns whether this comment view has been disposed or not. */\n  isDisposed(): boolean {\n    return this.disposed;\n  }\n\n  /**\n   * Returns true if this comment view is currently being disposed or has\n   * already been disposed.\n   */\n  isDeadOrDying(): boolean {\n    return this.disposing || this.disposed;\n  }\n\n  /** Registers a callback that listens for disposal of this view. */\n  addDisposeListener(listener: () => void) {\n    this.disposeListeners.push(listener);\n  }\n\n  /** Removes the given listener from the list of disposal listeners. */\n  removeDisposeListener(listener: () => void) {\n    this.disposeListeners.splice(this.disposeListeners.indexOf(listener), 1);\n  }\n}\n\ncss.register(`\n.injectionDiv {\n  --commentFillColour: #FFFCC7;\n  --commentBorderColour: #F2E49B;\n}\n\n.blocklyComment .blocklyTextarea {\n  background-color: var(--commentFillColour);\n  border: 1px solid var(--commentBorderColour);\n  box-sizing: border-box;\n  display: block;\n  outline: 0;\n  padding: 5px;\n  resize: none;\n  width: 100%;\n  height: 100%;\n}\n\n.blocklyReadonly.blocklyComment .blocklyTextarea {\n  cursor: inherit;\n}\n\n.blocklyDeleteIcon {\n  width: 20px;\n  height: 20px;\n  display: none;\n  cursor: pointer;\n}\n\n.blocklyFoldoutIcon {\n  width: 20px;\n  height: 20px;\n  transform-origin: 12px 12px;\n  cursor: pointer;\n}\n.blocklyResizeHandle {\n  width: 12px;\n  height: 12px;\n  cursor: se-resize;\n}\n.blocklyReadonly.blocklyComment .blocklyResizeHandle {\n  cursor: inherit;\n}\n\n.blocklyCommentTopbarBackground {\n  fill: var(--commentBorderColour);\n  height: 24px;\n}\n\n.blocklyComment .blocklyCommentPreview.blocklyText {\n  fill: #000;\n  dominant-baseline: middle;\n  visibility: hidden;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyCommentPreview {\n  visibility: visible;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyCommentForeignObject,\n.blocklyCollapsed.blocklyComment .blocklyResizeHandle {\n  display: none;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyFoldoutIcon {\n  transform: rotate(-90deg);\n}\n\n.blocklyRTL .blocklyCommentTopbar {\n  transform: scale(-1, 1);\n}\n\n.blocklyRTL .blocklyCommentForeignObject {\n  direction: rtl;\n}\n\n.blocklyRTL .blocklyCommentPreview {\n  /* Revert the scale and control RTL using direction instead. */\n  transform: scale(-1, 1);\n  direction: rtl;\n}\n\n.blocklyRTL .blocklyResizeHandle {\n  transform: scale(-1, 1);\n  cursor: sw-resize;\n}\n\n.blocklyCommentHighlight {\n  fill: none;\n}\n\n.blocklySelected .blocklyCommentHighlight {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n\n.blocklyCollapsed.blocklySelected .blocklyCommentHighlight {\n  stroke: none;\n}\n\n.blocklyCollapsed.blocklySelected .blocklyCommentTopbarBackground {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n`);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {CommentMove} from '../events/events_comment_move.js';\nimport {CommentResize} from '../events/events_comment_resize.js';\nimport {EventType} from '../events/type.js';\nimport * as eventUtils from '../events/utils.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport {Size} from '../utils/size.js';\nimport {Workspace} from '../workspace.js';\n\nexport class WorkspaceComment {\n  /** The unique identifier for this comment. */\n  public readonly id: string;\n\n  /** The text of the comment. */\n  private text = '';\n\n  /** The size of the comment in workspace units. */\n  private size = new Size(120, 100);\n\n  /** Whether the comment is collapsed or not. */\n  private collapsed = false;\n\n  /** Whether the comment is editable or not. */\n  private editable = true;\n\n  /** Whether the comment is movable or not. */\n  private movable = true;\n\n  /** Whether the comment is deletable or not. */\n  private deletable = true;\n\n  /** The location of the comment in workspace coordinates. */\n  protected location = new Coordinate(0, 0);\n\n  /** Whether this comment has been disposed or not. */\n  protected disposed = false;\n\n  /** Whether this comment is being disposed or not. */\n  protected disposing = false;\n\n  /**\n   * Constructs the comment.\n   *\n   * @param workspace The workspace to construct the comment in.\n   * @param id An optional ID to give to the comment. If not provided, one will\n   *     be generated.\n   */\n  constructor(\n    public readonly workspace: Workspace,\n    id?: string,\n  ) {\n    this.id = id && !workspace.getCommentById(id) ? id : idGenerator.genUid();\n\n    workspace.addTopComment(this);\n\n    this.fireCreateEvent();\n  }\n\n  private fireCreateEvent() {\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(EventType.COMMENT_CREATE))(this));\n    }\n  }\n\n  private fireDeleteEvent() {\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(EventType.COMMENT_DELETE))(this));\n    }\n  }\n\n  /** Fires a comment change event. */\n  private fireChangeEvent(oldText: string, newText: string) {\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(\n        new (eventUtils.get(EventType.COMMENT_CHANGE))(this, oldText, newText),\n      );\n    }\n  }\n\n  /** Fires a comment collapse event. */\n  private fireCollapseEvent(newCollapsed: boolean) {\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(\n        new (eventUtils.get(EventType.COMMENT_COLLAPSE))(this, newCollapsed),\n      );\n    }\n  }\n\n  /** Sets the text of the comment. */\n  setText(text: string) {\n    const oldText = this.text;\n    this.text = text;\n    this.fireChangeEvent(oldText, text);\n  }\n\n  /** Returns the text of the comment. */\n  getText(): string {\n    return this.text;\n  }\n\n  /** Sets the comment's size in workspace units. */\n  setSize(size: Size) {\n    const event = new (eventUtils.get(EventType.COMMENT_RESIZE))(\n      this,\n    ) as CommentResize;\n\n    this.size = size;\n\n    event.recordCurrentSizeAsNewSize();\n    eventUtils.fire(event);\n  }\n\n  /** Returns the comment's size in workspace units. */\n  getSize(): Size {\n    return this.size;\n  }\n\n  /** Sets whether the comment is collapsed or not. */\n  setCollapsed(collapsed: boolean) {\n    this.collapsed = collapsed;\n    this.fireCollapseEvent(collapsed);\n  }\n\n  /** Returns whether the comment is collapsed or not. */\n  isCollapsed(): boolean {\n    return this.collapsed;\n  }\n\n  /** Sets whether the comment is editable or not. */\n  setEditable(editable: boolean) {\n    this.editable = editable;\n  }\n\n  /**\n   * Returns whether the comment is editable or not, respecting whether the\n   * workspace is read-only.\n   */\n  isEditable(): boolean {\n    return this.isOwnEditable() && !this.workspace.options.readOnly;\n  }\n\n  /**\n   * Returns whether the comment is editable or not, only examining its own\n   * state and ignoring the state of the workspace.\n   */\n  isOwnEditable(): boolean {\n    return this.editable;\n  }\n\n  /** Sets whether the comment is movable or not. */\n  setMovable(movable: boolean) {\n    this.movable = movable;\n  }\n\n  /**\n   * Returns whether the comment is movable or not, respecting whether the\n   * workspace is read-only.\n   */\n  isMovable() {\n    return this.isOwnMovable() && !this.workspace.options.readOnly;\n  }\n\n  /**\n   * Returns whether the comment is movable or not, only examining its own\n   * state and ignoring the state of the workspace.\n   */\n  isOwnMovable() {\n    return this.movable;\n  }\n\n  /** Sets whether the comment is deletable or not. */\n  setDeletable(deletable: boolean) {\n    this.deletable = deletable;\n  }\n\n  /**\n   * Returns whether the comment is deletable or not, respecting whether the\n   * workspace is read-only.\n   */\n  isDeletable(): boolean {\n    return (\n      this.isOwnDeletable() &&\n      !this.isDeadOrDying() &&\n      !this.workspace.options.readOnly\n    );\n  }\n\n  /**\n   * Returns whether the comment is deletable or not, only examining its own\n   * state and ignoring the state of the workspace.\n   */\n  isOwnDeletable(): boolean {\n    return this.deletable;\n  }\n\n  /** Moves the comment to the given location in workspace coordinates. */\n  moveTo(location: Coordinate, reason?: string[] | undefined) {\n    const event = new (eventUtils.get(EventType.COMMENT_MOVE))(\n      this,\n    ) as CommentMove;\n    if (reason) event.setReason(reason);\n\n    this.location = location;\n\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /** Returns the position of the comment in workspace coordinates. */\n  getRelativeToSurfaceXY(): Coordinate {\n    return this.location;\n  }\n\n  /** Disposes of this comment. */\n  dispose() {\n    this.disposing = true;\n    this.fireDeleteEvent();\n    this.workspace.removeTopComment(this);\n    this.disposed = true;\n  }\n\n  /** Returns whether the comment has been disposed or not. */\n  isDisposed() {\n    return this.disposed;\n  }\n\n  /**\n   * Returns true if this comment view is currently being disposed or has\n   * already been disposed.\n   */\n  isDeadOrDying(): boolean {\n    return this.disposing || this.disposed;\n  }\n}\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as browserEvents from '../browser_events.js';\nimport {\n  WorkspaceCommentCopyData,\n  WorkspaceCommentPaster,\n} from '../clipboard/workspace_comment_paster.js';\nimport * as common from '../common.js';\nimport * as contextMenu from '../contextmenu.js';\nimport {ContextMenuRegistry} from '../contextmenu_registry.js';\nimport {CommentDragStrategy} from '../dragging/comment_drag_strategy.js';\nimport {IBoundedElement} from '../interfaces/i_bounded_element.js';\nimport {IContextMenu} from '../interfaces/i_contextmenu.js';\nimport {ICopyable} from '../interfaces/i_copyable.js';\nimport {IDeletable} from '../interfaces/i_deletable.js';\nimport {IDraggable} from '../interfaces/i_draggable.js';\nimport {IRenderedElement} from '../interfaces/i_rendered_element.js';\nimport {ISelectable} from '../interfaces/i_selectable.js';\nimport * as layers from '../layers.js';\nimport * as commentSerialization from '../serialization/workspace_comments.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {CommentView} from './comment_view.js';\nimport {WorkspaceComment} from './workspace_comment.js';\n\nexport class RenderedWorkspaceComment\n  extends WorkspaceComment\n  implements\n    IBoundedElement,\n    IRenderedElement,\n    IDraggable,\n    ISelectable,\n    IDeletable,\n    ICopyable<WorkspaceCommentCopyData>,\n    IContextMenu\n{\n  /** The class encompassing the svg elements making up the workspace comment. */\n  private view: CommentView;\n\n  public readonly workspace: WorkspaceSvg;\n\n  private dragStrategy = new CommentDragStrategy(this);\n\n  /** Constructs the workspace comment, including the view. */\n  constructor(workspace: WorkspaceSvg, id?: string) {\n    super(workspace, id);\n\n    this.workspace = workspace;\n\n    this.view = new CommentView(workspace);\n    // Set the size to the default size as defined in the superclass.\n    this.view.setSize(this.getSize());\n    this.view.setEditable(this.isEditable());\n    this.view.getSvgRoot().setAttribute('data-id', this.id);\n\n    this.addModelUpdateBindings();\n\n    browserEvents.conditionalBind(\n      this.view.getSvgRoot(),\n      'pointerdown',\n      this,\n      this.startGesture,\n    );\n    // Don't zoom with mousewheel; let it scroll instead.\n    browserEvents.conditionalBind(\n      this.view.getSvgRoot(),\n      'wheel',\n      this,\n      (e: Event) => {\n        e.stopPropagation();\n      },\n    );\n  }\n\n  /**\n   * Adds listeners to the view that updates the model (i.e. the superclass)\n   * when changes are made to the view.\n   */\n  private addModelUpdateBindings() {\n    this.view.addTextChangeListener(\n      (_, newText: string) => void super.setText(newText),\n    );\n    this.view.addSizeChangeListener(\n      (_, newSize: Size) => void super.setSize(newSize),\n    );\n    this.view.addOnCollapseListener(\n      () => void super.setCollapsed(this.view.isCollapsed()),\n    );\n    this.view.addDisposeListener(() => {\n      if (!this.isDeadOrDying()) this.dispose();\n    });\n  }\n\n  /** Sets the text of the comment. */\n  override setText(text: string): void {\n    // setText will trigger the change listener that updates\n    // the model aka superclass.\n    this.view.setText(text);\n  }\n\n  /** Sets the size of the comment. */\n  override setSize(size: Size) {\n    // setSize will trigger the change listener that updates\n    // the model aka superclass.\n    this.view.setSize(size);\n  }\n\n  /** Sets whether the comment is collapsed or not. */\n  override setCollapsed(collapsed: boolean) {\n    // setCollapsed will trigger the change listener that updates\n    // the model aka superclass.\n    this.view.setCollapsed(collapsed);\n  }\n\n  /** Sets whether the comment is editable or not. */\n  override setEditable(editable: boolean): void {\n    super.setEditable(editable);\n    // Use isEditable rather than isOwnEditable to account for workspace state.\n    this.view.setEditable(this.isEditable());\n  }\n\n  /** Returns the root SVG element of this comment. */\n  getSvgRoot(): SVGElement {\n    return this.view.getSvgRoot();\n  }\n\n  /**\n   * Returns the comment's size in workspace units.\n   * Does not respect collapsing.\n   */\n  getSize(): Size {\n    return super.getSize();\n  }\n\n  /**\n   * Returns the bounding rectangle of this comment in workspace coordinates.\n   * Respects collapsing.\n   */\n  getBoundingRectangle(): Rect {\n    const loc = this.getRelativeToSurfaceXY();\n    const size = this.view?.getSize() ?? this.getSize();\n    let left;\n    let right;\n    if (this.workspace.RTL) {\n      left = loc.x - size.width;\n      right = loc.x;\n    } else {\n      left = loc.x;\n      right = loc.x + size.width;\n    }\n    return new Rect(loc.y, loc.y + size.height, left, right);\n  }\n\n  /** Move the comment by the given amounts in workspace coordinates. */\n  moveBy(dx: number, dy: number, reason?: string[] | undefined): void {\n    const loc = this.getRelativeToSurfaceXY();\n    const newLoc = new Coordinate(loc.x + dx, loc.y + dy);\n    this.moveTo(newLoc, reason);\n  }\n\n  /** Moves the comment to the given location in workspace coordinates. */\n  override moveTo(location: Coordinate, reason?: string[] | undefined): void {\n    super.moveTo(location, reason);\n    this.view.moveTo(location);\n  }\n\n  /**\n   * Moves the comment during a drag. Doesn't fire move events.\n   *\n   * @internal\n   */\n  moveDuringDrag(location: Coordinate): void {\n    this.location = location;\n    this.view.moveTo(location);\n  }\n\n  /**\n   * Adds the dragging CSS class to this comment.\n   *\n   * @internal\n   */\n  setDragging(dragging: boolean): void {\n    if (dragging) {\n      dom.addClass(this.getSvgRoot(), 'blocklyDragging');\n    } else {\n      dom.removeClass(this.getSvgRoot(), 'blocklyDragging');\n    }\n  }\n\n  /** Disposes of the view. */\n  override dispose() {\n    this.disposing = true;\n    if (!this.view.isDeadOrDying()) this.view.dispose();\n    super.dispose();\n  }\n\n  /**\n   * Starts a gesture because we detected a pointer down on the comment\n   * (that wasn't otherwise gobbled up, e.g. by resizing).\n   */\n  private startGesture(e: PointerEvent) {\n    const gesture = this.workspace.getGesture(e);\n    if (gesture) {\n      if (browserEvents.isTargetInput(e)) {\n        // If the text area was the focus, don't allow this event to bubble up\n        // and steal focus away from the editor/comment.\n        e.stopPropagation();\n      } else {\n        gesture.handleCommentStart(e, this);\n        this.workspace.getLayerManager()?.append(this, layers.BLOCK);\n      }\n      common.setSelected(this);\n    }\n  }\n\n  /** Visually indicates that this comment would be deleted if dropped. */\n  setDeleteStyle(wouldDelete: boolean): void {\n    if (wouldDelete) {\n      dom.addClass(this.getSvgRoot(), 'blocklyDraggingDelete');\n    } else {\n      dom.removeClass(this.getSvgRoot(), 'blocklyDraggingDelete');\n    }\n  }\n\n  /** Returns whether this comment is movable or not. */\n  isMovable(): boolean {\n    return this.dragStrategy.isMovable();\n  }\n\n  /** Starts a drag on the comment. */\n  startDrag(): void {\n    this.dragStrategy.startDrag();\n  }\n\n  /** Drags the comment to the given location. */\n  drag(newLoc: Coordinate): void {\n    this.dragStrategy.drag(newLoc);\n  }\n\n  /** Ends the drag on the comment. */\n  endDrag(): void {\n    this.dragStrategy.endDrag();\n  }\n\n  /** Moves the comment back to where it was at the start of a drag. */\n  revertDrag(): void {\n    this.dragStrategy.revertDrag();\n  }\n\n  /** Visually highlights the comment. */\n  select(): void {\n    dom.addClass(this.getSvgRoot(), 'blocklySelected');\n  }\n\n  /** Visually unhighlights the comment. */\n  unselect(): void {\n    dom.removeClass(this.getSvgRoot(), 'blocklySelected');\n  }\n\n  /**\n   * Returns a JSON serializable representation of this comment's state that\n   * can be used for pasting.\n   */\n  toCopyData(): WorkspaceCommentCopyData | null {\n    return {\n      paster: WorkspaceCommentPaster.TYPE,\n      commentState: commentSerialization.save(this, {\n        addCoordinates: true,\n      }),\n    };\n  }\n\n  /** Show a context menu for this comment. */\n  showContextMenu(e: PointerEvent): void {\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\n      ContextMenuRegistry.ScopeType.COMMENT,\n      {comment: this},\n    );\n    contextMenu.show(e, menuOptions, this.workspace.RTL, this.workspace);\n  }\n\n  /** Snap this comment to the nearest grid point. */\n  snapToGrid(): void {\n    if (this.isDeadOrDying()) return;\n    const grid = this.workspace.getGrid();\n    if (!grid?.shouldSnap()) return;\n    const currentXY = this.getRelativeToSurfaceXY();\n    const alignedXY = grid.alignXY(currentXY);\n    if (alignedXY !== currentXY) {\n      this.moveTo(alignedXY, ['snap']);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block creation event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockCreate\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport * as blocks from '../serialization/blocks.js';\nimport * as utilsXml from '../utils/xml.js';\nimport {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport {EventType} from './type.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Notifies listeners when a block (or connected stack of blocks) is\n * created.\n */\nexport class BlockCreate extends BlockBase {\n  override type = EventType.BLOCK_CREATE;\n\n  /** The XML representation of the created block(s). */\n  xml?: Element | DocumentFragment;\n\n  /** The JSON respresentation of the created block(s). */\n  json?: blocks.State;\n\n  /** All of the IDs of created blocks. */\n  ids?: string[];\n\n  /** @param opt_block The created block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    if (opt_block.isShadow()) {\n      // Moving shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    this.xml = Xml.blockToDomWithXY(opt_block);\n    this.ids = eventUtils.getDescendantIds(opt_block);\n\n    this.json = blocks.save(opt_block, {addCoordinates: true}) as blocks.State;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockCreateJson {\n    const json = super.toJson() as BlockCreateJson;\n    if (!this.xml) {\n      throw new Error(\n        'The block XML is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.ids) {\n      throw new Error(\n        'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.json) {\n      throw new Error(\n        'The block JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    json['ids'] = this.ids;\n    json['json'] = this.json;\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockCreate, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockCreateJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockCreate {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockCreate(),\n    ) as BlockCreate;\n    newEvent.xml = utilsXml.textToDom(json['xml']);\n    newEvent.ids = json['ids'];\n    newEvent.json = json['json'] as blocks.State;\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.json) {\n      throw new Error(\n        'The block JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.ids) {\n      throw new Error(\n        'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (allShadowBlocks(workspace, this.ids)) return;\n    if (forward) {\n      blocks.append(this.json, workspace);\n    } else {\n      for (let i = 0; i < this.ids.length; i++) {\n        const id = this.ids[i];\n        const block = workspace.getBlockById(id);\n        if (block) {\n          block.dispose(false);\n        } else if (id === this.blockId) {\n          // Only complain about root-level block.\n          console.warn(\"Can't uncreate non-existent block: \" + id);\n        }\n      }\n    }\n  }\n}\n/**\n * Returns true if all blocks in the list are shadow blocks. If so, that means\n * the top-level block being created is a shadow block. This only happens when a\n * block that was covering up a shadow block is removed. We don't need to create\n * an additional block in that case because the original block still has its\n * shadow block.\n *\n * @param workspace Workspace to check for blocks\n * @param ids A list of block ids that were created in this event\n * @returns True if all block ids in the list are shadow blocks\n */\nconst allShadowBlocks = function (\n  workspace: Workspace,\n  ids: string[],\n): boolean {\n  const shadows = ids\n    .map((id) => workspace.getBlockById(id))\n    .filter((block) => block && block.isShadow());\n  return shadows.length === ids.length;\n};\n\nexport interface BlockCreateJson extends BlockBaseJson {\n  xml: string;\n  ids: string[];\n  json: object;\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, EventType.BLOCK_CREATE, BlockCreate);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a theme update.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.ThemeChange\n\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that the workspace theme has changed.\n */\nexport class ThemeChange extends UiBase {\n  /** The name of the new theme that has been set. */\n  themeName?: string;\n\n  override type = EventType.THEME_CHANGE;\n\n  /**\n   * @param opt_themeName The theme name. Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    event. Undefined for a blank event.\n   */\n  constructor(opt_themeName?: string, opt_workspaceId?: string) {\n    super(opt_workspaceId);\n    this.themeName = opt_themeName;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ThemeChangeJson {\n    const json = super.toJson() as ThemeChangeJson;\n    if (!this.themeName) {\n      throw new Error(\n        'The theme name is undefined. Either pass a theme name to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['themeName'] = this.themeName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of ThemeChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: ThemeChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): ThemeChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new ThemeChange(),\n    ) as ThemeChange;\n    newEvent.themeName = json['themeName'];\n    return newEvent;\n  }\n}\n\nexport interface ThemeChangeJson extends AbstractEventJson {\n  themeName: string;\n}\n\nregistry.register(registry.Type.EVENT, EventType.THEME_CHANGE, ThemeChange);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a viewport change.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.ViewportChange\n\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that the workspace surface's position or scale has\n * changed.\n *\n * Does not notify when the workspace itself resizes.\n */\nexport class ViewportChange extends UiBase {\n  /**\n   * Top edge of the visible portion of the workspace, relative to the\n   * workspace origin.\n   */\n  viewTop?: number;\n\n  /**\n   * The left edge of the visible portion of the workspace, relative to\n   * the workspace origin.\n   */\n  viewLeft?: number;\n\n  /** The scale of the workpace. */\n  scale?: number;\n\n  /** The previous scale of the workspace. */\n  oldScale?: number;\n\n  override type = EventType.VIEWPORT_CHANGE;\n\n  /**\n   * @param opt_top Top-edge of the visible portion of the workspace, relative\n   *     to the workspace origin. Undefined for a blank event.\n   * @param opt_left Left-edge of the visible portion of the workspace relative\n   *     to the workspace origin. Undefined for a blank event.\n   * @param opt_scale The scale of the workspace. Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   * @param opt_oldScale The old scale of the workspace. Undefined for a blank\n   *     event.\n   */\n  constructor(\n    opt_top?: number,\n    opt_left?: number,\n    opt_scale?: number,\n    opt_workspaceId?: string,\n    opt_oldScale?: number,\n  ) {\n    super(opt_workspaceId);\n\n    this.viewTop = opt_top;\n    this.viewLeft = opt_left;\n    this.scale = opt_scale;\n    this.oldScale = opt_oldScale;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ViewportChangeJson {\n    const json = super.toJson() as ViewportChangeJson;\n    if (this.viewTop === undefined) {\n      throw new Error(\n        'The view top is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (this.viewLeft === undefined) {\n      throw new Error(\n        'The view left is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (this.scale === undefined) {\n      throw new Error(\n        'The scale is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (this.oldScale === undefined) {\n      throw new Error(\n        'The old scale is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['viewTop'] = this.viewTop;\n    json['viewLeft'] = this.viewLeft;\n    json['scale'] = this.scale;\n    json['oldScale'] = this.oldScale;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Viewport, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: ViewportChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): ViewportChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new ViewportChange(),\n    ) as ViewportChange;\n    newEvent.viewTop = json['viewTop'];\n    newEvent.viewLeft = json['viewLeft'];\n    newEvent.scale = json['scale'];\n    newEvent.oldScale = json['oldScale'];\n    return newEvent;\n  }\n}\n\nexport interface ViewportChangeJson extends AbstractEventJson {\n  viewTop: number;\n  viewLeft: number;\n  scale: number;\n  oldScale: number;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  EventType.VIEWPORT_CHANGE,\n  ViewportChange,\n);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ConnectionType\n\n/**\n * Enum for the type of a connection or input.\n */\nexport enum ConnectionType {\n  // A right-facing value input.  E.g. 'set item to' or 'return'.\n  INPUT_VALUE = 1,\n  // A left-facing value output.  E.g. 'random fraction'.\n  OUTPUT_VALUE,\n  // A down-facing block stack.  E.g. 'if-do' or 'else'.\n  NEXT_STATEMENT,\n  // An up-facing block stack.  E.g. 'break out of loop'.\n  PREVIOUS_STATEMENT,\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A database of all the rendered connections that could\n *    possibly be connected to (i.e. not collapsed, etc).\n *    Sorted by y coordinate.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ConnectionDB\n\nimport {ConnectionType} from './connection_type.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport type {RenderedConnection} from './rendered_connection.js';\nimport type {Coordinate} from './utils/coordinate.js';\n\n/**\n * Database of connections.\n * Connections are stored in order of their vertical component.  This way\n * connections in an area may be looked up quickly using a binary search.\n */\nexport class ConnectionDB {\n  /** Array of connections sorted by y position in workspace units. */\n  private readonly connections: RenderedConnection[] = [];\n\n  /**\n   * @param connectionChecker The workspace's connection type checker, used to\n   *     decide if connections are valid during a drag.\n   */\n  constructor(private readonly connectionChecker: IConnectionChecker) {}\n\n  /**\n   * Add a connection to the database. Should not already exist in the database.\n   *\n   * @param connection The connection to be added.\n   * @param yPos The y position used to decide where to insert the connection.\n   * @internal\n   */\n  addConnection(connection: RenderedConnection, yPos: number) {\n    const index = this.calculateIndexForYPos(yPos);\n    this.connections.splice(index, 0, connection);\n  }\n\n  /**\n   * Finds the index of the given connection.\n   *\n   * Starts by doing a binary search to find the approximate location, then\n   * linearly searches nearby for the exact connection.\n   *\n   * @param conn The connection to find.\n   * @param yPos The y position used to find the index of the connection.\n   * @returns The index of the connection, or -1 if the connection was not\n   *     found.\n   */\n  private findIndexOfConnection(\n    conn: RenderedConnection,\n    yPos: number,\n  ): number {\n    if (!this.connections.length) {\n      return -1;\n    }\n\n    const bestGuess = this.calculateIndexForYPos(yPos);\n    if (bestGuess >= this.connections.length) {\n      // Not in list\n      return -1;\n    }\n\n    yPos = conn.y;\n    // Walk forward and back on the y axis looking for the connection.\n    let pointer = bestGuess;\n    while (pointer >= 0 && this.connections[pointer].y === yPos) {\n      if (this.connections[pointer] === conn) {\n        return pointer;\n      }\n      pointer--;\n    }\n\n    pointer = bestGuess;\n    while (\n      pointer < this.connections.length &&\n      this.connections[pointer].y === yPos\n    ) {\n      if (this.connections[pointer] === conn) {\n        return pointer;\n      }\n      pointer++;\n    }\n    return -1;\n  }\n\n  /**\n   * Finds the correct index for the given y position.\n   *\n   * @param yPos The y position used to decide where to insert the connection.\n   * @returns The candidate index.\n   */\n  private calculateIndexForYPos(yPos: number): number {\n    if (!this.connections.length) {\n      return 0;\n    }\n    let pointerMin = 0;\n    let pointerMax = this.connections.length;\n    while (pointerMin < pointerMax) {\n      const pointerMid = Math.floor((pointerMin + pointerMax) / 2);\n      if (this.connections[pointerMid].y < yPos) {\n        pointerMin = pointerMid + 1;\n      } else if (this.connections[pointerMid].y > yPos) {\n        pointerMax = pointerMid;\n      } else {\n        pointerMin = pointerMid;\n        break;\n      }\n    }\n    return pointerMin;\n  }\n\n  /**\n   * Remove a connection from the database.  Must already exist in DB.\n   *\n   * @param connection The connection to be removed.\n   * @param yPos The y position used to find the index of the connection.\n   * @throws {Error} If the connection cannot be found in the database.\n   */\n  removeConnection(connection: RenderedConnection, yPos: number) {\n    const index = this.findIndexOfConnection(connection, yPos);\n    if (index === -1) {\n      throw Error('Unable to find connection in connectionDB.');\n    }\n    this.connections.splice(index, 1);\n  }\n\n  /**\n   * Find all nearby connections to the given connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * @param connection The connection whose neighbours should be returned.\n   * @param maxRadius The maximum radius to another connection.\n   * @returns List of connections.\n   */\n  getNeighbours(\n    connection: RenderedConnection,\n    maxRadius: number,\n  ): RenderedConnection[] {\n    const db = this.connections;\n    const currentX = connection.x;\n    const currentY = connection.y;\n\n    // Binary search to find the closest y location.\n    let pointerMin = 0;\n    let pointerMax = db.length - 2;\n    let pointerMid = pointerMax;\n    while (pointerMin < pointerMid) {\n      if (db[pointerMid].y < currentY) {\n        pointerMin = pointerMid;\n      } else {\n        pointerMax = pointerMid;\n      }\n      pointerMid = Math.floor((pointerMin + pointerMax) / 2);\n    }\n\n    const neighbours: RenderedConnection[] = [];\n    /**\n     * Computes if the current connection is within the allowed radius of\n     * another connection. This function is a closure and has access to outside\n     * variables.\n     *\n     * @param yIndex The other connection's index in the database.\n     * @returns True if the current connection's vertical distance from the\n     *     other connection is less than the allowed radius.\n     */\n    function checkConnection(yIndex: number): boolean {\n      const dx = currentX - db[yIndex].x;\n      const dy = currentY - db[yIndex].y;\n      const r = Math.sqrt(dx * dx + dy * dy);\n      if (r <= maxRadius) {\n        neighbours.push(db[yIndex]);\n      }\n      return dy < maxRadius;\n    }\n\n    // Walk forward and back on the y axis looking for the closest x,y point.\n    pointerMin = pointerMid;\n    pointerMax = pointerMid;\n    if (db.length) {\n      while (pointerMin >= 0 && checkConnection(pointerMin)) {\n        pointerMin--;\n      }\n      do {\n        pointerMax++;\n      } while (pointerMax < db.length && checkConnection(pointerMax));\n    }\n\n    return neighbours;\n  }\n\n  /**\n   * Is the candidate connection close to the reference connection.\n   * Extremely fast; only looks at Y distance.\n   *\n   * @param index Index in database of candidate connection.\n   * @param baseY Reference connection's Y value.\n   * @param maxRadius The maximum radius to another connection.\n   * @returns True if connection is in range.\n   */\n  private isInYRange(index: number, baseY: number, maxRadius: number): boolean {\n    return Math.abs(this.connections[index].y - baseY) <= maxRadius;\n  }\n\n  /**\n   * Find the closest compatible connection to this connection.\n   *\n   * @param conn The connection searching for a compatible mate.\n   * @param maxRadius The maximum radius to another connection.\n   * @param dxy Offset between this connection's location in the database and\n   *     the current location (as a result of dragging).\n   * @returns Contains two properties: 'connection' which is either another\n   *     connection or null, and 'radius' which is the distance.\n   */\n  searchForClosest(\n    conn: RenderedConnection,\n    maxRadius: number,\n    dxy: Coordinate,\n  ): {connection: RenderedConnection | null; radius: number} {\n    if (!this.connections.length) {\n      // Don't bother.\n      return {connection: null, radius: maxRadius};\n    }\n\n    // Stash the values of x and y from before the drag.\n    const baseY = conn.y;\n    const baseX = conn.x;\n\n    conn.x = baseX + dxy.x;\n    conn.y = baseY + dxy.y;\n\n    // calculateIndexForYPos_ finds an index for insertion, which is always\n    // after any block with the same y index.  We want to search both forward\n    // and back, so search on both sides of the index.\n    const closestIndex = this.calculateIndexForYPos(conn.y);\n\n    let bestConnection = null;\n    let bestRadius = maxRadius;\n    let temp;\n\n    // Walk forward and back on the y axis looking for the closest x,y point.\n    let pointerMin = closestIndex - 1;\n    while (pointerMin >= 0 && this.isInYRange(pointerMin, conn.y, maxRadius)) {\n      temp = this.connections[pointerMin];\n      if (this.connectionChecker.canConnect(conn, temp, true, bestRadius)) {\n        bestConnection = temp;\n        bestRadius = temp.distanceFrom(conn);\n      }\n      pointerMin--;\n    }\n\n    let pointerMax = closestIndex;\n    while (\n      pointerMax < this.connections.length &&\n      this.isInYRange(pointerMax, conn.y, maxRadius)\n    ) {\n      temp = this.connections[pointerMax];\n      if (this.connectionChecker.canConnect(conn, temp, true, bestRadius)) {\n        bestConnection = temp;\n        bestRadius = temp.distanceFrom(conn);\n      }\n      pointerMax++;\n    }\n\n    // Reset the values of x and y.\n    conn.x = baseX;\n    conn.y = baseY;\n    // If there were no valid connections, bestConnection will be null.\n    return {connection: bestConnection, radius: bestRadius};\n  }\n\n  /**\n   * Initialize a set of connection DBs for a workspace.\n   *\n   * @param checker The workspace's connection checker, used to decide if\n   *     connections are valid during a drag.\n   * @returns Array of databases.\n   */\n  static init(checker: IConnectionChecker): ConnectionDB[] {\n    // Create four databases, one for each connection type.\n    const dbList = [];\n    dbList[ConnectionType.INPUT_VALUE] = new ConnectionDB(checker);\n    dbList[ConnectionType.OUTPUT_VALUE] = new ConnectionDB(checker);\n    dbList[ConnectionType.NEXT_STATEMENT] = new ConnectionDB(checker);\n    dbList[ConnectionType.PREVIOUS_STATEMENT] = new ConnectionDB(checker);\n    return dbList;\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for dragging a workspace visually.\n *\n * @class\n */\n// Former goog.module ID: Blockly.WorkspaceDragger\n\nimport * as common from './common.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a workspace dragger.  It moves the workspace around when it is\n * being dragged by a mouse or touch.\n *\n */\nexport class WorkspaceDragger {\n  private readonly horizontalScrollEnabled: boolean;\n  private readonly verticalScrollEnabled: boolean;\n  protected startScrollXY_: Coordinate;\n\n  /** @param workspace The workspace to drag. */\n  constructor(private workspace: WorkspaceSvg) {\n    /** Whether horizontal scroll is enabled. */\n    this.horizontalScrollEnabled = this.workspace.isMovableHorizontally();\n\n    /** Whether vertical scroll is enabled. */\n    this.verticalScrollEnabled = this.workspace.isMovableVertically();\n\n    /**\n     * The scroll position of the workspace at the beginning of the drag.\n     * Coordinate system: pixel coordinates.\n     */\n    this.startScrollXY_ = new Coordinate(workspace.scrollX, workspace.scrollY);\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    // AnyDuringMigration because:  Type 'null' is not assignable to type\n    // 'WorkspaceSvg'.\n    this.workspace = null as AnyDuringMigration;\n  }\n\n  /**\n   * Start dragging the workspace.\n   *\n   * @internal\n   */\n  startDrag() {\n    if (common.getSelected()) {\n      common.getSelected()!.unselect();\n    }\n  }\n\n  /**\n   * Finish dragging the workspace and put everything back where it belongs.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel coordinates.\n   * @internal\n   */\n  endDrag(currentDragDeltaXY: Coordinate) {\n    // Make sure everything is up to date.\n    this.drag(currentDragDeltaXY);\n  }\n\n  /**\n   * Move the workspace based on the most recent mouse movements.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel coordinates.\n   * @internal\n   */\n  drag(currentDragDeltaXY: Coordinate) {\n    const newXY = Coordinate.sum(this.startScrollXY_, currentDragDeltaXY);\n\n    if (this.horizontalScrollEnabled && this.verticalScrollEnabled) {\n      this.workspace.scroll(newXY.x, newXY.y);\n    } else if (this.horizontalScrollEnabled) {\n      this.workspace.scroll(newXY.x, this.workspace.scrollY);\n    } else if (this.verticalScrollEnabled) {\n      this.workspace.scroll(this.workspace.scrollX, newXY.y);\n    } else {\n      throw new TypeError('Invalid state.');\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing an in-progress gesture, e.g. a drag,\n * tap, or pinch to zoom.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Gesture\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_click.js';\n\nimport * as blockAnimations from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport {RenderedWorkspaceComment} from './comments.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport {IDraggable, isDraggable} from './interfaces/i_draggable.js';\nimport {IDragger} from './interfaces/i_dragger.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IIcon} from './interfaces/i_icon.js';\nimport * as registry from './registry.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {WorkspaceDragger} from './workspace_dragger.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Note: In this file \"start\" refers to pointerdown\n * events.  \"End\" refers to pointerup events.\n */\n\n/** A multiplier used to convert the gesture scale to a zoom in delta. */\nconst ZOOM_IN_MULTIPLIER = 5;\n\n/** A multiplier used to convert the gesture scale to a zoom out delta. */\nconst ZOOM_OUT_MULTIPLIER = 6;\n\n/**\n * Class for one gesture.\n */\nexport class Gesture {\n  /**\n   * The position of the pointer when the gesture started.  Units are CSS\n   * pixels, with (0, 0) at the top left of the browser window (pointer event\n   * clientX/Y).\n   */\n  private mouseDownXY = new Coordinate(0, 0);\n  private currentDragDeltaXY: Coordinate;\n\n  /**\n   * The bubble that the gesture started on, or null if it did not start on a\n   * bubble.\n   */\n  private startBubble: IBubble | null = null;\n\n  /**\n   * The field that the gesture started on, or null if it did not start on a\n   * field.\n   */\n  private startField: Field | null = null;\n\n  /**\n   * The icon that the gesture started on, or null if it did not start on an\n   * icon.\n   */\n  private startIcon: IIcon | null = null;\n\n  /**\n   * The block that the gesture started on, or null if it did not start on a\n   * block.\n   */\n  private startBlock: BlockSvg | null = null;\n\n  /**\n   * The comment that the gesture started on, or null if it did not start on a\n   * comment.\n   */\n  private startComment: RenderedWorkspaceComment | null = null;\n\n  /**\n   * The block that this gesture targets.  If the gesture started on a\n   * shadow block, this is the first non-shadow parent of the block.  If the\n   * gesture started in the flyout, this is the root block of the block group\n   * that was clicked or dragged.\n   */\n  private targetBlock: BlockSvg | null = null;\n\n  /**\n   * The workspace that the gesture started on.  There may be multiple\n   * workspaces on a page; this is more accurate than using\n   * Blockly.common.getMainWorkspace().\n   */\n  protected startWorkspace_: WorkspaceSvg | null = null;\n\n  /**\n   * Whether the pointer has at any point moved out of the drag radius.\n   * A gesture that exceeds the drag radius is a drag even if it ends exactly\n   * at its start point.\n   */\n  private hasExceededDragRadius = false;\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  private dragger: IDragger | null = null;\n\n  /**\n   * The object tracking a workspace or flyout workspace drag, or null if none\n   * is in progress.\n   */\n  private workspaceDragger: WorkspaceDragger | null = null;\n\n  /** Whether the gesture is dragging or not. */\n  private dragging: boolean = false;\n\n  /** The flyout a gesture started in, if any. */\n  private flyout: IFlyout | null = null;\n\n  /** Boolean for sanity-checking that some code is only called once. */\n  private calledUpdateIsDragging = false;\n\n  /** Boolean for sanity-checking that some code is only called once. */\n  private gestureHasStarted = false;\n\n  /** Boolean used internally to break a cycle in disposal. */\n  protected isEnding_ = false;\n\n  /** The event that most recently updated this gesture. */\n  private mostRecentEvent: PointerEvent;\n\n  /** Boolean for whether or not this gesture is a multi-touch gesture. */\n  private multiTouch = false;\n\n  /** A map of cached points used for tracking multi-touch gestures. */\n  private cachedPoints = new Map<string, Coordinate | null>();\n\n  /**\n   * This is the ratio between the starting distance between the touch points\n   * and the most recent distance between the touch points.\n   * Scales between 0 and 1 mean the most recent zoom was a zoom out.\n   * Scales above 1.0 mean the most recent zoom was a zoom in.\n   */\n  private previousScale = 0;\n\n  /** The starting distance between two touch points. */\n  private startDistance = 0;\n\n  /** Boolean for whether or not the workspace supports pinch-zoom. */\n  private isPinchZoomEnabled: boolean | null = null;\n\n  /**\n   * The owner of the dropdownDiv when this gesture first starts.\n   * Needed because we'll close the dropdown before fields get to\n   * act on their events, and some fields care about who owns\n   * the dropdown.\n   */\n  currentDropdownOwner: Field | null = null;\n\n  /**\n   * @param e The event that kicked off this gesture.\n   * @param creatorWorkspace The workspace that created this gesture and has a\n   *     reference to it.\n   */\n  constructor(\n    e: PointerEvent,\n    private readonly creatorWorkspace: WorkspaceSvg,\n  ) {\n    this.mostRecentEvent = e;\n\n    /**\n     * How far the pointer has moved during this drag, in pixel units.\n     * (0, 0) is at this.mouseDownXY_.\n     */\n    this.currentDragDeltaXY = new Coordinate(0, 0);\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    Touch.clearTouchIdentifier();\n    Tooltip.unblock();\n    // Clear the owner's reference to this gesture.\n    this.creatorWorkspace.clearGesture();\n\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n\n    if (this.workspaceDragger) {\n      this.workspaceDragger.dispose();\n    }\n  }\n\n  /**\n   * Update internal state based on an event.\n   *\n   * @param e The most recent pointer event.\n   */\n  private updateFromEvent(e: PointerEvent) {\n    const currentXY = new Coordinate(e.clientX, e.clientY);\n    const changed = this.updateDragDelta(currentXY);\n    // Exceeded the drag radius for the first time.\n    if (changed) {\n      this.updateIsDragging(e);\n      Touch.longStop();\n    }\n    this.mostRecentEvent = e;\n  }\n\n  /**\n   * DO MATH to set currentDragDeltaXY_ based on the most recent pointer\n   * position.\n   *\n   * @param currentXY The most recent pointer position, in pixel units,\n   *     with (0, 0) at the window's top left corner.\n   * @returns True if the drag just exceeded the drag radius for the first time.\n   */\n  private updateDragDelta(currentXY: Coordinate): boolean {\n    this.currentDragDeltaXY = Coordinate.difference(\n      currentXY,\n      this.mouseDownXY,\n    );\n\n    if (!this.hasExceededDragRadius) {\n      const currentDragDelta = Coordinate.magnitude(this.currentDragDeltaXY);\n\n      // The flyout has a different drag radius from the rest of Blockly.\n      const limitRadius = this.flyout\n        ? config.flyoutDragRadius\n        : config.dragRadius;\n\n      this.hasExceededDragRadius = currentDragDelta > limitRadius;\n      return this.hasExceededDragRadius;\n    }\n    return false;\n  }\n\n  /**\n   * Update this gesture to record whether a block is being dragged from the\n   * flyout.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a block should be dragged from the flyout this function creates\n   * the new block on the main workspace and updates targetBlock_ and\n   * startWorkspace_.\n   *\n   * @returns True if a block is being dragged from the flyout.\n   */\n  private updateIsDraggingFromFlyout(): boolean {\n    if (!this.targetBlock || !this.flyout?.isBlockCreatable(this.targetBlock)) {\n      return false;\n    }\n    if (!this.flyout.targetWorkspace) {\n      throw new Error(`Cannot update dragging from the flyout because the ' +\n          'flyout's target workspace is undefined`);\n    }\n    if (\n      !this.flyout.isScrollable() ||\n      this.flyout.isDragTowardWorkspace(this.currentDragDeltaXY)\n    ) {\n      this.startWorkspace_ = this.flyout.targetWorkspace;\n      this.startWorkspace_.updateScreenCalculationsIfScrolled();\n      // Start the event group now, so that the same event group is used for\n      // block creation and block dragging.\n      if (!eventUtils.getGroup()) {\n        eventUtils.setGroup(true);\n      }\n      // The start block is no longer relevant, because this is a drag.\n      this.startBlock = null;\n      this.targetBlock = this.flyout.createBlock(this.targetBlock);\n      common.setSelected(this.targetBlock);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Check whether to start a workspace drag. If a workspace is being dragged,\n   * create the necessary WorkspaceDragger and start the drag.\n   *\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a workspace is being dragged this function creates the\n   * necessary WorkspaceDragger and starts the drag.\n   */\n  private updateIsDraggingWorkspace() {\n    if (!this.startWorkspace_) {\n      throw new Error(\n        'Cannot update dragging the workspace because the ' +\n          'start workspace is undefined',\n      );\n    }\n\n    const wsMovable = this.flyout\n      ? this.flyout.isScrollable()\n      : this.startWorkspace_ && this.startWorkspace_.isDraggable();\n    if (!wsMovable) return;\n\n    this.dragging = true;\n    this.workspaceDragger = new WorkspaceDragger(this.startWorkspace_);\n\n    this.workspaceDragger.startDrag();\n  }\n\n  /**\n   * Update this gesture to record whether anything is being dragged.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture.\n   */\n  private updateIsDragging(e: PointerEvent) {\n    if (!this.startWorkspace_) {\n      throw new Error(\n        'Cannot update dragging because the start workspace is undefined',\n      );\n    }\n\n    if (this.calledUpdateIsDragging) {\n      throw Error('updateIsDragging_ should only be called once per gesture.');\n    }\n    this.calledUpdateIsDragging = true;\n\n    // If we drag a block out of the flyout, it updates `common.getSelected`\n    // to return the new block.\n    if (this.flyout) this.updateIsDraggingFromFlyout();\n\n    const selected = common.getSelected();\n    if (selected && isDraggable(selected) && selected.isMovable()) {\n      this.dragging = true;\n      this.dragger = this.createDragger(selected, this.startWorkspace_);\n      this.dragger.onDragStart(e);\n      this.dragger.onDrag(e, this.currentDragDeltaXY);\n    } else {\n      this.updateIsDraggingWorkspace();\n    }\n  }\n\n  private createDragger(\n    draggable: IDraggable,\n    workspace: WorkspaceSvg,\n  ): IDragger {\n    const DraggerClass = registry.getClassFromOptions(\n      registry.Type.BLOCK_DRAGGER,\n      this.creatorWorkspace.options,\n      true,\n    );\n    return new DraggerClass!(draggable, workspace);\n  }\n\n  /**\n   * Start a gesture: update the workspace to indicate that a gesture is in\n   * progress and bind pointermove and pointerup handlers.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  doStart(e: PointerEvent) {\n    if (!this.startWorkspace_) {\n      throw new Error(\n        'Cannot start the touch gesture becauase the start ' +\n          'workspace is undefined',\n      );\n    }\n    this.isPinchZoomEnabled =\n      this.startWorkspace_.options.zoomOptions &&\n      this.startWorkspace_.options.zoomOptions.pinch;\n\n    if (browserEvents.isTargetInput(e)) {\n      this.cancel();\n      return;\n    }\n\n    this.gestureHasStarted = true;\n\n    blockAnimations.disconnectUiStop();\n\n    this.startWorkspace_.updateScreenCalculationsIfScrolled();\n    if (this.startWorkspace_.isMutator) {\n      // Mutator's coordinate system could be out of date because the bubble was\n      // dragged, the block was moved, the parent workspace zoomed, etc.\n      this.startWorkspace_.resize();\n    }\n\n    // Keep track of which field owns the dropdown before we close it.\n    this.currentDropdownOwner = dropDownDiv.getOwner();\n    // Hide chaff also hides the flyout, so don't do it if the click is in a\n    // flyout.\n    this.startWorkspace_.hideChaff(!!this.flyout);\n\n    this.startWorkspace_.markFocused();\n    this.mostRecentEvent = e;\n\n    Tooltip.block();\n\n    if (browserEvents.isRightButton(e)) {\n      this.handleRightClick(e);\n      return;\n    }\n\n    if (e.type.toLowerCase() === 'pointerdown' && e.pointerType !== 'mouse') {\n      Touch.longStart(e, this);\n    }\n\n    this.mouseDownXY = new Coordinate(e.clientX, e.clientY);\n\n    this.bindMouseEvents(e);\n\n    if (!this.isEnding_) {\n      this.handleTouchStart(e);\n    }\n  }\n\n  /**\n   * Bind gesture events.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  bindMouseEvents(e: PointerEvent) {\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        document,\n        'pointerdown',\n        null,\n        this.handleStart.bind(this),\n        /* opt_noCaptureIdentifier */ true,\n      ),\n    );\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        document,\n        'pointermove',\n        null,\n        this.handleMove.bind(this),\n        /* opt_noCaptureIdentifier */ true,\n      ),\n    );\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        document,\n        'pointerup',\n        null,\n        this.handleUp.bind(this),\n        /* opt_noCaptureIdentifier */ true,\n      ),\n    );\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  /**\n   * Handle a pointerdown event.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleStart(e: PointerEvent) {\n    if (this.isDragging()) {\n      // A drag has already started, so this can no longer be a pinch-zoom.\n      return;\n    }\n    this.handleTouchStart(e);\n\n    if (this.isMultiTouch()) {\n      Touch.longStop();\n    }\n  }\n\n  /**\n   * Handle a pointermove event.\n   *\n   * @param e A pointermove event.\n   * @internal\n   */\n  handleMove(e: PointerEvent) {\n    if (\n      (this.isDragging() && Touch.shouldHandleEvent(e)) ||\n      !this.isMultiTouch()\n    ) {\n      this.updateFromEvent(e);\n      if (this.workspaceDragger) {\n        this.workspaceDragger.drag(this.currentDragDeltaXY);\n      } else if (this.dragger) {\n        this.dragger.onDrag(this.mostRecentEvent, this.currentDragDeltaXY);\n      }\n      e.preventDefault();\n      e.stopPropagation();\n    } else if (this.isMultiTouch()) {\n      this.handleTouchMove(e);\n      Touch.longStop();\n    }\n  }\n\n  /**\n   * Handle a pointerup event.\n   *\n   * @param e A pointerup event.\n   * @internal\n   */\n  handleUp(e: PointerEvent) {\n    if (!this.isDragging()) {\n      this.handleTouchEnd(e);\n    }\n    if (!this.isMultiTouch() || this.isDragging()) {\n      if (!Touch.shouldHandleEvent(e)) {\n        return;\n      }\n      this.updateFromEvent(e);\n      Touch.longStop();\n\n      if (this.isEnding_) {\n        console.log('Trying to end a gesture recursively.');\n        return;\n      }\n      this.isEnding_ = true;\n      // The ordering of these checks is important: drags have higher priority\n      // than clicks.  Fields and icons have higher priority than blocks; blocks\n      // have higher priority than workspaces. The ordering within drags does\n      // not matter, because the three types of dragging are exclusive.\n      if (this.dragger) {\n        this.dragger.onDragEnd(e, this.currentDragDeltaXY);\n      } else if (this.workspaceDragger) {\n        this.workspaceDragger.endDrag(this.currentDragDeltaXY);\n      } else if (this.isBubbleClick()) {\n        // Do nothing, bubbles don't currently respond to clicks.\n      } else if (this.isCommentClick()) {\n        // Do nothing, comments don't currently respond to clicks.\n      } else if (this.isFieldClick()) {\n        this.doFieldClick();\n      } else if (this.isIconClick()) {\n        this.doIconClick();\n      } else if (this.isBlockClick()) {\n        this.doBlockClick();\n      } else if (this.isWorkspaceClick()) {\n        this.doWorkspaceClick(e);\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      this.dispose();\n    } else {\n      e.preventDefault();\n      e.stopPropagation();\n\n      this.dispose();\n    }\n  }\n\n  /**\n   * Handle a pointerdown event and keep track of current\n   * pointers.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleTouchStart(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    // store the pointerId in the current list of pointers\n    this.cachedPoints.set(pointerId, this.getTouchPoint(e));\n    const pointers = Array.from(this.cachedPoints.keys());\n    // If two pointers are down, store info\n    if (pointers.length === 2) {\n      const point0 = this.cachedPoints.get(pointers[0])!;\n      const point1 = this.cachedPoints.get(pointers[1])!;\n      this.startDistance = Coordinate.distance(point0, point1);\n      this.multiTouch = true;\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Handle a pointermove event and zoom in/out if two pointers\n   * are on the screen.\n   *\n   * @param e A pointermove event.\n   * @internal\n   */\n  handleTouchMove(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    this.cachedPoints.set(pointerId, this.getTouchPoint(e));\n\n    if (this.isPinchZoomEnabled && this.cachedPoints.size === 2) {\n      this.handlePinch(e);\n    } else {\n      // Handle the move directly instead of calling handleMove\n      this.updateFromEvent(e);\n      if (this.workspaceDragger) {\n        this.workspaceDragger.drag(this.currentDragDeltaXY);\n      } else if (this.dragger) {\n        this.dragger.onDrag(this.mostRecentEvent, this.currentDragDeltaXY);\n      }\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }\n\n  /**\n   * Handle pinch zoom gesture.\n   *\n   * @param e A pointermove event.\n   */\n  private handlePinch(e: PointerEvent) {\n    const pointers = Array.from(this.cachedPoints.keys());\n    // Calculate the distance between the two pointers\n    const point0 = this.cachedPoints.get(pointers[0])!;\n    const point1 = this.cachedPoints.get(pointers[1])!;\n    const moveDistance = Coordinate.distance(point0, point1);\n    const scale = moveDistance / this.startDistance;\n\n    if (this.previousScale > 0 && this.previousScale < Infinity) {\n      const gestureScale = scale - this.previousScale;\n      const delta =\n        gestureScale > 0\n          ? gestureScale * ZOOM_IN_MULTIPLIER\n          : gestureScale * ZOOM_OUT_MULTIPLIER;\n      if (!this.startWorkspace_) {\n        throw new Error(\n          'Cannot handle a pinch because the start workspace ' + 'is undefined',\n        );\n      }\n      const workspace = this.startWorkspace_;\n      const position = browserEvents.mouseToSvg(\n        e,\n        workspace.getParentSvg(),\n        workspace.getInverseScreenCTM(),\n      );\n      workspace.zoom(position.x, position.y, delta);\n    }\n    this.previousScale = scale;\n    e.preventDefault();\n  }\n\n  /**\n   * Handle a pointerup event and end the gesture.\n   *\n   * @param e A pointerup event.\n   * @internal\n   */\n  handleTouchEnd(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    if (this.cachedPoints.has(pointerId)) {\n      this.cachedPoints.delete(pointerId);\n    }\n    if (this.cachedPoints.size < 2) {\n      this.cachedPoints.clear();\n      this.previousScale = 0;\n    }\n  }\n\n  /**\n   * Helper function returning the current touch point coordinate.\n   *\n   * @param e A pointer event.\n   * @returns The current touch point coordinate\n   * @internal\n   */\n  getTouchPoint(e: PointerEvent): Coordinate | null {\n    if (!this.startWorkspace_) {\n      return null;\n    }\n    return new Coordinate(e.pageX, e.pageY);\n  }\n\n  /**\n   * Whether this gesture is part of a multi-touch gesture.\n   *\n   * @returns Whether this gesture is part of a multi-touch gesture.\n   * @internal\n   */\n  isMultiTouch(): boolean {\n    return this.multiTouch;\n  }\n\n  /**\n   * Cancel an in-progress gesture.  If a workspace or block drag is in\n   * progress, end the drag at the most recent location.\n   *\n   * @internal\n   */\n  cancel() {\n    // Disposing of a block cancels in-progress drags, but dragging to a delete\n    // area disposes of a block and leads to recursive disposal. Break that\n    // cycle.\n    if (this.isEnding_) {\n      return;\n    }\n    Touch.longStop();\n    if (this.dragger) {\n      this.dragger.onDragEnd(this.mostRecentEvent, this.currentDragDeltaXY);\n    } else if (this.workspaceDragger) {\n      this.workspaceDragger.endDrag(this.currentDragDeltaXY);\n    }\n    this.dispose();\n  }\n\n  /**\n   * Handle a real or faked right-click event by showing a context menu.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleRightClick(e: PointerEvent) {\n    if (this.targetBlock) {\n      this.bringBlockToFront();\n      this.targetBlock.workspace.hideChaff(!!this.flyout);\n      this.targetBlock.showContextMenu(e);\n    } else if (this.startBubble) {\n      this.startBubble.showContextMenu(e);\n    } else if (this.startComment) {\n      this.startComment.workspace.hideChaff();\n      this.startComment.showContextMenu(e);\n    } else if (this.startWorkspace_ && !this.flyout) {\n      this.startWorkspace_.hideChaff();\n      this.startWorkspace_.showContextMenu(e);\n    }\n\n    // TODO: Handle right-click on a bubble.\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.dispose();\n  }\n\n  /**\n   * Handle a pointerdown event on a workspace.\n   *\n   * @param e A pointerdown event.\n   * @param ws The workspace the event hit.\n   * @internal\n   */\n  handleWsStart(e: PointerEvent, ws: WorkspaceSvg) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleWsStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartWorkspace(ws);\n    this.mostRecentEvent = e;\n\n    if (!this.startBlock && !this.startBubble && !this.startComment) {\n      // Selection determines what things start drags. So to drag the workspace,\n      // we need to deselect anything that was previously selected.\n      common.setSelected(null);\n    }\n\n    this.doStart(e);\n  }\n\n  /**\n   * Fires a workspace click event.\n   *\n   * @param ws The workspace that a user clicks on.\n   */\n  private fireWorkspaceClick(ws: WorkspaceSvg) {\n    eventUtils.fire(\n      new (eventUtils.get(EventType.CLICK))(null, ws.id, 'workspace'),\n    );\n  }\n\n  /**\n   * Handle a pointerdown event on a flyout.\n   *\n   * @param e A pointerdown event.\n   * @param flyout The flyout the event hit.\n   * @internal\n   */\n  handleFlyoutStart(e: PointerEvent, flyout: IFlyout) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleFlyoutStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartFlyout(flyout);\n    this.handleWsStart(e, flyout.getWorkspace());\n  }\n\n  /**\n   * Handle a pointerdown event on a block.\n   *\n   * @param e A pointerdown event.\n   * @param block The block the event hit.\n   * @internal\n   */\n  handleBlockStart(e: PointerEvent, block: BlockSvg) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleBlockStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartBlock(block);\n    this.mostRecentEvent = e;\n  }\n\n  /**\n   * Handle a pointerdown event on a bubble.\n   *\n   * @param e A pointerdown event.\n   * @param bubble The bubble the event hit.\n   * @internal\n   */\n  handleBubbleStart(e: PointerEvent, bubble: IBubble) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleBubbleStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartBubble(bubble);\n    this.mostRecentEvent = e;\n  }\n\n  /**\n   * Handle a pointerdown event on a workspace comment.\n   *\n   * @param e A pointerdown event.\n   * @param comment The comment the event hit.\n   * @internal\n   */\n  handleCommentStart(e: PointerEvent, comment: RenderedWorkspaceComment) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.handleCommentStart, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    this.setStartComment(comment);\n    this.mostRecentEvent = e;\n  }\n\n  /* Begin functions defining what actions to take to execute clicks on each\n   * type of target.  Any developer wanting to add behaviour on clicks should\n   * modify only this code. */\n\n  /** Execute a field click. */\n  private doFieldClick() {\n    if (!this.startField) {\n      throw new Error(\n        'Cannot do a field click because the start field is undefined',\n      );\n    }\n\n    // Only show the editor if the field's editor wasn't already open\n    // right before this gesture started.\n    const dropdownAlreadyOpen = this.currentDropdownOwner === this.startField;\n    if (!dropdownAlreadyOpen) {\n      this.startField.showEditor(this.mostRecentEvent);\n    }\n    this.bringBlockToFront();\n  }\n\n  /** Execute an icon click. */\n  private doIconClick() {\n    if (!this.startIcon) {\n      throw new Error(\n        'Cannot do an icon click because the start icon is undefined',\n      );\n    }\n    this.bringBlockToFront();\n    this.startIcon.onClick();\n  }\n\n  /** Execute a block click. */\n  private doBlockClick() {\n    // Block click in an autoclosing flyout.\n    if (this.flyout && this.flyout.autoClose) {\n      if (!this.targetBlock) {\n        throw new Error(\n          'Cannot do a block click because the target block is ' + 'undefined',\n        );\n      }\n      if (this.targetBlock.isEnabled()) {\n        if (!eventUtils.getGroup()) {\n          eventUtils.setGroup(true);\n        }\n        const newBlock = this.flyout.createBlock(this.targetBlock);\n        newBlock.snapToGrid();\n        newBlock.bumpNeighbours();\n      }\n    } else {\n      if (!this.startWorkspace_) {\n        throw new Error(\n          'Cannot do a block click because the start workspace ' +\n            'is undefined',\n        );\n      }\n      // Clicks events are on the start block, even if it was a shadow.\n      const event = new (eventUtils.get(EventType.CLICK))(\n        this.startBlock,\n        this.startWorkspace_.id,\n        'block',\n      );\n      eventUtils.fire(event);\n    }\n    this.bringBlockToFront();\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Execute a workspace click. When in accessibility mode shift clicking will\n   * move the cursor.\n   *\n   * @param _e A pointerup event.\n   */\n  private doWorkspaceClick(_e: PointerEvent) {\n    const ws = this.creatorWorkspace;\n    if (common.getSelected()) {\n      common.getSelected()!.unselect();\n    }\n    this.fireWorkspaceClick(this.startWorkspace_ || ws);\n  }\n\n  /* End functions defining what actions to take to execute clicks on each type\n   * of target. */\n\n  // TODO (fenichel): Move bubbles to the front.\n\n  /**\n   * Move the dragged/clicked block to the front of the workspace so that it is\n   * not occluded by other blocks.\n   */\n  private bringBlockToFront() {\n    // Blocks in the flyout don't overlap, so skip the work.\n    if (this.targetBlock && !this.flyout) {\n      this.targetBlock.bringToFront();\n    }\n  }\n\n  /* Begin functions for populating a gesture at pointerdown. */\n\n  /**\n   * Record the field that a gesture started on.\n   *\n   * @param field The field the gesture started on.\n   * @internal\n   */\n  setStartField<T>(field: Field<T>) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.setStartField, ' +\n          'but the gesture had already been started.',\n      );\n    }\n    if (!this.startField) {\n      this.startField = field as Field;\n    }\n  }\n\n  /**\n   * Record the icon that a gesture started on.\n   *\n   * @param icon The icon the gesture started on.\n   * @internal\n   */\n  setStartIcon(icon: IIcon) {\n    if (this.gestureHasStarted) {\n      throw Error(\n        'Tried to call gesture.setStartIcon, ' +\n          'but the gesture had already been started.',\n      );\n    }\n\n    if (!this.startIcon) this.startIcon = icon;\n  }\n\n  /**\n   * Record the bubble that a gesture started on\n   *\n   * @param bubble The bubble the gesture started on.\n   * @internal\n   */\n  setStartBubble(bubble: IBubble) {\n    if (!this.startBubble) {\n      this.startBubble = bubble;\n    }\n  }\n\n  /**\n   * Record the comment that a gesture started on\n   *\n   * @param comment The comment the gesture started on.\n   * @internal\n   */\n  setStartComment(comment: RenderedWorkspaceComment) {\n    if (!this.startComment) {\n      this.startComment = comment;\n    }\n  }\n\n  /**\n   * Record the block that a gesture started on, and set the target block\n   * appropriately.\n   *\n   * @param block The block the gesture started on.\n   * @internal\n   */\n  setStartBlock(block: BlockSvg) {\n    // If the gesture already went through a bubble, don't set the start block.\n    if (!this.startBlock && !this.startBubble) {\n      this.startBlock = block;\n      common.setSelected(this.startBlock);\n      if (block.isInFlyout && block !== block.getRootBlock()) {\n        this.setTargetBlock(block.getRootBlock());\n      } else {\n        this.setTargetBlock(block);\n      }\n    }\n  }\n\n  /**\n   * Record the block that a gesture targets, meaning the block that will be\n   * dragged if this turns into a drag.  If this block is a shadow, that will be\n   * its first non-shadow parent.\n   *\n   * @param block The block the gesture targets.\n   */\n  private setTargetBlock(block: BlockSvg) {\n    if (block.isShadow()) {\n      // Non-null assertion is fine b/c it is an invariant that shadows always\n      // have parents.\n      this.setTargetBlock(block.getParent()!);\n    } else {\n      this.targetBlock = block;\n    }\n  }\n\n  /**\n   * Record the workspace that a gesture started on.\n   *\n   * @param ws The workspace the gesture started on.\n   */\n  private setStartWorkspace(ws: WorkspaceSvg) {\n    if (!this.startWorkspace_) {\n      this.startWorkspace_ = ws;\n    }\n  }\n\n  /**\n   * Record the flyout that a gesture started on.\n   *\n   * @param flyout The flyout the gesture started on.\n   */\n  private setStartFlyout(flyout: IFlyout) {\n    if (!this.flyout) {\n      this.flyout = flyout;\n    }\n  }\n\n  /* End functions for populating a gesture at pointerdown. */\n\n  /* Begin helper functions defining types of clicks.  Any developer wanting\n   * to change the definition of a click should modify only this code. */\n\n  /**\n   * Whether this gesture is a click on a bubble.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a bubble.\n   */\n  private isBubbleClick(): boolean {\n    // A bubble click starts on a bubble and never escapes the drag radius.\n    const hasStartBubble = !!this.startBubble;\n    return hasStartBubble && !this.hasExceededDragRadius;\n  }\n\n  private isCommentClick(): boolean {\n    return !!this.startComment && !this.hasExceededDragRadius;\n  }\n\n  /**\n   * Whether this gesture is a click on a block.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a block.\n   */\n  private isBlockClick(): boolean {\n    // A block click starts on a block, never escapes the drag radius, and is\n    // not a field click.\n    const hasStartBlock = !!this.startBlock;\n    return (\n      hasStartBlock &&\n      !this.hasExceededDragRadius &&\n      !this.isFieldClick() &&\n      !this.isIconClick()\n    );\n  }\n\n  /**\n   * Whether this gesture is a click on a field that should be handled.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a field.\n   */\n  private isFieldClick(): boolean {\n    if (!this.startField) return false;\n    return (\n      this.startField.isClickable() &&\n      !this.hasExceededDragRadius &&\n      (!this.flyout ||\n        this.startField.isClickableInFlyout(this.flyout.autoClose))\n    );\n  }\n\n  /** @returns Whether this gesture is a click on an icon that should be handled. */\n  private isIconClick(): boolean {\n    if (!this.startIcon) return false;\n    const handleInFlyout =\n      !this.flyout ||\n      !this.startIcon.isClickableInFlyout ||\n      this.startIcon.isClickableInFlyout(this.flyout.autoClose);\n    return !this.hasExceededDragRadius && handleInFlyout;\n  }\n\n  /**\n   * Whether this gesture is a click on a workspace.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a workspace.\n   */\n  private isWorkspaceClick(): boolean {\n    const onlyTouchedWorkspace =\n      !this.startBlock && !this.startBubble && !this.startField;\n    return onlyTouchedWorkspace && !this.hasExceededDragRadius;\n  }\n\n  /* End helper functions defining types of clicks. */\n\n  /** Returns the current dragger if the gesture is a drag. */\n  getCurrentDragger(): WorkspaceDragger | IDragger | null {\n    return this.workspaceDragger ?? this.dragger ?? null;\n  }\n\n  /**\n   * Whether this gesture is a drag of either a workspace or block.\n   * This function is called externally to block actions that cannot be taken\n   * mid-drag (e.g. using the keyboard to delete the selected blocks).\n   *\n   * @returns True if this gesture is a drag of a workspace or block.\n   * @internal\n   */\n  isDragging(): boolean {\n    return this.dragging;\n  }\n\n  /**\n   * Whether this gesture has already been started.  In theory every pointerdown\n   * has a corresponding pointerup, but in reality it is possible to lose a\n   * pointerup, leaving an in-process gesture hanging.\n   *\n   * @returns Whether this gesture was a click on a workspace.\n   * @internal\n   */\n  hasStarted(): boolean {\n    return this.gestureHasStarted;\n  }\n\n  /**\n   * Is a drag or other gesture currently in progress on any workspace?\n   *\n   * @returns True if gesture is occurring.\n   */\n  static inProgress(): boolean {\n    const workspaces = common.getAllWorkspaces();\n    for (let i = 0, workspace; (workspace = workspaces[i]); i++) {\n      // Not actually necessarily a WorkspaceSvg, but it doesn't matter b/c\n      // we're just checking if the property exists. Theoretically we would\n      // want to use instanceof, but that causes a circular dependency.\n      if ((workspace as WorkspaceSvg).currentGesture_) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object for configuring and updating a workspace grid in\n * Blockly.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Grid\n\nimport {GridOptions} from './options.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\n\n/**\n * Class for a workspace's grid.\n */\nexport class Grid {\n  private spacing: number;\n  private length: number;\n  private scale: number = 1;\n  private readonly line1: SVGElement;\n  private readonly line2: SVGElement;\n  private snapToGrid: boolean;\n\n  /**\n   * @param pattern The grid's SVG pattern, created during injection.\n   * @param options A dictionary of normalized options for the grid.\n   *     See grid documentation:\n   *     https://developers.google.com/blockly/guides/configure/web/grid\n   */\n  constructor(\n    private pattern: SVGElement,\n    options: GridOptions,\n  ) {\n    /** The spacing of the grid lines (in px). */\n    this.spacing = options['spacing'] ?? 0;\n\n    /** How long the grid lines should be (in px). */\n    this.length = options['length'] ?? 1;\n\n    /** The horizontal grid line, if it exists. */\n    this.line1 = pattern.firstChild as SVGElement;\n\n    /** The vertical grid line, if it exists. */\n    this.line2 = this.line1 && (this.line1.nextSibling as SVGElement);\n\n    /** Whether blocks should snap to the grid. */\n    this.snapToGrid = options['snap'] ?? false;\n  }\n\n  /**\n   * Sets the spacing between the centers of the grid lines.\n   *\n   * This does not trigger snapping to the newly spaced grid. If you want to\n   * snap blocks to the grid programmatically that needs to be triggered\n   * on individual top-level blocks. The next time a block is dragged and\n   * dropped it will snap to the grid if snapping to the grid is enabled.\n   */\n  setSpacing(spacing: number) {\n    this.spacing = spacing;\n    this.update(this.scale);\n  }\n\n  /**\n   * Get the spacing of the grid points (in px).\n   *\n   * @returns The spacing of the grid points.\n   */\n  getSpacing(): number {\n    return this.spacing;\n  }\n\n  /** Sets the length of the grid lines. */\n  setLength(length: number) {\n    this.length = length;\n    this.update(this.scale);\n  }\n\n  /** Get the length of the grid lines (in px). */\n  getLength(): number {\n    return this.length;\n  }\n\n  /**\n   * Sets whether blocks should snap to the grid or not.\n   *\n   * Setting this to true does not trigger snapping. If you want to snap blocks\n   * to the grid programmatically that needs to be triggered on individual\n   * top-level blocks. The next time a block is dragged and dropped it will\n   * snap to the grid.\n   */\n  setSnapToGrid(snap: boolean) {\n    this.snapToGrid = snap;\n  }\n\n  /**\n   * Whether blocks should snap to the grid.\n   *\n   * @returns True if blocks should snap, false otherwise.\n   */\n  shouldSnap(): boolean {\n    return this.snapToGrid;\n  }\n\n  /**\n   * Get the ID of the pattern element, which should be randomized to avoid\n   * conflicts with other Blockly instances on the page.\n   *\n   * @returns The pattern ID.\n   * @internal\n   */\n  getPatternId(): string {\n    return this.pattern.id;\n  }\n\n  /**\n   * Update the grid with a new scale.\n   *\n   * @param scale The new workspace scale.\n   * @internal\n   */\n  update(scale: number) {\n    this.scale = scale;\n    const safeSpacing = this.spacing * scale;\n\n    this.pattern.setAttribute('width', `${safeSpacing}`);\n    this.pattern.setAttribute('height', `${safeSpacing}`);\n\n    let half = Math.floor(this.spacing / 2) + 0.5;\n    let start = half - this.length / 2;\n    let end = half + this.length / 2;\n\n    half *= scale;\n    start *= scale;\n    end *= scale;\n\n    this.setLineAttributes(this.line1, scale, start, end, half, half);\n    this.setLineAttributes(this.line2, scale, half, half, start, end);\n  }\n\n  /**\n   * Set the attributes on one of the lines in the grid.  Use this to update the\n   * length and stroke width of the grid lines.\n   *\n   * @param line Which line to update.\n   * @param width The new stroke size (in px).\n   * @param x1 The new x start position of the line (in px).\n   * @param x2 The new x end position of the line (in px).\n   * @param y1 The new y start position of the line (in px).\n   * @param y2 The new y end position of the line (in px).\n   */\n  private setLineAttributes(\n    line: SVGElement,\n    width: number,\n    x1: number,\n    x2: number,\n    y1: number,\n    y2: number,\n  ) {\n    if (line) {\n      line.setAttribute('stroke-width', `${width}`);\n      line.setAttribute('x1', `${x1}`);\n      line.setAttribute('y1', `${y1}`);\n      line.setAttribute('x2', `${x2}`);\n      line.setAttribute('y2', `${y2}`);\n    }\n  }\n\n  /**\n   * Move the grid to a new x and y position, and make sure that change is\n   * visible.\n   *\n   * @param x The new x position of the grid (in px).\n   * @param y The new y position of the grid (in px).\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.pattern.setAttribute('x', `${x}`);\n    this.pattern.setAttribute('y', `${y}`);\n  }\n\n  /**\n   * Given a coordinate, return the nearest coordinate aligned to the grid.\n   *\n   * @param xy A workspace coordinate.\n   * @returns Workspace coordinate of nearest grid point.\n   *   If there's no change, return the same coordinate object.\n   */\n  alignXY(xy: Coordinate): Coordinate {\n    const spacing = this.getSpacing();\n    const half = spacing / 2;\n    const x = Math.round(Math.round((xy.x - half) / spacing) * spacing + half);\n    const y = Math.round(Math.round((xy.y - half) / spacing) * spacing + half);\n    if (x === xy.x && y === xy.y) {\n      // No change.\n      return xy;\n    }\n    return new Coordinate(x, y);\n  }\n\n  /**\n   * Create the DOM for the grid described by options.\n   *\n   * @param rnd A random ID to append to the pattern's ID.\n   * @param gridOptions The object containing grid configuration.\n   * @param defs The root SVG element for this workspace's defs.\n   * @returns The SVG element for the grid pattern.\n   * @internal\n   */\n  static createDom(\n    rnd: string,\n    gridOptions: GridOptions,\n    defs: SVGElement,\n  ): SVGElement {\n    /*\n          <pattern id=\"blocklyGridPattern837493\" patternUnits=\"userSpaceOnUse\">\n            <rect stroke=\"#888\" />\n            <rect stroke=\"#888\" />\n          </pattern>\n        */\n    const gridPattern = dom.createSvgElement(\n      Svg.PATTERN,\n      {'id': 'blocklyGridPattern' + rnd, 'patternUnits': 'userSpaceOnUse'},\n      defs,\n    );\n    // x1, y1, x1, x2 properties will be set later in update.\n    if ((gridOptions['length'] ?? 1) > 0 && (gridOptions['spacing'] ?? 0) > 0) {\n      dom.createSvgElement(\n        Svg.LINE,\n        {'stroke': gridOptions['colour']},\n        gridPattern,\n      );\n      if (gridOptions['length'] ?? 1 > 1) {\n        dom.createSvgElement(\n          Svg.LINE,\n          {'stroke': gridOptions['colour']},\n          gridPattern,\n        );\n      }\n    } else {\n      // Edge 16 doesn't handle empty patterns\n      dom.createSvgElement(Svg.LINE, {}, gridPattern);\n    }\n    return gridPattern;\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IRenderedElement} from './interfaces/i_rendered_element.js';\nimport * as layerNums from './layers.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\n/** @internal */\nexport class LayerManager {\n  /** The layer elements being dragged are appended to. */\n  private dragLayer: SVGGElement | undefined;\n  /** The layer elements being animated are appended to. */\n  private animationLayer: SVGGElement | undefined;\n  /** The layers elements not being dragged are appended to.  */\n  private layers = new Map<number, SVGGElement>();\n\n  /** @internal */\n  constructor(private workspace: WorkspaceSvg) {\n    const injectionDiv = workspace.getInjectionDiv();\n    // `getInjectionDiv` is actually nullable. We hit this if the workspace\n    // is part of a flyout and the workspace the flyout is attached to hasn't\n    // been appended yet.\n    if (injectionDiv) {\n      this.dragLayer = this.createDragLayer(injectionDiv);\n      this.animationLayer = this.createAnimationLayer(injectionDiv);\n    }\n\n    // We construct these manually so we can add the css class for backwards\n    // compatibility.\n    const blockLayer = this.createLayer(layerNums.BLOCK);\n    dom.addClass(blockLayer, 'blocklyBlockCanvas');\n    const bubbleLayer = this.createLayer(layerNums.BUBBLE);\n    dom.addClass(bubbleLayer, 'blocklyBubbleCanvas');\n  }\n\n  private createDragLayer(injectionDiv: Element) {\n    const svg = dom.createSvgElement(Svg.SVG, {\n      'class': 'blocklyBlockDragSurface',\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n    });\n    injectionDiv.append(svg);\n    return dom.createSvgElement(Svg.G, {}, svg);\n  }\n\n  private createAnimationLayer(injectionDiv: Element) {\n    const svg = dom.createSvgElement(Svg.SVG, {\n      'class': 'blocklyAnimationLayer',\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n    });\n    injectionDiv.append(svg);\n    return dom.createSvgElement(Svg.G, {}, svg);\n  }\n\n  /**\n   * Appends the element to the animation layer. The animation layer doesn't\n   * move when the workspace moves, so e.g. delete animations don't move\n   * when a block delete triggers a workspace resize.\n   *\n   * @internal\n   */\n  appendToAnimationLayer(elem: IRenderedElement) {\n    const currentTransform = this.dragLayer?.getAttribute('transform');\n    // Only update the current transform when appending, so animations don't\n    // move if the workspace moves.\n    if (currentTransform) {\n      this.animationLayer?.setAttribute('transform', currentTransform);\n    }\n    this.animationLayer?.appendChild(elem.getSvgRoot());\n  }\n\n  /**\n   * Translates layers when the workspace is dragged or zoomed.\n   *\n   * @internal\n   */\n  translateLayers(newCoord: Coordinate, newScale: number) {\n    const translation = `translate(${newCoord.x}, ${newCoord.y}) scale(${newScale})`;\n    this.dragLayer?.setAttribute('transform', translation);\n    for (const [_, layer] of this.layers) {\n      layer.setAttribute('transform', translation);\n    }\n  }\n\n  /**\n   * Moves the given element to the drag layer, which exists on top of all other\n   * layers, and the drag surface.\n   *\n   * @internal\n   */\n  moveToDragLayer(elem: IRenderedElement) {\n    this.dragLayer?.appendChild(elem.getSvgRoot());\n  }\n\n  /**\n   * Moves the given element off of the drag layer.\n   *\n   * @internal\n   */\n  moveOffDragLayer(elem: IRenderedElement, layerNum: number) {\n    this.append(elem, layerNum);\n  }\n\n  /**\n   * Appends the given element to a layer. If the layer does not exist, it is\n   * created.\n   *\n   * @internal\n   */\n  append(elem: IRenderedElement, layerNum: number) {\n    if (!this.layers.has(layerNum)) {\n      this.createLayer(layerNum);\n    }\n    this.layers.get(layerNum)?.appendChild(elem.getSvgRoot());\n  }\n\n  /**\n   * Creates a layer and inserts it at the proper place given the layer number.\n   *\n   * More positive layers exist later in the dom and are rendered ontop of\n   * less positive layers. Layers are added to the layer map as a side effect.\n   */\n  private createLayer(layerNum: number): SVGGElement {\n    const parent = this.workspace.getSvgGroup();\n    const layer = dom.createSvgElement(Svg.G, {});\n\n    let inserted = false;\n    const sortedLayers = [...this.layers].sort((a, b) => a[0] - b[0]);\n    for (const [num, sib] of sortedLayers) {\n      if (layerNum < num) {\n        parent.insertBefore(layer, sib);\n        inserted = true;\n        break;\n      }\n    }\n    if (!inserted) {\n      parent.appendChild(layer);\n    }\n    this.layers.set(layerNum, layer);\n    return layer;\n  }\n\n  /**\n   * Returns true if the given element is a layer managed by the layer manager.\n   * False otherwise.\n   *\n   * @internal\n   */\n  hasLayer(elem: SVGElement) {\n    return (\n      elem === this.dragLayer ||\n      new Set(this.layers.values()).has(elem as SVGGElement)\n    );\n  }\n\n  /**\n   * We need to be able to access this layer explicitly for backwards\n   * compatibility.\n   *\n   * @internal\n   */\n  getBlockLayer(): SVGGElement {\n    return this.layers.get(layerNums.BLOCK)!;\n  }\n\n  /**\n   * We need to be able to access this layer explicitly for backwards\n   * compatibility.\n   *\n   * @internal\n   */\n  getBubbleLayer(): SVGGElement {\n    return this.layers.get(layerNums.BUBBLE)!;\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a theme.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Theme\n\nimport * as registry from './registry.js';\nimport * as object from './utils/object.js';\n\nexport interface ITheme {\n  blockStyles?: {[key: string]: Partial<BlockStyle>};\n  categoryStyles?: {[key: string]: CategoryStyle};\n  componentStyles?: ComponentStyle;\n  fontStyle?: FontStyle;\n  startHats?: boolean;\n  base?: string | Theme;\n  name: string;\n}\n\n/**\n * Class for a theme.\n */\nexport class Theme implements ITheme {\n  /** @internal */\n  blockStyles: {[key: string]: BlockStyle};\n  /** @internal */\n  categoryStyles: {[key: string]: CategoryStyle};\n  /** @internal */\n  componentStyles: ComponentStyle;\n  /** @internal */\n  fontStyle: FontStyle;\n\n  /**\n   * Whether or not to add a 'hat' on top of all blocks with no previous or\n   * output connections.\n   *\n   * @internal\n   */\n  startHats?: boolean = false;\n\n  /**\n   * @param name Theme name.\n   * @param opt_blockStyles A map from style names (strings) to objects with\n   *     style attributes for blocks.\n   * @param opt_categoryStyles A map from style names (strings) to objects with\n   *     style attributes for categories.\n   * @param opt_componentStyles A map of Blockly component names to style value.\n   */\n  constructor(\n    public name: string,\n    opt_blockStyles?: {[key: string]: Partial<BlockStyle>},\n    opt_categoryStyles?: {[key: string]: CategoryStyle},\n    opt_componentStyles?: ComponentStyle,\n  ) {\n    /** The block styles map. */\n    this.blockStyles = opt_blockStyles || Object.create(null);\n\n    /** The category styles map. */\n    this.categoryStyles = opt_categoryStyles || Object.create(null);\n\n    /** The UI components styles map. */\n    this.componentStyles =\n      opt_componentStyles || (Object.create(null) as ComponentStyle);\n\n    /** The font style. */\n    this.fontStyle = Object.create(null) as FontStyle;\n\n    // Register the theme by name.\n    registry.register(registry.Type.THEME, name, this, true);\n  }\n\n  /**\n   * Gets the class name that identifies this theme.\n   *\n   * @returns The CSS class name.\n   * @internal\n   */\n  getClassName(): string {\n    return this.name + '-theme';\n  }\n\n  /**\n   * Overrides or adds a style to the blockStyles map.\n   *\n   * @param blockStyleName The name of the block style.\n   * @param blockStyle The block style.\n   */\n  setBlockStyle(blockStyleName: string, blockStyle: BlockStyle) {\n    this.blockStyles[blockStyleName] = blockStyle;\n  }\n\n  /**\n   * Overrides or adds a style to the categoryStyles map.\n   *\n   * @param categoryStyleName The name of the category style.\n   * @param categoryStyle The category style.\n   */\n  setCategoryStyle(categoryStyleName: string, categoryStyle: CategoryStyle) {\n    this.categoryStyles[categoryStyleName] = categoryStyle;\n  }\n\n  /**\n   * Gets the style for a given Blockly UI component.  If the style value is a\n   * string, we attempt to find the value of any named references.\n   *\n   * @param componentName The name of the component.\n   * @returns The style value.\n   */\n  getComponentStyle(componentName: string): string | null {\n    const style = (this.componentStyles as AnyDuringMigration)[componentName];\n    if (!style) {\n      return null;\n    }\n    if (typeof style === 'string') {\n      const recursiveStyle = this.getComponentStyle(style);\n      if (recursiveStyle) {\n        return recursiveStyle;\n      }\n    }\n    return `${style}`;\n  }\n\n  /**\n   * Configure a specific Blockly UI component with a style value.\n   *\n   * @param componentName The name of the component.\n   * @param styleValue The style value.\n   */\n  setComponentStyle(componentName: string, styleValue: AnyDuringMigration) {\n    (this.componentStyles as AnyDuringMigration)[componentName] = styleValue;\n  }\n\n  /**\n   * Configure a theme's font style.\n   *\n   * @param fontStyle The font style.\n   */\n  setFontStyle(fontStyle: FontStyle) {\n    this.fontStyle = fontStyle;\n  }\n\n  /**\n   * Configure a theme's start hats.\n   *\n   * @param startHats True if the theme enables start hats, false otherwise.\n   */\n  setStartHats(startHats: boolean) {\n    this.startHats = startHats;\n  }\n\n  /**\n   * Define a new Blockly theme.\n   *\n   * @param name The name of the theme.\n   * @param themeObj An object containing theme properties.\n   * @returns A new Blockly theme.\n   */\n  static defineTheme(name: string, themeObj: ITheme): Theme {\n    name = name.toLowerCase();\n    const theme = new Theme(name);\n    let base = themeObj['base'];\n    if (base) {\n      if (typeof base === 'string') {\n        base = registry.getObject(registry.Type.THEME, base) ?? undefined;\n      }\n      if (base instanceof Theme) {\n        object.deepMerge(theme, base);\n        theme.name = name;\n      }\n    }\n\n    object.deepMerge(theme.blockStyles, themeObj['blockStyles']);\n    object.deepMerge(theme.categoryStyles, themeObj['categoryStyles']);\n    object.deepMerge(theme.componentStyles, themeObj['componentStyles']);\n    object.deepMerge(theme.fontStyle, themeObj['fontStyle']);\n    if (themeObj['startHats'] !== null) {\n      theme.startHats = themeObj['startHats'];\n    }\n\n    return theme;\n  }\n}\n\nexport namespace Theme {\n  export interface BlockStyle {\n    colourPrimary: string;\n    colourSecondary: string;\n    colourTertiary: string;\n    hat: string;\n  }\n\n  export interface CategoryStyle {\n    colour: string;\n  }\n\n  export interface ComponentStyle {\n    workspaceBackgroundColour?: string;\n    toolboxBackgroundColour?: string;\n    toolboxForegroundColour?: string;\n    flyoutBackgroundColour?: string;\n    flyoutForegroundColour?: string;\n    flyoutOpacity?: number;\n    scrollbarColour?: string;\n    scrollbarOpacity?: number;\n    insertionMarkerColour?: string;\n    insertionMarkerOpacity?: number;\n    markerColour?: string;\n    cursorColour?: string;\n    selectedGlowColour?: string;\n    selectedGlowOpacity?: number;\n    replacementGlowColour?: string;\n    replacementGlowOpacity?: number;\n  }\n\n  export interface FontStyle {\n    family?: string;\n    weight?: string;\n    size?: number;\n  }\n}\n\nexport type BlockStyle = Theme.BlockStyle;\nexport type CategoryStyle = Theme.CategoryStyle;\nexport type ComponentStyle = Theme.ComponentStyle;\nexport type FontStyle = Theme.FontStyle;\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Themes.Classic\n\nimport {Theme} from '../theme.js';\n\nconst defaultBlockStyles = {\n  'colour_blocks': {'colourPrimary': '20'},\n  'list_blocks': {'colourPrimary': '260'},\n  'logic_blocks': {'colourPrimary': '210'},\n  'loop_blocks': {'colourPrimary': '120'},\n  'math_blocks': {'colourPrimary': '230'},\n  'procedure_blocks': {'colourPrimary': '290'},\n  'text_blocks': {'colourPrimary': '160'},\n  'variable_blocks': {'colourPrimary': '330'},\n  'variable_dynamic_blocks': {'colourPrimary': '310'},\n  'hat_blocks': {'colourPrimary': '330', 'hat': 'cap'},\n};\n\nconst categoryStyles = {\n  'colour_category': {'colour': '20'},\n  'list_category': {'colour': '260'},\n  'logic_category': {'colour': '210'},\n  'loop_category': {'colour': '120'},\n  'math_category': {'colour': '230'},\n  'procedure_category': {'colour': '290'},\n  'text_category': {'colour': '160'},\n  'variable_category': {'colour': '330'},\n  'variable_dynamic_category': {'colour': '310'},\n};\n\n/**\n * Classic theme.\n * Contains multi-coloured border to create shadow effect.\n */\nexport const Classic = new Theme('classic', defaultBlockStyles, categoryStyles);\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object that controls settings for the workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Options\n\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as registry from './registry.js';\nimport {Theme} from './theme.js';\nimport {Classic} from './theme/classic.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport type {Metrics} from './utils/metrics.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Parse the user-specified options, using reasonable defaults where behaviour\n * is unspecified.\n */\nexport class Options {\n  RTL: boolean;\n  oneBasedIndex: boolean;\n  collapse: boolean;\n  comments: boolean;\n  disable: boolean;\n  readOnly: boolean;\n  maxBlocks: number;\n  maxInstances: {[key: string]: number} | null;\n  modalInputs: boolean;\n  pathToMedia: string;\n  hasCategories: boolean;\n  moveOptions: MoveOptions;\n  /** @deprecated  January 2019 */\n  hasScrollbars: boolean;\n  hasTrashcan: boolean;\n  maxTrashcanContents: number;\n  hasSounds: boolean;\n  hasCss: boolean;\n  horizontalLayout: boolean;\n  languageTree: toolbox.ToolboxInfo | null;\n  gridOptions: GridOptions;\n  zoomOptions: ZoomOptions;\n  toolboxPosition: toolbox.Position;\n  theme: Theme;\n  renderer: string;\n  rendererOverrides: {[rendererConstant: string]: any} | null;\n\n  /**\n   * The SVG element for the grid pattern.\n   * Created during injection.\n   */\n  gridPattern: SVGElement | null = null;\n  parentWorkspace: WorkspaceSvg | null;\n  plugins: {[key: string]: (new (...p1: any[]) => any) | string};\n\n  /**\n   * If set, sets the translation of the workspace to match the scrollbars.\n   * A function that\n   *     sets the translation of the workspace to match the scrollbars. The\n   *     argument Contains an x and/or y property which is a float between 0\n   *     and 1 specifying the degree of scrolling.\n   */\n  setMetrics?: (p1: {x?: number; y?: number}) => void = undefined;\n\n  /**\n   * A function that returns a metrics\n   *     object that describes the current workspace.\n   */\n  getMetrics?: () => Metrics = undefined;\n\n  /**\n   * @param options Dictionary of options.\n   *     Specification:\n   * https://developers.google.com/blockly/guides/get-started/web#configuration\n   */\n  constructor(options: BlocklyOptions) {\n    let toolboxJsonDef = null;\n    let hasCategories = false;\n    let hasTrashcan = false;\n    let hasCollapse = false;\n    let hasComments = false;\n    let hasDisable = false;\n    let hasSounds = false;\n    const readOnly = !!options['readOnly'];\n    if (!readOnly) {\n      toolboxJsonDef = toolbox.convertToolboxDefToJson(\n        options['toolbox'] ?? null,\n      );\n      hasCategories = toolbox.hasCategories(toolboxJsonDef);\n      const rawHasTrashcan = options['trashcan'];\n      hasTrashcan =\n        rawHasTrashcan === undefined ? hasCategories : rawHasTrashcan;\n      const rawHasCollapse = options['collapse'];\n      hasCollapse =\n        rawHasCollapse === undefined ? hasCategories : rawHasCollapse;\n      const rawHasComments = options['comments'];\n      hasComments =\n        rawHasComments === undefined ? hasCategories : rawHasComments;\n      const rawHasDisable = options['disable'];\n      hasDisable = rawHasDisable === undefined ? hasCategories : rawHasDisable;\n      const rawHasSounds = options['sounds'];\n      hasSounds = rawHasSounds === undefined ? true : rawHasSounds;\n    }\n\n    let maxTrashcanContents = options['maxTrashcanContents'];\n    if (hasTrashcan) {\n      if (maxTrashcanContents === undefined) {\n        maxTrashcanContents = 32;\n      }\n    } else {\n      maxTrashcanContents = 0;\n    }\n    const rtl = !!options['rtl'];\n    let horizontalLayout = options['horizontalLayout'];\n    if (horizontalLayout === undefined) {\n      horizontalLayout = false;\n    }\n    const toolboxAtStart = options['toolboxPosition'] !== 'end';\n\n    let toolboxPosition: toolbox.Position;\n    if (horizontalLayout) {\n      toolboxPosition = toolboxAtStart\n        ? toolbox.Position.TOP\n        : toolbox.Position.BOTTOM;\n    } else {\n      toolboxPosition =\n        toolboxAtStart === rtl ? toolbox.Position.RIGHT : toolbox.Position.LEFT;\n    }\n\n    let hasCss = options['css'];\n    if (hasCss === undefined) {\n      hasCss = true;\n    }\n    let pathToMedia = 'https://blockly-demo.appspot.com/static/media/';\n    if (options['media']) {\n      pathToMedia = options['media'].endsWith('/')\n        ? options['media']\n        : options['media'] + '/';\n    }\n    const rawOneBasedIndex = options['oneBasedIndex'];\n    const oneBasedIndex =\n      rawOneBasedIndex === undefined ? true : rawOneBasedIndex;\n    const renderer = options['renderer'] || 'geras';\n\n    const plugins = options['plugins'] || {};\n\n    let modalInputs = options['modalInputs'];\n    if (modalInputs === undefined) {\n      modalInputs = true;\n    }\n\n    this.RTL = rtl;\n    this.oneBasedIndex = oneBasedIndex;\n    this.collapse = hasCollapse;\n    this.comments = hasComments;\n    this.disable = hasDisable;\n    this.readOnly = readOnly;\n    this.maxBlocks = options['maxBlocks'] || Infinity;\n    this.maxInstances = options['maxInstances'] ?? null;\n    this.modalInputs = modalInputs;\n    this.pathToMedia = pathToMedia;\n    this.hasCategories = hasCategories;\n    this.moveOptions = Options.parseMoveOptions(options, hasCategories);\n    this.hasScrollbars = !!this.moveOptions.scrollbars;\n    this.hasTrashcan = hasTrashcan;\n    this.maxTrashcanContents = maxTrashcanContents;\n    this.hasSounds = hasSounds;\n    this.hasCss = hasCss;\n    this.horizontalLayout = horizontalLayout;\n    this.languageTree = toolboxJsonDef;\n    this.gridOptions = Options.parseGridOptions(options);\n    this.zoomOptions = Options.parseZoomOptions(options);\n    this.toolboxPosition = toolboxPosition;\n    this.theme = Options.parseThemeOptions(options);\n    this.renderer = renderer;\n    this.rendererOverrides = options['rendererOverrides'] ?? null;\n\n    /**\n     * The parent of the current workspace, or null if there is no parent\n     * workspace.  We can assert that this is of type WorkspaceSvg as opposed to\n     * Workspace as this is only used in a rendered workspace.\n     */\n    this.parentWorkspace = options['parentWorkspace'] ?? null;\n\n    /** Map of plugin type to name of registered plugin or plugin class. */\n    this.plugins = plugins;\n  }\n\n  /**\n   * Parse the user-specified move options, using reasonable defaults where\n   *    behaviour is unspecified.\n   *\n   * @param options Dictionary of options.\n   * @param hasCategories Whether the workspace has categories or not.\n   * @returns Normalized move options.\n   */\n  private static parseMoveOptions(\n    options: BlocklyOptions,\n    hasCategories: boolean,\n  ): MoveOptions {\n    const move = options['move'] || {};\n    const moveOptions = {} as MoveOptions;\n    if (\n      move['scrollbars'] === undefined &&\n      options['scrollbars'] === undefined\n    ) {\n      moveOptions.scrollbars = hasCategories;\n    } else if (typeof move['scrollbars'] === 'object') {\n      moveOptions.scrollbars = {\n        'horizontal': !!move['scrollbars']['horizontal'],\n        'vertical': !!move['scrollbars']['vertical'],\n      };\n      // Convert scrollbars object to boolean if they have the same value.\n      // This allows us to easily check for whether any scrollbars exist using\n      // !!moveOptions.scrollbars.\n      if (\n        moveOptions.scrollbars.horizontal &&\n        moveOptions.scrollbars.vertical\n      ) {\n        moveOptions.scrollbars = true;\n      } else if (\n        !moveOptions.scrollbars.horizontal &&\n        !moveOptions.scrollbars.vertical\n      ) {\n        moveOptions.scrollbars = false;\n      }\n    } else {\n      moveOptions.scrollbars = !!move['scrollbars'] || !!options['scrollbars'];\n    }\n\n    if (!moveOptions.scrollbars || move['wheel'] === undefined) {\n      // Defaults to true if single-direction scroll is enabled.\n      moveOptions.wheel = typeof moveOptions.scrollbars === 'object';\n    } else {\n      moveOptions.wheel = !!move['wheel'];\n    }\n    if (!moveOptions.scrollbars) {\n      moveOptions.drag = false;\n    } else if (move['drag'] === undefined) {\n      // Defaults to true if scrollbars is true.\n      moveOptions.drag = true;\n    } else {\n      moveOptions.drag = !!move['drag'];\n    }\n    return moveOptions;\n  }\n\n  /**\n   * Parse the user-specified zoom options, using reasonable defaults where\n   * behaviour is unspecified.  See zoom documentation:\n   *   https://developers.google.com/blockly/guides/configure/web/zoom\n   *\n   * @param options Dictionary of options.\n   * @returns Normalized zoom options.\n   */\n  private static parseZoomOptions(options: BlocklyOptions): ZoomOptions {\n    const zoom = options['zoom'] || {};\n    const zoomOptions = {} as ZoomOptions;\n    if (zoom['controls'] === undefined) {\n      zoomOptions.controls = false;\n    } else {\n      zoomOptions.controls = !!zoom['controls'];\n    }\n    if (zoom['wheel'] === undefined) {\n      zoomOptions.wheel = false;\n    } else {\n      zoomOptions.wheel = !!zoom['wheel'];\n    }\n    if (zoom['startScale'] === undefined) {\n      zoomOptions.startScale = 1;\n    } else {\n      zoomOptions.startScale = Number(zoom['startScale']);\n    }\n    if (zoom['maxScale'] === undefined) {\n      zoomOptions.maxScale = 3;\n    } else {\n      zoomOptions.maxScale = Number(zoom['maxScale']);\n    }\n    if (zoom['minScale'] === undefined) {\n      zoomOptions.minScale = 0.3;\n    } else {\n      zoomOptions.minScale = Number(zoom['minScale']);\n    }\n    if (zoom['scaleSpeed'] === undefined) {\n      zoomOptions.scaleSpeed = 1.2;\n    } else {\n      zoomOptions.scaleSpeed = Number(zoom['scaleSpeed']);\n    }\n    if (zoom['pinch'] === undefined) {\n      zoomOptions.pinch = zoomOptions.wheel || zoomOptions.controls;\n    } else {\n      zoomOptions.pinch = !!zoom['pinch'];\n    }\n    return zoomOptions;\n  }\n\n  /**\n   * Parse the user-specified grid options, using reasonable defaults where\n   * behaviour is unspecified. See grid documentation:\n   *   https://developers.google.com/blockly/guides/configure/web/grid\n   *\n   * @param options Dictionary of options.\n   * @returns Normalized grid options.\n   */\n  private static parseGridOptions(options: BlocklyOptions): GridOptions {\n    const grid = options['grid'] || {};\n    const gridOptions = {} as GridOptions;\n    gridOptions.spacing = Number(grid['spacing']) || 0;\n    gridOptions.colour = grid['colour'] || '#888';\n    gridOptions.length =\n      grid['length'] === undefined ? 1 : Number(grid['length']);\n    gridOptions.snap = gridOptions.spacing > 0 && !!grid['snap'];\n    return gridOptions;\n  }\n\n  /**\n   * Parse the user-specified theme options, using the classic theme as a\n   * default. https://developers.google.com/blockly/guides/configure/web/themes\n   *\n   * @param options Dictionary of options.\n   * @returns A Blockly Theme.\n   */\n  private static parseThemeOptions(options: BlocklyOptions): Theme {\n    const theme = options['theme'] || Classic;\n    if (typeof theme === 'string') {\n      return registry.getObject(registry.Type.THEME, theme) as Theme;\n    } else if (theme instanceof Theme) {\n      return theme;\n    }\n    return Theme.defineTheme(\n      theme.name || 'builtin' + idGenerator.getNextUniqueId(),\n      theme,\n    );\n  }\n}\n\nexport namespace Options {\n  export interface GridOptions {\n    colour: string;\n    length: number;\n    snap: boolean;\n    spacing: number;\n  }\n\n  export interface MoveOptions {\n    drag: boolean;\n    scrollbars: boolean | ScrollbarOptions;\n    wheel: boolean;\n  }\n\n  export interface ScrollbarOptions {\n    horizontal: boolean;\n    vertical: boolean;\n  }\n\n  export interface ZoomOptions {\n    controls: boolean;\n    maxScale: number;\n    minScale: number;\n    pinch: boolean;\n    scaleSpeed: number;\n    startScale: number;\n    wheel: boolean;\n  }\n}\n\nexport type GridOptions = Options.GridOptions;\nexport type MoveOptions = Options.MoveOptions;\nexport type ScrollbarOptions = Options.ScrollbarOptions;\nexport type ZoomOptions = Options.ZoomOptions;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Dropdown input field.  Used for editable titles and variables.\n * In the interests of a consistent UI, the toolbox shares some functions and\n * properties with the context menu.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldDropdown\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {\n  Field,\n  FieldConfig,\n  FieldValidator,\n  UnattachedFieldError,\n} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport * as utilsString from './utils/string.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\n\n/**\n * Class for an editable dropdown field.\n */\nexport class FieldDropdown extends Field<string> {\n  /** Horizontal distance that a checkmark overhangs the dropdown. */\n  static CHECKMARK_OVERHANG = 25;\n\n  /**\n   * Maximum height of the dropdown menu, as a percentage of the viewport\n   * height.\n   */\n  static MAX_MENU_HEIGHT_VH = 0.45;\n\n  static ARROW_CHAR = '';\n\n  /** A reference to the currently selected menu item. */\n  private selectedMenuItem: MenuItem | null = null;\n\n  /** The dropdown menu. */\n  protected menu_: Menu | null = null;\n\n  /**\n   * SVG image element if currently selected option is an image, or null.\n   */\n  private imageElement: SVGImageElement | null = null;\n\n  /** Tspan based arrow element. */\n  private arrow: SVGTSpanElement | null = null;\n\n  /** SVG based arrow element. */\n  private svgArrow: SVGElement | null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'default';\n\n  protected menuGenerator_?: MenuGenerator;\n\n  /** A cache of the most recently generated options. */\n  private generatedOptions: MenuOption[] | null = null;\n\n  /**\n   * The prefix field label, of common words set after options are trimmed.\n   *\n   * @internal\n   */\n  override prefixField: string | null = null;\n\n  /**\n   * The suffix field label, of common words set after options are trimmed.\n   *\n   * @internal\n   */\n  override suffixField: string | null = null;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  private selectedOption!: MenuOption;\n  override clickTarget_: SVGElement | null = null;\n\n  /**\n   * The y offset from the top of the field to the top of the image, if an image\n   * is selected.\n   */\n  protected static IMAGE_Y_OFFSET = 5;\n\n  /** The total vertical padding above and below an image. */\n  protected static IMAGE_Y_PADDING = FieldDropdown.IMAGE_Y_OFFSET * 2;\n\n  /**\n   * @param menuGenerator A non-empty array of options for a dropdown list, or a\n   *     function which generates these options. Also accepts Field.SKIP_SETUP\n   *     if you wish to skip setup (only used by subclasses that want to handle\n   *     configuration and setting the field value after their own constructors\n   *     have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a language-neutral dropdown option & returns a\n   *     validated language-neutral dropdown option, or null to abort the\n   *     change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/dropdown#creation}\n   * for a list of properties this parameter supports.\n   * @throws {TypeError} If `menuGenerator` options are incorrectly structured.\n   */\n  constructor(\n    menuGenerator: MenuGenerator,\n    validator?: FieldDropdownValidator,\n    config?: FieldDropdownConfig,\n  );\n  constructor(menuGenerator: typeof Field.SKIP_SETUP);\n  constructor(\n    menuGenerator: MenuGenerator | typeof Field.SKIP_SETUP,\n    validator?: FieldDropdownValidator,\n    config?: FieldDropdownConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    // If we pass SKIP_SETUP, don't do *anything* with the menu generator.\n    if (menuGenerator === Field.SKIP_SETUP) return;\n\n    if (Array.isArray(menuGenerator)) {\n      this.validateOptions(menuGenerator);\n      const trimmed = this.trimOptions(menuGenerator);\n      this.menuGenerator_ = trimmed.options;\n      this.prefixField = trimmed.prefix || null;\n      this.suffixField = trimmed.suffix || null;\n    } else {\n      this.menuGenerator_ = menuGenerator;\n    }\n\n    /**\n     * The currently selected option. The field is initialized with the\n     * first option selected.\n     */\n    this.selectedOption = this.getOptions(false)[0];\n\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(this.selectedOption[1]);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  override fromXml(fieldElement: Element) {\n    if (this.isOptionListDynamic()) {\n      this.getOptions(false);\n    }\n    this.setValue(fieldElement.textContent);\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   *\n   * @param state The state to apply to the dropdown field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(FieldDropdown, state)) {\n      return;\n    }\n    if (this.isOptionListDynamic()) {\n      this.getOptions(false);\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Create the block UI for this dropdown.\n   */\n  override initView() {\n    if (this.shouldAddBorderRect_()) {\n      this.createBorderRect_();\n    } else {\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\n    }\n    this.createTextElement_();\n\n    this.imageElement = dom.createSvgElement(Svg.IMAGE, {}, this.fieldGroup_);\n\n    if (this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW) {\n      this.createSVGArrow_();\n    } else {\n      this.createTextArrow_();\n    }\n\n    if (this.borderRect_) {\n      dom.addClass(this.borderRect_, 'blocklyDropdownRect');\n    }\n  }\n\n  /**\n   * Whether or not the dropdown should add a border rect.\n   *\n   * @returns True if the dropdown field should add a border rect.\n   */\n  protected shouldAddBorderRect_(): boolean {\n    return (\n      !this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW ||\n      (this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW &&\n        !this.getSourceBlock()?.isShadow())\n    );\n  }\n\n  /** Create a tspan based arrow. */\n  protected createTextArrow_() {\n    this.arrow = dom.createSvgElement(Svg.TSPAN, {}, this.textElement_);\n    this.arrow!.appendChild(\n      document.createTextNode(\n        this.getSourceBlock()?.RTL\n          ? FieldDropdown.ARROW_CHAR + ' '\n          : ' ' + FieldDropdown.ARROW_CHAR,\n      ),\n    );\n    if (this.getConstants()!.FIELD_TEXT_BASELINE_CENTER) {\n      this.arrow.setAttribute('dominant-baseline', 'central');\n    }\n    if (this.getSourceBlock()?.RTL) {\n      this.getTextElement().insertBefore(this.arrow, this.textContent_);\n    } else {\n      this.getTextElement().appendChild(this.arrow);\n    }\n  }\n\n  /** Create an SVG based arrow. */\n  protected createSVGArrow_() {\n    this.svgArrow = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'height': this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE + 'px',\n        'width': this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE + 'px',\n      },\n      this.fieldGroup_,\n    );\n    this.svgArrow!.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_DATAURI,\n    );\n  }\n\n  /**\n   * Create a dropdown menu under the text.\n   *\n   * @param e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   */\n  protected override showEditor_(e?: MouseEvent) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.dropdownCreate();\n    if (e && typeof e.clientX === 'number') {\n      this.menu_!.openingCoords = new Coordinate(e.clientX, e.clientY);\n    } else {\n      this.menu_!.openingCoords = null;\n    }\n\n    // Remove any pre-existing elements in the dropdown.\n    dropDownDiv.clearContent();\n    // Element gets created in render.\n    const menuElement = this.menu_!.render(dropDownDiv.getContentDiv());\n    dom.addClass(menuElement, 'blocklyDropdownMenu');\n\n    if (this.getConstants()!.FIELD_DROPDOWN_COLOURED_DIV) {\n      const primaryColour = block.getColour();\n      const borderColour = (this.sourceBlock_ as BlockSvg).getColourTertiary();\n      dropDownDiv.setColour(primaryColour, borderColour);\n    }\n\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose_.bind(this));\n\n    // Focusing needs to be handled after the menu is rendered and positioned.\n    // Otherwise it will cause a page scroll to get the misplaced menu in\n    // view. See issue #1329.\n    this.menu_!.focus();\n\n    if (this.selectedMenuItem) {\n      this.menu_!.setHighlighted(this.selectedMenuItem);\n      style.scrollIntoContainerView(\n        this.selectedMenuItem.getElement()!,\n        dropDownDiv.getContentDiv(),\n        true,\n      );\n    }\n\n    this.applyColour();\n  }\n\n  /** Create the dropdown editor. */\n  private dropdownCreate() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const menu = new Menu();\n    menu.setRole(aria.Role.LISTBOX);\n    this.menu_ = menu;\n\n    const options = this.getOptions(false);\n    this.selectedMenuItem = null;\n    for (let i = 0; i < options.length; i++) {\n      const [label, value] = options[i];\n      const content = (() => {\n        if (typeof label === 'object') {\n          // Convert ImageProperties to an HTMLImageElement.\n          const image = new Image(label['width'], label['height']);\n          image.src = label['src'];\n          image.alt = label['alt'] || '';\n          return image;\n        }\n        return label;\n      })();\n      const menuItem = new MenuItem(content, value);\n      menuItem.setRole(aria.Role.OPTION);\n      menuItem.setRightToLeft(block.RTL);\n      menuItem.setCheckable(true);\n      menu.addChild(menuItem);\n      menuItem.setChecked(value === this.value_);\n      if (value === this.value_) {\n        this.selectedMenuItem = menuItem;\n      }\n      menuItem.onAction(this.handleMenuActionEvent, this);\n    }\n  }\n\n  /**\n   * Disposes of events and DOM-references belonging to the dropdown editor.\n   */\n  protected dropdownDispose_() {\n    if (this.menu_) {\n      this.menu_.dispose();\n    }\n    this.menu_ = null;\n    this.selectedMenuItem = null;\n    this.applyColour();\n  }\n\n  /**\n   * Handle an action in the dropdown menu.\n   *\n   * @param menuItem The MenuItem selected within menu.\n   */\n  private handleMenuActionEvent(menuItem: MenuItem) {\n    dropDownDiv.hideIfOwner(this, true);\n    this.onItemSelected_(this.menu_ as Menu, menuItem);\n  }\n\n  /**\n   * Handle the selection of an item in the dropdown menu.\n   *\n   * @param menu The Menu component clicked.\n   * @param menuItem The MenuItem selected within menu.\n   */\n  protected onItemSelected_(menu: Menu, menuItem: MenuItem) {\n    this.setValue(menuItem.getValue());\n  }\n\n  /**\n   * @returns True if the option list is generated by a function.\n   *     Otherwise false.\n   */\n  isOptionListDynamic(): boolean {\n    return typeof this.menuGenerator_ === 'function';\n  }\n\n  /**\n   * Return a list of the options for this dropdown.\n   *\n   * @param useCache For dynamic options, whether or not to use the cached\n   *     options or to re-generate them.\n   * @returns A non-empty array of option tuples:\n   *     (human-readable text or image, language-neutral name).\n   * @throws {TypeError} If generated options are incorrectly structured.\n   */\n  getOptions(useCache?: boolean): MenuOption[] {\n    if (!this.menuGenerator_) {\n      // A subclass improperly skipped setup without defining the menu\n      // generator.\n      throw TypeError('A menu generator was never defined.');\n    }\n    if (Array.isArray(this.menuGenerator_)) return this.menuGenerator_;\n    if (useCache && this.generatedOptions) return this.generatedOptions;\n\n    this.generatedOptions = this.menuGenerator_();\n    this.validateOptions(this.generatedOptions);\n    return this.generatedOptions;\n  }\n\n  /**\n   * Ensure that the input value is a valid language-neutral option.\n   *\n   * @param newValue The input value.\n   * @returns A valid language-neutral option, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue: string,\n  ): string | null | undefined;\n  protected override doClassValidation_(newValue?: string): string | null;\n  protected override doClassValidation_(\n    newValue?: string,\n  ): string | null | undefined {\n    const options = this.getOptions(true);\n    const isValueValid = options.some((option) => option[1] === newValue);\n\n    if (!isValueValid) {\n      if (this.sourceBlock_) {\n        console.warn(\n          \"Cannot set the dropdown's value to an unavailable option.\" +\n            ' Block type: ' +\n            this.sourceBlock_.type +\n            ', Field name: ' +\n            this.name +\n            ', Value: ' +\n            newValue,\n        );\n      }\n      return null;\n    }\n    return newValue;\n  }\n\n  /**\n   * Update the value of this dropdown field.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is one of the valid dropdown options.\n   */\n  protected override doValueUpdate_(newValue: string) {\n    super.doValueUpdate_(newValue);\n    const options = this.getOptions(true);\n    for (let i = 0, option; (option = options[i]); i++) {\n      if (option[1] === this.value_) {\n        this.selectedOption = option;\n      }\n    }\n  }\n\n  /**\n   * Updates the dropdown arrow to match the colour/style of the block.\n   */\n  override applyColour() {\n    const sourceBlock = this.sourceBlock_ as BlockSvg;\n    if (this.borderRect_) {\n      this.borderRect_.setAttribute('stroke', sourceBlock.getColourTertiary());\n      if (this.menu_) {\n        this.borderRect_.setAttribute('fill', sourceBlock.getColourTertiary());\n      } else {\n        this.borderRect_.setAttribute('fill', 'transparent');\n      }\n    }\n    // Update arrow's colour.\n    if (sourceBlock && this.arrow) {\n      if (sourceBlock.isShadow()) {\n        this.arrow.style.fill = sourceBlock.getColourSecondary();\n      } else {\n        this.arrow.style.fill = sourceBlock.getColour();\n      }\n    }\n  }\n\n  /** Draws the border with the correct width. */\n  protected override render_() {\n    // Hide both elements.\n    this.getTextContent().nodeValue = '';\n    this.imageElement!.style.display = 'none';\n\n    // Show correct element.\n    const option = this.selectedOption && this.selectedOption[0];\n    if (option && typeof option === 'object') {\n      this.renderSelectedImage(option);\n    } else {\n      this.renderSelectedText();\n    }\n\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Renders the selected option, which must be an image.\n   *\n   * @param imageJson Selected option that must be an image.\n   */\n  private renderSelectedImage(imageJson: ImageProperties) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.imageElement!.style.display = '';\n    this.imageElement!.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      imageJson.src,\n    );\n    this.imageElement!.setAttribute('height', String(imageJson.height));\n    this.imageElement!.setAttribute('width', String(imageJson.width));\n\n    const imageHeight = Number(imageJson.height);\n    const imageWidth = Number(imageJson.width);\n\n    // Height and width include the border rect.\n    const hasBorder = !!this.borderRect_;\n    const height = Math.max(\n      hasBorder ? this.getConstants()!.FIELD_DROPDOWN_BORDER_RECT_HEIGHT : 0,\n      imageHeight + FieldDropdown.IMAGE_Y_PADDING,\n    );\n    const xPadding = hasBorder\n      ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\n      : 0;\n    let arrowWidth = 0;\n    if (this.svgArrow) {\n      arrowWidth = this.positionSVGArrow(\n        imageWidth + xPadding,\n        height / 2 - this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE / 2,\n      );\n    } else {\n      arrowWidth = dom.getFastTextWidth(\n        this.arrow as SVGTSpanElement,\n        this.getConstants()!.FIELD_TEXT_FONTSIZE,\n        this.getConstants()!.FIELD_TEXT_FONTWEIGHT,\n        this.getConstants()!.FIELD_TEXT_FONTFAMILY,\n      );\n    }\n    this.size_.width = imageWidth + arrowWidth + xPadding * 2;\n    this.size_.height = height;\n\n    let arrowX = 0;\n    if (block.RTL) {\n      const imageX = xPadding + arrowWidth;\n      this.imageElement!.setAttribute('x', `${imageX}`);\n    } else {\n      arrowX = imageWidth + arrowWidth;\n      this.getTextElement().setAttribute('text-anchor', 'end');\n      this.imageElement!.setAttribute('x', `${xPadding}`);\n    }\n    this.imageElement!.setAttribute('y', String(height / 2 - imageHeight / 2));\n\n    this.positionTextElement_(arrowX + xPadding, imageWidth + arrowWidth);\n  }\n\n  /** Renders the selected option, which must be text. */\n  private renderSelectedText() {\n    // Retrieves the selected option to display through getText_.\n    this.getTextContent().nodeValue = this.getDisplayText_();\n    const textElement = this.getTextElement();\n    dom.addClass(textElement, 'blocklyDropdownText');\n    textElement.setAttribute('text-anchor', 'start');\n\n    // Height and width include the border rect.\n    const hasBorder = !!this.borderRect_;\n    const height = Math.max(\n      hasBorder ? this.getConstants()!.FIELD_DROPDOWN_BORDER_RECT_HEIGHT : 0,\n      this.getConstants()!.FIELD_TEXT_HEIGHT,\n    );\n    const textWidth = dom.getFastTextWidth(\n      this.getTextElement(),\n      this.getConstants()!.FIELD_TEXT_FONTSIZE,\n      this.getConstants()!.FIELD_TEXT_FONTWEIGHT,\n      this.getConstants()!.FIELD_TEXT_FONTFAMILY,\n    );\n    const xPadding = hasBorder\n      ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\n      : 0;\n    let arrowWidth = 0;\n    if (this.svgArrow) {\n      arrowWidth = this.positionSVGArrow(\n        textWidth + xPadding,\n        height / 2 - this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE / 2,\n      );\n    }\n    this.size_.width = textWidth + arrowWidth + xPadding * 2;\n    this.size_.height = height;\n\n    this.positionTextElement_(xPadding, textWidth);\n  }\n\n  /**\n   * Position a drop-down arrow at the appropriate location at render-time.\n   *\n   * @param x X position the arrow is being rendered at, in px.\n   * @param y Y position the arrow is being rendered at, in px.\n   * @returns Amount of space the arrow is taking up, in px.\n   */\n  private positionSVGArrow(x: number, y: number): number {\n    if (!this.svgArrow) {\n      return 0;\n    }\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const hasBorder = !!this.borderRect_;\n    const xPadding = hasBorder\n      ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING\n      : 0;\n    const textPadding = this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_PADDING;\n    const svgArrowSize = this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE;\n    const arrowX = block.RTL ? xPadding : x + textPadding;\n    this.svgArrow.setAttribute(\n      'transform',\n      'translate(' + arrowX + ',' + y + ')',\n    );\n    return svgArrowSize + textPadding;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation.  Get the selected option text.  If the selected option is\n   * an image we return the image alt text.\n   *\n   * @returns Selected option text.\n   */\n  protected override getText_(): string | null {\n    if (!this.selectedOption) {\n      return null;\n    }\n    const option = this.selectedOption[0];\n    if (typeof option === 'object') {\n      return option['alt'];\n    }\n    return option;\n  }\n\n  /**\n   * Construct a FieldDropdown from a JSON arg object.\n   *\n   * @param options A JSON object with options (options).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldDropdownFromJsonConfig,\n  ): FieldDropdown {\n    if (!options.options) {\n      throw new Error(\n        'options are required for the dropdown field. The ' +\n          'options property must be assigned an array of ' +\n          '[humanReadableValue, languageNeutralValue] tuples.',\n      );\n    }\n    // `this` might be a subclass of FieldDropdown if that class doesn't\n    // override the static fromJson method.\n    return new this(options.options, undefined, options);\n  }\n\n  /**\n   * Factor out common words in statically defined options.\n   * Create prefix and/or suffix labels.\n   */\n  protected trimOptions(options: MenuOption[]): {\n    options: MenuOption[];\n    prefix?: string;\n    suffix?: string;\n  } {\n    let hasImages = false;\n    const trimmedOptions = options.map(([label, value]): MenuOption => {\n      if (typeof label === 'string') {\n        return [parsing.replaceMessageReferences(label), value];\n      }\n\n      hasImages = true;\n      // Copy the image properties so they're not influenced by the original.\n      // NOTE: No need to deep copy since image properties are only 1 level deep.\n      const imageLabel =\n        label.alt !== null\n          ? {...label, alt: parsing.replaceMessageReferences(label.alt)}\n          : {...label};\n      return [imageLabel, value];\n    });\n\n    if (hasImages || options.length < 2) return {options: trimmedOptions};\n\n    const stringOptions = trimmedOptions as [string, string][];\n    const stringLabels = stringOptions.map(([label]) => label);\n\n    const shortest = utilsString.shortestStringLength(stringLabels);\n    const prefixLength = utilsString.commonWordPrefix(stringLabels, shortest);\n    const suffixLength = utilsString.commonWordSuffix(stringLabels, shortest);\n\n    if (\n      (!prefixLength && !suffixLength) ||\n      shortest <= prefixLength + suffixLength\n    ) {\n      // One or more strings will entirely vanish if we proceed.  Abort.\n      return {options: stringOptions};\n    }\n\n    const prefix = prefixLength\n      ? stringLabels[0].substring(0, prefixLength - 1)\n      : undefined;\n    const suffix = suffixLength\n      ? stringLabels[0].substr(1 - suffixLength)\n      : undefined;\n    return {\n      options: this.applyTrim(stringOptions, prefixLength, suffixLength),\n      prefix,\n      suffix,\n    };\n  }\n\n  /**\n   * Use the calculated prefix and suffix lengths to trim all of the options in\n   * the given array.\n   *\n   * @param options Array of option tuples:\n   *     (human-readable text or image, language-neutral name).\n   * @param prefixLength The length of the common prefix.\n   * @param suffixLength The length of the common suffix\n   * @returns A new array with all of the option text trimmed.\n   */\n  private applyTrim(\n    options: [string, string][],\n    prefixLength: number,\n    suffixLength: number,\n  ): MenuOption[] {\n    return options.map(([text, value]) => [\n      text.substring(prefixLength, text.length - suffixLength),\n      value,\n    ]);\n  }\n\n  /**\n   * Validates the data structure to be processed as an options list.\n   *\n   * @param options The proposed dropdown options.\n   * @throws {TypeError} If proposed options are incorrectly structured.\n   */\n  protected validateOptions(options: MenuOption[]) {\n    if (!Array.isArray(options)) {\n      throw TypeError('FieldDropdown options must be an array.');\n    }\n    if (!options.length) {\n      throw TypeError('FieldDropdown options must not be an empty array.');\n    }\n    let foundError = false;\n    for (let i = 0; i < options.length; i++) {\n      const tuple = options[i];\n      if (!Array.isArray(tuple)) {\n        foundError = true;\n        console.error(\n          `Invalid option[${i}]: Each FieldDropdown option must be an array.\n          Found: ${tuple}`,\n        );\n      } else if (typeof tuple[1] !== 'string') {\n        foundError = true;\n        console.error(\n          `Invalid option[${i}]: Each FieldDropdown option id must be a string. \n          Found ${tuple[1]} in: ${tuple}`,\n        );\n      } else if (\n        tuple[0] &&\n        typeof tuple[0] !== 'string' &&\n        typeof tuple[0].src !== 'string'\n      ) {\n        foundError = true;\n        console.error(\n          `Invalid option[${i}]: Each FieldDropdown option must have a string \n          label or image description. Found ${tuple[0]} in: ${tuple}`,\n        );\n      }\n    }\n    if (foundError) {\n      throw TypeError('Found invalid FieldDropdown options.');\n    }\n  }\n}\n\n/**\n * Definition of a human-readable image dropdown option.\n */\nexport interface ImageProperties {\n  src: string;\n  alt: string;\n  width: number;\n  height: number;\n}\n\n/**\n * An individual option in the dropdown menu. The first element is the human-\n * readable value (text or image), and the second element is the language-\n * neutral value.\n */\nexport type MenuOption = [string | ImageProperties, string];\n\n/**\n * A function that generates an array of menu options for FieldDropdown\n * or its descendants.\n */\nexport type MenuGeneratorFunction = (this: FieldDropdown) => MenuOption[];\n\n/**\n * Either an array of menu options or a function that generates an array of\n * menu options for FieldDropdown or its descendants.\n */\nexport type MenuGenerator = MenuOption[] | MenuGeneratorFunction;\n\n/**\n * Config options for the dropdown field.\n */\nexport type FieldDropdownConfig = FieldConfig;\n\n/**\n * fromJson config for the dropdown field.\n */\nexport interface FieldDropdownFromJsonConfig extends FieldDropdownConfig {\n  options?: MenuOption[];\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldDropdownValidator = FieldValidator<string>;\n\nfieldRegistry.register('field_dropdown', FieldDropdown);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IBubble, WorkspaceSvg} from '../blockly.js';\nimport * as eventUtils from '../events/utils.js';\nimport {IDragStrategy} from '../interfaces/i_draggable.js';\nimport * as layers from '../layers.js';\nimport {Coordinate} from '../utils.js';\n\nexport class BubbleDragStrategy implements IDragStrategy {\n  private startLoc: Coordinate | null = null;\n\n  /** Was there already an event group in progress when the drag started? */\n  private inGroup: boolean = false;\n\n  constructor(\n    private bubble: IBubble,\n    private workspace: WorkspaceSvg,\n  ) {}\n\n  isMovable(): boolean {\n    return true;\n  }\n\n  startDrag(): void {\n    this.inGroup = !!eventUtils.getGroup();\n    if (!this.inGroup) {\n      eventUtils.setGroup(true);\n    }\n    this.startLoc = this.bubble.getRelativeToSurfaceXY();\n    this.workspace.setResizesEnabled(false);\n    this.workspace.getLayerManager()?.moveToDragLayer(this.bubble);\n    if (this.bubble.setDragging) {\n      this.bubble.setDragging(true);\n    }\n  }\n\n  drag(newLoc: Coordinate): void {\n    this.bubble.moveDuringDrag(newLoc);\n  }\n\n  endDrag(): void {\n    this.workspace.setResizesEnabled(true);\n    if (!this.inGroup) {\n      eventUtils.setGroup(false);\n    }\n\n    this.workspace\n      .getLayerManager()\n      ?.moveOffDragLayer(this.bubble, layers.BUBBLE);\n    this.bubble.setDragging(false);\n  }\n\n  revertDrag(): void {\n    if (this.startLoc) this.bubble.moveDuringDrag(this.startLoc);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {ISelectable} from '../blockly.js';\nimport * as browserEvents from '../browser_events.js';\nimport * as common from '../common.js';\nimport {BubbleDragStrategy} from '../dragging/bubble_drag_strategy.js';\nimport {IBubble} from '../interfaces/i_bubble.js';\nimport {ContainerRegion} from '../metrics_manager.js';\nimport {Scrollbar} from '../scrollbar.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport * as math from '../utils/math.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * The abstract pop-up bubble class. This creates a UI that looks like a speech\n * bubble, where it has a \"tail\" that points to the block, and a \"head\" that\n * displays arbitrary svg elements.\n */\nexport abstract class Bubble implements IBubble, ISelectable {\n  /** The width of the border around the bubble. */\n  static readonly BORDER_WIDTH = 6;\n\n  /** Double the width of the border around the bubble. */\n  static readonly DOUBLE_BORDER = this.BORDER_WIDTH * 2;\n\n  /** The minimum size the bubble can have. */\n  static readonly MIN_SIZE = this.DOUBLE_BORDER;\n\n  /**\n   * The thickness of the base of the tail in relation to the size of the\n   * bubble. Higher numbers result in thinner tails.\n   */\n  static readonly TAIL_THICKNESS = 1;\n\n  /** The number of degrees that the tail bends counter-clockwise. */\n  static readonly TAIL_ANGLE = 20;\n\n  /**\n   * The sharpness of the tail's bend. Higher numbers result in smoother\n   * tails.\n   */\n  static readonly TAIL_BEND = 4;\n\n  /** Distance between arrow point and anchor point. */\n  static readonly ANCHOR_RADIUS = 8;\n\n  public id: string;\n\n  /** The SVG group containing all parts of the bubble. */\n  protected svgRoot: SVGGElement;\n\n  /** The SVG path for the arrow from the anchor to the bubble. */\n  private tail: SVGPathElement;\n\n  /** The SVG background rect for the main body of the bubble. */\n  private background: SVGRectElement;\n\n  /** The SVG group containing the contents of the bubble. */\n  protected contentContainer: SVGGElement;\n\n  /**\n   * The size of the bubble (including background and contents but not tail).\n   */\n  private size = new Size(0, 0);\n\n  /** The colour of the background of the bubble. */\n  private colour = '#ffffff';\n\n  /** True if the bubble has been disposed, false otherwise. */\n  public disposed = false;\n\n  /** The position of the top of the bubble relative to its anchor. */\n  private relativeTop = 0;\n\n  /** The position of the left of the bubble realtive to its anchor. */\n  private relativeLeft = 0;\n\n  private dragStrategy = new BubbleDragStrategy(this, this.workspace);\n\n  /**\n   * @param workspace The workspace this bubble belongs to.\n   * @param anchor The anchor location of the thing this bubble is attached to.\n   *     The tail of the bubble will point to this location.\n   * @param ownerRect An optional rect we don't want the bubble to overlap with\n   *     when automatically positioning.\n   */\n  constructor(\n    public readonly workspace: WorkspaceSvg,\n    protected anchor: Coordinate,\n    protected ownerRect?: Rect,\n  ) {\n    this.id = idGenerator.getNextUniqueId();\n    this.svgRoot = dom.createSvgElement(\n      Svg.G,\n      {'class': 'blocklyBubble'},\n      workspace.getBubbleCanvas(),\n    );\n    const embossGroup = dom.createSvgElement(\n      Svg.G,\n      {\n        'filter': `url(#${\n          this.workspace.getRenderer().getConstants().embossFilterId\n        })`,\n      },\n      this.svgRoot,\n    );\n    this.tail = dom.createSvgElement(\n      Svg.PATH,\n      {'class': 'blocklyBubbleTail'},\n      embossGroup,\n    );\n    this.background = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyDraggable',\n        'x': 0,\n        'y': 0,\n        'rx': Bubble.BORDER_WIDTH,\n        'ry': Bubble.BORDER_WIDTH,\n      },\n      embossGroup,\n    );\n    this.contentContainer = dom.createSvgElement(Svg.G, {}, this.svgRoot);\n\n    browserEvents.conditionalBind(\n      this.background,\n      'pointerdown',\n      this,\n      this.onMouseDown,\n    );\n  }\n\n  /** Dispose of this bubble. */\n  dispose() {\n    dom.removeNode(this.svgRoot);\n    this.disposed = true;\n  }\n\n  /**\n   * Set the location the tail of this bubble points to.\n   *\n   * @param anchor The location the tail of this bubble points to.\n   * @param relayout If true, reposition the bubble from scratch so that it is\n   *     optimally visible. If false, reposition it so it maintains the same\n   *     position relative to the anchor.\n   */\n  setAnchorLocation(anchor: Coordinate, relayout = false) {\n    this.anchor = anchor;\n    if (relayout) {\n      this.positionByRect(this.ownerRect);\n    } else {\n      this.positionRelativeToAnchor();\n    }\n    this.renderTail();\n  }\n\n  /** Sets the position of this bubble relative to its anchor. */\n  setPositionRelativeToAnchor(left: number, top: number) {\n    this.relativeLeft = left;\n    this.relativeTop = top;\n    this.positionRelativeToAnchor();\n    this.renderTail();\n  }\n\n  /** @returns the size of this bubble. */\n  protected getSize() {\n    return this.size;\n  }\n\n  /**\n   * Sets the size of this bubble, including the border.\n   *\n   * @param size Sets the size of this bubble, including the border.\n   * @param relayout If true, reposition the bubble from scratch so that it is\n   *     optimally visible. If false, reposition it so it maintains the same\n   *     position relative to the anchor.\n   */\n  protected setSize(size: Size, relayout = false) {\n    size.width = Math.max(size.width, Bubble.MIN_SIZE);\n    size.height = Math.max(size.height, Bubble.MIN_SIZE);\n    this.size = size;\n\n    this.background.setAttribute('width', `${size.width}`);\n    this.background.setAttribute('height', `${size.height}`);\n\n    if (relayout) {\n      this.positionByRect(this.ownerRect);\n    } else {\n      this.positionRelativeToAnchor();\n    }\n    this.renderTail();\n  }\n\n  /** Returns the colour of the background and tail of this bubble. */\n  protected getColour(): string {\n    return this.colour;\n  }\n\n  /** Sets the colour of the background and tail of this bubble. */\n  public setColour(colour: string) {\n    this.colour = colour;\n    this.tail.setAttribute('fill', colour);\n    this.background.setAttribute('fill', colour);\n  }\n\n  /** Brings the bubble to the front and passes the pointer event off to the gesture system. */\n  private onMouseDown(e: PointerEvent) {\n    this.workspace.getGesture(e)?.handleBubbleStart(e, this);\n    this.bringToFront();\n    common.setSelected(this);\n  }\n\n  /** Positions the bubble relative to its anchor. Does not render its tail. */\n  protected positionRelativeToAnchor() {\n    let left = this.anchor.x;\n    if (this.workspace.RTL) {\n      left -= this.relativeLeft + this.size.width;\n    } else {\n      left += this.relativeLeft;\n    }\n    const top = this.relativeTop + this.anchor.y;\n    this.moveTo(left, top);\n  }\n\n  /**\n   * Moves the bubble to the given coordinates.\n   *\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.svgRoot.setAttribute('transform', `translate(${x}, ${y})`);\n  }\n\n  /**\n   * Positions the bubble \"optimally\" so that the most of it is visible and\n   * it does not overlap the rect (if provided).\n   */\n  protected positionByRect(rect = new Rect(0, 0, 0, 0)) {\n    const viewMetrics = this.workspace.getMetricsManager().getViewMetrics(true);\n\n    const optimalLeft = this.getOptimalRelativeLeft(viewMetrics);\n    const optimalTop = this.getOptimalRelativeTop(viewMetrics);\n\n    const topPosition = {\n      x: optimalLeft,\n      y: (-this.size.height -\n        this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT) as number,\n    };\n    const startPosition = {x: -this.size.width - 30, y: optimalTop};\n    const endPosition = {x: rect.getWidth(), y: optimalTop};\n    const bottomPosition = {x: optimalLeft, y: rect.getHeight()};\n\n    const closerPosition =\n      rect.getWidth() < rect.getHeight() ? endPosition : bottomPosition;\n    const fartherPosition =\n      rect.getWidth() < rect.getHeight() ? bottomPosition : endPosition;\n\n    const topPositionOverlap = this.getOverlap(topPosition, viewMetrics);\n    const startPositionOverlap = this.getOverlap(startPosition, viewMetrics);\n    const closerPositionOverlap = this.getOverlap(closerPosition, viewMetrics);\n    const fartherPositionOverlap = this.getOverlap(\n      fartherPosition,\n      viewMetrics,\n    );\n\n    // Set the position to whichever position shows the most of the bubble,\n    // with tiebreaks going in the order: top > start > close > far.\n    const mostOverlap = Math.max(\n      topPositionOverlap,\n      startPositionOverlap,\n      closerPositionOverlap,\n      fartherPositionOverlap,\n    );\n    if (topPositionOverlap === mostOverlap) {\n      this.relativeLeft = topPosition.x;\n      this.relativeTop = topPosition.y;\n      this.positionRelativeToAnchor();\n      return;\n    }\n    if (startPositionOverlap === mostOverlap) {\n      this.relativeLeft = startPosition.x;\n      this.relativeTop = startPosition.y;\n      this.positionRelativeToAnchor();\n      return;\n    }\n    if (closerPositionOverlap === mostOverlap) {\n      this.relativeLeft = closerPosition.x;\n      this.relativeTop = closerPosition.y;\n      this.positionRelativeToAnchor();\n      return;\n    }\n    // TODO: I believe relativeLeft_ should actually be called relativeStart_\n    //  and then the math should be fixed to reflect this. (hopefully it'll\n    //  make it look simpler)\n    this.relativeLeft = fartherPosition.x;\n    this.relativeTop = fartherPosition.y;\n    this.positionRelativeToAnchor();\n  }\n\n  /**\n   * Calculate the what percentage of the bubble overlaps with the visible\n   * workspace (what percentage of the bubble is visible).\n   *\n   * @param relativeMin The position of the top-left corner of the bubble\n   *     relative to the anchor point.\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The percentage of the bubble that is visible.\n   */\n  private getOverlap(\n    relativeMin: {x: number; y: number},\n    viewMetrics: ContainerRegion,\n  ): number {\n    // The position of the top-left corner of the bubble in workspace units.\n    const bubbleMin = {\n      x: this.workspace.RTL\n        ? this.anchor.x - relativeMin.x - this.size.width\n        : relativeMin.x + this.anchor.x,\n      y: relativeMin.y + this.anchor.y,\n    };\n    // The position of the bottom-right corner of the bubble in workspace units.\n    const bubbleMax = {\n      x: bubbleMin.x + this.size.width,\n      y: bubbleMin.y + this.size.height,\n    };\n\n    // We could adjust these values to account for the scrollbars, but the\n    // bubbles should have been adjusted to not collide with them anyway, so\n    // giving the workspace a slightly larger \"bounding box\" shouldn't affect\n    // the calculation.\n\n    // The position of the top-left corner of the workspace.\n    const workspaceMin = {x: viewMetrics.left, y: viewMetrics.top};\n    // The position of the bottom-right corner of the workspace.\n    const workspaceMax = {\n      x: viewMetrics.left + viewMetrics.width,\n      y: viewMetrics.top + viewMetrics.height,\n    };\n\n    const overlapWidth =\n      Math.min(bubbleMax.x, workspaceMax.x) -\n      Math.max(bubbleMin.x, workspaceMin.x);\n    const overlapHeight =\n      Math.min(bubbleMax.y, workspaceMax.y) -\n      Math.max(bubbleMin.y, workspaceMin.y);\n    return Math.max(\n      0,\n      Math.min(\n        1,\n        (overlapWidth * overlapHeight) / (this.size.width * this.size.height),\n      ),\n    );\n  }\n\n  /**\n   * Calculate what the optimal horizontal position of the top-left corner of\n   * the bubble is (relative to the anchor point) so that the most area of the\n   * bubble is shown.\n   *\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The optimal horizontal position of the top-left corner of the\n   *     bubble.\n   */\n  private getOptimalRelativeLeft(viewMetrics: ContainerRegion): number {\n    // By default, show the bubble just a bit to the left of the anchor.\n    let relativeLeft = -this.size.width / 4;\n\n    // No amount of sliding left or right will give us better overlap.\n    if (this.size.width > viewMetrics.width) return relativeLeft;\n\n    const workspaceRect = this.getWorkspaceViewRect(viewMetrics);\n\n    if (this.workspace.RTL) {\n      // Bubble coordinates are flipped in RTL.\n      const bubbleRight = this.anchor.x - relativeLeft;\n      const bubbleLeft = bubbleRight - this.size.width;\n\n      if (bubbleLeft < workspaceRect.left) {\n        // Slide the bubble right until it is onscreen.\n        relativeLeft = -(workspaceRect.left - this.anchor.x + this.size.width);\n      } else if (bubbleRight > workspaceRect.right) {\n        // Slide the bubble left until it is onscreen.\n        relativeLeft = -(workspaceRect.right - this.anchor.x);\n      }\n    } else {\n      const bubbleLeft = relativeLeft + this.anchor.x;\n      const bubbleRight = bubbleLeft + this.size.width;\n\n      if (bubbleLeft < workspaceRect.left) {\n        // Slide the bubble right until it is onscreen.\n        relativeLeft = workspaceRect.left - this.anchor.x;\n      } else if (bubbleRight > workspaceRect.right) {\n        // Slide the bubble left until it is onscreen.\n        relativeLeft = workspaceRect.right - this.anchor.x - this.size.width;\n      }\n    }\n\n    return relativeLeft;\n  }\n\n  /**\n   * Calculate what the optimal vertical position of the top-left corner of\n   * the bubble is (relative to the anchor point) so that the most area of the\n   * bubble is shown.\n   *\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The optimal vertical position of the top-left corner of the\n   *     bubble.\n   */\n  private getOptimalRelativeTop(viewMetrics: ContainerRegion): number {\n    // By default, show the bubble just a bit higher than the anchor.\n    let relativeTop = -this.size.height / 4;\n\n    // No amount of sliding up or down will give us better overlap.\n    if (this.size.height > viewMetrics.height) return relativeTop;\n\n    const top = this.anchor.y + relativeTop;\n    const bottom = top + this.size.height;\n    const workspaceRect = this.getWorkspaceViewRect(viewMetrics);\n\n    if (top < workspaceRect.top) {\n      // Slide the bubble down until it is onscreen.\n      relativeTop = workspaceRect.top - this.anchor.y;\n    } else if (bottom > workspaceRect.bottom) {\n      // Slide the bubble up until it is onscreen.\n      relativeTop = workspaceRect.bottom - this.anchor.y - this.size.height;\n    }\n\n    return relativeTop;\n  }\n\n  /**\n   * @returns a rect defining the bounds of the workspace's view in workspace\n   * coordinates.\n   */\n  private getWorkspaceViewRect(viewMetrics: ContainerRegion): Rect {\n    const top = viewMetrics.top;\n    let bottom = viewMetrics.top + viewMetrics.height;\n    let left = viewMetrics.left;\n    let right = viewMetrics.left + viewMetrics.width;\n\n    bottom -= this.getScrollbarThickness();\n    if (this.workspace.RTL) {\n      left -= this.getScrollbarThickness();\n    } else {\n      right -= this.getScrollbarThickness();\n    }\n\n    return new Rect(top, bottom, left, right);\n  }\n\n  /** @returns the scrollbar thickness in workspace units. */\n  private getScrollbarThickness() {\n    return Scrollbar.scrollbarThickness / this.workspace.scale;\n  }\n\n  /** Draws the tail of the bubble. */\n  private renderTail() {\n    const steps = [];\n    // Find the relative coordinates of the center of the bubble.\n    const relBubbleX = this.size.width / 2;\n    const relBubbleY = this.size.height / 2;\n    // Find the relative coordinates of the center of the anchor.\n    let relAnchorX = -this.relativeLeft;\n    let relAnchorY = -this.relativeTop;\n    if (relBubbleX === relAnchorX && relBubbleY === relAnchorY) {\n      // Null case.  Bubble is directly on top of the anchor.\n      // Short circuit this rather than wade through divide by zeros.\n      steps.push('M ' + relBubbleX + ',' + relBubbleY);\n    } else {\n      // Compute the angle of the tail's line.\n      const rise = relAnchorY - relBubbleY;\n      let run = relAnchorX - relBubbleX;\n      if (this.workspace.RTL) {\n        run *= -1;\n      }\n      const hypotenuse = Math.sqrt(rise * rise + run * run);\n      let angle = Math.acos(run / hypotenuse);\n      if (rise < 0) {\n        angle = 2 * Math.PI - angle;\n      }\n      // Compute a line perpendicular to the tail.\n      let rightAngle = angle + Math.PI / 2;\n      if (rightAngle > Math.PI * 2) {\n        rightAngle -= Math.PI * 2;\n      }\n      const rightRise = Math.sin(rightAngle);\n      const rightRun = Math.cos(rightAngle);\n\n      // Calculate the thickness of the base of the tail.\n      let thickness =\n        (this.size.width + this.size.height) / Bubble.TAIL_THICKNESS;\n      thickness = Math.min(thickness, this.size.width, this.size.height) / 4;\n\n      // Back the tip of the tail off of the anchor.\n      const backoffRatio = 1 - Bubble.ANCHOR_RADIUS / hypotenuse;\n      relAnchorX = relBubbleX + backoffRatio * run;\n      relAnchorY = relBubbleY + backoffRatio * rise;\n\n      // Coordinates for the base of the tail.\n      const baseX1 = relBubbleX + thickness * rightRun;\n      const baseY1 = relBubbleY + thickness * rightRise;\n      const baseX2 = relBubbleX - thickness * rightRun;\n      const baseY2 = relBubbleY - thickness * rightRise;\n\n      // Distortion to curve the tail.\n      const radians = math.toRadians(\n        this.workspace.RTL ? -Bubble.TAIL_ANGLE : Bubble.TAIL_ANGLE,\n      );\n      let swirlAngle = angle + radians;\n      if (swirlAngle > Math.PI * 2) {\n        swirlAngle -= Math.PI * 2;\n      }\n      const swirlRise = (Math.sin(swirlAngle) * hypotenuse) / Bubble.TAIL_BEND;\n      const swirlRun = (Math.cos(swirlAngle) * hypotenuse) / Bubble.TAIL_BEND;\n\n      steps.push('M' + baseX1 + ',' + baseY1);\n      steps.push(\n        'C' +\n          (baseX1 + swirlRun) +\n          ',' +\n          (baseY1 + swirlRise) +\n          ' ' +\n          relAnchorX +\n          ',' +\n          relAnchorY +\n          ' ' +\n          relAnchorX +\n          ',' +\n          relAnchorY,\n      );\n      steps.push(\n        'C' +\n          relAnchorX +\n          ',' +\n          relAnchorY +\n          ' ' +\n          (baseX2 + swirlRun) +\n          ',' +\n          (baseY2 + swirlRise) +\n          ' ' +\n          baseX2 +\n          ',' +\n          baseY2,\n      );\n    }\n    steps.push('z');\n    this.tail?.setAttribute('d', steps.join(' '));\n  }\n  /**\n   * Move this bubble to the front of the visible workspace.\n   *\n   * @returns Whether or not the bubble has been moved.\n   * @internal\n   */\n  bringToFront(): boolean {\n    const svgGroup = this.svgRoot?.parentNode;\n    if (this.svgRoot && svgGroup?.lastChild !== this.svgRoot) {\n      svgGroup?.appendChild(this.svgRoot);\n      return true;\n    }\n    return false;\n  }\n\n  /** @internal */\n  getRelativeToSurfaceXY(): Coordinate {\n    return new Coordinate(\n      this.workspace.RTL\n        ? -this.relativeLeft + this.anchor.x - this.size.width\n        : this.anchor.x + this.relativeLeft,\n      this.anchor.y + this.relativeTop,\n    );\n  }\n\n  /** @internal */\n  getSvgRoot(): SVGElement {\n    return this.svgRoot;\n  }\n\n  /**\n   * Move this bubble during a drag.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(newLoc: Coordinate) {\n    this.moveTo(newLoc.x, newLoc.y);\n    if (this.workspace.RTL) {\n      this.relativeLeft = this.anchor.x - newLoc.x - this.size.width;\n    } else {\n      this.relativeLeft = newLoc.x - this.anchor.x;\n    }\n    this.relativeTop = newLoc.y - this.anchor.y;\n    this.renderTail();\n  }\n\n  setDragging(_start: boolean) {\n    // NOOP in base class.\n  }\n\n  /** @internal */\n  setDeleteStyle(_enable: boolean) {\n    // NOOP in base class.\n  }\n\n  /** @internal */\n  isDeletable(): boolean {\n    return false;\n  }\n\n  /** @internal */\n  showContextMenu(_e: Event) {\n    // NOOP in base class.\n  }\n\n  /** Returns whether this bubble is movable or not. */\n  isMovable(): boolean {\n    return true;\n  }\n\n  /** Starts a drag on the bubble. */\n  startDrag(): void {\n    this.dragStrategy.startDrag();\n  }\n\n  /** Drags the bubble to the given location. */\n  drag(newLoc: Coordinate): void {\n    this.dragStrategy.drag(newLoc);\n  }\n\n  /** Ends the drag on the bubble. */\n  endDrag(): void {\n    this.dragStrategy.endDrag();\n  }\n\n  /** Moves the bubble back to where it was at the start of a drag. */\n  revertDrag(): void {\n    this.dragStrategy.revertDrag();\n  }\n\n  select(): void {\n    // Bubbles don't have any visual for being selected.\n  }\n\n  unselect(): void {\n    // Bubbles don't have any visual for being selected.\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {BlocklyOptions} from '../blockly_options.js';\nimport {Abstract as AbstractEvent} from '../events/events_abstract.js';\nimport {Options} from '../options.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport type {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport {Bubble} from './bubble.js';\n\n/**\n * A bubble that contains a mini-workspace which can hold arbitrary blocks.\n * Used by the mutator icon.\n */\nexport class MiniWorkspaceBubble extends Bubble {\n  /**\n   * The minimum amount of change to the mini workspace view to trigger\n   * resizing the bubble.\n   */\n  private static readonly MINIMUM_VIEW_CHANGE = 10;\n\n  /**\n   * An arbitrary margin of whitespace to put around the blocks in the\n   * workspace.\n   */\n  private static readonly MARGIN = Bubble.DOUBLE_BORDER * 3;\n\n  /** The root svg element containing the workspace. */\n  private svgDialog: SVGElement;\n\n  /** The workspace that gets shown within this bubble. */\n  private miniWorkspace: WorkspaceSvg;\n\n  /**\n   * Should this bubble automatically reposition itself when it resizes?\n   * Becomes false after this bubble is first dragged.\n   */\n  private autoLayout = true;\n\n  /** @internal */\n  constructor(\n    workspaceOptions: BlocklyOptions,\n    public readonly workspace: WorkspaceSvg,\n    protected anchor: Coordinate,\n    protected ownerRect?: Rect,\n  ) {\n    super(workspace, anchor, ownerRect);\n    const options = new Options(workspaceOptions);\n    this.validateWorkspaceOptions(options);\n\n    this.svgDialog = dom.createSvgElement(\n      Svg.SVG,\n      {\n        'x': Bubble.BORDER_WIDTH,\n        'y': Bubble.BORDER_WIDTH,\n      },\n      this.contentContainer,\n    );\n    workspaceOptions.parentWorkspace = this.workspace;\n    this.miniWorkspace = this.newWorkspaceSvg(new Options(workspaceOptions));\n    // TODO (#7422): Change this to `internalIsMiniWorkspace` or something. Not\n    //   all mini workspaces are necessarily mutators.\n    this.miniWorkspace.internalIsMutator = true;\n    const background = this.miniWorkspace.createDom('blocklyMutatorBackground');\n    this.svgDialog.appendChild(background);\n    if (options.languageTree) {\n      background.insertBefore(\n        this.miniWorkspace.addFlyout(Svg.G),\n        this.miniWorkspace.getCanvas(),\n      );\n      const flyout = this.miniWorkspace.getFlyout();\n      flyout?.init(this.miniWorkspace);\n      flyout?.show(options.languageTree);\n    }\n\n    this.miniWorkspace.addChangeListener(this.onWorkspaceChange.bind(this));\n    this.miniWorkspace\n      .getFlyout()\n      ?.getWorkspace()\n      ?.addChangeListener(this.onWorkspaceChange.bind(this));\n    this.updateBubbleSize();\n  }\n\n  dispose() {\n    this.miniWorkspace.dispose();\n    super.dispose();\n  }\n\n  /** @internal */\n  getWorkspace(): WorkspaceSvg {\n    return this.miniWorkspace;\n  }\n\n  /** Adds a change listener to the mini workspace. */\n  addWorkspaceChangeListener(listener: (e: AbstractEvent) => void) {\n    this.miniWorkspace.addChangeListener(listener);\n  }\n\n  /**\n   * Validates the workspace options to make sure folks aren't trying to\n   * enable things the miniworkspace doesn't support.\n   */\n  private validateWorkspaceOptions(options: Options) {\n    if (options.hasCategories) {\n      throw new Error(\n        'The miniworkspace bubble does not support toolboxes with categories',\n      );\n    }\n    if (options.hasTrashcan) {\n      throw new Error('The miniworkspace bubble does not support trashcans');\n    }\n    if (\n      options.zoomOptions.controls ||\n      options.zoomOptions.wheel ||\n      options.zoomOptions.pinch\n    ) {\n      throw new Error('The miniworkspace bubble does not support zooming');\n    }\n    if (\n      options.moveOptions.scrollbars ||\n      options.moveOptions.wheel ||\n      options.moveOptions.drag\n    ) {\n      throw new Error(\n        'The miniworkspace bubble does not scrolling/moving the workspace',\n      );\n    }\n    if (options.horizontalLayout) {\n      throw new Error(\n        'The miniworkspace bubble does not support horizontal layouts',\n      );\n    }\n  }\n\n  private onWorkspaceChange() {\n    this.bumpBlocksIntoBounds();\n    this.updateBubbleSize();\n  }\n\n  /**\n   * Bumps blocks that are above the top or outside the start-side of the\n   * workspace back within the workspace.\n   *\n   * Blocks that are below the bottom or outside the end-side of the workspace\n   * are dealt with by resizing the workspace to show them.\n   */\n  private bumpBlocksIntoBounds() {\n    if (this.miniWorkspace.isDragging()) return;\n\n    const MARGIN = 20;\n\n    for (const block of this.miniWorkspace.getTopBlocks(false)) {\n      const blockXY = block.getRelativeToSurfaceXY();\n\n      // Bump any block that's above the top back inside.\n      if (blockXY.y < MARGIN) {\n        block.moveBy(0, MARGIN - blockXY.y);\n      }\n      // Bump any block overlapping the flyout back inside.\n      if (block.RTL) {\n        let right = -MARGIN;\n        const flyout = this.miniWorkspace.getFlyout();\n        if (flyout) {\n          right -= flyout.getWidth();\n        }\n        if (blockXY.x > right) {\n          block.moveBy(right - blockXY.x, 0);\n        }\n      } else if (blockXY.x < MARGIN) {\n        block.moveBy(MARGIN - blockXY.x, 0);\n      }\n    }\n  }\n\n  /**\n   * Updates the size of this bubble to account for the size of the\n   * mini workspace.\n   */\n  private updateBubbleSize() {\n    if (this.miniWorkspace.isDragging()) return;\n\n    const currSize = this.getSize();\n    const newSize = this.calculateWorkspaceSize();\n    if (\n      Math.abs(currSize.width - newSize.width) <\n        MiniWorkspaceBubble.MINIMUM_VIEW_CHANGE &&\n      Math.abs(currSize.height - newSize.height) <\n        MiniWorkspaceBubble.MINIMUM_VIEW_CHANGE\n    ) {\n      // Only resize if the size has noticeably changed.\n      return;\n    }\n    this.svgDialog.setAttribute('width', `${newSize.width}px`);\n    this.svgDialog.setAttribute('height', `${newSize.height}px`);\n    this.miniWorkspace.setCachedParentSvgSize(newSize.width, newSize.height);\n    if (this.miniWorkspace.RTL) {\n      // Scroll the workspace to always left-align.\n      this.miniWorkspace\n        .getCanvas()\n        .setAttribute('transform', `translate(${newSize.width}, 0)`);\n    }\n    this.setSize(\n      new Size(\n        newSize.width + Bubble.DOUBLE_BORDER,\n        newSize.height + Bubble.DOUBLE_BORDER,\n      ),\n      this.autoLayout,\n    );\n    this.miniWorkspace.resize();\n    this.miniWorkspace.recordDragTargets();\n  }\n\n  /**\n   * Calculates the size of the mini workspace for use in resizing the bubble.\n   */\n  private calculateWorkspaceSize(): Size {\n    const workspaceSize = this.miniWorkspace.getCanvas().getBBox();\n    let width = workspaceSize.width + MiniWorkspaceBubble.MARGIN;\n    let height = workspaceSize.height + MiniWorkspaceBubble.MARGIN;\n\n    const flyout = this.miniWorkspace.getFlyout();\n    if (flyout) {\n      const flyoutScrollMetrics = flyout\n        .getWorkspace()\n        .getMetricsManager()\n        .getScrollMetrics();\n      height = Math.max(height, flyoutScrollMetrics.height + 20);\n      width += flyout.getWidth();\n    }\n    return new Size(width, height);\n  }\n\n  /** Reapplies styles to all of the blocks in the mini workspace. */\n  updateBlockStyles() {\n    for (const block of this.miniWorkspace.getAllBlocks(false)) {\n      block.setStyle(block.getStyleName());\n    }\n\n    const flyoutWs = this.miniWorkspace.getFlyout()?.getWorkspace();\n    if (flyoutWs) {\n      for (const block of flyoutWs.getAllBlocks(false)) {\n        block.setStyle(block.getStyleName());\n      }\n    }\n  }\n\n  /**\n   * Move this bubble during a drag.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(newLoc: Coordinate): void {\n    super.moveDuringDrag(newLoc);\n    this.autoLayout = false;\n  }\n\n  /** @internal */\n  moveTo(x: number, y: number): void {\n    super.moveTo(x, y);\n    this.miniWorkspace.recordDragTargets();\n  }\n\n  /** @internal */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  newWorkspaceSvg(options: Options): WorkspaceSvg {\n    throw new Error(\n      'The implementation of newWorkspaceSvg should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport * as browserEvents from '../browser_events.js';\nimport {hasBubble} from '../interfaces/i_has_bubble.js';\nimport type {IIcon} from '../interfaces/i_icon.js';\nimport * as tooltip from '../tooltip.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport type {IconType} from './icon_types.js';\n\n/**\n * The abstract icon class. Icons are visual elements that live in the top-start\n * corner of the block. Usually they provide more \"meta\" information about a\n * block (such as warnings or comments) as opposed to fields, which provide\n * \"actual\" information, related to how a block functions.\n */\nexport abstract class Icon implements IIcon {\n  /**\n   * The position of this icon relative to its blocks top-start,\n   * in workspace units.\n   */\n  protected offsetInBlock: Coordinate = new Coordinate(0, 0);\n\n  /** The position of this icon in workspace coordinates. */\n  protected workspaceLocation: Coordinate = new Coordinate(0, 0);\n\n  /** The root svg element visually representing this icon. */\n  protected svgRoot: SVGGElement | null = null;\n\n  /** The tooltip for this icon. */\n  protected tooltip: tooltip.TipInfo;\n\n  constructor(protected sourceBlock: Block) {\n    this.tooltip = sourceBlock;\n  }\n\n  getType(): IconType<IIcon> {\n    throw new Error('Icons must implement getType');\n  }\n\n  initView(pointerdownListener: (e: PointerEvent) => void): void {\n    if (this.svgRoot) return; // The icon has already been initialized.\n\n    const svgBlock = this.sourceBlock as BlockSvg;\n    this.svgRoot = dom.createSvgElement(Svg.G, {'class': 'blocklyIconGroup'});\n    svgBlock.getSvgRoot().appendChild(this.svgRoot);\n    this.updateSvgRootOffset();\n    browserEvents.conditionalBind(\n      this.svgRoot,\n      'pointerdown',\n      this,\n      pointerdownListener,\n    );\n    (this.svgRoot as any).tooltip = this;\n    tooltip.bindMouseEvents(this.svgRoot);\n  }\n\n  dispose(): void {\n    tooltip.unbindMouseEvents(this.svgRoot);\n    dom.removeNode(this.svgRoot);\n  }\n\n  getWeight(): number {\n    return -1;\n  }\n\n  getSize(): Size {\n    return new Size(0, 0);\n  }\n\n  /**\n   * Sets the tooltip for this icon to the given value. Null to show the\n   * tooltip of the block.\n   */\n  setTooltip(tip: tooltip.TipInfo | null) {\n    this.tooltip = tip ?? this.sourceBlock;\n  }\n\n  /** Returns the tooltip for this icon. */\n  getTooltip(): tooltip.TipInfo {\n    return this.tooltip;\n  }\n\n  applyColour(): void {}\n\n  updateEditable(): void {}\n\n  updateCollapsed(): void {\n    if (!this.svgRoot) return;\n    if (this.sourceBlock.isCollapsed()) {\n      this.svgRoot.style.display = 'none';\n    } else {\n      this.svgRoot.style.display = 'block';\n    }\n    if (hasBubble(this)) {\n      this.setBubbleVisible(false);\n    }\n  }\n\n  hideForInsertionMarker(): void {\n    if (!this.svgRoot) return;\n    this.svgRoot.style.display = 'none';\n  }\n\n  isShownWhenCollapsed(): boolean {\n    return false;\n  }\n\n  setOffsetInBlock(offset: Coordinate): void {\n    this.offsetInBlock = offset;\n    this.updateSvgRootOffset();\n  }\n\n  private updateSvgRootOffset(): void {\n    this.svgRoot?.setAttribute(\n      'transform',\n      `translate(${this.offsetInBlock.x}, ${this.offsetInBlock.y})`,\n    );\n  }\n\n  onLocationChange(blockOrigin: Coordinate): void {\n    this.workspaceLocation = Coordinate.sum(blockOrigin, this.offsetInBlock);\n  }\n\n  onClick(): void {}\n\n  /**\n   * Check whether the icon should be clickable while the block is in a flyout.\n   * The default is that icons are clickable in all flyouts (auto-closing or not).\n   * Subclasses may override this function to change this behavior.\n   *\n   * @param autoClosingFlyout true if the containing flyout is an auto-closing one.\n   * @returns Whether the icon should be clickable while the block is in a flyout.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  isClickableInFlyout(autoClosingFlyout: boolean): boolean {\n    return true;\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Mutator\n\nimport type {BlockSvg} from '../block_svg.js';\nimport type {BlocklyOptions} from '../blockly_options.js';\nimport {MiniWorkspaceBubble} from '../bubbles/mini_workspace_bubble.js';\nimport type {Abstract} from '../events/events_abstract.js';\nimport {BlockChange} from '../events/events_block_change.js';\nimport {isBlockChange, isBlockCreate} from '../events/predicates.js';\nimport {EventType} from '../events/type.js';\nimport * as eventUtils from '../events/utils.js';\nimport type {IHasBubble} from '../interfaces/i_has_bubble.js';\nimport * as renderManagement from '../render_management.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport {Icon} from './icon.js';\nimport {IconType} from './icon_types.js';\n\n/** The size of the mutator icon in workspace-scale units. */\nconst SIZE = 17;\n\n/**\n * The distance between the root block in the mini workspace and that\n * workspace's edges.\n */\nconst WORKSPACE_MARGIN = 16;\n\n/**\n * An icon that allows the user to change the shape of the block.\n *\n * For example, it could be used to add additional fields or inputs to\n * the block.\n */\nexport class MutatorIcon extends Icon implements IHasBubble {\n  /** The type string used to identify this icon. */\n  static readonly TYPE = IconType.MUTATOR;\n\n  /**\n   * The weight this icon has relative to other icons. Icons with more positive\n   * weight values are rendered farther toward the end of the block.\n   */\n  static readonly WEIGHT = 1;\n\n  /** The bubble used to show the mini workspace to the user. */\n  private miniWorkspaceBubble: MiniWorkspaceBubble | null = null;\n\n  /** The root block in the mini workspace. */\n  private rootBlock: BlockSvg | null = null;\n\n  /** The PID tracking updating the workkspace in response to user events. */\n  private updateWorkspacePid: ReturnType<typeof setTimeout> | null = null;\n\n  /**\n   * The change listener in the main workspace that triggers the saveConnections\n   * method when anything in the main workspace changes.\n   *\n   * Only actually registered to listen for events while the mutator bubble is\n   * open.\n   */\n  private saveConnectionsListener: (() => void) | null = null;\n\n  constructor(\n    private readonly flyoutBlockTypes: string[],\n    protected readonly sourceBlock: BlockSvg,\n  ) {\n    super(sourceBlock);\n  }\n\n  override getType(): IconType<MutatorIcon> {\n    return MutatorIcon.TYPE;\n  }\n\n  override initView(pointerdownListener: (e: PointerEvent) => void): void {\n    if (this.svgRoot) return; // Already initialized.\n\n    super.initView(pointerdownListener);\n\n    // Square with rounded corners.\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyIconShape',\n        'rx': '4',\n        'ry': '4',\n        'height': '16',\n        'width': '16',\n      },\n      this.svgRoot,\n    );\n    // Gear teeth.\n    dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyIconSymbol',\n        'd':\n          'm4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,' +\n          '0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,' +\n          '-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,' +\n          '-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,' +\n          '-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 ' +\n          '-0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,' +\n          '0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z',\n      },\n      this.svgRoot,\n    );\n    // Axle hole.\n    dom.createSvgElement(\n      Svg.CIRCLE,\n      {'class': 'blocklyIconShape', 'r': '2.7', 'cx': '8', 'cy': '8'},\n      this.svgRoot,\n    );\n    dom.addClass(this.svgRoot!, 'blockly-icon-mutator');\n  }\n\n  override dispose(): void {\n    super.dispose();\n    this.miniWorkspaceBubble?.dispose();\n  }\n\n  override getWeight(): number {\n    return MutatorIcon.WEIGHT;\n  }\n\n  override getSize(): Size {\n    return new Size(SIZE, SIZE);\n  }\n\n  override applyColour(): void {\n    super.applyColour();\n    this.miniWorkspaceBubble?.setColour(this.sourceBlock.getColour());\n    this.miniWorkspaceBubble?.updateBlockStyles();\n  }\n\n  override updateCollapsed(): void {\n    super.updateCollapsed();\n    if (this.sourceBlock.isCollapsed()) this.setBubbleVisible(false);\n  }\n\n  override onLocationChange(blockOrigin: Coordinate): void {\n    super.onLocationChange(blockOrigin);\n    this.miniWorkspaceBubble?.setAnchorLocation(this.getAnchorLocation());\n  }\n\n  override onClick(): void {\n    super.onClick();\n    if (this.sourceBlock.isEditable()) {\n      this.setBubbleVisible(!this.bubbleIsVisible());\n    }\n  }\n\n  override isClickableInFlyout(): boolean {\n    return false;\n  }\n\n  bubbleIsVisible(): boolean {\n    return !!this.miniWorkspaceBubble;\n  }\n\n  async setBubbleVisible(visible: boolean): Promise<void> {\n    if (this.bubbleIsVisible() === visible) return;\n\n    await renderManagement.finishQueuedRenders();\n\n    if (visible) {\n      this.miniWorkspaceBubble = new MiniWorkspaceBubble(\n        this.getMiniWorkspaceConfig(),\n        this.sourceBlock.workspace,\n        this.getAnchorLocation(),\n        this.getBubbleOwnerRect(),\n      );\n      this.applyColour();\n      this.createRootBlock();\n      this.addSaveConnectionsListener();\n      this.miniWorkspaceBubble?.addWorkspaceChangeListener(\n        this.createMiniWorkspaceChangeListener(),\n      );\n    } else {\n      this.miniWorkspaceBubble?.dispose();\n      this.miniWorkspaceBubble = null;\n      if (this.saveConnectionsListener) {\n        this.sourceBlock.workspace.removeChangeListener(\n          this.saveConnectionsListener,\n        );\n      }\n      this.saveConnectionsListener = null;\n    }\n\n    eventUtils.fire(\n      new (eventUtils.get(EventType.BUBBLE_OPEN))(\n        this.sourceBlock,\n        visible,\n        'mutator',\n      ),\n    );\n  }\n\n  /** @returns the configuration the mini workspace should have. */\n  private getMiniWorkspaceConfig() {\n    const options: BlocklyOptions = {\n      'disable': false,\n      'media': this.sourceBlock.workspace.options.pathToMedia,\n      'rtl': this.sourceBlock.RTL,\n      'renderer': this.sourceBlock.workspace.options.renderer,\n      'rendererOverrides':\n        this.sourceBlock.workspace.options.rendererOverrides ?? undefined,\n    };\n\n    if (this.flyoutBlockTypes.length) {\n      options.toolbox = {\n        'kind': 'flyoutToolbox',\n        'contents': this.flyoutBlockTypes.map((type) => ({\n          'kind': 'block',\n          'type': type,\n        })),\n      };\n    }\n\n    return options;\n  }\n\n  /**\n   * @returns the location the bubble should be anchored to.\n   *     I.E. the middle of this icon.\n   */\n  private getAnchorLocation(): Coordinate {\n    const midIcon = SIZE / 2;\n    return Coordinate.sum(\n      this.workspaceLocation,\n      new Coordinate(midIcon, midIcon),\n    );\n  }\n\n  /**\n   * @returns the rect the bubble should avoid overlapping.\n   *     I.E. the block that owns this icon.\n   */\n  private getBubbleOwnerRect(): Rect {\n    const bbox = this.sourceBlock.getSvgRoot().getBBox();\n    return new Rect(bbox.y, bbox.y + bbox.height, bbox.x, bbox.x + bbox.width);\n  }\n\n  /** Decomposes the source block to create blocks in the mini workspace. */\n  private createRootBlock() {\n    if (!this.sourceBlock.decompose) {\n      throw new Error(\n        'Blocks with mutator icons must include a decompose method',\n      );\n    }\n    this.rootBlock = this.sourceBlock.decompose(\n      this.miniWorkspaceBubble!.getWorkspace(),\n    )!;\n\n    for (const child of this.rootBlock.getDescendants(false)) {\n      child.queueRender();\n    }\n\n    this.rootBlock.setMovable(false);\n    this.rootBlock.setDeletable(false);\n\n    const flyoutWidth =\n      this.miniWorkspaceBubble?.getWorkspace()?.getFlyout()?.getWidth() ?? 0;\n    this.rootBlock.moveBy(\n      this.rootBlock.RTL ? -(flyoutWidth + WORKSPACE_MARGIN) : WORKSPACE_MARGIN,\n      WORKSPACE_MARGIN,\n    );\n  }\n\n  /** Adds a listen to the source block that triggers saving connections. */\n  private addSaveConnectionsListener() {\n    if (!this.sourceBlock.saveConnections || !this.rootBlock) return;\n    this.saveConnectionsListener = () => {\n      if (!this.sourceBlock.saveConnections || !this.rootBlock) return;\n      this.sourceBlock.saveConnections(this.rootBlock);\n    };\n    this.saveConnectionsListener();\n    this.sourceBlock.workspace.addChangeListener(this.saveConnectionsListener);\n  }\n\n  /**\n   * Creates a change listener to add to the mini workspace which recomposes\n   * the block.\n   */\n  private createMiniWorkspaceChangeListener() {\n    return (e: Abstract) => {\n      if (!MutatorIcon.isIgnorableMutatorEvent(e) && !this.updateWorkspacePid) {\n        this.updateWorkspacePid = setTimeout(() => {\n          this.updateWorkspacePid = null;\n          this.recomposeSourceBlock();\n        }, 0);\n      }\n    };\n  }\n\n  /**\n   * Returns true if the given event is not one the mutator needs to\n   * care about.\n   *\n   * @internal\n   */\n  static isIgnorableMutatorEvent(e: Abstract) {\n    return (\n      e.isUiEvent ||\n      isBlockCreate(e) ||\n      (isBlockChange(e) && e.element === 'disabled')\n    );\n  }\n\n  /** Recomposes the source block based on changes to the mini workspace. */\n  private recomposeSourceBlock() {\n    if (!this.rootBlock) return;\n    if (!this.sourceBlock.compose) {\n      throw new Error(\n        'Blocks with mutator icons must include a compose method',\n      );\n    }\n\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) eventUtils.setGroup(true);\n\n    const oldExtraState = BlockChange.getExtraBlockState_(this.sourceBlock);\n    this.sourceBlock.compose(this.rootBlock);\n    const newExtraState = BlockChange.getExtraBlockState_(this.sourceBlock);\n\n    if (oldExtraState !== newExtraState) {\n      eventUtils.fire(\n        new (eventUtils.get(EventType.BLOCK_CHANGE))(\n          this.sourceBlock,\n          'mutation',\n          null,\n          oldExtraState,\n          newExtraState,\n        ),\n      );\n    }\n\n    eventUtils.setGroup(existingGroup);\n  }\n\n  /**\n   * @returns The workspace of the mini workspace bubble, if the bubble is\n   *     currently open.\n   */\n  getWorkspace(): WorkspaceSvg | undefined {\n    return this.miniWorkspaceBubble?.getWorkspace();\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.KeyCodes\n\n/* eslint-disable @typescript-eslint/no-duplicate-enum-values */\n\n/**\n * Key codes for common characters.\n *\n * Copied from Closure's goog.events.KeyCodes\n *\n * This list is not localized and therefore some of the key codes are not\n * correct for non US keyboard layouts. See comments below.\n */\nexport enum KeyCodes {\n  WIN_KEY_FF_LINUX = 0,\n  MAC_ENTER = 3,\n  BACKSPACE = 8,\n  TAB = 9,\n  NUM_CENTER = 12, // NUMLOCK on FF/Safari Mac\n  ENTER = 13,\n  SHIFT = 16,\n  CTRL = 17,\n  ALT = 18,\n  PAUSE = 19,\n  CAPS_LOCK = 20,\n  ESC = 27,\n  SPACE = 32,\n  PAGE_UP = 33, // also NUM_NORTH_EAST\n  PAGE_DOWN = 34, // also NUM_SOUTH_EAST\n  END = 35, // also NUM_SOUTH_WEST\n  HOME = 36, // also NUM_NORTH_WEST\n  LEFT = 37, // also NUM_WEST\n  UP = 38, // also NUM_NORTH\n  RIGHT = 39, // also NUM_EAST\n  DOWN = 40, // also NUM_SOUTH\n  PLUS_SIGN = 43, // NOT numpad plus\n  PRINT_SCREEN = 44,\n  INSERT = 45, // also NUM_INSERT\n  DELETE = 46, // also NUM_DELETE\n  ZERO = 48,\n  ONE = 49,\n  TWO = 50,\n  THREE = 51,\n  FOUR = 52,\n  FIVE = 53,\n  SIX = 54,\n  SEVEN = 55,\n  EIGHT = 56,\n  NINE = 57,\n  FF_SEMICOLON = 59, // Firefox (Gecko) fires this for semicolon instead of 186\n  FF_EQUALS = 61, // Firefox (Gecko) fires this for equals instead of 187\n  FF_DASH = 173, // Firefox (Gecko) fires this for dash instead of 189\n  // Firefox (Gecko) fires this for # on UK keyboards, rather than\n  // Shift+SINGLE_QUOTE.\n  FF_HASH = 163,\n  QUESTION_MARK = 63, // needs localization\n  AT_SIGN = 64,\n  A = 65,\n  B = 66,\n  C = 67,\n  D = 68,\n  E = 69,\n  F = 70,\n  G = 71,\n  H = 72,\n  I = 73,\n  J = 74,\n  K = 75,\n  L = 76,\n  M = 77,\n  N = 78,\n  O = 79,\n  P = 80,\n  Q = 81,\n  R = 82,\n  S = 83,\n  T = 84,\n  U = 85,\n  V = 86,\n  W = 87,\n  X = 88,\n  Y = 89,\n  Z = 90,\n  META = 91, // WIN_KEY_LEFT\n  WIN_KEY_RIGHT = 92,\n  CONTEXT_MENU = 93,\n  NUM_ZERO = 96,\n  NUM_ONE = 97,\n  NUM_TWO = 98,\n  NUM_THREE = 99,\n  NUM_FOUR = 100,\n  NUM_FIVE = 101,\n  NUM_SIX = 102,\n  NUM_SEVEN = 103,\n  NUM_EIGHT = 104,\n  NUM_NINE = 105,\n  NUM_MULTIPLY = 106,\n  NUM_PLUS = 107,\n  NUM_MINUS = 109,\n  NUM_PERIOD = 110,\n  NUM_DIVISION = 111,\n  F1 = 112,\n  F2 = 113,\n  F3 = 114,\n  F4 = 115,\n  F5 = 116,\n  F6 = 117,\n  F7 = 118,\n  F8 = 119,\n  F9 = 120,\n  F10 = 121,\n  F11 = 122,\n  F12 = 123,\n  NUMLOCK = 144,\n  SCROLL_LOCK = 145,\n\n  // OS-specific media keys like volume controls and browser controls.\n  FIRST_MEDIA_KEY = 166,\n  LAST_MEDIA_KEY = 183,\n\n  SEMICOLON = 186, // needs localization\n  DASH = 189, // needs localization\n  EQUALS = 187, // needs localization\n  COMMA = 188, // needs localization\n  PERIOD = 190, // needs localization\n  SLASH = 191, // needs localization\n  APOSTROPHE = 192, // needs localization\n  TILDE = 192, // needs localization\n  SINGLE_QUOTE = 222, // needs localization\n  OPEN_SQUARE_BRACKET = 219, // needs localization\n  BACKSLASH = 220, // needs localization\n  CLOSE_SQUARE_BRACKET = 221, // needs localization\n  WIN_KEY = 224,\n  MAC_FF_META = 224, // Firefox (Gecko) fires this for the meta key instead of 91\n  MAC_WK_CMD_LEFT = 91, // WebKit Left Command key fired, same as META\n  MAC_WK_CMD_RIGHT = 93, // WebKit Right Command key fired, different from META\n  WIN_IME = 229,\n\n  // \"Reserved for future use\". Some programs (e.g. the SlingPlayer 2.4 ActiveX\n  // control) fire this as a hacky way to disable screensavers.\n  VK_NONAME = 252,\n\n  // We've seen users whose machines fire this keycode at regular one\n  // second intervals. The common thread among these users is that\n  // they're all using Dell Inspiron laptops, so we suspect that this\n  // indicates a hardware/bios problem.\n  // http://en.community.dell.com/support-forums/laptop/f/3518/p/19285957/19523128.aspx\n  PHANTOM = 255,\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils\n\nimport * as browserEvents from './browser_events.js';\nimport * as extensions from './extensions.js';\nimport * as aria from './utils/aria.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as colour from './utils/colour.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport * as math from './utils/math.js';\nimport type {Metrics} from './utils/metrics.js';\nimport * as object from './utils/object.js';\nimport * as parsing from './utils/parsing.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport * as stringUtils from './utils/string.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as svgPaths from './utils/svg_paths.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as xml from './utils/xml.js';\n\nexport {\n  aria,\n  arrayUtils as array,\n  browserEvents,\n  colour,\n  Coordinate,\n  deprecation,\n  dom,\n  extensions,\n  idGenerator,\n  KeyCodes,\n  math,\n  Metrics,\n  object,\n  parsing,\n  Rect,\n  Size,\n  stringUtils as string,\n  style,\n  Svg,\n  svgMath,\n  svgPaths,\n  toolbox,\n  userAgent,\n  xml,\n};\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as Css from '../css.js';\nimport * as touch from '../touch.js';\nimport {browserEvents} from '../utils.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport * as drag from '../utils/drag.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {Bubble} from './bubble.js';\n\n/**\n * A bubble that displays editable text. It can also be resized by the user.\n * Used by the comment icon.\n */\nexport class TextInputBubble extends Bubble {\n  /** The root of the elements specific to the text element. */\n  private inputRoot: SVGForeignObjectElement;\n\n  /** The text input area element. */\n  private textArea: HTMLTextAreaElement;\n\n  /** The group containing the lines indicating the bubble is resizable. */\n  private resizeGroup: SVGGElement;\n\n  /**\n   * Event data associated with the listener for pointer up events on the\n   * resize group.\n   */\n  private resizePointerUpListener: browserEvents.Data | null = null;\n\n  /**\n   * Event data associated with the listener for pointer move events on the\n   * resize group.\n   */\n  private resizePointerMoveListener: browserEvents.Data | null = null;\n\n  /** Functions listening for changes to the text of this bubble. */\n  private textChangeListeners: (() => void)[] = [];\n\n  /** Functions listening for changes to the size of this bubble. */\n  private sizeChangeListeners: (() => void)[] = [];\n\n  /** The text of this bubble. */\n  private text = '';\n\n  /** The default size of this bubble, including borders. */\n  private readonly DEFAULT_SIZE = new Size(\n    160 + Bubble.DOUBLE_BORDER,\n    80 + Bubble.DOUBLE_BORDER,\n  );\n\n  /** The minimum size of this bubble, including borders. */\n  private readonly MIN_SIZE = new Size(\n    45 + Bubble.DOUBLE_BORDER,\n    20 + Bubble.DOUBLE_BORDER,\n  );\n\n  private editable = true;\n\n  /**\n   * @param workspace The workspace this bubble belongs to.\n   * @param anchor The anchor location of the thing this bubble is attached to.\n   *     The tail of the bubble will point to this location.\n   * @param ownerRect An optional rect we don't want the bubble to overlap with\n   *     when automatically positioning.\n   */\n  constructor(\n    public readonly workspace: WorkspaceSvg,\n    protected anchor: Coordinate,\n    protected ownerRect?: Rect,\n  ) {\n    super(workspace, anchor, ownerRect);\n    dom.addClass(this.svgRoot, 'blocklyTextInputBubble');\n    ({inputRoot: this.inputRoot, textArea: this.textArea} = this.createEditor(\n      this.contentContainer,\n    ));\n    this.resizeGroup = this.createResizeHandle(this.svgRoot, workspace);\n    this.setSize(this.DEFAULT_SIZE, true);\n  }\n\n  /** @returns the text of this bubble. */\n  getText(): string {\n    return this.text;\n  }\n\n  /** Sets the text of this bubble. Calls change listeners. */\n  setText(text: string) {\n    this.text = text;\n    this.textArea.value = text;\n    this.onTextChange();\n  }\n\n  /** Sets whether or not the text in the bubble is editable. */\n  setEditable(editable: boolean) {\n    this.editable = editable;\n    if (this.editable) {\n      this.textArea.removeAttribute('readonly');\n    } else {\n      this.textArea.setAttribute('readonly', '');\n    }\n  }\n\n  /** Returns whether or not the text in the bubble is editable. */\n  isEditable(): boolean {\n    return this.editable;\n  }\n\n  /** Adds a change listener to be notified when this bubble's text changes. */\n  addTextChangeListener(listener: () => void) {\n    this.textChangeListeners.push(listener);\n  }\n\n  /** Adds a change listener to be notified when this bubble's size changes. */\n  addSizeChangeListener(listener: () => void) {\n    this.sizeChangeListeners.push(listener);\n  }\n\n  /** Creates the editor UI for this bubble. */\n  private createEditor(container: SVGGElement): {\n    inputRoot: SVGForeignObjectElement;\n    textArea: HTMLTextAreaElement;\n  } {\n    const inputRoot = dom.createSvgElement(\n      Svg.FOREIGNOBJECT,\n      {\n        'x': Bubble.BORDER_WIDTH,\n        'y': Bubble.BORDER_WIDTH,\n      },\n      container,\n    );\n\n    const body = document.createElementNS(dom.HTML_NS, 'body');\n    body.setAttribute('xmlns', dom.HTML_NS);\n    body.className = 'blocklyMinimalBody';\n\n    const textArea = document.createElementNS(\n      dom.HTML_NS,\n      'textarea',\n    ) as HTMLTextAreaElement;\n    textArea.className = 'blocklyTextarea blocklyText';\n    textArea.setAttribute('dir', this.workspace.RTL ? 'RTL' : 'LTR');\n\n    body.appendChild(textArea);\n    inputRoot.appendChild(body);\n\n    this.bindTextAreaEvents(textArea);\n    setTimeout(() => {\n      textArea.focus();\n    }, 0);\n\n    return {inputRoot, textArea};\n  }\n\n  /** Binds events to the text area element. */\n  private bindTextAreaEvents(textArea: HTMLTextAreaElement) {\n    // Don't zoom with mousewheel; let it scroll instead.\n    browserEvents.conditionalBind(textArea, 'wheel', this, (e: Event) => {\n      e.stopPropagation();\n    });\n\n    browserEvents.conditionalBind(\n      textArea,\n      'focus',\n      this,\n      this.onStartEdit,\n      true,\n    );\n    browserEvents.conditionalBind(textArea, 'change', this, this.onTextChange);\n  }\n\n  /** Creates the resize handler elements and binds events to them. */\n  private createResizeHandle(\n    container: SVGGElement,\n    workspace: WorkspaceSvg,\n  ): SVGGElement {\n    const resizeHandle = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'class': 'blocklyResizeHandle',\n        'href': `${workspace.options.pathToMedia}resize-handle.svg`,\n      },\n      container,\n    );\n\n    browserEvents.conditionalBind(\n      resizeHandle,\n      'pointerdown',\n      this,\n      this.onResizePointerDown,\n    );\n\n    return resizeHandle;\n  }\n\n  /**\n   * Sets the size of this bubble, including the border.\n   *\n   * @param size Sets the size of this bubble, including the border.\n   * @param relayout If true, reposition the bubble from scratch so that it is\n   *     optimally visible. If false, reposition it so it maintains the same\n   *     position relative to the anchor.\n   */\n  setSize(size: Size, relayout = false) {\n    size.width = Math.max(size.width, this.MIN_SIZE.width);\n    size.height = Math.max(size.height, this.MIN_SIZE.height);\n\n    const widthMinusBorder = size.width - Bubble.DOUBLE_BORDER;\n    const heightMinusBorder = size.height - Bubble.DOUBLE_BORDER;\n    this.inputRoot.setAttribute('width', `${widthMinusBorder}`);\n    this.inputRoot.setAttribute('height', `${heightMinusBorder}`);\n\n    this.resizeGroup.setAttribute('y', `${heightMinusBorder}`);\n    if (this.workspace.RTL) {\n      this.resizeGroup.setAttribute('x', `${-Bubble.DOUBLE_BORDER}`);\n    } else {\n      this.resizeGroup.setAttribute('x', `${widthMinusBorder}`);\n    }\n\n    super.setSize(size, relayout);\n    this.onSizeChange();\n  }\n\n  /** @returns the size of this bubble. */\n  getSize(): Size {\n    // Overriden to be public.\n    return super.getSize();\n  }\n\n  /** Handles mouse down events on the resize target. */\n  private onResizePointerDown(e: PointerEvent) {\n    this.bringToFront();\n    if (browserEvents.isRightButton(e)) {\n      e.stopPropagation();\n      return;\n    }\n\n    drag.start(\n      this.workspace,\n      e,\n      new Coordinate(\n        this.workspace.RTL ? -this.getSize().width : this.getSize().width,\n        this.getSize().height,\n      ),\n    );\n\n    this.resizePointerUpListener = browserEvents.conditionalBind(\n      document,\n      'pointerup',\n      this,\n      this.onResizePointerUp,\n    );\n    this.resizePointerMoveListener = browserEvents.conditionalBind(\n      document,\n      'pointermove',\n      this,\n      this.onResizePointerMove,\n    );\n    this.workspace.hideChaff();\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /** Handles pointer up events on the resize target. */\n  private onResizePointerUp(_e: PointerEvent) {\n    touch.clearTouchIdentifier();\n    if (this.resizePointerUpListener) {\n      browserEvents.unbind(this.resizePointerUpListener);\n      this.resizePointerUpListener = null;\n    }\n    if (this.resizePointerMoveListener) {\n      browserEvents.unbind(this.resizePointerMoveListener);\n      this.resizePointerMoveListener = null;\n    }\n  }\n\n  /** Handles pointer move events on the resize target. */\n  private onResizePointerMove(e: PointerEvent) {\n    const delta = drag.move(this.workspace, e);\n    this.setSize(\n      new Size(this.workspace.RTL ? -delta.x : delta.x, delta.y),\n      false,\n    );\n    this.onSizeChange();\n  }\n\n  /**\n   * Handles starting an edit of the text area. Brings the bubble to the front.\n   */\n  private onStartEdit() {\n    if (this.bringToFront()) {\n      // Since the act of moving this node within the DOM causes a loss of\n      // focus, we need to reapply the focus.\n      this.textArea.focus();\n    }\n  }\n\n  /** Handles a text change event for the text area. Calls event listeners. */\n  private onTextChange() {\n    this.text = this.textArea.value;\n    for (const listener of this.textChangeListeners) {\n      listener();\n    }\n  }\n\n  /** Handles a size change event for the text area. Calls event listeners. */\n  private onSizeChange() {\n    for (const listener of this.sizeChangeListeners) {\n      listener();\n    }\n  }\n}\n\nCss.register(`\n.blocklyTextInputBubble .blocklyTextarea {\n  background-color: var(--commentFillColour);\n  border: 0;\n  box-sizing: border-box;\n  display: block;\n  outline: 0;\n  padding: 5px;\n  resize: none;\n  width: 100%;\n  height: 100%;\n}\n`);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Comment\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport {TextInputBubble} from '../bubbles/textinput_bubble.js';\nimport {EventType} from '../events/type.js';\nimport * as eventUtils from '../events/utils.js';\nimport type {IHasBubble} from '../interfaces/i_has_bubble.js';\nimport type {ISerializable} from '../interfaces/i_serializable.js';\nimport * as renderManagement from '../render_management.js';\nimport {Coordinate} from '../utils.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport {Icon} from './icon.js';\nimport {IconType} from './icon_types.js';\nimport * as registry from './registry.js';\n\n/** The size of the comment icon in workspace-scale units. */\nconst SIZE = 17;\n\n/** The default width in workspace-scale units of the text input bubble. */\nconst DEFAULT_BUBBLE_WIDTH = 160;\n\n/** The default height in workspace-scale units of the text input bubble. */\nconst DEFAULT_BUBBLE_HEIGHT = 80;\n\n/**\n * An icon which allows the user to add comment text to a block.\n */\nexport class CommentIcon extends Icon implements IHasBubble, ISerializable {\n  /** The type string used to identify this icon. */\n  static readonly TYPE = IconType.COMMENT;\n\n  /**\n   * The weight this icon has relative to other icons. Icons with more positive\n   * weight values are rendered farther toward the end of the block.\n   */\n  static readonly WEIGHT = 3;\n\n  /** The bubble used to show comment text to the user. */\n  private textInputBubble: TextInputBubble | null = null;\n\n  /** The text of this comment. */\n  private text = '';\n\n  /** The size of this comment (which is applied to the editable bubble). */\n  private bubbleSize = new Size(DEFAULT_BUBBLE_WIDTH, DEFAULT_BUBBLE_HEIGHT);\n\n  /**\n   * The visibility of the bubble for this comment.\n   *\n   * This is used to track what the visibile state /should/ be, not necessarily\n   * what it currently /is/. E.g. sometimes this will be true, but the block\n   * hasn't been rendered yet, so the bubble will not currently be visible.\n   */\n  private bubbleVisiblity = false;\n\n  constructor(protected readonly sourceBlock: Block) {\n    super(sourceBlock);\n  }\n\n  override getType(): IconType<CommentIcon> {\n    return CommentIcon.TYPE;\n  }\n\n  override initView(pointerdownListener: (e: PointerEvent) => void): void {\n    if (this.svgRoot) return; // Already initialized.\n\n    super.initView(pointerdownListener);\n\n    // Circle.\n    dom.createSvgElement(\n      Svg.CIRCLE,\n      {'class': 'blocklyIconShape', 'r': '8', 'cx': '8', 'cy': '8'},\n      this.svgRoot,\n    );\n    // Can't use a real '?' text character since different browsers and\n    // operating systems render it differently. Body of question mark.\n    dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyIconSymbol',\n        'd':\n          'm6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.405' +\n          '0.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25' +\n          '-1.201,0.998 -1.201,1.528 -1.204,2.19z',\n      },\n      this.svgRoot,\n    );\n    // Dot of question mark.\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyIconSymbol',\n        'x': '6.8',\n        'y': '10.78',\n        'height': '2',\n        'width': '2',\n      },\n      this.svgRoot,\n    );\n    dom.addClass(this.svgRoot!, 'blockly-icon-comment');\n  }\n\n  override dispose() {\n    super.dispose();\n    this.textInputBubble?.dispose();\n  }\n\n  override getWeight(): number {\n    return CommentIcon.WEIGHT;\n  }\n\n  override getSize(): Size {\n    return new Size(SIZE, SIZE);\n  }\n\n  override applyColour(): void {\n    super.applyColour();\n    const colour = (this.sourceBlock as BlockSvg).getColour();\n    this.textInputBubble?.setColour(colour);\n  }\n\n  /**\n   * Updates the state of the bubble (editable / noneditable) to reflect the\n   * state of the bubble if the bubble is currently shown.\n   */\n  override async updateEditable(): Promise<void> {\n    super.updateEditable();\n    if (this.bubbleIsVisible()) {\n      // Close and reopen the bubble to display the correct UI.\n      await this.setBubbleVisible(false);\n      await this.setBubbleVisible(true);\n    }\n  }\n\n  override onLocationChange(blockOrigin: Coordinate): void {\n    super.onLocationChange(blockOrigin);\n    const anchorLocation = this.getAnchorLocation();\n    this.textInputBubble?.setAnchorLocation(anchorLocation);\n  }\n\n  /** Sets the text of this comment. Updates any bubbles if they are visible. */\n  setText(text: string) {\n    const oldText = this.text;\n    eventUtils.fire(\n      new (eventUtils.get(EventType.BLOCK_CHANGE))(\n        this.sourceBlock,\n        'comment',\n        null,\n        oldText,\n        text,\n      ),\n    );\n    this.text = text;\n    this.textInputBubble?.setText(this.text);\n  }\n\n  /** Returns the text of this comment. */\n  getText(): string {\n    return this.text;\n  }\n\n  /**\n   * Sets the size of the editable bubble for this comment. Resizes the\n   * bubble if it is visible.\n   */\n  setBubbleSize(size: Size) {\n    this.bubbleSize = size;\n    this.textInputBubble?.setSize(this.bubbleSize, true);\n  }\n\n  /** @returns the size of the editable bubble for this comment. */\n  getBubbleSize(): Size {\n    return this.bubbleSize;\n  }\n\n  /**\n   * @returns the state of the comment as a JSON serializable value if the\n   * comment has text. Otherwise returns null.\n   */\n  saveState(): CommentState | null {\n    if (this.text) {\n      return {\n        'text': this.text,\n        'pinned': this.bubbleIsVisible(),\n        'height': this.bubbleSize.height,\n        'width': this.bubbleSize.width,\n      };\n    }\n    return null;\n  }\n\n  /** Applies the given state to this comment. */\n  loadState(state: CommentState) {\n    this.text = state['text'] ?? '';\n    this.bubbleSize = new Size(\n      state['width'] ?? DEFAULT_BUBBLE_WIDTH,\n      state['height'] ?? DEFAULT_BUBBLE_HEIGHT,\n    );\n    this.bubbleVisiblity = state['pinned'] ?? false;\n    this.setBubbleVisible(this.bubbleVisiblity);\n  }\n\n  override onClick(): void {\n    super.onClick();\n    this.setBubbleVisible(!this.bubbleIsVisible());\n  }\n\n  override isClickableInFlyout(): boolean {\n    return false;\n  }\n\n  /**\n   * Updates the text of this comment in response to changes in the text of\n   * the input bubble.\n   */\n  onTextChange(): void {\n    if (!this.textInputBubble) return;\n\n    const newText = this.textInputBubble.getText();\n    if (this.text === newText) return;\n\n    eventUtils.fire(\n      new (eventUtils.get(EventType.BLOCK_CHANGE))(\n        this.sourceBlock,\n        'comment',\n        null,\n        this.text,\n        newText,\n      ),\n    );\n    this.text = newText;\n  }\n\n  /**\n   * Updates the size of this icon in response to changes in the size of the\n   * input bubble.\n   */\n  onSizeChange(): void {\n    if (this.textInputBubble) {\n      this.bubbleSize = this.textInputBubble.getSize();\n    }\n  }\n\n  bubbleIsVisible(): boolean {\n    return this.bubbleVisiblity;\n  }\n\n  async setBubbleVisible(visible: boolean): Promise<void> {\n    if (this.bubbleVisiblity === visible) return;\n    this.bubbleVisiblity = visible;\n\n    await renderManagement.finishQueuedRenders();\n\n    if (\n      !this.sourceBlock.rendered ||\n      this.sourceBlock.isInFlyout ||\n      this.sourceBlock.isInsertionMarker()\n    )\n      return;\n\n    if (visible) {\n      if (this.sourceBlock.isEditable()) {\n        this.showEditableBubble();\n      } else {\n        this.showNonEditableBubble();\n      }\n      this.applyColour();\n    } else {\n      this.hideBubble();\n    }\n\n    eventUtils.fire(\n      new (eventUtils.get(EventType.BUBBLE_OPEN))(\n        this.sourceBlock,\n        visible,\n        'comment',\n      ),\n    );\n  }\n\n  /**\n   * Shows the editable text bubble for this comment, and adds change listeners\n   * to update the state of this icon in response to changes in the bubble.\n   */\n  private showEditableBubble() {\n    this.createBubble();\n    this.textInputBubble?.addTextChangeListener(() => this.onTextChange());\n    this.textInputBubble?.addSizeChangeListener(() => this.onSizeChange());\n  }\n\n  /** Shows the non editable text bubble for this comment. */\n  private showNonEditableBubble() {\n    this.createBubble();\n    this.textInputBubble?.setEditable(false);\n  }\n\n  protected createBubble() {\n    this.textInputBubble = new TextInputBubble(\n      this.sourceBlock.workspace as WorkspaceSvg,\n      this.getAnchorLocation(),\n      this.getBubbleOwnerRect(),\n    );\n    this.textInputBubble.setText(this.getText());\n    this.textInputBubble.setSize(this.bubbleSize, true);\n  }\n\n  /** Hides any open bubbles owned by this comment. */\n  private hideBubble() {\n    this.textInputBubble?.dispose();\n    this.textInputBubble = null;\n  }\n\n  /**\n   * @returns the location the bubble should be anchored to.\n   *     I.E. the middle of this icon.\n   */\n  private getAnchorLocation(): Coordinate {\n    const midIcon = SIZE / 2;\n    return Coordinate.sum(\n      this.workspaceLocation,\n      new Coordinate(midIcon, midIcon),\n    );\n  }\n\n  /**\n   * @returns the rect the bubble should avoid overlapping.\n   *     I.E. the block that owns this icon.\n   */\n  private getBubbleOwnerRect(): Rect {\n    return (this.sourceBlock as BlockSvg).getBoundingRectangleWithoutChildren();\n  }\n}\n\n/** The save state format for a comment icon. */\nexport interface CommentState {\n  /** The text of the comment. */\n  text?: string;\n\n  /** True if the comment is open, false otherwise. */\n  pinned?: boolean;\n\n  /** The height of the comment bubble. */\n  height?: number;\n\n  /** The width of the comment bubble. */\n  width?: number;\n}\n\nregistry.register(CommentIcon.TYPE, CommentIcon);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IIcon} from '../interfaces/i_icon.js';\n\n/**\n * Thrown when you add more than one icon of the same type to a block.\n */\nexport class DuplicateIconType extends Error {\n  /**\n   * @internal\n   */\n  constructor(public icon: IIcon) {\n    super(\n      `Tried to append an icon of type ${icon.getType()} when an icon of ` +\n        `that type already exists on the block. ` +\n        `Use getIcon to access the existing icon.`,\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport {Size} from '../utils/size.js';\nimport {Svg} from '../utils/svg.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\nimport {Bubble} from './bubble.js';\n\n/**\n * A bubble that displays non-editable text. Used by the warning icon.\n */\nexport class TextBubble extends Bubble {\n  private paragraph: SVGGElement;\n\n  constructor(\n    private text: string,\n    public readonly workspace: WorkspaceSvg,\n    protected anchor: Coordinate,\n    protected ownerRect?: Rect,\n  ) {\n    super(workspace, anchor, ownerRect);\n    this.paragraph = this.stringToSvg(text, this.contentContainer);\n    this.updateBubbleSize();\n  }\n\n  /** @returns the current text of this text bubble. */\n  getText(): string {\n    return this.text;\n  }\n\n  /** Sets the current text of this text bubble, and updates the display. */\n  setText(text: string) {\n    this.text = text;\n    dom.removeNode(this.paragraph);\n    this.paragraph = this.stringToSvg(text, this.contentContainer);\n    this.updateBubbleSize();\n  }\n\n  /**\n   * Converts the given string into an svg containing that string,\n   * broken up by newlines.\n   */\n  private stringToSvg(text: string, container: SVGGElement) {\n    const paragraph = this.createParagraph(container);\n    const fragments = this.createTextFragments(paragraph, text);\n    if (this.workspace.RTL)\n      this.rightAlignTextFragments(paragraph.getBBox().width, fragments);\n    return paragraph;\n  }\n\n  /** Creates the paragraph container for this bubble's view's text fragments. */\n  private createParagraph(container: SVGGElement): SVGGElement {\n    return dom.createSvgElement(\n      Svg.G,\n      {\n        'class': 'blocklyText blocklyBubbleText blocklyNoPointerEvents',\n        'transform': `translate(0,${Bubble.BORDER_WIDTH})`,\n        'style': `direction: ${this.workspace.RTL ? 'rtl' : 'ltr'}`,\n      },\n      container,\n    );\n  }\n\n  /** Creates the text fragments visualizing the text of this bubble. */\n  private createTextFragments(\n    parent: SVGGElement,\n    text: string,\n  ): SVGTextElement[] {\n    let lineNum = 1;\n    return text.split('\\n').map((line) => {\n      const fragment = dom.createSvgElement(\n        Svg.TEXT,\n        {'y': `${lineNum}em`, 'x': Bubble.BORDER_WIDTH},\n        parent,\n      );\n      const textNode = document.createTextNode(line);\n      fragment.appendChild(textNode);\n      lineNum += 1;\n      return fragment;\n    });\n  }\n\n  /** Right aligns the given text fragments. */\n  private rightAlignTextFragments(\n    maxWidth: number,\n    fragments: SVGTextElement[],\n  ) {\n    for (const text of fragments) {\n      text.setAttribute('text-anchor', 'start');\n      text.setAttribute('x', `${maxWidth + Bubble.BORDER_WIDTH}`);\n    }\n  }\n\n  /** Updates the size of this bubble to account for the size of the text. */\n  private updateBubbleSize() {\n    const bbox = this.paragraph.getBBox();\n    this.setSize(\n      new Size(\n        bbox.width + Bubble.BORDER_WIDTH * 2,\n        bbox.height + Bubble.BORDER_WIDTH * 2,\n      ),\n      true,\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Warning\n\nimport type {BlockSvg} from '../block_svg.js';\nimport {TextBubble} from '../bubbles/text_bubble.js';\nimport {EventType} from '../events/type.js';\nimport * as eventUtils from '../events/utils.js';\nimport type {IHasBubble} from '../interfaces/i_has_bubble.js';\nimport * as renderManagement from '../render_management.js';\nimport {Size} from '../utils.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport {Svg} from '../utils/svg.js';\nimport {Icon} from './icon.js';\nimport {IconType} from './icon_types.js';\n\n/** The size of the warning icon in workspace-scale units. */\nconst SIZE = 17;\n\n/**\n * An icon that warns the user that something is wrong with their block.\n *\n * For example, this could be used to warn them about incorrect field values,\n * or incorrect placement of the block (putting it somewhere it doesn't belong).\n */\nexport class WarningIcon extends Icon implements IHasBubble {\n  /** The type string used to identify this icon. */\n  static readonly TYPE = IconType.WARNING;\n\n  /**\n   * The weight this icon has relative to other icons. Icons with more positive\n   * weight values are rendered farther toward the end of the block.\n   */\n  static readonly WEIGHT = 2;\n\n  /** A map of warning IDs to warning text. */\n  private textMap: Map<string, string> = new Map();\n\n  /** The bubble used to display the warnings to the user. */\n  private textBubble: TextBubble | null = null;\n\n  /** @internal */\n  constructor(protected readonly sourceBlock: BlockSvg) {\n    super(sourceBlock);\n  }\n\n  override getType(): IconType<WarningIcon> {\n    return WarningIcon.TYPE;\n  }\n\n  override initView(pointerdownListener: (e: PointerEvent) => void): void {\n    if (this.svgRoot) return; // Already initialized.\n\n    super.initView(pointerdownListener);\n\n    // Triangle with rounded corners.\n    dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyIconShape',\n        'd': 'M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z',\n      },\n      this.svgRoot,\n    );\n    // Can't use a real '!' text character since different browsers and\n    // operating systems render it differently. Body of exclamation point.\n    dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyIconSymbol',\n        'd': 'm7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z',\n      },\n      this.svgRoot,\n    );\n    // Dot of exclamation point.\n    dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyIconSymbol',\n        'x': '7',\n        'y': '11',\n        'height': '2',\n        'width': '2',\n      },\n      this.svgRoot,\n    );\n    dom.addClass(this.svgRoot!, 'blockly-icon-warning');\n  }\n\n  override dispose() {\n    super.dispose();\n    this.textBubble?.dispose();\n  }\n\n  override getWeight(): number {\n    return WarningIcon.WEIGHT;\n  }\n\n  override getSize(): Size {\n    return new Size(SIZE, SIZE);\n  }\n\n  override applyColour(): void {\n    super.applyColour();\n    this.textBubble?.setColour(this.sourceBlock.getColour());\n  }\n\n  override updateCollapsed(): void {\n    // We are shown when collapsed, so do nothing! I.e. skip the default\n    // behavior of hiding.\n  }\n\n  /** Tells blockly that this icon is shown when the block is collapsed. */\n  override isShownWhenCollapsed(): boolean {\n    return true;\n  }\n\n  /** Updates the location of the icon's bubble if it is open. */\n  override onLocationChange(blockOrigin: Coordinate): void {\n    super.onLocationChange(blockOrigin);\n    this.textBubble?.setAnchorLocation(this.getAnchorLocation());\n  }\n\n  /**\n   * Adds a warning message to this warning icon.\n   *\n   * @param text The text of the message to add.\n   * @param id The id of the message to add.\n   * @internal\n   */\n  addMessage(text: string, id: string): this {\n    if (this.textMap.get(id) === text) return this;\n\n    if (text) {\n      this.textMap.set(id, text);\n    } else {\n      this.textMap.delete(id);\n    }\n\n    this.textBubble?.setText(this.getText());\n    return this;\n  }\n\n  /**\n   * @returns the display text for this icon. Includes all warning messages\n   *     concatenated together with newlines.\n   * @internal\n   */\n  getText(): string {\n    return [...this.textMap.values()].join('\\n');\n  }\n\n  /** Toggles the visibility of the bubble. */\n  override onClick(): void {\n    super.onClick();\n    this.setBubbleVisible(!this.bubbleIsVisible());\n  }\n\n  override isClickableInFlyout(): boolean {\n    return false;\n  }\n\n  bubbleIsVisible(): boolean {\n    return !!this.textBubble;\n  }\n\n  async setBubbleVisible(visible: boolean): Promise<void> {\n    if (this.bubbleIsVisible() === visible) return;\n\n    await renderManagement.finishQueuedRenders();\n\n    if (visible) {\n      this.textBubble = new TextBubble(\n        this.getText(),\n        this.sourceBlock.workspace,\n        this.getAnchorLocation(),\n        this.getBubbleOwnerRect(),\n      );\n      this.applyColour();\n    } else {\n      this.textBubble?.dispose();\n      this.textBubble = null;\n    }\n\n    eventUtils.fire(\n      new (eventUtils.get(EventType.BUBBLE_OPEN))(\n        this.sourceBlock,\n        visible,\n        'warning',\n      ),\n    );\n  }\n\n  /**\n   * @returns the location the bubble should be anchored to.\n   *     I.E. the middle of this icon.\n   */\n  private getAnchorLocation(): Coordinate {\n    const midIcon = SIZE / 2;\n    return Coordinate.sum(\n      this.workspaceLocation,\n      new Coordinate(midIcon, midIcon),\n    );\n  }\n\n  /**\n   * @returns the rect the bubble should avoid overlapping.\n   *     I.E. the block that owns this icon.\n   */\n  private getBubbleOwnerRect(): Rect {\n    const bbox = this.sourceBlock.getSvgRoot().getBBox();\n    return new Rect(bbox.y, bbox.y + bbox.height, bbox.x, bbox.x + bbox.width);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {CommentIcon, CommentState} from './icons/comment_icon.js';\nimport * as exceptions from './icons/exceptions.js';\nimport {Icon} from './icons/icon.js';\nimport {IconType} from './icons/icon_types.js';\nimport {MutatorIcon} from './icons/mutator_icon.js';\nimport * as registry from './icons/registry.js';\nimport {WarningIcon} from './icons/warning_icon.js';\n\nexport {\n  CommentIcon,\n  CommentState,\n  exceptions,\n  Icon,\n  IconType,\n  MutatorIcon,\n  registry,\n  WarningIcon,\n};\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for handling variable and procedure names.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Names\n\nimport {Msg} from './msg.js';\n// import * as Procedures from './procedures.js';\nimport type {VariableMap} from './variable_map.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Class for a database of entity names (variables, procedures, etc).\n */\nexport class Names {\n  static DEVELOPER_VARIABLE_TYPE: NameType;\n  private readonly variablePrefix: string;\n\n  /** A set of reserved words. */\n  private readonly reservedWords: Set<string>;\n\n  /**\n   * A map from type (e.g. name, procedure) to maps from names to generated\n   * names.\n   */\n  private readonly db = new Map<string, Map<string, string>>();\n\n  /** A set of used names to avoid collisions. */\n  private readonly dbReverse = new Set<string>();\n\n  /**\n   * The variable map from the workspace, containing Blockly variable models.\n   */\n  private variableMap: VariableMap | null = null;\n\n  /**\n   * @param reservedWordsList A comma-separated string of words that are illegal\n   *     for use as names in a language (e.g. 'new,if,this,...').\n   * @param opt_variablePrefix Some languages need a '$' or a namespace before\n   *     all variable names (but not procedure names).\n   */\n  constructor(reservedWordsList: string, opt_variablePrefix?: string) {\n    /** The prefix to attach to variable names in generated code. */\n    this.variablePrefix = opt_variablePrefix || '';\n\n    this.reservedWords = new Set<string>(\n      reservedWordsList ? reservedWordsList.split(',') : [],\n    );\n  }\n\n  /**\n   * Empty the database and start from scratch.  The reserved words are kept.\n   */\n  reset() {\n    this.db.clear();\n    this.dbReverse.clear();\n    this.variableMap = null;\n  }\n\n  /**\n   * Set the variable map that maps from variable name to variable object.\n   *\n   * @param map The map to track.\n   */\n  setVariableMap(map: VariableMap) {\n    this.variableMap = map;\n  }\n\n  /**\n   * Get the name for a user-defined variable, based on its ID.\n   * This should only be used for variables of NameType VARIABLE.\n   *\n   * @param id The ID to look up in the variable map.\n   * @returns The name of the referenced variable, or null if there was no\n   *     variable map or the variable was not found in the map.\n   */\n  private getNameForUserVariable(id: string): string | null {\n    if (!this.variableMap) {\n      console.warn(\n        'Deprecated call to Names.prototype.getName without ' +\n          'defining a variable map. To fix, add the following code in your ' +\n          \"generator's init() function:\\n\" +\n          'Blockly.YourGeneratorName.nameDB_.setVariableMap(' +\n          'workspace.getVariableMap());',\n      );\n      return null;\n    }\n    const variable = this.variableMap.getVariableById(id);\n    if (variable) {\n      return variable.name;\n    }\n    return null;\n  }\n\n  /**\n   * Generate names for user variables, but only ones that are being used.\n   *\n   * @param workspace Workspace to generate variables from.\n   */\n  populateVariables(workspace: Workspace) {\n    const variables = Variables.allUsedVarModels(workspace);\n    for (let i = 0; i < variables.length; i++) {\n      this.getName(variables[i].getId(), NameType.VARIABLE);\n    }\n  }\n\n  /**\n   * Generate names for procedures.\n   *\n   * @param workspace Workspace to generate procedures from.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  populateProcedures(workspace: Workspace) {\n    throw new Error(\n      'The implementation of populateProcedures should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n\n  /**\n   * Convert a Blockly entity name to a legal exportable entity name.\n   *\n   * @param nameOrId The Blockly entity name (no constraints) or variable ID.\n   * @param type The type of the name in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns An entity name that is legal in the exported language.\n   */\n  getName(nameOrId: string, type: NameType | string): string {\n    let name = nameOrId;\n    if (type === NameType.VARIABLE) {\n      const varName = this.getNameForUserVariable(nameOrId);\n      if (varName) {\n        // Successful ID lookup.\n        name = varName;\n      }\n    }\n    const normalizedName = name.toLowerCase();\n\n    const isVar =\n      type === NameType.VARIABLE || type === NameType.DEVELOPER_VARIABLE;\n\n    const prefix = isVar ? this.variablePrefix : '';\n    if (!this.db.has(type)) {\n      this.db.set(type, new Map<string, string>());\n    }\n    const typeDb = this.db.get(type);\n    if (typeDb!.has(normalizedName)) {\n      return prefix + typeDb!.get(normalizedName);\n    }\n    const safeName = this.getDistinctName(name, type);\n    typeDb!.set(normalizedName, safeName.substr(prefix.length));\n    return safeName;\n  }\n\n  /**\n   * Return a list of all known user-created names of a specified name type.\n   *\n   * @param type The type of entity in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns A list of Blockly entity names (no constraints).\n   */\n  getUserNames(type: NameType | string): string[] {\n    const userNames = this.db.get(type)?.keys();\n    return userNames ? Array.from(userNames) : [];\n  }\n\n  /**\n   * Convert a Blockly entity name to a legal exportable entity name.\n   * Ensure that this is a new name not overlapping any previously defined name.\n   * Also check against list of reserved words for the current language and\n   * ensure name doesn't collide.\n   *\n   * @param name The Blockly entity name (no constraints).\n   * @param type The type of entity in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns An entity name that is legal in the exported language.\n   */\n  getDistinctName(name: string, type: NameType | string): string {\n    let safeName = this.safeName(name);\n    let i: number | null = null;\n    while (\n      this.dbReverse.has(safeName + (i ?? '')) ||\n      this.reservedWords.has(safeName + (i ?? ''))\n    ) {\n      // Collision with existing name.  Create a unique name.\n      i = i ? i + 1 : 2;\n    }\n    safeName += i ?? '';\n    this.dbReverse.add(safeName);\n    const isVar =\n      type === NameType.VARIABLE || type === NameType.DEVELOPER_VARIABLE;\n    const prefix = isVar ? this.variablePrefix : '';\n    return prefix + safeName;\n  }\n\n  /**\n   * Given a proposed entity name, generate a name that conforms to the\n   * [_A-Za-z][_A-Za-z0-9]* format that most languages consider legal for\n   * variable and function names.\n   *\n   * @param name Potentially illegal entity name.\n   * @returns Safe entity name.\n   */\n  private safeName(name: string): string {\n    if (!name) {\n      name = Msg['UNNAMED_KEY'] || 'unnamed';\n    } else {\n      // Unfortunately names in non-latin characters will look like\n      // _E9_9F_B3_E4_B9_90 which is pretty meaningless.\n      // https://github.com/google/blockly/issues/1654\n      name = encodeURI(name.replace(/ /g, '_')).replace(/[^\\w]/g, '_');\n      // Most languages don't allow names with leading numbers.\n      if ('0123456789'.includes(name[0])) {\n        name = 'my_' + name;\n      }\n    }\n    return name;\n  }\n\n  /**\n   * Do the given two entity names refer to the same entity?\n   * Blockly names are case-insensitive.\n   *\n   * @param name1 First name.\n   * @param name2 Second name.\n   * @returns True if names are the same.\n   */\n  static equals(name1: string, name2: string): boolean {\n    // name1.localeCompare(name2) is slower.\n    return name1.toLowerCase() === name2.toLowerCase();\n  }\n}\n\nexport namespace Names {\n  /**\n   * Enum for the type of a name. Different name types may have different rules\n   * about collisions.\n   * When JavaScript (or most other languages) is generated, variable 'foo' and\n   * procedure 'foo' would collide.  However, Blockly has no such problems since\n   * variable get 'foo' and procedure call 'foo' are unambiguous.\n   * Therefore, Blockly keeps a separate name type to disambiguate.\n   * getName('foo', 'VARIABLE') = 'foo'\n   * getName('foo', 'PROCEDURE') = 'foo2'\n   *\n   */\n  export enum NameType {\n    DEVELOPER_VARIABLE = 'DEVELOPER_VARIABLE',\n    VARIABLE = 'VARIABLE',\n    PROCEDURE = 'PROCEDURE',\n  }\n}\n\nexport type NameType = Names.NameType;\nexport const NameType = Names.NameType;\n\n/**\n * Constant to separate developer variable names from user-defined variable\n * names when running generators.\n * A developer variable will be declared as a global in the generated code, but\n * will never be shown to the user in the workspace or stored in the variable\n * map.\n */\nNames.DEVELOPER_VARIABLE_TYPE = NameType.DEVELOPER_VARIABLE;\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {isObservable} from './interfaces/i_observable.js';\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport type {IProcedureModel} from './interfaces/i_procedure_model.js';\n\nexport class ObservableProcedureMap\n  extends Map<string, IProcedureModel>\n  implements IProcedureMap\n{\n  /** @internal */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Adds the given procedure model to the procedure map.\n   */\n  override set(id: string, proc: IProcedureModel): this {\n    if (this.get(id) === proc) return this;\n    super.set(id, proc);\n    if (isObservable(proc)) proc.startPublishing();\n    return this;\n  }\n\n  /**\n   * Deletes the ProcedureModel with the given ID from the procedure map (if it\n   * exists).\n   */\n  override delete(id: string): boolean {\n    const proc = this.get(id);\n    const existed = super.delete(id);\n    if (!existed) return existed;\n    if (isObservable(proc)) proc.stopPublishing();\n    return existed;\n  }\n\n  /**\n   * Removes all ProcedureModels from the procedure map.\n   */\n  override clear() {\n    if (!this.size) return;\n    for (const id of this.keys()) {\n      this.delete(id);\n    }\n  }\n\n  /**\n   * Adds the given ProcedureModel to the map of procedure models, so that\n   * blocks can find it.\n   */\n  add(proc: IProcedureModel): this {\n    return this.set(proc.getId(), proc);\n  }\n\n  /**\n   * Returns all of the procedures stored in this map.\n   */\n  getProcedures(): IProcedureModel[] {\n    return [...this.values()];\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Types\n\nimport type {Measurable} from './base.js';\nimport type {Row} from './row.js';\n\n/**\n * Types of rendering elements.\n */\nclass TypesContainer {\n  // This class is very non-idiomatic for typescript, so we have to use\n  // the Function type to make it happy.\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\n  [index: string]: number | Function;\n\n  NONE = 0; // None\n  FIELD = 1 << 0; // Field.\n  HAT = 1 << 1; // Hat.\n  ICON = 1 << 2; // Icon.\n  SPACER = 1 << 3; // Spacer.\n  BETWEEN_ROW_SPACER = 1 << 4; // Between Row Spacer.\n  IN_ROW_SPACER = 1 << 5; // In Row Spacer.\n  EXTERNAL_VALUE_INPUT = 1 << 6; // External Value Input.\n  INPUT = 1 << 7; // Input.\n  INLINE_INPUT = 1 << 8; // Inline Input.\n  STATEMENT_INPUT = 1 << 9; // Statement Input.\n  CONNECTION = 1 << 10; // Connection.\n  PREVIOUS_CONNECTION = 1 << 11; // Previous Connection.\n  NEXT_CONNECTION = 1 << 12; // Next Connection.\n  OUTPUT_CONNECTION = 1 << 13; // Output Connection.\n  CORNER = 1 << 14; // Corner.\n  LEFT_SQUARE_CORNER = 1 << 15; // Square Corner.\n  LEFT_ROUND_CORNER = 1 << 16; // Round Corner.\n  RIGHT_SQUARE_CORNER = 1 << 17; // Right Square Corner.\n  RIGHT_ROUND_CORNER = 1 << 18; // Right Round Corner.\n  JAGGED_EDGE = 1 << 19; // Jagged Edge.\n  ROW = 1 << 20; // Row.\n  TOP_ROW = 1 << 21; // Top Row.\n  BOTTOM_ROW = 1 << 22; // Bottom Row.\n  INPUT_ROW = 1 << 23; // Input Row.\n\n  /**\n   * A Left Corner Union Type.\n   */\n  LEFT_CORNER = this.LEFT_SQUARE_CORNER | this.LEFT_ROUND_CORNER;\n\n  /**\n   * A Right Corner Union Type.\n   */\n  RIGHT_CORNER = this.RIGHT_SQUARE_CORNER | this.RIGHT_ROUND_CORNER;\n\n  /**\n   * Next flag value to use for custom rendering element types.\n   * This must be updated to reflect the next enum flag value\n   * to use if additional elements are added to\n   * `Types`.\n   */\n  nextTypeValue_ = 1 << 24;\n\n  /**\n   * Get the enum flag value of an existing type or register a new type.\n   *\n   * @param type The name of the type.\n   * @returns The enum flag value associated with that type.\n   */\n  getType(type: string): number {\n    if (!Object.prototype.hasOwnProperty.call(this, type)) {\n      this[type] = this.nextTypeValue_;\n      this.nextTypeValue_ <<= 1;\n    }\n    return this[type] as number;\n  }\n\n  /**\n   * Whether a measurable stores information about a field.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a field.\n   */\n  isField(elem: Measurable): number {\n    return elem.type & this.FIELD;\n  }\n\n  /**\n   * Whether a measurable stores information about a hat.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a hat.\n   */\n  isHat(elem: Measurable): number {\n    return elem.type & this.HAT;\n  }\n\n  /**\n   * Whether a measurable stores information about an icon.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an icon.\n   */\n  isIcon(elem: Measurable): number {\n    return elem.type & this.ICON;\n  }\n\n  /**\n   * Whether a measurable stores information about a spacer.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a spacer.\n   */\n  isSpacer(elem: Measurable | Row): number {\n    return elem.type & this.SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about an in-row spacer.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an in-row spacer.\n   */\n  isInRowSpacer(elem: Measurable): number {\n    return elem.type & this.IN_ROW_SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about an input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an input.\n   */\n  isInput(elem: Measurable): number {\n    return elem.type & this.INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about an external input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an external input.\n   */\n  isExternalInput(elem: Measurable): number {\n    return elem.type & this.EXTERNAL_VALUE_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about an inline input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an inline input.\n   */\n  isInlineInput(elem: Measurable): number {\n    return elem.type & this.INLINE_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about a statement input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a statement input.\n   */\n  isStatementInput(elem: Measurable): number {\n    return elem.type & this.STATEMENT_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about a previous connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a previous connection.\n   */\n  isPreviousConnection(elem: Measurable): number {\n    return elem.type & this.PREVIOUS_CONNECTION;\n  }\n\n  /**\n   * Whether a measurable stores information about a next connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a next connection.\n   */\n  isNextConnection(elem: Measurable): number {\n    return elem.type & this.NEXT_CONNECTION;\n  }\n\n  /**\n   * Whether a measurable stores information about a previous or next\n   * connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a previous or next\n   *     connection.\n   */\n  isPreviousOrNextConnection(elem: Measurable): number {\n    return elem.type & (this.PREVIOUS_CONNECTION | this.NEXT_CONNECTION);\n  }\n\n  /**\n   * Whether a measurable stores information about a left round corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a left round corner.\n   */\n  isLeftRoundedCorner(elem: Measurable): number {\n    return elem.type & this.LEFT_ROUND_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a right round corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a right round corner.\n   */\n  isRightRoundedCorner(elem: Measurable): number {\n    return elem.type & this.RIGHT_ROUND_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a left square corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a left square corner.\n   */\n  isLeftSquareCorner(elem: Measurable): number {\n    return elem.type & this.LEFT_SQUARE_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a right square corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a right square corner.\n   */\n  isRightSquareCorner(elem: Measurable): number {\n    return elem.type & this.RIGHT_SQUARE_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a corner.\n   */\n  isCorner(elem: Measurable): number {\n    return elem.type & this.CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a jagged edge.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a jagged edge.\n   */\n  isJaggedEdge(elem: Measurable): number {\n    return elem.type & this.JAGGED_EDGE;\n  }\n\n  /**\n   * Whether a measurable stores information about a row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a row.\n   */\n  isRow(row: Row): number {\n    return row.type & this.ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a between-row spacer.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a between-row spacer.\n   */\n  isBetweenRowSpacer(row: Row): number {\n    return row.type & this.BETWEEN_ROW_SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about a top row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a top row.\n   */\n  isTopRow(row: Row): number {\n    return row.type & this.TOP_ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a bottom row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a bottom row.\n   */\n  isBottomRow(row: Row): number {\n    return row.type & this.BOTTOM_ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a top or bottom row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a top or bottom row.\n   */\n  isTopOrBottomRow(row: Row): number {\n    return row.type & (this.TOP_ROW | this.BOTTOM_ROW);\n  }\n\n  /**\n   * Whether a measurable stores information about an input row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about an input row.\n   */\n  isInputRow(row: Row): number {\n    return row.type & this.INPUT_ROW;\n  }\n}\n\nexport const Types = new TypesContainer();\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Measurable\n\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Types} from './types.js';\n\n/**\n * The base class to represent a part of a block that takes up space during\n * rendering.  The constructor for each non-spacer Measurable records the size\n * of the block element (e.g. field, statement input).\n */\nexport class Measurable {\n  width = 0;\n\n  height = 0;\n  type: number;\n  xPos = 0;\n\n  centerline = 0;\n  notchOffset: number;\n\n  /** The renderer's constant provider. */\n  protected readonly constants_: ConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    this.constants_ = constants;\n\n    this.type = Types.NONE;\n\n    this.notchOffset = this.constants_.NOTCH_OFFSET_LEFT;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Row\n\nimport type {ConstantProvider} from '../common/constants.js';\nimport type {Measurable} from './base.js';\nimport type {InRowSpacer} from './in_row_spacer.js';\nimport type {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object representing a single row on a rendered block and all of its\n * subcomponents.\n */\nexport class Row {\n  type: number;\n\n  /**\n   * An array of elements contained in this row.\n   */\n  elements: Measurable[] = [];\n\n  /**\n   * The height of the row.\n   */\n  height = 0;\n\n  /**\n   * The width of the row, from the left edge of the block to the right.\n   * Does not include child blocks unless they are inline.\n   */\n  width = 0;\n\n  /**\n   * The minimum height of the row.\n   */\n  minHeight = 0;\n\n  /**\n   * The minimum width of the row, from the left edge of the block to the\n   * right. Does not include child blocks unless they are inline.\n   */\n  minWidth = 0;\n\n  /**\n   * The width of the row, from the left edge of the block to the edge of the\n   * block or any connected child blocks.\n   */\n  widthWithConnectedBlocks = 0;\n\n  /**\n   * The Y position of the row relative to the origin of the block's svg\n   * group.\n   */\n  yPos = 0;\n\n  /**\n   * The X position of the row relative to the origin of the block's svg\n   * group.\n   */\n  xPos = 0;\n\n  /**\n   * Whether the row has any external inputs.\n   */\n  hasExternalInput = false;\n\n  /**\n   * Whether the row has any statement inputs.\n   */\n  hasStatement = false;\n\n  /**\n   * Where the left edge of all of the statement inputs on the block should\n   * be. This makes sure that statement inputs which are proceded by fields\n   * of varius widths are all aligned.\n   */\n  statementEdge = 0;\n\n  /**\n   * Whether the row has any inline inputs.\n   */\n  hasInlineInput = false;\n\n  /**\n   * Whether the row has any dummy inputs or end-row inputs.\n   */\n  hasDummyInput = false;\n\n  /**\n   * Whether the row has a jagged edge.\n   */\n  hasJaggedEdge = false;\n  notchOffset: number;\n\n  /**\n   * Alignment of the row.\n   */\n  align: number | null = null;\n\n  protected readonly constants_: ConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    /** The renderer's constant provider. */\n    this.constants_ = constants;\n\n    /** The type of this rendering object. */\n    this.type = Types.ROW;\n\n    this.notchOffset = this.constants_.NOTCH_OFFSET_LEFT;\n  }\n\n  /**\n   * Get the last input on this row, if it has one.\n   *\n   * @returns The last input on the row, or null.\n   */\n  getLastInput(): InputConnection | null {\n    // TODO: Consider moving this to InputRow, if possible.\n    for (let i = this.elements.length - 1; i >= 0; i--) {\n      const elem = this.elements[i];\n      if (Types.isInput(elem)) {\n        return elem as InputConnection;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Inspect all subcomponents and populate all size properties on the row.\n   */\n  measure() {\n    throw Error('Unexpected attempt to measure a base Row.');\n  }\n\n  /**\n   * Determines whether this row should start with an element spacer.\n   *\n   * @returns Whether the row should start with a spacer.\n   */\n  startsWithElemSpacer(): boolean {\n    return true;\n  }\n\n  /**\n   * Determines whether this row should end with an element spacer.\n   *\n   * @returns Whether the row should end with a spacer.\n   */\n  endsWithElemSpacer(): boolean {\n    return true;\n  }\n\n  /**\n   * Convenience method to get the first spacer element on this row.\n   *\n   * @returns The first spacer element on this row.\n   */\n  getFirstSpacer(): InRowSpacer | null {\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      if (Types.isSpacer(elem)) {\n        return elem as InRowSpacer;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Convenience method to get the last spacer element on this row.\n   *\n   * @returns The last spacer element on this row.\n   */\n  getLastSpacer(): InRowSpacer | null {\n    for (let i = this.elements.length - 1; i >= 0; i--) {\n      const elem = this.elements[i];\n      if (Types.isSpacer(elem)) {\n        return elem as InRowSpacer;\n      }\n    }\n    return null;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.BottomRow\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport type {NextConnection} from './next_connection.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about what elements are in the bottom row of\n * a block as well as spacing information for the bottom row.\n * Elements in a bottom row can consist of corners, spacers and next\n * connections.\n */\nexport class BottomRow extends Row {\n  /**\n   * Whether this row has a next connection.\n   */\n  hasNextConnection = false;\n\n  /**\n   * The next connection on the row, if any.\n   */\n  connection: NextConnection | null = null;\n\n  /**\n   * The amount that the bottom of the block extends below the horizontal\n   * edge, e.g. because of a next connection.  Must be non-negative (see\n   * #2820).\n   */\n  descenderHeight = 0;\n\n  /**\n   * The Y position of the bottom edge of the block, relative to the origin\n   * of the block rendering.\n   */\n  baseline = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.BOTTOM_ROW;\n  }\n\n  /**\n   * Returns whether or not the bottom row has a left square corner.\n   *\n   * @param block The block whose bottom row this represents.\n   * @returns Whether or not the bottom row has a left square corner.\n   */\n  hasLeftSquareCorner(block: BlockSvg): boolean {\n    return !!block.outputConnection || !!block.getNextBlock();\n  }\n\n  /**\n   * Returns whether or not the bottom row has a right square corner.\n   *\n   * @param _block The block whose bottom row this represents.\n   * @returns Whether or not the bottom row has a right square corner.\n   */\n  hasRightSquareCorner(_block: BlockSvg): boolean {\n    return true;\n  }\n\n  override measure() {\n    let height = 0;\n    let width = 0;\n    let descenderHeight = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      width += elem.width;\n      if (!Types.isSpacer(elem)) {\n        // Note: this assumes that next connections have *only* descenderHeight,\n        // with no height above the baseline.\n        if (Types.isNextConnection(elem)) {\n          descenderHeight = Math.max(descenderHeight, elem.height);\n        } else {\n          height = Math.max(height, elem.height);\n        }\n      }\n    }\n    this.width = Math.max(this.minWidth, width);\n    this.height = Math.max(this.minHeight, height) + descenderHeight;\n    this.descenderHeight = descenderHeight;\n    this.widthWithConnectedBlocks = this.width;\n  }\n\n  override startsWithElemSpacer() {\n    return false;\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Connection\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider, Shape} from '../common/constants.js';\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * The base class to represent a connection and the space that it takes up on\n * the block.\n */\nexport class Connection extends Measurable {\n  shape: Shape;\n  isDynamicShape: boolean;\n  highlighted: boolean;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public connectionModel: RenderedConnection,\n  ) {\n    super(constants);\n\n    this.type |= Types.CONNECTION;\n\n    this.shape = this.constants_.shapeFor(connectionModel);\n    this.isDynamicShape = 'isDynamic' in this.shape && this.shape.isDynamic;\n\n    this.highlighted = connectionModel.isHighlighted();\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.InputConnection\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Input} from '../../inputs/input.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n/**\n * The base class to represent an input that takes up space on a block\n * during rendering.\n */\nexport class InputConnection extends Connection {\n  align: number;\n  connectedBlock: BlockSvg | null;\n  connectedBlockWidth: number;\n  connectedBlockHeight: number;\n  connectionOffsetX = 0;\n  connectionOffsetY = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The input to measure and store information for.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public input: Input,\n  ) {\n    super(constants, input.connection as RenderedConnection);\n\n    this.type |= Types.INPUT;\n\n    this.align = input.align;\n\n    this.connectedBlock =\n      input.connection && input.connection.targetBlock()\n        ? (input.connection.targetBlock() as BlockSvg)\n        : null;\n\n    if (this.connectedBlock) {\n      const bBox = this.connectedBlock.getHeightWidth();\n      this.connectedBlockWidth = bBox.width;\n      this.connectedBlockHeight = bBox.height;\n    } else {\n      this.connectedBlockWidth = 0;\n      this.connectedBlockHeight = 0;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.ExternalValueInput\n\nimport type {Input} from '../../inputs/input.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space an external value input\n * takes up during rendering\n */\nexport class ExternalValueInput extends InputConnection {\n  override height = 0;\n  override width: number;\n  override connectionOffsetY: number;\n  connectionHeight: number;\n  connectionWidth: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The external value input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.EXTERNAL_VALUE_INPUT;\n    if (!this.connectedBlock) {\n      this.height = this.shape.height as number;\n    } else {\n      this.height =\n        this.connectedBlockHeight -\n        this.constants_.TAB_OFFSET_FROM_TOP -\n        this.constants_.MEDIUM_PADDING;\n    }\n\n    this.width =\n      (this.shape.width as number) +\n      this.constants_.EXTERNAL_VALUE_INPUT_PADDING;\n\n    this.connectionOffsetY = this.constants_.TAB_OFFSET_FROM_TOP;\n\n    this.connectionHeight = this.shape.height as number;\n\n    this.connectionWidth = this.shape.width as number;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Field\n\nimport type {Field as BlocklyField} from '../../field.js';\nimport type {Input} from '../../inputs/input.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a field takes up during\n * rendering\n */\nexport class Field extends Measurable {\n  isEditable: boolean;\n  flipRtl: boolean;\n  override height: number;\n  override width: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param field The field to measure and store information for.\n   * @param parentInput The parent input for the field.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public field: BlocklyField,\n    public parentInput: Input,\n  ) {\n    super(constants);\n\n    this.isEditable = field.EDITABLE;\n\n    this.flipRtl = field.getFlipRtl();\n    this.type |= Types.FIELD;\n\n    const size = this.field.getSize();\n\n    this.height = size.height;\n\n    this.width = size.width;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Hat\n\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a hat takes up during\n * rendering.\n */\nexport class Hat extends Measurable {\n  ascenderHeight: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.HAT;\n\n    this.height = this.constants_.START_HAT.height;\n    this.width = this.constants_.START_HAT.width;\n\n    this.ascenderHeight = this.height;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Icon\n\nimport type {IIcon as BlocklyIcon} from '../../interfaces/i_icon.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space an icon takes up during\n * rendering.\n */\nexport class Icon extends Measurable {\n  flipRtl = false;\n\n  /**\n   * An object containing information about the space an icon takes up during\n   * rendering.\n   *\n   * @param constants The rendering constants provider.\n   * @param icon The icon to measure and store information for.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public icon: BlocklyIcon,\n  ) {\n    super(constants);\n\n    this.type |= Types.ICON;\n\n    const size = icon.getSize();\n    this.height = size.height;\n    this.width = size.width;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.InRowSpacer\n\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about a spacer between two elements on a\n * row.\n */\nexport class InRowSpacer extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param width The width of the spacer.\n   */\n  constructor(constants: ConstantProvider, width: number) {\n    super(constants);\n    this.type |= Types.SPACER | Types.IN_ROW_SPACER;\n    this.width = width;\n    this.height = this.constants_.SPACER_DEFAULT_HEIGHT;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.InlineInput\n\nimport type {Input} from '../../inputs/input.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space an inline input takes up\n * during rendering.\n */\nexport class InlineInput extends InputConnection {\n  connectionHeight: number;\n  connectionWidth: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The inline input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.INLINE_INPUT;\n\n    if (!this.connectedBlock) {\n      this.height = this.constants_.EMPTY_INLINE_INPUT_HEIGHT;\n      this.width = this.constants_.EMPTY_INLINE_INPUT_PADDING;\n    } else {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.width = this.connectedBlockWidth;\n      this.height = this.connectedBlockHeight;\n    }\n\n    this.connectionHeight = !this.isDynamicShape\n      ? (this.shape.height as number)\n      : (this.shape.height as (p1: number) => number)(this.height);\n\n    this.connectionWidth = !this.isDynamicShape\n      ? (this.shape.width as number)\n      : (this.shape.width as (p1: number) => number)(this.height);\n    if (!this.connectedBlock) {\n      this.width += this.connectionWidth * (this.isDynamicShape ? 2 : 1);\n    }\n\n    this.connectionOffsetY =\n      'connectionOffsetY' in this.shape\n        ? this.shape.connectionOffsetY(this.connectionHeight)\n        : this.constants_.TAB_OFFSET_FROM_TOP;\n\n    this.connectionOffsetX =\n      'connectionOffsetX' in this.shape\n        ? this.shape.connectionOffsetX(this.connectionWidth)\n        : 0;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.StatementInput\n\nimport type {Input} from '../../inputs/input.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering\n */\nexport class StatementInput extends InputConnection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.STATEMENT_INPUT;\n\n    if (!this.connectedBlock) {\n      this.height = this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT;\n    } else {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.height =\n        this.connectedBlockHeight + this.constants_.STATEMENT_BOTTOM_SPACER;\n    }\n    this.width =\n      this.constants_.STATEMENT_INPUT_NOTCH_OFFSET +\n      (this.shape.width as number);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.InputRow\n\nimport type {ConstantProvider} from '../common/constants.js';\nimport {ExternalValueInput} from './external_value_input.js';\nimport {InputConnection} from './input_connection.js';\nimport {Row} from './row.js';\nimport {StatementInput} from './statement_input.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about a row that holds one or more inputs.\n */\nexport class InputRow extends Row {\n  /**\n   * The total width of all blocks connected to this row.\n   */\n  connectedBlockWidths = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.INPUT_ROW;\n  }\n\n  /**\n   * Inspect all subcomponents and populate all size properties on the row.\n   */\n  override measure() {\n    this.width = this.minWidth;\n    this.height = this.minHeight;\n    let connectedBlockWidths = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      this.width += elem.width;\n      if (Types.isInput(elem) && elem instanceof InputConnection) {\n        if (Types.isStatementInput(elem) && elem instanceof StatementInput) {\n          connectedBlockWidths += elem.connectedBlockWidth;\n        } else if (\n          Types.isExternalInput(elem) &&\n          elem instanceof ExternalValueInput &&\n          elem.connectedBlockWidth !== 0\n        ) {\n          connectedBlockWidths +=\n            elem.connectedBlockWidth - elem.connectionWidth;\n        }\n      }\n      if (!Types.isSpacer(elem)) {\n        this.height = Math.max(this.height, elem.height);\n      }\n    }\n    this.connectedBlockWidths = connectedBlockWidths;\n    this.widthWithConnectedBlocks = this.width + connectedBlockWidths;\n  }\n\n  override endsWithElemSpacer() {\n    return !this.hasExternalInput && !this.hasStatement;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.JaggedEdge\n\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space the jagged edge of a\n * collapsed block takes up during rendering.\n */\nexport class JaggedEdge extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.JAGGED_EDGE;\n    this.height = this.constants_.JAGGED_TEETH.height;\n    this.width = this.constants_.JAGGED_TEETH.width;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.NextConnection\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a next connection takes\n * up during rendering.\n */\nexport class NextConnection extends Connection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n    constants: ConstantProvider,\n    connectionModel: RenderedConnection,\n  ) {\n    super(constants, connectionModel);\n    this.type |= Types.NEXT_CONNECTION;\n    this.height = this.shape.height as number;\n    this.width = this.shape.width as number;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.OutputConnection\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space an output connection takes\n * up during rendering.\n */\nexport class OutputConnection extends Connection {\n  startX: number;\n  connectionOffsetY: number;\n  connectionOffsetX = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n    constants: ConstantProvider,\n    connectionModel: RenderedConnection,\n  ) {\n    super(constants, connectionModel);\n    this.type |= Types.OUTPUT_CONNECTION;\n\n    this.height = !this.isDynamicShape ? (this.shape.height as number) : 0;\n    this.width = !this.isDynamicShape ? (this.shape.width as number) : 0;\n\n    this.startX = this.width;\n\n    this.connectionOffsetY = this.constants_.TAB_OFFSET_FROM_TOP;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.PreviousConnection\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a previous connection takes\n * up during rendering.\n */\nexport class PreviousConnection extends Connection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n    constants: ConstantProvider,\n    connectionModel: RenderedConnection,\n  ) {\n    super(constants, connectionModel);\n    this.type |= Types.PREVIOUS_CONNECTION;\n    this.height = this.shape.height as number;\n    this.width = this.shape.width as number;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.RoundCorner\n\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a rounded corner takes up\n * during rendering.\n */\nexport class RoundCorner extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param opt_position The position of this corner.\n   */\n  constructor(constants: ConstantProvider, opt_position?: string) {\n    super(constants);\n    this.type =\n      (!opt_position || opt_position === 'left'\n        ? Types.LEFT_ROUND_CORNER\n        : Types.RIGHT_ROUND_CORNER) | Types.CORNER;\n    this.width = this.constants_.CORNER_RADIUS;\n    // The rounded corner extends into the next row by 4 so we only take the\n    // height that is aligned with this row.\n    this.height = this.constants_.CORNER_RADIUS / 2;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.SpacerRow\n\nimport type {ConstantProvider} from '../common/constants.js';\nimport {InRowSpacer} from './in_row_spacer.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about a spacer between two rows.\n */\nexport class SpacerRow extends Row {\n  followsStatement = false;\n\n  precedesStatement = false;\n\n  override widthWithConnectedBlocks = 0;\n  override elements: InRowSpacer[];\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param height The height of the spacer.\n   * @param width The width of the spacer.\n   */\n  constructor(\n    constants: ConstantProvider,\n    public override height: number,\n    public override width: number,\n  ) {\n    super(constants);\n    this.type |= Types.SPACER | Types.BETWEEN_ROW_SPACER;\n\n    this.elements = [new InRowSpacer(this.constants_, width)];\n  }\n\n  override measure() {}\n}\n// NOP.  Width and height were set at creation.\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.SquareCorner\n\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about the space a square corner takes up\n * during rendering.\n */\nexport class SquareCorner extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param opt_position The position of this corner.\n   */\n  constructor(constants: ConstantProvider, opt_position?: string) {\n    super(constants);\n    this.type =\n      (!opt_position || opt_position === 'left'\n        ? Types.LEFT_SQUARE_CORNER\n        : Types.RIGHT_SQUARE_CORNER) | Types.CORNER;\n    this.height = this.constants_.NO_PADDING;\n    this.width = this.constants_.NO_PADDING;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.TopRow\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport {Hat} from './hat.js';\nimport type {PreviousConnection} from './previous_connection.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n/**\n * An object containing information about what elements are in the top row of a\n * block as well as sizing information for the top row.\n * Elements in a top row can consist of corners, hats, spacers, and previous\n * connections.\n * After this constructor is called, the row will contain all non-spacer\n * elements it needs.\n */\nexport class TopRow extends Row {\n  /**\n   * The starting point for drawing the row, in the y direction.\n   * This allows us to draw hats and similar shapes that don't start at the\n   * origin. Must be non-negative (see #2820).\n   */\n  capline = 0;\n\n  /** How much the row extends up above its capline. */\n  ascenderHeight = 0;\n\n  /** Whether the block has a previous connection. */\n  hasPreviousConnection = false;\n\n  /** The previous connection on the block, if any. */\n  connection: PreviousConnection | null = null;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n\n    this.type |= Types.TOP_ROW;\n  }\n\n  /**\n   * Returns whether or not the top row has a left square corner.\n   *\n   * @param block The block whose top row this represents.\n   * @returns Whether or not the top row has a left square corner.\n   */\n  hasLeftSquareCorner(block: BlockSvg): boolean {\n    const hasHat =\n      (block.hat ? block.hat === 'cap' : this.constants_.ADD_START_HATS) &&\n      !block.outputConnection &&\n      !block.previousConnection;\n    const prevBlock = block.getPreviousBlock();\n\n    return (\n      !!block.outputConnection ||\n      hasHat ||\n      (prevBlock ? prevBlock.getNextBlock() === block : false)\n    );\n  }\n\n  /**\n   * Returns whether or not the top row has a right square corner.\n   *\n   * @param _block The block whose top row this represents.\n   * @returns Whether or not the top row has a right square corner.\n   */\n  hasRightSquareCorner(_block: BlockSvg): boolean {\n    return true;\n  }\n\n  override measure() {\n    let height = 0;\n    let width = 0;\n    let ascenderHeight = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      width += elem.width;\n      if (!Types.isSpacer(elem)) {\n        if (Types.isHat(elem) && elem instanceof Hat) {\n          ascenderHeight = Math.max(ascenderHeight, elem.ascenderHeight);\n        } else {\n          height = Math.max(height, elem.height);\n        }\n      }\n    }\n    this.width = Math.max(this.minWidth, width);\n    this.height = Math.max(this.minHeight, height) + ascenderHeight;\n    this.ascenderHeight = ascenderHeight;\n    this.capline = this.ascenderHeight;\n    this.widthWithConnectedBlocks = this.width;\n  }\n\n  override startsWithElemSpacer() {\n    return false;\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Drawer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {Coordinate} from '../../utils.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport {Connection} from '../measurables/connection.js';\nimport type {ExternalValueInput} from '../measurables/external_value_input.js';\nimport type {Field} from '../measurables/field.js';\nimport type {Icon} from '../measurables/icon.js';\nimport type {InlineInput} from '../measurables/inline_input.js';\nimport type {PreviousConnection} from '../measurables/previous_connection.js';\nimport type {Row} from '../measurables/row.js';\nimport {Types} from '../measurables/types.js';\nimport type {ConstantProvider, Notch, PuzzleTab} from './constants.js';\nimport {isDynamicShape, isNotch, isPuzzleTab} from './constants.js';\nimport type {RenderInfo} from './info.js';\n\n/**\n * An object that draws a block based on the given rendering information.\n */\nexport class Drawer {\n  block_: BlockSvg;\n  info_: RenderInfo;\n  topLeft_: Coordinate;\n  outlinePath_ = '';\n  inlinePath_ = '';\n  protected constants_: ConstantProvider;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    this.block_ = block;\n    this.info_ = info;\n    this.topLeft_ = block.getRelativeToSurfaceXY();\n\n    /** The renderer's constant provider. */\n    this.constants_ = info.getRenderer().getConstants();\n  }\n\n  /**\n   * Draw the block to the workspace. Here \"drawing\" means setting SVG path\n   * elements and moving fields, icons, and connections on the screen.\n   *\n   * The pieces of the paths are pushed into arrays of \"steps\", which are then\n   * joined with spaces and set directly on the block.  This guarantees that\n   * the steps are separated by spaces for improved readability, but isn't\n   * required.\n   */\n  draw() {\n    this.drawOutline_();\n    this.drawInternals_();\n    this.updateConnectionHighlights();\n\n    this.block_.pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    if (this.info_.RTL) {\n      this.block_.pathObject.flipRTL();\n    }\n    this.recordSizeOnBlock_();\n  }\n\n  /**\n   * Save sizing information back to the block\n   * Most of the rendering information can be thrown away at the end of the\n   * render. Anything that needs to be kept around should be set in this\n   * function.\n   */\n  protected recordSizeOnBlock_() {\n    // This is used when the block is reporting its size to anyone else.\n    // The dark path adds to the size of the block in both X and Y.\n    this.block_.height = this.info_.height;\n    this.block_.width = this.info_.widthWithChildren;\n    this.block_.childlessWidth = this.info_.width;\n  }\n\n  /** Create the outline of the block.  This is a single continuous path. */\n  protected drawOutline_() {\n    this.drawTop_();\n    for (let r = 1; r < this.info_.rows.length - 1; r++) {\n      const row = this.info_.rows[r];\n      if (row.hasJaggedEdge) {\n        this.drawJaggedEdge_(row);\n      } else if (row.hasStatement) {\n        this.drawStatementInput_(row);\n      } else if (row.hasExternalInput) {\n        this.drawValueInput_(row);\n      } else {\n        this.drawRightSideRow_(row);\n      }\n    }\n    this.drawBottom_();\n    this.drawLeft_();\n  }\n\n  /**\n   * Add steps for the top corner of the block, taking into account\n   * details such as hats and rounded corners.\n   */\n  protected drawTop_() {\n    const topRow = this.info_.topRow;\n    const elements = topRow.elements;\n\n    this.positionPreviousConnection_();\n    this.outlinePath_ += svgPaths.moveBy(topRow.xPos, this.info_.startY);\n    for (let i = 0, elem; (elem = elements[i]); i++) {\n      if (Types.isLeftRoundedCorner(elem)) {\n        this.outlinePath_ += this.constants_.OUTSIDE_CORNERS.topLeft;\n      } else if (Types.isRightRoundedCorner(elem)) {\n        this.outlinePath_ += this.constants_.OUTSIDE_CORNERS.topRight;\n      } else if (\n        Types.isPreviousConnection(elem) &&\n        elem instanceof Connection\n      ) {\n        this.outlinePath_ += (\n          (elem as PreviousConnection).shape as Notch\n        ).pathLeft;\n      } else if (Types.isHat(elem)) {\n        this.outlinePath_ += this.constants_.START_HAT.path;\n      } else if (Types.isSpacer(elem)) {\n        this.outlinePath_ += svgPaths.lineOnAxis('h', elem.width);\n      }\n    }\n    // No branch for a square corner, because it's a no-op.\n    this.outlinePath_ += svgPaths.lineOnAxis('v', topRow.height);\n  }\n\n  /**\n   * Add steps for the jagged edge of a row on a collapsed block.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected drawJaggedEdge_(row: Row) {\n    const remainder = row.height - this.constants_.JAGGED_TEETH.height;\n    this.outlinePath_ +=\n      this.constants_.JAGGED_TEETH.path + svgPaths.lineOnAxis('v', remainder);\n  }\n\n  /**\n   * Add steps for an external value input, rendered as a notch in the side\n   * of the block.\n   *\n   * @param row The row that this input belongs to.\n   */\n  protected drawValueInput_(row: Row) {\n    const input = row.getLastInput() as ExternalValueInput | InlineInput;\n    this.positionExternalValueConnection_(row);\n\n    const pathDown = isDynamicShape(input.shape)\n      ? input.shape.pathDown(input.height)\n      : (input.shape as PuzzleTab).pathDown;\n\n    this.outlinePath_ +=\n      svgPaths.lineOnAxis('H', input.xPos + input.width) +\n      pathDown +\n      svgPaths.lineOnAxis('v', row.height - input.connectionHeight);\n  }\n\n  /**\n   * Add steps for a statement input.\n   *\n   * @param row The row that this input belongs to.\n   */\n  protected drawStatementInput_(row: Row) {\n    const input = row.getLastInput();\n    if (!input) return;\n    // Where to start drawing the notch, which is on the right side in LTR.\n    const x = input.xPos + input.notchOffset + (input.shape as Notch).width;\n\n    const innerTopLeftCorner =\n      (input.shape as Notch).pathRight +\n      svgPaths.lineOnAxis(\n        'h',\n        -(input.notchOffset - this.constants_.INSIDE_CORNERS.width),\n      ) +\n      this.constants_.INSIDE_CORNERS.pathTop;\n\n    const innerHeight = row.height - 2 * this.constants_.INSIDE_CORNERS.height;\n\n    this.outlinePath_ +=\n      svgPaths.lineOnAxis('H', x) +\n      innerTopLeftCorner +\n      svgPaths.lineOnAxis('v', innerHeight) +\n      this.constants_.INSIDE_CORNERS.pathBottom +\n      svgPaths.lineOnAxis('H', row.xPos + row.width);\n\n    this.positionStatementInputConnection_(row);\n  }\n\n  /**\n   * Add steps for the right side of a row that does not have value or\n   * statement input connections.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected drawRightSideRow_(row: Row) {\n    this.outlinePath_ += svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  /**\n   * Add steps for the bottom edge of a block, possibly including a notch\n   * for the next connection.\n   */\n  protected drawBottom_() {\n    const bottomRow = this.info_.bottomRow;\n    const elems = bottomRow.elements;\n    this.positionNextConnection_();\n\n    let rightCornerYOffset = 0;\n    let outlinePath = '';\n    for (let i = elems.length - 1, elem; (elem = elems[i]); i--) {\n      if (Types.isNextConnection(elem) && elem instanceof Connection) {\n        outlinePath += (elem.shape as Notch).pathRight;\n      } else if (Types.isLeftSquareCorner(elem)) {\n        outlinePath += svgPaths.lineOnAxis('H', bottomRow.xPos);\n      } else if (Types.isLeftRoundedCorner(elem)) {\n        outlinePath += this.constants_.OUTSIDE_CORNERS.bottomLeft;\n      } else if (Types.isRightRoundedCorner(elem)) {\n        outlinePath += this.constants_.OUTSIDE_CORNERS.bottomRight;\n        rightCornerYOffset = this.constants_.OUTSIDE_CORNERS.rightHeight;\n      } else if (Types.isSpacer(elem)) {\n        outlinePath += svgPaths.lineOnAxis('h', elem.width * -1);\n      }\n    }\n\n    this.outlinePath_ += svgPaths.lineOnAxis(\n      'V',\n      bottomRow.baseline - rightCornerYOffset,\n    );\n    this.outlinePath_ += outlinePath;\n  }\n\n  /**\n   * Add steps for the left side of the block, which may include an output\n   * connection\n   */\n  protected drawLeft_() {\n    const outputConnection = this.info_.outputConnection;\n    this.positionOutputConnection_();\n\n    if (outputConnection) {\n      const tabBottom =\n        outputConnection.connectionOffsetY + outputConnection.height;\n      const pathUp = isDynamicShape(outputConnection.shape)\n        ? outputConnection.shape.pathUp(outputConnection.height)\n        : (outputConnection.shape as PuzzleTab).pathUp;\n\n      // Draw a line up to the bottom of the tab.\n      this.outlinePath_ += svgPaths.lineOnAxis('V', tabBottom) + pathUp;\n    }\n    // Close off the path.  This draws a vertical line up to the start of the\n    // block's path, which may be either a rounded or a sharp corner.\n    this.outlinePath_ += 'z';\n  }\n\n  /**\n   * Draw the internals of the block: inline inputs, fields, and icons.  These\n   * do not depend on the outer path for placement.\n   */\n  protected drawInternals_() {\n    for (let i = 0, row; (row = this.info_.rows[i]); i++) {\n      for (let j = 0, elem; (elem = row.elements[j]); j++) {\n        if (Types.isInlineInput(elem)) {\n          this.drawInlineInput_(elem as InlineInput);\n        } else if (Types.isIcon(elem) || Types.isField(elem)) {\n          this.layoutField_(elem as Field | Icon);\n        }\n      }\n    }\n  }\n\n  /**\n   * Push a field or icon's new position to its SVG root.\n   *\n   * @param fieldInfo The rendering information for the field or icon.\n   */\n  protected layoutField_(fieldInfo: Icon | Field) {\n    const yPos = fieldInfo.centerline - fieldInfo.height / 2;\n    let xPos = fieldInfo.xPos;\n    let scale = '';\n    if (this.info_.RTL) {\n      xPos = -(xPos + fieldInfo.width);\n      if (fieldInfo.flipRtl) {\n        xPos += fieldInfo.width;\n        scale = 'scale(-1 1)';\n      }\n    }\n\n    if (Types.isIcon(fieldInfo)) {\n      const icon = (fieldInfo as Icon).icon;\n      icon.setOffsetInBlock(new Coordinate(xPos, yPos));\n      if (this.info_.isInsertionMarker) {\n        icon.hideForInsertionMarker();\n      }\n    } else {\n      const svgGroup = (fieldInfo as Field).field.getSvgRoot()!;\n      svgGroup.setAttribute(\n        'transform',\n        'translate(' + xPos + ',' + yPos + ')' + scale,\n      );\n      if (this.info_.isInsertionMarker) {\n        svgGroup.setAttribute('display', 'none');\n      }\n    }\n  }\n\n  /**\n   * Add steps for an inline input.\n   *\n   * @param input The information about the input to render.\n   */\n  protected drawInlineInput_(input: InlineInput) {\n    const width = input.width;\n    const height = input.height;\n    const yPos = input.centerline - height / 2;\n\n    const connectionTop = input.connectionOffsetY;\n    const connectionBottom = input.connectionHeight + connectionTop;\n    const connectionRight = input.xPos + input.connectionWidth;\n\n    this.inlinePath_ +=\n      svgPaths.moveTo(connectionRight, yPos) +\n      svgPaths.lineOnAxis('v', connectionTop) +\n      (input.shape as PuzzleTab).pathDown +\n      svgPaths.lineOnAxis('v', height - connectionBottom) +\n      svgPaths.lineOnAxis('h', width - input.connectionWidth) +\n      svgPaths.lineOnAxis('v', -height) +\n      'z';\n\n    this.positionInlineInputConnection_(input);\n  }\n\n  /**\n   * Position the connection on an inline value input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param input The information about the input that the connection is on.\n   */\n  protected positionInlineInputConnection_(input: InlineInput) {\n    const yPos = input.centerline - input.height / 2;\n    // Move the connection.\n    if (input.connectionModel) {\n      // xPos already contains info about startX\n      let connX = input.xPos + input.connectionWidth + input.connectionOffsetX;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(\n        connX,\n        yPos + input.connectionOffsetY,\n      );\n    }\n  }\n\n  /**\n   * Position the connection on a statement input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param row The row that the connection is on.\n   */\n  protected positionStatementInputConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input?.connectionModel) {\n      let connX = row.xPos + row.statementEdge + input.notchOffset;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  /**\n   * Position the connection on an external value input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param row The row that the connection is on.\n   */\n  protected positionExternalValueConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input && input.connectionModel) {\n      let connX = row.xPos + row.width;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  /** Position the previous connection on a block. */\n  protected positionPreviousConnection_() {\n    const topRow = this.info_.topRow;\n    if (topRow.connection) {\n      const x = topRow.xPos + topRow.notchOffset;\n      const connX = this.info_.RTL ? -x : x;\n      topRow.connection.connectionModel.setOffsetInBlock(connX, 0);\n    }\n  }\n\n  /** Position the next connection on a block. */\n  protected positionNextConnection_() {\n    const bottomRow = this.info_.bottomRow;\n\n    if (bottomRow.connection) {\n      const connInfo = bottomRow.connection;\n      const x = connInfo.xPos; // Already contains info about startX.\n      const connX = this.info_.RTL ? -x : x;\n      connInfo.connectionModel.setOffsetInBlock(connX, bottomRow.baseline);\n    }\n  }\n\n  /** Position the output connection on a block. */\n  protected positionOutputConnection_() {\n    if (this.info_.outputConnection) {\n      const x =\n        this.info_.startX + this.info_.outputConnection.connectionOffsetX;\n      const connX = this.info_.RTL ? -x : x;\n      this.block_.outputConnection.setOffsetInBlock(\n        connX,\n        this.info_.outputConnection.connectionOffsetY,\n      );\n    }\n  }\n\n  /**\n   * Updates the path object to reflect which connections on the block are\n   * highlighted.\n   */\n  protected updateConnectionHighlights() {\n    for (const row of this.info_.rows) {\n      for (const elem of row.elements) {\n        if (!(elem instanceof Connection)) continue;\n\n        if (elem.highlighted) {\n          this.drawConnectionHighlightPath(elem);\n        } else {\n          this.block_.pathObject.removeConnectionHighlight?.(\n            elem.connectionModel,\n          );\n        }\n      }\n    }\n  }\n\n  /** Returns a path to highlight the given connection. */\n  drawConnectionHighlightPath(measurable: Connection) {\n    const conn = measurable.connectionModel;\n    let path = '';\n    if (\n      conn.type === ConnectionType.INPUT_VALUE ||\n      conn.type === ConnectionType.OUTPUT_VALUE\n    ) {\n      path = this.getExpressionConnectionHighlightPath(measurable);\n    } else {\n      path = this.getStatementConnectionHighlightPath(measurable);\n    }\n    const block = conn.getSourceBlock();\n    block.pathObject.addConnectionHighlight?.(\n      conn,\n      path,\n      conn.getOffsetInBlock(),\n      block.RTL,\n    );\n  }\n\n  /**\n   * Returns a path to highlight the given conneciton, assuming it is an\n   * input or output connection.\n   */\n  private getExpressionConnectionHighlightPath(connection: Connection): string {\n    let connPath = '';\n    if (isDynamicShape(connection.shape)) {\n      connPath = connection.shape.pathDown(connection.height);\n    } else if (isPuzzleTab(connection.shape)) {\n      connPath = connection.shape.pathDown;\n    }\n\n    // We are assuming that there is room for the tab offset above and below\n    // the tab.\n    const yLen = this.constants_.TAB_OFFSET_FROM_TOP;\n    return (\n      svgPaths.moveBy(0, -yLen) +\n      svgPaths.lineOnAxis('v', yLen) +\n      connPath +\n      svgPaths.lineOnAxis('v', yLen)\n    );\n  }\n\n  /**\n   * Returns a path to highlight the given conneciton, assuming it is a\n   * next or previous connection.\n   */\n  private getStatementConnectionHighlightPath(connection: Connection): string {\n    if (!isNotch(connection.shape)) {\n      throw new Error('Statement connections should have notch shapes');\n    }\n\n    const xLen =\n      this.constants_.NOTCH_OFFSET_LEFT - this.constants_.CORNER_RADIUS;\n    return (\n      svgPaths.moveBy(-xLen, 0) +\n      svgPaths.lineOnAxis('h', xLen) +\n      connection.shape.pathLeft +\n      svgPaths.lineOnAxis('h', xLen)\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Enum for alignment of inputs.\n */\nexport enum Align {\n  LEFT = -1,\n  CENTRE = 0,\n  RIGHT = 1,\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Non-editable, non-serializable text field.  Used for titles,\n *    labels, etc.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldLabel\n\nimport {Field, FieldConfig} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for a non-editable, non-serializable text field.\n */\nexport class FieldLabel extends Field<string> {\n  /** The HTML class name to use for this field. */\n  private class: string | null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override EDITABLE = false;\n\n  /** Text labels should not truncate. */\n  override maxDisplayLength = Infinity;\n\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param textClass Optional CSS class for the field's text.\n   * @param config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/label#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | typeof Field.SKIP_SETUP,\n    textClass?: string,\n    config?: FieldLabelConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.class = textClass || null;\n    }\n    this.setValue(value);\n  }\n\n  protected override configure_(config: FieldLabelConfig) {\n    super.configure_(config);\n    if (config.class) this.class = config.class;\n  }\n\n  /**\n   * Create block UI for this label.\n   */\n  override initView() {\n    this.createTextElement_();\n    if (this.class) {\n      dom.addClass(this.getTextElement(), this.class);\n    }\n  }\n\n  /**\n   * Ensure that the input value casts to a valid string.\n   *\n   * @param newValue The input value.\n   * @returns A valid string, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): string | null {\n    if (newValue === null || newValue === undefined) {\n      return null;\n    }\n    return `${newValue}`;\n  }\n\n  /**\n   * Set the CSS class applied to the field's textElement_.\n   *\n   * @param cssClass The new CSS class name, or null to remove.\n   */\n  setClass(cssClass: string | null) {\n    if (this.textElement_) {\n      if (this.class) {\n        dom.removeClass(this.textElement_, this.class);\n      }\n      if (cssClass) {\n        dom.addClass(this.textElement_, cssClass);\n      }\n    }\n    this.class = cssClass;\n  }\n\n  /**\n   * Construct a FieldLabel from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and class).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(options: FieldLabelFromJsonConfig): FieldLabel {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldLabel if that class doesn't override\n    // the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_label', FieldLabel);\n\nFieldLabel.prototype.DEFAULT_VALUE = '';\n\n// clang-format off\n// Clang does not like the 'class' keyword being used as a property.\n/**\n * Config options for the label field.\n */\nexport interface FieldLabelConfig extends FieldConfig {\n  class?: string;\n}\n// clang-format on\n\n/**\n * fromJson config options for the label field.\n */\nexport interface FieldLabelFromJsonConfig extends FieldLabelConfig {\n  text?: string;\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing an input (value, statement, or dummy).\n *\n * @class\n */\n// Former goog.module ID: Blockly.Input\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport '../field_label.js';\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport type {Connection} from '../connection.js';\nimport type {ConnectionType} from '../connection_type.js';\nimport type {Field} from '../field.js';\nimport * as fieldRegistry from '../field_registry.js';\nimport type {RenderedConnection} from '../rendered_connection.js';\nimport {Align} from './align.js';\nimport {inputTypes} from './input_types.js';\n\n/** Class for an input with optional fields. */\nexport class Input {\n  fieldRow: Field[] = [];\n  /** Alignment of input's fields (left, right or centre). */\n  align = Align.LEFT;\n\n  /** Is the input visible? */\n  private visible = true;\n\n  public readonly type: inputTypes = inputTypes.CUSTOM;\n\n  public connection: Connection | null = null;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param sourceBlock The block containing this input.\n   */\n  constructor(\n    public name: string,\n    private sourceBlock: Block,\n  ) {}\n\n  /**\n   * Get the source block for this input.\n   *\n   * @returns The block this input is part of.\n   */\n  getSourceBlock(): Block {\n    return this.sourceBlock;\n  }\n\n  /**\n   * Add a field (or label from string), and all prefix and suffix fields, to\n   * the end of the input's field row.\n   *\n   * @param field Something to add as a field.\n   * @param opt_name Language-neutral identifier which may used to find this\n   *     field again.  Should be unique to the host block.\n   * @returns The input being append to (to allow chaining).\n   */\n  appendField<T>(field: string | Field<T>, opt_name?: string): Input {\n    this.insertFieldAt(this.fieldRow.length, field, opt_name);\n    return this;\n  }\n\n  /**\n   * Inserts a field (or label from string), and all prefix and suffix fields,\n   * at the location of the input's field row.\n   *\n   * @param index The index at which to insert field.\n   * @param field Something to add as a field.\n   * @param opt_name Language-neutral identifier which may used to find this\n   *     field again.  Should be unique to the host block.\n   * @returns The index following the last inserted field.\n   */\n  insertFieldAt<T>(\n    index: number,\n    field: string | Field<T>,\n    opt_name?: string,\n  ): number {\n    if (index < 0 || index > this.fieldRow.length) {\n      throw Error('index ' + index + ' out of bounds.');\n    }\n    // Falsy field values don't generate a field, unless the field is an empty\n    // string and named.\n    if (!field && !(field === '' && opt_name)) {\n      return index;\n    }\n\n    // Generate a FieldLabel when given a plain text field.\n    if (typeof field === 'string') {\n      field = fieldRegistry.fromJson({\n        type: 'field_label',\n        text: field,\n      })!;\n    }\n\n    field.setSourceBlock(this.sourceBlock);\n    if (this.sourceBlock.initialized) this.initField(field);\n    field.name = opt_name;\n    field.setVisible(this.isVisible());\n\n    if (field.prefixField) {\n      // Add any prefix.\n      index = this.insertFieldAt(index, field.prefixField);\n    }\n    // Add the field to the field row.\n    this.fieldRow.splice(index, 0, field as Field);\n    index++;\n    if (field.suffixField) {\n      // Add any suffix.\n      index = this.insertFieldAt(index, field.suffixField);\n    }\n\n    if (this.sourceBlock.rendered) {\n      (this.sourceBlock as BlockSvg).queueRender();\n    }\n    return index;\n  }\n\n  /**\n   * Remove a field from this input.\n   *\n   * @param name The name of the field.\n   * @param opt_quiet True to prevent an error if field is not present.\n   * @returns True if operation succeeds, false if field is not present and\n   *     opt_quiet is true.\n   * @throws {Error} if the field is not present and opt_quiet is false.\n   */\n  removeField(name: string, opt_quiet?: boolean): boolean {\n    for (let i = 0, field; (field = this.fieldRow[i]); i++) {\n      if (field.name === name) {\n        field.dispose();\n        this.fieldRow.splice(i, 1);\n        if (this.sourceBlock.rendered) {\n          (this.sourceBlock as BlockSvg).queueRender();\n        }\n        return true;\n      }\n    }\n    if (opt_quiet) {\n      return false;\n    }\n    throw Error('Field \"' + name + '\" not found.');\n  }\n\n  /**\n   * Gets whether this input is visible or not.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.visible;\n  }\n\n  /**\n   * Sets whether this input is visible or not.\n   * Should only be used to collapse/uncollapse a block.\n   *\n   * @param visible True if visible.\n   * @returns List of blocks to render.\n   * @internal\n   */\n  setVisible(visible: boolean): BlockSvg[] {\n    // Note: Currently there are only unit tests for block.setCollapsed()\n    // because this function is package. If this function goes back to being a\n    // public API tests (lots of tests) should be added.\n    let renderList: AnyDuringMigration[] = [];\n    if (this.visible === visible) {\n      return renderList;\n    }\n    this.visible = visible;\n\n    for (let y = 0, field; (field = this.fieldRow[y]); y++) {\n      field.setVisible(visible);\n    }\n    if (this.connection) {\n      const renderedConnection = this.connection as RenderedConnection;\n      // Has a connection.\n      if (visible) {\n        renderList = renderedConnection.startTrackingAll();\n      } else {\n        renderedConnection.stopTrackingAll();\n      }\n      const child = renderedConnection.targetBlock();\n      if (child) {\n        child.getSvgRoot().style.display = visible ? 'block' : 'none';\n      }\n    }\n    return renderList;\n  }\n\n  /**\n   * Mark all fields on this input as dirty.\n   *\n   * @internal\n   */\n  markDirty() {\n    for (let y = 0, field; (field = this.fieldRow[y]); y++) {\n      field.markDirty();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   *\n   * @param check Compatible value type or list of value types.  Null if all\n   *     types are compatible.\n   * @returns The input being modified (to allow chaining).\n   */\n  setCheck(check: string | string[] | null): Input {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    this.connection.setCheck(check);\n    return this;\n  }\n\n  /**\n   * Change the alignment of the connection's field(s).\n   *\n   * @param align One of the values of Align.  In RTL mode directions\n   *     are reversed, and Align.RIGHT aligns to the left.\n   * @returns The input being modified (to allow chaining).\n   */\n  setAlign(align: Align): Input {\n    this.align = align;\n    if (this.sourceBlock.rendered) {\n      const sourceBlock = this.sourceBlock as BlockSvg;\n      sourceBlock.queueRender();\n    }\n    return this;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadow DOM representation of a block or null.\n   * @returns The input being modified (to allow chaining).\n   */\n  setShadowDom(shadow: Element | null): Input {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    this.connection.setShadowDom(shadow);\n    return this;\n  }\n\n  /**\n   * Returns the XML representation of the connection's shadow block.\n   *\n   * @returns Shadow DOM representation of a block or null.\n   */\n  getShadowDom(): Element | null {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    return this.connection.getShadowDom();\n  }\n\n  /** Initialize the fields on this input. */\n  init() {\n    for (const field of this.fieldRow) {\n      field.init();\n    }\n  }\n\n  /**\n   * Initializes the fields on this input for a headless block.\n   *\n   * @internal\n   */\n  public initModel() {\n    for (const field of this.fieldRow) {\n      field.initModel();\n    }\n  }\n\n  /** Initializes the given field. */\n  private initField(field: Field) {\n    if (this.sourceBlock.rendered) {\n      field.init();\n    } else {\n      field.initModel();\n    }\n  }\n\n  /**\n   * Sever all links to this input.\n   */\n  dispose() {\n    for (let i = 0, field; (field = this.fieldRow[i]); i++) {\n      field.dispose();\n    }\n    if (this.connection) {\n      this.connection.dispose();\n    }\n  }\n\n  /**\n   * Constructs a connection based on the type of this input's source block.\n   * Properly handles constructing headless connections for headless blocks\n   * and rendered connections for rendered blocks.\n   *\n   * @returns a connection of the given type, which is either a headless\n   *     or rendered connection, based on the type of this input's source block.\n   */\n  protected makeConnection(type: ConnectionType): Connection {\n    return this.sourceBlock.makeConnection_(type);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport {Input} from './input.js';\nimport {inputTypes} from './input_types.js';\n\n/** Represents an input on a block with no connection. */\nexport class DummyInput extends Input {\n  readonly type = inputTypes.DUMMY;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   */\n  constructor(\n    public name: string,\n    block: Block,\n  ) {\n    super(name, block);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport {Input} from './input.js';\nimport {inputTypes} from './input_types.js';\n\n/**\n * Represents an input on a block that is always the last input in the row. Any\n * following input will be rendered on the next row even if the block has inline\n * inputs. Any newline character in a JSON block definition's message will\n * automatically be parsed as an end-row input.\n */\nexport class EndRowInput extends Input {\n  readonly type = inputTypes.END_ROW;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   */\n  constructor(\n    public name: string,\n    block: Block,\n  ) {\n    super(name, block);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport type {Connection} from '../connection.js';\nimport {ConnectionType} from '../connection_type.js';\nimport {Input} from './input.js';\nimport {inputTypes} from './input_types.js';\n\n/** Represents an input on a block with a statement connection. */\nexport class StatementInput extends Input {\n  readonly type = inputTypes.STATEMENT;\n\n  public connection: Connection;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   */\n  constructor(\n    public name: string,\n    block: Block,\n  ) {\n    // Errors are maintained for people not using typescript.\n    if (!name) throw new Error('Statement inputs must have a non-empty name');\n\n    super(name, block);\n    this.connection = this.makeConnection(ConnectionType.NEXT_STATEMENT);\n  }\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport {ConnectionType} from '../connection_type.js';\nimport {Input} from './input.js';\nimport {inputTypes} from './input_types.js';\n\n/** Represents an input on a block with a value connection. */\nexport class ValueInput extends Input {\n  readonly type = inputTypes.VALUE;\n\n  /**\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   */\n  constructor(\n    public name: string,\n    block: Block,\n  ) {\n    // Errors are maintained for people not using typescript.\n    if (!name) throw new Error('Value inputs must have a non-empty name');\n    super(name, block);\n    this.connection = this.makeConnection(ConnectionType.INPUT_VALUE);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Align} from '../../inputs/align.js';\nimport {DummyInput} from '../../inputs/dummy_input.js';\nimport {EndRowInput} from '../../inputs/end_row_input.js';\nimport {Input} from '../../inputs/input.js';\nimport {StatementInput} from '../../inputs/statement_input.js';\nimport {ValueInput} from '../../inputs/value_input.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {Measurable} from '../measurables/base.js';\nimport {BottomRow} from '../measurables/bottom_row.js';\nimport {Connection} from '../measurables/connection.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport {Field} from '../measurables/field.js';\nimport {Hat} from '../measurables/hat.js';\nimport {Icon} from '../measurables/icon.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InlineInput} from '../measurables/inline_input.js';\nimport {InputRow} from '../measurables/input_row.js';\nimport {JaggedEdge} from '../measurables/jagged_edge.js';\nimport {NextConnection} from '../measurables/next_connection.js';\nimport {OutputConnection} from '../measurables/output_connection.js';\nimport {PreviousConnection} from '../measurables/previous_connection.js';\nimport {RoundCorner} from '../measurables/round_corner.js';\nimport type {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport {SquareCorner} from '../measurables/square_corner.js';\nimport {StatementInput as StatementInputMeasurable} from '../measurables/statement_input.js';\nimport {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\nimport type {ConstantProvider} from './constants.js';\nimport type {Renderer} from './renderer.js';\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo {\n  block_: BlockSvg;\n  protected constants_: ConstantProvider;\n  outputConnection: OutputConnection | null;\n  isInline: boolean;\n  isCollapsed: boolean;\n  isInsertionMarker: boolean;\n  RTL: boolean;\n\n  /** The block renderer in use. */\n  protected readonly renderer_!: Renderer;\n\n  /** The height of the rendered block, including child blocks. */\n  height = 0;\n\n  /** The width of the rendered block, including child blocks. */\n  widthWithChildren = 0;\n\n  /**\n   * The width of the rendered block, excluding child blocks.  This is the\n   * right edge of the block when rendered LTR.\n   */\n  width = 0;\n  statementEdge = 0;\n\n  /** An array of Row objects containing sizing information. */\n  rows: Row[] = [];\n\n  /** An array of input rows on the block. */\n  inputRows: InputRow[] = [];\n\n  topRow: TopRow;\n  bottomRow: BottomRow;\n\n  // The position of the start point for drawing, relative to the block's\n  // location.\n  startX = 0;\n  startY = 0;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    this.renderer_ = renderer;\n\n    this.block_ = block;\n\n    /** The renderer's constant provider. */\n    this.constants_ = this.renderer_.getConstants();\n\n    /**\n     * A measurable representing the output connection if the block has one.\n     * Otherwise null.\n     */\n    this.outputConnection = block.outputConnection\n      ? new OutputConnection(this.constants_, block.outputConnection)\n      : null;\n\n    /**\n     * Whether the block should be rendered as a single line, either because\n     * it's inline or because it has been collapsed.\n     */\n    this.isInline = block.getInputsInline() && !block.isCollapsed();\n\n    /** Whether the block is collapsed. */\n    this.isCollapsed = block.isCollapsed();\n\n    /**\n     * Whether the block is an insertion marker.  Insertion markers are the same\n     * shape as normal blocks, but don't show fields.\n     */\n    this.isInsertionMarker = block.isInsertionMarker();\n\n    /** True if the block should be rendered right-to-left. */\n    this.RTL = block.RTL;\n\n    /**\n     * An object with rendering information about the top row of the block.\n     */\n    this.topRow = new TopRow(this.constants_);\n\n    /**\n     * An object with rendering information about the bottom row of the block.\n     */\n    this.bottomRow = new BottomRow(this.constants_);\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  /**\n   * Populate this object with all sizing information needed to draw the block.\n   *\n   * This measure pass does not propagate changes to the block (although fields\n   * may choose to rerender when getSize() is called).  However, calling it\n   * repeatedly may be expensive.\n   */\n  measure() {\n    this.createRows_();\n    this.addElemSpacing_();\n    this.addRowSpacing_();\n    this.computeBounds_();\n    this.alignRowElements_();\n    this.finalize_();\n  }\n\n  /**\n   * Create rows of Measurable objects representing all renderable parts of the\n   * block.\n   */\n  protected createRows_() {\n    this.populateTopRow_();\n    this.rows.push(this.topRow);\n    let activeRow = new InputRow(this.constants_);\n    this.inputRows.push(activeRow);\n\n    // Icons always go on the first row, before anything else.\n    const icons = this.block_.getIcons();\n    for (let i = 0, icon; (icon = icons[i]); i++) {\n      const iconInfo = new Icon(this.constants_, icon);\n      if (!this.isCollapsed || icon.isShownWhenCollapsed()) {\n        activeRow.elements.push(iconInfo);\n      }\n    }\n\n    let lastInput = undefined;\n    // Loop across all of the inputs on the block, creating objects for anything\n    // that needs to be rendered and breaking the block up into visual rows.\n    for (let i = 0, input; (input = this.block_.inputList[i]); i++) {\n      if (!input.isVisible()) {\n        continue;\n      }\n      if (this.shouldStartNewRow_(input, lastInput)) {\n        // Finish this row and create a new one.\n        this.rows.push(activeRow);\n        activeRow = new InputRow(this.constants_);\n        this.inputRows.push(activeRow);\n      }\n\n      // All of the fields in an input go on the same row.\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        activeRow.elements.push(new Field(this.constants_, field, input));\n      }\n      this.addInput_(input, activeRow);\n      lastInput = input;\n    }\n\n    if (this.isCollapsed) {\n      activeRow.hasJaggedEdge = true;\n      activeRow.elements.push(new JaggedEdge(this.constants_));\n    }\n\n    if (activeRow.elements.length || activeRow.hasDummyInput) {\n      this.rows.push(activeRow);\n    }\n    this.populateBottomRow_();\n    this.rows.push(this.bottomRow);\n  }\n\n  /**\n   * Create all non-spacer elements that belong on the top row.\n   */\n  protected populateTopRow_() {\n    const hasPrevious = !!this.block_.previousConnection;\n    const hasHat =\n      (this.block_.hat\n        ? this.block_.hat === 'cap'\n        : this.constants_.ADD_START_HATS) &&\n      !this.outputConnection &&\n      !hasPrevious;\n\n    let cornerClass = this.topRow.hasLeftSquareCorner(this.block_)\n      ? SquareCorner\n      : RoundCorner;\n    this.topRow.elements.push(new cornerClass(this.constants_));\n\n    if (hasHat) {\n      const hat = new Hat(this.constants_);\n      this.topRow.elements.push(hat);\n      this.topRow.capline = hat.ascenderHeight;\n    } else if (hasPrevious) {\n      this.topRow.hasPreviousConnection = true;\n      this.topRow.connection = new PreviousConnection(\n        this.constants_,\n        this.block_.previousConnection as RenderedConnection,\n      );\n      this.topRow.elements.push(this.topRow.connection);\n    }\n\n    const precedesStatement =\n      this.block_.inputList.length &&\n      this.block_.inputList[0] instanceof StatementInput;\n\n    // This is the minimum height for the row. If one of its elements has a\n    // greater height it will be overwritten in the compute pass.\n    if (precedesStatement && !this.block_.isCollapsed()) {\n      this.topRow.minHeight =\n        this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT;\n    } else {\n      this.topRow.minHeight = this.constants_.TOP_ROW_MIN_HEIGHT;\n    }\n\n    cornerClass = this.topRow.hasRightSquareCorner(this.block_)\n      ? SquareCorner\n      : RoundCorner;\n    this.topRow.elements.push(new cornerClass(this.constants_, 'right'));\n  }\n\n  /**\n   * Create all non-spacer elements that belong on the bottom row.\n   */\n  protected populateBottomRow_() {\n    this.bottomRow.hasNextConnection = !!this.block_.nextConnection;\n\n    const followsStatement =\n      this.block_.inputList.length &&\n      this.block_.inputList[this.block_.inputList.length - 1] instanceof\n        StatementInput;\n\n    // This is the minimum height for the row. If one of its elements has a\n    // greater height it will be overwritten in the compute pass.\n    if (followsStatement) {\n      this.bottomRow.minHeight =\n        this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT;\n    } else {\n      this.bottomRow.minHeight = this.constants_.BOTTOM_ROW_MIN_HEIGHT;\n    }\n\n    const leftSquareCorner = this.bottomRow.hasLeftSquareCorner(this.block_);\n\n    if (leftSquareCorner) {\n      this.bottomRow.elements.push(new SquareCorner(this.constants_));\n    } else {\n      this.bottomRow.elements.push(new RoundCorner(this.constants_));\n    }\n\n    if (this.bottomRow.hasNextConnection) {\n      this.bottomRow.connection = new NextConnection(\n        this.constants_,\n        this.block_.nextConnection as RenderedConnection,\n      );\n      this.bottomRow.elements.push(this.bottomRow.connection);\n    }\n\n    const rightSquareCorner = this.bottomRow.hasRightSquareCorner(this.block_);\n\n    if (rightSquareCorner) {\n      this.bottomRow.elements.push(new SquareCorner(this.constants_, 'right'));\n    } else {\n      this.bottomRow.elements.push(new RoundCorner(this.constants_, 'right'));\n    }\n  }\n\n  /**\n   * Add an input element to the active row, if needed, and record the type of\n   * the input on the row.\n   *\n   * @param input The input to record information about.\n   * @param activeRow The row that is currently being populated.\n   */\n  protected addInput_(input: Input, activeRow: Row) {\n    // Non-dummy inputs have visual representations onscreen.\n    if (this.isInline && input instanceof ValueInput) {\n      activeRow.elements.push(new InlineInput(this.constants_, input));\n      activeRow.hasInlineInput = true;\n    } else if (input instanceof StatementInput) {\n      activeRow.elements.push(\n        new StatementInputMeasurable(this.constants_, input),\n      );\n      activeRow.hasStatement = true;\n    } else if (input instanceof ValueInput) {\n      activeRow.elements.push(new ExternalValueInput(this.constants_, input));\n      activeRow.hasExternalInput = true;\n    } else if (input instanceof DummyInput || input instanceof EndRowInput) {\n      // Dummy and end-row inputs have no visual representation, but the\n      // information is still important.\n      activeRow.minHeight = Math.max(\n        activeRow.minHeight,\n        input.getSourceBlock() && input.getSourceBlock()!.isShadow()\n          ? this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT\n          : this.constants_.DUMMY_INPUT_MIN_HEIGHT,\n      );\n      activeRow.hasDummyInput = true;\n    }\n    if (activeRow.align === null) {\n      activeRow.align = input.align;\n    }\n  }\n\n  /**\n   * Decide whether to start a new row between the two Blockly.Inputs.\n   *\n   * @param currInput The current input.\n   * @param prevInput The previous input.\n   * @returns True if the current input should be rendered on a new row.\n   */\n  protected shouldStartNewRow_(currInput: Input, prevInput?: Input): boolean {\n    // If this is the first input, just add to the existing row.\n    // That row is either empty or has some icons in it.\n    if (!prevInput) {\n      return false;\n    }\n    // If the previous input was an end-row input, then any following input\n    // should always be rendered on the next row.\n    if (prevInput instanceof EndRowInput) {\n      return true;\n    }\n    // A statement input or an input following one always gets a new row.\n    if (\n      currInput instanceof StatementInput ||\n      prevInput instanceof StatementInput\n    ) {\n      return true;\n    }\n    // Value inputs, dummy inputs, and any input following an external value\n    // input get a new row if inputs are not inlined.\n    if (\n      currInput instanceof ValueInput ||\n      currInput instanceof DummyInput ||\n      prevInput instanceof ValueInput\n    ) {\n      return !this.isInline;\n    }\n    return false;\n  }\n\n  /** Add horizontal spacing between and around elements within each row. */\n  protected addElemSpacing_() {\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(\n          new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(null, oldElems[0]),\n          ),\n        );\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        // There's a spacer after the last element in the row.\n        row.elements.push(\n          new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(oldElems[oldElems.length - 1], null),\n          ),\n        );\n      }\n    }\n  }\n\n  /**\n   * Calculate the width of a spacer element in a row based on the previous and\n   * next elements in that row.  For instance, extra padding is added between\n   * two editable fields.\n   *\n   * @param prev The element before the spacer.\n   * @param next The element after the spacer.\n   * @returns The size of the spacing between the two elements.\n   */\n  protected getInRowSpacing_(\n    prev: Measurable | null,\n    next: Measurable | null,\n  ): number {\n    if (!prev) {\n      // Statement input padding.\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n    }\n    // Between inputs and the end of the row.\n    if (prev && Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a square corner and a previous or next connection\n    if (prev && Types.isLeftSquareCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset;\n      }\n    }\n\n    // Spacing between a rounded corner and a previous or next connection.\n    if (prev && Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      }\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  /**\n   * Figure out where the right edge of the block and right edge of statement\n   * inputs should be placed.\n   */\n  protected computeBounds_() {\n    let widestStatementRowFields = 0;\n    let blockWidth = 0;\n    let widestRowWithConnectedBlocks = 0;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      row.measure();\n      blockWidth = Math.max(blockWidth, row.width);\n      if (row.hasStatement) {\n        const statementInput = row.getLastInput();\n        const innerWidth = row.width - (statementInput?.width ?? 0);\n        widestStatementRowFields = Math.max(\n          widestStatementRowFields,\n          innerWidth,\n        );\n      }\n      widestRowWithConnectedBlocks = Math.max(\n        widestRowWithConnectedBlocks,\n        row.widthWithConnectedBlocks,\n      );\n    }\n\n    this.statementEdge = widestStatementRowFields;\n    this.width = blockWidth;\n\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      if (row.hasStatement) {\n        row.statementEdge = this.statementEdge;\n      }\n    }\n\n    this.widthWithChildren = Math.max(blockWidth, widestRowWithConnectedBlocks);\n\n    if (this.outputConnection) {\n      this.startX = this.outputConnection.width;\n      this.width += this.outputConnection.width;\n      this.widthWithChildren += this.outputConnection.width;\n    }\n  }\n\n  /**\n   * Extra spacing may be necessary to make sure that the right sides of all\n   * rows line up.  This can only be calculated after a first pass to calculate\n   * the sizes of all rows.\n   */\n  protected alignRowElements_() {\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      if (row.hasStatement) {\n        this.alignStatementRow_(row as InputRow);\n      } else {\n        const currentWidth = row.width;\n        const desiredWidth = this.getDesiredRowWidth_(row);\n        const missingSpace = desiredWidth - currentWidth;\n        if (missingSpace > 0) {\n          this.addAlignmentPadding_(row, missingSpace);\n        }\n        if (Types.isTopOrBottomRow(row)) {\n          row.widthWithConnectedBlocks = row.width;\n        }\n      }\n    }\n  }\n\n  /**\n   * Calculate the desired width of an input row.\n   *\n   * @param _row The input row.\n   * @returns The desired width of the input row.\n   */\n  protected getDesiredRowWidth_(_row: Row): number {\n    return this.width - this.startX;\n  }\n\n  /**\n   * Modify the given row to add the given amount of padding around its fields.\n   * The exact location of the padding is based on the alignment property of the\n   * last input in the field.\n   *\n   * @param row The row to add padding to.\n   * @param missingSpace How much padding to add.\n   */\n  protected addAlignmentPadding_(row: Row, missingSpace: number) {\n    const firstSpacer = row.getFirstSpacer();\n    const lastSpacer = row.getLastSpacer();\n    if (row.hasExternalInput || row.hasStatement) {\n      row.widthWithConnectedBlocks += missingSpace;\n    }\n\n    // Decide where the extra padding goes.\n    if (row.align === Align.LEFT && lastSpacer) {\n      // Add padding to the end of the row.\n      lastSpacer.width += missingSpace;\n    } else if (row.align === Align.CENTRE && firstSpacer && lastSpacer) {\n      // Split the padding between the beginning and end of the row.\n      firstSpacer.width += missingSpace / 2;\n      lastSpacer.width += missingSpace / 2;\n    } else if (row.align === Align.RIGHT && firstSpacer) {\n      // Add padding at the beginning of the row.\n      firstSpacer.width += missingSpace;\n    } else if (lastSpacer) {\n      // Default to left-aligning.\n      lastSpacer.width += missingSpace;\n    } else {\n      return;\n    }\n    row.width += missingSpace;\n  }\n\n  /**\n   * Align the elements of a statement row based on computed bounds.\n   * Unlike other types of rows, statement rows add space in multiple places.\n   *\n   * @param row The statement row to resize.\n   */\n  protected alignStatementRow_(row: InputRow) {\n    const statementInput = row.getLastInput();\n    if (!statementInput) return;\n    let currentWidth = row.width - statementInput.width;\n    let desiredWidth = this.statementEdge;\n    // Add padding before the statement input.\n    const missingSpace = desiredWidth - currentWidth;\n    if (missingSpace > 0) {\n      this.addAlignmentPadding_(row, missingSpace);\n    }\n    // Also widen the statement input to reach to the right side of the\n    // block. Note that this does not add padding.\n    currentWidth = row.width;\n    desiredWidth = this.getDesiredRowWidth_(row);\n    statementInput.width += desiredWidth - currentWidth;\n    statementInput.height = Math.max(statementInput.height, row.height);\n    row.width += desiredWidth - currentWidth;\n    row.widthWithConnectedBlocks = Math.max(\n      row.width,\n      this.statementEdge + row.connectedBlockWidths,\n    );\n  }\n\n  /** Add spacers between rows and set their sizes. */\n  protected addRowSpacing_() {\n    const oldRows = this.rows;\n    this.rows = [];\n\n    for (let r = 0; r < oldRows.length; r++) {\n      this.rows.push(oldRows[r]);\n      if (r !== oldRows.length - 1) {\n        this.rows.push(this.makeSpacerRow_(oldRows[r], oldRows[r + 1]));\n      }\n    }\n  }\n\n  /**\n   * Create a spacer row to go between prev and next, and set its size.\n   *\n   * @param prev The previous row.\n   * @param next The next row.\n   * @returns The newly created spacer row.\n   */\n  protected makeSpacerRow_(prev: Row, next: Row): SpacerRow {\n    const height = this.getSpacerRowHeight_(prev, next);\n    const width = this.getSpacerRowWidth_(prev, next);\n    const spacer = new SpacerRow(this.constants_, height, width);\n    if (prev.hasStatement) {\n      spacer.followsStatement = true;\n    }\n    if (next.hasStatement) {\n      spacer.precedesStatement = true;\n    }\n    return spacer;\n  }\n\n  /**\n   * Calculate the width of a spacer row.\n   *\n   * @param _prev The row before the spacer.\n   * @param _next The row after the spacer.\n   * @returns The desired width of the spacer row between these two rows.\n   */\n  protected getSpacerRowWidth_(_prev: Row, _next: Row): number {\n    return this.width - this.startX;\n  }\n\n  /**\n   * Calculate the height of a spacer row.\n   *\n   * @param _prev The row before the spacer.\n   * @param _next The row after the spacer.\n   * @returns The desired height of the spacer row between these two rows.\n   */\n  protected getSpacerRowHeight_(_prev: Row, _next: Row): number {\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  /**\n   * Calculate the centerline of an element in a rendered row.\n   * This base implementation puts the centerline at the middle of the row\n   * vertically, with no special cases.  You will likely need extra logic to\n   * handle (at minimum) top and bottom rows.\n   *\n   * @param row The row containing the element.\n   * @param elem The element to place.\n   * @returns The desired centerline of the given element, as an offset from the\n   *     top left of the block.\n   */\n  protected getElemCenterline_(row: Row, elem: Measurable): number {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n        bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n    return row.yPos + row.height / 2;\n  }\n\n  /**\n   * Record final position information on elements on the given row, for use in\n   * drawing.  At minimum this records xPos and centerline on each element.\n   *\n   * @param row The row containing the elements.\n   */\n  protected recordElemPositions_(row: Row) {\n    let xCursor = row.xPos;\n    for (let j = 0, elem; (elem = row.elements[j]); j++) {\n      // Now that row heights are finalized, make spacers use the row height.\n      if (Types.isSpacer(elem)) {\n        elem.height = row.height;\n      }\n      elem.xPos = xCursor;\n      elem.centerline = this.getElemCenterline_(row, elem);\n      xCursor += elem.width;\n    }\n  }\n\n  /**\n   * Make any final changes to the rendering information object.  In particular,\n   * store the y position of each row, and record the height of the full block.\n   */\n  protected finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks = Math.max(\n        widestRowWithConnectedBlocks,\n        row.widthWithConnectedBlocks,\n      );\n      this.recordElemPositions_(row);\n    }\n    if (this.outputConnection && this.block_.nextConnection) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n          widestRowWithConnectedBlocks,\n          target.getHeightWidth().width,\n        );\n      }\n    }\n\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\n\n    this.height = yCursor;\n    this.startY = this.topRow.capline;\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n  }\n\n  /** Returns the connection measurable associated with the given connection. */\n  getMeasureableForConnection(conn: RenderedConnection): Connection | null {\n    if (this.outputConnection?.connectionModel === conn) {\n      return this.outputConnection;\n    }\n\n    for (const row of this.rows) {\n      for (const elem of row.elements) {\n        if (elem instanceof Connection && elem.connectionModel === conn) {\n          return elem;\n        }\n      }\n    }\n\n    return null;\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block delete event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockDelete\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport * as blocks from '../serialization/blocks.js';\nimport * as utilsXml from '../utils/xml.js';\nimport {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport {EventType} from './type.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Notifies listeners when a block (or connected stack of blocks) is\n * deleted.\n */\nexport class BlockDelete extends BlockBase {\n  /** The XML representation of the deleted block(s). */\n  oldXml?: Element | DocumentFragment;\n\n  /** The JSON respresentation of the deleted block(s). */\n  oldJson?: blocks.State;\n\n  /** All of the IDs of deleted blocks. */\n  ids?: string[];\n\n  /** True if the deleted block was a shadow block, false otherwise. */\n  wasShadow?: boolean;\n\n  override type = EventType.BLOCK_DELETE;\n\n  /** @param opt_block The deleted block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    if (opt_block.getParent()) {\n      throw Error('Connected blocks cannot be deleted.');\n    }\n    if (opt_block.isShadow()) {\n      // Respawning shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    this.oldXml = Xml.blockToDomWithXY(opt_block);\n    this.ids = eventUtils.getDescendantIds(opt_block);\n    this.wasShadow = opt_block.isShadow();\n    this.oldJson = blocks.save(opt_block, {\n      addCoordinates: true,\n    }) as blocks.State;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockDeleteJson {\n    const json = super.toJson() as BlockDeleteJson;\n    if (!this.oldXml) {\n      throw new Error(\n        'The old block XML is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson',\n      );\n    }\n    if (!this.ids) {\n      throw new Error(\n        'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (this.wasShadow === undefined) {\n      throw new Error(\n        'Whether the block was a shadow is undefined. Either ' +\n          'pass a block to the constructor, or call fromJson',\n      );\n    }\n    if (!this.oldJson) {\n      throw new Error(\n        'The old block JSON is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson',\n      );\n    }\n    json['oldXml'] = Xml.domToText(this.oldXml);\n    json['ids'] = this.ids;\n    json['wasShadow'] = this.wasShadow;\n    json['oldJson'] = this.oldJson;\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockDelete, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockDeleteJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockDelete {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockDelete(),\n    ) as BlockDelete;\n    newEvent.oldXml = utilsXml.textToDom(json['oldXml']);\n    newEvent.ids = json['ids'];\n    newEvent.wasShadow =\n      json['wasShadow'] || newEvent.oldXml.tagName.toLowerCase() === 'shadow';\n    newEvent.oldJson = json['oldJson'];\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /**\n   * Run a deletion event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.ids) {\n      throw new Error(\n        'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.oldJson) {\n      throw new Error(\n        'The old block JSON is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson',\n      );\n    }\n    if (forward) {\n      for (let i = 0; i < this.ids.length; i++) {\n        const id = this.ids[i];\n        const block = workspace.getBlockById(id);\n        if (block) {\n          block.dispose(false);\n        } else if (id === this.blockId) {\n          // Only complain about root-level block.\n          console.warn(\"Can't delete non-existent block: \" + id);\n        }\n      }\n    } else {\n      blocks.append(this.oldJson, workspace);\n    }\n  }\n}\n\nexport interface BlockDeleteJson extends BlockBaseJson {\n  oldXml: string;\n  ids: string[];\n  wasShadow: boolean;\n  oldJson: blocks.State;\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, EventType.BLOCK_DELETE, BlockDelete);\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing one block.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Block\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_delete.js';\n\nimport {Blocks} from './blocks.js';\nimport * as common from './common.js';\nimport {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as constants from './constants.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockChange} from './events/events_block_change.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport * as Extensions from './extensions.js';\nimport type {Field} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {DuplicateIconType} from './icons/exceptions.js';\nimport {IconType} from './icons/icon_types.js';\nimport type {MutatorIcon} from './icons/mutator_icon.js';\nimport {Align} from './inputs/align.js';\nimport {DummyInput} from './inputs/dummy_input.js';\nimport {EndRowInput} from './inputs/end_row_input.js';\nimport {Input} from './inputs/input.js';\nimport {StatementInput} from './inputs/statement_input.js';\nimport {ValueInput} from './inputs/value_input.js';\nimport type {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport {isCommentIcon} from './interfaces/i_comment_icon.js';\nimport {type IIcon} from './interfaces/i_icon.js';\nimport * as registry from './registry.js';\nimport * as Tooltip from './tooltip.js';\nimport * as arrayUtils from './utils/array.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as parsing from './utils/parsing.js';\nimport {Size} from './utils/size.js';\nimport type {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Class for one block.\n * Not normally called directly, workspace.newBlock() is preferred.\n */\nexport class Block implements IASTNodeLocation {\n  /**\n   * An optional callback method to use whenever the block's parent workspace\n   * changes. This is usually only called from the constructor, the block type\n   * initializer function, or an extension initializer function.\n   */\n  onchange?: ((p1: Abstract) => void) | null;\n\n  /** The language-neutral ID given to the collapsed input. */\n  static readonly COLLAPSED_INPUT_NAME: string = constants.COLLAPSED_INPUT_NAME;\n\n  /** The language-neutral ID given to the collapsed field. */\n  static readonly COLLAPSED_FIELD_NAME: string = constants.COLLAPSED_FIELD_NAME;\n\n  /**\n   * Optional text data that round-trips between blocks and XML.\n   * Has no effect. May be used by 3rd parties for meta information.\n   */\n  data: string | null = null;\n\n  /**\n   * Has this block been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /**\n   * Colour of the block as HSV hue value (0-360)\n   * This may be null if the block colour was not set via a hue number.\n   */\n  private hue: number | null = null;\n\n  /** Colour of the block in '#RRGGBB' format. */\n  protected colour_ = '#000000';\n\n  /** Name of the block style. */\n  protected styleName_ = '';\n\n  /** An optional method called during initialization. */\n  init?: () => void;\n\n  /** An optional method called during disposal. */\n  destroy?: () => void;\n\n  /**\n   * An optional serialization method for defining how to serialize the\n   * mutation state to XML. This must be coupled with defining\n   * `domToMutation`.\n   */\n  mutationToDom?: (...p1: AnyDuringMigration[]) => Element;\n\n  /**\n   * An optional deserialization method for defining how to deserialize the\n   * mutation state from XML. This must be coupled with defining\n   * `mutationToDom`.\n   */\n  domToMutation?: (p1: Element) => void;\n\n  /**\n   * An optional serialization method for defining how to serialize the\n   * block's extra state (eg mutation state) to something JSON compatible.\n   * This must be coupled with defining `loadExtraState`.\n   *\n   * @param doFullSerialization Whether or not to serialize the full state of\n   *     the extra state (rather than possibly saving a reference to some\n   *     state). This is used during copy-paste. See the\n   *     {@link https://developers.devsite.google.com/blockly/guides/create-custom-blocks/extensions#full_serialization_and_backing_data | block serialization docs}\n   *     for more information.\n   */\n  saveExtraState?: (doFullSerialization?: boolean) => AnyDuringMigration;\n\n  /**\n   * An optional serialization method for defining how to deserialize the\n   * block's extra state (eg mutation state) from something JSON compatible.\n   * This must be coupled with defining `saveExtraState`.\n   */\n  loadExtraState?: (p1: AnyDuringMigration) => void;\n\n  /**\n   * An optional property for suppressing adding STATEMENT_PREFIX and\n   * STATEMENT_SUFFIX to generated code.\n   */\n  suppressPrefixSuffix: boolean | null = false;\n\n  /**\n   * An optional method for declaring developer variables, to be used\n   * by generators.  Developer variables are never shown to the user,\n   * but are declared as global variables in the generated code.\n   *\n   * @returns a list of developer variable names.\n   */\n  getDeveloperVariables?: () => string[];\n\n  /**\n   * An optional method that reconfigures the block based on the\n   * contents of the mutator dialog.\n   *\n   * @param rootBlock The root block in the mutator flyout.\n   */\n  compose?: (rootBlock: Block) => void;\n\n  /**\n   * An optional function that populates the mutator flyout with\n   * blocks representing this block's configuration.\n   *\n   * @param workspace The mutator flyout's workspace.\n   * @returns The root block created in the flyout's workspace.\n   */\n  decompose?: (workspace: Workspace) => Block;\n\n  id: string;\n  outputConnection: Connection | null = null;\n  nextConnection: Connection | null = null;\n  previousConnection: Connection | null = null;\n  inputList: Input[] = [];\n  inputsInline?: boolean;\n  icons: IIcon[] = [];\n  private disabledReasons = new Set<string>();\n  tooltip: Tooltip.TipInfo = '';\n  contextMenu = true;\n\n  protected parentBlock_: this | null = null;\n\n  protected childBlocks_: this[] = [];\n\n  private deletable = true;\n\n  private movable = true;\n\n  private editable = true;\n\n  private shadow = false;\n\n  protected collapsed_ = false;\n  protected outputShape_: number | null = null;\n\n  /**\n   * Is the current block currently in the process of being disposed?\n   */\n  protected disposing = false;\n\n  /**\n   * Has this block been fully initialized? E.g. all fields initailized.\n   *\n   * @internal\n   */\n  initialized = false;\n\n  private readonly xy: Coordinate;\n  isInFlyout: boolean;\n  isInMutator: boolean;\n  RTL: boolean;\n\n  /** True if this block is an insertion marker. */\n  protected isInsertionMarker_ = false;\n\n  /** Name of the type of hat. */\n  hat?: string;\n\n  /** Is this block a BlockSVG? */\n  readonly rendered: boolean = false;\n\n  /**\n   * String for block help, or function that returns a URL. Null for no help.\n   */\n  helpUrl: string | (() => string) | null = null;\n\n  /** A bound callback function to use when the parent workspace changes. */\n  private onchangeWrapper: ((p1: Abstract) => void) | null = null;\n\n  /**\n   * A count of statement inputs on the block.\n   *\n   * @internal\n   */\n  statementInputCount = 0;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  type!: string;\n  // Record initial inline state.\n  inputsInlineDefault?: boolean;\n  workspace: Workspace;\n\n  /**\n   * @param workspace The block's workspace.\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @throws When the prototypeName is not valid or not allowed.\n   */\n  constructor(workspace: Workspace, prototypeName: string, opt_id?: string) {\n    this.workspace = workspace;\n\n    this.id =\n      opt_id && !workspace.getBlockById(opt_id) ? opt_id : idGenerator.genUid();\n    workspace.setBlockById(this.id, this);\n\n    /**\n     * The block's position in workspace units.  (0, 0) is at the workspace's\n     * origin; scale does not change this value.\n     */\n    this.xy = new Coordinate(0, 0);\n    this.isInFlyout = workspace.isFlyout;\n    this.isInMutator = workspace.isMutator;\n\n    this.RTL = workspace.RTL;\n\n    // Copy the type-specific functions and data from the prototype.\n    if (prototypeName) {\n      this.type = prototypeName;\n      const prototype = Blocks[prototypeName];\n      if (!prototype || typeof prototype !== 'object') {\n        throw TypeError('Invalid block definition for type: ' + prototypeName);\n      }\n      Object.assign(this, prototype);\n    }\n\n    workspace.addTopBlock(this);\n    workspace.addTypedBlock(this);\n\n    if (new.target === Block) {\n      this.doInit_();\n    }\n  }\n\n  /** Calls the init() function and handles associated event firing, etc. */\n  protected doInit_() {\n    // All events fired should be part of the same group.\n    // Any events fired during init should not be undoable,\n    // so that block creation is atomic.\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    const initialUndoFlag = eventUtils.getRecordUndo();\n\n    try {\n      // Call an initialization function, if it exists.\n      if (typeof this.init === 'function') {\n        eventUtils.setRecordUndo(false);\n        this.init();\n        eventUtils.setRecordUndo(initialUndoFlag);\n      }\n\n      // Fire a create event.\n      if (eventUtils.isEnabled()) {\n        eventUtils.fire(new (eventUtils.get(EventType.BLOCK_CREATE))(this));\n      }\n    } finally {\n      eventUtils.setGroup(existingGroup);\n      // In case init threw, recordUndo flag should still be reset.\n      eventUtils.setRecordUndo(initialUndoFlag);\n    }\n    this.inputsInlineDefault = this.inputsInline;\n\n    // Bind an onchange function, if it exists.\n    if (typeof this.onchange === 'function') {\n      this.setOnChange(this.onchange);\n    }\n  }\n\n  /**\n   * Dispose of this block.\n   *\n   * @param healStack If true, then try to heal any gap by connecting the next\n   *     statement with the previous statement.  Otherwise, dispose of all\n   *     children of this block.\n   */\n  dispose(healStack = false) {\n    this.disposing = true;\n\n    // Dispose of this change listener before unplugging.\n    // Technically not necessary due to the event firing delay.\n    // But future-proofing.\n    if (this.onchangeWrapper) {\n      this.workspace.removeChangeListener(this.onchangeWrapper);\n    }\n\n    this.unplug(healStack);\n    if (eventUtils.isEnabled()) {\n      // Constructing the delete event is costly. Only perform if necessary.\n      eventUtils.fire(new (eventUtils.get(EventType.BLOCK_DELETE))(this));\n    }\n    this.workspace.removeTopBlock(this);\n    this.disposeInternal();\n  }\n\n  /**\n   * Disposes of this block without doing things required by the top block.\n   * E.g. does not fire events, unplug the block, etc.\n   */\n  protected disposeInternal() {\n    this.disposing = true;\n    if (this.onchangeWrapper) {\n      this.workspace.removeChangeListener(this.onchangeWrapper);\n    }\n\n    this.workspace.removeTypedBlock(this);\n    this.workspace.removeBlockById(this.id);\n\n    if (typeof this.destroy === 'function') this.destroy();\n\n    this.childBlocks_.forEach((c) => c.disposeInternal());\n    this.inputList.forEach((i) => i.dispose());\n    this.inputList.length = 0;\n    this.getConnections_(true).forEach((c) => c.dispose());\n    this.disposed = true;\n  }\n\n  /**\n   * Returns true if the block is either in the process of being disposed, or\n   * is disposed.\n   *\n   * @internal\n   */\n  isDeadOrDying(): boolean {\n    return this.disposing || this.disposed;\n  }\n\n  /**\n   * Call initModel on all fields on the block.\n   * May be called more than once.\n   * Either initModel or initSvg must be called after creating a block and\n   * before the first interaction with it.  Interactions include UI actions\n   * (e.g. clicking and dragging) and firing events (e.g. create, delete, and\n   * change).\n   */\n  initModel() {\n    if (this.initialized) return;\n    for (const input of this.inputList) {\n      input.initModel();\n    }\n    this.initialized = true;\n  }\n\n  /**\n   * Unplug this block from its superior block.  If this block is a statement,\n   * optionally reconnect the block underneath with the block on top.\n   *\n   * @param opt_healStack Disconnect child statement and reconnect stack.\n   *     Defaults to false.\n   */\n  unplug(opt_healStack?: boolean) {\n    if (this.outputConnection) {\n      this.unplugFromRow(opt_healStack);\n    }\n    if (this.previousConnection) {\n      this.unplugFromStack(opt_healStack);\n    }\n  }\n\n  /**\n   * Unplug this block's output from an input on another block.  Optionally\n   * reconnect the block's parent to the only child block, if possible.\n   *\n   * @param opt_healStack Disconnect right-side block and connect to left-side\n   *     block.  Defaults to false.\n   */\n  private unplugFromRow(opt_healStack?: boolean) {\n    let parentConnection = null;\n    if (this.outputConnection?.isConnected()) {\n      parentConnection = this.outputConnection.targetConnection;\n      // Disconnect from any superior block.\n      this.outputConnection.disconnect();\n    }\n\n    // Return early in obvious cases.\n    if (!parentConnection || !opt_healStack) {\n      return;\n    }\n\n    const thisConnection = this.getOnlyValueConnection();\n    if (\n      !thisConnection ||\n      !thisConnection.isConnected() ||\n      thisConnection.targetBlock()!.isShadow()\n    ) {\n      // Too many or too few possible connections on this block, or there's\n      // nothing on the other side of this connection.\n      return;\n    }\n\n    const childConnection = thisConnection.targetConnection;\n    // Disconnect the child block.\n    childConnection?.disconnect();\n    // Connect child to the parent if possible, otherwise bump away.\n    if (\n      this.workspace.connectionChecker.canConnect(\n        childConnection,\n        parentConnection,\n        false,\n      )\n    ) {\n      parentConnection.connect(childConnection!);\n    } else {\n      childConnection?.onFailedConnect(parentConnection);\n    }\n  }\n\n  /**\n   * Returns the connection on the value input that is connected to another\n   * block. When an insertion marker is connected to a connection with a block\n   * already attached, the connected block is attached to the insertion marker.\n   * Since only one block can be displaced and attached to the insertion marker\n   * this should only ever return one connection.\n   *\n   * @returns The connection on the value input, or null.\n   */\n  private getOnlyValueConnection(): Connection | null {\n    let connection = null;\n    for (let i = 0; i < this.inputList.length; i++) {\n      const thisConnection = this.inputList[i].connection;\n      if (\n        thisConnection &&\n        thisConnection.type === ConnectionType.INPUT_VALUE &&\n        thisConnection.targetConnection\n      ) {\n        if (connection) {\n          return null; // More than one value input found.\n        }\n        connection = thisConnection;\n      }\n    }\n    return connection;\n  }\n\n  /**\n   * Unplug this statement block from its superior block.  Optionally reconnect\n   * the block underneath with the block on top.\n   *\n   * @param opt_healStack Disconnect child statement and reconnect stack.\n   *     Defaults to false.\n   */\n  private unplugFromStack(opt_healStack?: boolean) {\n    let previousTarget = null;\n    if (this.previousConnection?.isConnected()) {\n      // Remember the connection that any next statements need to connect to.\n      previousTarget = this.previousConnection.targetConnection;\n      // Detach this block from the parent's tree.\n      this.previousConnection.disconnect();\n    }\n    const nextBlock = this.getNextBlock();\n    if (opt_healStack && nextBlock && !nextBlock.isShadow()) {\n      // Disconnect the next statement.\n      const nextTarget = this.nextConnection?.targetConnection ?? null;\n      nextTarget?.disconnect();\n      if (\n        previousTarget &&\n        this.workspace.connectionChecker.canConnect(\n          previousTarget,\n          nextTarget,\n          false,\n        )\n      ) {\n        // Attach the next statement to the previous statement.\n        previousTarget.connect(nextTarget!);\n      }\n    }\n  }\n\n  /**\n   * Returns all connections originating from this block.\n   *\n   * @param _all If true, return all connections even hidden ones.\n   * @returns Array of connections.\n   * @internal\n   */\n  getConnections_(_all: boolean): Connection[] {\n    const myConnections = [];\n    if (this.outputConnection) {\n      myConnections.push(this.outputConnection);\n    }\n    if (this.previousConnection) {\n      myConnections.push(this.previousConnection);\n    }\n    if (this.nextConnection) {\n      myConnections.push(this.nextConnection);\n    }\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.connection) {\n        myConnections.push(input.connection);\n      }\n    }\n    return myConnections;\n  }\n\n  /**\n   * Walks down a stack of blocks and finds the last next connection on the\n   * stack.\n   *\n   * @param ignoreShadows If true,the last connection on a non-shadow block will\n   *     be returned. If false, this will follow shadows to find the last\n   *     connection.\n   * @returns The last next connection on the stack, or null.\n   * @internal\n   */\n  lastConnectionInStack(ignoreShadows: boolean): Connection | null {\n    let nextConnection = this.nextConnection;\n    while (nextConnection) {\n      const nextBlock = nextConnection.targetBlock();\n      if (!nextBlock || (ignoreShadows && nextBlock.isShadow())) {\n        return nextConnection;\n      }\n      nextConnection = nextBlock.nextConnection;\n    }\n    return null;\n  }\n\n  /**\n   * Bump unconnected blocks out of alignment.  Two blocks which aren't actually\n   * connected should not coincidentally line up on screen.\n   */\n  bumpNeighbours() {}\n\n  /**\n   * Return the parent block or null if this block is at the top level. The\n   * parent block is either the block connected to the previous connection (for\n   * a statement block) or the block connected to the output connection (for a\n   * value block).\n   *\n   * @returns The block (if any) that holds the current block.\n   */\n  getParent(): this | null {\n    return this.parentBlock_;\n  }\n\n  /**\n   * Return the input that connects to the specified block.\n   *\n   * @param block A block connected to an input on this block.\n   * @returns The input (if any) that connects to the specified block.\n   */\n  getInputWithBlock(block: Block): Input | null {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.connection && input.connection.targetBlock() === block) {\n        return input;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return the parent block that surrounds the current block, or null if this\n   * block has no surrounding block.  A parent block might just be the previous\n   * statement, whereas the surrounding block is an if statement, while loop,\n   * etc.\n   *\n   * @returns The block (if any) that surrounds the current block.\n   */\n  getSurroundParent(): this | null {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this | null = this;\n    let prevBlock;\n    do {\n      prevBlock = block;\n      block = block.getParent();\n      if (!block) {\n        // Ran off the top.\n        return null;\n      }\n    } while (block.getNextBlock() === prevBlock);\n    // This block is an enclosing parent, not just a statement in a stack.\n    return block;\n  }\n\n  /**\n   * Return the next statement block directly connected to this block.\n   *\n   * @returns The next statement block or null.\n   */\n  getNextBlock(): Block | null {\n    return this.nextConnection && this.nextConnection.targetBlock();\n  }\n\n  /**\n   * Returns the block connected to the previous connection.\n   *\n   * @returns The previous statement block or null.\n   */\n  getPreviousBlock(): Block | null {\n    return this.previousConnection && this.previousConnection.targetBlock();\n  }\n\n  /**\n   * Return the top-most block in this block's tree.\n   * This will return itself if this block is at the top level.\n   *\n   * @returns The root block.\n   */\n  getRootBlock(): this {\n    let rootBlock: this;\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this | null = this;\n    do {\n      rootBlock = block;\n      block = rootBlock.parentBlock_;\n    } while (block);\n    return rootBlock;\n  }\n\n  /**\n   * Walk up from the given block up through the stack of blocks to find\n   * the top block of the sub stack. If we are nested in a statement input only\n   * find the top-most nested block. Do not go all the way to the root block.\n   *\n   * @returns The top block in a stack.\n   * @internal\n   */\n  getTopStackBlock(): this {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block = this;\n    let previous;\n    do {\n      previous = block.getPreviousBlock();\n      // AnyDuringMigration because:  Type 'Block' is not assignable to type\n      // 'this'.\n    } while (\n      previous &&\n      previous.getNextBlock() === block &&\n      (block = previous as AnyDuringMigration)\n    );\n    return block;\n  }\n\n  /**\n   * Find all the blocks that are directly nested inside this one.\n   * Includes value and statement inputs, as well as any following statement.\n   * Excludes any connection on an output tab or any preceding statement.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  getChildren(ordered: boolean): Block[] {\n    if (!ordered) {\n      return this.childBlocks_;\n    }\n    const blocks = [];\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.connection) {\n        const child = input.connection.targetBlock();\n        if (child) {\n          blocks.push(child);\n        }\n      }\n    }\n    const next = this.getNextBlock();\n    if (next) {\n      blocks.push(next);\n    }\n    return blocks;\n  }\n\n  /**\n   * Set parent of this block to be a new block or null.\n   *\n   * @param newParent New parent block.\n   * @internal\n   */\n  setParent(newParent: this | null) {\n    if (newParent === this.parentBlock_) {\n      return;\n    }\n\n    // Check that block is connected to new parent if new parent is not null and\n    // that block is not connected to superior one if new parent is null.\n    const targetBlock =\n      (this.previousConnection && this.previousConnection.targetBlock()) ||\n      (this.outputConnection && this.outputConnection.targetBlock());\n    const isConnected = !!targetBlock;\n\n    if (isConnected && newParent && targetBlock !== newParent) {\n      throw Error('Block connected to superior one that is not new parent.');\n    } else if (!isConnected && newParent) {\n      throw Error('Block not connected to new parent.');\n    } else if (isConnected && !newParent) {\n      throw Error(\n        'Cannot set parent to null while block is still connected to' +\n          ' superior block.',\n      );\n    }\n\n    // This block hasn't actually moved on-screen, so there's no need to\n    // update its connection locations.\n    if (this.parentBlock_) {\n      // Remove this block from the old parent's child list.\n      arrayUtils.removeElem(this.parentBlock_.childBlocks_, this);\n    } else {\n      // New parent must be non-null so remove this block from the\n      // workspace's list of top-most blocks.\n      this.workspace.removeTopBlock(this);\n    }\n\n    this.parentBlock_ = newParent;\n    if (newParent) {\n      // Add this block to the new parent's child list.\n      newParent.childBlocks_.push(this);\n    } else {\n      this.workspace.addTopBlock(this);\n    }\n  }\n\n  /**\n   * Find all the blocks that are directly or indirectly nested inside this one.\n   * Includes this block in the list.\n   * Includes value and statement inputs, as well as any following statements.\n   * Excludes any connection on an output tab or any preceding statements.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Flattened array of blocks.\n   */\n  getDescendants(ordered: boolean): this[] {\n    const blocks = [this];\n    const childBlocks = this.getChildren(ordered);\n    for (let child, i = 0; (child = childBlocks[i]); i++) {\n      // AnyDuringMigration because:  Argument of type 'Block[]' is not\n      // assignable to parameter of type 'this[]'.\n      blocks.push(...(child.getDescendants(ordered) as AnyDuringMigration));\n    }\n    return blocks;\n  }\n\n  /**\n   * Get whether this block is deletable or not.\n   *\n   * @returns True if deletable.\n   */\n  isDeletable(): boolean {\n    return (\n      this.deletable &&\n      !this.shadow &&\n      !this.isDeadOrDying() &&\n      !this.workspace.options.readOnly\n    );\n  }\n\n  /**\n   * Return whether this block's own deletable property is true or false.\n   *\n   * @returns True if the block's deletable property is true, false otherwise.\n   */\n  isOwnDeletable(): boolean {\n    return this.deletable;\n  }\n\n  /**\n   * Set whether this block is deletable or not.\n   *\n   * @param deletable True if deletable.\n   */\n  setDeletable(deletable: boolean) {\n    this.deletable = deletable;\n  }\n\n  /**\n   * Get whether this block is movable or not.\n   *\n   * @returns True if movable.\n   * @internal\n   */\n  isMovable(): boolean {\n    return (\n      this.movable &&\n      !this.shadow &&\n      !this.isDeadOrDying() &&\n      !this.workspace.options.readOnly\n    );\n  }\n\n  /**\n   * Return whether this block's own movable property is true or false.\n   *\n   * @returns True if the block's movable property is true, false otherwise.\n   * @internal\n   */\n  isOwnMovable(): boolean {\n    return this.movable;\n  }\n\n  /**\n   * Set whether this block is movable or not.\n   *\n   * @param movable True if movable.\n   */\n  setMovable(movable: boolean) {\n    this.movable = movable;\n  }\n\n  /**\n   * Get whether is block is duplicatable or not. If duplicating this block and\n   * descendants will put this block over the workspace's capacity this block is\n   * not duplicatable. If duplicating this block and descendants will put any\n   * type over their maxInstances this block is not duplicatable.\n   *\n   * @returns True if duplicatable.\n   */\n  isDuplicatable(): boolean {\n    if (!this.workspace.hasBlockLimits()) {\n      return true;\n    }\n    return this.workspace.isCapacityAvailable(\n      common.getBlockTypeCounts(this, true),\n    );\n  }\n\n  /**\n   * Get whether this block is a shadow block or not.\n   *\n   * @returns True if a shadow.\n   */\n  isShadow(): boolean {\n    return this.shadow;\n  }\n\n  /**\n   * Set whether this block is a shadow block or not.\n   * This method is internal and should not be called by users of Blockly. To\n   * create shadow blocks programmatically call connection.setShadowState\n   *\n   * @param shadow True if a shadow.\n   * @internal\n   */\n  setShadow(shadow: boolean) {\n    this.shadow = shadow;\n  }\n\n  /**\n   * Get whether this block is an insertion marker block or not.\n   *\n   * @returns True if an insertion marker.\n   */\n  isInsertionMarker(): boolean {\n    return this.isInsertionMarker_;\n  }\n\n  /**\n   * Set whether this block is an insertion marker block or not.\n   * Once set this cannot be unset.\n   *\n   * @param insertionMarker True if an insertion marker.\n   * @internal\n   */\n  setInsertionMarker(insertionMarker: boolean) {\n    this.isInsertionMarker_ = insertionMarker;\n  }\n\n  /**\n   * Get whether this block is editable or not.\n   *\n   * @returns True if editable.\n   * @internal\n   */\n  isEditable(): boolean {\n    return (\n      this.editable && !this.isDeadOrDying() && !this.workspace.options.readOnly\n    );\n  }\n\n  /**\n   * Return whether this block's own editable property is true or false.\n   *\n   * @returns True if the block's editable property is true, false otherwise.\n   */\n  isOwnEditable(): boolean {\n    return this.editable;\n  }\n\n  /**\n   * Set whether this block is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  setEditable(editable: boolean) {\n    this.editable = editable;\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        field.updateEditable();\n      }\n    }\n  }\n\n  /**\n   * Returns if this block has been disposed of / deleted.\n   *\n   * @returns True if this block has been disposed of / deleted.\n   */\n  isDisposed(): boolean {\n    return this.disposed;\n  }\n\n  /**\n   * @returns True if this block is a value block with a single editable field.\n   * @internal\n   */\n  isSimpleReporter(): boolean {\n    if (!this.outputConnection) return false;\n\n    for (const input of this.inputList) {\n      if (input.connection || input.fieldRow.length > 1) return false;\n    }\n    return true;\n  }\n\n  /**\n   * Find the connection on this block that corresponds to the given connection\n   * on the other block.\n   * Used to match connections between a block and its insertion marker.\n   *\n   * @param otherBlock The other block to match against.\n   * @param conn The other connection to match.\n   * @returns The matching connection on this block, or null.\n   * @internal\n   */\n  getMatchingConnection(\n    otherBlock: Block,\n    conn: Connection,\n  ): Connection | null {\n    const connections = this.getConnections_(true);\n    const otherConnections = otherBlock.getConnections_(true);\n    if (connections.length !== otherConnections.length) {\n      throw Error('Connection lists did not match in length.');\n    }\n    for (let i = 0; i < otherConnections.length; i++) {\n      if (otherConnections[i] === conn) {\n        return connections[i];\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Set the URL of this block's help page.\n   *\n   * @param url URL string for block help, or function that returns a URL.  Null\n   *     for no help.\n   */\n  setHelpUrl(url: string | (() => string)) {\n    this.helpUrl = url;\n  }\n\n  /**\n   * Sets the tooltip for this block.\n   *\n   * @param newTip The text for the tooltip, a function that returns the text\n   *     for the tooltip, or a parent object whose tooltip will be used. To not\n   *     display a tooltip pass the empty string.\n   */\n  setTooltip(newTip: Tooltip.TipInfo) {\n    this.tooltip = newTip;\n  }\n\n  /**\n   * Returns the tooltip text for this block.\n   *\n   * @returns The tooltip text for this block.\n   */\n  getTooltip(): string {\n    return Tooltip.getTooltipOfObject(this);\n  }\n\n  /**\n   * Get the colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColour(): string {\n    return this.colour_;\n  }\n\n  /**\n   * Get the name of the block style.\n   *\n   * @returns Name of the block style.\n   */\n  getStyleName(): string {\n    return this.styleName_;\n  }\n\n  /**\n   * Get the HSV hue value of a block.  Null if hue not set.\n   *\n   * @returns Hue value (0-360).\n   */\n  getHue(): number | null {\n    return this.hue;\n  }\n\n  /**\n   * Change the colour of a block.\n   *\n   * @param colour HSV hue value (0 to 360), #RRGGBB string, or a message\n   *     reference string pointing to one of those two values.\n   */\n  setColour(colour: number | string) {\n    const parsed = parsing.parseBlockColour(colour);\n    this.hue = parsed.hue;\n    this.colour_ = parsed.hex;\n  }\n\n  /**\n   * Set the style and colour values of a block.\n   *\n   * @param blockStyleName Name of the block style.\n   */\n  setStyle(blockStyleName: string) {\n    this.styleName_ = blockStyleName;\n  }\n\n  /**\n   * Sets a callback function to use whenever the block's parent workspace\n   * changes, replacing any prior onchange handler. This is usually only called\n   * from the constructor, the block type initializer function, or an extension\n   * initializer function.\n   *\n   * @param onchangeFn The callback to call when the block's workspace changes.\n   * @throws {Error} if onchangeFn is not falsey and not a function.\n   */\n  setOnChange(onchangeFn: (p1: Abstract) => void) {\n    if (onchangeFn && typeof onchangeFn !== 'function') {\n      throw Error('onchange must be a function.');\n    }\n    if (this.onchangeWrapper) {\n      this.workspace.removeChangeListener(this.onchangeWrapper);\n    }\n    this.onchange = onchangeFn;\n    this.onchangeWrapper = onchangeFn.bind(this);\n    this.workspace.addChangeListener(this.onchangeWrapper);\n  }\n\n  /**\n   * Returns the named field from a block.\n   *\n   * @param name The name of the field.\n   * @returns Named field, or null if field does not exist.\n   */\n  getField(name: string): Field | null {\n    if (typeof name !== 'string') {\n      throw TypeError(\n        'Block.prototype.getField expects a string ' +\n          'with the field name but received ' +\n          (name === undefined ? 'nothing' : name + ' of type ' + typeof name) +\n          ' instead',\n      );\n    }\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (field.name === name) {\n          return field;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return all variables referenced by this block.\n   *\n   * @returns List of variable ids.\n   */\n  getVars(): string[] {\n    const vars: string[] = [];\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (field.referencesVariables()) {\n          // NOTE: This only applies to `FieldVariable`, a `Field<string>`\n          vars.push(field.getValue() as string);\n        }\n      }\n    }\n    return vars;\n  }\n\n  /**\n   * Return all variables referenced by this block.\n   *\n   * @returns List of variable models.\n   * @internal\n   */\n  getVarModels(): VariableModel[] {\n    const vars = [];\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (field.referencesVariables()) {\n          const model = this.workspace.getVariableById(\n            field.getValue() as string,\n          );\n          // Check if the variable actually exists (and isn't just a potential\n          // variable).\n          if (model) {\n            vars.push(model);\n          }\n        }\n      }\n    }\n    return vars;\n  }\n\n  /**\n   * Notification that a variable is renaming but keeping the same ID.  If the\n   * variable is in use on this block, rerender to show the new name.\n   *\n   * @param variable The variable being renamed.\n   * @internal\n   */\n  updateVarName(variable: VariableModel) {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (\n          field.referencesVariables() &&\n          variable.getId() === field.getValue()\n        ) {\n          field.refreshVariableName();\n        }\n      }\n    }\n  }\n\n  /**\n   * Notification that a variable is renaming.\n   * If the ID matches one of this block's variables, rename it.\n   *\n   * @param oldId ID of variable to rename.\n   * @param newId ID of new variable.  May be the same as oldId, but with an\n   *     updated name.\n   */\n  renameVarById(oldId: string, newId: string) {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (field.referencesVariables() && oldId === field.getValue()) {\n          field.setValue(newId);\n        }\n      }\n    }\n  }\n\n  /**\n   * Returns the language-neutral value of the given field.\n   *\n   * @param name The name of the field.\n   * @returns Value of the field or null if field does not exist.\n   */\n  getFieldValue(name: string): AnyDuringMigration {\n    const field = this.getField(name);\n    if (field) {\n      return field.getValue();\n    }\n    return null;\n  }\n\n  /**\n   * Sets the value of the given field for this block.\n   *\n   * @param newValue The value to set.\n   * @param name The name of the field to set the value of.\n   */\n  setFieldValue(newValue: AnyDuringMigration, name: string) {\n    const field = this.getField(name);\n    if (!field) {\n      throw Error('Field \"' + name + '\" not found.');\n    }\n    field.setValue(newValue);\n  }\n\n  /**\n   * Set whether this block can chain onto the bottom of another block.\n   *\n   * @param newBoolean True if there can be a previous statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  setPreviousStatement(\n    newBoolean: boolean,\n    opt_check?: string | string[] | null,\n  ) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.previousConnection) {\n        this.previousConnection = this.makeConnection_(\n          ConnectionType.PREVIOUS_STATEMENT,\n        );\n      }\n      this.previousConnection.setCheck(opt_check);\n    } else {\n      if (this.previousConnection) {\n        if (this.previousConnection.isConnected()) {\n          throw Error(\n            'Must disconnect previous statement before removing ' +\n              'connection.',\n          );\n        }\n        this.previousConnection.dispose();\n        this.previousConnection = null;\n      }\n    }\n  }\n\n  /**\n   * Set whether another block can chain onto the bottom of this block.\n   *\n   * @param newBoolean True if there can be a next statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  setNextStatement(newBoolean: boolean, opt_check?: string | string[] | null) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.nextConnection) {\n        this.nextConnection = this.makeConnection_(\n          ConnectionType.NEXT_STATEMENT,\n        );\n      }\n      this.nextConnection.setCheck(opt_check);\n    } else {\n      if (this.nextConnection) {\n        if (this.nextConnection.isConnected()) {\n          throw Error(\n            'Must disconnect next statement before removing ' + 'connection.',\n          );\n        }\n        this.nextConnection.dispose();\n        this.nextConnection = null;\n      }\n    }\n  }\n\n  /**\n   * Set whether this block returns a value.\n   *\n   * @param newBoolean True if there is an output.\n   * @param opt_check Returned type or list of returned types.  Null or\n   *     undefined if any type could be returned (e.g. variable get).\n   */\n  setOutput(newBoolean: boolean, opt_check?: string | string[] | null) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.outputConnection) {\n        this.outputConnection = this.makeConnection_(\n          ConnectionType.OUTPUT_VALUE,\n        );\n      }\n      this.outputConnection.setCheck(opt_check);\n    } else {\n      if (this.outputConnection) {\n        if (this.outputConnection.isConnected()) {\n          throw Error(\n            'Must disconnect output value before removing connection.',\n          );\n        }\n        this.outputConnection.dispose();\n        this.outputConnection = null;\n      }\n    }\n  }\n\n  /**\n   * Set whether value inputs are arranged horizontally or vertically.\n   *\n   * @param newBoolean True if inputs are horizontal.\n   */\n  setInputsInline(newBoolean: boolean) {\n    if (this.inputsInline !== newBoolean) {\n      eventUtils.fire(\n        new (eventUtils.get(EventType.BLOCK_CHANGE))(\n          this,\n          'inline',\n          null,\n          this.inputsInline,\n          newBoolean,\n        ),\n      );\n      this.inputsInline = newBoolean;\n    }\n  }\n\n  /**\n   * Get whether value inputs are arranged horizontally or vertically.\n   *\n   * @returns True if inputs are horizontal.\n   */\n  getInputsInline(): boolean {\n    if (this.inputsInline !== undefined) {\n      // Set explicitly.\n      return this.inputsInline;\n    }\n    // Not defined explicitly.  Figure out what would look best.\n    for (let i = 1; i < this.inputList.length; i++) {\n      if (\n        this.inputList[i - 1] instanceof DummyInput &&\n        this.inputList[i] instanceof DummyInput\n      ) {\n        // Two dummy inputs in a row.  Don't inline them.\n        return false;\n      }\n    }\n    for (let i = 1; i < this.inputList.length; i++) {\n      if (\n        this.inputList[i - 1] instanceof ValueInput &&\n        this.inputList[i] instanceof DummyInput\n      ) {\n        // Dummy input after a value input.  Inline them.\n        return true;\n      }\n    }\n    for (let i = 0; i < this.inputList.length; i++) {\n      if (this.inputList[i] instanceof EndRowInput) {\n        // A row-end input is present. Inline value inputs.\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Set the block's output shape.\n   *\n   * @param outputShape Value representing an output shape.\n   */\n  setOutputShape(outputShape: number | null) {\n    this.outputShape_ = outputShape;\n  }\n\n  /**\n   * Get the block's output shape.\n   *\n   * @returns Value representing output shape if one exists.\n   */\n  getOutputShape(): number | null {\n    return this.outputShape_;\n  }\n\n  /**\n   * Get whether this block is enabled or not. A block is considered enabled\n   * if there aren't any reasons why it would be disabled. A block may still\n   * be disabled for other reasons even if the user attempts to manually\n   * enable it, such as when the block is in an invalid location.\n   *\n   * @returns True if enabled.\n   */\n  isEnabled(): boolean {\n    return this.disabledReasons.size === 0;\n  }\n\n  /** @deprecated v11 - Get whether the block is manually disabled. */\n  private get disabled(): boolean {\n    deprecation.warn(\n      'disabled',\n      'v11',\n      'v12',\n      'the isEnabled or hasDisabledReason methods of Block',\n    );\n    return this.hasDisabledReason(constants.MANUALLY_DISABLED);\n  }\n\n  /** @deprecated v11 - Set whether the block is manually disabled. */\n  private set disabled(value: boolean) {\n    deprecation.warn(\n      'disabled',\n      'v11',\n      'v12',\n      'the setDisabledReason method of Block',\n    );\n    this.setDisabledReason(value, constants.MANUALLY_DISABLED);\n  }\n\n  /**\n   * @deprecated v11 - Set whether the block is manually enabled or disabled.\n   * The user can toggle whether a block is disabled from a context menu\n   * option. A block may still be disabled for other reasons even if the user\n   * attempts to manually enable it, such as when the block is in an invalid\n   * location. This method is deprecated and setDisabledReason should be used\n   * instead.\n   *\n   * @param enabled True if enabled.\n   */\n  setEnabled(enabled: boolean) {\n    deprecation.warn(\n      'setEnabled',\n      'v11',\n      'v12',\n      'the setDisabledReason method of Block',\n    );\n    this.setDisabledReason(!enabled, constants.MANUALLY_DISABLED);\n  }\n\n  /**\n   * Add or remove a reason why the block might be disabled. If a block has\n   * any reasons to be disabled, then the block itself will be considered\n   * disabled. A block could be disabled for multiple independent reasons\n   * simultaneously, such as when the user manually disables it, or the block\n   * is invalid.\n   *\n   * @param disabled If true, then the block should be considered disabled for\n   *     at least the provided reason, otherwise the block is no longer disabled\n   *     for that reason.\n   * @param reason A language-neutral identifier for a reason why the block\n   *     could be disabled. Call this method again with the same identifier to\n   *     update whether the block is currently disabled for this reason.\n   */\n  setDisabledReason(disabled: boolean, reason: string): void {\n    // Workspaces that were serialized before the reason for being disabled\n    // could be specified may have blocks that are disabled without a known\n    // reason. On being loaded, these blocks will default to having the manually\n    // disabled reason. However, if the user isn't allowed to manually disable\n    // or enable blocks, then this manually disabled reason cannot be removed.\n    // For backward compatibility with these legacy workspaces, when removing\n    // any disabled reason and the workspace does not allow manually disabling\n    // but the block is manually disabled, then remove the manually disabled\n    // reason in addition to the more specific reason. For example, when an\n    // orphaned block is no longer orphaned, the block should be enabled again.\n    if (\n      !disabled &&\n      !this.workspace.options.disable &&\n      this.hasDisabledReason(constants.MANUALLY_DISABLED) &&\n      reason != constants.MANUALLY_DISABLED\n    ) {\n      this.setDisabledReason(false, constants.MANUALLY_DISABLED);\n    }\n\n    if (this.disabledReasons.has(reason) !== disabled) {\n      if (disabled) {\n        this.disabledReasons.add(reason);\n      } else {\n        this.disabledReasons.delete(reason);\n      }\n      const blockChangeEvent = new (eventUtils.get(EventType.BLOCK_CHANGE))(\n        this,\n        'disabled',\n        /* name= */ null,\n        /* oldValue= */ !disabled,\n        /* newValue= */ disabled,\n      ) as BlockChange;\n      blockChangeEvent.setDisabledReason(reason);\n      eventUtils.fire(blockChangeEvent);\n    }\n  }\n\n  /**\n   * Get whether the block is disabled or not due to parents.\n   * The block's own disabled property is not considered.\n   *\n   * @returns True if disabled.\n   */\n  getInheritedDisabled(): boolean {\n    let ancestor = this.getSurroundParent();\n    while (ancestor) {\n      if (!ancestor.isEnabled()) {\n        return true;\n      }\n      ancestor = ancestor.getSurroundParent();\n    }\n    // Ran off the top.\n    return false;\n  }\n\n  /**\n   * Get whether the block is currently disabled for the provided reason.\n   *\n   * @param reason A language-neutral identifier for a reason why the block\n   *     could be disabled.\n   * @returns Whether the block is disabled for the provided reason.\n   */\n  hasDisabledReason(reason: string): boolean {\n    return this.disabledReasons.has(reason);\n  }\n\n  /**\n   * Get a set of reasons why the block is currently disabled, if any. If the\n   * block is enabled, this set will be empty.\n   *\n   * @returns The set of reasons why the block is disabled, if any.\n   */\n  getDisabledReasons(): ReadonlySet<string> {\n    return this.disabledReasons;\n  }\n\n  /**\n   * Get whether the block is collapsed or not.\n   *\n   * @returns True if collapsed.\n   */\n  isCollapsed(): boolean {\n    return this.collapsed_;\n  }\n\n  /**\n   * Set whether the block is collapsed or not.\n   *\n   * @param collapsed True if collapsed.\n   */\n  setCollapsed(collapsed: boolean) {\n    if (this.collapsed_ !== collapsed) {\n      eventUtils.fire(\n        new (eventUtils.get(EventType.BLOCK_CHANGE))(\n          this,\n          'collapsed',\n          null,\n          this.collapsed_,\n          collapsed,\n        ),\n      );\n      this.collapsed_ = collapsed;\n    }\n  }\n\n  /**\n   * Create a human-readable text representation of this block and any children.\n   *\n   * @param opt_maxLength Truncate the string to this length.\n   * @param opt_emptyToken The placeholder string used to denote an empty input.\n   *     If not specified, '?' is used.\n   * @returns Text of block.\n   */\n  toString(opt_maxLength?: number, opt_emptyToken?: string): string {\n    const tokens = this.toTokens(opt_emptyToken);\n\n    // Run through our tokens array and simplify expression to remove\n    // parentheses around single field blocks.\n    // E.g. ['repeat', '(', '10', ')', 'times', 'do', '?']\n    for (let i = 2; i < tokens.length; i++) {\n      if (tokens[i - 2] === '(' && tokens[i] === ')') {\n        tokens[i - 2] = tokens[i - 1];\n        tokens.splice(i - 1, 2);\n      }\n    }\n\n    // Join the text array, removing the spaces around added parentheses.\n    let prev = '';\n    let text: string = tokens.reduce((acc, curr) => {\n      const val = acc + (prev === '(' || curr === ')' ? '' : ' ') + curr;\n      prev = curr[curr.length - 1];\n      return val;\n    }, '');\n\n    text = text.trim() || '???';\n    if (opt_maxLength) {\n      // TODO: Improve truncation so that text from this block is given\n      // priority. E.g. \"1+2+3+4+5+6+7+8+9=0\" should be \"...6+7+8+9=0\", not\n      // \"1+2+3+4+5...\". E.g. \"1+2+3+4+5=6+7+8+9+0\" should be \"...4+5=6+7...\".\n      if (text.length > opt_maxLength) {\n        text = text.substring(0, opt_maxLength - 3) + '...';\n      }\n    }\n    return text;\n  }\n\n  /**\n   * Converts this block into string tokens.\n   *\n   * @param emptyToken The token to use in place of an empty input.\n   *     Defaults to '?'.\n   * @returns The array of string tokens representing this block.\n   */\n  private toTokens(emptyToken = '?'): string[] {\n    const tokens = [];\n    /**\n     * Whether or not to add parentheses around an input.\n     *\n     * @param connection The connection.\n     * @returns True if we should add parentheses around the input.\n     */\n    function shouldAddParentheses(connection: Connection): boolean {\n      let checks = connection.getCheck();\n      if (!checks && connection.targetConnection) {\n        checks = connection.targetConnection.getCheck();\n      }\n      return (\n        !!checks && (checks.includes('Boolean') || checks.includes('Number'))\n      );\n    }\n\n    for (const input of this.inputList) {\n      if (input.name == constants.COLLAPSED_INPUT_NAME) {\n        continue;\n      }\n      for (const field of input.fieldRow) {\n        tokens.push(field.getText());\n      }\n      if (input.connection) {\n        const child = input.connection.targetBlock();\n        if (child) {\n          const shouldAddParens = shouldAddParentheses(input.connection);\n          if (shouldAddParens) tokens.push('(');\n          tokens.push(...child.toTokens(emptyToken));\n          if (shouldAddParens) tokens.push(')');\n        } else {\n          tokens.push(emptyToken);\n        }\n      }\n    }\n    return tokens;\n  }\n\n  /**\n   * Appends a value input row.\n   *\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendValueInput(name: string): Input {\n    return this.appendInput(new ValueInput(name, this));\n  }\n\n  /**\n   * Appends a statement input row.\n   *\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendStatementInput(name: string): Input {\n    this.statementInputCount++;\n    return this.appendInput(new StatementInput(name, this));\n  }\n\n  /**\n   * Appends a dummy input row.\n   *\n   * @param name Optional language-neutral identifier which may used to find\n   *     this input again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendDummyInput(name = ''): Input {\n    return this.appendInput(new DummyInput(name, this));\n  }\n\n  /**\n   * Appends an input that ends the row.\n   *\n   * @param name Optional language-neutral identifier which may used to find\n   *     this input again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendEndRowInput(name = ''): Input {\n    return this.appendInput(new EndRowInput(name, this));\n  }\n\n  /**\n   * Appends the given input row.\n   *\n   * Allows for custom inputs to be appended to the block.\n   */\n  appendInput(input: Input): Input {\n    this.inputList.push(input);\n    return input;\n  }\n\n  /**\n   * Appends an input with the given input type and name to the block after\n   * constructing it from the registry.\n   *\n   * @param type The name the input is registered under in the registry.\n   * @param name The name the input will have within the block.\n   * @returns The constucted input, or null if there was no constructor\n   *     associated with the type.\n   */\n  private appendInputFromRegistry(type: string, name: string): Input | null {\n    const inputConstructor = registry.getClass(\n      registry.Type.INPUT,\n      type,\n      false,\n    );\n    if (!inputConstructor) return null;\n    return this.appendInput(new inputConstructor(name, this));\n  }\n\n  /**\n   * Initialize this block using a cross-platform, internationalization-friendly\n   * JSON description.\n   *\n   * @param json Structured data describing the block.\n   */\n  jsonInit(json: AnyDuringMigration) {\n    const warningPrefix = json['type'] ? 'Block \"' + json['type'] + '\": ' : '';\n\n    // Validate inputs.\n    if (json['output'] && json['previousStatement']) {\n      throw Error(\n        warningPrefix + 'Must not have both an output and a previousStatement.',\n      );\n    }\n\n    // Validate that each arg has a corresponding message\n    let n = 0;\n    while (json['args' + n]) {\n      if (json['message' + n] === undefined) {\n        throw Error(\n          warningPrefix +\n            `args${n} must have a corresponding message (message${n}).`,\n        );\n      }\n      n++;\n    }\n\n    // Set basic properties of block.\n    // Makes styles backward compatible with old way of defining hat style.\n    if (json['style'] && json['style'].hat) {\n      this.hat = json['style'].hat;\n      // Must set to null so it doesn't error when checking for style and\n      // colour.\n      json['style'] = null;\n    }\n\n    if (json['style'] && json['colour']) {\n      throw Error(warningPrefix + 'Must not have both a colour and a style.');\n    } else if (json['style']) {\n      this.jsonInitStyle(json, warningPrefix);\n    } else {\n      this.jsonInitColour(json, warningPrefix);\n    }\n\n    // Interpolate the message blocks.\n    let i = 0;\n    while (json['message' + i] !== undefined) {\n      this.interpolate(\n        json['message' + i],\n        json['args' + i] || [],\n        // Backwards compatibility: lastDummyAlign aliases implicitAlign.\n        json['implicitAlign' + i] || json['lastDummyAlign' + i],\n        warningPrefix,\n      );\n      i++;\n    }\n\n    if (json['inputsInline'] !== undefined) {\n      eventUtils.disable();\n      this.setInputsInline(json['inputsInline']);\n      eventUtils.enable();\n    }\n\n    // Set output and previous/next connections.\n    if (json['output'] !== undefined) {\n      this.setOutput(true, json['output']);\n    }\n    if (json['outputShape'] !== undefined) {\n      this.setOutputShape(json['outputShape']);\n    }\n    if (json['previousStatement'] !== undefined) {\n      this.setPreviousStatement(true, json['previousStatement']);\n    }\n    if (json['nextStatement'] !== undefined) {\n      this.setNextStatement(true, json['nextStatement']);\n    }\n    if (json['tooltip'] !== undefined) {\n      const rawValue = json['tooltip'];\n      const localizedText = parsing.replaceMessageReferences(rawValue);\n      this.setTooltip(localizedText);\n    }\n    if (json['enableContextMenu'] !== undefined) {\n      this.contextMenu = !!json['enableContextMenu'];\n    }\n    if (json['suppressPrefixSuffix'] !== undefined) {\n      this.suppressPrefixSuffix = !!json['suppressPrefixSuffix'];\n    }\n    if (json['helpUrl'] !== undefined) {\n      const rawValue = json['helpUrl'];\n      const localizedValue = parsing.replaceMessageReferences(rawValue);\n      this.setHelpUrl(localizedValue);\n    }\n    if (typeof json['extensions'] === 'string') {\n      console.warn(\n        warningPrefix +\n          \"JSON attribute 'extensions' should be an array of\" +\n          \" strings. Found raw string in JSON for '\" +\n          json['type'] +\n          \"' block.\",\n      );\n      json['extensions'] = [json['extensions']]; // Correct and continue.\n    }\n\n    // Add the mutator to the block.\n    if (json['mutator'] !== undefined) {\n      Extensions.apply(json['mutator'], this, true);\n    }\n\n    const extensionNames = json['extensions'];\n    if (Array.isArray(extensionNames)) {\n      for (let j = 0; j < extensionNames.length; j++) {\n        Extensions.apply(extensionNames[j], this, false);\n      }\n    }\n  }\n\n  /**\n   * Initialize the colour of this block from the JSON description.\n   *\n   * @param json Structured data describing the block.\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private jsonInitColour(json: AnyDuringMigration, warningPrefix: string) {\n    if ('colour' in json) {\n      if (json['colour'] === undefined) {\n        console.warn(warningPrefix + 'Undefined colour value.');\n      } else {\n        const rawValue = json['colour'];\n        try {\n          this.setColour(rawValue);\n        } catch {\n          console.warn(warningPrefix + 'Illegal colour value: ', rawValue);\n        }\n      }\n    }\n  }\n\n  /**\n   * Initialize the style of this block from the JSON description.\n   *\n   * @param json Structured data describing the block.\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private jsonInitStyle(json: AnyDuringMigration, warningPrefix: string) {\n    const blockStyleName = json['style'];\n    try {\n      this.setStyle(blockStyleName);\n    } catch {\n      console.warn(warningPrefix + 'Style does not exist: ', blockStyleName);\n    }\n  }\n\n  /**\n   * Add key/values from mixinObj to this block object. By default, this method\n   * will check that the keys in mixinObj will not overwrite existing values in\n   * the block, including prototype values. This provides some insurance against\n   * mixin / extension incompatibilities with future block features. This check\n   * can be disabled by passing true as the second argument.\n   *\n   * @param mixinObj The key/values pairs to add to this block object.\n   * @param opt_disableCheck Option flag to disable overwrite checks.\n   */\n  mixin(mixinObj: AnyDuringMigration, opt_disableCheck?: boolean) {\n    if (\n      opt_disableCheck !== undefined &&\n      typeof opt_disableCheck !== 'boolean'\n    ) {\n      throw Error('opt_disableCheck must be a boolean if provided');\n    }\n    if (!opt_disableCheck) {\n      const overwrites = [];\n      for (const key in mixinObj) {\n        if ((this as AnyDuringMigration)[key] !== undefined) {\n          overwrites.push(key);\n        }\n      }\n      if (overwrites.length) {\n        throw Error(\n          'Mixin will overwrite block members: ' + JSON.stringify(overwrites),\n        );\n      }\n    }\n    Object.assign(this, mixinObj);\n  }\n\n  /**\n   * Interpolate a message description onto the block.\n   *\n   * @param message Text contains interpolation tokens (%1, %2, ...) that match\n   *     with fields or inputs defined in the args array.\n   * @param args Array of arguments to be interpolated.\n   * @param implicitAlign If an implicit input is added at the end or in place\n   *     of newline tokens, how should it be aligned?\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private interpolate(\n    message: string,\n    args: AnyDuringMigration[],\n    implicitAlign: string | undefined,\n    warningPrefix: string,\n  ) {\n    const tokens = parsing.tokenizeInterpolation(message);\n    this.validateTokens(tokens, args.length);\n    const elements = this.interpolateArguments(tokens, args, implicitAlign);\n\n    // An array of [field, fieldName] tuples.\n    const fieldStack = [];\n    for (let i = 0, element; (element = elements[i]); i++) {\n      if (this.isInputKeyword(element['type'])) {\n        const input = this.inputFromJson(element, warningPrefix);\n        // Should never be null, but just in case.\n        if (input) {\n          for (let j = 0, tuple; (tuple = fieldStack[j]); j++) {\n            input.appendField(tuple[0], tuple[1]);\n          }\n          fieldStack.length = 0;\n        }\n      } else {\n        // All other types, including ones starting with 'input_' get routed\n        // here.\n        const field = this.fieldFromJson(element);\n        if (field) {\n          fieldStack.push([field, element['name']]);\n        }\n      }\n    }\n  }\n\n  /**\n   * Validates that the tokens are within the correct bounds, with no\n   * duplicates, and that all of the arguments are referred to. Throws errors if\n   * any of these things are not true.\n   *\n   * @param tokens An array of tokens to validate\n   * @param argsCount The number of args that need to be referred to.\n   */\n  private validateTokens(tokens: Array<string | number>, argsCount: number) {\n    const visitedArgsHash = [];\n    let visitedArgsCount = 0;\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n      if (typeof token !== 'number') {\n        continue;\n      }\n      if (token < 1 || token > argsCount) {\n        throw Error(\n          'Block \"' +\n            this.type +\n            '\": ' +\n            'Message index %' +\n            token +\n            ' out of range.',\n        );\n      }\n      if (visitedArgsHash[token]) {\n        throw Error(\n          'Block \"' +\n            this.type +\n            '\": ' +\n            'Message index %' +\n            token +\n            ' duplicated.',\n        );\n      }\n      visitedArgsHash[token] = true;\n      visitedArgsCount++;\n    }\n    if (visitedArgsCount !== argsCount) {\n      throw Error(\n        'Block \"' +\n          this.type +\n          '\": ' +\n          'Message does not reference all ' +\n          argsCount +\n          ' arg(s).',\n      );\n    }\n  }\n\n  /**\n   * Inserts args in place of numerical tokens. String args are converted to\n   * JSON that defines a label field. Newline characters are converted to\n   * end-row inputs, and if necessary an extra dummy input is added to the end\n   * of the elements.\n   *\n   * @param tokens The tokens to interpolate\n   * @param args The arguments to insert.\n   * @param implicitAlign The alignment to use for any implicitly added end-row\n   *     or dummy inputs, if necessary.\n   * @returns The JSON definitions of field and inputs to add to the block.\n   */\n  private interpolateArguments(\n    tokens: Array<string | number>,\n    args: Array<AnyDuringMigration | string>,\n    implicitAlign: string | undefined,\n  ): AnyDuringMigration[] {\n    const elements = [];\n    for (let i = 0; i < tokens.length; i++) {\n      let element = tokens[i];\n      if (typeof element === 'number') {\n        element = args[element - 1];\n      }\n      // Args can be strings, which is why this isn't elseif.\n      if (typeof element === 'string') {\n        if (element === '\\n') {\n          // Convert newline tokens to end-row inputs.\n          const newlineInput = {'type': 'input_end_row'};\n          if (implicitAlign) {\n            (newlineInput as AnyDuringMigration)['align'] = implicitAlign;\n          }\n          element = newlineInput as AnyDuringMigration;\n        } else {\n          // AnyDuringMigration because:  Type '{ text: string; type: string; }\n          // | null' is not assignable to type 'string | number'.\n          element = this.stringToFieldJson(element) as AnyDuringMigration;\n          if (!element) {\n            continue;\n          }\n        }\n      }\n      elements.push(element);\n    }\n\n    const length = elements.length;\n    if (\n      length &&\n      !this.isInputKeyword((elements as AnyDuringMigration)[length - 1]['type'])\n    ) {\n      const dummyInput = {'type': 'input_dummy'};\n      if (implicitAlign) {\n        (dummyInput as AnyDuringMigration)['align'] = implicitAlign;\n      }\n      elements.push(dummyInput);\n    }\n\n    return elements;\n  }\n\n  /**\n   * Creates a field from the JSON definition of a field. If a field with the\n   * given type cannot be found, this attempts to create a different field using\n   * the 'alt' property of the JSON definition (if it exists).\n   *\n   * @param element The element to try to turn into a field.\n   * @returns The field defined by the JSON, or null if one couldn't be created.\n   */\n  private fieldFromJson(element: {\n    alt?: string;\n    type: string;\n    text?: string;\n  }): Field | null {\n    const field = fieldRegistry.fromJson(element);\n    if (!field && element['alt']) {\n      if (typeof element['alt'] === 'string') {\n        const json = this.stringToFieldJson(element['alt']);\n        return json ? this.fieldFromJson(json) : null;\n      }\n      return this.fieldFromJson(element['alt']);\n    }\n    return field;\n  }\n\n  /**\n   * Creates an input from the JSON definition of an input. Sets the input's\n   * check and alignment if they are provided.\n   *\n   * @param element The JSON to turn into an input.\n   * @param warningPrefix The prefix to add to warnings to help the developer\n   *     debug.\n   * @returns The input that has been created, or null if one could not be\n   *     created for some reason (should never happen).\n   */\n  private inputFromJson(\n    element: AnyDuringMigration,\n    warningPrefix: string,\n  ): Input | null {\n    const alignmentLookup = {\n      'LEFT': Align.LEFT,\n      'RIGHT': Align.RIGHT,\n      'CENTRE': Align.CENTRE,\n      'CENTER': Align.CENTRE,\n    };\n\n    let input = null;\n    switch (element['type']) {\n      case 'input_value':\n        input = this.appendValueInput(element['name']);\n        break;\n      case 'input_statement':\n        input = this.appendStatementInput(element['name']);\n        break;\n      case 'input_dummy':\n        input = this.appendDummyInput(element['name']);\n        break;\n      case 'input_end_row':\n        input = this.appendEndRowInput(element['name']);\n        break;\n      default: {\n        input = this.appendInputFromRegistry(element['type'], element['name']);\n        break;\n      }\n    }\n    // Should never be hit because of interpolate_'s checks, but just in case.\n    if (!input) {\n      return null;\n    }\n\n    if (element['check']) {\n      input.setCheck(element['check']);\n    }\n    if (element['align']) {\n      const alignment = (alignmentLookup as AnyDuringMigration)[\n        element['align'].toUpperCase()\n      ];\n      if (alignment === undefined) {\n        console.warn(warningPrefix + 'Illegal align value: ', element['align']);\n      } else {\n        input.setAlign(alignment);\n      }\n    }\n    return input;\n  }\n\n  /**\n   * Returns true if the given string matches one of the input keywords.\n   *\n   * @param str The string to check.\n   * @returns True if the given string matches one of the input keywords, false\n   *     otherwise.\n   */\n  private isInputKeyword(str: string): boolean {\n    return (\n      str === 'input_value' ||\n      str === 'input_statement' ||\n      str === 'input_dummy' ||\n      str === 'input_end_row' ||\n      registry.hasItem(registry.Type.INPUT, str)\n    );\n  }\n\n  /**\n   * Turns a string into the JSON definition of a label field. If the string\n   * becomes an empty string when trimmed, this returns null.\n   *\n   * @param str String to turn into the JSON definition of a label field.\n   * @returns The JSON definition or null.\n   */\n  private stringToFieldJson(str: string): {text: string; type: string} | null {\n    str = str.trim();\n    if (str) {\n      return {\n        'type': 'field_label',\n        'text': str,\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Move a named input to a different location on this block.\n   *\n   * @param name The name of the input to move.\n   * @param refName Name of input that should be after the moved input, or null\n   *     to be the input at the end.\n   */\n  moveInputBefore(name: string, refName: string | null) {\n    if (name === refName) {\n      return;\n    }\n    // Find both inputs.\n    let inputIndex = -1;\n    let refIndex = refName ? -1 : this.inputList.length;\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.name === name) {\n        inputIndex = i;\n        if (refIndex !== -1) {\n          break;\n        }\n      } else if (refName && input.name === refName) {\n        refIndex = i;\n        if (inputIndex !== -1) {\n          break;\n        }\n      }\n    }\n    if (inputIndex === -1) {\n      throw Error('Named input \"' + name + '\" not found.');\n    }\n    if (refIndex === -1) {\n      throw Error('Reference input \"' + refName + '\" not found.');\n    }\n    this.moveNumberedInputBefore(inputIndex, refIndex);\n  }\n\n  /**\n   * Move a numbered input to a different location on this block.\n   *\n   * @param inputIndex Index of the input to move.\n   * @param refIndex Index of input that should be after the moved input.\n   */\n  moveNumberedInputBefore(inputIndex: number, refIndex: number) {\n    // Validate arguments.\n    if (inputIndex === refIndex) {\n      throw Error(\"Can't move input to itself.\");\n    }\n    if (inputIndex >= this.inputList.length) {\n      throw RangeError('Input index ' + inputIndex + ' out of bounds.');\n    }\n    if (refIndex > this.inputList.length) {\n      throw RangeError('Reference input ' + refIndex + ' out of bounds.');\n    }\n    // Remove input.\n    const input = this.inputList[inputIndex];\n    this.inputList.splice(inputIndex, 1);\n    if (inputIndex < refIndex) {\n      refIndex--;\n    }\n    // Reinsert input.\n    this.inputList.splice(refIndex, 0, input);\n  }\n\n  /**\n   * Remove an input from this block.\n   *\n   * @param name The name of the input.\n   * @param opt_quiet True to prevent an error if input is not present.\n   * @returns True if operation succeeds, false if input is not present and\n   *     opt_quiet is true.\n   * @throws {Error} if the input is not present and opt_quiet is not true.\n   */\n  removeInput(name: string, opt_quiet?: boolean): boolean {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.name === name) {\n        if (input instanceof StatementInput) this.statementInputCount--;\n        input.dispose();\n        this.inputList.splice(i, 1);\n        return true;\n      }\n    }\n    if (opt_quiet) {\n      return false;\n    }\n    throw Error('Input not found: ' + name);\n  }\n\n  /**\n   * Fetches the named input object.\n   *\n   * @param name The name of the input.\n   * @returns The input object, or null if input does not exist.\n   */\n  getInput(name: string): Input | null {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.name === name) {\n        return input;\n      }\n    }\n    // This input does not exist.\n    return null;\n  }\n\n  /**\n   * Fetches the block attached to the named input.\n   *\n   * @param name The name of the input.\n   * @returns The attached value block, or null if the input is either\n   *     disconnected or if the input does not exist.\n   */\n  getInputTargetBlock(name: string): Block | null {\n    const input = this.getInput(name);\n    return input && input.connection && input.connection.targetBlock();\n  }\n\n  /**\n   * Returns the comment on this block (or null if there is no comment).\n   *\n   * @returns Block's comment.\n   */\n  getCommentText(): string | null {\n    const comment = this.getIcon(IconType.COMMENT);\n    return comment?.getText() ?? null;\n  }\n\n  /**\n   * Set this block's comment text.\n   *\n   * @param text The text, or null to delete.\n   */\n  setCommentText(text: string | null) {\n    const comment = this.getIcon(IconType.COMMENT);\n    const oldText = comment?.getText() ?? null;\n    if (oldText === text) return;\n    if (text !== null) {\n      let comment = this.getIcon(IconType.COMMENT);\n      if (!comment) {\n        const commentConstructor = registry.getClass(\n          registry.Type.ICON,\n          IconType.COMMENT.toString(),\n          false,\n        );\n        if (!commentConstructor) {\n          throw new Error(\n            'No comment icon class is registered, so a comment cannot be set',\n          );\n        }\n        const icon = new commentConstructor(this);\n        if (!isCommentIcon(icon)) {\n          throw new Error(\n            'The class registered as a comment icon does not conform to the ' +\n              'ICommentIcon interface',\n          );\n        }\n        comment = this.addIcon(icon);\n      }\n      eventUtils.disable();\n      comment.setText(text);\n      eventUtils.enable();\n    } else {\n      this.removeIcon(IconType.COMMENT);\n    }\n\n    eventUtils.fire(\n      new (eventUtils.get(EventType.BLOCK_CHANGE))(\n        this,\n        'comment',\n        null,\n        oldText,\n        text,\n      ),\n    );\n  }\n\n  /**\n   * Set this block's warning text.\n   *\n   * @param _text The text, or null to delete.\n   * @param _opt_id An optional ID for the warning text to be able to maintain\n   *     multiple warnings.\n   */\n  setWarningText(_text: string | null, _opt_id?: string) {\n    // NOOP.\n  }\n\n  /**\n   * Give this block a mutator dialog.\n   *\n   * @param _mutator A mutator dialog instance or null to remove.\n   */\n  setMutator(_mutator: MutatorIcon) {\n    // NOOP.\n  }\n\n  /** Adds the given icon to the block. */\n  addIcon<T extends IIcon>(icon: T): T {\n    if (this.hasIcon(icon.getType())) throw new DuplicateIconType(icon);\n    this.icons.push(icon);\n    this.icons.sort((a, b) => a.getWeight() - b.getWeight());\n    return icon;\n  }\n\n  /**\n   * Removes the icon whose getType matches the given type iconType from the\n   * block.\n   *\n   * @param type The type of the icon to remove from the block.\n   * @returns True if an icon with the given type was found, false otherwise.\n   */\n  removeIcon(type: IconType<IIcon>): boolean {\n    if (!this.hasIcon(type)) return false;\n    this.getIcon(type)?.dispose();\n    this.icons = this.icons.filter((icon) => !icon.getType().equals(type));\n    return true;\n  }\n\n  /**\n   * @returns True if an icon with the given type exists on the block,\n   *     false otherwise.\n   */\n  hasIcon(type: IconType<IIcon>): boolean {\n    return this.icons.some((icon) => icon.getType().equals(type));\n  }\n\n  /**\n   * @param type The type of the icon to retrieve. Prefer passing an `IconType`\n   *     for proper type checking when using typescript.\n   * @returns The icon with the given type if it exists on the block, undefined\n   *     otherwise.\n   */\n  getIcon<T extends IIcon>(type: IconType<T> | string): T | undefined {\n    if (type instanceof IconType) {\n      return this.icons.find((icon) => icon.getType().equals(type)) as T;\n    } else {\n      return this.icons.find((icon) => icon.getType().toString() === type) as T;\n    }\n  }\n\n  /** @returns An array of the icons attached to this block. */\n  getIcons(): IIcon[] {\n    return [...this.icons];\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this block relative to the\n   * drawing surface's origin (0,0), in workspace units.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  getRelativeToSurfaceXY(): Coordinate {\n    return this.xy;\n  }\n\n  /**\n   * Move a block by a relative offset.\n   *\n   * @param dx Horizontal offset, in workspace units.\n   * @param dy Vertical offset, in workspace units.\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  moveBy(dx: number, dy: number, reason?: string[]) {\n    if (this.parentBlock_) {\n      throw Error('Block has parent');\n    }\n    const event = new (eventUtils.get(EventType.BLOCK_MOVE))(this) as BlockMove;\n    if (reason) event.setReason(reason);\n    this.xy.translate(dx, dy);\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Create a connection of the specified type.\n   *\n   * @param type The type of the connection to create.\n   * @returns A new connection of the specified type.\n   * @internal\n   */\n  makeConnection_(type: ConnectionType): Connection {\n    return new Connection(this, type);\n  }\n\n  /**\n   * Recursively checks whether all statement and value inputs are filled with\n   * blocks. Also checks all following statement blocks in this stack.\n   *\n   * @param opt_shadowBlocksAreFilled An optional argument controlling whether\n   *     shadow blocks are counted as filled. Defaults to true.\n   * @returns True if all inputs are filled, false otherwise.\n   */\n  allInputsFilled(opt_shadowBlocksAreFilled?: boolean): boolean {\n    // Account for the shadow block filledness toggle.\n    if (opt_shadowBlocksAreFilled === undefined) {\n      opt_shadowBlocksAreFilled = true;\n    }\n    if (!opt_shadowBlocksAreFilled && this.isShadow()) {\n      return false;\n    }\n\n    // Recursively check each input block of the current block.\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (!input.connection) {\n        continue;\n      }\n      const target = input.connection.targetBlock();\n      if (!target || !target.allInputsFilled(opt_shadowBlocksAreFilled)) {\n        return false;\n      }\n    }\n\n    // Recursively check the next block after the current block.\n    const next = this.getNextBlock();\n    if (next) {\n      return next.allInputsFilled(opt_shadowBlocksAreFilled);\n    }\n\n    return true;\n  }\n\n  /**\n   * This method returns a string describing this Block in developer terms (type\n   * name and ID; English only).\n   *\n   * Intended to on be used in console logs and errors. If you need a string\n   * that uses the user's native language (including block text, field values,\n   * and child blocks), use [toString()]{@link Block#toString}.\n   *\n   * @returns The description.\n   */\n  toDevString(): string {\n    let msg = this.type ? '\"' + this.type + '\" block' : 'Block';\n    if (this.id) {\n      msg += ' (id=\"' + this.id + '\")';\n    }\n    return msg;\n  }\n}\n\nexport namespace Block {\n  export interface CommentModel {\n    text: string | null;\n    pinned: boolean;\n    size: Size;\n  }\n}\n\nexport type CommentModel = Block.CommentModel;\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a button in the flyout.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FlyoutButton\n\nimport type {IASTNodeLocationSvg} from './blockly.js';\nimport * as browserEvents from './browser_events.js';\nimport * as Css from './css.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport type * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a button or label in the flyout.\n */\nexport class FlyoutButton implements IASTNodeLocationSvg {\n  /** The horizontal margin around the text in the button. */\n  static TEXT_MARGIN_X = 5;\n\n  /** The vertical margin around the text in the button. */\n  static TEXT_MARGIN_Y = 2;\n\n  /** The radius of the flyout button's borders. */\n  static BORDER_RADIUS = 4;\n\n  private readonly text: string;\n  private readonly position: Coordinate;\n  private readonly callbackKey: string;\n  private readonly cssClass: string | null;\n\n  /** Mouse up event data. */\n  private onMouseUpWrapper: browserEvents.Data | null = null;\n  info: toolbox.ButtonOrLabelInfo;\n\n  /** The width of the button's rect. */\n  width = 0;\n\n  /** The height of the button's rect. */\n  height = 0;\n\n  /** The root SVG group for the button or label. */\n  private svgGroup: SVGGElement | null = null;\n\n  /** The SVG element with the text of the label or button. */\n  private svgText: SVGTextElement | null = null;\n\n  /**\n   * Holds the cursors svg element when the cursor is attached to the button.\n   * This is null if there is no cursor on the button.\n   */\n  cursorSvg: SVGElement | null = null;\n\n  /**\n   * @param workspace The workspace in which to place this button.\n   * @param targetWorkspace The flyout's target workspace.\n   * @param json The JSON specifying the label/button.\n   * @param isFlyoutLabel Whether this button should be styled as a label.\n   * @internal\n   */\n  constructor(\n    private readonly workspace: WorkspaceSvg,\n    private readonly targetWorkspace: WorkspaceSvg,\n    json: toolbox.ButtonOrLabelInfo,\n    private readonly isFlyoutLabel: boolean,\n  ) {\n    this.text = json['text'];\n\n    this.position = new Coordinate(0, 0);\n\n    /** The key to the function called when this button is clicked. */\n    this.callbackKey =\n      (json as AnyDuringMigration)[\n        'callbackKey'\n      ] /* Check the lower case version\n                                                   too to satisfy IE */ ||\n      (json as AnyDuringMigration)['callbackkey'];\n\n    /** If specified, a CSS class to add to this button. */\n    this.cssClass = (json as AnyDuringMigration)['web-class'] || null;\n\n    /** The JSON specifying the label / button. */\n    this.info = json;\n  }\n\n  /**\n   * Create the button elements.\n   *\n   * @returns The button's SVG group.\n   */\n  createDom(): SVGElement {\n    let cssClass = this.isFlyoutLabel\n      ? 'blocklyFlyoutLabel'\n      : 'blocklyFlyoutButton';\n    if (this.cssClass) {\n      cssClass += ' ' + this.cssClass;\n    }\n\n    this.svgGroup = dom.createSvgElement(\n      Svg.G,\n      {'class': cssClass},\n      this.workspace.getCanvas(),\n    );\n\n    let shadow;\n    if (!this.isFlyoutLabel) {\n      // Shadow rectangle (light source does not mirror in RTL).\n      shadow = dom.createSvgElement(\n        Svg.RECT,\n        {\n          'class': 'blocklyFlyoutButtonShadow',\n          'rx': FlyoutButton.BORDER_RADIUS,\n          'ry': FlyoutButton.BORDER_RADIUS,\n          'x': 1,\n          'y': 1,\n        },\n        this.svgGroup!,\n      );\n    }\n    // Background rectangle.\n    const rect = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': this.isFlyoutLabel\n          ? 'blocklyFlyoutLabelBackground'\n          : 'blocklyFlyoutButtonBackground',\n        'rx': FlyoutButton.BORDER_RADIUS,\n        'ry': FlyoutButton.BORDER_RADIUS,\n      },\n      this.svgGroup!,\n    );\n\n    const svgText = dom.createSvgElement(\n      Svg.TEXT,\n      {\n        'class': this.isFlyoutLabel ? 'blocklyFlyoutLabelText' : 'blocklyText',\n        'x': 0,\n        'y': 0,\n        'text-anchor': 'middle',\n      },\n      this.svgGroup!,\n    );\n    let text = parsing.replaceMessageReferences(this.text);\n    if (this.workspace.RTL) {\n      // Force text to be RTL by adding an RLM.\n      text += '\\u200F';\n    }\n    svgText.textContent = text;\n    if (this.isFlyoutLabel) {\n      this.svgText = svgText;\n      this.workspace\n        .getThemeManager()\n        .subscribe(this.svgText, 'flyoutForegroundColour', 'fill');\n    }\n\n    const fontSize = style.getComputedStyle(svgText, 'fontSize');\n    const fontWeight = style.getComputedStyle(svgText, 'fontWeight');\n    const fontFamily = style.getComputedStyle(svgText, 'fontFamily');\n    this.width = dom.getFastTextWidthWithSizeString(\n      svgText,\n      fontSize,\n      fontWeight,\n      fontFamily,\n    );\n    const fontMetrics = dom.measureFontMetrics(\n      text,\n      fontSize,\n      fontWeight,\n      fontFamily,\n    );\n    this.height = fontMetrics.height;\n\n    if (!this.isFlyoutLabel) {\n      this.width += 2 * FlyoutButton.TEXT_MARGIN_X;\n      this.height += 2 * FlyoutButton.TEXT_MARGIN_Y;\n      shadow?.setAttribute('width', String(this.width));\n      shadow?.setAttribute('height', String(this.height));\n    }\n    rect.setAttribute('width', String(this.width));\n    rect.setAttribute('height', String(this.height));\n\n    svgText.setAttribute('x', String(this.width / 2));\n    svgText.setAttribute(\n      'y',\n      String(this.height / 2 - fontMetrics.height / 2 + fontMetrics.baseline),\n    );\n\n    this.updateTransform();\n\n    // AnyDuringMigration because:  Argument of type 'SVGGElement | null' is not\n    // assignable to parameter of type 'EventTarget'.\n    this.onMouseUpWrapper = browserEvents.conditionalBind(\n      this.svgGroup as AnyDuringMigration,\n      'pointerup',\n      this,\n      this.onMouseUp,\n    );\n    return this.svgGroup!;\n  }\n\n  /** Correctly position the flyout button and make it visible. */\n  show() {\n    this.updateTransform();\n    this.svgGroup!.setAttribute('display', 'block');\n  }\n\n  /** Update SVG attributes to match internal state. */\n  private updateTransform() {\n    this.svgGroup!.setAttribute(\n      'transform',\n      'translate(' + this.position.x + ',' + this.position.y + ')',\n    );\n  }\n\n  /**\n   * Move the button to the given x, y coordinates.\n   *\n   * @param x The new x coordinate.\n   * @param y The new y coordinate.\n   */\n  moveTo(x: number, y: number) {\n    this.position.x = x;\n    this.position.y = y;\n    this.updateTransform();\n  }\n\n  /** @returns Whether or not the button is a label. */\n  isLabel(): boolean {\n    return this.isFlyoutLabel;\n  }\n\n  /**\n   * Location of the button.\n   *\n   * @returns x, y coordinates.\n   * @internal\n   */\n  getPosition(): Coordinate {\n    return this.position;\n  }\n\n  /** @returns Text of the button. */\n  getButtonText(): string {\n    return this.text;\n  }\n\n  /**\n   * Get the button's target workspace.\n   *\n   * @returns The target workspace of the flyout where this button resides.\n   */\n  getTargetWorkspace(): WorkspaceSvg {\n    return this.targetWorkspace;\n  }\n\n  /**\n   * Get the button's workspace.\n   *\n   * @returns The workspace in which to place this button.\n   */\n  getWorkspace(): WorkspaceSvg {\n    return this.workspace;\n  }\n\n  /** Dispose of this button. */\n  dispose() {\n    if (this.onMouseUpWrapper) {\n      browserEvents.unbind(this.onMouseUpWrapper);\n    }\n    if (this.svgGroup) {\n      dom.removeNode(this.svgGroup);\n    }\n    if (this.svgText) {\n      this.workspace.getThemeManager().unsubscribe(this.svgText);\n    }\n  }\n\n  /**\n   * Add the cursor SVG to this buttons's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the button SVG\n   *     group.\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    if (!cursorSvg) {\n      this.cursorSvg = null;\n      return;\n    }\n    if (this.svgGroup) {\n      this.svgGroup.appendChild(cursorSvg);\n      this.cursorSvg = cursorSvg;\n    }\n  }\n\n  /**\n   * Required by IASTNodeLocationSvg, but not used. A marker cannot be set on a\n   * button. If the 'mark' shortcut is used on a button, its associated callback\n   * function is triggered.\n   */\n  setMarkerSvg() {\n    throw new Error('Attempted to set a marker on a button.');\n  }\n\n  /**\n   * Do something when the button is clicked.\n   *\n   * @param e Pointer up event.\n   */\n  private onMouseUp(e: PointerEvent) {\n    const gesture = this.targetWorkspace.getGesture(e);\n    if (gesture) {\n      gesture.cancel();\n    }\n\n    if (this.isFlyoutLabel && this.callbackKey) {\n      console.warn(\n        'Labels should not have callbacks. Label text: ' + this.text,\n      );\n    } else if (\n      !this.isFlyoutLabel &&\n      !(\n        this.callbackKey &&\n        this.targetWorkspace.getButtonCallback(this.callbackKey)\n      )\n    ) {\n      console.warn('Buttons should have callbacks. Button text: ' + this.text);\n    } else if (!this.isFlyoutLabel) {\n      const callback = this.targetWorkspace.getButtonCallback(this.callbackKey);\n      if (callback) {\n        callback(this);\n      }\n    }\n  }\n}\n\n/** CSS for buttons and labels. See css.js for use. */\nCss.register(`\n.blocklyFlyoutButton {\n  fill: #888;\n  cursor: default;\n}\n\n.blocklyFlyoutButtonShadow {\n  fill: #666;\n}\n\n.blocklyFlyoutButton:hover {\n  fill: #aaa;\n}\n\n.blocklyFlyoutLabel {\n  cursor: default;\n}\n\n.blocklyFlyoutLabelBackground {\n  opacity: 0;\n}\n`);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a marker move.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.MarkerMove\n\nimport type {Block} from '../block.js';\nimport {ASTNode} from '../keyboard_nav/ast_node.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that a marker (used for keyboard navigation) has\n * moved.\n */\nexport class MarkerMove extends UiBase {\n  /** The ID of the block the marker is now on, if any. */\n  blockId?: string;\n\n  /** The old node the marker used to be on, if any. */\n  oldNode?: ASTNode;\n\n  /** The new node the marker is now on. */\n  newNode?: ASTNode;\n\n  /**\n   * True if this is a cursor event, false otherwise.\n   * For information about cursors vs markers see {@link\n   * https://blocklycodelabs.dev/codelabs/keyboard-navigation/index.html?index=..%2F..index#1}.\n   */\n  isCursor?: boolean;\n\n  override type = EventType.MARKER_MOVE;\n\n  /**\n   * @param opt_block The affected block. Null if current node is of type\n   *     workspace. Undefined for a blank event.\n   * @param isCursor Whether this is a cursor event. Undefined for a blank\n   *     event.\n   * @param opt_oldNode The old node the marker used to be on.\n   *    Undefined for a blank event.\n   * @param opt_newNode The new node the marker is now on.\n   *    Undefined for a blank event.\n   */\n  constructor(\n    opt_block?: Block | null,\n    isCursor?: boolean,\n    opt_oldNode?: ASTNode | null,\n    opt_newNode?: ASTNode,\n  ) {\n    let workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    if (opt_newNode && opt_newNode.getType() === ASTNode.types.WORKSPACE) {\n      workspaceId = (opt_newNode.getLocation() as Workspace).id;\n    }\n    super(workspaceId);\n\n    this.blockId = opt_block?.id;\n    this.oldNode = opt_oldNode || undefined;\n    this.newNode = opt_newNode;\n    this.isCursor = isCursor;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): MarkerMoveJson {\n    const json = super.toJson() as MarkerMoveJson;\n    if (this.isCursor === undefined) {\n      throw new Error(\n        'Whether this is a cursor event or not is undefined. Either pass ' +\n          'a value to the constructor, or call fromJson',\n      );\n    }\n    if (!this.newNode) {\n      throw new Error(\n        'The new node is undefined. Either pass a node to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['isCursor'] = this.isCursor;\n    json['blockId'] = this.blockId;\n    json['oldNode'] = this.oldNode;\n    json['newNode'] = this.newNode;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of MarkerMove, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: MarkerMoveJson,\n    workspace: Workspace,\n    event?: any,\n  ): MarkerMove {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new MarkerMove(),\n    ) as MarkerMove;\n    newEvent.isCursor = json['isCursor'];\n    newEvent.blockId = json['blockId'];\n    newEvent.oldNode = json['oldNode'];\n    newEvent.newNode = json['newNode'];\n    return newEvent;\n  }\n}\n\nexport interface MarkerMoveJson extends AbstractEventJson {\n  isCursor: boolean;\n  blockId?: string;\n  oldNode?: ASTNode;\n  newNode: ASTNode;\n}\n\nregistry.register(registry.Type.EVENT, EventType.MARKER_MOVE, MarkerMove);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.MarkerSvg\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport '../../events/events_marker_move.js';\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {EventType} from '../../events/type.js';\nimport * as eventUtils from '../../events/utils.js';\nimport type {Field} from '../../field.js';\nimport {FlyoutButton} from '../../flyout_button.js';\nimport type {IASTNodeLocationSvg} from '../../interfaces/i_ast_node_location_svg.js';\nimport {ASTNode} from '../../keyboard_nav/ast_node.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\nimport type {ConstantProvider, Notch, PuzzleTab} from './constants.js';\n\n/** The name of the CSS class for a cursor. */\nconst CURSOR_CLASS = 'blocklyCursor';\n\n/** The name of the CSS class for a marker. */\nconst MARKER_CLASS = 'blocklyMarker';\n\n/**\n * What we multiply the height by to get the height of the marker.\n * Only used for the block and block connections.\n */\nconst HEIGHT_MULTIPLIER = 3 / 4;\n\n/**\n * Class for a marker, containing methods for graphically rendering a marker as\n * SVG.\n */\nexport class MarkerSvg {\n  /**\n   * The workspace, field, or block that the marker SVG element should be\n   * attached to.\n   */\n  protected parent: IASTNodeLocationSvg | null = null;\n\n  /** The current SVG element for the marker. */\n  currentMarkerSvg: SVGElement | null = null;\n  colour_: string;\n\n  /** The root SVG group containing the marker. */\n  protected markerSvg_: SVGGElement | null = null;\n  protected svgGroup_: SVGGElement | null = null;\n\n  protected markerBlock_: SVGPathElement | null = null;\n\n  protected markerInput_: SVGPathElement | null = null;\n  protected markerSvgLine_: SVGRectElement | null = null;\n\n  protected markerSvgRect_: SVGRectElement | null = null;\n\n  /** The constants necessary to draw the marker. */\n  protected constants_: ConstantProvider;\n\n  /**\n   * @param workspace The workspace the marker belongs to.\n   * @param constants The constants for the renderer.\n   * @param marker The marker to draw.\n   */\n  constructor(\n    protected readonly workspace: WorkspaceSvg,\n    constants: ConstantProvider,\n    protected readonly marker: Marker,\n  ) {\n    this.constants_ = constants;\n\n    const defaultColour = this.isCursor()\n      ? this.constants_.CURSOR_COLOUR\n      : this.constants_.MARKER_COLOUR;\n\n    /** The colour of the marker. */\n    this.colour_ = marker.colour || defaultColour;\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node.\n   */\n  getSvgRoot(): SVGElement | null {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Get the marker.\n   *\n   * @returns The marker to draw for.\n   */\n  getMarker(): Marker {\n    return this.marker;\n  }\n\n  /**\n   * True if the marker should be drawn as a cursor, false otherwise.\n   * A cursor is drawn as a flashing line. A marker is drawn as a solid line.\n   *\n   * @returns True if the marker is a cursor, false otherwise.\n   */\n  isCursor(): boolean {\n    return this.marker.type === 'cursor';\n  }\n\n  /**\n   * Create the DOM element for the marker.\n   *\n   * @returns The marker controls SVG group.\n   */\n  createDom(): SVGElement {\n    const className = this.isCursor() ? CURSOR_CLASS : MARKER_CLASS;\n\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': className});\n\n    this.createDomInternal_();\n    return this.svgGroup_;\n  }\n\n  /**\n   * Attaches the SVG root of the marker to the SVG group of the parent.\n   *\n   * @param newParent The workspace, field, or block that the marker SVG element\n   *     should be attached to.\n   */\n  protected setParent_(newParent: IASTNodeLocationSvg) {\n    if (!this.isCursor()) {\n      if (this.parent) {\n        this.parent.setMarkerSvg(null);\n      }\n      newParent.setMarkerSvg(this.getSvgRoot());\n    } else {\n      if (this.parent) {\n        this.parent.setCursorSvg(null);\n      }\n      newParent.setCursorSvg(this.getSvgRoot());\n    }\n    this.parent = newParent;\n  }\n\n  /**\n   * Update the marker.\n   *\n   * @param oldNode The previous node the marker was on or null.\n   * @param curNode The node that we want to draw the marker for.\n   */\n  draw(oldNode: ASTNode, curNode: ASTNode) {\n    if (!curNode) {\n      this.hide();\n      return;\n    }\n\n    this.constants_ = this.workspace.getRenderer().getConstants();\n\n    const defaultColour = this.isCursor()\n      ? this.constants_.CURSOR_COLOUR\n      : this.constants_.MARKER_COLOUR;\n    this.colour_ = this.marker.colour || defaultColour;\n    this.applyColour_(curNode);\n\n    this.showAtLocation_(curNode);\n\n    this.fireMarkerEvent(oldNode, curNode);\n\n    // Ensures the marker will be visible immediately after the move.\n    const animate = this.currentMarkerSvg!.childNodes[0];\n    if (\n      animate !== undefined &&\n      (animate as SVGAnimationElement).beginElement\n    ) {\n      (animate as SVGAnimationElement).beginElement();\n    }\n  }\n\n  /**\n   * Update the marker's visible state based on the type of curNode..\n   *\n   * @param curNode The node that we want to draw the marker for.\n   */\n  protected showAtLocation_(curNode: ASTNode) {\n    const curNodeAsConnection = curNode.getLocation() as Connection;\n    const connectionType = curNodeAsConnection.type;\n    if (curNode.getType() === ASTNode.types.BLOCK) {\n      this.showWithBlock_(curNode);\n    } else if (curNode.getType() === ASTNode.types.OUTPUT) {\n      this.showWithOutput_(curNode);\n    } else if (connectionType === ConnectionType.INPUT_VALUE) {\n      this.showWithInput_(curNode);\n    } else if (connectionType === ConnectionType.NEXT_STATEMENT) {\n      this.showWithNext_(curNode);\n    } else if (curNode.getType() === ASTNode.types.PREVIOUS) {\n      this.showWithPrevious_(curNode);\n    } else if (curNode.getType() === ASTNode.types.FIELD) {\n      this.showWithField_(curNode);\n    } else if (curNode.getType() === ASTNode.types.WORKSPACE) {\n      this.showWithCoordinates_(curNode);\n    } else if (curNode.getType() === ASTNode.types.STACK) {\n      this.showWithStack_(curNode);\n    } else if (curNode.getType() === ASTNode.types.BUTTON) {\n      this.showWithButton_(curNode);\n    }\n  }\n\n  /**************************\n   * Display\n   **************************/\n\n  /**\n   * Show the marker as a combination of the previous connection and block,\n   * the output connection and block, or just the block.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithBlockPrevOutput(curNode: ASTNode) {\n    const block = curNode.getSourceBlock() as BlockSvg;\n    const width = block.width;\n    const height = block.height;\n    const markerHeight = height * HEIGHT_MULTIPLIER;\n    const markerOffset = this.constants_.CURSOR_BLOCK_PADDING;\n\n    if (block.previousConnection) {\n      const connectionShape = this.constants_.shapeFor(\n        block.previousConnection,\n      ) as Notch;\n      this.positionPrevious_(\n        width,\n        markerOffset,\n        markerHeight,\n        connectionShape,\n      );\n    } else if (block.outputConnection) {\n      const connectionShape = this.constants_.shapeFor(\n        block.outputConnection,\n      ) as PuzzleTab;\n      this.positionOutput_(width, height, connectionShape);\n    } else {\n      this.positionBlock_(width, markerOffset, markerHeight);\n    }\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a block.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithBlock_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput(curNode);\n  }\n\n  /**\n   * Position and display the marker for a previous connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithPrevious_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput(curNode);\n  }\n\n  /**\n   * Position and display the marker for an output connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithOutput_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput(curNode);\n  }\n\n  /**\n   * Position and display the marker for a workspace coordinate.\n   * This is a horizontal line.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithCoordinates_(curNode: ASTNode) {\n    const wsCoordinate = curNode.getWsCoordinate();\n    let x = wsCoordinate.x;\n    const y = wsCoordinate.y;\n\n    if (this.workspace.RTL) {\n      x -= this.constants_.CURSOR_WS_WIDTH;\n    }\n\n    this.positionLine_(x, y, this.constants_.CURSOR_WS_WIDTH);\n    this.setParent_(this.workspace);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a field.\n   * This is a box around the field.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithField_(curNode: ASTNode) {\n    const field = curNode.getLocation() as Field;\n    const width = field.getSize().width;\n    const height = field.getSize().height;\n\n    this.positionRect_(0, 0, width, height);\n    this.setParent_(field);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for an input.\n   * This is a puzzle piece.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithInput_(curNode: ASTNode) {\n    const connection = curNode.getLocation() as RenderedConnection;\n    const sourceBlock = connection.getSourceBlock();\n\n    this.positionInput_(connection);\n    this.setParent_(sourceBlock);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a next connection.\n   * This is a horizontal line.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithNext_(curNode: ASTNode) {\n    const connection = curNode.getLocation() as RenderedConnection;\n    const targetBlock = connection.getSourceBlock();\n    let x = 0;\n    const y = connection.getOffsetInBlock().y;\n    const width = targetBlock.getHeightWidth().width;\n    if (this.workspace.RTL) {\n      x = -width;\n    }\n    this.positionLine_(x, y, width);\n    this.setParent_(targetBlock);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a stack.\n   * This is a box with extra padding around the entire stack of blocks.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithStack_(curNode: ASTNode) {\n    const block = curNode.getLocation() as BlockSvg;\n\n    // Gets the height and width of entire stack.\n    const heightWidth = block.getHeightWidth();\n\n    // Add padding so that being on a stack looks different than being on a\n    // block.\n    const width = heightWidth.width + this.constants_.CURSOR_STACK_PADDING;\n    const height = heightWidth.height + this.constants_.CURSOR_STACK_PADDING;\n\n    // Shift the rectangle slightly to upper left so padding is equal on all\n    // sides.\n    const xPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n    const yPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n\n    let x = xPadding;\n    const y = yPadding;\n\n    if (this.workspace.RTL) {\n      x = -(width + xPadding);\n    }\n    this.positionRect_(x, y, width, height);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a flyout button.\n   * This is a box with extra padding around the button.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithButton_(curNode: ASTNode) {\n    const button = curNode.getLocation() as FlyoutButton;\n\n    // Gets the height and width of entire stack.\n    const heightWidth = {height: button.height, width: button.width};\n\n    // Add padding so that being on a button looks similar to being on a stack.\n    const width = heightWidth.width + this.constants_.CURSOR_STACK_PADDING;\n    const height = heightWidth.height + this.constants_.CURSOR_STACK_PADDING;\n\n    // Shift the rectangle slightly to upper left so padding is equal on all\n    // sides.\n    const xPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n    const yPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n\n    let x = xPadding;\n    const y = yPadding;\n\n    if (this.workspace.RTL) {\n      x = -(width + xPadding);\n    }\n    this.positionRect_(x, y, width, height);\n    this.setParent_(button);\n    this.showCurrent_();\n  }\n\n  /** Show the current marker. */\n  protected showCurrent_() {\n    this.hide();\n    if (this.currentMarkerSvg) {\n      this.currentMarkerSvg.style.display = '';\n    }\n  }\n\n  /**************************\n   * Position\n   **************************/\n\n  /**\n   * Position the marker for a block.\n   * Displays an outline of the top half of a rectangle around a block.\n   *\n   * @param width The width of the block.\n   * @param markerOffset The extra padding for around the block.\n   * @param markerHeight The height of the marker.\n   */\n  protected positionBlock_(\n    width: number,\n    markerOffset: number,\n    markerHeight: number,\n  ) {\n    const markerPath =\n      svgPaths.moveBy(-markerOffset, markerHeight) +\n      svgPaths.lineOnAxis('V', -markerOffset) +\n      svgPaths.lineOnAxis('H', width + markerOffset * 2) +\n      svgPaths.lineOnAxis('V', markerHeight);\n    if (!this.markerBlock_) {\n      throw new Error(\n        'createDom should be called before positioning the marker',\n      );\n    }\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Position the marker for an input connection.\n   * Displays a filled in puzzle piece.\n   *\n   * @param connection The connection to position marker around.\n   */\n  protected positionInput_(connection: RenderedConnection) {\n    const x = connection.getOffsetInBlock().x;\n    const y = connection.getOffsetInBlock().y;\n\n    const path =\n      svgPaths.moveTo(0, 0) +\n      (this.constants_.shapeFor(connection) as PuzzleTab).pathDown;\n\n    this.markerInput_!.setAttribute('d', path);\n    this.markerInput_!.setAttribute(\n      'transform',\n      'translate(' +\n        x +\n        ',' +\n        y +\n        ')' +\n        (this.workspace.RTL ? ' scale(-1 1)' : ''),\n    );\n    this.currentMarkerSvg = this.markerInput_;\n  }\n\n  /**\n   * Move and show the marker at the specified coordinate in workspace units.\n   * Displays a horizontal line.\n   *\n   * @param x The new x, in workspace units.\n   * @param y The new y, in workspace units.\n   * @param width The new width, in workspace units.\n   */\n  protected positionLine_(x: number, y: number, width: number) {\n    if (!this.markerSvgLine_) {\n      throw new Error('createDom should be called before positioning the line');\n    }\n    this.markerSvgLine_.setAttribute('x', `${x}`);\n    this.markerSvgLine_.setAttribute('y', `${y}`);\n    this.markerSvgLine_.setAttribute('width', `${width}`);\n    this.currentMarkerSvg = this.markerSvgLine_;\n  }\n\n  /**\n   * Position the marker for an output connection.\n   * Displays a puzzle outline and the top and bottom path.\n   *\n   * @param width The width of the block.\n   * @param height The height of the block.\n   * @param connectionShape The shape object for the connection.\n   */\n  protected positionOutput_(\n    width: number,\n    height: number,\n    connectionShape: PuzzleTab,\n  ) {\n    if (!this.markerBlock_) {\n      throw new Error(\n        'createDom should be called before positioning the output',\n      );\n    }\n    const markerPath =\n      svgPaths.moveBy(width, 0) +\n      svgPaths.lineOnAxis('h', -(width - connectionShape.width)) +\n      svgPaths.lineOnAxis('v', this.constants_.TAB_OFFSET_FROM_TOP) +\n      connectionShape.pathDown +\n      svgPaths.lineOnAxis('V', height) +\n      svgPaths.lineOnAxis('H', width);\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Position the marker for a previous connection.\n   * Displays a half rectangle with a notch in the top to represent the previous\n   * connection.\n   *\n   * @param width The width of the block.\n   * @param markerOffset The offset of the marker from around the block.\n   * @param markerHeight The height of the marker.\n   * @param connectionShape The shape object for the connection.\n   */\n  protected positionPrevious_(\n    width: number,\n    markerOffset: number,\n    markerHeight: number,\n    connectionShape: Notch,\n  ) {\n    if (!this.markerBlock_) {\n      throw new Error(\n        'createDom should be called before positioning the previous connection marker',\n      );\n    }\n    const markerPath =\n      svgPaths.moveBy(-markerOffset, markerHeight) +\n      svgPaths.lineOnAxis('V', -markerOffset) +\n      svgPaths.lineOnAxis('H', this.constants_.NOTCH_OFFSET_LEFT) +\n      connectionShape.pathLeft +\n      svgPaths.lineOnAxis('H', width + markerOffset * 2) +\n      svgPaths.lineOnAxis('V', markerHeight);\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Move and show the marker at the specified coordinate in workspace units.\n   * Displays a filled in rectangle.\n   *\n   * @param x The new x, in workspace units.\n   * @param y The new y, in workspace units.\n   * @param width The new width, in workspace units.\n   * @param height The new height, in workspace units.\n   */\n  protected positionRect_(x: number, y: number, width: number, height: number) {\n    if (!this.markerSvgRect_) {\n      throw new Error('createDom should be called before positioning the rect');\n    }\n    this.markerSvgRect_.setAttribute('x', `${x}`);\n    this.markerSvgRect_.setAttribute('y', `${y}`);\n    this.markerSvgRect_.setAttribute('width', `${width}`);\n    this.markerSvgRect_.setAttribute('height', `${height}`);\n    this.currentMarkerSvg = this.markerSvgRect_;\n  }\n\n  /**\n   * Flip the SVG paths in RTL.\n   *\n   * @param markerSvg The marker that we want to flip.\n   */\n  private flipRtl(markerSvg: SVGElement) {\n    markerSvg.setAttribute('transform', 'scale(-1 1)');\n  }\n\n  /** Hide the marker. */\n  hide() {\n    if (\n      !this.markerSvgLine_ ||\n      !this.markerSvgRect_ ||\n      !this.markerInput_ ||\n      !this.markerBlock_\n    ) {\n      throw new Error('createDom should be called before hiding the marker');\n    }\n    this.markerSvgLine_.style.display = 'none';\n    this.markerSvgRect_.style.display = 'none';\n    this.markerInput_.style.display = 'none';\n    this.markerBlock_.style.display = 'none';\n  }\n\n  /**\n   * Fire event for the marker or marker.\n   *\n   * @param oldNode The old node the marker used to be on.\n   * @param curNode The new node the marker is currently on.\n   */\n  protected fireMarkerEvent(oldNode: ASTNode, curNode: ASTNode) {\n    const curBlock = curNode.getSourceBlock();\n    const event = new (eventUtils.get(EventType.MARKER_MOVE))(\n      curBlock,\n      this.isCursor(),\n      oldNode,\n      curNode,\n    );\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Get the properties to make a marker blink.\n   *\n   * @returns The object holding attributes to make the marker blink.\n   */\n  protected getBlinkProperties_(): {[key: string]: string} {\n    return {\n      'attributeType': 'XML',\n      'attributeName': 'fill',\n      'dur': '1s',\n      'values': this.colour_ + ';transparent;transparent;',\n      'repeatCount': 'indefinite',\n    };\n  }\n\n  /**\n   * Create the marker SVG.\n   *\n   * @returns The SVG node created.\n   */\n  protected createDomInternal_(): Element {\n    /* This markup will be generated and added to the .svgGroup_:\n        <g>\n          <rect width=\"100\" height=\"5\">\n            <animate attributeType=\"XML\" attributeName=\"fill\" dur=\"1s\"\n              values=\"transparent;transparent;#fff;transparent\"\n        repeatCount=\"indefinite\" />\n          </rect>\n        </g>\n        */\n\n    this.markerSvg_ = dom.createSvgElement(\n      Svg.G,\n      {\n        'width': this.constants_.CURSOR_WS_WIDTH,\n        'height': this.constants_.WS_CURSOR_HEIGHT,\n      },\n      this.svgGroup_,\n    );\n\n    // A horizontal line used to represent a workspace coordinate or next\n    // connection.\n    this.markerSvgLine_ = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'width': this.constants_.CURSOR_WS_WIDTH,\n        'height': this.constants_.WS_CURSOR_HEIGHT,\n      },\n      this.markerSvg_,\n    );\n\n    // A filled in rectangle used to represent a stack.\n    this.markerSvgRect_ = dom.createSvgElement(\n      Svg.RECT,\n      {\n        'class': 'blocklyVerticalMarker',\n        'rx': 10,\n        'ry': 10,\n      },\n      this.markerSvg_,\n    );\n\n    // A filled in puzzle piece used to represent an input value.\n    this.markerInput_ = dom.createSvgElement(\n      Svg.PATH,\n      {'transform': ''},\n      this.markerSvg_,\n    );\n\n    // A path used to represent a previous connection and a block, an output\n    // connection and a block, or a block.\n    this.markerBlock_ = dom.createSvgElement(\n      Svg.PATH,\n      {\n        'transform': '',\n        'fill': 'none',\n        'stroke-width': this.constants_.CURSOR_STROKE_WIDTH,\n      },\n      this.markerSvg_,\n    );\n\n    this.hide();\n\n    // Markers and stack markers don't blink.\n    if (this.isCursor()) {\n      const blinkProperties = this.getBlinkProperties_();\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerSvgLine_);\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerInput_);\n      dom.createSvgElement(\n        Svg.ANIMATE,\n        {...blinkProperties, attributeName: 'stroke'},\n        this.markerBlock_,\n      );\n    }\n\n    return this.markerSvg_;\n  }\n\n  /**\n   * Apply the marker's colour.\n   *\n   * @param _curNode The node that we want to draw the marker for.\n   */\n  protected applyColour_(_curNode: ASTNode) {\n    if (\n      !this.markerSvgLine_ ||\n      !this.markerSvgRect_ ||\n      !this.markerInput_ ||\n      !this.markerBlock_\n    ) {\n      throw new Error(\n        'createDom should be called before applying color to the markerj',\n      );\n    }\n    this.markerSvgLine_.setAttribute('fill', this.colour_);\n    this.markerSvgRect_.setAttribute('stroke', this.colour_);\n    this.markerInput_.setAttribute('fill', this.colour_);\n    this.markerBlock_.setAttribute('stroke', this.colour_);\n\n    if (this.isCursor()) {\n      const values = this.colour_ + ';transparent;transparent;';\n      this.markerSvgLine_.firstElementChild!.setAttribute('values', values);\n      this.markerInput_.firstElementChild!.setAttribute('values', values);\n      this.markerBlock_.firstElementChild!.setAttribute('values', values);\n    }\n  }\n\n  /** Dispose of this marker. */\n  dispose() {\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.PathObject\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport {Coordinate} from '../../utils/coordinate.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport type {ConstantProvider} from './constants.js';\nimport type {IPathObject} from './i_path_object.js';\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n */\nexport class PathObject implements IPathObject {\n  svgRoot: SVGElement;\n  svgPath: SVGElement;\n\n  /**\n   * Holds the cursors svg element when the cursor is attached to the block.\n   * This is null if there is no cursor on the block.\n   */\n  cursorSvg: SVGElement | null = null;\n\n  /**\n   * Holds the markers svg element when the marker is attached to the block.\n   * This is null if there is no marker on the block.\n   */\n  markerSvg: SVGElement | null = null;\n\n  constants: ConstantProvider;\n  style: BlockStyle;\n\n  /** Highlight paths associated with connections. */\n  private connectionHighlights = new WeakMap<RenderedConnection, SVGElement>();\n\n  /** Locations of connection highlights. */\n  private highlightOffsets = new WeakMap<RenderedConnection, Coordinate>();\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   */\n  constructor(\n    root: SVGElement,\n    style: BlockStyle,\n    constants: ConstantProvider,\n  ) {\n    this.constants = constants;\n    this.style = style;\n    this.svgRoot = root;\n\n    /** The primary path of the block. */\n    this.svgPath = dom.createSvgElement(\n      Svg.PATH,\n      {'class': 'blocklyPath'},\n      this.svgRoot,\n    );\n  }\n\n  /**\n   * Set the path generated by the renderer onto the respective SVG element.\n   *\n   * @param pathString The path.\n   */\n  setPath(pathString: string) {\n    this.svgPath.setAttribute('d', pathString);\n  }\n\n  /**\n   * Flip the SVG paths in RTL.\n   */\n  flipRTL() {\n    // Mirror the block's path.\n    this.svgPath.setAttribute('transform', 'scale(-1 1)');\n  }\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    if (!cursorSvg) {\n      this.cursorSvg = null;\n      return;\n    }\n\n    this.svgRoot.appendChild(cursorSvg);\n    this.cursorSvg = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    if (!markerSvg) {\n      this.markerSvg = null;\n      return;\n    }\n\n    if (this.cursorSvg) {\n      this.svgRoot.insertBefore(markerSvg, this.cursorSvg);\n    } else {\n      this.svgRoot.appendChild(markerSvg);\n    }\n    this.markerSvg = markerSvg;\n  }\n\n  /**\n   * Apply the stored colours to the block's path, taking into account whether\n   * the paths belong to a shadow block.\n   *\n   * @param block The source block.\n   */\n  applyColour(block: BlockSvg) {\n    this.svgPath.setAttribute('stroke', this.style.colourTertiary);\n    this.svgPath.setAttribute('fill', this.style.colourPrimary);\n\n    this.updateShadow_(block.isShadow());\n    this.updateDisabled_(!block.isEnabled() || block.getInheritedDisabled());\n  }\n\n  /**\n   * Set the style.\n   *\n   * @param blockStyle The block style to use.\n   */\n  setStyle(blockStyle: BlockStyle) {\n    this.style = blockStyle;\n  }\n\n  /**\n   * Add or remove the given CSS class on the path object's root SVG element.\n   *\n   * @param className The name of the class to add or remove\n   * @param add True if the class should be added.  False if it should be\n   *     removed.\n   */\n  protected setClass_(className: string, add: boolean) {\n    if (!className) {\n      return;\n    }\n    if (add) {\n      dom.addClass(this.svgRoot, className);\n    } else {\n      dom.removeClass(this.svgRoot, className);\n    }\n  }\n\n  /**\n   * Set whether the block shows a highlight or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param enable True if highlighted.\n   */\n  updateHighlighted(enable: boolean) {\n    if (enable) {\n      this.svgPath.setAttribute(\n        'filter',\n        'url(#' + this.constants.embossFilterId + ')',\n      );\n    } else {\n      this.svgPath.setAttribute('filter', 'none');\n    }\n  }\n\n  /**\n   * Updates the look of the block to reflect a shadow state.\n   *\n   * @param shadow True if the block is a shadow block.\n   */\n  protected updateShadow_(shadow: boolean) {\n    if (shadow) {\n      this.svgPath.setAttribute('stroke', 'none');\n      this.svgPath.setAttribute('fill', this.style.colourSecondary);\n    }\n  }\n\n  /**\n   * Updates the look of the block to reflect a disabled state.\n   *\n   * @param disabled True if disabled.\n   */\n  protected updateDisabled_(disabled: boolean) {\n    this.setClass_('blocklyDisabled', disabled);\n    if (disabled) {\n      this.svgPath.setAttribute(\n        'fill',\n        'url(#' + this.constants.disabledPatternId + ')',\n      );\n    }\n  }\n\n  /**\n   * Add or remove styling showing that a block is selected.\n   *\n   * @param enable True if selection is enabled, false otherwise.\n   */\n  updateSelected(enable: boolean) {\n    this.setClass_('blocklySelected', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is dragged over a delete area.\n   *\n   * @param enable True if the block is being dragged over a delete area, false\n   *     otherwise.\n   */\n  updateDraggingDelete(enable: boolean) {\n    this.setClass_('blocklyDraggingDelete', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is an insertion marker.\n   *\n   * @param enable True if the block is an insertion marker, false otherwise.\n   */\n  updateInsertionMarker(enable: boolean) {\n    this.setClass_('blocklyInsertionMarker', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is movable.\n   *\n   * @param enable True if the block is movable, false otherwise.\n   */\n  updateMovable(enable: boolean) {\n    this.setClass_('blocklyDraggable', enable);\n  }\n\n  /**\n   * Add or remove styling that shows that if the dragging block is dropped,\n   * this block will be replaced.  If a shadow block, it will disappear.\n   * Otherwise it will bump.\n   *\n   * @param enable True if styling should be added.\n   */\n  updateReplacementFade(enable: boolean) {\n    this.setClass_('blocklyReplaceable', enable);\n  }\n\n  /**\n   * Add or remove styling that shows that if the dragging block is dropped,\n   * this block will be connected to the input.\n   *\n   * @param _conn The connection on the input to highlight.\n   * @param _enable True if styling should be added.\n   */\n  updateShapeForInputHighlight(_conn: Connection, _enable: boolean) {\n    // NOOP\n  }\n\n  /** Adds the given path as a connection highlight for the given connection. */\n  addConnectionHighlight(\n    connection: RenderedConnection,\n    connectionPath: string,\n    offset: Coordinate,\n    rtl: boolean,\n  ) {\n    if (this.connectionHighlights.has(connection)) {\n      if (this.currentHighlightMatchesNew(connection, connectionPath, offset)) {\n        return;\n      }\n      this.removeConnectionHighlight(connection);\n    }\n\n    const highlight = dom.createSvgElement(\n      Svg.PATH,\n      {\n        'class': 'blocklyHighlightedConnectionPath',\n        'd': connectionPath,\n        'transform':\n          `translate(${offset.x}, ${offset.y})` + (rtl ? ' scale(-1 1)' : ''),\n      },\n      this.svgRoot,\n    );\n    this.connectionHighlights.set(connection, highlight);\n  }\n\n  private currentHighlightMatchesNew(\n    connection: RenderedConnection,\n    newPath: string,\n    newOffset: Coordinate,\n  ): boolean {\n    const currPath = this.connectionHighlights\n      .get(connection)\n      ?.getAttribute('d');\n    const currOffset = this.highlightOffsets.get(connection);\n    return currPath === newPath && Coordinate.equals(currOffset, newOffset);\n  }\n\n  /**\n   * Removes any highlight associated with the given connection, if it exists.\n   */\n  removeConnectionHighlight(connection: RenderedConnection) {\n    const highlight = this.connectionHighlights.get(connection);\n    if (!highlight) return;\n    dom.removeNode(highlight);\n    this.connectionHighlights.delete(connection);\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class that controls updates to connections during drags.\n *\n * @class\n */\n// Former goog.module ID: Blockly.InsertionMarkerManager\n\nimport * as blockAnimations from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport * as renderManagement from './render_management.js';\nimport {finishQueuedRenders} from './render_management.js';\nimport type {RenderedConnection} from './rendered_connection.js';\nimport * as blocks from './serialization/blocks.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/** Represents a nearby valid connection. */\ninterface CandidateConnection {\n  /**\n   * A nearby valid connection that is compatible with local.\n   * This is not on any of the blocks that are being dragged.\n   */\n  closest: RenderedConnection;\n  /**\n   * A connection on the dragging stack that is compatible with closest. This is\n   * on the top block that is being dragged or the last block in the dragging\n   * stack.\n   */\n  local: RenderedConnection;\n  radius: number;\n}\n\n/**\n * Class that controls updates to connections during drags.  It is primarily\n * responsible for finding the closest eligible connection and highlighting or\n * unhighlighting it as needed during a drag.\n *\n * @deprecated v10 - Use an IConnectionPreviewer instead.\n */\nexport class InsertionMarkerManager {\n  /**\n   * The top block in the stack being dragged.\n   * Does not change during a drag.\n   */\n  private readonly topBlock: BlockSvg;\n\n  /**\n   * The workspace on which these connections are being dragged.\n   * Does not change during a drag.\n   */\n  private readonly workspace: WorkspaceSvg;\n\n  /**\n   * The last connection on the stack, if it's not the last connection on the\n   * first block.\n   * Set in initAvailableConnections, if at all.\n   */\n  private lastOnStack: RenderedConnection | null = null;\n\n  /**\n   * The insertion marker corresponding to the last block in the stack, if\n   * that's not the same as the first block in the stack.\n   * Set in initAvailableConnections, if at all\n   */\n  private lastMarker: BlockSvg | null = null;\n\n  /**\n   * The insertion marker that shows up between blocks to show where a block\n   * would go if dropped immediately.\n   */\n  private firstMarker: BlockSvg;\n\n  /**\n   * Information about the connection that would be made if the dragging block\n   * were released immediately. Updated on every mouse move.\n   */\n  private activeCandidate: CandidateConnection | null = null;\n\n  /**\n   * Whether the block would be deleted if it were dropped immediately.\n   * Updated on every mouse move.\n   *\n   * @internal\n   */\n  public wouldDeleteBlock = false;\n\n  /**\n   * Connection on the insertion marker block that corresponds to\n   * the active candidate's local connection on the currently dragged block.\n   */\n  private markerConnection: RenderedConnection | null = null;\n\n  /** The block that currently has an input being highlighted, or null. */\n  private highlightedBlock: BlockSvg | null = null;\n\n  /** The block being faded to indicate replacement, or null. */\n  private fadedBlock: BlockSvg | null = null;\n\n  /**\n   * The connections on the dragging blocks that are available to connect to\n   * other blocks.  This includes all open connections on the top block, as\n   * well as the last connection on the block stack.\n   */\n  private availableConnections: RenderedConnection[];\n\n  /** @param block The top block in the stack being dragged. */\n  constructor(block: BlockSvg) {\n    common.setSelected(block);\n    this.topBlock = block;\n\n    this.workspace = block.workspace;\n\n    this.firstMarker = this.createMarkerBlock(this.topBlock);\n\n    this.availableConnections = this.initAvailableConnections();\n\n    if (this.lastOnStack) {\n      this.lastMarker = this.createMarkerBlock(\n        this.lastOnStack.getSourceBlock(),\n      );\n    }\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    this.availableConnections.length = 0;\n    this.disposeInsertionMarker(this.firstMarker);\n    this.disposeInsertionMarker(this.lastMarker);\n  }\n\n  /**\n   * Update the available connections for the top block. These connections can\n   * change if a block is unplugged and the stack is healed.\n   *\n   * @internal\n   */\n  updateAvailableConnections() {\n    this.availableConnections = this.initAvailableConnections();\n  }\n\n  /**\n   * Return whether the block would be connected if dropped immediately, based\n   * on information from the most recent move event.\n   *\n   * @returns True if the block would be connected if dropped immediately.\n   * @internal\n   */\n  wouldConnectBlock(): boolean {\n    return !!this.activeCandidate;\n  }\n\n  /**\n   * Connect to the closest connection and render the results.\n   * This should be called at the end of a drag.\n   *\n   * @internal\n   */\n  applyConnections() {\n    if (!this.activeCandidate) return;\n    eventUtils.disable();\n    this.hidePreview();\n    eventUtils.enable();\n    const {local, closest} = this.activeCandidate;\n    local.connect(closest);\n    const inferiorConnection = local.isSuperior() ? closest : local;\n    const rootBlock = this.topBlock.getRootBlock();\n\n    finishQueuedRenders().then(() => {\n      blockAnimations.connectionUiEffect(inferiorConnection.getSourceBlock());\n      // bringToFront is incredibly expensive. Delay until the next frame.\n      setTimeout(() => {\n        rootBlock.bringToFront();\n      }, 0);\n    });\n  }\n\n  /**\n   * Update connections based on the most recent move location.\n   *\n   * @param dxy Position relative to drag start, in workspace units.\n   * @param dragTarget The drag target that the block is currently over.\n   * @internal\n   */\n  update(dxy: Coordinate, dragTarget: IDragTarget | null) {\n    const newCandidate = this.getCandidate(dxy);\n\n    this.wouldDeleteBlock = this.shouldDelete(!!newCandidate, dragTarget);\n\n    const shouldUpdate =\n      this.wouldDeleteBlock || this.shouldUpdatePreviews(newCandidate, dxy);\n\n    if (shouldUpdate) {\n      // Don't fire events for insertion marker creation or movement.\n      eventUtils.disable();\n      this.maybeHidePreview(newCandidate);\n      this.maybeShowPreview(newCandidate);\n      eventUtils.enable();\n    }\n  }\n\n  /**\n   * Create an insertion marker that represents the given block.\n   *\n   * @param sourceBlock The block that the insertion marker will represent.\n   * @returns The insertion marker that represents the given block.\n   */\n  private createMarkerBlock(sourceBlock: BlockSvg): BlockSvg {\n    eventUtils.disable();\n    let result: BlockSvg;\n    try {\n      const blockJson = blocks.save(sourceBlock, {\n        addCoordinates: false,\n        addInputBlocks: false,\n        addNextBlocks: false,\n        doFullSerialization: false,\n      });\n\n      if (!blockJson) {\n        throw new Error(\n          `Failed to serialize source block. ${sourceBlock.toDevString()}`,\n        );\n      }\n\n      result = blocks.append(blockJson, this.workspace) as BlockSvg;\n\n      // Turn shadow blocks that are created programmatically during\n      // initalization to insertion markers too.\n      for (const block of result.getDescendants(false)) {\n        block.setInsertionMarker(true);\n      }\n\n      result.initSvg();\n      result.getSvgRoot().setAttribute('visibility', 'hidden');\n    } finally {\n      eventUtils.enable();\n    }\n\n    return result;\n  }\n\n  /**\n   * Populate the list of available connections on this block stack. If the\n   * stack has more than one block, this function will also update lastOnStack.\n   *\n   * @returns A list of available connections.\n   */\n  private initAvailableConnections(): RenderedConnection[] {\n    const available = this.topBlock.getConnections_(false);\n    // Also check the last connection on this stack\n    const lastOnStack = this.topBlock.lastConnectionInStack(true);\n    if (lastOnStack && lastOnStack !== this.topBlock.nextConnection) {\n      available.push(lastOnStack);\n      this.lastOnStack = lastOnStack;\n    }\n    return available;\n  }\n\n  /**\n   * Whether the previews (insertion marker and replacement marker) should be\n   * updated based on the closest candidate and the current drag distance.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   * @param dxy Position relative to drag start, in workspace units.\n   * @returns Whether the preview should be updated.\n   */\n  private shouldUpdatePreviews(\n    newCandidate: CandidateConnection | null,\n    dxy: Coordinate,\n  ): boolean {\n    // Only need to update if we were showing a preview before.\n    if (!newCandidate) return !!this.activeCandidate;\n\n    // We weren't showing a preview before, but we should now.\n    if (!this.activeCandidate) return true;\n\n    // We're already showing an insertion marker.\n    // Decide whether the new connection has higher priority.\n    const {local: activeLocal, closest: activeClosest} = this.activeCandidate;\n    if (\n      activeClosest === newCandidate.closest &&\n      activeLocal === newCandidate.local\n    ) {\n      // The connection was the same as the current connection.\n      return false;\n    }\n\n    const xDiff = activeLocal.x + dxy.x - activeClosest.x;\n    const yDiff = activeLocal.y + dxy.y - activeClosest.y;\n    const curDistance = Math.sqrt(xDiff * xDiff + yDiff * yDiff);\n    // Slightly prefer the existing preview over a new preview.\n    return (\n      newCandidate.radius < curDistance - config.currentConnectionPreference\n    );\n  }\n\n  /**\n   * Find the nearest valid connection, which may be the same as the current\n   * closest connection.\n   *\n   * @param dxy Position relative to drag start, in workspace units.\n   * @returns An object containing a local connection, a closest connection, and\n   *     a radius.\n   */\n  private getCandidate(dxy: Coordinate): CandidateConnection | null {\n    // It's possible that a block has added or removed connections during a\n    // drag, (e.g. in a drag/move event handler), so let's update the available\n    // connections. Note that this will be called on every move while dragging,\n    // so it might cause slowness, especially if the block stack is large.  If\n    // so, maybe it could be made more efficient. Also note that we won't update\n    // the connections if we've already connected the insertion marker to a\n    // block.\n    if (!this.markerConnection || !this.markerConnection.isConnected()) {\n      this.updateAvailableConnections();\n    }\n\n    let radius = this.getStartRadius();\n    let candidate = null;\n    for (let i = 0; i < this.availableConnections.length; i++) {\n      const myConnection = this.availableConnections[i];\n      const neighbour = myConnection.closest(radius, dxy);\n      if (neighbour.connection) {\n        candidate = {\n          closest: neighbour.connection,\n          local: myConnection,\n          radius: neighbour.radius,\n        };\n        radius = neighbour.radius;\n      }\n    }\n    return candidate;\n  }\n\n  /**\n   * Decide the radius at which to start searching for the closest connection.\n   *\n   * @returns The radius at which to start the search for the closest\n   *     connection.\n   */\n  private getStartRadius(): number {\n    // If there is already a connection highlighted,\n    // increase the radius we check for making new connections.\n    // When a connection is highlighted, blocks move around when the\n    // insertion marker is created, which could cause the connection became out\n    // of range. By increasing radiusConnection when a connection already\n    // exists, we never \"lose\" the connection from the offset.\n    return this.activeCandidate\n      ? config.connectingSnapRadius\n      : config.snapRadius;\n  }\n\n  /**\n   * Whether ending the drag would delete the block.\n   *\n   * @param newCandidate Whether there is a candidate connection that the\n   *     block could connect to if the drag ended immediately.\n   * @param dragTarget The drag target that the block is currently over.\n   * @returns Whether dropping the block immediately would delete the block.\n   */\n  private shouldDelete(\n    newCandidate: boolean,\n    dragTarget: IDragTarget | null,\n  ): boolean {\n    if (dragTarget) {\n      const componentManager = this.workspace.getComponentManager();\n      const isDeleteArea = componentManager.hasCapability(\n        dragTarget.id,\n        ComponentManager.Capability.DELETE_AREA,\n      );\n      if (isDeleteArea) {\n        return (dragTarget as IDeleteArea).wouldDelete(this.topBlock);\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Show an insertion marker or replacement highlighting during a drag, if\n   * needed.\n   * At the beginning of this function, this.activeConnection should be null.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   */\n  private maybeShowPreview(newCandidate: CandidateConnection | null) {\n    if (this.wouldDeleteBlock) return; // Nope, don't add a marker.\n    if (!newCandidate) return; // Nothing to connect to.\n\n    const closest = newCandidate.closest;\n\n    // Something went wrong and we're trying to connect to an invalid\n    // connection.\n    if (\n      closest === this.activeCandidate?.closest ||\n      closest.getSourceBlock().isInsertionMarker()\n    ) {\n      console.log('Trying to connect to an insertion marker');\n      return;\n    }\n    this.activeCandidate = newCandidate;\n    // Add an insertion marker or replacement marker.\n    this.showPreview(this.activeCandidate);\n  }\n\n  /**\n   * A preview should be shown.  This function figures out if it should be a\n   * block highlight or an insertion marker, and shows the appropriate one.\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showPreview(activeCandidate: CandidateConnection) {\n    const renderer = this.workspace.getRenderer();\n    const method = renderer.getConnectionPreviewMethod(\n      activeCandidate.closest,\n      activeCandidate.local,\n      this.topBlock,\n    );\n\n    switch (method) {\n      case InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE:\n        this.showInsertionInputOutline(activeCandidate);\n        break;\n      case InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER:\n        this.showInsertionMarker(activeCandidate);\n        break;\n      case InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:\n        this.showReplacementFade(activeCandidate);\n        break;\n    }\n\n    // Optionally highlight the actual connection, as a nod to previous\n    // behaviour.\n    if (renderer.shouldHighlightConnection(activeCandidate.closest)) {\n      activeCandidate.closest.highlight();\n    }\n  }\n\n  /**\n   * Hide an insertion marker or replacement highlighting during a drag, if\n   * needed.\n   * At the end of this function, this.activeCandidate will be null.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   */\n  private maybeHidePreview(newCandidate: CandidateConnection | null) {\n    // If there's no new preview, remove the old one but don't bother deleting\n    // it. We might need it later, and this saves disposing of it and recreating\n    // it.\n    if (!newCandidate) {\n      this.hidePreview();\n    } else {\n      if (this.activeCandidate) {\n        const closestChanged =\n          this.activeCandidate.closest !== newCandidate.closest;\n        const localChanged = this.activeCandidate.local !== newCandidate.local;\n\n        // If there's a new preview and there was a preview before, and either\n        // connection has changed, remove the old preview.\n        // Also hide if we had a preview before but now we're going to delete\n        // instead.\n        if (closestChanged || localChanged || this.wouldDeleteBlock) {\n          this.hidePreview();\n        }\n      }\n    }\n\n    // Either way, clear out old state.\n    this.markerConnection = null;\n    this.activeCandidate = null;\n  }\n\n  /**\n   * A preview should be hidden. Loop through all possible preview modes\n   * and hide everything.\n   */\n  private hidePreview() {\n    const closest = this.activeCandidate?.closest;\n    if (\n      closest &&\n      closest.targetBlock() &&\n      this.workspace.getRenderer().shouldHighlightConnection(closest)\n    ) {\n      closest.unhighlight();\n    }\n    this.hideReplacementFade();\n    this.hideInsertionInputOutline();\n    this.hideInsertionMarker();\n  }\n\n  /**\n   * Shows an insertion marker connected to the appropriate blocks (based on\n   * manager state).\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showInsertionMarker(activeCandidate: CandidateConnection) {\n    const {local, closest} = activeCandidate;\n\n    const isLastInStack = this.lastOnStack && local === this.lastOnStack;\n    let insertionMarker = isLastInStack ? this.lastMarker : this.firstMarker;\n    if (!insertionMarker) {\n      throw new Error(\n        'Cannot show the insertion marker because there is no insertion ' +\n          'marker block',\n      );\n    }\n    let imConn;\n    try {\n      imConn = insertionMarker.getMatchingConnection(\n        local.getSourceBlock(),\n        local,\n      );\n    } catch {\n      // It's possible that the number of connections on the local block has\n      // changed since the insertion marker was originally created.  Let's\n      // recreate the insertion marker and try again. In theory we could\n      // probably recreate the marker block (e.g. in getCandidate_), which is\n      // called more often during the drag, but creating a block that often\n      // might be too slow, so we only do it if necessary.\n      if (isLastInStack && this.lastOnStack) {\n        this.disposeInsertionMarker(this.lastMarker);\n        this.lastMarker = this.createMarkerBlock(\n          this.lastOnStack.getSourceBlock(),\n        );\n        insertionMarker = this.lastMarker;\n      } else {\n        this.disposeInsertionMarker(this.firstMarker);\n        this.firstMarker = this.createMarkerBlock(this.topBlock);\n        insertionMarker = this.firstMarker;\n      }\n\n      if (!insertionMarker) {\n        throw new Error(\n          'Cannot show the insertion marker because there is no insertion ' +\n            'marker block',\n        );\n      }\n      imConn = insertionMarker.getMatchingConnection(\n        local.getSourceBlock(),\n        local,\n      );\n    }\n\n    if (!imConn) {\n      throw new Error(\n        'Cannot show the insertion marker because there is no ' +\n          'associated connection',\n      );\n    }\n\n    if (imConn === this.markerConnection) {\n      throw new Error(\n        \"Made it to showInsertionMarker_ even though the marker isn't \" +\n          'changing',\n      );\n    }\n\n    // Render disconnected from everything else so that we have a valid\n    // connection location.\n    insertionMarker.queueRender();\n    renderManagement.triggerQueuedRenders();\n\n    // Connect() also renders the insertion marker.\n    imConn.connect(closest);\n\n    const originalOffsetToTarget = {\n      x: closest.x - imConn.x,\n      y: closest.y - imConn.y,\n    };\n    const originalOffsetInBlock = imConn.getOffsetInBlock().clone();\n    const imConnConst = imConn;\n    renderManagement.finishQueuedRenders().then(() => {\n      // Position so that the existing block doesn't move.\n      insertionMarker?.positionNearConnection(\n        imConnConst,\n        originalOffsetToTarget,\n        originalOffsetInBlock,\n      );\n      insertionMarker?.getSvgRoot().setAttribute('visibility', 'visible');\n    });\n\n    this.markerConnection = imConn;\n  }\n\n  /**\n   * Disconnects and hides the current insertion marker. Should return the\n   * blocks to their original state.\n   */\n  private hideInsertionMarker() {\n    if (!this.markerConnection) return;\n\n    const markerConn = this.markerConnection;\n    const imBlock = markerConn.getSourceBlock();\n    const markerPrev = imBlock.previousConnection;\n    const markerOutput = imBlock.outputConnection;\n\n    if (!markerPrev?.targetConnection && !markerOutput?.targetConnection) {\n      // If we are the top block, unplugging doesn't do anything.\n      // The marker connection may not have a target block if we are hiding\n      // as part of applying connections.\n      markerConn.targetBlock()?.unplug(false);\n    } else {\n      imBlock.unplug(true);\n    }\n\n    if (markerConn.targetConnection) {\n      throw Error(\n        'markerConnection still connected at the end of ' +\n          'disconnectInsertionMarker',\n      );\n    }\n\n    this.markerConnection = null;\n    const svg = imBlock.getSvgRoot();\n    if (svg) {\n      svg.setAttribute('visibility', 'hidden');\n    }\n  }\n\n  /**\n   * Shows an outline around the input the closest connection belongs to.\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showInsertionInputOutline(activeCandidate: CandidateConnection) {\n    const closest = activeCandidate.closest;\n    this.highlightedBlock = closest.getSourceBlock();\n    this.highlightedBlock.highlightShapeForInput(closest, true);\n  }\n\n  /** Hides any visible input outlines. */\n  private hideInsertionInputOutline() {\n    if (!this.highlightedBlock) return;\n\n    if (!this.activeCandidate) {\n      throw new Error(\n        'Cannot hide the insertion marker outline because ' +\n          'there is no active candidate',\n      );\n    }\n    this.highlightedBlock.highlightShapeForInput(\n      this.activeCandidate.closest,\n      false,\n    );\n    this.highlightedBlock = null;\n  }\n\n  /**\n   * Shows a replacement fade affect on the closest connection's target block\n   * (the block that is currently connected to it).\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showReplacementFade(activeCandidate: CandidateConnection) {\n    this.fadedBlock = activeCandidate.closest.targetBlock();\n    if (!this.fadedBlock) {\n      throw new Error(\n        'Cannot show the replacement fade because the ' +\n          'closest connection does not have a target block',\n      );\n    }\n    this.fadedBlock.fadeForReplacement(true);\n  }\n\n  /**\n   * Hides/Removes any visible fade affects.\n   */\n  private hideReplacementFade() {\n    if (!this.fadedBlock) return;\n\n    this.fadedBlock.fadeForReplacement(false);\n    this.fadedBlock = null;\n  }\n\n  /**\n   * Get a list of the insertion markers that currently exist.  Drags have 0, 1,\n   * or 2 insertion markers.\n   *\n   * @returns A possibly empty list of insertion marker blocks.\n   * @internal\n   */\n  getInsertionMarkers(): BlockSvg[] {\n    const result = [];\n    if (this.firstMarker) {\n      result.push(this.firstMarker);\n    }\n    if (this.lastMarker) {\n      result.push(this.lastMarker);\n    }\n    return result;\n  }\n\n  /**\n   * Safely disposes of an insertion marker.\n   */\n  private disposeInsertionMarker(marker: BlockSvg | null) {\n    if (marker) {\n      eventUtils.disable();\n      try {\n        marker.dispose();\n      } finally {\n        eventUtils.enable();\n      }\n    }\n  }\n}\n\nexport namespace InsertionMarkerManager {\n  /**\n   * An enum describing different kinds of previews the InsertionMarkerManager\n   * could display.\n   */\n  export enum PREVIEW_TYPE {\n    INSERTION_MARKER = 0,\n    INPUT_OUTLINE = 1,\n    REPLACEMENT_FADE = 2,\n  }\n}\n\nexport type PreviewType = InsertionMarkerManager.PREVIEW_TYPE;\nexport const PreviewType = InsertionMarkerManager.PREVIEW_TYPE;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.Renderer\n\nimport type {Block} from '../../block.js';\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {\n  InsertionMarkerManager,\n  PreviewType,\n} from '../../insertion_marker_manager.js';\nimport type {IRegistrable} from '../../interfaces/i_registrable.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport * as deprecation from '../../utils/deprecation.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport type {IPathObject} from './i_path_object.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\n\n/**\n * The base class for a block renderer.\n */\nexport class Renderer implements IRegistrable {\n  /** The renderer's constant provider. */\n  protected constants_!: ConstantProvider;\n\n  protected name: string;\n\n  /**\n   * Rendering constant overrides, passed in through options.\n   */\n  protected overrides: object | null = null;\n\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    this.name = name;\n  }\n\n  /**\n   * Gets the class name that identifies this renderer.\n   *\n   * @returns The CSS class name.\n   */\n  getClassName(): string {\n    return this.name + '-renderer';\n  }\n\n  /**\n   * Initialize the renderer.\n   *\n   * @param theme The workspace theme object.\n   * @param opt_rendererOverrides Rendering constant overrides.\n   */\n  init(\n    theme: Theme,\n    opt_rendererOverrides?: {[rendererConstant: string]: any},\n  ) {\n    this.constants_ = this.makeConstants_();\n    if (opt_rendererOverrides) {\n      this.overrides = opt_rendererOverrides;\n      Object.assign(this.constants_, opt_rendererOverrides);\n    }\n    this.constants_.setTheme(theme);\n    this.constants_.init();\n  }\n\n  /**\n   * Create any DOM elements that this renderer needs.\n   * If you need to create additional DOM elements, override the\n   * {@link ConstantProvider#createDom} method instead.\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param theme The workspace theme object.\n   * @internal\n   */\n  createDom(svg: SVGElement, theme: Theme) {\n    this.constants_.createDom(\n      svg,\n      this.name + '-' + theme.name,\n      '.' + this.getClassName() + '.' + theme.getClassName(),\n    );\n  }\n\n  /**\n   * Refresh the renderer after a theme change.\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param theme The workspace theme object.\n   */\n  refreshDom(svg: SVGElement, theme: Theme) {\n    const previousConstants = this.getConstants();\n    previousConstants.dispose();\n    this.constants_ = this.makeConstants_();\n    if (this.overrides) {\n      Object.assign(this.constants_, this.overrides);\n    }\n    // Ensure the constant provider's random identifier does not change.\n    this.constants_.randomIdentifier = previousConstants.randomIdentifier;\n    this.constants_.setTheme(theme);\n    this.constants_.init();\n    this.createDom(svg, theme);\n  }\n\n  /**\n   * Dispose of this renderer.\n   * Delete all DOM elements that this renderer and its constants created.\n   */\n  dispose() {\n    if (this.constants_) {\n      this.constants_.dispose();\n    }\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected makeDrawer_(block: BlockSvg, info: RenderInfo): Drawer {\n    return new Drawer(block, info);\n  }\n\n  /**\n   * Create a new instance of the renderer's marker drawer.\n   *\n   * @param workspace The workspace the marker belongs to.\n   * @param marker The marker.\n   * @returns The object in charge of drawing the marker.\n   */\n  makeMarkerDrawer(workspace: WorkspaceSvg, marker: Marker): MarkerSvg {\n    return new MarkerSvg(workspace, this.getConstants(), marker);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   */\n  makePathObject(root: SVGElement, style: BlockStyle): IPathObject {\n    return new PathObject(root, style, this.constants_);\n  }\n\n  /**\n   * Get the current renderer's constant provider.  We assume that when this is\n   * called, the renderer has already been initialized.\n   *\n   * @returns The constant provider.\n   */\n  getConstants(): ConstantProvider {\n    return this.constants_;\n  }\n\n  /**\n   * Determine whether or not to highlight a connection.\n   *\n   * @param _conn The connection to determine whether or not to highlight.\n   * @returns True if we should highlight the connection.\n   */\n  shouldHighlightConnection(_conn: Connection): boolean {\n    return true;\n  }\n\n  /**\n   * Checks if an orphaned block can connect to the \"end\" of the topBlock's\n   * block-clump. If the clump is a row the end is the last input. If the clump\n   * is a stack, the end is the last next connection. If the clump is neither,\n   * then this returns false.\n   *\n   * @param topBlock The top block of the block clump we want to try and connect\n   *     to.\n   * @param orphanBlock The orphan block that wants to find a home.\n   * @param localType The type of the connection being dragged.\n   * @returns Whether there is a home for the orphan or not.\n   */\n  protected orphanCanConnectAtEnd(\n    topBlock: BlockSvg,\n    orphanBlock: BlockSvg,\n    localType: number,\n  ): boolean {\n    const orphanConnection =\n      localType === ConnectionType.OUTPUT_VALUE\n        ? orphanBlock.outputConnection\n        : orphanBlock.previousConnection;\n    return !!Connection.getConnectionForOrphanedConnection(\n      topBlock as Block,\n      orphanConnection as Connection,\n    );\n  }\n\n  /**\n   * Chooses a connection preview method based on the available connection, the\n   * current dragged connection, and the block being dragged.\n   *\n   * @param closest The available connection.\n   * @param local The connection currently being dragged.\n   * @param topBlock The block currently being dragged.\n   * @returns The preview type to display.\n   *\n   * @deprecated v10 - This function is no longer respected. A custom\n   *    IConnectionPreviewer may be able to fulfill the functionality.\n   */\n  getConnectionPreviewMethod(\n    closest: RenderedConnection,\n    local: RenderedConnection,\n    topBlock: BlockSvg,\n  ): PreviewType {\n    deprecation.warn(\n      'getConnectionPreviewMethod',\n      'v10',\n      'v12',\n      'an IConnectionPreviewer, if it fulfills your use case.',\n    );\n    if (\n      local.type === ConnectionType.OUTPUT_VALUE ||\n      local.type === ConnectionType.PREVIOUS_STATEMENT\n    ) {\n      if (\n        !closest.isConnected() ||\n        this.orphanCanConnectAtEnd(\n          topBlock,\n          closest.targetBlock() as BlockSvg,\n          local.type,\n        )\n      ) {\n        return InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER;\n      }\n      return InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE;\n    }\n\n    return InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER;\n  }\n\n  /**\n   * Render the block.\n   *\n   * @param block The block to render.\n   * @internal\n   */\n  render(block: BlockSvg) {\n    const info = this.makeRenderInfo_(block);\n    info.measure();\n    this.makeDrawer_(block, info).draw();\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of storing and updating a workspace theme\n *     and UI components.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ThemeManager\n\nimport type {Theme} from './theme.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as dom from './utils/dom.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for storing and updating a workspace's theme and UI components.\n */\nexport class ThemeManager {\n  /** A list of workspaces that are subscribed to this theme. */\n  private subscribedWorkspaces: Workspace[] = [];\n  private componentDB = new Map<string, Component[]>();\n\n  /**\n   * @param workspace The main workspace.\n   * @param theme The workspace theme.\n   * @internal\n   */\n  constructor(\n    private readonly workspace: WorkspaceSvg,\n    private theme: Theme,\n  ) {}\n\n  /**\n   * Get the workspace theme.\n   *\n   * @returns The workspace theme.\n   * @internal\n   */\n  getTheme(): Theme {\n    return this.theme;\n  }\n\n  /**\n   * Set the workspace theme, and refresh the workspace and all components.\n   *\n   * @param theme The workspace theme.\n   * @internal\n   */\n  setTheme(theme: Theme) {\n    const prevTheme = this.theme;\n    this.theme = theme;\n    // Set the theme name onto the injection div.\n    const injectionDiv = this.workspace.getInjectionDiv();\n    if (injectionDiv) {\n      if (prevTheme) {\n        const oldClassName = prevTheme.getClassName();\n        if (oldClassName) {\n          dom.removeClass(injectionDiv, oldClassName);\n        }\n      }\n      const newClassName = this.theme.getClassName();\n      if (newClassName) {\n        dom.addClass(injectionDiv, newClassName);\n      }\n    }\n\n    // Refresh all subscribed workspaces.\n    for (\n      let i = 0, workspace;\n      (workspace = this.subscribedWorkspaces[i]);\n      i++\n    ) {\n      (workspace as WorkspaceSvg).refreshTheme();\n    }\n\n    // Refresh all registered Blockly UI components.\n    for (const [key, componentList] of this.componentDB) {\n      for (const component of componentList) {\n        const element = component.element;\n        const propertyName = component.propertyName;\n        const style = this.theme && this.theme.getComponentStyle(key);\n        element.style.setProperty(propertyName, style || '');\n      }\n    }\n\n    for (const workspace of this.subscribedWorkspaces) {\n      (workspace as WorkspaceSvg).hideChaff();\n    }\n  }\n\n  /**\n   * Subscribe a workspace to changes to the selected theme.  If a new theme is\n   * set, the workspace is called to refresh its blocks.\n   *\n   * @param workspace The workspace to subscribe.\n   * @internal\n   */\n  subscribeWorkspace(workspace: Workspace) {\n    this.subscribedWorkspaces.push(workspace);\n  }\n\n  /**\n   * Unsubscribe a workspace to changes to the selected theme.\n   *\n   * @param workspace The workspace to unsubscribe.\n   * @internal\n   */\n  unsubscribeWorkspace(workspace: Workspace) {\n    if (!arrayUtils.removeElem(this.subscribedWorkspaces, workspace)) {\n      throw Error(\n        \"Cannot unsubscribe a workspace that hasn't been subscribed.\",\n      );\n    }\n  }\n\n  /**\n   * Subscribe an element to changes to the selected theme.  If a new theme is\n   * selected, the element's style is refreshed with the new theme's style.\n   *\n   * @param element The element to subscribe.\n   * @param componentName The name used to identify the component. This must be\n   *     the same name used to configure the style in the Theme object.\n   * @param propertyName The inline style property name to update.\n   * @internal\n   */\n  subscribe(\n    element: HTMLElement | SVGElement,\n    componentName: string,\n    propertyName: string,\n  ) {\n    if (!this.componentDB.has(componentName)) {\n      this.componentDB.set(componentName, []);\n    }\n\n    // Add the element to our component map.\n    this.componentDB.get(componentName)!.push({element, propertyName});\n\n    // Initialize the element with its corresponding theme style.\n    const style = this.theme && this.theme.getComponentStyle(componentName);\n    element.style.setProperty(propertyName, style || '');\n  }\n\n  /**\n   * Unsubscribe an element to changes to the selected theme.\n   *\n   * @param element The element to unsubscribe.\n   * @internal\n   */\n  unsubscribe(element: HTMLElement | SVGElement) {\n    if (!element) {\n      return;\n    }\n    // Go through all component, and remove any references to this element.\n    for (const [componentName, elements] of this.componentDB) {\n      for (let i = elements.length - 1; i >= 0; i--) {\n        if (elements[i].element === element) {\n          elements.splice(i, 1);\n        }\n      }\n      // Clean up the component map entry if the list is empty.\n      if (!elements.length) {\n        this.componentDB.delete(componentName);\n      }\n    }\n  }\n\n  /**\n   * Dispose of this theme manager.\n   *\n   * @internal\n   */\n  dispose() {\n    this.subscribedWorkspaces.length = 0;\n    this.componentDB.clear();\n  }\n}\n\nexport namespace ThemeManager {\n  /** The type for a Blockly UI Component. */\n  export interface Component {\n    element: HTMLElement | SVGElement;\n    propertyName: string;\n  }\n}\n\nexport type Component = ThemeManager.Component;\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.internalConstants\n\nimport {ConnectionType} from './connection_type.js';\n\n/**\n * Number of characters to truncate a collapsed block to.\n *\n * @internal\n */\nexport const COLLAPSE_CHARS = 30;\n\n/**\n * Lookup table for determining the opposite type of a connection.\n *\n * @internal\n */\nexport const OPPOSITE_TYPE: number[] = [];\nOPPOSITE_TYPE[ConnectionType.INPUT_VALUE] = ConnectionType.OUTPUT_VALUE;\nOPPOSITE_TYPE[ConnectionType.OUTPUT_VALUE] = ConnectionType.INPUT_VALUE;\nOPPOSITE_TYPE[ConnectionType.NEXT_STATEMENT] =\n  ConnectionType.PREVIOUS_STATEMENT;\nOPPOSITE_TYPE[ConnectionType.PREVIOUS_STATEMENT] =\n  ConnectionType.NEXT_STATEMENT;\n\n/**\n * String for use in the dropdown created in field_variable.\n * This string indicates that this option in the dropdown is 'Rename\n * variable...' and if selected, should trigger the prompt to rename a variable.\n *\n * @internal\n */\nexport const RENAME_VARIABLE_ID = 'RENAME_VARIABLE_ID';\n\n/**\n * String for use in the dropdown created in field_variable.\n * This string indicates that this option in the dropdown is 'Delete the \"%1\"\n * variable' and if selected, should trigger the prompt to delete a variable.\n *\n * @internal\n */\nexport const DELETE_VARIABLE_ID = 'DELETE_VARIABLE_ID';\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that encapsulates logic for checking whether a\n * potential connection is safe and valid.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ConnectionChecker\n\nimport * as common from './common.js';\nimport {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport * as internalConstants from './internal_constants.js';\nimport * as registry from './registry.js';\nimport type {RenderedConnection} from './rendered_connection.js';\n\n/**\n * Class for connection type checking logic.\n */\nexport class ConnectionChecker implements IConnectionChecker {\n  /**\n   * Check whether the current connection can connect with the target\n   * connection.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Whether the connection is legal.\n   */\n  canConnect(\n    a: Connection | null,\n    b: Connection | null,\n    isDragging: boolean,\n    opt_distance?: number,\n  ): boolean {\n    return (\n      this.canConnectWithReason(a, b, isDragging, opt_distance) ===\n      Connection.CAN_CONNECT\n    );\n  }\n\n  /**\n   * Checks whether the current connection can connect with the target\n   * connection, and return an error code if there are problems.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Connection.CAN_CONNECT if the connection is legal, an error code\n   *     otherwise.\n   */\n  canConnectWithReason(\n    a: Connection | null,\n    b: Connection | null,\n    isDragging: boolean,\n    opt_distance?: number,\n  ): number {\n    const safety = this.doSafetyChecks(a, b);\n    if (safety !== Connection.CAN_CONNECT) {\n      return safety;\n    }\n\n    // If the safety checks passed, both connections are non-null.\n    const connOne = a!;\n    const connTwo = b!;\n    if (!this.doTypeChecks(connOne, connTwo)) {\n      return Connection.REASON_CHECKS_FAILED;\n    }\n\n    if (\n      isDragging &&\n      !this.doDragChecks(\n        a as RenderedConnection,\n        b as RenderedConnection,\n        opt_distance || 0,\n      )\n    ) {\n      return Connection.REASON_DRAG_CHECKS_FAILED;\n    }\n\n    return Connection.CAN_CONNECT;\n  }\n\n  /**\n   * Helper method that translates a connection error code into a string.\n   *\n   * @param errorCode The error code.\n   * @param a One of the two connections being checked.\n   * @param b The second of the two connections being checked.\n   * @returns A developer-readable error string.\n   */\n  getErrorMessage(\n    errorCode: number,\n    a: Connection | null,\n    b: Connection | null,\n  ): string {\n    switch (errorCode) {\n      case Connection.REASON_SELF_CONNECTION:\n        return 'Attempted to connect a block to itself.';\n      case Connection.REASON_DIFFERENT_WORKSPACES:\n        // Usually this means one block has been deleted.\n        return 'Blocks not on same workspace.';\n      case Connection.REASON_WRONG_TYPE:\n        return 'Attempt to connect incompatible types.';\n      case Connection.REASON_TARGET_NULL:\n        return 'Target connection is null.';\n      case Connection.REASON_CHECKS_FAILED: {\n        const connOne = a!;\n        const connTwo = b!;\n        let msg = 'Connection checks failed. ';\n        msg +=\n          connOne +\n          ' expected ' +\n          connOne.getCheck() +\n          ', found ' +\n          connTwo.getCheck();\n        return msg;\n      }\n      case Connection.REASON_SHADOW_PARENT:\n        return 'Connecting non-shadow to shadow block.';\n      case Connection.REASON_DRAG_CHECKS_FAILED:\n        return 'Drag checks failed.';\n      case Connection.REASON_PREVIOUS_AND_OUTPUT:\n        return 'Block would have an output and a previous connection.';\n      default:\n        return 'Unknown connection failure: this should never happen!';\n    }\n  }\n\n  /**\n   * Check that connecting the given connections is safe, meaning that it would\n   * not break any of Blockly's basic assumptions (e.g. no self connections).\n   *\n   * @param a The first of the connections to check.\n   * @param b The second of the connections to check.\n   * @returns An enum with the reason this connection is safe or unsafe.\n   */\n  doSafetyChecks(a: Connection | null, b: Connection | null): number {\n    if (!a || !b) {\n      return Connection.REASON_TARGET_NULL;\n    }\n    let superiorBlock;\n    let inferiorBlock;\n    let superiorConnection;\n    let inferiorConnection;\n    if (a.isSuperior()) {\n      superiorBlock = a.getSourceBlock();\n      inferiorBlock = b.getSourceBlock();\n      superiorConnection = a;\n      inferiorConnection = b;\n    } else {\n      inferiorBlock = a.getSourceBlock();\n      superiorBlock = b.getSourceBlock();\n      inferiorConnection = a;\n      superiorConnection = b;\n    }\n    if (superiorBlock === inferiorBlock) {\n      return Connection.REASON_SELF_CONNECTION;\n    } else if (\n      inferiorConnection.type !==\n      internalConstants.OPPOSITE_TYPE[superiorConnection.type]\n    ) {\n      return Connection.REASON_WRONG_TYPE;\n    } else if (superiorBlock.workspace !== inferiorBlock.workspace) {\n      return Connection.REASON_DIFFERENT_WORKSPACES;\n    } else if (superiorBlock.isShadow() && !inferiorBlock.isShadow()) {\n      return Connection.REASON_SHADOW_PARENT;\n    } else if (\n      inferiorConnection.type === ConnectionType.OUTPUT_VALUE &&\n      inferiorBlock.previousConnection &&\n      inferiorBlock.previousConnection.isConnected()\n    ) {\n      return Connection.REASON_PREVIOUS_AND_OUTPUT;\n    } else if (\n      inferiorConnection.type === ConnectionType.PREVIOUS_STATEMENT &&\n      inferiorBlock.outputConnection &&\n      inferiorBlock.outputConnection.isConnected()\n    ) {\n      return Connection.REASON_PREVIOUS_AND_OUTPUT;\n    }\n    return Connection.CAN_CONNECT;\n  }\n\n  /**\n   * Check whether this connection is compatible with another connection with\n   * respect to the value type system.  E.g. square_root(\"Hello\") is not\n   * compatible.\n   *\n   * @param a Connection to compare.\n   * @param b Connection to compare against.\n   * @returns True if the connections share a type.\n   */\n  doTypeChecks(a: Connection, b: Connection): boolean {\n    const checkArrayOne = a.getCheck();\n    const checkArrayTwo = b.getCheck();\n\n    if (!checkArrayOne || !checkArrayTwo) {\n      // One or both sides are promiscuous enough that anything will fit.\n      return true;\n    }\n    // Find any intersection in the check lists.\n    for (let i = 0; i < checkArrayOne.length; i++) {\n      if (checkArrayTwo.includes(checkArrayOne[i])) {\n        return true;\n      }\n    }\n    // No intersection.\n    return false;\n  }\n\n  /**\n   * Check whether this connection can be made by dragging.\n   *\n   * @param a Connection to compare (on the block that's being dragged).\n   * @param b Connection to compare against.\n   * @param distance The maximum allowable distance between connections.\n   * @returns True if the connection is allowed during a drag.\n   */\n  doDragChecks(\n    a: RenderedConnection,\n    b: RenderedConnection,\n    distance: number,\n  ): boolean {\n    if (a.distanceFrom(b) > distance) {\n      return false;\n    }\n\n    // Don't consider insertion markers.\n    if (b.getSourceBlock().isInsertionMarker()) {\n      return false;\n    }\n\n    switch (b.type) {\n      case ConnectionType.PREVIOUS_STATEMENT:\n        return this.canConnectToPrevious_(a, b);\n      case ConnectionType.OUTPUT_VALUE: {\n        // Don't offer to connect an already connected left (male) value plug to\n        // an available right (female) value plug.\n        if (\n          (b.isConnected() && !b.targetBlock()!.isInsertionMarker()) ||\n          a.isConnected()\n        ) {\n          return false;\n        }\n        break;\n      }\n      case ConnectionType.INPUT_VALUE: {\n        // Offering to connect the left (male) of a value block to an already\n        // connected value pair is ok, we'll splice it in.\n        // However, don't offer to splice into an immovable block.\n        if (\n          b.isConnected() &&\n          !b.targetBlock()!.isMovable() &&\n          !b.targetBlock()!.isShadow()\n        ) {\n          return false;\n        }\n        break;\n      }\n      case ConnectionType.NEXT_STATEMENT: {\n        // Don't let a block with no next connection bump other blocks out of\n        // the stack.  But covering up a shadow block or stack of shadow blocks\n        // is fine.  Similarly, replacing a terminal statement with another\n        // terminal statement is allowed.\n        if (\n          b.isConnected() &&\n          !a.getSourceBlock().nextConnection &&\n          !b.targetBlock()!.isShadow() &&\n          b.targetBlock()!.nextConnection\n        ) {\n          return false;\n        }\n\n        // Don't offer to splice into a stack where the connected block is\n        // immovable, unless the block is a shadow block.\n        if (\n          b.targetBlock() &&\n          !b.targetBlock()!.isMovable() &&\n          !b.targetBlock()!.isShadow()\n        ) {\n          return false;\n        }\n        break;\n      }\n      default:\n        // Unexpected connection type.\n        return false;\n    }\n\n    // Don't let blocks try to connect to themselves or ones they nest.\n    if (common.draggingConnections.includes(b)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Helper function for drag checking.\n   *\n   * @param a The connection to check, which must be a statement input or next\n   *     connection.\n   * @param b A nearby connection to check, which must be a previous connection.\n   * @returns True if the connection is allowed, false otherwise.\n   */\n  protected canConnectToPrevious_(a: Connection, b: Connection): boolean {\n    if (a.targetConnection) {\n      // This connection is already occupied.\n      // A next connection will never disconnect itself mid-drag.\n      return false;\n    }\n\n    // Don't let blocks try to connect to themselves or ones they nest.\n    if (common.draggingConnections.includes(b)) {\n      return false;\n    }\n\n    if (!b.targetConnection) {\n      return true;\n    }\n\n    const targetBlock = b.targetBlock();\n    // If it is connected to a real block, game over.\n    if (!targetBlock!.isInsertionMarker()) {\n      return false;\n    }\n    // If it's connected to an insertion marker but that insertion marker\n    // is the first block in a stack, it's still fine.  If that insertion\n    // marker is in the middle of a stack, it won't work.\n    return !targetBlock!.getPreviousBlock();\n  }\n}\n\nregistry.register(\n  registry.Type.CONNECTION_CHECKER,\n  registry.DEFAULT,\n  ConnectionChecker,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Events.VarDelete\n\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\nimport type {Workspace} from '../workspace.js';\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that a variable model has been deleted.\n *\n * @class\n */\nexport class VarDelete extends VarBase {\n  override type = EventType.VAR_DELETE;\n  /** The type of the variable that was deleted. */\n  varType?: string;\n  /** The name of the variable that was deleted. */\n  varName?: string;\n\n  /**\n   * @param opt_variable The deleted variable. Undefined for a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return; // Blank event to be populated by fromJson.\n    }\n    this.varType = opt_variable.type;\n    this.varName = opt_variable.name;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarDeleteJson {\n    const json = super.toJson() as VarDeleteJson;\n    if (this.varType === undefined) {\n      throw new Error(\n        'The var type is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.varName) {\n      throw new Error(\n        'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['varType'] = this.varType;\n    json['varName'] = this.varName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarDelete, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: VarDeleteJson,\n    workspace: Workspace,\n    event?: any,\n  ): VarDelete {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new VarDelete(),\n    ) as VarDelete;\n    newEvent.varType = json['varType'];\n    newEvent.varName = json['varName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable deletion event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n        'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.varName) {\n      throw new Error(\n        'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (forward) {\n      workspace.deleteVariableById(this.varId);\n    } else {\n      workspace.createVariable(this.varName, this.varType, this.varId);\n    }\n  }\n}\n\nexport interface VarDeleteJson extends VarBaseJson {\n  varType: string;\n  varName: string;\n}\n\nregistry.register(registry.Type.EVENT, EventType.VAR_DELETE, VarDelete);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Events.VarRename\n\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\nimport type {Workspace} from '../workspace.js';\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that a variable model was renamed.\n *\n * @class\n */\nexport class VarRename extends VarBase {\n  override type = EventType.VAR_RENAME;\n\n  /** The previous name of the variable. */\n  oldName?: string;\n\n  /** The new name of the variable. */\n  newName?: string;\n\n  /**\n   * @param opt_variable The renamed variable. Undefined for a blank event.\n   * @param newName The new name the variable will be changed to.\n   */\n  constructor(opt_variable?: VariableModel, newName?: string) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return; // Blank event to be populated by fromJson.\n    }\n    this.oldName = opt_variable.name;\n    this.newName = typeof newName === 'undefined' ? '' : newName;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarRenameJson {\n    const json = super.toJson() as VarRenameJson;\n    if (!this.oldName) {\n      throw new Error(\n        'The old var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newName) {\n      throw new Error(\n        'The new var name is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['oldName'] = this.oldName;\n    json['newName'] = this.newName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarRename, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: VarRenameJson,\n    workspace: Workspace,\n    event?: any,\n  ): VarRename {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new VarRename(),\n    ) as VarRename;\n    newEvent.oldName = json['oldName'];\n    newEvent.newName = json['newName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable rename event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n        'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.oldName) {\n      throw new Error(\n        'The old var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newName) {\n      throw new Error(\n        'The new var name is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (forward) {\n      workspace.renameVariableById(this.varId, this.newName);\n    } else {\n      workspace.renameVariableById(this.varId, this.oldName);\n    }\n  }\n}\n\nexport interface VarRenameJson extends VarBaseJson {\n  oldName: string;\n  newName: string;\n}\n\nregistry.register(registry.Type.EVENT, EventType.VAR_RENAME, VarRename);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a map of variables and their types.\n *\n * @class\n */\n// Former goog.module ID: Blockly.VariableMap\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_delete.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_rename.js';\n\nimport type {Block} from './block.js';\nimport * as dialog from './dialog.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport {Msg} from './msg.js';\nimport {Names} from './names.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Class for a variable map.  This contains a dictionary data structure with\n * variable types as keys and lists of variables as values.  The list of\n * variables are the type indicated by the key.\n */\nexport class VariableMap {\n  /**\n   * A map from variable type to list of variable names.  The lists contain\n   * all of the named variables in the workspace, including variables that are\n   * not currently in use.\n   */\n  private variableMap = new Map<string, VariableModel[]>();\n\n  /** @param workspace The workspace this map belongs to. */\n  constructor(public workspace: Workspace) {}\n\n  /** Clear the variable map.  Fires events for every deletion. */\n  clear() {\n    for (const variables of this.variableMap.values()) {\n      while (variables.length > 0) {\n        this.deleteVariable(variables[0]);\n      }\n    }\n    if (this.variableMap.size !== 0) {\n      throw Error('Non-empty variable map');\n    }\n  }\n\n  /* Begin functions for renaming variables. */\n  /**\n   * Rename the given variable by updating its name in the variable map.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @internal\n   */\n  renameVariable(variable: VariableModel, newName: string) {\n    if (variable.name === newName) return;\n    const type = variable.type;\n    const conflictVar = this.getVariable(newName, type);\n    const blocks = this.workspace.getAllBlocks(false);\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    try {\n      // The IDs may match if the rename is a simple case change (name1 ->\n      // Name1).\n      if (!conflictVar || conflictVar.getId() === variable.getId()) {\n        this.renameVariableAndUses(variable, newName, blocks);\n      } else {\n        this.renameVariableWithConflict(variable, newName, conflictVar, blocks);\n      }\n    } finally {\n      eventUtils.setGroup(existingGroup);\n    }\n  }\n\n  /**\n   * Rename a variable by updating its name in the variable map. Identify the\n   * variable to rename with the given ID.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  renameVariableById(id: string, newName: string) {\n    const variable = this.getVariableById(id);\n    if (!variable) {\n      throw Error(\"Tried to rename a variable that didn't exist. ID: \" + id);\n    }\n\n    this.renameVariable(variable, newName);\n  }\n\n  /**\n   * Update the name of the given variable and refresh all references to it.\n   * The new name must not conflict with any existing variable names.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @param blocks The list of all blocks in the workspace.\n   */\n  private renameVariableAndUses(\n    variable: VariableModel,\n    newName: string,\n    blocks: Block[],\n  ) {\n    eventUtils.fire(\n      new (eventUtils.get(EventType.VAR_RENAME))(variable, newName),\n    );\n    variable.name = newName;\n    for (let i = 0; i < blocks.length; i++) {\n      blocks[i].updateVarName(variable);\n    }\n  }\n\n  /**\n   * Update the name of the given variable to the same name as an existing\n   * variable.  The two variables are coalesced into a single variable with the\n   * ID of the existing variable that was already using newName. Refresh all\n   * references to the variable.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @param conflictVar The variable that was already using newName.\n   * @param blocks The list of all blocks in the workspace.\n   */\n  private renameVariableWithConflict(\n    variable: VariableModel,\n    newName: string,\n    conflictVar: VariableModel,\n    blocks: Block[],\n  ) {\n    const type = variable.type;\n    const oldCase = conflictVar.name;\n\n    if (newName !== oldCase) {\n      // Simple rename to change the case and update references.\n      this.renameVariableAndUses(conflictVar, newName, blocks);\n    }\n\n    // These blocks now refer to a different variable.\n    // These will fire change events.\n    for (let i = 0; i < blocks.length; i++) {\n      blocks[i].renameVarById(variable.getId(), conflictVar.getId());\n    }\n    // Finally delete the original variable, which is now unreferenced.\n    eventUtils.fire(new (eventUtils.get(EventType.VAR_DELETE))(variable));\n    // And remove it from the list.\n    arrayUtils.removeElem(this.variableMap.get(type)!, variable);\n  }\n\n  /* End functions for renaming variables. */\n  /**\n   * Create a variable with a given name, optional type, and optional ID.\n   *\n   * @param name The name of the variable. This must be unique across variables\n   *     and procedures.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  createVariable(\n    name: string,\n    opt_type?: string | null,\n    opt_id?: string | null,\n  ): VariableModel {\n    let variable = this.getVariable(name, opt_type);\n    if (variable) {\n      if (opt_id && variable.getId() !== opt_id) {\n        throw Error(\n          'Variable \"' +\n            name +\n            '\" is already in use and its id is \"' +\n            variable.getId() +\n            '\" which conflicts with the passed in ' +\n            'id, \"' +\n            opt_id +\n            '\".',\n        );\n      }\n      // The variable already exists and has the same ID.\n      return variable;\n    }\n    if (opt_id && this.getVariableById(opt_id)) {\n      throw Error('Variable id, \"' + opt_id + '\", is already in use.');\n    }\n    const id = opt_id || idGenerator.genUid();\n    const type = opt_type || '';\n    variable = new VariableModel(this.workspace, name, type, id);\n\n    const variables = this.variableMap.get(type) || [];\n    variables.push(variable);\n    // Delete the list of variables of this type, and re-add it so that\n    // the most recent addition is at the end.\n    // This is used so the toolbox's set block is set to the most recent\n    // variable.\n    this.variableMap.delete(type);\n    this.variableMap.set(type, variables);\n\n    eventUtils.fire(new (eventUtils.get(EventType.VAR_CREATE))(variable));\n\n    return variable;\n  }\n\n  /* Begin functions for variable deletion. */\n  /**\n   * Delete a variable.\n   *\n   * @param variable Variable to delete.\n   */\n  deleteVariable(variable: VariableModel) {\n    const variableId = variable.getId();\n    const variableList = this.variableMap.get(variable.type);\n    if (variableList) {\n      for (let i = 0; i < variableList.length; i++) {\n        const tempVar = variableList[i];\n        if (tempVar.getId() === variableId) {\n          variableList.splice(i, 1);\n          eventUtils.fire(new (eventUtils.get(EventType.VAR_DELETE))(variable));\n          if (variableList.length === 0) {\n            this.variableMap.delete(variable.type);\n          }\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Delete a variables by the passed in ID and all of its uses from this\n   * workspace. May prompt the user for confirmation.\n   *\n   * @param id ID of variable to delete.\n   */\n  deleteVariableById(id: string) {\n    const variable = this.getVariableById(id);\n    if (variable) {\n      // Check whether this variable is a function parameter before deleting.\n      const variableName = variable.name;\n      const uses = this.getVariableUsesById(id);\n      for (let i = 0, block; (block = uses[i]); i++) {\n        if (\n          block.type === 'procedures_defnoreturn' ||\n          block.type === 'procedures_defreturn'\n        ) {\n          const procedureName = String(block.getFieldValue('NAME'));\n          const deleteText = Msg['CANNOT_DELETE_VARIABLE_PROCEDURE']\n            .replace('%1', variableName)\n            .replace('%2', procedureName);\n          dialog.alert(deleteText);\n          return;\n        }\n      }\n\n      if (uses.length > 1) {\n        // Confirm before deleting multiple blocks.\n        const confirmText = Msg['DELETE_VARIABLE_CONFIRMATION']\n          .replace('%1', String(uses.length))\n          .replace('%2', variableName);\n        dialog.confirm(confirmText, (ok) => {\n          if (ok && variable) {\n            this.deleteVariableInternal(variable, uses);\n          }\n        });\n      } else {\n        // No confirmation necessary for a single block.\n        this.deleteVariableInternal(variable, uses);\n      }\n    } else {\n      console.warn(\"Can't delete non-existent variable: \" + id);\n    }\n  }\n\n  /**\n   * Deletes a variable and all of its uses from this workspace without asking\n   * the user for confirmation.\n   *\n   * @param variable Variable to delete.\n   * @param uses An array of uses of the variable.\n   * @internal\n   */\n  deleteVariableInternal(variable: VariableModel, uses: Block[]) {\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    try {\n      for (let i = 0; i < uses.length; i++) {\n        uses[i].dispose(true);\n      }\n      this.deleteVariable(variable);\n    } finally {\n      eventUtils.setGroup(existingGroup);\n    }\n  }\n  /* End functions for variable deletion. */\n  /**\n   * Find the variable by the given name and type and return it.  Return null if\n   *     it is not found.\n   *\n   * @param name The name to check for.\n   * @param opt_type The type of the variable.  If not provided it defaults to\n   *     the empty string, which is a specific type.\n   * @returns The variable with the given name, or null if it was not found.\n   */\n  getVariable(name: string, opt_type?: string | null): VariableModel | null {\n    const type = opt_type || '';\n    const list = this.variableMap.get(type);\n    if (list) {\n      for (let j = 0, variable; (variable = list[j]); j++) {\n        if (Names.equals(variable.name, name)) {\n          return variable;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Find the variable by the given ID and return it.  Return null if not found.\n   *\n   * @param id The ID to check for.\n   * @returns The variable with the given ID.\n   */\n  getVariableById(id: string): VariableModel | null {\n    for (const variables of this.variableMap.values()) {\n      for (const variable of variables) {\n        if (variable.getId() === id) {\n          return variable;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Get a list containing all of the variables of a specified type. If type is\n   *     null, return list of variables with empty string type.\n   *\n   * @param type Type of the variables to find.\n   * @returns The sought after variables of the passed in type. An empty array\n   *     if none are found.\n   */\n  getVariablesOfType(type: string | null): VariableModel[] {\n    type = type || '';\n    const variableList = this.variableMap.get(type);\n    if (variableList) {\n      return variableList.slice();\n    }\n    return [];\n  }\n\n  /**\n   * Return all variable and potential variable types.  This list always\n   * contains the empty string.\n   *\n   * @param ws The workspace used to look for potential variables. This can be\n   *     different than the workspace stored on this object if the passed in ws\n   *     is a flyout workspace.\n   * @returns List of variable types.\n   * @internal\n   */\n  getVariableTypes(ws: Workspace | null): string[] {\n    const variableTypes = new Set<string>(this.variableMap.keys());\n    if (ws && ws.getPotentialVariableMap()) {\n      for (const key of ws.getPotentialVariableMap()!.variableMap.keys()) {\n        variableTypes.add(key);\n      }\n    }\n    if (!variableTypes.has('')) {\n      variableTypes.add('');\n    }\n    return Array.from(variableTypes.values());\n  }\n\n  /**\n   * Return all variables of all types.\n   *\n   * @returns List of variable models.\n   */\n  getAllVariables(): VariableModel[] {\n    let allVariables: VariableModel[] = [];\n    for (const variables of this.variableMap.values()) {\n      allVariables = allVariables.concat(variables);\n    }\n    return allVariables;\n  }\n\n  /**\n   * Returns all of the variable names of all types.\n   *\n   * @returns All of the variable names of all types.\n   */\n  getAllVariableNames(): string[] {\n    return Array.from(this.variableMap.values())\n      .flat()\n      .map((variable) => variable.name);\n  }\n\n  /**\n   * Find all the uses of a named variable.\n   *\n   * @param id ID of the variable to find.\n   * @returns Array of block usages.\n   */\n  getVariableUsesById(id: string): Block[] {\n    const uses = [];\n    const blocks = this.workspace.getAllBlocks(false);\n    // Iterate through every block and check the name.\n    for (let i = 0; i < blocks.length; i++) {\n      const blockVariables = blocks[i].getVarModels();\n      if (blockVariables) {\n        for (let j = 0; j < blockVariables.length; j++) {\n          if (blockVariables[j].getId() === id) {\n            uses.push(blocks[i]);\n          }\n        }\n      }\n    }\n    return uses;\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Workspace\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './connection_checker.js';\n\nimport type {Block} from './block.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport {WorkspaceComment} from './comments/workspace_comment.js';\nimport * as common from './common.js';\nimport type {ConnectionDB} from './connection_db.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport {ObservableProcedureMap} from './observable_procedure_map.js';\nimport {Options} from './options.js';\nimport * as registry from './registry.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as math from './utils/math.js';\nimport type * as toolbox from './utils/toolbox.js';\nimport {VariableMap} from './variable_map.js';\nimport type {VariableModel} from './variable_model.js';\n\n/**\n * Class for a workspace.  This is a data structure that contains blocks.\n * There is no UI, and can be created headlessly.\n */\nexport class Workspace implements IASTNodeLocation {\n  /**\n   * Angle away from the horizontal to sweep for blocks.  Order of execution is\n   * generally top to bottom, but a small angle changes the scan to give a bit\n   * of a left to right bias (reversed in RTL).  Units are in degrees. See:\n   * https://tvtropes.org/pmwiki/pmwiki.php/Main/DiagonalBilling\n   */\n  static SCAN_ANGLE = 3;\n  id: string;\n  options: Options;\n  RTL: boolean;\n  horizontalLayout: boolean;\n  toolboxPosition: toolbox.Position;\n\n  /**\n   * Returns `true` if the workspace is visible and `false` if it's headless.\n   */\n  rendered = false;\n\n  /**\n   * Is this workspace the surface for a flyout?\n   *\n   * @internal\n   */\n  internalIsFlyout = false;\n\n  /** Is this workspace the surface for a flyout? */\n  get isFlyout(): boolean {\n    return this.internalIsFlyout;\n  }\n\n  /**\n   * Is this workspace the surface for a mutator?\n   *\n   * @internal\n   */\n  internalIsMutator = false;\n\n  /** Is this workspace the surface for a mutator? */\n  get isMutator(): boolean {\n    return this.internalIsMutator;\n  }\n\n  /**\n   * Returns `true` if the workspace is currently in the process of a bulk\n   * clear.\n   *\n   * @internal\n   */\n  isClearing = false;\n\n  /**\n   * Maximum number of undo events in stack. `0` turns off undo, `Infinity`\n   * sets it to unlimited.\n   */\n  MAX_UNDO = 1024;\n\n  /** Set of databases for rapid lookup of connection locations. */\n  connectionDBList: ConnectionDB[] = [];\n  connectionChecker: IConnectionChecker;\n\n  private readonly topBlocks: Block[] = [];\n  private readonly topComments: WorkspaceComment[] = [];\n  private readonly commentDB = new Map<string, WorkspaceComment>();\n  private readonly listeners: ((e: Abstract) => void)[] = [];\n  protected undoStack_: Abstract[] = [];\n  protected redoStack_: Abstract[] = [];\n  private readonly blockDB = new Map<string, Block>();\n  private readonly typedBlocksDB = new Map<string, Block[]>();\n  private variableMap: VariableMap;\n  private procedureMap: IProcedureMap = new ObservableProcedureMap();\n\n  /**\n   * Blocks in the flyout can refer to variables that don't exist in the main\n   * workspace.  For instance, the \"get item in list\" block refers to an\n   * \"item\" variable regardless of whether the variable has been created yet.\n   * A FieldVariable must always refer to a VariableModel.  We reconcile\n   * these by tracking \"potential\" variables in the flyout.  These variables\n   * become real when references to them are dragged into the main workspace.\n   */\n  private potentialVariableMap: VariableMap | null = null;\n\n  /** @param opt_options Dictionary of options. */\n  constructor(opt_options?: Options) {\n    this.id = idGenerator.genUid();\n    common.registerWorkspace(this);\n    this.options = opt_options || new Options({} as BlocklyOptions);\n    this.RTL = !!this.options.RTL;\n    this.horizontalLayout = !!this.options.horizontalLayout;\n    this.toolboxPosition = this.options.toolboxPosition;\n\n    const connectionCheckerClass = registry.getClassFromOptions(\n      registry.Type.CONNECTION_CHECKER,\n      this.options,\n      true,\n    );\n    /**\n     * An object that encapsulates logic for safety, type, and dragging checks.\n     */\n    this.connectionChecker = new connectionCheckerClass!(this);\n\n    /**\n     * A map from variable type to list of variable names.  The lists contain\n     * all of the named variables in the workspace, including variables that are\n     * not currently in use.\n     */\n    this.variableMap = new VariableMap(this);\n  }\n\n  /**\n   * Dispose of this workspace.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.listeners.length = 0;\n    this.clear();\n    // Remove from workspace database.\n    common.unregisterWorkpace(this);\n  }\n\n  /**\n   * Compare function for sorting objects (blocks, comments, etc) by position;\n   *    top to bottom (with slight LTR or RTL bias).\n   *\n   * @param a The first object to compare.\n   * @param b The second object to compare.\n   * @returns The comparison value. This tells Array.sort() how to change object\n   *     a's index.\n   */\n  private sortObjects(\n    a: Block | WorkspaceComment,\n    b: Block | WorkspaceComment,\n  ): number {\n    const offset =\n      Math.sin(math.toRadians(Workspace.SCAN_ANGLE)) * (this.RTL ? -1 : 1);\n    const aXY = a.getRelativeToSurfaceXY();\n    const bXY = b.getRelativeToSurfaceXY();\n    return aXY.y + offset * aXY.x - (bXY.y + offset * bXY.x);\n  }\n\n  /**\n   * Adds a block to the list of top blocks.\n   *\n   * @param block Block to add.\n   */\n  addTopBlock(block: Block) {\n    this.topBlocks.push(block);\n  }\n\n  /**\n   * Removes a block from the list of top blocks.\n   *\n   * @param block Block to remove.\n   */\n  removeTopBlock(block: Block) {\n    if (!arrayUtils.removeElem(this.topBlocks, block)) {\n      throw Error(\"Block not present in workspace's list of top-most blocks.\");\n    }\n  }\n\n  /**\n   * Finds the top-level blocks and returns them.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level block objects.\n   */\n  getTopBlocks(ordered = false): Block[] {\n    // Copy the topBlocks list.\n    const blocks = new Array<Block>().concat(this.topBlocks);\n    if (ordered && blocks.length > 1) {\n      blocks.sort(this.sortObjects.bind(this));\n    }\n    return blocks;\n  }\n\n  /**\n   * Add a block to the list of blocks keyed by type.\n   *\n   * @param block Block to add.\n   */\n  addTypedBlock(block: Block) {\n    if (!this.typedBlocksDB.has(block.type)) {\n      this.typedBlocksDB.set(block.type, []);\n    }\n    this.typedBlocksDB.get(block.type)!.push(block);\n  }\n\n  /**\n   * Remove a block from the list of blocks keyed by type.\n   *\n   * @param block Block to remove.\n   */\n  removeTypedBlock(block: Block) {\n    arrayUtils.removeElem(this.typedBlocksDB.get(block.type)!, block);\n    if (!this.typedBlocksDB.get(block.type)!.length) {\n      this.typedBlocksDB.delete(block.type);\n    }\n  }\n\n  /**\n   * Finds the blocks with the associated type and returns them. Blocks are\n   * optionally sorted by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param type The type of block to search for.\n   * @param ordered Sort the list if true.\n   * @returns The blocks of the given type.\n   */\n  getBlocksByType(type: string, ordered = false): Block[] {\n    if (!this.typedBlocksDB.has(type)) {\n      return [];\n    }\n    const blocks = this.typedBlocksDB.get(type)!.slice(0);\n    if (ordered && blocks && blocks.length > 1) {\n      blocks.sort(this.sortObjects.bind(this));\n    }\n\n    return blocks.filter((block) => !block.isInsertionMarker());\n  }\n\n  /**\n   * Adds a comment to the list of top comments.\n   *\n   * @param comment comment to add.\n   * @internal\n   */\n  addTopComment(comment: WorkspaceComment) {\n    this.topComments.push(comment);\n\n    // Note: If the comment database starts to hold block comments, this may\n    // need to move to a separate function.\n    if (this.commentDB.has(comment.id)) {\n      console.warn(\n        'Overriding an existing comment on this workspace, with id \"' +\n          comment.id +\n          '\"',\n      );\n    }\n    this.commentDB.set(comment.id, comment);\n  }\n\n  /**\n   * Removes a comment from the list of top comments.\n   *\n   * @param comment comment to remove.\n   * @internal\n   */\n  removeTopComment(comment: WorkspaceComment) {\n    if (!arrayUtils.removeElem(this.topComments, comment)) {\n      throw Error(\n        \"Comment not present in workspace's list of top-most \" + 'comments.',\n      );\n    }\n    // Note: If the comment database starts to hold block comments, this may\n    // need to move to a separate function.\n    this.commentDB.delete(comment.id);\n  }\n\n  /**\n   * Finds the top-level comments and returns them.  Comments are optionally\n   * sorted by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level comment objects.\n   * @internal\n   */\n  getTopComments(ordered = false): WorkspaceComment[] {\n    // Copy the topComments list.\n    const comments = new Array<WorkspaceComment>().concat(this.topComments);\n    if (ordered && comments.length > 1) {\n      comments.sort(this.sortObjects.bind(this));\n    }\n    return comments;\n  }\n\n  /**\n   * Find all blocks in workspace.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  getAllBlocks(ordered = false): Block[] {\n    let blocks: Block[];\n    if (ordered) {\n      // Slow, but ordered.\n      const topBlocks = this.getTopBlocks(true);\n      blocks = [];\n      for (let i = 0; i < topBlocks.length; i++) {\n        blocks.push(...topBlocks[i].getDescendants(true));\n      }\n    } else {\n      // Fast, but in no particular order.\n      blocks = this.getTopBlocks(false);\n      for (let i = 0; i < blocks.length; i++) {\n        blocks.push(...blocks[i].getChildren(false));\n      }\n    }\n\n    // Insertion markers exist on the workspace for rendering reasons, but\n    // aren't \"real\" blocks from a developer perspective.\n    return blocks.filter((block) => !block.isInsertionMarker());\n  }\n\n  /** Dispose of all blocks and comments in workspace. */\n  clear() {\n    this.isClearing = true;\n    try {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      while (this.topBlocks.length) {\n        this.topBlocks[0].dispose(false);\n      }\n      while (this.topComments.length) {\n        this.topComments[this.topComments.length - 1].dispose();\n      }\n      eventUtils.setGroup(existingGroup);\n      this.variableMap.clear();\n      if (this.potentialVariableMap) {\n        this.potentialVariableMap.clear();\n      }\n    } finally {\n      this.isClearing = false;\n    }\n  }\n\n  /* Begin functions that are just pass-throughs to the variable map. */\n  /**\n   * Rename a variable by updating its name in the variable map. Identify the\n   * variable to rename with the given ID.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  renameVariableById(id: string, newName: string) {\n    this.variableMap.renameVariableById(id, newName);\n  }\n\n  /**\n   * Create a variable with a given name, optional type, and optional ID.\n   *\n   * @param name The name of the variable. This must be unique across variables\n   *     and procedures.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  createVariable(\n    name: string,\n    opt_type?: string | null,\n    opt_id?: string | null,\n  ): VariableModel {\n    return this.variableMap.createVariable(name, opt_type, opt_id);\n  }\n\n  /**\n   * Find all the uses of the given variable, which is identified by ID.\n   *\n   * @param id ID of the variable to find.\n   * @returns Array of block usages.\n   */\n  getVariableUsesById(id: string): Block[] {\n    return this.variableMap.getVariableUsesById(id);\n  }\n\n  /**\n   * Delete a variables by the passed in ID and all of its uses from this\n   * workspace. May prompt the user for confirmation.\n   *\n   * @param id ID of variable to delete.\n   */\n  deleteVariableById(id: string) {\n    this.variableMap.deleteVariableById(id);\n  }\n\n  /**\n   * Find the variable by the given name and return it. Return null if not\n   * found.\n   *\n   * @param name The name to check for.\n   * @param opt_type The type of the variable.  If not provided it defaults to\n   *     the empty string, which is a specific type.\n   * @returns The variable with the given name.\n   */\n  getVariable(name: string, opt_type?: string): VariableModel | null {\n    // TODO (#1559): Possibly delete this function after resolving #1559.\n    return this.variableMap.getVariable(name, opt_type);\n  }\n\n  /**\n   * Find the variable by the given ID and return it. Return null if not found.\n   *\n   * @param id The ID to check for.\n   * @returns The variable with the given ID.\n   */\n  getVariableById(id: string): VariableModel | null {\n    return this.variableMap.getVariableById(id);\n  }\n\n  /**\n   * Find the variable with the specified type. If type is null, return list of\n   *     variables with empty string type.\n   *\n   * @param type Type of the variables to find.\n   * @returns The sought after variables of the passed in type. An empty array\n   *     if none are found.\n   */\n  getVariablesOfType(type: string | null): VariableModel[] {\n    return this.variableMap.getVariablesOfType(type);\n  }\n\n  /**\n   * Return all variable types.\n   *\n   * @returns List of variable types.\n   * @internal\n   */\n  getVariableTypes(): string[] {\n    return this.variableMap.getVariableTypes(this);\n  }\n\n  /**\n   * Return all variables of all types.\n   *\n   * @returns List of variable models.\n   */\n  getAllVariables(): VariableModel[] {\n    return this.variableMap.getAllVariables();\n  }\n\n  /**\n   * Returns all variable names of all types.\n   *\n   * @returns List of all variable names of all types.\n   */\n  getAllVariableNames(): string[] {\n    return this.variableMap.getAllVariableNames();\n  }\n  /* End functions that are just pass-throughs to the variable map. */\n  /**\n   * Returns the horizontal offset of the workspace.\n   * Intended for LTR/RTL compatibility in XML.\n   * Not relevant for a headless workspace.\n   *\n   * @returns Width.\n   */\n  getWidth(): number {\n    return 0;\n  }\n\n  /* eslint-disable jsdoc/require-returns-check */\n  /* eslint-disable @typescript-eslint/no-unused-vars */\n  /**\n   * Obtain a newly created block.\n   *\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created block.\n   */\n  newBlock(prototypeName: string, opt_id?: string): Block {\n    throw new Error(\n      'The implementation of newBlock should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n\n  /**\n   * Obtain a newly created comment.\n   *\n   * @param id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created comment.\n   */\n  newComment(id?: string): WorkspaceComment {\n    throw new Error(\n      'The implementation of newComment should be ' +\n        'monkey-patched in by blockly.ts',\n    );\n  }\n  /* eslint-enable */\n\n  /**\n   * The number of blocks that may be added to the workspace before reaching\n   *     the maxBlocks.\n   *\n   * @returns Number of blocks left.\n   */\n  remainingCapacity(): number {\n    if (isNaN(this.options.maxBlocks)) {\n      return Infinity;\n    }\n\n    return this.options.maxBlocks - this.getAllBlocks(false).length;\n  }\n\n  /**\n   * The number of blocks of the given type that may be added to the workspace\n   *    before reaching the maxInstances allowed for that type.\n   *\n   * @param type Type of block to return capacity for.\n   * @returns Number of blocks of type left.\n   */\n  remainingCapacityOfType(type: string): number {\n    if (!this.options.maxInstances) {\n      return Infinity;\n    }\n\n    const maxInstanceOfType =\n      this.options.maxInstances[type] !== undefined\n        ? this.options.maxInstances[type]\n        : Infinity;\n\n    return maxInstanceOfType - this.getBlocksByType(type, false).length;\n  }\n\n  /**\n   * Check if there is remaining capacity for blocks of the given counts to be\n   *    created. If the total number of blocks represented by the map is more\n   * than the total remaining capacity, it returns false. If a type count is\n   * more than the remaining capacity for that type, it returns false.\n   *\n   * @param typeCountsMap A map of types to counts (usually representing blocks\n   *     to be created).\n   * @returns True if there is capacity for the given map, false otherwise.\n   */\n  isCapacityAvailable(typeCountsMap: {[key: string]: number}): boolean {\n    if (!this.hasBlockLimits()) {\n      return true;\n    }\n    let copyableBlocksCount = 0;\n    for (const type in typeCountsMap) {\n      if (typeCountsMap[type] > this.remainingCapacityOfType(type)) {\n        return false;\n      }\n      copyableBlocksCount += typeCountsMap[type];\n    }\n    if (copyableBlocksCount > this.remainingCapacity()) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Checks if the workspace has any limits on the maximum number of blocks,\n   *    or the maximum number of blocks of specific types.\n   *\n   * @returns True if it has block limits, false otherwise.\n   */\n  hasBlockLimits(): boolean {\n    return this.options.maxBlocks !== Infinity || !!this.options.maxInstances;\n  }\n\n  /**\n   * Gets the undo stack for workplace.\n   *\n   * @returns undo stack\n   * @internal\n   */\n  getUndoStack(): Abstract[] {\n    return this.undoStack_;\n  }\n\n  /**\n   * Gets the redo stack for workplace.\n   *\n   * @returns redo stack\n   * @internal\n   */\n  getRedoStack(): Abstract[] {\n    return this.redoStack_;\n  }\n\n  /**\n   * Undo or redo the previous action.\n   *\n   * @param redo False if undo, true if redo.\n   */\n  undo(redo: boolean) {\n    const inputStack = redo ? this.redoStack_ : this.undoStack_;\n    const outputStack = redo ? this.undoStack_ : this.redoStack_;\n    const inputEvent = inputStack.pop();\n    if (!inputEvent) {\n      return;\n    }\n    const events = [inputEvent];\n    // Do another undo/redo if the next one is of the same group.\n    while (\n      inputStack.length &&\n      inputEvent.group &&\n      inputEvent.group === inputStack[inputStack.length - 1].group\n    ) {\n      const event = inputStack.pop();\n      if (!event) continue;\n      events.push(event);\n    }\n    // Push these popped events on the opposite stack.\n    for (let i = 0; i < events.length; i++) {\n      const event = events[i];\n      outputStack.push(event);\n    }\n    eventUtils.setRecordUndo(false);\n    try {\n      for (let i = 0; i < events.length; i++) {\n        const event = events[i];\n        event.run(redo);\n      }\n    } finally {\n      eventUtils.setRecordUndo(true);\n    }\n  }\n\n  /** Clear the undo/redo stacks. */\n  clearUndo() {\n    this.undoStack_.length = 0;\n    this.redoStack_.length = 0;\n    // Stop any events already in the firing queue from being undoable.\n    eventUtils.clearPendingUndo();\n  }\n\n  /**\n   * When something in this workspace changes, call a function.\n   * Note that there may be a few recent events already on the stack.  Thus the\n   * new change listener might be called with events that occurred a few\n   * milliseconds before the change listener was added.\n   *\n   * @param func Function to call.\n   * @returns Obsolete return value, ignore.\n   */\n  addChangeListener(func: (e: Abstract) => void): (e: Abstract) => void {\n    this.listeners.push(func);\n    return func;\n  }\n\n  /**\n   * Stop listening for this workspace's changes.\n   *\n   * @param func Function to stop calling.\n   */\n  removeChangeListener(func: (e: Abstract) => void) {\n    arrayUtils.removeElem(this.listeners, func);\n  }\n\n  /**\n   * Fire a change event.\n   *\n   * @param event Event to fire.\n   */\n  fireChangeListener(event: Abstract) {\n    if (event.recordUndo) {\n      this.undoStack_.push(event);\n      this.redoStack_.length = 0;\n      while (this.undoStack_.length > this.MAX_UNDO && this.MAX_UNDO >= 0) {\n        this.undoStack_.shift();\n      }\n    }\n    for (let i = 0; i < this.listeners.length; i++) {\n      const func = this.listeners[i];\n      func(event);\n    }\n  }\n\n  /**\n   * Find the block on this workspace with the specified ID.\n   *\n   * @param id ID of block to find.\n   * @returns The sought after block, or null if not found.\n   */\n  getBlockById(id: string): Block | null {\n    return this.blockDB.get(id) || null;\n  }\n\n  /**\n   * Set a block on this workspace with the specified ID.\n   *\n   * @param id ID of block to set.\n   * @param block The block to set.\n   * @internal\n   */\n  setBlockById(id: string, block: Block) {\n    this.blockDB.set(id, block);\n  }\n\n  /**\n   * Delete a block off this workspace with the specified ID.\n   *\n   * @param id ID of block to delete.\n   * @internal\n   */\n  removeBlockById(id: string) {\n    this.blockDB.delete(id);\n  }\n\n  /**\n   * Find the comment on this workspace with the specified ID.\n   *\n   * @param id ID of comment to find.\n   * @returns The sought after comment, or null if not found.\n   */\n  getCommentById(id: string): WorkspaceComment | null {\n    return this.commentDB.get(id) ?? null;\n  }\n\n  /**\n   * Checks whether all value and statement inputs in the workspace are filled\n   * with blocks.\n   *\n   * @param opt_shadowBlocksAreFilled An optional argument controlling whether\n   *     shadow blocks are counted as filled. Defaults to true.\n   * @returns True if all inputs are filled, false otherwise.\n   */\n  allInputsFilled(opt_shadowBlocksAreFilled?: boolean): boolean {\n    const blocks = this.getTopBlocks(false);\n    for (let i = 0; i < blocks.length; i++) {\n      const block = blocks[i];\n      if (!block.allInputsFilled(opt_shadowBlocksAreFilled)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Return the variable map that contains \"potential\" variables.\n   * These exist in the flyout but not in the workspace.\n   *\n   * @returns The potential variable map.\n   * @internal\n   */\n  getPotentialVariableMap(): VariableMap | null {\n    return this.potentialVariableMap;\n  }\n\n  /**\n   * Create and store the potential variable map for this workspace.\n   *\n   * @internal\n   */\n  createPotentialVariableMap() {\n    this.potentialVariableMap = new VariableMap(this);\n  }\n\n  /**\n   * Return the map of all variables on the workspace.\n   *\n   * @returns The variable map.\n   */\n  getVariableMap(): VariableMap {\n    return this.variableMap;\n  }\n\n  /**\n   * Set the map of all variables on the workspace.\n   *\n   * @param variableMap The variable map.\n   * @internal\n   */\n  setVariableMap(variableMap: VariableMap) {\n    this.variableMap = variableMap;\n  }\n\n  /** Returns the map of all procedures on the workpace. */\n  getProcedureMap(): IProcedureMap {\n    return this.procedureMap;\n  }\n\n  /**\n   * Returns the root workspace of this workspace if the workspace has\n   * parent(s).\n   *\n   * E.g. workspaces in flyouts and mini workspace bubbles have parent\n   * workspaces.\n   */\n  getRootWorkspace(): Workspace | null {\n    let outerWs = null;\n    const parent = this.options.parentWorkspace;\n    // If we were in a flyout in a mutator, need to go up two levels to find\n    // the actual parent.\n    if (this.isFlyout) {\n      if (parent && parent.options) {\n        outerWs = parent.options.parentWorkspace;\n      }\n    } else if (parent) {\n      outerWs = parent;\n    }\n    return outerWs;\n  }\n\n  /**\n   * Find the workspace with the specified ID.\n   *\n   * @param id ID of workspace to find.\n   * @returns The sought after workspace or null if not found.\n   */\n  static getById(id: string): Workspace | null {\n    return common.getWorkspaceById(id);\n  }\n\n  /**\n   * Find all workspaces.\n   *\n   * @returns Array of workspaces.\n   */\n  static getAll(): Workspace[] {\n    return common.getAllWorkspaces();\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of loading, storing, and playing audio for a\n *     workspace.\n *\n * @class\n */\n// Former goog.module ID: Blockly.WorkspaceAudio\n\nimport * as userAgent from './utils/useragent.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Prevent a sound from playing if another sound preceded it within this many\n * milliseconds.\n */\nconst SOUND_LIMIT = 100;\n\n/**\n * Class for loading, storing, and playing audio for a workspace.\n */\nexport class WorkspaceAudio {\n  /** Database of pre-loaded sounds. */\n  private sounds = new Map<string, HTMLAudioElement>();\n\n  /** Time that the last sound was played. */\n  private lastSound: Date | null = null;\n\n  /** Whether the audio is muted or not. */\n  private muted: boolean = false;\n\n  /**\n   * @param parentWorkspace The parent of the workspace this audio object\n   *     belongs to, or null.\n   */\n  constructor(private parentWorkspace: WorkspaceSvg) {}\n\n  /**\n   * Dispose of this audio manager.\n   *\n   * @internal\n   */\n  dispose() {\n    this.sounds.clear();\n  }\n\n  /**\n   * Load an audio file.  Cache it, ready for instantaneous playing.\n   *\n   * @param filenames List of file types in decreasing order of preference (i.e.\n   *     increasing size).  E.g. ['media/go.mp3', 'media/go.wav'] Filenames\n   *     include path from Blockly's root.  File extensions matter.\n   * @param name Name of sound.\n   */\n  load(filenames: string[], name: string) {\n    if (!filenames.length) {\n      return;\n    }\n    let audioTest;\n    try {\n      audioTest = new globalThis['Audio']();\n    } catch {\n      // No browser support for Audio.\n      // IE can throw an error even if the Audio object exists.\n      return;\n    }\n    let sound;\n    for (let i = 0; i < filenames.length; i++) {\n      const filename = filenames[i];\n      const ext = filename.match(/\\.(\\w+)$/);\n      if (ext && audioTest.canPlayType('audio/' + ext[1])) {\n        // Found an audio format we can play.\n        sound = new globalThis['Audio'](filename);\n        break;\n      }\n    }\n    if (sound) {\n      this.sounds.set(name, sound);\n    }\n  }\n\n  /**\n   * Preload all the audio files so that they play quickly when asked for.\n   *\n   * @internal\n   */\n  preload() {\n    for (const sound of this.sounds.values()) {\n      sound.volume = 0.01;\n      const playPromise = sound.play();\n      // Edge does not return a promise, so we need to check.\n      if (playPromise !== undefined) {\n        // If we don't wait for the play request to complete before calling\n        // pause() we will get an exception: (DOMException: The play() request\n        // was interrupted) See more:\n        // https://developers.google.com/web/updates/2017/06/play-request-was-interrupted\n        playPromise.then(sound.pause).catch(\n          // Play without user interaction was prevented.\n          function () {},\n        );\n      } else {\n        sound.pause();\n      }\n\n      // iOS can only process one sound at a time.  Trying to load more than one\n      // corrupts the earlier ones.  Just load one and leave the others\n      // uncached.\n      if (userAgent.IPAD || userAgent.IPHONE) {\n        break;\n      }\n    }\n  }\n\n  /**\n   * Play a named sound at specified volume.  If volume is not specified,\n   * use full volume (1).\n   *\n   * @param name Name of sound.\n   * @param opt_volume Volume of sound (0-1).\n   */\n  play(name: string, opt_volume?: number) {\n    if (this.muted) {\n      return;\n    }\n    const sound = this.sounds.get(name);\n    if (sound) {\n      // Don't play one sound on top of another.\n      const now = new Date();\n      if (\n        this.lastSound !== null &&\n        now.getTime() - this.lastSound.getTime() < SOUND_LIMIT\n      ) {\n        return;\n      }\n      this.lastSound = now;\n      let mySound;\n      if (userAgent.IPAD || userAgent.ANDROID) {\n        // Creating a new audio node causes lag in Android and iPad.  Android\n        // refetches the file from the server, iPad uses a singleton audio\n        // node which must be deleted and recreated for each new audio tag.\n        mySound = sound;\n      } else {\n        mySound = sound.cloneNode() as HTMLAudioElement;\n      }\n      mySound.volume = opt_volume === undefined ? 1 : opt_volume;\n      mySound.play();\n    } else if (this.parentWorkspace) {\n      // Maybe a workspace on a lower level knows about this sound.\n      this.parentWorkspace.getAudioManager().play(name, opt_volume);\n    }\n  }\n\n  /**\n   * @param muted If true, mute sounds. Otherwise, play them.\n   */\n  setMuted(muted: boolean) {\n    this.muted = muted;\n  }\n\n  /**\n   * @returns Whether the audio is currently muted or not.\n   */\n  getMuted(): boolean {\n    return this.muted;\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of element select action.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.Selected\n\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Class for a selected event.\n * Notifies listeners that a new element has been selected.\n */\nexport class Selected extends UiBase {\n  /** The id of the last selected selectable element. */\n  oldElementId?: string;\n\n  /**\n   * The id of the newly selected selectable element,\n   * or undefined if unselected.\n   */\n  newElementId?: string;\n\n  override type = EventType.SELECTED;\n\n  /**\n   * @param opt_oldElementId The ID of the previously selected element. Null if\n   *     no element last selected. Undefined for a blank event.\n   * @param opt_newElementId The ID of the selected element. Null if no element\n   *     currently selected (deselect). Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Null if no element previously selected. Undefined for a blank event.\n   */\n  constructor(\n    opt_oldElementId?: string | null,\n    opt_newElementId?: string | null,\n    opt_workspaceId?: string,\n  ) {\n    super(opt_workspaceId);\n\n    this.oldElementId = opt_oldElementId ?? undefined;\n    this.newElementId = opt_newElementId ?? undefined;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): SelectedJson {\n    const json = super.toJson() as SelectedJson;\n    json['oldElementId'] = this.oldElementId;\n    json['newElementId'] = this.newElementId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Selected, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: SelectedJson,\n    workspace: Workspace,\n    event?: any,\n  ): Selected {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new Selected(),\n    ) as Selected;\n    newEvent.oldElementId = json['oldElementId'];\n    newEvent.newElementId = json['newElementId'];\n    return newEvent;\n  }\n}\n\nexport interface SelectedJson extends AbstractEventJson {\n  oldElementId?: string;\n  newElementId?: string;\n}\n\nregistry.register(registry.Type.EVENT, EventType.SELECTED, Selected);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport * as blockAnimation from '../block_animations.js';\nimport {BlockSvg} from '../block_svg.js';\nimport * as bumpObjects from '../bump_objects.js';\nimport {config} from '../config.js';\nimport {Connection} from '../connection.js';\nimport {ConnectionType} from '../connection_type.js';\nimport type {BlockMove} from '../events/events_block_move.js';\nimport {EventType} from '../events/type.js';\nimport * as eventUtils from '../events/utils.js';\nimport {IConnectionPreviewer} from '../interfaces/i_connection_previewer.js';\nimport {IDragStrategy} from '../interfaces/i_draggable.js';\nimport * as layers from '../layers.js';\nimport * as registry from '../registry.js';\nimport {finishQueuedRenders} from '../render_management.js';\nimport {RenderedConnection} from '../rendered_connection.js';\nimport {Coordinate} from '../utils.js';\nimport * as dom from '../utils/dom.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\n/** Represents a nearby valid connection. */\ninterface ConnectionCandidate {\n  /** A connection on the dragging stack that is compatible with neighbour. */\n  local: RenderedConnection;\n\n  /** A nearby connection that is compatible with local. */\n  neighbour: RenderedConnection;\n\n  /** The distance between the local connection and the neighbour connection. */\n  distance: number;\n}\n\nexport class BlockDragStrategy implements IDragStrategy {\n  private workspace: WorkspaceSvg;\n\n  /** The parent block at the start of the drag. */\n  private startParentConn: RenderedConnection | null = null;\n\n  /**\n   * The child block at the start of the drag. Only gets set if\n   * `healStack` is true.\n   */\n  private startChildConn: RenderedConnection | null = null;\n\n  private startLoc: Coordinate | null = null;\n\n  private connectionCandidate: ConnectionCandidate | null = null;\n\n  private connectionPreviewer: IConnectionPreviewer | null = null;\n\n  private dragging = false;\n\n  /**\n   * If this is a shadow block, the offset between this block and the parent\n   * block, to add to the drag location. In workspace units.\n   */\n  private dragOffset = new Coordinate(0, 0);\n\n  /** Was there already an event group in progress when the drag started? */\n  private inGroup: boolean = false;\n\n  constructor(private block: BlockSvg) {\n    this.workspace = block.workspace;\n  }\n\n  /** Returns true if the block is currently movable. False otherwise. */\n  isMovable(): boolean {\n    if (this.block.isShadow()) {\n      return this.block.getParent()?.isMovable() ?? false;\n    }\n\n    return (\n      this.block.isOwnMovable() &&\n      !this.block.isDeadOrDying() &&\n      !this.workspace.options.readOnly &&\n      // We never drag blocks in the flyout, only create new blocks that are\n      // dragged.\n      !this.block.isInFlyout\n    );\n  }\n\n  /**\n   * Handles any setup for starting the drag, including disconnecting the block\n   * from any parent blocks.\n   */\n  startDrag(e?: PointerEvent): void {\n    if (this.block.isShadow()) {\n      this.startDraggingShadow(e);\n      return;\n    }\n\n    this.dragging = true;\n    this.inGroup = !!eventUtils.getGroup();\n    if (!this.inGroup) {\n      eventUtils.setGroup(true);\n    }\n    this.fireDragStartEvent();\n\n    this.startLoc = this.block.getRelativeToSurfaceXY();\n\n    this.connectionCandidate = null;\n    const previewerConstructor = registry.getClassFromOptions(\n      registry.Type.CONNECTION_PREVIEWER,\n      this.workspace.options,\n    );\n    this.connectionPreviewer = new previewerConstructor!(this.block);\n\n    // During a drag there may be a lot of rerenders, but not field changes.\n    // Turn the cache on so we don't do spurious remeasures during the drag.\n    dom.startTextWidthCache();\n    this.workspace.setResizesEnabled(false);\n    blockAnimation.disconnectUiStop();\n\n    const healStack = !!e && (e.altKey || e.ctrlKey || e.metaKey);\n\n    if (this.shouldDisconnect(healStack)) {\n      this.disconnectBlock(healStack);\n    }\n    this.block.setDragging(true);\n    this.workspace.getLayerManager()?.moveToDragLayer(this.block);\n  }\n\n  /** Starts a drag on a shadow, recording the drag offset. */\n  private startDraggingShadow(e?: PointerEvent) {\n    const parent = this.block.getParent();\n    if (!parent) {\n      throw new Error(\n        'Tried to drag a shadow block with no parent. ' +\n          'Shadow blocks should always have parents.',\n      );\n    }\n    this.dragOffset = Coordinate.difference(\n      parent.getRelativeToSurfaceXY(),\n      this.block.getRelativeToSurfaceXY(),\n    );\n    parent.startDrag(e);\n  }\n\n  /**\n   * Whether or not we should disconnect the block when a drag is started.\n   *\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   * @returns True to disconnect the block, false otherwise.\n   */\n  private shouldDisconnect(healStack: boolean): boolean {\n    return !!(\n      this.block.getParent() ||\n      (healStack &&\n        this.block.nextConnection &&\n        this.block.nextConnection.targetBlock())\n    );\n  }\n\n  /**\n   * Disconnects the block from any parents. If `healStack` is true and this is\n   * a stack block, we also disconnect from any next blocks and attempt to\n   * attach them to any parent.\n   *\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   */\n  private disconnectBlock(healStack: boolean) {\n    this.startParentConn =\n      this.block.outputConnection?.targetConnection ??\n      this.block.previousConnection?.targetConnection;\n    if (healStack) {\n      this.startChildConn = this.block.nextConnection?.targetConnection;\n    }\n\n    this.block.unplug(healStack);\n    blockAnimation.disconnectUiEffect(this.block);\n  }\n\n  /** Fire a UI event at the start of a block drag. */\n  private fireDragStartEvent() {\n    const event = new (eventUtils.get(EventType.BLOCK_DRAG))(\n      this.block,\n      true,\n      this.block.getDescendants(false),\n    );\n    eventUtils.fire(event);\n  }\n\n  /** Fire a UI event at the end of a block drag. */\n  private fireDragEndEvent() {\n    const event = new (eventUtils.get(EventType.BLOCK_DRAG))(\n      this.block,\n      false,\n      this.block.getDescendants(false),\n    );\n    eventUtils.fire(event);\n  }\n\n  /** Fire a move event at the end of a block drag. */\n  private fireMoveEvent() {\n    if (this.block.isDeadOrDying()) return;\n    const event = new (eventUtils.get(EventType.BLOCK_MOVE))(\n      this.block,\n    ) as BlockMove;\n    event.setReason(['drag']);\n    event.oldCoordinate = this.startLoc!;\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /** Moves the block and updates any connection previews. */\n  drag(newLoc: Coordinate): void {\n    if (this.block.isShadow()) {\n      this.block.getParent()?.drag(Coordinate.sum(newLoc, this.dragOffset));\n      return;\n    }\n\n    this.block.moveDuringDrag(newLoc);\n    this.updateConnectionPreview(\n      this.block,\n      Coordinate.difference(newLoc, this.startLoc!),\n    );\n  }\n\n  /**\n   * @param draggingBlock The block being dragged.\n   * @param delta How far the pointer has moved from the position\n   *     at the start of the drag, in workspace units.\n   */\n  private updateConnectionPreview(draggingBlock: BlockSvg, delta: Coordinate) {\n    const currCandidate = this.connectionCandidate;\n    const newCandidate = this.getConnectionCandidate(draggingBlock, delta);\n    if (!newCandidate) {\n      this.connectionPreviewer!.hidePreview();\n      this.connectionCandidate = null;\n      return;\n    }\n    const candidate =\n      currCandidate &&\n      this.currCandidateIsBetter(currCandidate, delta, newCandidate)\n        ? currCandidate\n        : newCandidate;\n    this.connectionCandidate = candidate;\n\n    const {local, neighbour} = candidate;\n    const localIsOutputOrPrevious =\n      local.type === ConnectionType.OUTPUT_VALUE ||\n      local.type === ConnectionType.PREVIOUS_STATEMENT;\n    const neighbourIsConnectedToRealBlock =\n      neighbour.isConnected() && !neighbour.targetBlock()!.isInsertionMarker();\n    if (\n      localIsOutputOrPrevious &&\n      neighbourIsConnectedToRealBlock &&\n      !this.orphanCanConnectAtEnd(\n        draggingBlock,\n        neighbour.targetBlock()!,\n        local.type,\n      )\n    ) {\n      this.connectionPreviewer!.previewReplacement(\n        local,\n        neighbour,\n        neighbour.targetBlock()!,\n      );\n      return;\n    }\n    this.connectionPreviewer!.previewConnection(local, neighbour);\n  }\n\n  /**\n   * Returns true if the given orphan block can connect at the end of the\n   * top block's stack or row, false otherwise.\n   */\n  private orphanCanConnectAtEnd(\n    topBlock: BlockSvg,\n    orphanBlock: BlockSvg,\n    localType: number,\n  ): boolean {\n    const orphanConnection =\n      localType === ConnectionType.OUTPUT_VALUE\n        ? orphanBlock.outputConnection\n        : orphanBlock.previousConnection;\n    return !!Connection.getConnectionForOrphanedConnection(\n      topBlock as Block,\n      orphanConnection as Connection,\n    );\n  }\n\n  /**\n   * Returns true if the current candidate is better than the new candidate.\n   *\n   * We slightly prefer the current candidate even if it is farther away.\n   */\n  private currCandidateIsBetter(\n    currCandiate: ConnectionCandidate,\n    delta: Coordinate,\n    newCandidate: ConnectionCandidate,\n  ): boolean {\n    const {local: currLocal, neighbour: currNeighbour} = currCandiate;\n    const localPos = new Coordinate(currLocal.x, currLocal.y);\n    const neighbourPos = new Coordinate(currNeighbour.x, currNeighbour.y);\n    const currDistance = Coordinate.distance(\n      Coordinate.sum(localPos, delta),\n      neighbourPos,\n    );\n    return (\n      newCandidate.distance > currDistance - config.currentConnectionPreference\n    );\n  }\n\n  /**\n   * Returns the closest valid candidate connection, if one can be found.\n   *\n   * Valid neighbour connections are within the configured start radius, with a\n   * compatible type (input, output, etc) and connection check.\n   */\n  private getConnectionCandidate(\n    draggingBlock: BlockSvg,\n    delta: Coordinate,\n  ): ConnectionCandidate | null {\n    const localConns = this.getLocalConnections(draggingBlock);\n    let radius = this.connectionCandidate\n      ? config.connectingSnapRadius\n      : config.snapRadius;\n    let candidate = null;\n\n    for (const conn of localConns) {\n      const {connection: neighbour, radius: rad} = conn.closest(radius, delta);\n      if (neighbour) {\n        candidate = {\n          local: conn,\n          neighbour: neighbour,\n          distance: rad,\n        };\n        radius = rad;\n      }\n    }\n\n    return candidate;\n  }\n\n  /**\n   * Returns all of the connections we might connect to blocks on the workspace.\n   *\n   * Includes any connections on the dragging block, and any last next\n   * connection on the stack (if one exists).\n   */\n  private getLocalConnections(draggingBlock: BlockSvg): RenderedConnection[] {\n    const available = draggingBlock.getConnections_(false);\n    const lastOnStack = draggingBlock.lastConnectionInStack(true);\n    if (lastOnStack && lastOnStack !== draggingBlock.nextConnection) {\n      available.push(lastOnStack);\n    }\n    return available;\n  }\n\n  /**\n   * Cleans up any state at the end of the drag. Applies any pending\n   * connections.\n   */\n  endDrag(e?: PointerEvent): void {\n    if (this.block.isShadow()) {\n      this.block.getParent()?.endDrag(e);\n      return;\n    }\n\n    this.fireDragEndEvent();\n    this.fireMoveEvent();\n\n    dom.stopTextWidthCache();\n\n    blockAnimation.disconnectUiStop();\n    this.connectionPreviewer!.hidePreview();\n\n    if (!this.block.isDeadOrDying() && this.dragging) {\n      // These are expensive and don't need to be done if we're deleting, or\n      // if we've already stopped dragging because we moved back to the start.\n      this.workspace\n        .getLayerManager()\n        ?.moveOffDragLayer(this.block, layers.BLOCK);\n      this.block.setDragging(false);\n    }\n\n    if (this.connectionCandidate) {\n      // Applying connections also rerenders the relevant blocks.\n      this.applyConnections(this.connectionCandidate);\n      this.disposeStep();\n    } else {\n      this.block.queueRender().then(() => this.disposeStep());\n    }\n\n    if (!this.inGroup) {\n      eventUtils.setGroup(false);\n    }\n  }\n\n  /** Disposes of any state at the end of the drag. */\n  private disposeStep() {\n    this.block.snapToGrid();\n\n    // Must dispose after connections are applied to not break the dynamic\n    // connections plugin. See #7859\n    this.connectionPreviewer!.dispose();\n    this.workspace.setResizesEnabled(true);\n  }\n\n  /** Connects the given candidate connections. */\n  private applyConnections(candidate: ConnectionCandidate) {\n    const {local, neighbour} = candidate;\n    local.connect(neighbour);\n\n    const inferiorConnection = local.isSuperior() ? neighbour : local;\n    const rootBlock = this.block.getRootBlock();\n\n    finishQueuedRenders().then(() => {\n      blockAnimation.connectionUiEffect(inferiorConnection.getSourceBlock());\n      // bringToFront is incredibly expensive. Delay until the next frame.\n      setTimeout(() => {\n        rootBlock.bringToFront();\n      }, 0);\n    });\n  }\n\n  /**\n   * Moves the block back to where it was at the beginning of the drag,\n   * including reconnecting connections.\n   */\n  revertDrag(): void {\n    if (this.block.isShadow()) {\n      this.block.getParent()?.revertDrag();\n      return;\n    }\n\n    this.startChildConn?.connect(this.block.nextConnection);\n    if (this.startParentConn) {\n      switch (this.startParentConn.type) {\n        case ConnectionType.INPUT_VALUE:\n          this.startParentConn.connect(this.block.outputConnection);\n          break;\n        case ConnectionType.NEXT_STATEMENT:\n          this.startParentConn.connect(this.block.previousConnection);\n      }\n    } else {\n      this.block.moveTo(this.startLoc!, ['drag']);\n      this.workspace\n        .getLayerManager()\n        ?.moveOffDragLayer(this.block, layers.BLOCK);\n      // Blocks dragged directly from a flyout may need to be bumped into\n      // bounds.\n      bumpObjects.bumpIntoBounds(\n        this.workspace,\n        this.workspace.getMetricsManager().getScrollMetrics(true),\n        this.block,\n      );\n    }\n\n    this.startChildConn = null;\n    this.startParentConn = null;\n\n    this.connectionPreviewer!.hidePreview();\n    this.connectionCandidate = null;\n\n    this.block.setDragging(false);\n    this.dragging = false;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a marker.\n * Used primarily for keyboard navigation to show a marked location.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Marker\n\nimport type {MarkerSvg} from '../renderers/common/marker_svg.js';\nimport type {ASTNode} from './ast_node.js';\n\n/**\n * Class for a marker.\n * This is used in keyboard navigation to save a location in the Blockly AST.\n */\nexport class Marker {\n  /** The colour of the marker. */\n  colour: string | null = null;\n\n  /** The current location of the marker. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'ASTNode'.\n  private curNode: ASTNode = null as AnyDuringMigration;\n\n  /**\n   * The object in charge of drawing the visual representation of the current\n   * node.\n   */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'MarkerSvg'.\n  private drawer: MarkerSvg = null as AnyDuringMigration;\n\n  /** The type of the marker. */\n  type = 'marker';\n\n  /** Constructs a new Marker instance. */\n  constructor() {}\n\n  /**\n   * Sets the object in charge of drawing the marker.\n   *\n   * @param drawer The object in charge of drawing the marker.\n   */\n  setDrawer(drawer: MarkerSvg) {\n    this.drawer = drawer;\n  }\n\n  /**\n   * Get the current drawer for the marker.\n   *\n   * @returns The object in charge of drawing the marker.\n   */\n  getDrawer(): MarkerSvg {\n    return this.drawer;\n  }\n\n  /**\n   * Gets the current location of the marker.\n   *\n   * @returns The current field, connection, or block the marker is on.\n   */\n  getCurNode(): ASTNode {\n    return this.curNode;\n  }\n\n  /**\n   * Set the location of the marker and call the update method.\n   * Setting isStack to true will only work if the newLocation is the top most\n   * output or previous connection on a stack.\n   *\n   * @param newNode The new location of the marker.\n   */\n  setCurNode(newNode: ASTNode) {\n    const oldNode = this.curNode;\n    this.curNode = newNode;\n    if (this.drawer) {\n      this.drawer.draw(oldNode, this.curNode);\n    }\n  }\n\n  /**\n   * Redraw the current marker.\n   *\n   * @internal\n   */\n  draw() {\n    if (this.drawer) {\n      this.drawer.draw(this.curNode, this.curNode);\n    }\n  }\n\n  /** Hide the marker SVG. */\n  hide() {\n    if (this.drawer) {\n      this.drawer.hide();\n    }\n  }\n\n  /** Dispose of this marker. */\n  dispose() {\n    if (this.getDrawer()) {\n      this.getDrawer().dispose();\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a cursor.\n * Used primarily for keyboard navigation.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Cursor\n\nimport * as registry from '../registry.js';\nimport {ASTNode} from './ast_node.js';\nimport {Marker} from './marker.js';\n\n/**\n * Class for a cursor.\n * A cursor controls how a user navigates the Blockly AST.\n */\nexport class Cursor extends Marker {\n  override type = 'cursor';\n\n  constructor() {\n    super();\n  }\n\n  /**\n   * Find the next connection, field, or block.\n   *\n   * @returns The next element, or null if the current node is not set or there\n   *     is no next value.\n   */\n  next(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n\n    let newNode = curNode.next();\n    while (\n      newNode &&\n      newNode.next() &&\n      (newNode.getType() === ASTNode.types.NEXT ||\n        newNode.getType() === ASTNode.types.BLOCK)\n    ) {\n      newNode = newNode.next();\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the in connection or field.\n   *\n   * @returns The in element, or null if the current node is not set or there is\n   *     no in value.\n   */\n  in(): ASTNode | null {\n    let curNode: ASTNode | null = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    // If we are on a previous or output connection, go to the block level\n    // before performing next operation.\n    if (\n      curNode.getType() === ASTNode.types.PREVIOUS ||\n      curNode.getType() === ASTNode.types.OUTPUT\n    ) {\n      curNode = curNode.next();\n    }\n    const newNode = curNode?.in() ?? null;\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the previous connection, field, or block.\n   *\n   * @returns The previous element, or null if the current node is not set or\n   *     there is no previous value.\n   */\n  prev(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    let newNode = curNode.prev();\n\n    while (\n      newNode &&\n      newNode.prev() &&\n      (newNode.getType() === ASTNode.types.NEXT ||\n        newNode.getType() === ASTNode.types.BLOCK)\n    ) {\n      newNode = newNode.prev();\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the out connection, field, or block.\n   *\n   * @returns The out element, or null if the current node is not set or there\n   *     is no out value.\n   */\n  out(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    let newNode = curNode.out();\n\n    if (newNode && newNode.getType() === ASTNode.types.BLOCK) {\n      newNode = newNode.prev() || newNode;\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n}\n\nregistry.register(registry.Type.CURSOR, registry.DEFAULT, Cursor);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a basic cursor.\n * Used to demo switching between different cursors.\n *\n * @class\n */\n// Former goog.module ID: Blockly.BasicCursor\n\nimport * as registry from '../registry.js';\nimport {ASTNode} from './ast_node.js';\nimport {Cursor} from './cursor.js';\n\n/**\n * Class for a basic cursor.\n * This will allow the user to get to all nodes in the AST by hitting next or\n * previous.\n */\nexport class BasicCursor extends Cursor {\n  /** Name used for registering a basic cursor. */\n  static readonly registrationName = 'basicCursor';\n\n  constructor() {\n    super();\n  }\n\n  /**\n   * Find the next node in the pre order traversal.\n   *\n   * @returns The next node, or null if the current node is not set or there is\n   *     no next value.\n   */\n  override next(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    const newNode = this.getNextNode_(curNode, this.validNode_);\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * For a basic cursor we only have the ability to go next and previous, so\n   * in will also allow the user to get to the next node in the pre order\n   * traversal.\n   *\n   * @returns The next node, or null if the current node is not set or there is\n   *     no next value.\n   */\n  override in(): ASTNode | null {\n    return this.next();\n  }\n\n  /**\n   * Find the previous node in the pre order traversal.\n   *\n   * @returns The previous node, or null if the current node is not set or there\n   *     is no previous value.\n   */\n  override prev(): ASTNode | null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    const newNode = this.getPreviousNode_(curNode, this.validNode_);\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * For a basic cursor we only have the ability to go next and previous, so\n   * out will allow the user to get to the previous node in the pre order\n   * traversal.\n   *\n   * @returns The previous node, or null if the current node is not set or there\n   *     is no previous value.\n   */\n  override out(): ASTNode | null {\n    return this.prev();\n  }\n\n  /**\n   * Uses pre order traversal to navigate the Blockly AST. This will allow\n   * a user to easily navigate the entire Blockly AST without having to go in\n   * and out levels on the tree.\n   *\n   * @param node The current position in the AST.\n   * @param isValid A function true/false depending on whether the given node\n   *     should be traversed.\n   * @returns The next node in the traversal.\n   */\n  protected getNextNode_(\n    node: ASTNode | null,\n    isValid: (p1: ASTNode | null) => boolean,\n  ): ASTNode | null {\n    if (!node) {\n      return null;\n    }\n    const newNode = node.in() || node.next();\n    if (isValid(newNode)) {\n      return newNode;\n    } else if (newNode) {\n      return this.getNextNode_(newNode, isValid);\n    }\n    const siblingOrParent = this.findSiblingOrParent(node.out());\n    if (isValid(siblingOrParent)) {\n      return siblingOrParent;\n    } else if (siblingOrParent) {\n      return this.getNextNode_(siblingOrParent, isValid);\n    }\n    return null;\n  }\n\n  /**\n   * Reverses the pre order traversal in order to find the previous node. This\n   * will allow a user to easily navigate the entire Blockly AST without having\n   * to go in and out levels on the tree.\n   *\n   * @param node The current position in the AST.\n   * @param isValid A function true/false depending on whether the given node\n   *     should be traversed.\n   * @returns The previous node in the traversal or null if no previous node\n   *     exists.\n   */\n  protected getPreviousNode_(\n    node: ASTNode | null,\n    isValid: (p1: ASTNode | null) => boolean,\n  ): ASTNode | null {\n    if (!node) {\n      return null;\n    }\n    let newNode: ASTNode | null = node.prev();\n\n    if (newNode) {\n      newNode = this.getRightMostChild(newNode);\n    } else {\n      newNode = node.out();\n    }\n    if (isValid(newNode)) {\n      return newNode;\n    } else if (newNode) {\n      return this.getPreviousNode_(newNode, isValid);\n    }\n    return null;\n  }\n\n  /**\n   * Decides what nodes to traverse and which ones to skip. Currently, it\n   * skips output, stack and workspace nodes.\n   *\n   * @param node The AST node to check whether it is valid.\n   * @returns True if the node should be visited, false otherwise.\n   */\n  protected validNode_(node: ASTNode | null): boolean {\n    let isValid = false;\n    const type = node && node.getType();\n    if (\n      type === ASTNode.types.OUTPUT ||\n      type === ASTNode.types.INPUT ||\n      type === ASTNode.types.FIELD ||\n      type === ASTNode.types.NEXT ||\n      type === ASTNode.types.PREVIOUS ||\n      type === ASTNode.types.WORKSPACE\n    ) {\n      isValid = true;\n    }\n    return isValid;\n  }\n\n  /**\n   * From the given node find either the next valid sibling or parent.\n   *\n   * @param node The current position in the AST.\n   * @returns The parent AST node or null if there are no valid parents.\n   */\n  private findSiblingOrParent(node: ASTNode | null): ASTNode | null {\n    if (!node) {\n      return null;\n    }\n    const nextNode = node.next();\n    if (nextNode) {\n      return nextNode;\n    }\n    return this.findSiblingOrParent(node.out());\n  }\n\n  /**\n   * Get the right most child of a node.\n   *\n   * @param node The node to find the right most child of.\n   * @returns The right most child of the given node, or the node if no child\n   *     exists.\n   */\n  private getRightMostChild(node: ASTNode | null): ASTNode | null {\n    if (!node!.in()) {\n      return node;\n    }\n    let newNode = node!.in();\n    while (newNode && newNode.next()) {\n      newNode = newNode.next();\n    }\n    return this.getRightMostChild(newNode);\n  }\n}\n\nregistry.register(\n  registry.Type.CURSOR,\n  BasicCursor.registrationName,\n  BasicCursor,\n);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a cursor that is used to navigate\n * between tab navigable fields.\n *\n * @class\n */\n// Former goog.module ID: Blockly.TabNavigateCursor\n\nimport type {Field} from '../field.js';\nimport {ASTNode} from './ast_node.js';\nimport {BasicCursor} from './basic_cursor.js';\n\n/**\n * A cursor for navigating between tab navigable fields.\n */\nexport class TabNavigateCursor extends BasicCursor {\n  /**\n   * Skip all nodes except for tab navigable fields.\n   *\n   * @param node The AST node to check whether it is valid.\n   * @returns True if the node should be visited, false otherwise.\n   */\n  override validNode_(node: ASTNode | null): boolean {\n    let isValid = false;\n    const type = node && node.getType();\n    if (node) {\n      const location = node.getLocation() as Field;\n      if (\n        type === ASTNode.types.FIELD &&\n        location &&\n        location.isTabNavigable() &&\n        location.isClickable()\n      ) {\n        isValid = true;\n      }\n    }\n    return isValid;\n  }\n}\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for creating connections between blocks.\n *\n * @class\n */\n// Former goog.module ID: Blockly.RenderedConnection\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport {Connection} from './connection.js';\nimport type {ConnectionDB} from './connection_db.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as eventUtils from './events/utils.js';\nimport {hasBubble} from './interfaces/i_has_bubble.js';\nimport * as internalConstants from './internal_constants.js';\nimport {Coordinate} from './utils/coordinate.js';\n\n/** Maximum randomness in workspace units for bumping a block. */\nconst BUMP_RANDOMNESS = 10;\n\n/**\n * Class for a connection between blocks that may be rendered on screen.\n */\nexport class RenderedConnection extends Connection {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  sourceBlock_!: BlockSvg;\n  private readonly db: ConnectionDB;\n  private readonly dbOpposite: ConnectionDB;\n  private readonly offsetInBlock: Coordinate;\n  private trackedState: TrackedState;\n  private highlighted: boolean = false;\n\n  /** Connection this connection connects to.  Null if not connected. */\n  override targetConnection: RenderedConnection | null = null;\n\n  /**\n   * @param source The block establishing this connection.\n   * @param type The type of the connection.\n   */\n  constructor(source: BlockSvg, type: number) {\n    super(source, type);\n\n    /**\n     * Connection database for connections of this type on the current\n     * workspace.\n     */\n    this.db = source.workspace.connectionDBList[type];\n\n    /**\n     * Connection database for connections compatible with this type on the\n     * current workspace.\n     */\n    this.dbOpposite =\n      source.workspace.connectionDBList[internalConstants.OPPOSITE_TYPE[type]];\n\n    /** Workspace units, (0, 0) is top left of block. */\n    this.offsetInBlock = new Coordinate(0, 0);\n\n    /** Describes the state of this connection's tracked-ness. */\n    this.trackedState = RenderedConnection.TrackedState.WILL_TRACK;\n  }\n\n  /**\n   * Dispose of this connection. Remove it from the database (if it is\n   * tracked) and call the super-function to deal with connected blocks.\n   *\n   * @internal\n   */\n  override dispose() {\n    super.dispose();\n    if (this.trackedState === RenderedConnection.TrackedState.TRACKED) {\n      this.db.removeConnection(this, this.y);\n    }\n    this.sourceBlock_.pathObject.removeConnectionHighlight?.(this);\n  }\n\n  /**\n   * Get the source block for this connection.\n   *\n   * @returns The source block.\n   */\n  override getSourceBlock(): BlockSvg {\n    return super.getSourceBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the block that this connection connects to.\n   *\n   * @returns The connected block or null if none is connected.\n   */\n  override targetBlock(): BlockSvg | null {\n    return super.targetBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the distance between this connection and another connection in\n   * workspace units.\n   *\n   * @param otherConnection The other connection to measure the distance to.\n   * @returns The distance between connections, in workspace units.\n   */\n  distanceFrom(otherConnection: Connection): number {\n    const xDiff = this.x - otherConnection.x;\n    const yDiff = this.y - otherConnection.y;\n    return Math.sqrt(xDiff * xDiff + yDiff * yDiff);\n  }\n\n  /**\n   * Move the block(s) belonging to the connection to a point where they don't\n   * visually interfere with the specified connection.\n   *\n   * @param superiorConnection The connection to move away from. The provided\n   *     connection should be the superior connection and should not be\n   *     connected to this connection.\n   * @param initiatedByThis Whether or not the block group that was manipulated\n   *     recently causing bump checks is associated with the inferior\n   *     connection. Defaults to false.\n   * @internal\n   */\n  bumpAwayFrom(\n    superiorConnection: RenderedConnection,\n    initiatedByThis = false,\n  ) {\n    if (this.sourceBlock_.workspace.isDragging()) {\n      // Don't move blocks around while the user is doing the same.\n      return;\n    }\n    let offsetX =\n      config.snapRadius + Math.floor(Math.random() * BUMP_RANDOMNESS);\n    let offsetY =\n      config.snapRadius + Math.floor(Math.random() * BUMP_RANDOMNESS);\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    const inferiorConnection = this;\n    const superiorRootBlock = superiorConnection.sourceBlock_.getRootBlock();\n    const inferiorRootBlock = inferiorConnection.sourceBlock_.getRootBlock();\n\n    if (superiorRootBlock.isInFlyout || inferiorRootBlock.isInFlyout) {\n      // Don't move blocks around in a flyout.\n      return;\n    }\n    let moveInferior = true;\n    if (!inferiorRootBlock.isMovable()) {\n      // Can't bump an immovable block away.\n      // Check to see if the other block is movable.\n      if (!superiorRootBlock.isMovable()) {\n        // Neither block is movable, abort operation.\n        return;\n      } else {\n        // Only the superior block group is movable.\n        moveInferior = false;\n        // The superior block group moves in the opposite direction.\n        offsetX = -offsetX;\n        offsetY = -offsetY;\n      }\n    } else if (superiorRootBlock.isMovable()) {\n      // Both block groups are movable. The one on the inferior side will be\n      // moved to make space for the superior one. However, it's possible that\n      // both groups of blocks have an inferior connection that bumps into a\n      // superior connection on the other group, which could result in both\n      // groups moving in the same direction and eventually bumping each other\n      // again. It would be better if one group of blocks could consistently\n      // move in an orthogonal direction from the other, so that they become\n      // separated in the end. We can designate one group the \"initiator\" if\n      // it's the one that was most recently manipulated, causing inputs to be\n      // checked for bumpable neighbors. As a useful heuristic, in the case\n      // where the inferior connection belongs to the initiator group, moving it\n      // in the orthogonal direction will separate the blocks better.\n      if (initiatedByThis) {\n        offsetY = -offsetY;\n      }\n    }\n    const staticConnection = moveInferior\n      ? superiorConnection\n      : inferiorConnection;\n    const dynamicConnection = moveInferior\n      ? inferiorConnection\n      : superiorConnection;\n    const dynamicRootBlock = moveInferior\n      ? inferiorRootBlock\n      : superiorRootBlock;\n    // Raise it to the top for extra visibility.\n    const selected = common.getSelected() === dynamicRootBlock;\n    if (!selected) dynamicRootBlock.addSelect();\n    if (dynamicRootBlock.RTL) {\n      offsetX = -offsetX;\n    }\n    const dx = staticConnection.x + offsetX - dynamicConnection.x;\n    const dy = staticConnection.y + offsetY - dynamicConnection.y;\n    dynamicRootBlock.moveBy(dx, dy, ['bump']);\n    if (!selected) dynamicRootBlock.removeSelect();\n  }\n\n  /**\n   * Change the connection's coordinates.\n   *\n   * @param x New absolute x coordinate, in workspace coordinates.\n   * @param y New absolute y coordinate, in workspace coordinates.\n   * @returns True if the position of the connection in the connection db\n   *     was updated.\n   */\n  moveTo(x: number, y: number): boolean {\n    // TODO(#6922): Readd this optimization.\n    // const moved = this.x !== x || this.y !== y;\n    const moved = true;\n    let updated = false;\n\n    if (this.trackedState === RenderedConnection.TrackedState.WILL_TRACK) {\n      this.db.addConnection(this, y);\n      this.trackedState = RenderedConnection.TrackedState.TRACKED;\n      updated = true;\n    } else if (\n      this.trackedState === RenderedConnection.TrackedState.TRACKED &&\n      moved\n    ) {\n      this.db.removeConnection(this, this.y);\n      this.db.addConnection(this, y);\n      updated = true;\n    }\n\n    this.x = x;\n    this.y = y;\n\n    return updated;\n  }\n\n  /**\n   * Change the connection's coordinates.\n   *\n   * @param dx Change to x coordinate, in workspace units.\n   * @param dy Change to y coordinate, in workspace units.\n   * @returns True if the position of the connection in the connection db\n   *     was updated.\n   */\n  moveBy(dx: number, dy: number): boolean {\n    return this.moveTo(this.x + dx, this.y + dy);\n  }\n\n  /**\n   * Move this connection to the location given by its offset within the block\n   * and the location of the block's top left corner.\n   *\n   * @param blockTL The location of the top left corner of the block, in\n   *     workspace coordinates.\n   * @returns True if the position of the connection in the connection db\n   *     was updated.\n   */\n  moveToOffset(blockTL: Coordinate): boolean {\n    return this.moveTo(\n      blockTL.x + this.offsetInBlock.x,\n      blockTL.y + this.offsetInBlock.y,\n    );\n  }\n\n  /**\n   * Set the offset of this connection relative to the top left of its block.\n   *\n   * @param x The new relative x, in workspace units.\n   * @param y The new relative y, in workspace units.\n   */\n  setOffsetInBlock(x: number, y: number) {\n    this.offsetInBlock.x = x;\n    this.offsetInBlock.y = y;\n  }\n\n  /**\n   * Get the offset of this connection relative to the top left of its block.\n   *\n   * @returns The offset of the connection.\n   */\n  getOffsetInBlock(): Coordinate {\n    return this.offsetInBlock;\n  }\n\n  /**\n   * Moves the blocks on either side of this connection right next to\n   * each other, based on their local offsets, not global positions.\n   *\n   * @internal\n   */\n  tightenEfficiently() {\n    const target = this.targetConnection;\n    const block = this.targetBlock();\n    if (!target || !block) return;\n    const offset = Coordinate.difference(\n      this.offsetInBlock,\n      target.offsetInBlock,\n    );\n    block.translate(offset.x, offset.y);\n  }\n\n  /**\n   * Find the closest compatible connection to this connection.\n   * All parameters are in workspace units.\n   *\n   * @param maxLimit The maximum radius to another connection.\n   * @param dxy Offset between this connection's location in the database and\n   *     the current location (as a result of dragging).\n   * @returns Contains two properties: 'connection' which is either another\n   *     connection or null, and 'radius' which is the distance.\n   */\n  closest(\n    maxLimit: number,\n    dxy: Coordinate,\n  ): {connection: RenderedConnection | null; radius: number} {\n    return this.dbOpposite.searchForClosest(this, maxLimit, dxy);\n  }\n\n  /** Add highlighting around this connection. */\n  highlight() {\n    this.highlighted = true;\n    this.getSourceBlock().queueRender();\n  }\n\n  /** Remove the highlighting around this connection. */\n  unhighlight() {\n    this.highlighted = false;\n    this.getSourceBlock().queueRender();\n  }\n\n  /** Returns true if this connection is highlighted, false otherwise. */\n  isHighlighted(): boolean {\n    return this.highlighted;\n  }\n\n  /**\n   * Set whether this connections is tracked in the database or not.\n   *\n   * @param doTracking If true, start tracking. If false, stop tracking.\n   * @internal\n   */\n  setTracking(doTracking: boolean) {\n    if (\n      (doTracking &&\n        this.trackedState === RenderedConnection.TrackedState.TRACKED) ||\n      (!doTracking &&\n        this.trackedState === RenderedConnection.TrackedState.UNTRACKED)\n    ) {\n      return;\n    }\n    if (this.sourceBlock_.isInFlyout) {\n      // Don't bother maintaining a database of connections in a flyout.\n      return;\n    }\n    if (doTracking) {\n      this.db.addConnection(this, this.y);\n      this.trackedState = RenderedConnection.TrackedState.TRACKED;\n      return;\n    }\n    if (this.trackedState === RenderedConnection.TrackedState.TRACKED) {\n      this.db.removeConnection(this, this.y);\n    }\n    this.trackedState = RenderedConnection.TrackedState.UNTRACKED;\n  }\n\n  /**\n   * Stop tracking this connection, as well as all down-stream connections on\n   * any block attached to this connection. This happens when a block is\n   * collapsed.\n   *\n   * Also closes down-stream icons/bubbles.\n   *\n   * @internal\n   */\n  stopTrackingAll() {\n    this.setTracking(false);\n    if (this.targetConnection) {\n      const blocks = this.targetBlock()!.getDescendants(false);\n      for (let i = 0; i < blocks.length; i++) {\n        const block = blocks[i];\n        // Stop tracking connections of all children.\n        const connections = block.getConnections_(true);\n        for (let j = 0; j < connections.length; j++) {\n          connections[j].setTracking(false);\n        }\n        // Close all bubbles of all children.\n        for (const icon of block.getIcons()) {\n          if (hasBubble(icon)) icon.setBubbleVisible(false);\n        }\n      }\n    }\n  }\n\n  /**\n   * Start tracking this connection, as well as all down-stream connections on\n   * any block attached to this connection. This happens when a block is\n   * expanded.\n   *\n   * @returns List of blocks to render.\n   */\n  startTrackingAll(): Block[] {\n    this.setTracking(true);\n    // All blocks that are not tracked must start tracking before any\n    // rendering takes place, since rendering requires knowing the dimensions\n    // of lower blocks. Also, since rendering a block renders all its parents,\n    // we only need to render the leaf nodes.\n    let renderList: Block[] = [];\n    if (\n      this.type !== ConnectionType.INPUT_VALUE &&\n      this.type !== ConnectionType.NEXT_STATEMENT\n    ) {\n      // Only spider down.\n      return renderList;\n    }\n    const block = this.targetBlock();\n    if (block) {\n      let connections;\n      if (block.isCollapsed()) {\n        // This block should only be partially revealed since it is collapsed.\n        connections = [];\n        if (block.outputConnection) connections.push(block.outputConnection);\n        if (block.nextConnection) connections.push(block.nextConnection);\n        if (block.previousConnection)\n          connections.push(block.previousConnection);\n      } else {\n        // Show all connections of this block.\n        connections = block.getConnections_(true);\n      }\n      for (let i = 0; i < connections.length; i++) {\n        renderList.push(...connections[i].startTrackingAll());\n      }\n      if (!renderList.length) {\n        // Leaf block.\n        renderList = [block];\n      }\n    }\n    return renderList;\n  }\n\n  /**\n   * Behaviour after a connection attempt fails.\n   * Bumps this connection away from the other connection. Called when an\n   * attempted connection fails.\n   *\n   * @param superiorConnection Connection that this connection failed to connect\n   *     to. The provided connection should be the superior connection.\n   * @internal\n   */\n  override onFailedConnect(superiorConnection: Connection) {\n    const block = this.getSourceBlock();\n    if (eventUtils.getRecordUndo()) {\n      const group = eventUtils.getGroup();\n      setTimeout(\n        function (this: RenderedConnection) {\n          if (!block.isDisposed() && !block.getParent()) {\n            eventUtils.setGroup(group);\n            this.bumpAwayFrom(superiorConnection as RenderedConnection);\n            eventUtils.setGroup(false);\n          }\n        }.bind(this),\n        config.bumpDelay,\n      );\n    }\n  }\n\n  /**\n   * Disconnect two blocks that are connected by this connection.\n   *\n   * @param setParent Whether to set the parent of the disconnected block or\n   *     not, defaults to true.\n   *     If you do not set the parent, ensure that a subsequent action does,\n   *     otherwise the view and model will be out of sync.\n   */\n  override disconnectInternal(setParent = true) {\n    const {parentConnection, childConnection} =\n      this.getParentAndChildConnections();\n    if (!parentConnection || !childConnection) return;\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) eventUtils.setGroup(true);\n\n    const parent = parentConnection.getSourceBlock() as BlockSvg;\n    const child = childConnection.getSourceBlock() as BlockSvg;\n    super.disconnectInternal(setParent);\n\n    parent.queueRender();\n    child.updateDisabled();\n    child.queueRender();\n    // Reset visibility, since the child is now a top block.\n    child.getSvgRoot().style.display = 'block';\n\n    eventUtils.setGroup(existingGroup);\n  }\n\n  /**\n   * Respawn the shadow block if there was one connected to the this connection.\n   * Render/rerender blocks as needed.\n   */\n  protected override respawnShadow_() {\n    super.respawnShadow_();\n    const blockShadow = this.targetBlock();\n    if (!blockShadow) {\n      return;\n    }\n    blockShadow.initSvg();\n    blockShadow.queueRender();\n  }\n\n  /**\n   * Find all nearby compatible connections to this connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * @param maxLimit The maximum radius to another connection, in workspace\n   *     units.\n   * @returns List of connections.\n   * @internal\n   */\n  override neighbours(maxLimit: number): RenderedConnection[] {\n    return this.dbOpposite.getNeighbours(this, maxLimit);\n  }\n\n  /**\n   * Connect two connections together.  This is the connection on the superior\n   * block.  Rerender blocks as needed.\n   *\n   * @param childConnection Connection on inferior block.\n   */\n  protected override connect_(childConnection: Connection) {\n    super.connect_(childConnection);\n\n    const renderedChildConnection = childConnection as RenderedConnection;\n\n    const parentBlock = this.getSourceBlock();\n    const childBlock = renderedChildConnection.getSourceBlock();\n\n    parentBlock.updateDisabled();\n    childBlock.updateDisabled();\n    childBlock.queueRender();\n\n    // If either block being connected was selected, visually un- and reselect\n    // it. This has the effect of moving the selection path to the end of the\n    // list of child nodes in the DOM. Since SVG z-order is determined by node\n    // order in the DOM, this works around an issue where the selection outline\n    // path could be partially obscured by a new block inserted after it in the\n    // DOM.\n    const selection = common.getSelected();\n    const selectedBlock =\n      (selection === parentBlock && parentBlock) ||\n      (selection === childBlock && childBlock);\n    if (selectedBlock) {\n      selectedBlock.removeSelect();\n      selectedBlock.addSelect();\n    }\n\n    // The input the child block is connected to (if any).\n    const parentInput = parentBlock.getInputWithBlock(childBlock);\n    if (parentInput) {\n      const visible = parentInput.isVisible();\n      childBlock.getSvgRoot().style.display = visible ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Function to be called when this connection's compatible types have changed.\n   */\n  protected override onCheckChanged_() {\n    // The new value type may not be compatible with the existing connection.\n    if (\n      this.isConnected() &&\n      (!this.targetConnection ||\n        !this.getConnectionChecker().canConnect(\n          this,\n          this.targetConnection,\n          false,\n        ))\n    ) {\n      const child = this.isSuperior() ? this.targetBlock() : this.sourceBlock_;\n      child!.unplug();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   * Rerender blocks as needed.\n   *\n   * @param check Compatible value type or list of value types. Null if all\n   *     types are compatible.\n   * @returns The connection being modified (to allow chaining).\n   */\n  override setCheck(check: string | string[] | null): RenderedConnection {\n    super.setCheck(check);\n    this.sourceBlock_.queueRender();\n    return this;\n  }\n}\n\nexport namespace RenderedConnection {\n  /**\n   * Enum for different kinds of tracked states.\n   *\n   * WILL_TRACK means that this connection will add itself to\n   * the db on the next moveTo call it receives.\n   *\n   * UNTRACKED means that this connection will not add\n   * itself to the database until setTracking(true) is explicitly called.\n   *\n   * TRACKED means that this connection is currently being tracked.\n   */\n  export enum TrackedState {\n    WILL_TRACK = -1,\n    UNTRACKED = 0,\n    TRACKED = 1,\n  }\n}\n\nexport type TrackedState = RenderedConnection.TrackedState;\nexport const TrackedState = RenderedConnection.TrackedState;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for graphically rendering a block as SVG.\n *\n * @class\n */\n// Former goog.module ID: Blockly.BlockSvg\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_selected.js';\n\nimport {Block} from './block.js';\nimport * as blockAnimations from './block_animations.js';\nimport {IDeletable} from './blockly.js';\nimport * as browserEvents from './browser_events.js';\nimport {BlockCopyData, BlockPaster} from './clipboard/block_paster.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport type {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as constants from './constants.js';\nimport * as ContextMenu from './contextmenu.js';\nimport {\n  ContextMenuOption,\n  ContextMenuRegistry,\n  LegacyContextMenuOption,\n} from './contextmenu_registry.js';\nimport {BlockDragStrategy} from './dragging/block_drag_strategy.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport {FieldLabel} from './field_label.js';\nimport {IconType} from './icons/icon_types.js';\nimport {MutatorIcon} from './icons/mutator_icon.js';\nimport {WarningIcon} from './icons/warning_icon.js';\nimport type {Input} from './inputs/input.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {ICopyable} from './interfaces/i_copyable.js';\nimport type {IDragStrategy, IDraggable} from './interfaces/i_draggable.js';\nimport {IIcon} from './interfaces/i_icon.js';\nimport * as internalConstants from './internal_constants.js';\nimport {ASTNode} from './keyboard_nav/ast_node.js';\nimport {TabNavigateCursor} from './keyboard_nav/tab_navigate_cursor.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Msg} from './msg.js';\nimport * as renderManagement from './render_management.js';\nimport {RenderedConnection} from './rendered_connection.js';\nimport type {IPathObject} from './renderers/common/i_path_object.js';\nimport * as blocks from './serialization/blocks.js';\nimport type {BlockStyle} from './theme.js';\nimport * as Tooltip from './tooltip.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport {FlyoutItemInfo} from './utils/toolbox.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a block's SVG representation.\n * Not normally called directly, workspace.newBlock() is preferred.\n */\nexport class BlockSvg\n  extends Block\n  implements\n    IASTNodeLocationSvg,\n    IBoundedElement,\n    ICopyable<BlockCopyData>,\n    IDraggable,\n    IDeletable\n{\n  /**\n   * Constant for identifying rows that are to be rendered inline.\n   * Don't collide with Blockly.inputTypes.\n   */\n  static readonly INLINE = -1;\n\n  /**\n   * ID to give the \"collapsed warnings\" warning. Allows us to remove the\n   * \"collapsed warnings\" warning without removing any warnings that belong to\n   * the block.\n   */\n  static readonly COLLAPSED_WARNING_ID = 'TEMP_COLLAPSED_WARNING_';\n  override decompose?: (p1: Workspace) => BlockSvg;\n  // override compose?: ((p1: BlockSvg) => void)|null;\n\n  /**\n   * An optional method which saves a record of blocks connected to\n   * this block so they can be later restored after this block is\n   * recoomposed (reconfigured).  Typically records the connected\n   * blocks on properties on blocks in the mutator flyout, so that\n   * rearranging those component blocks will automatically rearrange\n   * the corresponding connected blocks on this block after this block\n   * is recomposed.\n   *\n   * To keep the saved connection information up-to-date, MutatorIcon\n   * arranges for an event listener to call this method any time the\n   * mutator flyout is open and a change occurs on this block's\n   * workspace.\n   *\n   * @param rootBlock The root block in the mutator flyout.\n   */\n  saveConnections?: (rootBlock: BlockSvg) => void;\n\n  customContextMenu?: (\n    p1: Array<ContextMenuOption | LegacyContextMenuOption>,\n  ) => void;\n\n  /**\n   * Height of this block, not including any statement blocks above or below.\n   * Height is in workspace units.\n   */\n  height = 0;\n\n  /**\n   * Width of this block, including any connected value blocks.\n   * Width is in workspace units.\n   */\n  width = 0;\n\n  /**\n   * Width of this block, not including any connected value blocks.\n   * Width is in workspace units.\n   *\n   * @internal\n   */\n  childlessWidth = 0;\n\n  /**\n   * Map from IDs for warnings text to PIDs of functions to apply them.\n   * Used to be able to maintain multiple warnings.\n   */\n  private warningTextDb = new Map<string, ReturnType<typeof setTimeout>>();\n\n  /** Block's mutator icon (if any). */\n  mutator: MutatorIcon | null = null;\n\n  private svgGroup: SVGGElement;\n  style: BlockStyle;\n  /** @internal */\n  pathObject: IPathObject;\n\n  /** Is this block a BlockSVG? */\n  override readonly rendered = true;\n\n  private visuallyDisabled = false;\n\n  override workspace: WorkspaceSvg;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override outputConnection!: RenderedConnection;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override nextConnection!: RenderedConnection;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override previousConnection!: RenderedConnection;\n\n  private translation = '';\n\n  /** Whether this block is currently being dragged. */\n  private dragging = false;\n\n  /**\n   * The location of the top left of this block (in workspace coordinates)\n   * relative to either its parent block, or the workspace origin if it has no\n   * parent.\n   *\n   * @internal\n   */\n  relativeCoords = new Coordinate(0, 0);\n\n  private dragStrategy: IDragStrategy = new BlockDragStrategy(this);\n\n  /**\n   * @param workspace The block's workspace.\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   */\n  constructor(workspace: WorkspaceSvg, prototypeName: string, opt_id?: string) {\n    super(workspace, prototypeName, opt_id);\n    if (!workspace.rendered) {\n      throw TypeError('Cannot create a rendered block in a headless workspace');\n    }\n    this.workspace = workspace;\n    this.svgGroup = dom.createSvgElement(Svg.G, {});\n\n    /** A block style object. */\n    this.style = workspace.getRenderer().getConstants().getBlockStyle(null);\n\n    /** The renderer's path object. */\n    this.pathObject = workspace\n      .getRenderer()\n      .makePathObject(this.svgGroup, this.style);\n\n    const svgPath = this.pathObject.svgPath;\n    (svgPath as any).tooltip = this;\n    Tooltip.bindMouseEvents(svgPath);\n\n    // Expose this block's ID on its top-level SVG group.\n    this.svgGroup.setAttribute('data-id', this.id);\n\n    this.doInit_();\n  }\n\n  /**\n   * Create and initialize the SVG representation of the block.\n   * May be called more than once.\n   */\n  initSvg() {\n    if (this.initialized) return;\n    for (const input of this.inputList) {\n      input.init();\n    }\n    for (const icon of this.getIcons()) {\n      icon.initView(this.createIconPointerDownListener(icon));\n      icon.updateEditable();\n    }\n    this.applyColour();\n    this.pathObject.updateMovable(this.isMovable() || this.isInFlyout);\n    const svg = this.getSvgRoot();\n    if (!this.workspace.options.readOnly && svg) {\n      browserEvents.conditionalBind(svg, 'pointerdown', this, this.onMouseDown);\n    }\n\n    if (!svg.parentNode) {\n      this.workspace.getCanvas().appendChild(svg);\n    }\n    this.initialized = true;\n  }\n\n  /**\n   * Get the secondary colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColourSecondary(): string {\n    return this.style.colourSecondary;\n  }\n\n  /**\n   * Get the tertiary colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColourTertiary(): string {\n    return this.style.colourTertiary;\n  }\n\n  /** Selects this block. Highlights the block visually. */\n  select() {\n    if (this.isShadow()) {\n      this.getParent()?.select();\n      return;\n    }\n    this.addSelect();\n  }\n\n  /** Unselects this block. Unhighlights the block visually. */\n  unselect() {\n    if (this.isShadow()) {\n      this.getParent()?.unselect();\n      return;\n    }\n    this.removeSelect();\n  }\n\n  /**\n   * Sets the parent of this block to be a new block or null.\n   *\n   * @param newParent New parent block.\n   * @internal\n   */\n  override setParent(newParent: this | null) {\n    const oldParent = this.parentBlock_;\n    if (newParent === oldParent) {\n      return;\n    }\n\n    dom.startTextWidthCache();\n    super.setParent(newParent);\n    dom.stopTextWidthCache();\n\n    const svgRoot = this.getSvgRoot();\n\n    // Bail early if workspace is clearing, or we aren't rendered.\n    // We won't need to reattach ourselves anywhere.\n    if (this.workspace.isClearing || !svgRoot) {\n      return;\n    }\n\n    const oldXY = this.getRelativeToSurfaceXY();\n    if (newParent) {\n      (newParent as BlockSvg).getSvgRoot().appendChild(svgRoot);\n    } else if (oldParent) {\n      // If we are losing a parent, we want to move our DOM element to the\n      // root of the workspace.\n      const draggingBlock = this.workspace\n        .getCanvas()\n        .querySelector('.blocklyDragging');\n      if (draggingBlock) {\n        this.workspace.getCanvas().insertBefore(svgRoot, draggingBlock);\n      } else {\n        this.workspace.getCanvas().appendChild(svgRoot);\n      }\n      this.translate(oldXY.x, oldXY.y);\n    }\n\n    this.applyColour();\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this block relative to the\n   * drawing surface's origin (0,0), in workspace units.\n   * If the block is on the workspace, (0, 0) is the origin of the workspace\n   * coordinate system.\n   * This does not change with workspace scale.\n   *\n   * @returns Object with .x and .y properties in workspace coordinates.\n   */\n  override getRelativeToSurfaceXY(): Coordinate {\n    const layerManger = this.workspace.getLayerManager();\n    if (!layerManger) {\n      throw new Error(\n        'Cannot calculate position because the workspace has not been appended',\n      );\n    }\n    let x = 0;\n    let y = 0;\n\n    let element: SVGElement = this.getSvgRoot();\n    if (element) {\n      do {\n        // Loop through this block and every parent.\n        const xy = svgMath.getRelativeXY(element);\n        x += xy.x;\n        y += xy.y;\n        element = element.parentNode as SVGElement;\n      } while (element && !layerManger.hasLayer(element));\n    }\n    return new Coordinate(x, y);\n  }\n\n  /**\n   * Move a block by a relative offset.\n   *\n   * @param dx Horizontal offset in workspace units.\n   * @param dy Vertical offset in workspace units.\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  override moveBy(dx: number, dy: number, reason?: string[]) {\n    if (this.parentBlock_) {\n      throw Error('Block has parent');\n    }\n    const eventsEnabled = eventUtils.isEnabled();\n    let event: BlockMove | null = null;\n    if (eventsEnabled) {\n      event = new (eventUtils.get(EventType.BLOCK_MOVE)!)(this) as BlockMove;\n      if (reason) event.setReason(reason);\n    }\n\n    const delta = new Coordinate(dx, dy);\n    const currLoc = this.getRelativeToSurfaceXY();\n    const newLoc = Coordinate.sum(currLoc, delta);\n    this.translate(newLoc.x, newLoc.y);\n    this.updateComponentLocations(newLoc);\n\n    if (eventsEnabled && event) {\n      event!.recordNew();\n      eventUtils.fire(event);\n    }\n    this.workspace.resizeContents();\n  }\n\n  /**\n   * Transforms a block by setting the translation on the transform attribute\n   * of the block's SVG.\n   *\n   * @param x The x coordinate of the translation in workspace units.\n   * @param y The y coordinate of the translation in workspace units.\n   */\n  translate(x: number, y: number) {\n    this.translation = `translate(${x}, ${y})`;\n    this.relativeCoords = new Coordinate(x, y);\n    this.getSvgRoot().setAttribute('transform', this.getTranslation());\n  }\n\n  /**\n   * Returns the SVG translation of this block.\n   *\n   * @internal\n   */\n  getTranslation(): string {\n    return this.translation;\n  }\n\n  /**\n   * Move a block to a position.\n   *\n   * @param xy The position to move to in workspace units.\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  moveTo(xy: Coordinate, reason?: string[]) {\n    const curXY = this.getRelativeToSurfaceXY();\n    this.moveBy(xy.x - curXY.x, xy.y - curXY.y, reason);\n  }\n\n  /**\n   * Move this block during a drag.\n   * This block must be a top-level block.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(newLoc: Coordinate) {\n    this.translate(newLoc.x, newLoc.y);\n    this.getSvgRoot().setAttribute('transform', this.getTranslation());\n    this.updateComponentLocations(newLoc);\n  }\n\n  /** Snap this block to the nearest grid point. */\n  snapToGrid() {\n    if (this.isDeadOrDying()) return;\n    if (this.getParent()) return;\n    if (this.isInFlyout) return;\n    const grid = this.workspace.getGrid();\n    if (!grid?.shouldSnap()) return;\n    const currentXY = this.getRelativeToSurfaceXY();\n    const alignedXY = grid.alignXY(currentXY);\n    if (alignedXY !== currentXY) {\n      this.moveTo(alignedXY, ['snap']);\n    }\n  }\n\n  /**\n   * Returns the coordinates of a bounding box describing the dimensions of this\n   * block and any blocks stacked below it.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Object with coordinates of the bounding box.\n   */\n  getBoundingRectangle(): Rect {\n    return this.getBoundingRectangleWithDimensions(this.getHeightWidth());\n  }\n\n  /**\n   * Returns the coordinates of a bounding box describing the dimensions of this\n   * block alone.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Object with coordinates of the bounding box.\n   */\n  getBoundingRectangleWithoutChildren(): Rect {\n    return this.getBoundingRectangleWithDimensions({\n      height: this.height,\n      width: this.childlessWidth,\n    });\n  }\n\n  private getBoundingRectangleWithDimensions(blockBounds: {\n    height: number;\n    width: number;\n  }) {\n    const blockXY = this.getRelativeToSurfaceXY();\n    let left;\n    let right;\n    if (this.RTL) {\n      left = blockXY.x - blockBounds.width;\n      right = blockXY.x;\n    } else {\n      left = blockXY.x;\n      right = blockXY.x + blockBounds.width;\n    }\n    return new Rect(blockXY.y, blockXY.y + blockBounds.height, left, right);\n  }\n\n  /**\n   * Notify every input on this block to mark its fields as dirty.\n   * A dirty field is a field that needs to be re-rendered.\n   */\n  markDirty() {\n    this.pathObject.constants = this.workspace.getRenderer().getConstants();\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      input.markDirty();\n    }\n  }\n\n  /**\n   * Set whether the block is collapsed or not.\n   *\n   * @param collapsed True if collapsed.\n   */\n  override setCollapsed(collapsed: boolean) {\n    if (this.collapsed_ === collapsed) {\n      return;\n    }\n    super.setCollapsed(collapsed);\n    this.updateCollapsed();\n  }\n\n  /**\n   * Makes sure that when the block is collapsed, it is rendered correctly\n   * for that state.\n   */\n  private updateCollapsed() {\n    const collapsed = this.isCollapsed();\n    const collapsedInputName = constants.COLLAPSED_INPUT_NAME;\n    const collapsedFieldName = constants.COLLAPSED_FIELD_NAME;\n\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      if (input.name !== collapsedInputName) {\n        input.setVisible(!collapsed);\n      }\n    }\n\n    for (const icon of this.getIcons()) {\n      icon.updateCollapsed();\n    }\n\n    if (!collapsed) {\n      this.updateDisabled();\n      this.removeInput(collapsedInputName);\n      return;\n    }\n\n    const text = this.toString(internalConstants.COLLAPSE_CHARS);\n    const field = this.getField(collapsedFieldName);\n    if (field) {\n      field.setValue(text);\n      return;\n    }\n    const input =\n      this.getInput(collapsedInputName) ||\n      this.appendDummyInput(collapsedInputName);\n    input.appendField(new FieldLabel(text), collapsedFieldName);\n  }\n\n  /**\n   * Open the next (or previous) FieldTextInput.\n   *\n   * @param start Current field.\n   * @param forward If true go forward, otherwise backward.\n   */\n  tab(start: Field, forward: boolean) {\n    const tabCursor = new TabNavigateCursor();\n    tabCursor.setCurNode(ASTNode.createFieldNode(start)!);\n    const currentNode = tabCursor.getCurNode();\n\n    if (forward) {\n      tabCursor.next();\n    } else {\n      tabCursor.prev();\n    }\n\n    const nextNode = tabCursor.getCurNode();\n    if (nextNode && nextNode !== currentNode) {\n      const nextField = nextNode.getLocation() as Field;\n      nextField.showEditor();\n\n      // Also move the cursor if we're in keyboard nav mode.\n      if (this.workspace.keyboardAccessibilityMode) {\n        this.workspace.getCursor()!.setCurNode(nextNode);\n      }\n    }\n  }\n\n  /**\n   * Handle a pointerdown on an SVG block.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown(e: PointerEvent) {\n    const gesture = this.workspace.getGesture(e);\n    if (gesture) {\n      gesture.handleBlockStart(e, this);\n    }\n  }\n\n  /**\n   * Load the block's help page in a new window.\n   *\n   * @internal\n   */\n  showHelp() {\n    const url =\n      typeof this.helpUrl === 'function' ? this.helpUrl() : this.helpUrl;\n    if (url) {\n      window.open(url);\n    }\n  }\n\n  /**\n   * Generate the context menu for this block.\n   *\n   * @returns Context menu options or null if no menu.\n   */\n  protected generateContextMenu(): Array<\n    ContextMenuOption | LegacyContextMenuOption\n  > | null {\n    if (this.workspace.options.readOnly || !this.contextMenu) {\n      return null;\n    }\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\n      ContextMenuRegistry.ScopeType.BLOCK,\n      {block: this},\n    );\n\n    // Allow the block to add or modify menuOptions.\n    if (this.customContextMenu) {\n      this.customContextMenu(menuOptions);\n    }\n\n    return menuOptions;\n  }\n\n  /**\n   * Show the context menu for this block.\n   *\n   * @param e Mouse event.\n   * @internal\n   */\n  showContextMenu(e: PointerEvent) {\n    const menuOptions = this.generateContextMenu();\n\n    if (menuOptions && menuOptions.length) {\n      ContextMenu.show(e, menuOptions, this.RTL, this.workspace);\n      ContextMenu.setCurrentBlock(this);\n    }\n  }\n\n  /**\n   * Updates the locations of any parts of the block that need to know where\n   * they are (e.g. connections, icons).\n   *\n   * @param blockOrigin The top-left of this block in workspace coordinates.\n   * @internal\n   */\n  updateComponentLocations(blockOrigin: Coordinate) {\n    if (!this.dragging) this.updateConnectionLocations(blockOrigin);\n    this.updateIconLocations(blockOrigin);\n    this.updateFieldLocations(blockOrigin);\n\n    for (const child of this.getChildren(false)) {\n      child.updateComponentLocations(\n        Coordinate.sum(blockOrigin, child.relativeCoords),\n      );\n    }\n  }\n\n  private updateConnectionLocations(blockOrigin: Coordinate) {\n    for (const conn of this.getConnections_(false)) {\n      conn.moveToOffset(blockOrigin);\n    }\n  }\n\n  private updateIconLocations(blockOrigin: Coordinate) {\n    for (const icon of this.getIcons()) {\n      icon.onLocationChange(blockOrigin);\n    }\n  }\n\n  private updateFieldLocations(blockOrigin: Coordinate) {\n    for (const input of this.inputList) {\n      for (const field of input.fieldRow) {\n        field.onLocationChange(blockOrigin);\n      }\n    }\n  }\n\n  /**\n   * Recursively adds or removes the dragging class to this node and its\n   * children.\n   *\n   * @param adding True if adding, false if removing.\n   * @internal\n   */\n  setDragging(adding: boolean) {\n    this.dragging = adding;\n    if (adding) {\n      this.translation = '';\n      common.draggingConnections.push(...this.getConnections_(true));\n      dom.addClass(this.svgGroup, 'blocklyDragging');\n    } else {\n      common.draggingConnections.length = 0;\n      dom.removeClass(this.svgGroup, 'blocklyDragging');\n    }\n    // Recurse through all blocks attached under this one.\n    for (let i = 0; i < this.childBlocks_.length; i++) {\n      (this.childBlocks_[i] as BlockSvg).setDragging(adding);\n    }\n  }\n\n  /**\n   * Set whether this block is movable or not.\n   *\n   * @param movable True if movable.\n   */\n  override setMovable(movable: boolean) {\n    super.setMovable(movable);\n    this.pathObject.updateMovable(movable);\n  }\n\n  /**\n   * Set whether this block is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  override setEditable(editable: boolean) {\n    super.setEditable(editable);\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].updateEditable();\n    }\n  }\n\n  /**\n   * Sets whether this block is a shadow block or not.\n   * This method is internal and should not be called by users of Blockly. To\n   * create shadow blocks programmatically call connection.setShadowState\n   *\n   * @param shadow True if a shadow.\n   * @internal\n   */\n  override setShadow(shadow: boolean) {\n    super.setShadow(shadow);\n    this.applyColour();\n  }\n\n  /**\n   * Set whether this block is an insertion marker block or not.\n   * Once set this cannot be unset.\n   *\n   * @param insertionMarker True if an insertion marker.\n   * @internal\n   */\n  override setInsertionMarker(insertionMarker: boolean) {\n    if (this.isInsertionMarker_ === insertionMarker) {\n      return; // No change.\n    }\n    this.isInsertionMarker_ = insertionMarker;\n    if (this.isInsertionMarker_) {\n      this.setColour(\n        this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR,\n      );\n      this.pathObject.updateInsertionMarker(true);\n    }\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node (probably a group).\n   */\n  getSvgRoot(): SVGGElement {\n    return this.svgGroup;\n  }\n\n  /**\n   * Dispose of this block.\n   *\n   * @param healStack If true, then try to heal any gap by connecting the next\n   *     statement with the previous statement.  Otherwise, dispose of all\n   *     children of this block.\n   * @param animate If true, show a disposal animation and sound.\n   */\n  override dispose(healStack?: boolean, animate?: boolean) {\n    this.disposing = true;\n\n    Tooltip.dispose();\n    ContextMenu.hide();\n\n    if (animate) {\n      this.unplug(healStack);\n      blockAnimations.disposeUiEffect(this);\n    }\n\n    // Selecting a shadow block highlights an ancestor block, but that highlight\n    // should be removed if the shadow block will be deleted. So, before\n    // deleting blocks and severing the connections between them, check whether\n    // doing so would delete a selected block and make sure that any associated\n    // parent is updated.\n    const selection = common.getSelected();\n    if (selection instanceof Block) {\n      let selectionAncestor: Block | null = selection;\n      while (selectionAncestor !== null) {\n        if (selectionAncestor === this) {\n          // The block to be deleted contains the selected block, so remove any\n          // selection highlight associated with the selected block before\n          // deleting them.\n          selection.unselect();\n        }\n        selectionAncestor = selectionAncestor.getParent();\n      }\n    }\n\n    super.dispose(!!healStack);\n    dom.removeNode(this.svgGroup);\n  }\n\n  /**\n   * Disposes of this block without doing things required by the top block.\n   * E.g. does trigger UI effects, remove nodes, etc.\n   */\n  override disposeInternal() {\n    this.disposing = true;\n    super.disposeInternal();\n\n    if (common.getSelected() === this) {\n      this.unselect();\n      this.workspace.cancelCurrentGesture();\n    }\n\n    [...this.warningTextDb.values()].forEach((n) => clearTimeout(n));\n    this.warningTextDb.clear();\n\n    this.getIcons().forEach((i) => i.dispose());\n  }\n\n  /**\n   * Delete a block and hide chaff when doing so. The block will not be deleted\n   * if it's in a flyout. This is called from the context menu and keyboard\n   * shortcuts as the full delete action. If you are disposing of a block from\n   * the workspace and don't need to perform flyout checks, handle event\n   * grouping, or hide chaff, then use `block.dispose()` directly.\n   */\n  checkAndDelete() {\n    if (this.workspace.isFlyout) {\n      return;\n    }\n    eventUtils.setGroup(true);\n    this.workspace.hideChaff();\n    if (this.outputConnection) {\n      // Do not attempt to heal rows\n      // (https://github.com/google/blockly/issues/4832)\n      this.dispose(false, true);\n    } else {\n      this.dispose(/* heal */ true, true);\n    }\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Encode a block for copying.\n   *\n   * @returns Copy metadata, or null if the block is an insertion marker.\n   */\n  toCopyData(): BlockCopyData | null {\n    if (this.isInsertionMarker_) {\n      return null;\n    }\n    return {\n      paster: BlockPaster.TYPE,\n      blockState: blocks.save(this, {\n        addCoordinates: true,\n        addNextBlocks: false,\n      }) as blocks.State,\n      typeCounts: common.getBlockTypeCounts(this, true),\n    };\n  }\n\n  /**\n   * Updates the colour of the block to match the block's state.\n   *\n   * @internal\n   */\n  applyColour() {\n    this.pathObject.applyColour(this);\n\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].applyColour();\n    }\n\n    for (let x = 0, input; (input = this.inputList[x]); x++) {\n      for (let y = 0, field; (field = input.fieldRow[y]); y++) {\n        field.applyColour();\n      }\n    }\n  }\n\n  /**\n   * Updates the colour of the block (and children) to match the current\n   * disabled state.\n   *\n   * @internal\n   */\n  updateDisabled() {\n    const disabled = !this.isEnabled() || this.getInheritedDisabled();\n\n    if (this.visuallyDisabled === disabled) {\n      this.getNextBlock()?.updateDisabled();\n      return;\n    }\n\n    this.applyColour();\n    this.visuallyDisabled = disabled;\n    for (const child of this.getChildren(false)) {\n      child.updateDisabled();\n    }\n  }\n\n  /**\n   * Set this block's warning text.\n   *\n   * @param text The text, or null to delete.\n   * @param id An optional ID for the warning text to be able to maintain\n   *     multiple warnings.\n   */\n  override setWarningText(text: string | null, id: string = '') {\n    if (!id) {\n      // Kill all previous pending processes, this edit supersedes them all.\n      for (const timeout of this.warningTextDb.values()) {\n        clearTimeout(timeout);\n      }\n      this.warningTextDb.clear();\n    } else if (this.warningTextDb.has(id)) {\n      // Only queue up the latest change.  Kill any earlier pending process.\n      clearTimeout(this.warningTextDb.get(id)!);\n      this.warningTextDb.delete(id);\n    }\n    if (this.workspace.isDragging()) {\n      // Don't change the warning text during a drag.\n      // Wait until the drag finishes.\n      this.warningTextDb.set(\n        id,\n        setTimeout(() => {\n          if (!this.isDeadOrDying()) {\n            this.warningTextDb.delete(id);\n            this.setWarningText(text, id);\n          }\n        }, 100),\n      );\n      return;\n    }\n    if (this.isInFlyout) {\n      text = null;\n    }\n\n    const icon = this.getIcon(WarningIcon.TYPE) as WarningIcon | undefined;\n    if (text) {\n      // Bubble up to add a warning on top-most collapsed block.\n      // TODO(#6020): This warning is never removed.\n      let parent = this.getSurroundParent();\n      let collapsedParent = null;\n      while (parent) {\n        if (parent.isCollapsed()) {\n          collapsedParent = parent;\n        }\n        parent = parent.getSurroundParent();\n      }\n      if (collapsedParent) {\n        collapsedParent.setWarningText(\n          Msg['COLLAPSED_WARNINGS_WARNING'],\n          BlockSvg.COLLAPSED_WARNING_ID,\n        );\n      }\n\n      if (icon) {\n        (icon as WarningIcon).addMessage(text, id);\n      } else {\n        this.addIcon(new WarningIcon(this).addMessage(text, id));\n      }\n    } else if (icon) {\n      // Dispose all warnings if no ID is given.\n      if (!id) {\n        this.removeIcon(WarningIcon.TYPE);\n      } else {\n        // Remove just this warning id's message.\n        icon.addMessage('', id);\n        // Then remove the entire icon if there is no longer any text.\n        if (!icon.getText()) this.removeIcon(WarningIcon.TYPE);\n      }\n    }\n  }\n\n  /**\n   * Give this block a mutator dialog.\n   *\n   * @param mutator A mutator dialog instance or null to remove.\n   */\n  override setMutator(mutator: MutatorIcon | null) {\n    this.removeIcon(MutatorIcon.TYPE);\n    if (mutator) this.addIcon(mutator);\n  }\n\n  override addIcon<T extends IIcon>(icon: T): T {\n    super.addIcon(icon);\n\n    if (icon instanceof MutatorIcon) this.mutator = icon;\n\n    icon.initView(this.createIconPointerDownListener(icon));\n    icon.applyColour();\n    icon.updateEditable();\n    this.queueRender();\n\n    return icon;\n  }\n\n  /**\n   * Creates a pointer down event listener for the icon to append to its\n   * root svg.\n   */\n  private createIconPointerDownListener(icon: IIcon) {\n    return (e: PointerEvent) => {\n      if (this.isDeadOrDying()) return;\n      const gesture = this.workspace.getGesture(e);\n      if (gesture) {\n        gesture.setStartIcon(icon);\n      }\n    };\n  }\n\n  override removeIcon(type: IconType<IIcon>): boolean {\n    const removed = super.removeIcon(type);\n\n    if (type.equals(MutatorIcon.TYPE)) this.mutator = null;\n\n    this.queueRender();\n\n    return removed;\n  }\n\n  /**\n   * @deprecated v11 - Set whether the block is manually enabled or disabled.\n   * The user can toggle whether a block is disabled from a context menu\n   * option. A block may still be disabled for other reasons even if the user\n   * attempts to manually enable it, such as when the block is in an invalid\n   * location. This method is deprecated and setDisabledReason should be used\n   * instead.\n   *\n   * @param enabled True if enabled.\n   */\n  override setEnabled(enabled: boolean) {\n    deprecation.warn(\n      'setEnabled',\n      'v11',\n      'v12',\n      'the setDisabledReason method of BlockSvg',\n    );\n    const wasEnabled = this.isEnabled();\n    super.setEnabled(enabled);\n    if (this.isEnabled() !== wasEnabled && !this.getInheritedDisabled()) {\n      this.updateDisabled();\n    }\n  }\n\n  /**\n   * Add or remove a reason why the block might be disabled. If a block has\n   * any reasons to be disabled, then the block itself will be considered\n   * disabled. A block could be disabled for multiple independent reasons\n   * simultaneously, such as when the user manually disables it, or the block\n   * is invalid.\n   *\n   * @param disabled If true, then the block should be considered disabled for\n   *     at least the provided reason, otherwise the block is no longer disabled\n   *     for that reason.\n   * @param reason A language-neutral identifier for a reason why the block\n   *     could be disabled. Call this method again with the same identifier to\n   *     update whether the block is currently disabled for this reason.\n   */\n  override setDisabledReason(disabled: boolean, reason: string): void {\n    const wasEnabled = this.isEnabled();\n    super.setDisabledReason(disabled, reason);\n    if (this.isEnabled() !== wasEnabled && !this.getInheritedDisabled()) {\n      this.updateDisabled();\n    }\n  }\n\n  /**\n   * Set whether the block is highlighted or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param highlighted True if highlighted.\n   */\n  setHighlighted(highlighted: boolean) {\n    this.pathObject.updateHighlighted(highlighted);\n  }\n\n  /**\n   * Adds the visual \"select\" effect to the block, but does not actually select\n   * it or fire an event.\n   *\n   * @see BlockSvg#select\n   */\n  addSelect() {\n    this.pathObject.updateSelected(true);\n  }\n\n  /**\n   * Removes the visual \"select\" effect from the block, but does not actually\n   * unselect it or fire an event.\n   *\n   * @see BlockSvg#unselect\n   */\n  removeSelect() {\n    this.pathObject.updateSelected(false);\n  }\n\n  /**\n   * Update the cursor over this block by adding or removing a class.\n   *\n   * @param enable True if the delete cursor should be shown, false otherwise.\n   * @internal\n   */\n  setDeleteStyle(enable: boolean) {\n    this.pathObject.updateDraggingDelete(enable);\n  }\n\n  // Overrides of functions on Blockly.Block that take into account whether the\n  // block has been rendered.\n\n  /**\n   * Get the colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  override getColour(): string {\n    return this.style.colourPrimary;\n  }\n\n  /**\n   * Change the colour of a block.\n   *\n   * @param colour HSV hue value, or #RRGGBB string.\n   */\n  override setColour(colour: number | string) {\n    super.setColour(colour);\n    const styleObj = this.workspace\n      .getRenderer()\n      .getConstants()\n      .getBlockStyleForColour(this.colour_);\n\n    this.pathObject.setStyle(styleObj.style);\n    this.style = styleObj.style;\n    this.styleName_ = styleObj.name;\n\n    this.applyColour();\n  }\n\n  /**\n   * Set the style and colour values of a block.\n   *\n   * @param blockStyleName Name of the block style.\n   * @throws {Error} if the block style does not exist.\n   */\n  override setStyle(blockStyleName: string) {\n    const blockStyle = this.workspace\n      .getRenderer()\n      .getConstants()\n      .getBlockStyle(blockStyleName);\n    this.styleName_ = blockStyleName;\n\n    if (blockStyle) {\n      this.hat = blockStyle.hat;\n      this.pathObject.setStyle(blockStyle);\n      // Set colour to match Block.\n      this.colour_ = blockStyle.colourPrimary;\n      this.style = blockStyle;\n\n      this.applyColour();\n    } else {\n      throw Error('Invalid style name: ' + blockStyleName);\n    }\n  }\n\n  /**\n   * Returns the BlockStyle object used to style this block.\n   *\n   * @returns This block's style object.\n   */\n  getStyle(): BlockStyle {\n    return this.style;\n  }\n\n  /**\n   * Move this block to the front of the visible workspace.\n   * <g> tags do not respect z-index so SVG renders them in the\n   * order that they are in the DOM.  By placing this block first within the\n   * block group's <g>, it will render on top of any other blocks.\n   * Use sparingly, this method is expensive because it reorders the DOM\n   * nodes.\n   *\n   * @param blockOnly True to only move this block to the front without\n   *     adjusting its parents.\n   */\n  bringToFront(blockOnly = false) {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this | null = this;\n    if (block.isDeadOrDying()) {\n      return;\n    }\n    do {\n      const root = block.getSvgRoot();\n      const parent = root.parentNode;\n      const childNodes = parent!.childNodes;\n      // Avoid moving the block if it's already at the bottom.\n      if (childNodes[childNodes.length - 1] !== root) {\n        parent!.appendChild(root);\n      }\n      if (blockOnly) break;\n      block = block.getParent();\n    } while (block);\n  }\n\n  /**\n   * Set whether this block can chain onto the bottom of another block.\n   *\n   * @param newBoolean True if there can be a previous statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  override setPreviousStatement(\n    newBoolean: boolean,\n    opt_check?: string | string[] | null,\n  ) {\n    super.setPreviousStatement(newBoolean, opt_check);\n    this.queueRender();\n  }\n\n  /**\n   * Set whether another block can chain onto the bottom of this block.\n   *\n   * @param newBoolean True if there can be a next statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  override setNextStatement(\n    newBoolean: boolean,\n    opt_check?: string | string[] | null,\n  ) {\n    super.setNextStatement(newBoolean, opt_check);\n    this.queueRender();\n  }\n\n  /**\n   * Set whether this block returns a value.\n   *\n   * @param newBoolean True if there is an output.\n   * @param opt_check Returned type or list of returned types.  Null or\n   *     undefined if any type could be returned (e.g. variable get).\n   */\n  override setOutput(\n    newBoolean: boolean,\n    opt_check?: string | string[] | null,\n  ) {\n    super.setOutput(newBoolean, opt_check);\n    this.queueRender();\n  }\n\n  /**\n   * Set whether value inputs are arranged horizontally or vertically.\n   *\n   * @param newBoolean True if inputs are horizontal.\n   */\n  override setInputsInline(newBoolean: boolean) {\n    super.setInputsInline(newBoolean);\n    this.queueRender();\n  }\n\n  /**\n   * Remove an input from this block.\n   *\n   * @param name The name of the input.\n   * @param opt_quiet True to prevent error if input is not present.\n   * @returns True if operation succeeds, false if input is not present and\n   *     opt_quiet is true\n   * @throws {Error} if the input is not present and opt_quiet is not true.\n   */\n  override removeInput(name: string, opt_quiet?: boolean): boolean {\n    const removed = super.removeInput(name, opt_quiet);\n    this.queueRender();\n    return removed;\n  }\n\n  /**\n   * Move a numbered input to a different location on this block.\n   *\n   * @param inputIndex Index of the input to move.\n   * @param refIndex Index of input that should be after the moved input.\n   */\n  override moveNumberedInputBefore(inputIndex: number, refIndex: number) {\n    super.moveNumberedInputBefore(inputIndex, refIndex);\n    this.queueRender();\n  }\n\n  /** @override */\n  override appendInput(input: Input): Input {\n    super.appendInput(input);\n    this.queueRender();\n    return input;\n  }\n\n  /**\n   * Sets whether this block's connections are tracked in the database or not.\n   *\n   * Used by the deserializer to be more efficient. Setting a connection's\n   * tracked_ value to false keeps it from adding itself to the db when it\n   * gets its first moveTo call, saving expensive ops for later.\n   *\n   * @param track If true, start tracking. If false, stop tracking.\n   * @internal\n   */\n  setConnectionTracking(track: boolean) {\n    if (this.previousConnection) {\n      this.previousConnection.setTracking(track);\n    }\n    if (this.outputConnection) {\n      this.outputConnection.setTracking(track);\n    }\n    if (this.nextConnection) {\n      this.nextConnection.setTracking(track);\n      const child = this.nextConnection.targetBlock();\n      if (child) {\n        child.setConnectionTracking(track);\n      }\n    }\n\n    if (this.collapsed_) {\n      // When track is true, we don't want to start tracking collapsed\n      // connections. When track is false, we're already not tracking\n      // collapsed connections, so no need to update.\n      return;\n    }\n\n    for (let i = 0; i < this.inputList.length; i++) {\n      const conn = this.inputList[i].connection as RenderedConnection;\n      if (conn) {\n        conn.setTracking(track);\n\n        // Pass tracking on down the chain.\n        const block = conn.targetBlock();\n        if (block) {\n          block.setConnectionTracking(track);\n        }\n      }\n    }\n  }\n\n  /**\n   * Returns connections originating from this block.\n   *\n   * @param all If true, return all connections even hidden ones.\n   *     Otherwise, for a collapsed block don't return inputs connections.\n   * @returns Array of connections.\n   * @internal\n   */\n  override getConnections_(all: boolean): RenderedConnection[] {\n    const myConnections = [];\n    if (this.outputConnection) {\n      myConnections.push(this.outputConnection);\n    }\n    if (this.previousConnection) {\n      myConnections.push(this.previousConnection);\n    }\n    if (this.nextConnection) {\n      myConnections.push(this.nextConnection);\n    }\n    if (all || !this.collapsed_) {\n      for (let i = 0, input; (input = this.inputList[i]); i++) {\n        if (input.connection) {\n          myConnections.push(input.connection as RenderedConnection);\n        }\n      }\n    }\n    return myConnections;\n  }\n\n  /**\n   * Walks down a stack of blocks and finds the last next connection on the\n   * stack.\n   *\n   * @param ignoreShadows If true,the last connection on a non-shadow block will\n   *     be returned. If false, this will follow shadows to find the last\n   *     connection.\n   * @returns The last next connection on the stack, or null.\n   * @internal\n   */\n  override lastConnectionInStack(\n    ignoreShadows: boolean,\n  ): RenderedConnection | null {\n    return super.lastConnectionInStack(ignoreShadows) as RenderedConnection;\n  }\n\n  /**\n   * Find the connection on this block that corresponds to the given connection\n   * on the other block.\n   * Used to match connections between a block and its insertion marker.\n   *\n   * @param otherBlock The other block to match against.\n   * @param conn The other connection to match.\n   * @returns The matching connection on this block, or null.\n   * @internal\n   */\n  override getMatchingConnection(\n    otherBlock: Block,\n    conn: Connection,\n  ): RenderedConnection | null {\n    return super.getMatchingConnection(otherBlock, conn) as RenderedConnection;\n  }\n\n  /**\n   * Create a connection of the specified type.\n   *\n   * @param type The type of the connection to create.\n   * @returns A new connection of the specified type.\n   * @internal\n   */\n  override makeConnection_(type: ConnectionType): RenderedConnection {\n    return new RenderedConnection(this, type);\n  }\n\n  /**\n   * Return the next statement block directly connected to this block.\n   *\n   * @returns The next statement block or null.\n   */\n  override getNextBlock(): BlockSvg | null {\n    return super.getNextBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the block connected to the previous connection.\n   *\n   * @returns The previous statement block or null.\n   */\n  override getPreviousBlock(): BlockSvg | null {\n    return super.getPreviousBlock() as BlockSvg;\n  }\n\n  /**\n   * Bumps unconnected blocks out of alignment.\n   *\n   * Two blocks which aren't actually connected should not coincidentally line\n   * up on screen, because that creates confusion for end-users.\n   */\n  override bumpNeighbours() {\n    const root = this.getRootBlock();\n    if (\n      this.isDeadOrDying() ||\n      this.workspace.isDragging() ||\n      root.isInFlyout\n    ) {\n      return;\n    }\n\n    function neighbourIsInStack(neighbour: RenderedConnection) {\n      return neighbour.getSourceBlock().getRootBlock() === root;\n    }\n\n    for (const conn of this.getConnections_(false)) {\n      if (conn.isSuperior()) {\n        // Recurse down the block stack.\n        conn.targetBlock()?.bumpNeighbours();\n      }\n\n      for (const neighbour of conn.neighbours(config.snapRadius)) {\n        if (neighbourIsInStack(neighbour)) continue;\n        if (conn.isConnected() && neighbour.isConnected()) continue;\n\n        if (conn.isSuperior()) {\n          neighbour.bumpAwayFrom(conn, /* initiatedByThis = */ false);\n        } else {\n          conn.bumpAwayFrom(neighbour, /* initiatedByThis = */ true);\n        }\n      }\n    }\n  }\n\n  /**\n   * Snap to grid, and then bump neighbouring blocks away at the end of the next\n   * render.\n   */\n  scheduleSnapAndBump() {\n    this.snapToGrid();\n    this.bumpNeighbours();\n  }\n\n  /**\n   * Position a block so that it doesn't move the target block when connected.\n   * The block to position is usually either the first block in a dragged stack\n   * or an insertion marker.\n   *\n   * @param sourceConnection The connection on the moving block's stack.\n   * @param originalOffsetToTarget The connection original offset to the target connection\n   * @param originalOffsetInBlock The connection original offset in its block\n   * @internal\n   */\n  positionNearConnection(\n    sourceConnection: RenderedConnection,\n    originalOffsetToTarget: {x: number; y: number},\n    originalOffsetInBlock: Coordinate,\n  ) {\n    // We only need to position the new block if it's before the existing one,\n    // otherwise its position is set by the previous block.\n    if (\n      sourceConnection.type === ConnectionType.NEXT_STATEMENT ||\n      sourceConnection.type === ConnectionType.INPUT_VALUE\n    ) {\n      // First move the block to match the orginal target connection position\n      let dx = originalOffsetToTarget.x;\n      let dy = originalOffsetToTarget.y;\n      // Then adjust its position according to the connection resize\n      dx += originalOffsetInBlock.x - sourceConnection.getOffsetInBlock().x;\n      dy += originalOffsetInBlock.y - sourceConnection.getOffsetInBlock().y;\n\n      this.moveBy(dx, dy);\n    }\n  }\n\n  /**\n   * Find all the blocks that are directly nested inside this one.\n   * Includes value and statement inputs, as well as any following statement.\n   * Excludes any connection on an output tab or any preceding statement.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  override getChildren(ordered: boolean): BlockSvg[] {\n    return super.getChildren(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Triggers a rerender after a delay to allow for batching.\n   *\n   * @returns A promise that resolves after the currently queued renders have\n   *     been completed. Used for triggering other behavior that relies on\n   *     updated size/position location for the block.\n   * @internal\n   */\n  queueRender(): Promise<void> {\n    return renderManagement.queueRender(this);\n  }\n\n  /**\n   * Immediately lays out and reflows a block based on its contents and\n   * settings.\n   */\n  render() {\n    this.queueRender();\n    renderManagement.triggerQueuedRenders();\n  }\n\n  /**\n   * Renders this block in a way that's compatible with the more efficient\n   * render management system.\n   *\n   * @internal\n   */\n  renderEfficiently() {\n    dom.startTextWidthCache();\n\n    if (this.isCollapsed()) {\n      this.updateCollapsed();\n    }\n\n    if (!this.isEnabled()) {\n      this.updateDisabled();\n    }\n\n    this.workspace.getRenderer().render(this);\n    this.tightenChildrenEfficiently();\n\n    dom.stopTextWidthCache();\n    this.updateMarkers_();\n  }\n\n  /**\n   * Tightens all children of this block so they are snuggly rendered against\n   * their parent connections.\n   *\n   * Does not update connection locations, so that they can be updated more\n   * efficiently by the render management system.\n   *\n   * @internal\n   */\n  tightenChildrenEfficiently() {\n    for (const input of this.inputList) {\n      const conn = input.connection as RenderedConnection;\n      if (conn) conn.tightenEfficiently();\n    }\n    if (this.nextConnection) this.nextConnection.tightenEfficiently();\n  }\n\n  /** Redraw any attached marker or cursor svgs if needed. */\n  protected updateMarkers_() {\n    if (this.workspace.keyboardAccessibilityMode && this.pathObject.cursorSvg) {\n      this.workspace.getCursor()!.draw();\n    }\n    if (this.workspace.keyboardAccessibilityMode && this.pathObject.markerSvg) {\n      // TODO(#4592): Update all markers on the block.\n      this.workspace.getMarker(MarkerManager.LOCAL_MARKER)!.draw();\n    }\n    for (const input of this.inputList) {\n      for (const field of input.fieldRow) {\n        field.updateMarkers_();\n      }\n    }\n  }\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    this.pathObject.setCursorSvg(cursorSvg);\n  }\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    this.pathObject.setMarkerSvg(markerSvg);\n  }\n\n  /**\n   * Returns a bounding box describing the dimensions of this block\n   * and any blocks stacked below it.\n   *\n   * @returns Object with height and width properties in workspace units.\n   * @internal\n   */\n  getHeightWidth(): {height: number; width: number} {\n    let height = this.height;\n    let width = this.width;\n    // Recursively add size of subsequent blocks.\n    const nextBlock = this.getNextBlock();\n    if (nextBlock) {\n      const nextHeightWidth = nextBlock.getHeightWidth();\n      const tabHeight = this.workspace\n        .getRenderer()\n        .getConstants().NOTCH_HEIGHT;\n      height += nextHeightWidth.height - tabHeight;\n      width = Math.max(width, nextHeightWidth.width);\n    }\n    return {height, width};\n  }\n\n  /**\n   * Visual effect to show that if the dragging block is dropped, this block\n   * will be replaced.  If a shadow block, it will disappear.  Otherwise it will\n   * bump.\n   *\n   * @param add True if highlighting should be added.\n   * @internal\n   */\n  fadeForReplacement(add: boolean) {\n    // TODO (7204): Remove these internal methods.\n    (this.pathObject as AnyDuringMigration).updateReplacementFade(add);\n  }\n\n  /**\n   * Visual effect to show that if the dragging block is dropped it will connect\n   * to this input.\n   *\n   * @param conn The connection on the input to highlight.\n   * @param add True if highlighting should be added.\n   * @internal\n   */\n  highlightShapeForInput(conn: RenderedConnection, add: boolean) {\n    // TODO (7204): Remove these internal methods.\n    (this.pathObject as AnyDuringMigration).updateShapeForInputHighlight(\n      conn,\n      add,\n    );\n  }\n\n  /** Sets the drag strategy for this block. */\n  setDragStrategy(dragStrategy: IDragStrategy) {\n    this.dragStrategy = dragStrategy;\n  }\n\n  /** Returns whether this block is movable or not. */\n  override isMovable(): boolean {\n    return this.dragStrategy.isMovable();\n  }\n\n  /** Starts a drag on the block. */\n  startDrag(e?: PointerEvent): void {\n    this.dragStrategy.startDrag(e);\n  }\n\n  /** Drags the block to the given location. */\n  drag(newLoc: Coordinate, e?: PointerEvent): void {\n    this.dragStrategy.drag(newLoc, e);\n  }\n\n  /** Ends the drag on the block. */\n  endDrag(e?: PointerEvent): void {\n    this.dragStrategy.endDrag(e);\n  }\n\n  /** Moves the block back to where it was at the start of a drag. */\n  revertDrag(): void {\n    this.dragStrategy.revertDrag();\n  }\n\n  /**\n   * Returns a representation of this block that can be displayed in a flyout.\n   */\n  toFlyoutInfo(): FlyoutItemInfo[] {\n    const json: FlyoutItemInfo = {\n      kind: 'BLOCK',\n      ...blocks.save(this),\n    };\n\n    const toRemove = new Set(['id', 'height', 'width', 'pinned', 'enabled']);\n\n    // Traverse the JSON recursively.\n    const traverseJson = function (json: {[key: string]: unknown}) {\n      for (const key in json) {\n        if (toRemove.has(key)) {\n          delete json[key];\n        } else if (typeof json[key] === 'object') {\n          traverseJson(json[key] as {[key: string]: unknown});\n        }\n      }\n    };\n\n    traverseJson(json as unknown as {[key: string]: unknown});\n    return [json];\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The abstract class for a component with custom behaviour when a\n * block or bubble is dragged over or dropped on top of it.\n *\n * @class\n */\n// Former goog.module ID: Blockly.DragTarget\n\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport type {Rect} from './utils/rect.js';\n\n/**\n * Abstract class for a component with custom behaviour when a block or bubble\n * is dragged over or dropped on top of it.\n */\nexport class DragTarget implements IDragTarget {\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  id!: string;\n\n  /**\n   * Constructor for DragTarget. It exists to add the id property and should not\n   * be called directly, only by a subclass.\n   */\n  constructor() {}\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragEnter(_dragElement: IDraggable) {\n    // no-op\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragOver(_dragElement: IDraggable) {\n    // no-op\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragExit(_dragElement: IDraggable) {\n    // no-op\n  }\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDrop(_dragElement: IDraggable) {\n    // no-op\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to the Blockly injection div.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  getClientRect(): Rect | null {\n    return null;\n  }\n\n  /**\n   * Returns whether the provided block or bubble should not be moved after\n   * being dropped on this component. If true, the element will return to where\n   * it was when the drag started.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   * @returns Whether the block or bubble provided should be returned to drag\n   *     start.\n   */\n  shouldPreventMove(_dragElement: IDraggable): boolean {\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The abstract class for a component that can delete a block or\n * bubble that is dropped on top of it.\n *\n * @class\n */\n// Former goog.module ID: Blockly.DeleteArea\n\nimport {BlockSvg} from './block_svg.js';\nimport {DragTarget} from './drag_target.js';\nimport {isDeletable} from './interfaces/i_deletable.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\n\n/**\n * Abstract class for a component that can delete a block or bubble that is\n * dropped on top of it.\n */\nexport class DeleteArea extends DragTarget implements IDeleteArea {\n  /**\n   * Whether the last block or bubble dragged over this delete area would be\n   * deleted if dropped on this component.\n   * This property is not updated after the block or bubble is deleted.\n   */\n  protected wouldDelete_ = false;\n\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override id!: string;\n\n  /**\n   * Constructor for DeleteArea. Should not be called directly, only by a\n   * subclass.\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  wouldDelete(element: IDraggable): boolean {\n    if (element instanceof BlockSvg) {\n      const block = element;\n      const couldDeleteBlock = !block.getParent() && block.isDeletable();\n      this.updateWouldDelete_(couldDeleteBlock);\n    } else {\n      this.updateWouldDelete_(isDeletable(element) && element.isDeletable());\n    }\n    return this.wouldDelete_;\n  }\n\n  /**\n   * Updates the internal wouldDelete_ state.\n   *\n   * @param wouldDelete The new value for the wouldDelete state.\n   */\n  protected updateWouldDelete_(wouldDelete: boolean) {\n    this.wouldDelete_ = wouldDelete;\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of trashcan flyout open and close.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.TrashcanOpen\n\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners when the trashcan is opening or closing.\n */\nexport class TrashcanOpen extends UiBase {\n  /**\n   * True if the trashcan is currently opening (previously closed).\n   * False if it is currently closing (previously open).\n   */\n  isOpen?: boolean;\n  override type = EventType.TRASHCAN_OPEN;\n\n  /**\n   * @param opt_isOpen Whether the trashcan flyout is opening (false if\n   *     opening). Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(opt_isOpen?: boolean, opt_workspaceId?: string) {\n    super(opt_workspaceId);\n    this.isOpen = opt_isOpen;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): TrashcanOpenJson {\n    const json = super.toJson() as TrashcanOpenJson;\n    if (this.isOpen === undefined) {\n      throw new Error(\n        'Whether this is already open or not is undefined. Either pass ' +\n          'a value to the constructor, or call fromJson',\n      );\n    }\n    json['isOpen'] = this.isOpen;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of TrashcanOpen, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: TrashcanOpenJson,\n    workspace: Workspace,\n    event?: any,\n  ): TrashcanOpen {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new TrashcanOpen(),\n    ) as TrashcanOpen;\n    newEvent.isOpen = json['isOpen'];\n    return newEvent;\n  }\n}\n\nexport interface TrashcanOpenJson extends AbstractEventJson {\n  isOpen: boolean;\n}\n\nregistry.register(registry.Type.EVENT, EventType.TRASHCAN_OPEN, TrashcanOpen);\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a trash can icon.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Trashcan\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport {ComponentManager} from './component_manager.js';\nimport {DeleteArea} from './delete_area.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport './events/events_trashcan_open.js';\nimport {isBlockDelete} from './events/predicates.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IAutoHideable} from './interfaces/i_autohideable.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport type {UiMetrics} from './metrics_manager.js';\nimport {Options} from './options.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport * as registry from './registry.js';\nimport type * as blocks from './serialization/blocks.js';\nimport {SPRITE} from './sprites.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport * as toolbox from './utils/toolbox.js';\nimport {BlockInfo} from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a trash can.\n */\nexport class Trashcan\n  extends DeleteArea\n  implements IAutoHideable, IPositionable\n{\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  override id = 'trashcan';\n\n  /**\n   * A list of JSON (stored as strings) representing blocks in the trashcan.\n   */\n  private readonly contents: string[] = [];\n\n  /**\n   * The trashcan flyout.\n   *\n   * @internal\n   */\n  flyout: IFlyout | null = null;\n\n  /** Current open/close state of the lid. */\n  isLidOpen = false;\n\n  /**\n   * The minimum openness of the lid. Used to indicate if the trashcan\n   * contains blocks.\n   */\n  private minOpenness = 0;\n\n  /** The SVG group containing the trash can. */\n  private svgGroup: SVGElement | null = null;\n\n  /** The SVG image element of the trash can lid. */\n  private svgLid: SVGElement | null = null;\n\n  /** Task ID of opening/closing animation. */\n  private lidTask: ReturnType<typeof setTimeout> | null = null;\n\n  /** Current state of lid opening (0.0 = closed, 1.0 = open). */\n  private lidOpen = 0;\n\n  /** Left coordinate of the trash can. */\n  private left = 0;\n\n  /** Top coordinate of the trash can. */\n  private top = 0;\n\n  /** Whether this trash can has been initialized. */\n  private initialized = false;\n\n  /** @param workspace The workspace to sit in. */\n  constructor(private workspace: WorkspaceSvg) {\n    super();\n\n    if (this.workspace.options.maxTrashcanContents <= 0) {\n      return;\n    }\n\n    // Create flyout options.\n    const flyoutWorkspaceOptions = new Options({\n      'scrollbars': true,\n      'parentWorkspace': this.workspace,\n      'rtl': this.workspace.RTL,\n      'oneBasedIndex': this.workspace.options.oneBasedIndex,\n      'renderer': this.workspace.options.renderer,\n      'rendererOverrides': this.workspace.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions);\n    // Create vertical or horizontal flyout.\n    if (this.workspace.horizontalLayout) {\n      flyoutWorkspaceOptions.toolboxPosition =\n        this.workspace.toolboxPosition === toolbox.Position.TOP\n          ? toolbox.Position.BOTTOM\n          : toolbox.Position.TOP;\n      const HorizontalFlyout = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n        this.workspace.options,\n        true,\n      );\n      this.flyout = new HorizontalFlyout!(flyoutWorkspaceOptions);\n    } else {\n      flyoutWorkspaceOptions.toolboxPosition =\n        this.workspace.toolboxPosition === toolbox.Position.RIGHT\n          ? toolbox.Position.LEFT\n          : toolbox.Position.RIGHT;\n      const VerticalFlyout = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n        this.workspace.options,\n        true,\n      );\n      this.flyout = new VerticalFlyout!(flyoutWorkspaceOptions);\n    }\n    this.workspace.addChangeListener(this.onDelete.bind(this));\n  }\n\n  /**\n   * Create the trash can elements.\n   *\n   * @returns The trash can's SVG group.\n   */\n  createDom(): SVGElement {\n    /* Here's the markup that will be generated:\n        <g class=\"blocklyTrash\">\n          <clippath id=\"blocklyTrashBodyClipPath837493\">\n            <rect width=\"47\" height=\"45\" y=\"15\"></rect>\n          </clippath>\n          <image width=\"64\" height=\"92\" y=\"-32\" xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyTrashBodyClipPath837493)\"></image>\n          <clippath id=\"blocklyTrashLidClipPath837493\">\n            <rect width=\"47\" height=\"15\"></rect>\n          </clippath>\n          <image width=\"84\" height=\"92\" y=\"-32\" xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyTrashLidClipPath837493)\"></image>\n        </g>\n        */\n    this.svgGroup = dom.createSvgElement(Svg.G, {'class': 'blocklyTrash'});\n    let clip;\n    const rnd = String(Math.random()).substring(2);\n    clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyTrashBodyClipPath' + rnd},\n      this.svgGroup,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {'width': WIDTH, 'height': BODY_HEIGHT, 'y': LID_HEIGHT},\n      clip,\n    );\n    const body = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'x': -SPRITE_LEFT,\n        'height': SPRITE.height,\n        'y': -SPRITE_TOP,\n        'clip-path': 'url(#blocklyTrashBodyClipPath' + rnd + ')',\n      },\n      this.svgGroup,\n    );\n    body.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    clip = dom.createSvgElement(\n      Svg.CLIPPATH,\n      {'id': 'blocklyTrashLidClipPath' + rnd},\n      this.svgGroup,\n    );\n    dom.createSvgElement(\n      Svg.RECT,\n      {'width': WIDTH, 'height': LID_HEIGHT},\n      clip,\n    );\n    this.svgLid = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'width': SPRITE.width,\n        'x': -SPRITE_LEFT,\n        'height': SPRITE.height,\n        'y': -SPRITE_TOP,\n        'clip-path': 'url(#blocklyTrashLidClipPath' + rnd + ')',\n      },\n      this.svgGroup,\n    );\n    this.svgLid.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.workspace.options.pathToMedia + SPRITE.url,\n    );\n\n    // bindEventWithChecks_ quashes events too aggressively. See:\n    // https://groups.google.com/forum/#!topic/blockly/QF4yB9Wx00s\n    // Using bindEventWithChecks_ for blocking mousedown causes issue in mobile.\n    // See #4303\n    browserEvents.bind(\n      this.svgGroup,\n      'pointerdown',\n      this,\n      this.blockMouseDownWhenOpenable,\n    );\n    browserEvents.bind(this.svgGroup, 'pointerup', this, this.click);\n    // Bind to body instead of this.svgGroup so that we don't get lid jitters\n    browserEvents.bind(body, 'pointerover', this, this.mouseOver);\n    browserEvents.bind(body, 'pointerout', this, this.mouseOut);\n    this.animateLid();\n    return this.svgGroup;\n  }\n\n  /** Initializes the trash can. */\n  init() {\n    if (this.workspace.options.maxTrashcanContents > 0) {\n      dom.insertAfter(\n        this.flyout!.createDom(Svg.SVG)!,\n        this.workspace.getParentSvg(),\n      );\n      this.flyout!.init(this.workspace);\n    }\n    this.workspace.getComponentManager().addComponent({\n      component: this,\n      weight: ComponentManager.ComponentWeight.TRASHCAN_WEIGHT,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n        ComponentManager.Capability.POSITIONABLE,\n      ],\n    });\n    this.initialized = true;\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Dispose of this trash can.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.workspace.getComponentManager().removeComponent('trashcan');\n    if (this.svgGroup) {\n      dom.removeNode(this.svgGroup);\n    }\n    if (this.lidTask) {\n      clearTimeout(this.lidTask);\n    }\n  }\n\n  /**\n   * Whether the trashcan has contents.\n   *\n   * @returns True if the trashcan has contents.\n   */\n  private hasContents(): boolean {\n    return !!this.contents.length;\n  }\n\n  /**\n   * Returns true if the trashcan contents-flyout is currently open.\n   *\n   * @returns True if the trashcan contents-flyout is currently open.\n   */\n  contentsIsOpen(): boolean {\n    return !!this.flyout && this.flyout.isVisible();\n  }\n\n  /** Opens the trashcan flyout. */\n  openFlyout() {\n    if (this.contentsIsOpen()) {\n      return;\n    }\n    const contents = this.contents.map(function (string) {\n      return JSON.parse(string);\n    });\n    // Trashcans with lots of blocks can take a second to render.\n    const blocklyStyle = this.workspace.getParentSvg().style;\n    blocklyStyle.cursor = 'wait';\n    setTimeout(() => {\n      this.flyout?.show(contents);\n      blocklyStyle.cursor = '';\n      this.workspace.scrollbar?.setVisible(false);\n    }, 10);\n    this.fireUiEvent(true);\n  }\n\n  /** Closes the trashcan flyout. */\n  closeFlyout() {\n    if (!this.contentsIsOpen()) {\n      return;\n    }\n    this.flyout?.hide();\n    this.workspace.scrollbar?.setVisible(true);\n    this.fireUiEvent(false);\n    this.workspace.recordDragTargets();\n  }\n\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *     Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean) {\n    // For now the trashcan flyout always autocloses because it overlays the\n    // trashcan UI (no trashcan to click to close it).\n    if (!onlyClosePopups && this.flyout) {\n      this.closeFlyout();\n    }\n  }\n\n  /**\n   * Empties the trashcan's contents. If the contents-flyout is currently open\n   * it will be closed.\n   */\n  emptyContents() {\n    if (!this.hasContents()) {\n      return;\n    }\n    this.contents.length = 0;\n    this.setMinOpenness(0);\n    this.closeFlyout();\n  }\n\n  /**\n   * Positions the trashcan.\n   * It is positioned in the opposite corner to the corner the\n   * categories/toolbox starts at.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]) {\n    // Not yet initialized.\n    if (!this.initialized) {\n      return;\n    }\n\n    const cornerPosition = uiPosition.getCornerOppositeToolbox(\n      this.workspace,\n      metrics,\n    );\n\n    const height = BODY_HEIGHT + LID_HEIGHT;\n    const startRect = uiPosition.getStartPositionRect(\n      cornerPosition,\n      new Size(WIDTH, height),\n      MARGIN_HORIZONTAL,\n      MARGIN_VERTICAL,\n      metrics,\n      this.workspace,\n    );\n\n    const verticalPosition = cornerPosition.vertical;\n    const bumpDirection =\n      verticalPosition === uiPosition.verticalPosition.TOP\n        ? uiPosition.bumpDirection.DOWN\n        : uiPosition.bumpDirection.UP;\n    const positionRect = uiPosition.bumpPositionRect(\n      startRect,\n      MARGIN_VERTICAL,\n      bumpDirection,\n      savedPositions,\n    );\n\n    this.top = positionRect.top;\n    this.left = positionRect.left;\n    this.svgGroup?.setAttribute(\n      'transform',\n      'translate(' + this.left + ',' + this.top + ')',\n    );\n\n    this.flyout?.position();\n  }\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect | null {\n    const bottom = this.top + BODY_HEIGHT + LID_HEIGHT;\n    const right = this.left + WIDTH;\n    return new Rect(this.top, bottom, this.left, right);\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect | null {\n    if (!this.svgGroup) {\n      return null;\n    }\n\n    const trashRect = this.svgGroup.getBoundingClientRect();\n    const top = trashRect.top + SPRITE_TOP - MARGIN_HOTSPOT;\n    const bottom = top + LID_HEIGHT + BODY_HEIGHT + 2 * MARGIN_HOTSPOT;\n    const left = trashRect.left + SPRITE_LEFT - MARGIN_HOTSPOT;\n    const right = left + WIDTH + 2 * MARGIN_HOTSPOT;\n    return new Rect(top, bottom, left, right);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragOver(_dragElement: IDraggable) {\n    this.setLidOpen(this.wouldDelete_);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragExit(_dragElement: IDraggable) {\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDrop(_dragElement: IDraggable) {\n    setTimeout(this.setLidOpen.bind(this, false), 100);\n  }\n\n  /**\n   * Flip the lid open or shut.\n   *\n   * @param state True if open.\n   * @internal\n   */\n  setLidOpen(state: boolean) {\n    if (this.isLidOpen === state) {\n      return;\n    }\n    if (this.lidTask) {\n      clearTimeout(this.lidTask);\n    }\n    this.isLidOpen = state;\n    this.animateLid();\n  }\n\n  /** Rotate the lid open or closed by one step.  Then wait and recurse. */\n  private animateLid() {\n    const frames = ANIMATION_FRAMES;\n\n    const delta = 1 / (frames + 1);\n    this.lidOpen += this.isLidOpen ? delta : -delta;\n    this.lidOpen = Math.min(Math.max(this.lidOpen, this.minOpenness), 1);\n\n    this.setLidAngle(this.lidOpen * MAX_LID_ANGLE);\n\n    // Linear interpolation between min and max.\n    const opacity = OPACITY_MIN + this.lidOpen * (OPACITY_MAX - OPACITY_MIN);\n    if (this.svgGroup) {\n      this.svgGroup.style.opacity = `${opacity}`;\n    }\n\n    if (this.lidOpen > this.minOpenness && this.lidOpen < 1) {\n      this.lidTask = setTimeout(\n        this.animateLid.bind(this),\n        ANIMATION_LENGTH / frames,\n      );\n    }\n  }\n\n  /**\n   * Set the angle of the trashcan's lid.\n   *\n   * @param lidAngle The angle at which to set the lid.\n   */\n  private setLidAngle(lidAngle: number) {\n    const openAtRight =\n      this.workspace.toolboxPosition === toolbox.Position.RIGHT ||\n      (this.workspace.horizontalLayout && this.workspace.RTL);\n    this.svgLid?.setAttribute(\n      'transform',\n      'rotate(' +\n        (openAtRight ? -lidAngle : lidAngle) +\n        ',' +\n        (openAtRight ? 4 : WIDTH - 4) +\n        ',' +\n        (LID_HEIGHT - 2) +\n        ')',\n    );\n  }\n\n  /**\n   * Sets the minimum openness of the trashcan lid. If the lid is currently\n   * closed, this will update lid's position.\n   *\n   * @param newMin The new minimum openness of the lid. Should be between 0\n   *     and 1.\n   */\n  private setMinOpenness(newMin: number) {\n    this.minOpenness = newMin;\n    if (!this.isLidOpen) {\n      this.setLidAngle(newMin * MAX_LID_ANGLE);\n    }\n  }\n\n  /**\n   * Flip the lid shut.\n   * Called externally after a drag.\n   */\n  closeLid() {\n    this.setLidOpen(false);\n  }\n\n  /** Inspect the contents of the trash. */\n  click() {\n    if (!this.hasContents() || this.workspace.isDragging()) {\n      return;\n    }\n    this.openFlyout();\n  }\n\n  /**\n   * Fires a UI event for trashcan flyout open or close.\n   *\n   * @param trashcanOpen Whether the flyout is opening.\n   */\n  private fireUiEvent(trashcanOpen: boolean) {\n    const uiEvent = new (eventUtils.get(EventType.TRASHCAN_OPEN))(\n      trashcanOpen,\n      this.workspace.id,\n    );\n    eventUtils.fire(uiEvent);\n  }\n\n  /**\n   * Prevents a workspace scroll and click event if the trashcan has blocks.\n   *\n   * @param e A mouse down event.\n   */\n  private blockMouseDownWhenOpenable(e: PointerEvent) {\n    if (!this.contentsIsOpen() && this.hasContents()) {\n      // Don't start a workspace scroll.\n      e.stopPropagation();\n    }\n  }\n\n  /**\n   * Indicate that the trashcan can be clicked (by opening it) if it has blocks.\n   */\n  private mouseOver() {\n    if (this.hasContents()) {\n      this.setLidOpen(true);\n    }\n  }\n\n  /**\n   * Close the lid of the trashcan if it was open (Vis. it was indicating it had\n   *    blocks).\n   */\n  private mouseOut() {\n    // No need to do a .hasBlocks check here because if it doesn't the trashcan\n    // won't be open in the first place, and setOpen won't run.\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Handle a BLOCK_DELETE event. Adds deleted blocks oldXml to the content\n   * array.\n   *\n   * @param event Workspace event.\n   */\n  private onDelete(event: Abstract) {\n    if (\n      this.workspace.options.maxTrashcanContents <= 0 ||\n      !isBlockDelete(event) ||\n      event.wasShadow\n    ) {\n      return;\n    }\n    if (!event.oldJson) {\n      throw new Error('Encountered a delete event without proper oldJson');\n    }\n    const cleanedJson = JSON.stringify(this.cleanBlockJson(event.oldJson));\n    if (this.contents.includes(cleanedJson)) return;\n    this.contents.unshift(cleanedJson);\n    while (this.contents.length > this.workspace.options.maxTrashcanContents) {\n      this.contents.pop();\n    }\n\n    this.setMinOpenness(HAS_BLOCKS_LID_ANGLE);\n  }\n\n  /**\n   * Converts JSON representing a block into text that can be stored in the\n   * content array.\n   *\n   * @param json A JSON representation of a block's state.\n   * @returns A BlockInfo object corresponding to the JSON, cleaned of all\n   *     unnecessary attributes.\n   */\n  private cleanBlockJson(json: blocks.State): BlockInfo {\n    // Create a deep copy.\n    json = JSON.parse(JSON.stringify(json)) as blocks.State;\n\n    /**\n     * Reshape JSON into a nicer format.\n     *\n     * @param json The JSON to clean.\n     */\n    function cleanRec(json: blocks.State) {\n      if (!json) {\n        return;\n      }\n\n      delete json['id'];\n      delete json['x'];\n      delete json['y'];\n      delete json['enabled'];\n      delete json['disabledReasons'];\n\n      if (json['icons'] && json['icons']['comment']) {\n        const comment = json['icons']['comment'];\n        delete comment['height'];\n        delete comment['width'];\n        delete comment['pinned'];\n      }\n\n      const inputs = json['inputs'];\n      for (const name in inputs) {\n        const input = inputs[name];\n        const block = input['block'];\n        const shadow = input['shadow'];\n        if (block) {\n          cleanRec(block);\n        }\n        if (shadow) {\n          cleanRec(shadow);\n        }\n      }\n      if (json['next']) {\n        const next = json['next'];\n        const block = next['block'];\n        const shadow = next['shadow'];\n        if (block) {\n          cleanRec(block);\n        }\n        if (shadow) {\n          cleanRec(shadow);\n        }\n      }\n    }\n\n    cleanRec(json);\n\n    const blockInfo: BlockInfo = {\n      'kind': 'BLOCK',\n      ...json,\n    };\n    return blockInfo;\n  }\n}\n\n/** Width of both the trash can and lid images. */\nconst WIDTH = 47;\n\n/** Height of the trashcan image (minus lid). */\nconst BODY_HEIGHT = 44;\n\n/** Height of the lid image. */\nconst LID_HEIGHT = 16;\n\n/** Distance between trashcan and bottom or top edge of workspace. */\nconst MARGIN_VERTICAL = 20;\n\n/** Distance between trashcan and right or left edge of workspace. */\nconst MARGIN_HORIZONTAL = 20;\n\n/** Extent of hotspot on all sides beyond the size of the image. */\nconst MARGIN_HOTSPOT = 10;\n\n/** Location of trashcan in sprite image. */\nconst SPRITE_LEFT = 0;\n\n/** Location of trashcan in sprite image. */\nconst SPRITE_TOP = 32;\n\n/**\n * The openness of the lid when the trashcan contains blocks.\n *    (0.0 = closed, 1.0 = open)\n */\nconst HAS_BLOCKS_LID_ANGLE = 0.1;\n\n/** The length of the lid open/close animation in milliseconds. */\nconst ANIMATION_LENGTH = 80;\n\n/** The number of frames in the animation. */\nconst ANIMATION_FRAMES = 4;\n\n/** The minimum (resting) opacity of the trashcan and lid. */\nconst OPACITY_MIN = 0.4;\n\n/** The maximum (hovered) opacity of the trashcan and lid. */\nconst OPACITY_MAX = 0.8;\n\n/**\n * The maximum angle the trashcan lid can opens to. At the end of the open\n * animation the lid will be open to this angle.\n */\nconst MAX_LID_ANGLE = 45;\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The namespace used to keep track of keyboard shortcuts and the\n * key codes used to execute those shortcuts.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ShortcutRegistry\n\nimport {KeyCodes} from './utils/keycodes.js';\nimport * as object from './utils/object.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for the registry of keyboard shortcuts. This is intended to be a\n * singleton. You should not create a new instance, and only access this class\n * from ShortcutRegistry.registry.\n */\nexport class ShortcutRegistry {\n  static readonly registry = new ShortcutRegistry();\n\n  /** Registry of all keyboard shortcuts, keyed by name of shortcut. */\n  private shortcuts = new Map<string, KeyboardShortcut>();\n\n  /** Map of key codes to an array of shortcut names. */\n  private keyMap = new Map<string, string[]>();\n\n  /** Resets the existing ShortcutRegistry singleton. */\n  private constructor() {\n    this.reset();\n  }\n\n  /** Clear and recreate the registry and keyMap. */\n  reset() {\n    this.shortcuts.clear();\n    this.keyMap.clear();\n  }\n\n  /**\n   * Registers a keyboard shortcut.\n   *\n   * @param shortcut The shortcut for this key code.\n   * @param allowOverrides True to prevent a warning when overriding an\n   *     already registered item.\n   * @throws {Error} if a shortcut with the same name already exists.\n   */\n  register(shortcut: KeyboardShortcut, allowOverrides?: boolean) {\n    const registeredShortcut = this.shortcuts.get(shortcut.name);\n    if (registeredShortcut && !allowOverrides) {\n      throw new Error(`Shortcut named \"${shortcut.name}\" already exists.`);\n    }\n    this.shortcuts.set(shortcut.name, shortcut);\n\n    const keyCodes = shortcut.keyCodes;\n    if (keyCodes?.length) {\n      for (const keyCode of keyCodes) {\n        this.addKeyMapping(keyCode, shortcut.name, !!shortcut.allowCollision);\n      }\n    }\n  }\n\n  /**\n   * Unregisters a keyboard shortcut registered with the given name. This\n   * will also remove any key mappings that reference this shortcut.\n   *\n   * @param shortcutName The name of the shortcut to unregister.\n   * @returns True if an item was unregistered, false otherwise.\n   */\n  unregister(shortcutName: string): boolean {\n    const shortcut = this.shortcuts.get(shortcutName);\n\n    if (!shortcut) {\n      console.warn(`Keyboard shortcut named \"${shortcutName}\" not found.`);\n      return false;\n    }\n\n    this.removeAllKeyMappings(shortcutName);\n\n    this.shortcuts.delete(shortcutName);\n    return true;\n  }\n\n  /**\n   * Adds a mapping between a keycode and a keyboard shortcut.\n   *\n   * Normally only one shortcut can be mapped to any given keycode,\n   * but setting allowCollisions to true allows a keyboard to be\n   * mapped to multiple shortcuts.  In that case, when onKeyDown is\n   * called with the given keystroke, it will process the mapped\n   * shortcuts in reverse order, from the most- to least-recently\n   * mapped).\n   *\n   * @param keyCode The key code for the keyboard shortcut. If registering a key\n   *     code with a modifier (ex: ctrl+c) use\n   *     ShortcutRegistry.registry.createSerializedKey;\n   * @param shortcutName The name of the shortcut to execute when the given\n   *     keycode is pressed.\n   * @param allowCollision True to prevent an error when adding a shortcut\n   *     to a key that is already mapped to a shortcut.\n   * @throws {Error} if the given key code is already mapped to a shortcut.\n   */\n  addKeyMapping(\n    keyCode: string | number | KeyCodes,\n    shortcutName: string,\n    allowCollision?: boolean,\n  ) {\n    keyCode = `${keyCode}`;\n    const shortcutNames = this.keyMap.get(keyCode);\n    if (shortcutNames && !allowCollision) {\n      throw new Error(\n        `Shortcut named \"${shortcutName}\" collides with shortcuts \"${shortcutNames}\"`,\n      );\n    } else if (shortcutNames && allowCollision) {\n      shortcutNames.unshift(shortcutName);\n    } else {\n      this.keyMap.set(keyCode, [shortcutName]);\n    }\n  }\n\n  /**\n   * Removes a mapping between a keycode and a keyboard shortcut.\n   *\n   * @param keyCode The key code for the keyboard shortcut. If registering a key\n   *     code with a modifier (ex: ctrl+c) use\n   *     ShortcutRegistry.registry.createSerializedKey;\n   * @param shortcutName The name of the shortcut to execute when the given\n   *     keycode is pressed.\n   * @param quiet True to not console warn when there is no shortcut to\n   *     remove.\n   * @returns True if a key mapping was removed, false otherwise.\n   */\n  removeKeyMapping(\n    keyCode: string,\n    shortcutName: string,\n    quiet?: boolean,\n  ): boolean {\n    const shortcutNames = this.keyMap.get(keyCode);\n\n    if (!shortcutNames) {\n      if (!quiet) {\n        console.warn(\n          `No keyboard shortcut named \"${shortcutName}\" registered with key code \"${keyCode}\"`,\n        );\n      }\n      return false;\n    }\n\n    const shortcutIdx = shortcutNames.indexOf(shortcutName);\n    if (shortcutIdx > -1) {\n      shortcutNames.splice(shortcutIdx, 1);\n      if (shortcutNames.length === 0) {\n        this.keyMap.delete(keyCode);\n      }\n      return true;\n    }\n    if (!quiet) {\n      console.warn(\n        `No keyboard shortcut named \"${shortcutName}\" registered with key code \"${keyCode}\"`,\n      );\n    }\n    return false;\n  }\n\n  /**\n   * Removes all the key mappings for a shortcut with the given name.\n   * Useful when changing the default key mappings and the key codes registered\n   * to the shortcut are unknown.\n   *\n   * @param shortcutName The name of the shortcut to remove from the key map.\n   */\n  removeAllKeyMappings(shortcutName: string) {\n    for (const keyCode of this.keyMap.keys()) {\n      this.removeKeyMapping(keyCode, shortcutName, /* quiet= */ true);\n    }\n  }\n\n  /**\n   * Sets the key map. Setting the key map will override any default key\n   * mappings.\n   *\n   * @param newKeyMap The object with key code to shortcut names.\n   */\n  setKeyMap(newKeyMap: {[key: string]: string[]}) {\n    this.keyMap.clear();\n    for (const key in newKeyMap) {\n      this.keyMap.set(key, newKeyMap[key]);\n    }\n  }\n\n  /**\n   * Gets the current key map.\n   *\n   * @returns The object holding key codes to ShortcutRegistry.KeyboardShortcut.\n   */\n  getKeyMap(): {[key: string]: string[]} {\n    const legacyKeyMap: {[key: string]: string[]} = Object.create(null);\n    for (const [key, value] of this.keyMap) {\n      legacyKeyMap[key] = value;\n    }\n    return legacyKeyMap;\n  }\n\n  /**\n   * Gets the registry of keyboard shortcuts.\n   *\n   * @returns The registry of keyboard shortcuts.\n   */\n  getRegistry(): {[key: string]: KeyboardShortcut} {\n    const legacyRegistry: {[key: string]: KeyboardShortcut} =\n      Object.create(null);\n    for (const [key, value] of this.shortcuts) {\n      legacyRegistry[key] = value;\n    }\n    return object.deepMerge(Object.create(null), legacyRegistry);\n  }\n\n  /**\n   * Handles key down events.\n   *\n   * - Any `KeyboardShortcut`(s) mapped to the keycodes that cause\n   *   event `e` to be fired will be processed, in order from least-\n   *   to most-recently registered.\n   * - If the shortcut's `preconditionFn` exists it will be called.\n   *   If `preconditionFn` returns false the shortcut's `callback`\n   *   function will be skipped.  Processing will continue with the\n   *   next shortcut, if any.\n   * - The shortcut's `callback` function will then be called.  If it\n   *   returns true, processing will terminate and `onKeyDown` will\n   *   return true.  If it returns false, processing will continue\n   *   with with the next shortcut, if any.\n   * - If all registered shortcuts for the given keycode have been\n   *   processed without any having returned true, `onKeyDown` will\n   *   return false.\n   *\n   * @param workspace The main workspace where the event was captured.\n   * @param e The key down event.\n   * @returns True if the event was handled, false otherwise.\n   */\n  onKeyDown(workspace: WorkspaceSvg, e: KeyboardEvent): boolean {\n    const key = this.serializeKeyEvent(e);\n    const shortcutNames = this.getShortcutNamesByKeyCode(key);\n    if (!shortcutNames) return false;\n    for (const shortcutName of shortcutNames) {\n      const shortcut = this.shortcuts.get(shortcutName);\n      if (\n        !shortcut ||\n        (shortcut.preconditionFn && !shortcut.preconditionFn(workspace))\n      ) {\n        continue;\n      }\n      // If the key has been handled, stop processing shortcuts.\n      if (shortcut.callback?.(workspace, e, shortcut)) return true;\n    }\n    return false;\n  }\n\n  /**\n   * Gets the shortcuts registered to the given key code.\n   *\n   * @param keyCode The serialized key code.\n   * @returns The list of shortcuts to call when the given keyCode is used.\n   *     Undefined if no shortcuts exist.\n   */\n  getShortcutNamesByKeyCode(keyCode: string): string[] | undefined {\n    return this.keyMap.get(keyCode) || [];\n  }\n\n  /**\n   * Gets the serialized key codes that the shortcut with the given name is\n   * registered under.\n   *\n   * @param shortcutName The name of the shortcut.\n   * @returns An array with all the key codes the shortcut is registered under.\n   */\n  getKeyCodesByShortcutName(shortcutName: string): string[] {\n    const keys = [];\n    for (const [keyCode, shortcuts] of this.keyMap) {\n      const shortcutIdx = shortcuts.indexOf(shortcutName);\n      if (shortcutIdx > -1) {\n        keys.push(keyCode);\n      }\n    }\n    return keys;\n  }\n\n  /**\n   * Serializes a key event.\n   *\n   * @param e A key down event.\n   * @returns The serialized key code for the given event.\n   */\n  private serializeKeyEvent(e: KeyboardEvent): string {\n    let serializedKey = '';\n    for (const modifier in ShortcutRegistry.modifierKeys) {\n      if (e.getModifierState(modifier)) {\n        if (serializedKey !== '') {\n          serializedKey += '+';\n        }\n        serializedKey += modifier;\n      }\n    }\n    if (serializedKey !== '' && e.keyCode) {\n      serializedKey += '+' + e.keyCode;\n    } else if (e.keyCode) {\n      serializedKey = String(e.keyCode);\n    }\n    return serializedKey;\n  }\n\n  /**\n   * Checks whether any of the given modifiers are not valid.\n   *\n   * @param modifiers List of modifiers to be used with the key.\n   * @throws {Error} if the modifier is not in the valid modifiers list.\n   */\n  private checkModifiers(modifiers: KeyCodes[]) {\n    for (const modifier of modifiers) {\n      if (!(modifier in ShortcutRegistry.modifierKeys)) {\n        throw new Error(modifier + ' is not a valid modifier key.');\n      }\n    }\n  }\n\n  /**\n   * Creates the serialized key code that will be used in the key map.\n   *\n   * @param keyCode Number code representing the key.\n   * @param modifiers List of modifier key codes to be used with the key. All\n   *     valid modifiers can be found in the `ShortcutRegistry.modifierKeys`.\n   * @returns The serialized key code for the given modifiers and key.\n   */\n  createSerializedKey(keyCode: number, modifiers: KeyCodes[] | null): string {\n    let serializedKey = '';\n\n    if (modifiers) {\n      this.checkModifiers(modifiers);\n      for (const modifier in ShortcutRegistry.modifierKeys) {\n        const modifierKeyCode = (\n          ShortcutRegistry.modifierKeys as AnyDuringMigration\n        )[modifier];\n        if (modifiers.includes(modifierKeyCode)) {\n          if (serializedKey !== '') {\n            serializedKey += '+';\n          }\n          serializedKey += modifier;\n        }\n      }\n    }\n\n    if (serializedKey !== '' && keyCode) {\n      serializedKey += '+' + keyCode;\n    } else if (keyCode) {\n      serializedKey = `${keyCode}`;\n    }\n    return serializedKey;\n  }\n}\n\nexport namespace ShortcutRegistry {\n  /** Interface defining a keyboard shortcut. */\n  export interface KeyboardShortcut {\n    /**\n     * The function to be called when the shorctut is invoked.\n     *\n     * @param workspace The `WorkspaceSvg` when the shortcut was\n     *     invoked.\n     * @param e The event that caused the shortcut to be activated.\n     * @param shortcut The `KeyboardShortcut` that was activated\n     *     (i.e., the one this callback is attached to).\n     * @returns Returning true ends processing of the invoked keycode.\n     *     Returning false causes processing to continue with the\n     *     next-most-recently registered shortcut for the invoked\n     *     keycode.\n     */\n    callback?: (\n      workspace: WorkspaceSvg,\n      e: Event,\n      shortcut: KeyboardShortcut,\n    ) => boolean;\n\n    /** The name of the shortcut.  Should be unique. */\n    name: string;\n\n    /**\n     * A function to be called when the shortcut is invoked, before\n     * calling `callback`, to decide if this shortcut is applicable in\n     * the current situation.\n     *\n     * @param workspace The `WorkspaceSvg` where the shortcut was\n     *     invoked.\n     * @returns True iff `callback` function should be called.\n     */\n    preconditionFn?: (workspace: WorkspaceSvg) => boolean;\n\n    /** Optional arbitray extra data attached to the shortcut. */\n    metadata?: object;\n\n    /**\n     * Optional list of key codes to be bound (via\n     * ShortcutRegistry.prototype.addKeyMapping) to this shortcut.\n     */\n    keyCodes?: (number | string)[];\n\n    /**\n     * Value of `allowCollision` to pass to `addKeyMapping` when\n     * binding this shortcut's `.keyCodes` (if any).\n     *\n     * N.B.: this is only used for binding keycodes at the time this\n     * shortcut is initially registered, not for any subsequent\n     * `addKeyMapping` calls that happen to reference this shortcut's\n     * name.\n     */\n    allowCollision?: boolean;\n  }\n\n  /** Supported modifiers. */\n  export enum modifierKeys {\n    Shift = KeyCodes.SHIFT,\n    Control = KeyCodes.CTRL,\n    Alt = KeyCodes.ALT,\n    Meta = KeyCodes.META,\n  }\n}\n\nexport type KeyboardShortcut = ShortcutRegistry.KeyboardShortcut;\n// No need to export ShorcutRegistry.modifierKeys from the module at this time\n// because (1) it wasn't automatically converted by the automatic migration\n// script, (2) the name doesn't follow the styleguide.\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.variables\n\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport type {Workspace} from '../workspace.js';\nimport * as priorities from './priorities.js';\nimport * as serializationRegistry from './registry.js';\n\n/**\n * Represents the state of a given variable.\n */\nexport interface State {\n  name: string;\n  id: string;\n  type: string | undefined;\n}\n\n/**\n * Serializer for saving and loading variable state.\n */\nexport class VariableSerializer implements ISerializer {\n  priority: number;\n\n  constructor() {\n    /** The priority for deserializing variables. */\n    this.priority = priorities.VARIABLES;\n  }\n\n  /**\n   * Serializes the variables of the given workspace.\n   *\n   * @param workspace The workspace to save the variables of.\n   * @returns The state of the workspace's variables, or null if there are no\n   *     variables.\n   */\n  save(workspace: Workspace): State[] | null {\n    const variableStates = [];\n    for (const variable of workspace.getAllVariables()) {\n      const state = {\n        'name': variable.name,\n        'id': variable.getId(),\n      };\n      if (variable.type) {\n        (state as AnyDuringMigration)['type'] = variable.type;\n      }\n      variableStates.push(state);\n    }\n    // AnyDuringMigration because:  Type '{ name: string; id: string; }[] |\n    // null' is not assignable to type 'State[] | null'.\n    return (\n      variableStates.length ? variableStates : null\n    ) as AnyDuringMigration;\n  }\n\n  /**\n   * Deserializes the variable defined by the given state into the given\n   * workspace.\n   *\n   * @param state The state of the variables to deserialize.\n   * @param workspace The workspace to deserialize into.\n   */\n  load(state: State[], workspace: Workspace) {\n    for (const varState of state) {\n      workspace.createVariable(\n        varState['name'],\n        varState['type'],\n        varState['id'],\n      );\n    }\n  }\n\n  /**\n   * Disposes of any variables that exist on the workspace.\n   *\n   * @param workspace The workspace to clear the variables of.\n   */\n  clear(workspace: Workspace) {\n    workspace.getVariableMap().clear();\n  }\n}\n\nserializationRegistry.register('variables', new VariableSerializer());\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Serialization methods.\n */\n// Former goog.module ID: Blockly.serialization\n\nimport {ISerializer} from './interfaces/i_serializer.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as exceptions from './serialization/exceptions.js';\nimport * as priorities from './serialization/priorities.js';\nimport * as procedures from './serialization/procedures.js';\nimport * as registry from './serialization/registry.js';\nimport * as variables from './serialization/variables.js';\nimport * as workspaceComments from './serialization/workspace_comments.js';\nimport * as workspaces from './serialization/workspaces.js';\n\nexport {\n  blocks,\n  exceptions,\n  ISerializer,\n  priorities,\n  procedures,\n  registry,\n  variables,\n  workspaceComments,\n  workspaces,\n};\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a pair of scrollbars.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ScrollbarPair\n\nimport * as eventUtils from './events/utils.js';\nimport {Scrollbar} from './scrollbar.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Svg} from './utils/svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Class for a pair of scrollbars.  Horizontal and vertical.\n */\nexport class ScrollbarPair {\n  hScroll: Scrollbar | null = null;\n  vScroll: Scrollbar | null = null;\n  corner_: SVGRectElement | null = null;\n\n  /** Previously recorded metrics from the workspace. */\n  private oldHostMetrics: Metrics | null = null;\n\n  /**\n   * @param workspace Workspace to bind the scrollbars to.\n   * @param addHorizontal Whether to add a horizontal scrollbar.\n   *    Defaults to true.\n   * @param addVertical Whether to add a vertical scrollbar. Defaults to true.\n   * @param opt_class A class to be applied to these scrollbars.\n   * @param opt_margin The margin to apply to these scrollbars.\n   */\n  constructor(\n    private workspace: WorkspaceSvg,\n    addHorizontal?: boolean,\n    addVertical?: boolean,\n    opt_class?: string,\n    opt_margin?: number,\n  ) {\n    addHorizontal = addHorizontal === undefined ? true : addHorizontal;\n    addVertical = addVertical === undefined ? true : addVertical;\n    const isPair = addHorizontal && addVertical;\n\n    if (addHorizontal) {\n      this.hScroll = new Scrollbar(\n        workspace,\n        true,\n        isPair,\n        opt_class,\n        opt_margin,\n      );\n    }\n    if (addVertical) {\n      this.vScroll = new Scrollbar(\n        workspace,\n        false,\n        isPair,\n        opt_class,\n        opt_margin,\n      );\n    }\n\n    if (isPair) {\n      this.corner_ = dom.createSvgElement(Svg.RECT, {\n        'height': Scrollbar.scrollbarThickness,\n        'width': Scrollbar.scrollbarThickness,\n        'class': 'blocklyScrollbarBackground',\n      });\n      dom.insertAfter(this.corner_, workspace.getBubbleCanvas());\n    }\n  }\n\n  /**\n   * Dispose of this pair of scrollbars.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    dom.removeNode(this.corner_);\n    this.corner_ = null;\n    this.oldHostMetrics = null;\n    if (this.hScroll) {\n      this.hScroll.dispose();\n      this.hScroll = null;\n    }\n    if (this.vScroll) {\n      this.vScroll.dispose();\n      this.vScroll = null;\n    }\n  }\n\n  /**\n   * Recalculate both of the scrollbars' locations and lengths.\n   * Also reposition the corner rectangle.\n   */\n  resize() {\n    // Look up the host metrics once, and use for both scrollbars.\n    const hostMetrics = this.workspace.getMetrics();\n    if (!hostMetrics) {\n      // Host element is likely not visible.\n      return;\n    }\n\n    // Only change the scrollbars if there has been a change in metrics.\n    let resizeH = false;\n    let resizeV = false;\n    if (\n      !this.oldHostMetrics ||\n      this.oldHostMetrics.viewWidth !== hostMetrics.viewWidth ||\n      this.oldHostMetrics.viewHeight !== hostMetrics.viewHeight ||\n      this.oldHostMetrics.absoluteTop !== hostMetrics.absoluteTop ||\n      this.oldHostMetrics.absoluteLeft !== hostMetrics.absoluteLeft\n    ) {\n      // The window has been resized or repositioned.\n      resizeH = true;\n      resizeV = true;\n    } else {\n      // Has the content been resized or moved?\n      if (\n        !this.oldHostMetrics ||\n        this.oldHostMetrics.scrollWidth !== hostMetrics.scrollWidth ||\n        this.oldHostMetrics.viewLeft !== hostMetrics.viewLeft ||\n        this.oldHostMetrics.scrollLeft !== hostMetrics.scrollLeft\n      ) {\n        resizeH = true;\n      }\n      if (\n        !this.oldHostMetrics ||\n        this.oldHostMetrics.scrollHeight !== hostMetrics.scrollHeight ||\n        this.oldHostMetrics.viewTop !== hostMetrics.viewTop ||\n        this.oldHostMetrics.scrollTop !== hostMetrics.scrollTop\n      ) {\n        resizeV = true;\n      }\n    }\n\n    if (resizeH || resizeV) {\n      try {\n        eventUtils.disable();\n        if (this.hScroll && resizeH) {\n          this.hScroll.resize(hostMetrics);\n        }\n        if (this.vScroll && resizeV) {\n          this.vScroll.resize(hostMetrics);\n        }\n      } finally {\n        eventUtils.enable();\n      }\n      this.workspace.maybeFireViewportChangeEvent();\n    }\n\n    if (this.hScroll && this.vScroll) {\n      // Reposition the corner square.\n      if (\n        !this.oldHostMetrics ||\n        this.oldHostMetrics.viewWidth !== hostMetrics.viewWidth ||\n        this.oldHostMetrics.absoluteLeft !== hostMetrics.absoluteLeft\n      ) {\n        this.corner_?.setAttribute('x', String(this.vScroll.position.x));\n      }\n      if (\n        !this.oldHostMetrics ||\n        this.oldHostMetrics.viewHeight !== hostMetrics.viewHeight ||\n        this.oldHostMetrics.absoluteTop !== hostMetrics.absoluteTop\n      ) {\n        this.corner_?.setAttribute('y', String(this.hScroll.position.y));\n      }\n    }\n\n    // Cache the current metrics to potentially short-cut the next resize event.\n    this.oldHostMetrics = hostMetrics;\n  }\n\n  /**\n   * Returns whether scrolling horizontally is enabled.\n   *\n   * @returns True if horizontal scroll is enabled.\n   */\n  canScrollHorizontally(): boolean {\n    return !!this.hScroll;\n  }\n\n  /**\n   * Returns whether scrolling vertically is enabled.\n   *\n   * @returns True if vertical scroll is enabled.\n   */\n  canScrollVertically(): boolean {\n    return !!this.vScroll;\n  }\n\n  /**\n   * Record the origin of the workspace that the scrollbar is in, in pixels\n   * relative to the injection div origin. This is for times when the scrollbar\n   * is used in an object whose origin isn't the same as the main workspace\n   * (e.g. in a flyout.)\n   *\n   * @param x The x coordinate of the scrollbar's origin, in CSS pixels.\n   * @param y The y coordinate of the scrollbar's origin, in CSS pixels.\n   * @internal\n   */\n  setOrigin(x: number, y: number) {\n    if (this.hScroll) {\n      this.hScroll.setOrigin(x, y);\n    }\n    if (this.vScroll) {\n      this.vScroll.setOrigin(x, y);\n    }\n  }\n\n  /**\n   * Set the handles of both scrollbars.\n   *\n   * @param x The horizontal content displacement, relative to the view in\n   *     pixels.\n   * @param y The vertical content displacement, relative to the view in pixels.\n   * @param updateMetrics Whether to update metrics on this set call.\n   *    Defaults to true.\n   */\n  set(x: number, y: number, updateMetrics: boolean) {\n    // This function is equivalent to:\n    //   this.hScroll.set(x);\n    //   this.vScroll.set(y);\n    // However, that calls setMetrics twice which causes a chain of\n    // getAttribute->setAttribute->getAttribute resulting in an extra layout\n    // pass. Combining them speeds up rendering.\n    if (this.hScroll) {\n      this.hScroll.set(x, false);\n    }\n    if (this.vScroll) {\n      this.vScroll.set(y, false);\n    }\n\n    if (updateMetrics || updateMetrics === undefined) {\n      // Update metrics.\n      const xyRatio: {x?: number; y?: number} = {};\n      if (this.hScroll) {\n        xyRatio.x = this.hScroll.getRatio_();\n      }\n      if (this.vScroll) {\n        xyRatio.y = this.vScroll.getRatio_();\n      }\n      this.workspace.setMetrics(xyRatio);\n    }\n  }\n\n  /**\n   * Set the handle of the horizontal scrollbar to be at a certain position in\n   *    CSS pixels relative to its parents.\n   *\n   * @param x Horizontal scroll value.\n   */\n  setX(x: number) {\n    if (this.hScroll) {\n      this.hScroll.set(x, true);\n    }\n  }\n\n  /**\n   * Set the handle of the vertical scrollbar to be at a certain position in\n   *    CSS pixels relative to its parents.\n   *\n   * @param y Vertical scroll value.\n   */\n  setY(y: number) {\n    if (this.vScroll) {\n      this.vScroll.set(y, true);\n    }\n  }\n\n  /**\n   * Set whether this scrollbar's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean) {\n    if (this.hScroll) {\n      this.hScroll.setContainerVisible(visible);\n    }\n    if (this.vScroll) {\n      this.vScroll.setContainerVisible(visible);\n    }\n  }\n\n  /**\n   * If any of the scrollbars are visible. Non-paired scrollbars may disappear\n   * when they aren't needed.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    let isVisible = false;\n    if (this.hScroll) {\n      isVisible = this.hScroll.isVisible();\n    }\n    if (this.vScroll) {\n      isVisible = isVisible || this.vScroll.isVisible();\n    }\n    return isVisible;\n  }\n\n  /**\n   * Sets the visibility of any existing scrollbars.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    if (this.hScroll) this.hScroll.setVisibleInternal(visible);\n    if (this.vScroll) this.vScroll.setVisibleInternal(visible);\n  }\n\n  /**\n   * Recalculates the scrollbars' locations within their path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContent(hostMetrics: Metrics) {\n    if (this.hScroll) {\n      this.hScroll.resizeContentHorizontal(hostMetrics);\n    }\n    if (this.vScroll) {\n      this.vScroll.resizeContentVertical(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculates the scrollbars' locations on the screen and path length.\n   * This should be called when the layout or size of the window has changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeView(hostMetrics: Metrics) {\n    if (this.hScroll) {\n      this.hScroll.resizeViewHorizontal(hostMetrics);\n    }\n    if (this.vScroll) {\n      this.vScroll.resizeViewVertical(hostMetrics);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Calculates and reports workspace metrics.\n *\n * @class\n */\n// Former goog.module ID: Blockly.MetricsManager\n\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport * as registry from './registry.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Size} from './utils/size.js';\nimport * as toolboxUtils from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * The manager for all workspace metrics calculations.\n */\nexport class MetricsManager implements IMetricsManager {\n  /** The workspace to calculate metrics for. */\n  protected readonly workspace_: WorkspaceSvg;\n\n  /** @param workspace The workspace to calculate metrics for. */\n  constructor(workspace: WorkspaceSvg) {\n    this.workspace_ = workspace;\n  }\n\n  /**\n   * Gets the dimensions of the given workspace component, in pixel coordinates.\n   *\n   * @param elem The element to get the dimensions of, or null.  It should be a\n   *     toolbox or flyout, and should implement getWidth() and getHeight().\n   * @returns An object containing width and height attributes, which will both\n   *     be zero if elem did not exist.\n   */\n  protected getDimensionsPx_(elem: IToolbox | null | IFlyout): Size {\n    let width = 0;\n    let height = 0;\n    if (elem) {\n      width = elem.getWidth();\n      height = elem.getHeight();\n    }\n    return new Size(width, height);\n  }\n\n  /**\n   * Gets the width and the height of the flyout in pixel\n   * coordinates. By default, will get metrics for either a simple flyout (owned\n   * directly by the workspace) or for the flyout owned by the toolbox. If you\n   * pass `opt_own` as `true` then only metrics for the simple flyout will be\n   * returned, and it will return 0 for the width and height if the workspace\n   * has a category toolbox instead of a simple toolbox.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout metrics.\n   * @returns The width and height of the flyout.\n   */\n  getFlyoutMetrics(opt_own?: boolean): ToolboxMetrics {\n    const flyoutDimensions = this.getDimensionsPx_(\n      this.workspace_.getFlyout(opt_own),\n    );\n    return {\n      width: flyoutDimensions.width,\n      height: flyoutDimensions.height,\n      position: this.workspace_.toolboxPosition,\n    };\n  }\n\n  /**\n   * Gets the width, height and position of the toolbox on the workspace in\n   * pixel coordinates. Returns 0 for the width and height if the workspace has\n   * a simple toolbox instead of a category toolbox. To get the width and height\n   * of a simple toolbox, see {@link MetricsManager#getFlyoutMetrics}.\n   *\n   * @returns The object with the width, height and position of the toolbox.\n   */\n  getToolboxMetrics(): ToolboxMetrics {\n    const toolboxDimensions = this.getDimensionsPx_(\n      this.workspace_.getToolbox(),\n    );\n\n    return {\n      width: toolboxDimensions.width,\n      height: toolboxDimensions.height,\n      position: this.workspace_.toolboxPosition,\n    };\n  }\n\n  /**\n   * Gets the width and height of the workspace's parent SVG element in pixel\n   * coordinates. This area includes the toolbox and the visible workspace area.\n   *\n   * @returns The width and height of the workspace's parent SVG element.\n   */\n  getSvgMetrics(): Size {\n    return this.workspace_.getCachedParentSvgSize();\n  }\n\n  /**\n   * Gets the absolute left and absolute top in pixel coordinates.\n   * This is where the visible workspace starts in relation to the SVG\n   * container.\n   *\n   * @returns The absolute metrics for the workspace.\n   */\n  getAbsoluteMetrics(): AbsoluteMetrics {\n    let absoluteLeft = 0;\n    let absoluteTop = 0;\n\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics();\n    const respectToolbox = !!this.workspace_.getToolbox();\n    const respectFlyout = !this.workspace_.getFlyout()?.autoClose;\n    const toolboxPosition = respectToolbox\n      ? toolboxMetrics.position\n      : flyoutMetrics.position;\n\n    const atLeft = toolboxPosition === toolboxUtils.Position.LEFT;\n    const atTop = toolboxPosition === toolboxUtils.Position.TOP;\n    if (atLeft) {\n      if (respectToolbox) absoluteLeft += toolboxMetrics.width;\n      if (respectFlyout) absoluteLeft += flyoutMetrics.width;\n    }\n    if (atTop) {\n      if (respectToolbox) absoluteTop += toolboxMetrics.height;\n      if (respectFlyout) absoluteTop += flyoutMetrics.height;\n    }\n\n    return {\n      top: absoluteTop,\n      left: absoluteLeft,\n    };\n  }\n\n  /**\n   * Gets the metrics for the visible workspace in either pixel or workspace\n   * coordinates. The visible workspace does not include the toolbox or flyout.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the view metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The width, height, top and left of the viewport in either\n   *     workspace coordinates or pixel coordinates.\n   */\n  getViewMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n    const svgMetrics = this.getSvgMetrics();\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics();\n    const respectToolbox = !!this.workspace_.getToolbox();\n    const respectFlyout = !this.workspace_.getFlyout()?.autoClose;\n    const toolboxPosition = respectToolbox\n      ? toolboxMetrics.position\n      : flyoutMetrics.position;\n\n    const horizToolbox =\n      toolboxPosition === toolboxUtils.Position.TOP ||\n      toolboxPosition === toolboxUtils.Position.BOTTOM;\n    const vertToolbox =\n      toolboxPosition === toolboxUtils.Position.LEFT ||\n      toolboxPosition === toolboxUtils.Position.RIGHT;\n    if (horizToolbox) {\n      if (respectToolbox) svgMetrics.height -= toolboxMetrics.height;\n      if (respectFlyout) svgMetrics.height -= flyoutMetrics.height;\n    }\n    if (vertToolbox) {\n      if (respectToolbox) svgMetrics.width -= toolboxMetrics.width;\n      if (respectFlyout) svgMetrics.width -= flyoutMetrics.width;\n    }\n    return {\n      height: svgMetrics.height / scale,\n      width: svgMetrics.width / scale,\n      top: -this.workspace_.scrollY / scale,\n      left: -this.workspace_.scrollX / scale,\n    };\n  }\n\n  /**\n   * Gets content metrics in either pixel or workspace coordinates.\n   * The content area is a rectangle around all the top bounded elements on the\n   * workspace (workspace comments and blocks).\n   *\n   * @param opt_getWorkspaceCoordinates True to get the content metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The metrics for the content container.\n   */\n  getContentMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? 1 : this.workspace_.scale;\n    // Block bounding box is in workspace coordinates.\n    const blockBox = this.workspace_.getBlocksBoundingBox();\n\n    return {\n      height: (blockBox.bottom - blockBox.top) * scale,\n      width: (blockBox.right - blockBox.left) * scale,\n      top: blockBox.top * scale,\n      left: blockBox.left * scale,\n    };\n  }\n\n  /**\n   * Returns whether the scroll area has fixed edges.\n   *\n   * @returns Whether the scroll area has fixed edges.\n   * @internal\n   */\n  hasFixedEdges(): boolean {\n    // This exists for optimization of bump logic.\n    return (\n      !this.workspace_.isMovableHorizontally() ||\n      !this.workspace_.isMovableVertically()\n    );\n  }\n\n  /**\n   * Computes the fixed edges of the scroll area.\n   *\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @returns The fixed edges of the scroll area.\n   */\n  protected getComputedFixedEdges_(\n    opt_viewMetrics?: ContainerRegion,\n  ): FixedEdges {\n    if (!this.hasFixedEdges()) {\n      // Return early if there are no edges.\n      return {};\n    }\n\n    const hScrollEnabled = this.workspace_.isMovableHorizontally();\n    const vScrollEnabled = this.workspace_.isMovableVertically();\n\n    const viewMetrics = opt_viewMetrics || this.getViewMetrics(false);\n\n    const edges = {} as FixedEdges;\n    if (!vScrollEnabled) {\n      edges.top = viewMetrics.top;\n      edges.bottom = viewMetrics.top + viewMetrics.height;\n    }\n    if (!hScrollEnabled) {\n      edges.left = viewMetrics.left;\n      edges.right = viewMetrics.left + viewMetrics.width;\n    }\n    return edges;\n  }\n\n  /**\n   * Returns the content area with added padding.\n   *\n   * @param viewMetrics The view metrics.\n   * @param contentMetrics The content metrics.\n   * @returns The padded content area.\n   */\n  protected getPaddedContent_(\n    viewMetrics: ContainerRegion,\n    contentMetrics: ContainerRegion,\n  ): {top: number; bottom: number; left: number; right: number} {\n    const contentBottom = contentMetrics.top + contentMetrics.height;\n    const contentRight = contentMetrics.left + contentMetrics.width;\n\n    const viewWidth = viewMetrics.width;\n    const viewHeight = viewMetrics.height;\n    const halfWidth = viewWidth / 2;\n    const halfHeight = viewHeight / 2;\n\n    // Add a padding around the content that is at least half a screen wide.\n    // Ensure padding is wide enough that blocks can scroll over entire screen.\n    const top = Math.min(\n      contentMetrics.top - halfHeight,\n      contentBottom - viewHeight,\n    );\n    const left = Math.min(\n      contentMetrics.left - halfWidth,\n      contentRight - viewWidth,\n    );\n    const bottom = Math.max(\n      contentBottom + halfHeight,\n      contentMetrics.top + viewHeight,\n    );\n    const right = Math.max(\n      contentRight + halfWidth,\n      contentMetrics.left + viewWidth,\n    );\n\n    return {top, bottom, left, right};\n  }\n\n  /**\n   * Returns the metrics for the scroll area of the workspace.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the scroll metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @param opt_contentMetrics The content metrics if they have been previously\n   *     computed. Passing in null may cause the content metrics to be computed\n   *     again, if it is needed.\n   * @returns The metrics for the scroll container.\n   */\n  getScrollMetrics(\n    opt_getWorkspaceCoordinates?: boolean,\n    opt_viewMetrics?: ContainerRegion,\n    opt_contentMetrics?: ContainerRegion,\n  ): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n    const viewMetrics = opt_viewMetrics || this.getViewMetrics(false);\n    const contentMetrics = opt_contentMetrics || this.getContentMetrics();\n    const fixedEdges = this.getComputedFixedEdges_(viewMetrics);\n\n    // Add padding around content.\n    const paddedContent = this.getPaddedContent_(viewMetrics, contentMetrics);\n\n    // Use combination of fixed bounds and padded content to make scroll area.\n    const top =\n      fixedEdges.top !== undefined ? fixedEdges.top : paddedContent.top;\n    const left =\n      fixedEdges.left !== undefined ? fixedEdges.left : paddedContent.left;\n    const bottom =\n      fixedEdges.bottom !== undefined\n        ? fixedEdges.bottom\n        : paddedContent.bottom;\n    const right =\n      fixedEdges.right !== undefined ? fixedEdges.right : paddedContent.right;\n\n    return {\n      top: top / scale,\n      left: left / scale,\n      width: (right - left) / scale,\n      height: (bottom - top) / scale,\n    };\n  }\n\n  /**\n   * Returns common metrics used by UI elements.\n   *\n   * @returns The UI metrics.\n   */\n  getUiMetrics(): UiMetrics {\n    return {\n      viewMetrics: this.getViewMetrics(),\n      absoluteMetrics: this.getAbsoluteMetrics(),\n      toolboxMetrics: this.getToolboxMetrics(),\n    };\n  }\n\n  /**\n   * Returns an object with all the metrics required to size scrollbars for a\n   * top level workspace.  The following properties are computed:\n   * Coordinate system: pixel coordinates, -left, -up, +right, +down\n   * .viewHeight: Height of the visible portion of the workspace.\n   * .viewWidth: Width of the visible portion of the workspace.\n   * .contentHeight: Height of the content.\n   * .contentWidth: Width of the content.\n   * .scrollHeight: Height of the scroll area.\n   * .scrollWidth: Width of the scroll area.\n   * .svgHeight: Height of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .svgWidth: Width of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .viewTop: Top-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .viewLeft: Left-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .contentTop: Top-edge of the content, relative to the workspace origin.\n   * .contentLeft: Left-edge of the content relative to the workspace origin.\n   * .scrollTop: Top-edge of the scroll area, relative to the workspace origin.\n   * .scrollLeft: Left-edge of the scroll area relative to the workspace origin.\n   * .absoluteTop: Top-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .absoluteLeft: Left-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .toolboxWidth: Width of the toolbox, if it exists.  Otherwise zero.\n   * .toolboxHeight: Height of the toolbox, if it exists.  Otherwise zero.\n   * .flyoutWidth: Width of the flyout if it is always open.  Otherwise zero.\n   * .flyoutHeight: Height of the flyout if it is always open.  Otherwise zero.\n   * .toolboxPosition: Top, bottom, left or right. Use TOOLBOX_AT constants to\n   *     compare.\n   *\n   * @returns Contains size and position metrics of a top level workspace.\n   */\n  getMetrics(): Metrics {\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics(true);\n    const svgMetrics = this.getSvgMetrics();\n    const absoluteMetrics = this.getAbsoluteMetrics();\n    const viewMetrics = this.getViewMetrics();\n    const contentMetrics = this.getContentMetrics();\n    const scrollMetrics = this.getScrollMetrics(\n      false,\n      viewMetrics,\n      contentMetrics,\n    );\n\n    return {\n      contentHeight: contentMetrics.height,\n      contentWidth: contentMetrics.width,\n      contentTop: contentMetrics.top,\n      contentLeft: contentMetrics.left,\n\n      scrollHeight: scrollMetrics.height,\n      scrollWidth: scrollMetrics.width,\n      scrollTop: scrollMetrics.top,\n      scrollLeft: scrollMetrics.left,\n\n      viewHeight: viewMetrics.height,\n      viewWidth: viewMetrics.width,\n      viewTop: viewMetrics.top,\n      viewLeft: viewMetrics.left,\n\n      absoluteTop: absoluteMetrics.top,\n      absoluteLeft: absoluteMetrics.left,\n\n      svgHeight: svgMetrics.height,\n      svgWidth: svgMetrics.width,\n\n      toolboxWidth: toolboxMetrics.width,\n      toolboxHeight: toolboxMetrics.height,\n      toolboxPosition: toolboxMetrics.position,\n\n      flyoutWidth: flyoutMetrics.width,\n      flyoutHeight: flyoutMetrics.height,\n    };\n  }\n}\n\nexport namespace MetricsManager {\n  /**\n   * Describes the width, height and location of the toolbox on the main\n   * workspace.\n   */\n  export interface ToolboxMetrics {\n    width: number;\n    height: number;\n    position: toolboxUtils.Position;\n  }\n\n  /** Describes where the viewport starts in relation to the workspace SVG. */\n  export interface AbsoluteMetrics {\n    left: number;\n    top: number;\n  }\n\n  /**\n   * All the measurements needed to describe the size and location of a\n   * container.\n   */\n  export interface ContainerRegion {\n    height: number;\n    width: number;\n    top: number;\n    left: number;\n  }\n\n  /** Describes fixed edges of the workspace. */\n  export interface FixedEdges {\n    top?: number;\n    bottom?: number;\n    left?: number;\n    right?: number;\n  }\n\n  /** Common metrics used for UI elements. */\n  export interface UiMetrics {\n    viewMetrics: ContainerRegion;\n    absoluteMetrics: AbsoluteMetrics;\n    toolboxMetrics: ToolboxMetrics;\n  }\n}\n\nexport type ToolboxMetrics = MetricsManager.ToolboxMetrics;\nexport type AbsoluteMetrics = MetricsManager.AbsoluteMetrics;\nexport type ContainerRegion = MetricsManager.ContainerRegion;\nexport type FixedEdges = MetricsManager.FixedEdges;\nexport type UiMetrics = MetricsManager.UiMetrics;\n\nregistry.register(\n  registry.Type.METRICS_MANAGER,\n  registry.DEFAULT,\n  MetricsManager,\n);\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @file The entrypoint for blockly_compressed.js.  Provides various\n * backwards-compatibility hacks.  Not used when loading in\n * uncompressed mode.\n */\n\n// Former goog.module ID: Blockly.main\n\nimport * as Msg from './msg.js';\n\n// If Blockly is compiled with ADVANCED_COMPILATION and/or loaded as a\n// CJS or ES module there will not be a Blockly global variable\n// created.  This can cause problems because a very common way of\n// loading translations is to use a <script> tag to load one of\n// the generated msg/*.js files, which consists of lines like:\n//\n// Blockly.Msg[\"ADD_COMMENT\"] = \"Add Comment\";\n// Blockly.Msg[\"CLEAN_UP\"] = \"Clean up Blocks\";\n//\n// This obviously only works if Blockly.Msg is the Msg export from the\n// Blockly.Msg module - so make sure it is, but only if there is not\n// yet a Blockly global variable.\nif (!('Blockly' in globalThis)) {\n  (globalThis as any)['Blockly'] = {'Msg': Msg};\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.ConstantProvider\n\nimport {ConnectionType} from '../../connection_type.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {Theme} from '../../theme.js';\nimport * as utilsColour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {Shape} from '../common/constants.js';\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\n\n/** An object containing sizing and path information about inside corners. */\nexport interface InsideCorners {\n  width: number;\n  height: number;\n  pathTop: string;\n  pathBottom: string;\n  rightWidth: number;\n  rightHeight: number;\n  pathTopRight: string;\n  pathBottomRight: string;\n}\n\n/**\n * An object that provides constants for rendering blocks in Zelos mode.\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  GRID_UNIT = 4;\n  STATEMENT_INPUT_SPACER_MIN_WIDTH: number;\n\n  override CURSOR_COLOUR = '#ffa200';\n\n  /**\n   * Radius of the cursor for input and output connections.\n   */\n  CURSOR_RADIUS = 5;\n\n  override JAGGED_TEETH_HEIGHT = 0;\n\n  override JAGGED_TEETH_WIDTH = 0;\n  override START_HAT_HEIGHT = 22;\n\n  override START_HAT_WIDTH = 96;\n\n  override SHAPES = {HEXAGONAL: 1, ROUND: 2, SQUARE: 3, PUZZLE: 4, NOTCH: 5};\n\n  /**\n   * Map of output/input shapes and the amount they should cause a block to be\n   * padded. Outer key is the outer shape, inner key is the inner shape.\n   * When a block with the outer shape contains an input block with the inner\n   * shape on its left or right edge, the block elements are aligned such that\n   * the padding specified is reached.\n   */\n  SHAPE_IN_SHAPE_PADDING: {[key: number]: {[key: number]: number}} = {\n    1: {\n      // Outer shape: hexagon.\n      0: 5 * this.GRID_UNIT, // Field in hexagon.\n      1: 2 * this.GRID_UNIT, // Hexagon in hexagon.\n      2: 5 * this.GRID_UNIT, // Round in hexagon.\n      3: 5 * this.GRID_UNIT, // Square in hexagon.\n    },\n    2: {\n      // Outer shape: round.\n      0: 3 * this.GRID_UNIT, // Field in round.\n      1: 3 * this.GRID_UNIT, // Hexagon in round.\n      2: 1 * this.GRID_UNIT, // Round in round.\n      3: 2 * this.GRID_UNIT, // Square in round.\n    },\n    3: {\n      // Outer shape: square.\n      0: 2 * this.GRID_UNIT, // Field in square.\n      1: 2 * this.GRID_UNIT, // Hexagon in square.\n      2: 2 * this.GRID_UNIT, // Round in square.\n      3: 2 * this.GRID_UNIT, // Square in square.\n    },\n  };\n\n  override FULL_BLOCK_FIELDS = true;\n\n  override FIELD_TEXT_FONTWEIGHT = 'bold';\n\n  override FIELD_TEXT_FONTFAMILY =\n    '\"Helvetica Neue\", \"Segoe UI\", Helvetica, sans-serif';\n\n  override FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW = true;\n\n  override FIELD_DROPDOWN_COLOURED_DIV = true;\n\n  override FIELD_DROPDOWN_SVG_ARROW = true;\n  override FIELD_TEXTINPUT_BOX_SHADOW = true;\n\n  override FIELD_COLOUR_FULL_BLOCK = true;\n  MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH: number;\n\n  /** The selected glow colour. */\n  SELECTED_GLOW_COLOUR = '#fff200';\n\n  /** The size of the selected glow. */\n  SELECTED_GLOW_SIZE = 0.5;\n\n  /** The replacement glow colour. */\n  REPLACEMENT_GLOW_COLOUR = '#fff200';\n\n  /** The size of the selected glow. */\n  REPLACEMENT_GLOW_SIZE = 2;\n\n  /**\n   * The ID of the selected glow filter, or the empty string if no filter is\n   * set.\n   */\n  selectedGlowFilterId = '';\n\n  /**\n   * The <filter> element to use for a selected glow, or null if not set.\n   */\n  private selectedGlowFilter: SVGElement | null = null;\n\n  /**\n   * The ID of the replacement glow filter, or the empty string if no filter\n   * is set.\n   */\n  replacementGlowFilterId = '';\n\n  /**\n   * The <filter> element to use for a replacement glow, or null if not set.\n   */\n  private replacementGlowFilter: SVGElement | null = null;\n\n  /**\n   * The object containing information about the hexagon used for a boolean\n   * reporter block. Null before init is called.\n   */\n  HEXAGONAL: Shape | null = null;\n\n  /**\n   * The object containing information about the hexagon used for a number or\n   * string reporter block. Null before init is called.\n   */\n  ROUNDED: Shape | null = null;\n\n  /**\n   * The object containing information about the hexagon used for a\n   * rectangular reporter block. Null before init is called.\n   */\n  SQUARED: Shape | null = null;\n\n  constructor() {\n    super();\n\n    this.SMALL_PADDING = this.GRID_UNIT;\n\n    this.MEDIUM_PADDING = 2 * this.GRID_UNIT;\n\n    this.MEDIUM_LARGE_PADDING = 3 * this.GRID_UNIT;\n\n    this.LARGE_PADDING = 4 * this.GRID_UNIT;\n\n    this.CORNER_RADIUS = 1 * this.GRID_UNIT;\n\n    this.NOTCH_WIDTH = 9 * this.GRID_UNIT;\n\n    this.NOTCH_HEIGHT = 2 * this.GRID_UNIT;\n\n    this.NOTCH_OFFSET_LEFT = 3 * this.GRID_UNIT;\n\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT;\n\n    this.MIN_BLOCK_WIDTH = 2 * this.GRID_UNIT;\n\n    this.MIN_BLOCK_HEIGHT = 12 * this.GRID_UNIT;\n\n    this.EMPTY_STATEMENT_INPUT_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.TOP_ROW_MIN_HEIGHT = this.CORNER_RADIUS;\n\n    this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    this.BOTTOM_ROW_MIN_HEIGHT = this.CORNER_RADIUS;\n\n    this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.STATEMENT_BOTTOM_SPACER = -this.NOTCH_HEIGHT;\n\n    /** Minimum statement input spacer width. */\n    this.STATEMENT_INPUT_SPACER_MIN_WIDTH = 40 * this.GRID_UNIT;\n\n    this.STATEMENT_INPUT_PADDING_LEFT = 4 * this.GRID_UNIT;\n\n    this.EMPTY_INLINE_INPUT_PADDING = 4 * this.GRID_UNIT;\n\n    this.EMPTY_INLINE_INPUT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.DUMMY_INPUT_MIN_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.DUMMY_INPUT_SHADOW_MIN_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.CURSOR_WS_WIDTH = 20 * this.GRID_UNIT;\n\n    this.FIELD_TEXT_FONTSIZE = 3 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_RADIUS = this.CORNER_RADIUS;\n\n    this.FIELD_BORDER_RECT_X_PADDING = 2 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_Y_PADDING = 1.625 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_DROPDOWN_SVG_ARROW_PADDING = this.FIELD_BORDER_RECT_X_PADDING;\n\n    this.FIELD_COLOUR_DEFAULT_WIDTH = 6 * this.GRID_UNIT;\n\n    this.FIELD_COLOUR_DEFAULT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_CHECKBOX_X_OFFSET = 1 * this.GRID_UNIT;\n\n    /** The maximum width of a dynamic connection shape. */\n    this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH = 12 * this.GRID_UNIT;\n  }\n\n  override setFontConstants_(theme: Theme) {\n    super.setFontConstants_(theme);\n\n    this.FIELD_BORDER_RECT_HEIGHT =\n      this.FIELD_TEXT_HEIGHT + this.FIELD_BORDER_RECT_Y_PADDING * 2;\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n  }\n\n  override init() {\n    super.init();\n    this.HEXAGONAL = this.makeHexagonal();\n    this.ROUNDED = this.makeRounded();\n    this.SQUARED = this.makeSquared();\n\n    this.STATEMENT_INPUT_NOTCH_OFFSET =\n      this.NOTCH_OFFSET_LEFT +\n      (this.INSIDE_CORNERS as InsideCorners).rightWidth;\n  }\n\n  override setDynamicProperties_(theme: Theme) {\n    super.setDynamicProperties_(theme);\n\n    this.SELECTED_GLOW_COLOUR =\n      theme.getComponentStyle('selectedGlowColour') ||\n      this.SELECTED_GLOW_COLOUR;\n    const selectedGlowSize = Number(\n      theme.getComponentStyle('selectedGlowSize'),\n    );\n    this.SELECTED_GLOW_SIZE =\n      selectedGlowSize && !isNaN(selectedGlowSize)\n        ? selectedGlowSize\n        : this.SELECTED_GLOW_SIZE;\n    this.REPLACEMENT_GLOW_COLOUR =\n      theme.getComponentStyle('replacementGlowColour') ||\n      this.REPLACEMENT_GLOW_COLOUR;\n    const replacementGlowSize = Number(\n      theme.getComponentStyle('replacementGlowSize'),\n    );\n    this.REPLACEMENT_GLOW_SIZE =\n      replacementGlowSize && !isNaN(replacementGlowSize)\n        ? replacementGlowSize\n        : this.REPLACEMENT_GLOW_SIZE;\n  }\n\n  override dispose() {\n    super.dispose();\n    if (this.selectedGlowFilter) {\n      dom.removeNode(this.selectedGlowFilter);\n    }\n    if (this.replacementGlowFilter) {\n      dom.removeNode(this.replacementGlowFilter);\n    }\n  }\n\n  override makeStartHat() {\n    const height = this.START_HAT_HEIGHT;\n    const width = this.START_HAT_WIDTH;\n\n    const mainPath = svgPaths.curve('c', [\n      svgPaths.point(25, -height),\n      svgPaths.point(71, -height),\n      svgPaths.point(width, 0),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * Create sizing and path information about a hexagonal shape.\n   *\n   * @returns An object containing sizing and path information about a hexagonal\n   *     shape for connections.\n   */\n  protected makeHexagonal(): Shape {\n    const maxWidth = this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n\n    /**\n     * Make the main path for the hexagonal connection shape out of two lines.\n     * The lines are defined with relative positions and require the block\n     * height. The 'up' and 'down' versions of the paths are the same, but the Y\n     * sign flips.  The 'left' and 'right' versions of the path are also the\n     * same, but the X sign flips.\n     *\n     * @param height The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a rounded connection.\n     */\n    function makeMainPath(height: number, up: boolean, right: boolean): string {\n      const halfHeight = height / 2;\n      const width = halfHeight > maxWidth ? maxWidth : halfHeight;\n      const forward = up ? -1 : 1;\n      const direction = right ? -1 : 1;\n      const dy = (forward * height) / 2;\n      return (\n        svgPaths.lineTo(-direction * width, dy) +\n        svgPaths.lineTo(direction * width, dy)\n      );\n    }\n\n    return {\n      type: this.SHAPES.HEXAGONAL,\n      isDynamic: true,\n      width(height: number): number {\n        const halfHeight = height / 2;\n        return halfHeight > maxWidth ? maxWidth : halfHeight;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  /**\n   * Create sizing and path information about a rounded shape.\n   *\n   * @returns An object containing sizing and path information about a rounded\n   *     shape for connections.\n   */\n  protected makeRounded(): Shape {\n    const maxWidth = this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n    const maxHeight = maxWidth * 2;\n\n    /**\n     * Make the main path for the rounded connection shape out of two arcs and\n     * a line that joins them.  The arcs are defined with relative positions.\n     * Usually, the height of the block is split between the two arcs. In the\n     * case where the height of the block exceeds the maximum height, a line is\n     * drawn in between the two arcs. The 'up' and 'down' versions of the paths\n     * are the same, but the Y sign flips.  The 'up' and 'right' versions of the\n     * path flip the sweep-flag which moves the arc at negative angles.\n     *\n     * @param blockHeight The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a rounded connection.\n     */\n    function makeMainPath(\n      blockHeight: number,\n      up: boolean,\n      right: boolean,\n    ): string {\n      const remainingHeight =\n        blockHeight > maxHeight ? blockHeight - maxHeight : 0;\n      const height = blockHeight > maxHeight ? maxHeight : blockHeight;\n      const radius = height / 2;\n      const sweep = right === up ? '0' : '1';\n      return (\n        svgPaths.arc(\n          'a',\n          '0 0,' + sweep,\n          radius,\n          svgPaths.point((right ? 1 : -1) * radius, (up ? -1 : 1) * radius),\n        ) +\n        svgPaths.lineOnAxis('v', (up ? -1 : 1) * remainingHeight) +\n        svgPaths.arc(\n          'a',\n          '0 0,' + sweep,\n          radius,\n          svgPaths.point((right ? -1 : 1) * radius, (up ? -1 : 1) * radius),\n        )\n      );\n    }\n\n    return {\n      type: this.SHAPES.ROUND,\n      isDynamic: true,\n      width(height: number): number {\n        const halfHeight = height / 2;\n        return halfHeight > maxWidth ? maxWidth : halfHeight;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  /**\n   * Create sizing and path information about a squared shape.\n   *\n   * @returns An object containing sizing and path information about a squared\n   *     shape for connections.\n   */\n  protected makeSquared(): Shape {\n    const radius = this.CORNER_RADIUS;\n\n    /**\n     * Make the main path for the squared connection shape out of two corners\n     * and a single line in-between (a and v). These are defined in relative\n     * positions and require the height of the block.\n     * The 'left' and 'right' versions of the paths are the same, but the Y sign\n     * flips.  The 'up' and 'down' versions of the path determine where the\n     * corner point is placed and in turn the direction of the corners.\n     *\n     * @param height The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a squared connection.\n     */\n    function makeMainPath(height: number, up: boolean, right: boolean): string {\n      const innerHeight = height - radius * 2;\n      const sweep = right === up ? '0' : '1';\n      return (\n        svgPaths.arc(\n          'a',\n          '0 0,' + sweep,\n          radius,\n          svgPaths.point((right ? 1 : -1) * radius, (up ? -1 : 1) * radius),\n        ) +\n        svgPaths.lineOnAxis('v', (up ? -1 : 1) * innerHeight) +\n        svgPaths.arc(\n          'a',\n          '0 0,' + sweep,\n          radius,\n          svgPaths.point((right ? -1 : 1) * radius, (up ? -1 : 1) * radius),\n        )\n      );\n    }\n\n    return {\n      type: this.SHAPES.SQUARE,\n      isDynamic: true,\n      width(_height: number): number {\n        return radius;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  override shapeFor(connection: RenderedConnection): Shape {\n    let checks = connection.getCheck();\n    if (!checks && connection.targetConnection) {\n      checks = connection.targetConnection.getCheck();\n    }\n    let outputShape;\n    switch (connection.type) {\n      case ConnectionType.INPUT_VALUE:\n      case ConnectionType.OUTPUT_VALUE:\n        outputShape = connection.getSourceBlock().getOutputShape();\n        // If the block has an output shape set, use that instead.\n        if (outputShape !== null) {\n          switch (outputShape) {\n            case this.SHAPES.HEXAGONAL:\n              return this.HEXAGONAL!;\n            case this.SHAPES.ROUND:\n              return this.ROUNDED!;\n            case this.SHAPES.SQUARE:\n              return this.SQUARED!;\n          }\n        }\n        // Includes doesn't work in IE.\n        if (checks && checks.includes('Boolean')) {\n          return this.HEXAGONAL!;\n        }\n        if (checks && checks.includes('Number')) {\n          return this.ROUNDED!;\n        }\n        if (checks && checks.includes('String')) {\n          return this.ROUNDED!;\n        }\n        return this.ROUNDED!;\n      case ConnectionType.PREVIOUS_STATEMENT:\n      case ConnectionType.NEXT_STATEMENT:\n        return this.NOTCH!;\n      default:\n        throw Error('Unknown type');\n    }\n  }\n\n  override makeNotch() {\n    const width = this.NOTCH_WIDTH;\n    const height = this.NOTCH_HEIGHT;\n\n    const innerWidth = width / 3;\n    const curveWidth = innerWidth / 3;\n\n    const halfHeight = height / 2;\n    const quarterHeight = halfHeight / 2;\n\n    /**\n     * Make the main path for the notch.\n     *\n     * @param dir Direction multiplier to apply to horizontal offsets along the\n     *     path. Either 1 or -1.\n     * @returns A path fragment describing a notch.\n     */\n    function makeMainPath(dir: number): string {\n      return (\n        svgPaths.curve('c', [\n          svgPaths.point((dir * curveWidth) / 2, 0),\n          svgPaths.point((dir * curveWidth * 3) / 4, quarterHeight / 2),\n          svgPaths.point(dir * curveWidth, quarterHeight),\n        ]) +\n        svgPaths.line([svgPaths.point(dir * curveWidth, halfHeight)]) +\n        svgPaths.curve('c', [\n          svgPaths.point((dir * curveWidth) / 4, quarterHeight / 2),\n          svgPaths.point((dir * curveWidth) / 2, quarterHeight),\n          svgPaths.point(dir * curveWidth, quarterHeight),\n        ]) +\n        svgPaths.lineOnAxis('h', dir * innerWidth) +\n        svgPaths.curve('c', [\n          svgPaths.point((dir * curveWidth) / 2, 0),\n          svgPaths.point((dir * curveWidth * 3) / 4, -(quarterHeight / 2)),\n          svgPaths.point(dir * curveWidth, -quarterHeight),\n        ]) +\n        svgPaths.line([svgPaths.point(dir * curveWidth, -halfHeight)]) +\n        svgPaths.curve('c', [\n          svgPaths.point((dir * curveWidth) / 4, -(quarterHeight / 2)),\n          svgPaths.point((dir * curveWidth) / 2, -quarterHeight),\n          svgPaths.point(dir * curveWidth, -quarterHeight),\n        ])\n      );\n    }\n\n    const pathLeft = makeMainPath(1);\n    const pathRight = makeMainPath(-1);\n\n    return {\n      type: this.SHAPES.NOTCH,\n      width,\n      height,\n      pathLeft,\n      pathRight,\n    };\n  }\n\n  override makeInsideCorners() {\n    const radius = this.CORNER_RADIUS;\n\n    const innerTopLeftCorner = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius,\n      svgPaths.point(-radius, radius),\n    );\n\n    const innerTopRightCorner = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(-radius, radius),\n    );\n\n    const innerBottomLeftCorner = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius,\n      svgPaths.point(radius, radius),\n    );\n\n    const innerBottomRightCorner = svgPaths.arc(\n      'a',\n      '0 0,1',\n      radius,\n      svgPaths.point(radius, radius),\n    );\n\n    return {\n      width: radius,\n      height: radius,\n      pathTop: innerTopLeftCorner,\n      pathBottom: innerBottomLeftCorner,\n      rightWidth: radius,\n      rightHeight: radius,\n      pathTopRight: innerTopRightCorner,\n      pathBottomRight: innerBottomRightCorner,\n    };\n  }\n\n  override generateSecondaryColour_(colour: string) {\n    return utilsColour.blend('#000', colour, 0.15) || colour;\n  }\n\n  override generateTertiaryColour_(colour: string) {\n    return utilsColour.blend('#000', colour, 0.25) || colour;\n  }\n\n  override createDom(svg: SVGElement, tagName: string, selector: string) {\n    super.createDom(svg, tagName, selector);\n    /*\n        <defs>\n          ... filters go here ...\n        </defs>\n        */\n    const defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n    // Using a dilate distorts the block shape.\n    // Instead use a gaussian blur, and then set all alpha to 1 with a transfer.\n    const selectedGlowFilter = dom.createSvgElement(\n      Svg.FILTER,\n      {\n        'id': 'blocklySelectedGlowFilter' + this.randomIdentifier,\n        'height': '160%',\n        'width': '180%',\n        'y': '-30%',\n        'x': '-40%',\n      },\n      defs,\n    );\n    dom.createSvgElement(\n      Svg.FEGAUSSIANBLUR,\n      {'in': 'SourceGraphic', 'stdDeviation': this.SELECTED_GLOW_SIZE},\n      selectedGlowFilter,\n    );\n    // Set all gaussian blur pixels to 1 opacity before applying flood\n    const selectedComponentTransfer = dom.createSvgElement(\n      Svg.FECOMPONENTTRANSFER,\n      {'result': 'outBlur'},\n      selectedGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FEFUNCA,\n      {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n      selectedComponentTransfer,\n    );\n    // Color the highlight\n    dom.createSvgElement(\n      Svg.FEFLOOD,\n      {\n        'flood-color': this.SELECTED_GLOW_COLOUR,\n        'flood-opacity': 1,\n        'result': 'outColor',\n      },\n      selectedGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'outColor',\n        'in2': 'outBlur',\n        'operator': 'in',\n        'result': 'outGlow',\n      },\n      selectedGlowFilter,\n    );\n    this.selectedGlowFilterId = selectedGlowFilter.id;\n    this.selectedGlowFilter = selectedGlowFilter;\n\n    // Using a dilate distorts the block shape.\n    // Instead use a gaussian blur, and then set all alpha to 1 with a transfer.\n    const replacementGlowFilter = dom.createSvgElement(\n      Svg.FILTER,\n      {\n        'id': 'blocklyReplacementGlowFilter' + this.randomIdentifier,\n        'height': '160%',\n        'width': '180%',\n        'y': '-30%',\n        'x': '-40%',\n      },\n      defs,\n    );\n    dom.createSvgElement(\n      Svg.FEGAUSSIANBLUR,\n      {'in': 'SourceGraphic', 'stdDeviation': this.REPLACEMENT_GLOW_SIZE},\n      replacementGlowFilter,\n    );\n    // Set all gaussian blur pixels to 1 opacity before applying flood\n    const replacementComponentTransfer = dom.createSvgElement(\n      Svg.FECOMPONENTTRANSFER,\n      {'result': 'outBlur'},\n      replacementGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FEFUNCA,\n      {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n      replacementComponentTransfer,\n    );\n    // Color the highlight\n    dom.createSvgElement(\n      Svg.FEFLOOD,\n      {\n        'flood-color': this.REPLACEMENT_GLOW_COLOUR,\n        'flood-opacity': 1,\n        'result': 'outColor',\n      },\n      replacementGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'outColor',\n        'in2': 'outBlur',\n        'operator': 'in',\n        'result': 'outGlow',\n      },\n      replacementGlowFilter,\n    );\n    dom.createSvgElement(\n      Svg.FECOMPOSITE,\n      {\n        'in': 'SourceGraphic',\n        'in2': 'outGlow',\n        'operator': 'over',\n      },\n      replacementGlowFilter,\n    );\n    this.replacementGlowFilterId = replacementGlowFilter.id;\n    this.replacementGlowFilter = replacementGlowFilter;\n  }\n\n  override getCSS_(selector: string) {\n    return [\n      // Text.\n      `${selector} .blocklyText,`,\n      `${selector} .blocklyFlyoutLabelText {`,\n      `font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}` +\n        `pt ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n\n      `${selector} .blocklyTextInputBubble textarea {`,\n      `font-weight: normal;`,\n      `}`,\n\n      // Fields.\n      `${selector} .blocklyText {`,\n      `fill: #fff;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,\n      `${selector} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,\n      `fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\n      `}`,\n      `${selector} .blocklyNonEditableText>text,`,\n      `${selector} .blocklyEditableText>text,`,\n      `${selector} .blocklyNonEditableText>g>text,`,\n      `${selector} .blocklyEditableText>g>text {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Flyout labels.\n      `${selector} .blocklyFlyoutLabelText {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Bubbles.\n      `${selector} .blocklyText.blocklyBubbleText {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Editable field hover.\n      `${selector} .blocklyDraggable:not(.blocklyDisabled)`,\n      ` .blocklyEditableText:not(.editing):hover>rect,`,\n      `${selector} .blocklyDraggable:not(.blocklyDisabled)`,\n      ` .blocklyEditableText:not(.editing):hover>.blocklyPath {`,\n      `stroke: #fff;`,\n      `stroke-width: 2;`,\n      `}`,\n\n      // Text field input.\n      `${selector} .blocklyHtmlInput {`,\n      `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n      `font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\n      `color: #575E75;`,\n      `}`,\n\n      // Dropdown field.\n      `${selector} .blocklyDropdownText {`,\n      `fill: #fff !important;`,\n      `}`,\n\n      // Widget and Dropdown Div\n      `${selector}.blocklyWidgetDiv .blocklyMenuItem,`,\n      `${selector}.blocklyDropDownDiv .blocklyMenuItem {`,\n      `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n      `${selector}.blocklyDropDownDiv .blocklyMenuItemContent {`,\n      `color: #fff;`,\n      `}`,\n\n      // Connection highlight.\n      `${selector} .blocklyHighlightedConnectionPath {`,\n      `stroke: ${this.SELECTED_GLOW_COLOUR};`,\n      `}`,\n\n      // Disabled outline paths.\n      `${selector} .blocklyDisabled > .blocklyOutlinePath {`,\n      `fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,\n      `}`,\n\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPath {`,\n      `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n      `stroke: none;`,\n      `}`,\n    ];\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.Drawer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {BaseShape, DynamicShape, Notch} from '../common/constants.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\nimport {Connection} from '../measurables/connection.js';\nimport type {InlineInput} from '../measurables/inline_input.js';\nimport {OutputConnection} from '../measurables/output_connection.js';\nimport type {Row} from '../measurables/row.js';\nimport type {SpacerRow} from '../measurables/spacer_row.js';\nimport {Types} from '../measurables/types.js';\nimport type {InsideCorners} from './constants.js';\nimport type {RenderInfo} from './info.js';\nimport type {StatementInput} from './measurables/inputs.js';\nimport type {PathObject} from './path_object.js';\n\n/**\n * An object that draws a block based on the given rendering information.\n */\nexport class Drawer extends BaseDrawer {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override info_!: RenderInfo;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n  }\n\n  override draw() {\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.beginDrawing();\n    this.drawOutline_();\n    this.drawInternals_();\n    this.updateConnectionHighlights();\n\n    pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    if (this.info_.RTL) {\n      pathObject.flipRTL();\n    }\n    this.recordSizeOnBlock_();\n    if (this.info_.outputConnection) {\n      // Store the output connection shape type for parent blocks to use during\n      // rendering.\n      pathObject.outputShapeType = this.info_.outputConnection.shape.type;\n    }\n    pathObject.endDrawing();\n  }\n\n  override drawOutline_() {\n    if (\n      this.info_.outputConnection &&\n      this.info_.outputConnection.isDynamicShape &&\n      !this.info_.hasStatementInput &&\n      !this.info_.bottomRow.hasNextConnection\n    ) {\n      this.drawFlatTop_();\n      this.drawRightDynamicConnection_();\n      this.drawFlatBottom_();\n      this.drawLeftDynamicConnection_();\n    } else {\n      super.drawOutline_();\n    }\n  }\n\n  override drawLeft_() {\n    if (\n      this.info_.outputConnection &&\n      this.info_.outputConnection.isDynamicShape\n    ) {\n      this.drawLeftDynamicConnection_();\n    } else {\n      super.drawLeft_();\n    }\n  }\n\n  /**\n   * Add steps for the right side of a row that does not have value or\n   * statement input connections.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected override drawRightSideRow_(row: Row) {\n    if (row.height <= 0) {\n      return;\n    }\n    if (Types.isSpacer(row)) {\n      const spacerRow = row as SpacerRow;\n      const precedesStatement = spacerRow.precedesStatement;\n      const followsStatement = spacerRow.followsStatement;\n      if (precedesStatement || followsStatement) {\n        const insideCorners = this.constants_.INSIDE_CORNERS as InsideCorners;\n        const cornerHeight = insideCorners.rightHeight;\n        const remainingHeight =\n          spacerRow.height - (precedesStatement ? cornerHeight : 0);\n        const bottomRightPath = followsStatement\n          ? insideCorners.pathBottomRight\n          : '';\n        const verticalPath =\n          remainingHeight > 0\n            ? svgPaths.lineOnAxis('V', spacerRow.yPos + remainingHeight)\n            : '';\n        const topRightPath = precedesStatement\n          ? insideCorners.pathTopRight\n          : '';\n        // Put all of the partial paths together.\n        this.outlinePath_ += bottomRightPath + verticalPath + topRightPath;\n        return;\n      }\n    }\n    this.outlinePath_ += svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  /**\n   * Add steps to draw the right side of an output with a dynamic connection.\n   */\n  protected drawRightDynamicConnection_() {\n    if (!this.info_.outputConnection) {\n      throw new Error(\n        `Cannot draw the output connection of a block that doesn't have one`,\n      );\n    }\n    this.outlinePath_ += (\n      this.info_.outputConnection.shape as DynamicShape\n    ).pathRightDown(this.info_.outputConnection.height);\n  }\n\n  /**\n   * Add steps to draw the left side of an output with a dynamic connection.\n   */\n  protected drawLeftDynamicConnection_() {\n    if (!this.info_.outputConnection) {\n      throw new Error(\n        `Cannot draw the output connection of a block that doesn't have one`,\n      );\n    }\n    this.positionOutputConnection_();\n\n    this.outlinePath_ += (\n      this.info_.outputConnection.shape as DynamicShape\n    ).pathUp(this.info_.outputConnection.height);\n\n    // Close off the path.  This draws a vertical line up to the start of the\n    // block's path, which may be either a rounded or a sharp corner.\n    this.outlinePath_ += 'z';\n  }\n\n  /** Add steps to draw a flat top row. */\n  protected drawFlatTop_() {\n    const topRow = this.info_.topRow;\n    this.positionPreviousConnection_();\n\n    this.outlinePath_ += svgPaths.moveBy(topRow.xPos, this.info_.startY);\n    this.outlinePath_ += svgPaths.lineOnAxis('h', topRow.width);\n  }\n\n  /** Add steps to draw a flat bottom row. */\n  protected drawFlatBottom_() {\n    const bottomRow = this.info_.bottomRow;\n    this.positionNextConnection_();\n\n    this.outlinePath_ += svgPaths.lineOnAxis('V', bottomRow.baseline);\n    this.outlinePath_ += svgPaths.lineOnAxis('h', -bottomRow.width);\n  }\n\n  override drawInlineInput_(input: InlineInput) {\n    this.positionInlineInputConnection_(input);\n\n    const inputName = input.input.name;\n    if (input.connectedBlock || this.info_.isInsertionMarker) {\n      return;\n    }\n\n    const yPos = input.centerline - input.height / 2;\n    const connectionRight = input.xPos + input.connectionWidth;\n\n    const path =\n      svgPaths.moveTo(connectionRight, yPos) + this.getInlineInputPath(input);\n\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.setOutlinePath(inputName, path);\n  }\n\n  private getInlineInputPath(input: InlineInput) {\n    const width = input.width - input.connectionWidth * 2;\n    const height = input.height;\n\n    return (\n      svgPaths.lineOnAxis('h', width) +\n      (input.shape as DynamicShape).pathRightDown(height) +\n      svgPaths.lineOnAxis('h', -width) +\n      (input.shape as DynamicShape).pathUp(height) +\n      'z'\n    );\n  }\n\n  override drawStatementInput_(row: Row) {\n    const input = row.getLastInput() as StatementInput;\n    // Where to start drawing the notch, which is on the right side in LTR.\n    const x = input.xPos + input.notchOffset + (input.shape as BaseShape).width;\n\n    const insideCorners = this.constants_.INSIDE_CORNERS;\n    const innerTopLeftCorner =\n      (input.shape as Notch).pathRight +\n      svgPaths.lineOnAxis('h', -(input.notchOffset - insideCorners.width)) +\n      insideCorners.pathTop;\n\n    const innerHeight = row.height - 2 * insideCorners.height;\n\n    const innerBottomLeftCorner =\n      insideCorners.pathBottom +\n      svgPaths.lineOnAxis('h', input.notchOffset - insideCorners.width) +\n      (input.connectedBottomNextConnection\n        ? ''\n        : (input.shape as Notch).pathLeft);\n\n    this.outlinePath_ +=\n      svgPaths.lineOnAxis('H', x) +\n      innerTopLeftCorner +\n      svgPaths.lineOnAxis('v', innerHeight) +\n      innerBottomLeftCorner +\n      svgPaths.lineOnAxis('H', row.xPos + row.width);\n\n    this.positionStatementInputConnection_(row);\n  }\n\n  /** Returns a path to highlight the given connection. */\n  drawConnectionHighlightPath(measurable: Connection) {\n    const conn = measurable.connectionModel;\n    if (\n      conn.type === ConnectionType.NEXT_STATEMENT ||\n      conn.type === ConnectionType.PREVIOUS_STATEMENT ||\n      (conn.type === ConnectionType.OUTPUT_VALUE && !measurable.isDynamicShape)\n    ) {\n      super.drawConnectionHighlightPath(measurable);\n      return;\n    }\n\n    let path = '';\n    if (conn.type === ConnectionType.INPUT_VALUE) {\n      const input = measurable as InlineInput;\n      const xPos = input.connectionWidth;\n      const yPos = -input.height / 2;\n      path = svgPaths.moveTo(xPos, yPos) + this.getInlineInputPath(input);\n    } else {\n      // Dynamic output.\n      const output = measurable as OutputConnection;\n      const xPos = output.width;\n      const yPos = -output.height / 2;\n      path =\n        svgPaths.moveTo(xPos, yPos) +\n        (output.shape as DynamicShape).pathDown(output.height);\n    }\n    const block = conn.getSourceBlock();\n    block.pathObject.addConnectionHighlight?.(\n      conn,\n      path,\n      conn.getOffsetInBlock(),\n      block.RTL,\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Image field.  Used for pictures, icons, etc.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldImage\n\nimport {Field, FieldConfig} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\n\n/**\n * Class for an image on a block.\n */\nexport class FieldImage extends Field<string> {\n  /**\n   * Vertical padding below the image, which is included in the reported height\n   * of the field.\n   */\n  private static readonly Y_PADDING = 1;\n  protected override size_: Size;\n  protected readonly imageHeight: number;\n\n  /** The function to be called when this field is clicked. */\n  private clickHandler: ((p1: FieldImage) => void) | null = null;\n\n  /** The rendered field's image element. */\n  protected imageElement: SVGImageElement | null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override readonly EDITABLE = false;\n\n  /**\n   * Used to tell if the field needs to be rendered the next time the block is\n   * rendered. Image fields are statically sized, and only need to be\n   * rendered at initialization.\n   */\n  protected override isDirty_ = false;\n\n  /** Whether to flip this image in RTL. */\n  private flipRtl = false;\n\n  /** Alt text of this image. */\n  private altText = '';\n\n  /**\n   * @param src The URL of the image.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param width Width of the image.\n   * @param height Height of the image.\n   * @param alt Optional alt text for when block is collapsed.\n   * @param onClick Optional function to be called when the image is\n   *     clicked. If onClick is defined, alt must also be defined.\n   * @param flipRtl Whether to flip the icon in RTL.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/image#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    src: string | typeof Field.SKIP_SETUP,\n    width: string | number,\n    height: string | number,\n    alt?: string,\n    onClick?: (p1: FieldImage) => void,\n    flipRtl?: boolean,\n    config?: FieldImageConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    const imageHeight = Number(parsing.replaceMessageReferences(height));\n    const imageWidth = Number(parsing.replaceMessageReferences(width));\n    if (isNaN(imageHeight) || isNaN(imageWidth)) {\n      throw Error(\n        'Height and width values of an image field must cast to' + ' numbers.',\n      );\n    }\n    if (imageHeight <= 0 || imageWidth <= 0) {\n      throw Error(\n        'Height and width values of an image field must be greater' +\n          ' than 0.',\n      );\n    }\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(imageWidth, imageHeight + FieldImage.Y_PADDING);\n\n    /**\n     * Store the image height, since it is different from the field height.\n     */\n    this.imageHeight = imageHeight;\n\n    if (typeof onClick === 'function') {\n      this.clickHandler = onClick;\n    }\n\n    if (src === Field.SKIP_SETUP) return;\n\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.flipRtl = !!flipRtl;\n      this.altText = parsing.replaceMessageReferences(alt) || '';\n    }\n    this.setValue(parsing.replaceMessageReferences(src));\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldImageConfig) {\n    super.configure_(config);\n    if (config.flipRtl) this.flipRtl = config.flipRtl;\n    if (config.alt) {\n      this.altText = parsing.replaceMessageReferences(config.alt);\n    }\n  }\n\n  /**\n   * Create the block UI for this image.\n   */\n  override initView() {\n    this.imageElement = dom.createSvgElement(\n      Svg.IMAGE,\n      {\n        'height': this.imageHeight + 'px',\n        'width': this.size_.width + 'px',\n        'alt': this.altText,\n      },\n      this.fieldGroup_,\n    );\n    this.imageElement.setAttributeNS(\n      dom.XLINK_NS,\n      'xlink:href',\n      this.value_ as string,\n    );\n\n    if (this.clickHandler) {\n      this.imageElement.style.cursor = 'pointer';\n    }\n  }\n\n  override updateSize_() {}\n  // NOP\n\n  /**\n   * Ensure that the input value (the source URL) is a string.\n   *\n   * @param newValue The input value.\n   * @returns A string, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: any): string | null {\n    if (typeof newValue !== 'string') {\n      return null;\n    }\n    return newValue;\n  }\n\n  /**\n   * Update the value of this image field, and update the displayed image.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: string) {\n    this.value_ = newValue;\n    if (this.imageElement) {\n      this.imageElement.setAttributeNS(dom.XLINK_NS, 'xlink:href', this.value_);\n    }\n  }\n\n  /**\n   * Get whether to flip this image in RTL\n   *\n   * @returns True if we should flip in RTL.\n   */\n  override getFlipRtl(): boolean {\n    return this.flipRtl;\n  }\n\n  /**\n   * Set the alt text of this image.\n   *\n   * @param alt New alt text.\n   */\n  setAlt(alt: string | null) {\n    if (alt === this.altText) {\n      return;\n    }\n    this.altText = alt || '';\n    if (this.imageElement) {\n      this.imageElement.setAttribute('alt', this.altText);\n    }\n  }\n\n  /**\n   * If field click is called, and click handler defined,\n   * call the handler.\n   */\n  protected override showEditor_() {\n    if (this.clickHandler) {\n      this.clickHandler(this);\n    }\n  }\n\n  /**\n   * Set the function that is called when this image  is clicked.\n   *\n   * @param func The function that is called when the image is clicked, or null\n   *     to remove.\n   */\n  setOnClickHandler(func: ((p1: FieldImage) => void) | null) {\n    this.clickHandler = func;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation.\n   * Return the image alt text instead.\n   *\n   * @returns The image alt text.\n   */\n  protected override getText_(): string | null {\n    return this.altText;\n  }\n\n  /**\n   * Construct a FieldImage from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (src, width, height, alt, and\n   *     flipRtl).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(options: FieldImageFromJsonConfig): FieldImage {\n    if (!options.src || !options.width || !options.height) {\n      throw new Error(\n        'src, width, and height values for an image field are' +\n          'required. The width and height must be non-zero.',\n      );\n    }\n    // `this` might be a subclass of FieldImage if that class doesn't override\n    // the static fromJson method.\n    return new this(\n      options.src,\n      options.width,\n      options.height,\n      undefined,\n      undefined,\n      undefined,\n      options,\n    );\n  }\n}\n\nfieldRegistry.register('field_image', FieldImage);\n\nFieldImage.prototype.DEFAULT_VALUE = '';\n\n/**\n * Config options for the image field.\n */\nexport interface FieldImageConfig extends FieldConfig {\n  flipRtl?: boolean;\n  alt?: string;\n}\n\n/**\n * fromJson config options for the image field.\n */\nexport interface FieldImageFromJsonConfig extends FieldImageConfig {\n  src?: string;\n  width?: number;\n  height?: number;\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text input field.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldInput\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as dialog from './dialog.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport {\n  Field,\n  FieldConfig,\n  FieldValidator,\n  UnattachedFieldError,\n} from './field.js';\nimport {Msg} from './msg.js';\nimport * as renderManagement from './render_management.js';\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport {Size} from './utils/size.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Supported types for FieldInput subclasses.\n *\n * @internal\n */\ntype InputTypes = string | number;\n\n/**\n * Abstract class for an editable input field.\n *\n * @typeParam T - The value stored on the field.\n * @internal\n */\nexport abstract class FieldInput<T extends InputTypes> extends Field<\n  string | T\n> {\n  /**\n   * Pixel size of input border radius.\n   * Should match blocklyText's border-radius in CSS.\n   */\n  static BORDERRADIUS = 4;\n\n  /** Allow browser to spellcheck this field. */\n  protected spellcheck_ = true;\n\n  /** The HTML input element. */\n  protected htmlInput_: HTMLInputElement | null = null;\n\n  /** True if the field's value is currently being edited via the UI. */\n  protected isBeingEdited_ = false;\n\n  /**\n   * True if the value currently displayed in the field's editory UI is valid.\n   */\n  protected isTextValid_ = false;\n\n  /**\n   * The intial value of the field when the user opened an editor to change its\n   * value. When the editor is disposed, an event will be fired that uses this\n   * as the event's oldValue.\n   */\n  protected valueWhenEditorWasOpened_: string | T | null = null;\n\n  /** Key down event data. */\n  private onKeyDownWrapper: browserEvents.Data | null = null;\n\n  /** Key input event data. */\n  private onKeyInputWrapper: browserEvents.Data | null = null;\n\n  /**\n   * Whether the field should consider the whole parent block to be its click\n   * target.\n   */\n  fullBlockClickTarget_: boolean = false;\n\n  /** The workspace that this field belongs to. */\n  protected workspace_: WorkspaceSvg | null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'text';\n\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a string & returns a validated string, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | typeof Field.SKIP_SETUP,\n    validator?: FieldInputValidator<T> | null,\n    config?: FieldInputConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  protected override configure_(config: FieldInputConfig) {\n    super.configure_(config);\n    if (config.spellcheck !== undefined) {\n      this.spellcheck_ = config.spellcheck;\n    }\n  }\n\n  override initView() {\n    const block = this.getSourceBlock();\n    if (!block) throw new UnattachedFieldError();\n    super.initView();\n\n    if (this.isFullBlockField()) {\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\n    }\n  }\n\n  protected override isFullBlockField(): boolean {\n    const block = this.getSourceBlock();\n    if (!block) throw new UnattachedFieldError();\n\n    // Side effect for backwards compatibility.\n    this.fullBlockClickTarget_ =\n      !!this.getConstants()?.FULL_BLOCK_FIELDS && block.isSimpleReporter();\n    return this.fullBlockClickTarget_;\n  }\n\n  /**\n   * Called by setValue if the text input is not valid. If the field is\n   * currently being edited it reverts value of the field to the previous\n   * value while allowing the display text to be handled by the htmlInput_.\n   *\n   * @param _invalidValue The input value that was determined to be invalid.\n   *     This is not used by the text input because its display value is stored\n   *     on the htmlInput_.\n   * @param fireChangeEvent Whether to fire a change event if the value changes.\n   */\n  protected override doValueInvalid_(\n    _invalidValue: AnyDuringMigration,\n    fireChangeEvent: boolean = true,\n  ) {\n    if (this.isBeingEdited_) {\n      this.isDirty_ = true;\n      this.isTextValid_ = false;\n      const oldValue = this.value_;\n      // Revert value when the text becomes invalid.\n      this.value_ = this.valueWhenEditorWasOpened_;\n      if (\n        this.sourceBlock_ &&\n        eventUtils.isEnabled() &&\n        this.value_ !== oldValue &&\n        fireChangeEvent\n      ) {\n        eventUtils.fire(\n          new (eventUtils.get(EventType.BLOCK_CHANGE))(\n            this.sourceBlock_,\n            'field',\n            this.name || null,\n            oldValue,\n            this.value_,\n          ),\n        );\n      }\n    }\n  }\n\n  /**\n   * Called by setValue if the text input is valid. Updates the value of the\n   * field, and updates the text of the field if it is not currently being\n   * edited (i.e. handled by the htmlInput_).\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: string | T) {\n    this.isDirty_ = true;\n    this.isTextValid_ = true;\n    this.value_ = newValue;\n  }\n\n  /**\n   * Updates text field to match the colour/style of the block.\n   */\n  override applyColour() {\n    const block = this.getSourceBlock() as BlockSvg | null;\n    if (!block) throw new UnattachedFieldError();\n\n    if (!this.getConstants()!.FULL_BLOCK_FIELDS) return;\n    if (!this.fieldGroup_) return;\n\n    if (!this.isFullBlockField() && this.borderRect_) {\n      this.borderRect_!.style.display = 'block';\n      this.borderRect_.setAttribute('stroke', block.getColourTertiary());\n    } else {\n      this.borderRect_!.style.display = 'none';\n      // In general, do *not* let fields control the color of blocks. Having the\n      // field control the color is unexpected, and could have performance\n      // impacts.\n      block.pathObject.svgPath.setAttribute(\n        'fill',\n        this.getConstants()!.FIELD_BORDER_RECT_COLOUR,\n      );\n    }\n  }\n\n  /**\n   * Returns the height and width of the field.\n   *\n   * This should *in general* be the only place render_ gets called from.\n   *\n   * @returns Height and width.\n   */\n  override getSize(): Size {\n    if (this.getConstants()?.FULL_BLOCK_FIELDS) {\n      // In general, do *not* let fields control the color of blocks. Having the\n      // field control the color is unexpected, and could have performance\n      // impacts.\n      // Full block fields have more control of the block than they should\n      // (i.e. updating fill colour). Whenever we get the size, the field may\n      // no longer be a full-block field, so we need to rerender.\n      this.render_();\n      this.isDirty_ = false;\n    }\n    return super.getSize();\n  }\n\n  /**\n   * Notifies the field that it has changed locations. Moves the widget div to\n   * be in the correct place if it is open.\n   */\n  onLocationChange(): void {\n    if (this.isBeingEdited_) this.resizeEditor_();\n  }\n\n  /**\n   * Updates the colour of the htmlInput given the current validity of the\n   * field's value.\n   *\n   * Also updates the colour of the block to reflect whether this is a full\n   * block field or not.\n   */\n  protected override render_() {\n    super.render_();\n    // This logic is done in render_ rather than doValueInvalid_ or\n    // doValueUpdate_ so that the code is more centralized.\n    if (this.isBeingEdited_) {\n      const htmlInput = this.htmlInput_ as HTMLElement;\n      if (!this.isTextValid_) {\n        dom.addClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, true);\n      } else {\n        dom.removeClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, false);\n      }\n    }\n\n    const block = this.getSourceBlock() as BlockSvg | null;\n    if (!block) throw new UnattachedFieldError();\n    // In general, do *not* let fields control the color of blocks. Having the\n    // field control the color is unexpected, and could have performance\n    // impacts.\n    // Whenever we render, the field may no longer be a full-block-field so\n    // we need to update the colour.\n    if (this.getConstants()!.FULL_BLOCK_FIELDS) block.applyColour();\n  }\n\n  /**\n   * Set whether this field is spellchecked by the browser.\n   *\n   * @param check True if checked.\n   */\n  setSpellcheck(check: boolean) {\n    if (check === this.spellcheck_) {\n      return;\n    }\n    this.spellcheck_ = check;\n    if (this.htmlInput_) {\n      // AnyDuringMigration because:  Argument of type 'boolean' is not\n      // assignable to parameter of type 'string'.\n      this.htmlInput_.setAttribute(\n        'spellcheck',\n        this.spellcheck_ as AnyDuringMigration,\n      );\n    }\n  }\n\n  /**\n   * Show an editor for the field.\n   * Shows the inline free-text editor on top of the text by default.\n   * Shows a prompt editor for mobile browsers if the modalInputs option is\n   * enabled.\n   *\n   * @param _e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @param quietInput True if editor should be created without focus.\n   *     Defaults to false.\n   */\n  protected override showEditor_(_e?: Event, quietInput = false) {\n    this.workspace_ = (this.sourceBlock_ as BlockSvg).workspace;\n    if (\n      !quietInput &&\n      this.workspace_.options.modalInputs &&\n      (userAgent.MOBILE || userAgent.ANDROID || userAgent.IPAD)\n    ) {\n      this.showPromptEditor();\n    } else {\n      this.showInlineEditor(quietInput);\n    }\n  }\n\n  /**\n   * Create and show a text input editor that is a prompt (usually a popup).\n   * Mobile browsers may have issues with in-line textareas (focus and\n   * keyboards).\n   */\n  private showPromptEditor() {\n    dialog.prompt(\n      Msg['CHANGE_VALUE_TITLE'],\n      this.getText(),\n      (text: string | null) => {\n        // Text is null if user pressed cancel button.\n        if (text !== null) {\n          this.setValue(this.getValueFromEditorText_(text));\n        }\n        this.onFinishEditing_(this.value_);\n      },\n    );\n  }\n\n  /**\n   * Create and show a text input editor that sits directly over the text input.\n   *\n   * @param quietInput True if editor should be created without focus.\n   */\n  private showInlineEditor(quietInput: boolean) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    WidgetDiv.show(\n      this,\n      block.RTL,\n      this.widgetDispose_.bind(this),\n      this.workspace_,\n    );\n    this.htmlInput_ = this.widgetCreate_() as HTMLInputElement;\n    this.isBeingEdited_ = true;\n    this.valueWhenEditorWasOpened_ = this.value_;\n\n    if (!quietInput) {\n      (this.htmlInput_ as HTMLElement).focus({\n        preventScroll: true,\n      });\n      this.htmlInput_.select();\n    }\n  }\n\n  /**\n   * Create the text input editor widget.\n   *\n   * @returns The newly created text input editor.\n   */\n  protected widgetCreate_(): HTMLInputElement | HTMLTextAreaElement {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    eventUtils.setGroup(true);\n    const div = WidgetDiv.getDiv();\n\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    dom.addClass(clickTarget, 'editing');\n\n    const htmlInput = document.createElement('input');\n    htmlInput.className = 'blocklyHtmlInput';\n    // AnyDuringMigration because:  Argument of type 'boolean' is not assignable\n    // to parameter of type 'string'.\n    htmlInput.setAttribute(\n      'spellcheck',\n      this.spellcheck_ as AnyDuringMigration,\n    );\n    const scale = this.workspace_!.getScale();\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE * scale + 'pt';\n    div!.style.fontSize = fontSize;\n    htmlInput.style.fontSize = fontSize;\n    let borderRadius = FieldInput.BORDERRADIUS * scale + 'px';\n\n    if (this.isFullBlockField()) {\n      const bBox = this.getScaledBBox();\n\n      // Override border radius.\n      borderRadius = (bBox.bottom - bBox.top) / 2 + 'px';\n      // Pull stroke colour from the existing shadow block\n      const strokeColour = block.getParent()\n        ? (block.getParent() as BlockSvg).getColourTertiary()\n        : (this.sourceBlock_ as BlockSvg).getColourTertiary();\n      htmlInput.style.border = 1 * scale + 'px solid ' + strokeColour;\n      div!.style.borderRadius = borderRadius;\n      div!.style.transition = 'box-shadow 0.25s ease 0s';\n      if (this.getConstants()!.FIELD_TEXTINPUT_BOX_SHADOW) {\n        div!.style.boxShadow =\n          'rgba(255, 255, 255, 0.3) 0 0 0 ' + 4 * scale + 'px';\n      }\n    }\n    htmlInput.style.borderRadius = borderRadius;\n\n    div!.appendChild(htmlInput);\n\n    htmlInput.value = htmlInput.defaultValue = this.getEditorText_(this.value_);\n    htmlInput.setAttribute('data-untyped-default-value', String(this.value_));\n\n    this.resizeEditor_();\n\n    this.bindInputEvents_(htmlInput);\n\n    return htmlInput;\n  }\n\n  /**\n   * Closes the editor, saves the results, and disposes of any events or\n   * DOM-references belonging to the editor.\n   */\n  protected widgetDispose_() {\n    // Non-disposal related things that we do when the editor closes.\n    this.isBeingEdited_ = false;\n    this.isTextValid_ = true;\n    // Make sure the field's node matches the field's internal value.\n    this.forceRerender();\n    this.onFinishEditing_(this.value_);\n\n    if (\n      this.sourceBlock_ &&\n      eventUtils.isEnabled() &&\n      this.valueWhenEditorWasOpened_ !== null &&\n      this.valueWhenEditorWasOpened_ !== this.value_\n    ) {\n      // When closing a field input widget, fire an event indicating that the\n      // user has completed a sequence of changes. The value may have changed\n      // multiple times while the editor was open, but this will fire an event\n      // containing the value when the editor was opened as well as the new one.\n      eventUtils.fire(\n        new (eventUtils.get(EventType.BLOCK_CHANGE))(\n          this.sourceBlock_,\n          'field',\n          this.name || null,\n          this.valueWhenEditorWasOpened_,\n          this.value_,\n        ),\n      );\n      this.valueWhenEditorWasOpened_ = null;\n    }\n\n    eventUtils.setGroup(false);\n\n    // Actual disposal.\n    this.unbindInputEvents_();\n    const style = WidgetDiv.getDiv()!.style;\n    style.width = 'auto';\n    style.height = 'auto';\n    style.fontSize = '';\n    style.transition = '';\n    style.boxShadow = '';\n    this.htmlInput_ = null;\n\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    dom.removeClass(clickTarget, 'editing');\n  }\n\n  /**\n   * A callback triggered when the user is done editing the field via the UI.\n   *\n   * @param _value The new value of the field.\n   */\n  onFinishEditing_(_value: AnyDuringMigration) {}\n\n  /**\n   * Bind handlers for user input on the text input field's editor.\n   *\n   * @param htmlInput The htmlInput to which event handlers will be bound.\n   */\n  protected bindInputEvents_(htmlInput: HTMLElement) {\n    // Trap Enter without IME and Esc to hide.\n    this.onKeyDownWrapper = browserEvents.conditionalBind(\n      htmlInput,\n      'keydown',\n      this,\n      this.onHtmlInputKeyDown_,\n    );\n    // Resize after every input change.\n    this.onKeyInputWrapper = browserEvents.conditionalBind(\n      htmlInput,\n      'input',\n      this,\n      this.onHtmlInputChange,\n    );\n  }\n\n  /** Unbind handlers for user input and workspace size changes. */\n  protected unbindInputEvents_() {\n    if (this.onKeyDownWrapper) {\n      browserEvents.unbind(this.onKeyDownWrapper);\n      this.onKeyDownWrapper = null;\n    }\n    if (this.onKeyInputWrapper) {\n      browserEvents.unbind(this.onKeyInputWrapper);\n      this.onKeyInputWrapper = null;\n    }\n  }\n\n  /**\n   * Handle key down to the editor.\n   *\n   * @param e Keyboard event.\n   */\n  protected onHtmlInputKeyDown_(e: KeyboardEvent) {\n    if (e.key === 'Enter') {\n      WidgetDiv.hideIfOwner(this);\n      dropDownDiv.hideWithoutAnimation();\n    } else if (e.key === 'Escape') {\n      this.setValue(\n        this.htmlInput_!.getAttribute('data-untyped-default-value'),\n        false,\n      );\n      WidgetDiv.hideIfOwner(this);\n      dropDownDiv.hideWithoutAnimation();\n    } else if (e.key === 'Tab') {\n      WidgetDiv.hideIfOwner(this);\n      dropDownDiv.hideWithoutAnimation();\n      (this.sourceBlock_ as BlockSvg).tab(this, !e.shiftKey);\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Handle a change to the editor.\n   *\n   * @param _e Keyboard event.\n   */\n  private onHtmlInputChange(_e: Event) {\n    // Intermediate value changes from user input are not confirmed until the\n    // user closes the editor, and may be numerous. Inhibit reporting these as\n    // normal block change events, and instead report them as special\n    // intermediate changes that do not get recorded in undo history.\n    const oldValue = this.value_;\n    // Change the field's value without firing the normal change event.\n    this.setValue(\n      this.getValueFromEditorText_(this.htmlInput_!.value),\n      /* fireChangeEvent= */ false,\n    );\n    if (\n      this.sourceBlock_ &&\n      eventUtils.isEnabled() &&\n      this.value_ !== oldValue\n    ) {\n      // Fire a special event indicating that the value changed but the change\n      // isn't complete yet and normal field change listeners can wait.\n      eventUtils.fire(\n        new (eventUtils.get(EventType.BLOCK_FIELD_INTERMEDIATE_CHANGE))(\n          this.sourceBlock_,\n          this.name || null,\n          oldValue,\n          this.value_,\n        ),\n      );\n    }\n  }\n\n  /**\n   * Set the HTML input value and the field's internal value. The difference\n   * between this and `setValue` is that this also updates the HTML input\n   * value whilst editing.\n   *\n   * @param newValue New value.\n   * @param fireChangeEvent Whether to fire a change event. Defaults to true.\n   *     Should usually be true unless the change will be reported some other\n   *     way, e.g. an intermediate field change event.\n   */\n  protected setEditorValue_(\n    newValue: AnyDuringMigration,\n    fireChangeEvent = true,\n  ) {\n    this.isDirty_ = true;\n    if (this.isBeingEdited_) {\n      // In the case this method is passed an invalid value, we still\n      // pass it through the transformation method `getEditorText` to deal\n      // with. Otherwise, the internal field's state will be inconsistent\n      // with what's shown to the user.\n      this.htmlInput_!.value = this.getEditorText_(newValue);\n    }\n    this.setValue(newValue, fireChangeEvent);\n  }\n\n  /** Resize the editor to fit the text. */\n  protected resizeEditor_() {\n    renderManagement.finishQueuedRenders().then(() => {\n      const block = this.getSourceBlock();\n      if (!block) throw new UnattachedFieldError();\n      const div = WidgetDiv.getDiv();\n      const bBox = this.getScaledBBox();\n      div!.style.width = bBox.right - bBox.left + 'px';\n      div!.style.height = bBox.bottom - bBox.top + 'px';\n\n      // In RTL mode block fields and LTR input fields the left edge moves,\n      // whereas the right edge is fixed.  Reposition the editor.\n      const x = block.RTL ? bBox.right - div!.offsetWidth : bBox.left;\n      const y = bBox.top;\n\n      div!.style.left = `${x}px`;\n      div!.style.top = `${y}px`;\n    });\n  }\n\n  /**\n   * Handles repositioning the WidgetDiv used for input fields when the\n   * workspace is resized. Will bump the block into the viewport and update the\n   * position of the text input if necessary.\n   *\n   * @returns True for rendered workspaces, as we never want to hide the widget\n   *     div.\n   */\n  override repositionForWindowResize(): boolean {\n    const block = this.getSourceBlock()?.getRootBlock();\n    // This shouldn't be possible. We should never have a WidgetDiv if not using\n    // rendered blocks.\n    if (!(block instanceof BlockSvg)) return false;\n\n    const bumped = bumpObjects.bumpIntoBounds(\n      this.workspace_!,\n      this.workspace_!.getMetricsManager().getViewMetrics(true),\n      block,\n    );\n\n    if (!bumped) this.resizeEditor_();\n\n    return true;\n  }\n\n  /**\n   * Returns whether or not the field is tab navigable.\n   *\n   * @returns True if the field is tab navigable.\n   */\n  override isTabNavigable(): boolean {\n    return true;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation. When we're currently editing, return the current HTML value\n   * instead. Otherwise, return null which tells the field to use the default\n   * behaviour (which is a string cast of the field's value).\n   *\n   * @returns The HTML value if we're editing, otherwise null.\n   */\n  protected override getText_(): string | null {\n    if (this.isBeingEdited_ && this.htmlInput_) {\n      // We are currently editing, return the HTML input value instead.\n      return this.htmlInput_.value;\n    }\n    return null;\n  }\n\n  /**\n   * Transform the provided value into a text to show in the HTML input.\n   * Override this method if the field's HTML input representation is different\n   * than the field's value. This should be coupled with an override of\n   * `getValueFromEditorText_`.\n   *\n   * @param value The value stored in this field.\n   * @returns The text to show on the HTML input.\n   */\n  protected getEditorText_(value: AnyDuringMigration): string {\n    return `${value}`;\n  }\n\n  /**\n   * Transform the text received from the HTML input into a value to store\n   * in this field.\n   * Override this method if the field's HTML input representation is different\n   * than the field's value. This should be coupled with an override of\n   * `getEditorText_`.\n   *\n   * @param text Text received from the HTML input.\n   * @returns The value to store.\n   */\n  protected getValueFromEditorText_(text: string): AnyDuringMigration {\n    return text;\n  }\n}\n\n/**\n * Config options for the input field.\n *\n * @internal\n */\nexport interface FieldInputConfig extends FieldConfig {\n  spellcheck?: boolean;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n * @internal\n */\nexport type FieldInputValidator<T extends InputTypes> = FieldValidator<\n  string | T\n>;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text input field.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldTextInput\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport {Field} from './field.js';\nimport {\n  FieldInput,\n  FieldInputConfig,\n  FieldInputValidator,\n} from './field_input.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for an editable text field.\n */\nexport class FieldTextInput extends FieldInput<string> {\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a string & returns a validated string, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | typeof Field.SKIP_SETUP,\n    validator?: FieldTextInputValidator | null,\n    config?: FieldTextInputConfig,\n  ) {\n    super(value, validator, config);\n  }\n\n  /**\n   * Ensure that the input value casts to a valid string.\n   *\n   * @param newValue The input value.\n   * @returns A valid string, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): string | null {\n    if (newValue === undefined) {\n      return null;\n    }\n    return `${newValue}`;\n  }\n\n  /**\n   * Construct a FieldTextInput from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and spellcheck).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldTextInputFromJsonConfig,\n  ): FieldTextInput {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldTextInput if that class doesn't\n    // override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_input', FieldTextInput);\n\nFieldTextInput.prototype.DEFAULT_VALUE = '';\n\n/**\n *  Config options for the text input field.\n */\nexport type FieldTextInputConfig = FieldInputConfig;\n\n/**\n * fromJson config options for the text input field.\n */\nexport interface FieldTextInputFromJsonConfig extends FieldTextInputConfig {\n  text?: string;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldTextInputValidator = FieldInputValidator<string>;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.BottomRow\n\nimport type {BlockSvg} from '../../../block_svg.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {BottomRow as BaseBottomRow} from '../../../renderers/measurables/bottom_row.js';\n\n/**\n * An object containing information about what elements are in the bottom row of\n * a block as well as spacing information for the top row.\n * Elements in a bottom row can consist of corners, spacers and next\n * connections.\n */\nexport class BottomRow extends BaseBottomRow {\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasLeftSquareCorner(block: BlockSvg) {\n    return !!block.outputConnection;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasRightSquareCorner(block: BlockSvg) {\n    return (\n      !!block.outputConnection &&\n      !block.statementInputCount &&\n      !block.nextConnection\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.StatementInput\n\nimport type {Input} from '../../../inputs/input.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {StatementInput as BaseStatementInput} from '../../../renderers/measurables/statement_input.js';\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering.\n */\nexport class StatementInput extends BaseStatementInput {\n  connectedBottomNextConnection = false;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n\n    if (this.connectedBlock) {\n      // Find the bottom-most connected block in the stack.\n      let block = this.connectedBlock;\n      let nextBlock;\n      while ((nextBlock = block.getNextBlock())) {\n        block = nextBlock;\n      }\n      if (!block.nextConnection) {\n        this.height = this.connectedBlockHeight;\n        this.connectedBottomNextConnection = true;\n      }\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.RightConnectionShape\n\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {Measurable} from '../../../renderers/measurables/base.js';\nimport {Types} from '../../../renderers/measurables/types.js';\n\n/**\n * An object containing information about the space a right connection shape\n * takes up during rendering.\n */\nexport class RightConnectionShape extends Measurable {\n  // Size is dynamic\n  override height = 0;\n  override width = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.getType('RIGHT_CONNECTION');\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.TopRow\n\nimport type {BlockSvg} from '../../../block_svg.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {TopRow as BaseTopRow} from '../../../renderers/measurables/top_row.js';\n\n/**\n * An object containing information about what elements are in the top row of a\n * block as well as sizing information for the top row.\n * Elements in a top row can consist of corners, hats, spacers, and previous\n * connections.\n * After this constructor is called, the row will contain all non-spacer\n * elements it needs.\n */\nexport class TopRow extends BaseTopRow {\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasLeftSquareCorner(block: BlockSvg) {\n    const hasHat =\n      (block.hat ? block.hat === 'cap' : this.constants_.ADD_START_HATS) &&\n      !block.outputConnection &&\n      !block.previousConnection;\n    return !!block.outputConnection || hasHat;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasRightSquareCorner(block: BlockSvg) {\n    return (\n      !!block.outputConnection &&\n      !block.statementInputCount &&\n      !block.nextConnection\n    );\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {FieldImage} from '../../field_image.js';\nimport {FieldLabel} from '../../field_label.js';\nimport {FieldTextInput} from '../../field_textinput.js';\nimport {Align} from '../../inputs/align.js';\nimport {DummyInput} from '../../inputs/dummy_input.js';\nimport {EndRowInput} from '../../inputs/end_row_input.js';\nimport {Input} from '../../inputs/input.js';\nimport {StatementInput} from '../../inputs/statement_input.js';\nimport {ValueInput} from '../../inputs/value_input.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InputConnection} from '../measurables/input_connection.js';\nimport type {Row} from '../measurables/row.js';\nimport type {SpacerRow} from '../measurables/spacer_row.js';\nimport {Types} from '../measurables/types.js';\nimport type {ConstantProvider, InsideCorners} from './constants.js';\nimport {BottomRow} from './measurables/bottom_row.js';\nimport {StatementInput as StatementInputMeasurable} from './measurables/inputs.js';\nimport {RightConnectionShape} from './measurables/row_elements.js';\nimport {TopRow} from './measurables/top_row.js';\nimport type {PathObject} from './path_object.js';\nimport type {Renderer} from './renderer.js';\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  override topRow: TopRow;\n  override bottomRow: BottomRow;\n  override constants_: ConstantProvider;\n  override renderer_: Renderer;\n\n  override isInline = true;\n  isMultiRow: boolean;\n  hasStatementInput: boolean;\n  rightSide: RightConnectionShape | null;\n  private readonly rightAlignedDummyInputs: WeakMap<Row, Input>;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n\n    this.renderer_ = renderer;\n\n    this.constants_ = this.renderer_.getConstants();\n\n    /**\n     * An object with rendering information about the top row of the block.\n     */\n    this.topRow = new TopRow(this.constants_);\n\n    /**\n     * An object with rendering information about the bottom row of the block.\n     */\n    this.bottomRow = new BottomRow(this.constants_);\n\n    /**\n     * Whether the block should be rendered as a multi-line block, either\n     * because it's not inline or because it has been collapsed.\n     */\n    this.isMultiRow = !block.getInputsInline() || block.isCollapsed();\n\n    /**\n     * Whether or not the block has a statement input in one of its rows.\n     */\n    this.hasStatementInput = block.statementInputCount > 0;\n\n    /**\n     * An object with rendering information about the right connection shape.\n     */\n    this.rightSide = this.outputConnection\n      ? new RightConnectionShape(this.constants_)\n      : null;\n\n    /**\n     * A map of rows to right aligned dummy inputs within those rows. Used to\n     * add padding between left and right aligned inputs.\n     */\n    this.rightAlignedDummyInputs = new WeakMap();\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_ as Renderer;\n  }\n\n  override measure() {\n    // Modifying parent measure method to add `adjustXPosition_`.\n    this.createRows_();\n    this.addElemSpacing_();\n    this.addRowSpacing_();\n    this.adjustXPosition_();\n    this.computeBounds_();\n    this.alignRowElements_();\n    this.finalize_();\n  }\n\n  override shouldStartNewRow_(currInput: Input, prevInput: Input): boolean {\n    // If this is the first input, just add to the existing row.\n    // That row is either empty or has some icons in it.\n    if (!prevInput) {\n      return false;\n    }\n    // If the previous input was an end-row input, then any following input\n    // should always be rendered on the next row.\n    if (prevInput instanceof EndRowInput) {\n      return true;\n    }\n    // A statement input or an input following one always gets a new row.\n    if (\n      currInput instanceof StatementInput ||\n      prevInput instanceof StatementInput\n    ) {\n      return true;\n    }\n    // Value, dummy, and end-row inputs get new row if inputs are not inlined.\n    if (\n      currInput instanceof ValueInput ||\n      currInput instanceof DummyInput ||\n      currInput instanceof EndRowInput\n    ) {\n      return !this.isInline || this.isMultiRow;\n    }\n    return false;\n  }\n\n  override getDesiredRowWidth_(row: Row): number {\n    if (row.hasStatement) {\n      const rightCornerWidth =\n        (this.constants_.INSIDE_CORNERS as InsideCorners).rightWidth || 0;\n      return this.width - this.startX - rightCornerWidth;\n    }\n    return super.getDesiredRowWidth_(row);\n  }\n\n  override getInRowSpacing_(\n    prev: Measurable | null,\n    next: Measurable | null,\n  ): number {\n    if (!prev || !next) {\n      // No need for padding at the beginning or end of the row if the\n      // output shape is dynamic.\n      if (\n        this.outputConnection &&\n        this.outputConnection.isDynamicShape &&\n        !this.hasStatementInput &&\n        !this.bottomRow.hasNextConnection\n      ) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n    if (!prev) {\n      // Statement input padding.\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n    }\n    // Spacing between a rounded corner and a previous or next connection.\n    if (prev && Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      }\n    }\n    // Spacing between a square corner and a hat.\n    if (prev && Types.isLeftSquareCorner(prev) && next && Types.isHat(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row): number {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    const followsStatement = Types.isInputRow(prev) && prev.hasStatement;\n    const precedesStatement = Types.isInputRow(next) && next.hasStatement;\n    if (precedesStatement || followsStatement) {\n      const cornerHeight =\n        (this.constants_.INSIDE_CORNERS as InsideCorners).rightHeight || 0;\n      const height = Math.max(this.constants_.NOTCH_HEIGHT, cornerHeight);\n      return precedesStatement && followsStatement\n        ? Math.max(height, this.constants_.DUMMY_INPUT_MIN_HEIGHT)\n        : height;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev)) {\n      const topRow = prev as TopRow;\n      if (\n        !topRow.hasPreviousConnection &&\n        (!this.outputConnection || this.hasStatementInput)\n      ) {\n        return Math.abs(\n          this.constants_.NOTCH_HEIGHT - this.constants_.CORNER_RADIUS,\n        );\n      }\n      return this.constants_.NO_PADDING;\n    }\n    if (Types.isBottomRow(next)) {\n      const bottomRow = next as BottomRow;\n      if (!this.outputConnection) {\n        const topHeight =\n          Math.max(\n            this.topRow.minHeight,\n            Math.max(\n              this.constants_.NOTCH_HEIGHT,\n              this.constants_.CORNER_RADIUS,\n            ),\n          ) - this.constants_.CORNER_RADIUS;\n        return topHeight;\n      } else if (!bottomRow.hasNextConnection && this.hasStatementInput) {\n        return Math.abs(\n          this.constants_.NOTCH_HEIGHT - this.constants_.CORNER_RADIUS,\n        );\n      }\n      return this.constants_.NO_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowWidth_(prev: Row, next: Row): number {\n    const width = this.width - this.startX;\n    if (\n      (Types.isInputRow(prev) && prev.hasStatement) ||\n      (Types.isInputRow(next) && next.hasStatement)\n    ) {\n      return Math.max(width, this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH);\n    }\n    return width;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable): number {\n    if (\n      row.hasStatement &&\n      !Types.isSpacer(elem) &&\n      !Types.isStatementInput(elem)\n    ) {\n      return row.yPos + this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT / 2;\n    }\n    if (Types.isInlineInput(elem) && elem instanceof InputConnection) {\n      const connectedBlock = elem.connectedBlock;\n      if (\n        connectedBlock &&\n        connectedBlock.outputConnection &&\n        connectedBlock.nextConnection\n      ) {\n        return row.yPos + connectedBlock.height / 2;\n      }\n    }\n    return super.getElemCenterline_(row, elem);\n  }\n\n  override addInput_(input: Input, activeRow: Row) {\n    // If we have two dummy inputs on the same row, one aligned left and the\n    // other right, keep track of the right aligned dummy input so we can add\n    // padding later. An end-row input after a dummy input also counts.\n    if (\n      (input instanceof DummyInput || input instanceof EndRowInput) &&\n      activeRow.hasDummyInput &&\n      activeRow.align === Align.LEFT &&\n      input.align === Align.RIGHT\n    ) {\n      this.rightAlignedDummyInputs.set(activeRow, input);\n    } else if (input instanceof StatementInput) {\n      // Handle statements without next connections correctly.\n      activeRow.elements.push(\n        new StatementInputMeasurable(this.constants_, input),\n      );\n      activeRow.hasStatement = true;\n\n      if (activeRow.align === null) {\n        activeRow.align = input.align;\n      }\n      return;\n    }\n    super.addInput_(input, activeRow);\n  }\n\n  override addAlignmentPadding_(row: Row, missingSpace: number) {\n    if (this.rightAlignedDummyInputs.get(row)) {\n      let alignmentDivider;\n      for (let i = 0; i < row.elements.length; i++) {\n        const elem = row.elements[i];\n        if (Types.isSpacer(elem)) {\n          alignmentDivider = elem;\n        }\n        if (\n          Types.isField(elem) &&\n          elem instanceof Field &&\n          elem.parentInput === this.rightAlignedDummyInputs.get(row)\n        ) {\n          break;\n        }\n      }\n      if (alignmentDivider) {\n        alignmentDivider.width += missingSpace;\n        row.width += missingSpace;\n        return;\n      }\n    }\n    super.addAlignmentPadding_(row, missingSpace);\n  }\n\n  /**\n   * Adjust the x position of fields to bump all non-label fields in the first\n   * row past the notch position.  This must be called before `computeBounds`\n   * is called.\n   */\n  protected adjustXPosition_() {\n    const notchTotalWidth =\n      this.constants_.NOTCH_OFFSET_LEFT + this.constants_.NOTCH_WIDTH;\n    let minXPos = notchTotalWidth;\n    // Run through every input row on the block and only apply bump logic to the\n    // first input row (if the block has prev connection) and every input row\n    // that has a prev and next notch.\n    for (let i = 2; i < this.rows.length - 1; i += 2) {\n      const prevSpacer = this.rows[i - 1] as SpacerRow;\n      const row = this.rows[i];\n      const nextSpacer = this.rows[i + 1] as SpacerRow;\n\n      const hasPrevNotch =\n        i === 2\n          ? !!this.topRow.hasPreviousConnection\n          : !!prevSpacer.followsStatement;\n      const hasNextNotch =\n        i + 2 >= this.rows.length - 1\n          ? !!this.bottomRow.hasNextConnection\n          : !!nextSpacer.precedesStatement;\n\n      if (Types.isInputRow(row) && row.hasStatement) {\n        row.measure();\n        minXPos =\n          row.width - (row.getLastInput()?.width ?? 0) + notchTotalWidth;\n      } else if (\n        hasPrevNotch &&\n        (i === 2 || hasNextNotch) &&\n        Types.isInputRow(row) &&\n        !row.hasStatement\n      ) {\n        let xCursor = row.xPos;\n        let prevInRowSpacer = null;\n        for (let j = 0; j < row.elements.length; j++) {\n          const elem = row.elements[j];\n          if (Types.isSpacer(elem)) {\n            prevInRowSpacer = elem;\n          }\n          if (prevInRowSpacer && (Types.isField(elem) || Types.isInput(elem))) {\n            if (\n              xCursor < minXPos &&\n              !(\n                Types.isField(elem) &&\n                elem instanceof Field &&\n                (elem.field instanceof FieldLabel ||\n                  elem.field instanceof FieldImage)\n              )\n            ) {\n              const difference = minXPos - xCursor;\n              prevInRowSpacer.width += difference;\n            }\n          }\n          xCursor += elem.width;\n        }\n      }\n    }\n  }\n\n  /**\n   * Finalize the output connection info.  In particular, set the height of the\n   * output connection to match that of the block.  For the right side, add a\n   * right connection shape element and have it match the dimensions of the\n   * output connection.\n   */\n  protected finalizeOutputConnection_() {\n    // Dynamic output connections depend on the height of the block.\n    if (!this.outputConnection || !this.outputConnection.isDynamicShape) {\n      return;\n    }\n    const outputConnectionShape = this.outputConnection.shape;\n    if (\n      !('isDynamic' in outputConnectionShape && outputConnectionShape.isDynamic)\n    ) {\n      return;\n    }\n\n    let yCursor = 0;\n    // Determine the block height.\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      row.yPos = yCursor;\n      yCursor += row.height;\n    }\n    this.height = yCursor;\n\n    // Adjust the height of the output connection.\n    const blockHeight = this.bottomRow.hasNextConnection\n      ? this.height - this.bottomRow.descenderHeight\n      : this.height;\n    const connectionHeight = outputConnectionShape.height(blockHeight);\n    const connectionWidth = outputConnectionShape.width(blockHeight);\n\n    this.outputConnection.height = connectionHeight;\n    this.outputConnection.width = connectionWidth;\n    this.outputConnection.startX = connectionWidth;\n    this.outputConnection.connectionOffsetY =\n      outputConnectionShape.connectionOffsetY(connectionHeight);\n    this.outputConnection.connectionOffsetX =\n      outputConnectionShape.connectionOffsetX(connectionWidth);\n\n    // Add the right connection measurable.\n    // Don't add it if we have a value-to-statement or a value-to-stack block.\n    let rightConnectionWidth = 0;\n    if (!this.hasStatementInput && !this.bottomRow.hasNextConnection) {\n      rightConnectionWidth = connectionWidth;\n      this.rightSide!.height = connectionHeight;\n      this.rightSide!.width = rightConnectionWidth;\n      this.rightSide!.centerline = connectionHeight / 2;\n      this.rightSide!.xPos = this.width + rightConnectionWidth;\n    }\n    this.startX = connectionWidth;\n    this.width += connectionWidth + rightConnectionWidth;\n    this.widthWithChildren += connectionWidth + rightConnectionWidth;\n  }\n\n  /**\n   * Finalize horizontal alignment of elements on the block.  In particular,\n   * reduce the implicit spacing created by the left and right output connection\n   * shapes by adding setting negative spacing onto the leftmost and rightmost\n   * spacers.\n   */\n  protected finalizeHorizontalAlignment_() {\n    if (\n      !this.outputConnection ||\n      this.hasStatementInput ||\n      this.bottomRow.hasNextConnection\n    ) {\n      return;\n    }\n    let totalNegativeSpacing = 0;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      if (!Types.isInputRow(row)) {\n        continue;\n      }\n      const firstElem = row.elements[1];\n      const lastElem = row.elements[row.elements.length - 2];\n      let leftNegPadding = this.getNegativeSpacing_(firstElem);\n      let rightNegPadding = this.getNegativeSpacing_(lastElem);\n      totalNegativeSpacing = leftNegPadding + rightNegPadding;\n      const minBlockWidth =\n        this.constants_.MIN_BLOCK_WIDTH + this.outputConnection.width * 2;\n      if (this.width - totalNegativeSpacing < minBlockWidth) {\n        // Maintain a minimum block width, split negative spacing between left\n        // and right edge.\n        totalNegativeSpacing = this.width - minBlockWidth;\n        leftNegPadding = totalNegativeSpacing / 2;\n        rightNegPadding = totalNegativeSpacing / 2;\n      }\n      // Add a negative spacer on the start and end of the block.\n      row.elements.unshift(new InRowSpacer(this.constants_, -leftNegPadding));\n      row.elements.push(new InRowSpacer(this.constants_, -rightNegPadding));\n    }\n    if (totalNegativeSpacing) {\n      this.width -= totalNegativeSpacing;\n      this.widthWithChildren -= totalNegativeSpacing;\n      this.rightSide!.xPos -= totalNegativeSpacing;\n      for (let i = 0; i < this.rows.length; i++) {\n        const row = this.rows[i];\n        if (Types.isTopOrBottomRow(row)) {\n          row.elements[1].width -= totalNegativeSpacing;\n        }\n        row.width -= totalNegativeSpacing;\n        row.widthWithConnectedBlocks -= totalNegativeSpacing;\n      }\n    }\n  }\n\n  /**\n   * Calculate the spacing to reduce the left and right edges by based on the\n   * outer and inner connection shape.\n   *\n   * @param elem The first or last element on a block.\n   * @returns The amount of spacing to reduce the first or last spacer.\n   */\n  protected getNegativeSpacing_(elem: Measurable): number {\n    if (!elem || !this.outputConnection) {\n      return 0;\n    }\n    const connectionWidth = this.outputConnection.width;\n    const outerShape = this.outputConnection.shape.type;\n    const constants = this.constants_;\n    if (this.inputRows.length > 1) {\n      switch (outerShape) {\n        case constants.SHAPES.ROUND: {\n          // Special case for multi-row round reporter blocks.\n          const maxWidth = this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n          const width = this.height / 2 > maxWidth ? maxWidth : this.height / 2;\n          const topPadding = this.constants_.SMALL_PADDING;\n          const roundPadding =\n            width * (1 - Math.sin(Math.acos((width - topPadding) / width)));\n          return connectionWidth - roundPadding;\n        }\n        default:\n          return 0;\n      }\n    }\n    if (Types.isInlineInput(elem) && elem instanceof InputConnection) {\n      const connectedBlock = elem.connectedBlock;\n      const innerShape = connectedBlock\n        ? (connectedBlock.pathObject as PathObject).outputShapeType\n        : elem.shape.type;\n      if (innerShape == null) {\n        return 0;\n      }\n      // Special case for value to stack / value to statement blocks.\n      if (\n        connectedBlock &&\n        connectedBlock.outputConnection &&\n        (connectedBlock.statementInputCount || connectedBlock.nextConnection)\n      ) {\n        return 0;\n      }\n      // Special case for hexagonal output.\n      if (\n        outerShape === constants.SHAPES.HEXAGONAL &&\n        outerShape !== innerShape\n      ) {\n        return 0;\n      }\n      return (\n        connectionWidth -\n        this.constants_.SHAPE_IN_SHAPE_PADDING[outerShape][innerShape]\n      );\n    } else if (Types.isField(elem) && elem instanceof Field) {\n      // Special case for text inputs.\n      if (\n        outerShape === constants.SHAPES.ROUND &&\n        elem.field instanceof FieldTextInput\n      ) {\n        return connectionWidth - 2.75 * constants.GRID_UNIT;\n      }\n      return (\n        connectionWidth - this.constants_.SHAPE_IN_SHAPE_PADDING[outerShape][0]\n      );\n    } else if (Types.isIcon(elem)) {\n      return this.constants_.SMALL_PADDING;\n    }\n    return 0;\n  }\n\n  /**\n   * Finalize vertical alignment of rows on a block.  In particular, reduce the\n   * implicit spacing when a non-shadow block is connected to any of an input\n   * row's inline inputs.\n   */\n  protected finalizeVerticalAlignment_() {\n    if (this.outputConnection) {\n      return;\n    }\n    // Run through every input row on the block and only apply tight nesting\n    // logic to input rows that have a prev and next notch.\n    for (let i = 2; i < this.rows.length - 1; i += 2) {\n      const prevSpacer = this.rows[i - 1] as SpacerRow;\n      const row = this.rows[i];\n      const nextSpacer = this.rows[i + 1] as SpacerRow;\n\n      const firstRow = i === 2;\n      const hasPrevNotch = firstRow\n        ? !!this.topRow.hasPreviousConnection\n        : !!prevSpacer.followsStatement;\n      const hasNextNotch =\n        i + 2 >= this.rows.length - 1\n          ? !!this.bottomRow.hasNextConnection\n          : !!nextSpacer.precedesStatement;\n\n      if (hasPrevNotch) {\n        const elem = row.elements[1];\n        const hasSingleTextOrImageField =\n          row.elements.length === 3 &&\n          elem instanceof Field &&\n          (elem.field instanceof FieldLabel ||\n            elem.field instanceof FieldImage);\n        if (!firstRow && hasSingleTextOrImageField) {\n          // Remove some padding if we have a single image or text field.\n          prevSpacer.height -= this.constants_.SMALL_PADDING;\n          nextSpacer.height -= this.constants_.SMALL_PADDING;\n          row.height -= this.constants_.MEDIUM_PADDING;\n        } else if (!firstRow && !hasNextNotch) {\n          // Add a small padding so the notch doesn't clash with inputs/fields.\n          prevSpacer.height += this.constants_.SMALL_PADDING;\n        } else if (hasNextNotch) {\n          // Determine if the input row has non-shadow connected blocks.\n          let hasNonShadowConnectedBlocks = false;\n          const minVerticalTightNestingHeight = 40;\n          for (let j = 0; j < row.elements.length; j++) {\n            const elem = row.elements[j];\n            if (\n              elem instanceof InputConnection &&\n              Types.isInlineInput(elem) &&\n              elem.connectedBlock &&\n              !elem.connectedBlock.isShadow() &&\n              elem.connectedBlock.getHeightWidth().height >=\n                minVerticalTightNestingHeight\n            ) {\n              hasNonShadowConnectedBlocks = true;\n              break;\n            }\n          }\n          // Apply tight-nesting if we have both a prev and next notch and the\n          // block has non-shadow connected blocks.\n          if (hasNonShadowConnectedBlocks) {\n            prevSpacer.height -= this.constants_.SMALL_PADDING;\n            nextSpacer.height -= this.constants_.SMALL_PADDING;\n          }\n        }\n      }\n    }\n  }\n\n  override finalize_() {\n    this.finalizeOutputConnection_();\n    this.finalizeHorizontalAlignment_();\n    this.finalizeVerticalAlignment_();\n    super.finalize_();\n\n    if (this.rightSide) {\n      this.widthWithChildren += this.rightSide.width;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.MarkerSvg\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ASTNode} from '../../keyboard_nav/ast_node.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\nimport {MarkerSvg as BaseMarkerSvg} from '../common/marker_svg.js';\nimport type {ConstantProvider as ZelosConstantProvider} from './constants.js';\n\n/**\n * Class to draw a marker.\n */\nexport class MarkerSvg extends BaseMarkerSvg {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  constants_!: ZelosConstantProvider;\n\n  private markerCircle: SVGCircleElement | null = null;\n\n  /**\n   * @param workspace The workspace the marker belongs to.\n   * @param constants The constants for the renderer.\n   * @param marker The marker to draw.\n   */\n  constructor(\n    workspace: WorkspaceSvg,\n    constants: BaseConstantProvider,\n    marker: Marker,\n  ) {\n    super(workspace, constants, marker);\n  }\n\n  /**\n   * Position and display the marker for an input or an output connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  private showWithInputOutput(curNode: ASTNode) {\n    const block = curNode.getSourceBlock() as BlockSvg;\n    const connection = curNode.getLocation() as RenderedConnection;\n    const offsetInBlock = connection.getOffsetInBlock();\n\n    this.positionCircle(offsetInBlock.x, offsetInBlock.y);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  override showWithOutput_(curNode: ASTNode) {\n    this.showWithInputOutput(curNode);\n  }\n\n  override showWithInput_(curNode: ASTNode) {\n    this.showWithInputOutput(curNode);\n  }\n\n  /**\n   * Draw a rectangle around the block.\n   *\n   * @param curNode The current node of the marker.\n   */\n  override showWithBlock_(curNode: ASTNode) {\n    const block = curNode.getLocation() as BlockSvg;\n\n    // Gets the height and width of entire stack.\n    const heightWidth = block.getHeightWidth();\n    // Add padding so that being on a stack looks different than being on a\n    // block.\n    this.positionRect_(0, 0, heightWidth.width, heightWidth.height);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position the circle we use for input and output connections.\n   *\n   * @param x The x position of the circle.\n   * @param y The y position of the circle.\n   */\n  private positionCircle(x: number, y: number) {\n    this.markerCircle?.setAttribute('cx', `${x}`);\n    this.markerCircle?.setAttribute('cy', `${y}`);\n    this.currentMarkerSvg = this.markerCircle;\n  }\n\n  override hide() {\n    super.hide();\n    if (this.markerCircle) {\n      this.markerCircle.style.display = 'none';\n    }\n  }\n\n  override createDomInternal_() {\n    /* clang-format off */\n    /* This markup will be generated and added to the .svgGroup_:\n        <g>\n          <rect width=\"100\" height=\"5\">\n            <animate attributeType=\"XML\" attributeName=\"fill\" dur=\"1s\"\n              values=\"transparent;transparent;#fff;transparent\" repeatCount=\"indefinite\" />\n          </rect>\n        </g>\n        */\n    /* clang-format on */\n    super.createDomInternal_();\n\n    this.markerCircle = dom.createSvgElement(\n      Svg.CIRCLE,\n      {\n        'r': this.constants_.CURSOR_RADIUS,\n        'stroke-width': this.constants_.CURSOR_STROKE_WIDTH,\n      },\n      this.markerSvg_,\n    );\n    this.hide();\n\n    // Markers and stack cursors don't blink.\n    if (this.isCursor()) {\n      const blinkProperties = this.getBlinkProperties_();\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerCircle!);\n    }\n\n    return this.markerSvg_!;\n  }\n\n  override applyColour_(curNode: ASTNode) {\n    super.applyColour_(curNode);\n\n    this.markerCircle?.setAttribute('fill', this.colour_);\n    this.markerCircle?.setAttribute('stroke', this.colour_);\n\n    if (this.isCursor()) {\n      const values = this.colour_ + ';transparent;transparent;';\n      this.markerCircle?.firstElementChild!.setAttribute('values', values);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.PathObject\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport {PathObject as BasePathObject} from '../common/path_object.js';\nimport type {ConstantProvider} from './constants.js';\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n */\nexport class PathObject extends BasePathObject {\n  /** The selected path of the block. */\n  private svgPathSelected: SVGElement | null = null;\n\n  /** The outline paths on the block. */\n  private readonly outlines = new Map<string, SVGElement>();\n\n  /**\n   * A set used to determine which outlines were used during a draw pass.  The\n   * set is initialized with a reference to all the outlines in\n   * `this.outlines`. Every time we use an outline during the draw pass, the\n   * reference is removed from this set.\n   */\n  private remainingOutlines = new Set<string>();\n\n  /**\n   * The type of block's output connection shape.  This is set when a block\n   * with an output connection is drawn.\n   */\n  outputShapeType: number | null = null;\n\n  public override constants: ConstantProvider;\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   */\n  constructor(\n    root: SVGElement,\n    style: BlockStyle,\n    constants: ConstantProvider,\n  ) {\n    super(root, style, constants);\n\n    this.constants = constants;\n  }\n\n  override setPath(pathString: string) {\n    super.setPath(pathString);\n    if (this.svgPathSelected) {\n      this.svgPathSelected.setAttribute('d', pathString);\n    }\n  }\n\n  override applyColour(block: BlockSvg) {\n    super.applyColour(block);\n    // Set shadow stroke colour.\n    const parent = block.getParent();\n    if (block.isShadow() && parent) {\n      this.svgPath.setAttribute('stroke', parent.getColourTertiary());\n    }\n\n    // Apply colour to outlines.\n    for (const outline of this.outlines.values()) {\n      outline.setAttribute('fill', this.style.colourTertiary);\n    }\n  }\n\n  override flipRTL() {\n    super.flipRTL();\n    // Mirror each input outline path.\n    for (const outline of this.outlines.values()) {\n      outline.setAttribute('transform', 'scale(-1 1)');\n    }\n  }\n\n  override updateSelected(enable: boolean) {\n    this.setClass_('blocklySelected', enable);\n    if (enable) {\n      if (!this.svgPathSelected) {\n        this.svgPathSelected = this.svgPath.cloneNode(true) as SVGElement;\n        this.svgPathSelected.setAttribute('fill', 'none');\n        this.svgPathSelected.setAttribute(\n          'filter',\n          'url(#' + this.constants.selectedGlowFilterId + ')',\n        );\n        this.svgRoot.appendChild(this.svgPathSelected);\n      }\n    } else {\n      if (this.svgPathSelected) {\n        this.svgRoot.removeChild(this.svgPathSelected);\n        this.svgPathSelected = null;\n      }\n    }\n  }\n\n  override updateReplacementFade(enable: boolean) {\n    this.setClass_('blocklyReplaceable', enable);\n    if (enable) {\n      this.svgPath.setAttribute(\n        'filter',\n        'url(#' + this.constants.replacementGlowFilterId + ')',\n      );\n    } else {\n      this.svgPath.removeAttribute('filter');\n    }\n  }\n\n  override updateShapeForInputHighlight(conn: Connection, enable: boolean) {\n    const name = conn.getParentInput()!.name;\n    const outlinePath = this.getOutlinePath(name);\n    if (!outlinePath) {\n      return;\n    }\n    if (enable) {\n      outlinePath.setAttribute(\n        'filter',\n        'url(#' + this.constants.replacementGlowFilterId + ')',\n      );\n    } else {\n      outlinePath.removeAttribute('filter');\n    }\n  }\n\n  /**\n   * Method that's called when the drawer is about to draw the block.\n   */\n  beginDrawing() {\n    this.remainingOutlines.clear();\n    for (const key of this.outlines.keys()) {\n      this.remainingOutlines.add(key);\n    }\n  }\n\n  /**\n   * Method that's called when the drawer is done drawing.\n   */\n  endDrawing() {\n    // Go through all remaining outlines that were not used this draw pass, and\n    // remove them.\n    if (this.remainingOutlines.size) {\n      for (const key of this.remainingOutlines) {\n        this.removeOutlinePath(key);\n      }\n    }\n    this.remainingOutlines.clear();\n  }\n\n  /**\n   * Set the path generated by the renderer for an outline path on the\n   * respective outline path SVG element.\n   *\n   * @param name The input name.\n   * @param pathString The path.\n   */\n  setOutlinePath(name: string, pathString: string) {\n    const outline = this.getOutlinePath(name);\n    outline.setAttribute('d', pathString);\n    outline.setAttribute('fill', this.style.colourTertiary);\n  }\n\n  /**\n   * Create's an outline path for the specified input.\n   *\n   * @param name The input name.\n   * @returns The SVG outline path.\n   */\n  private getOutlinePath(name: string): SVGElement {\n    if (!this.outlines.has(name)) {\n      this.outlines.set(\n        name,\n        dom.createSvgElement(\n          Svg.PATH,\n          {\n            'class': 'blocklyOutlinePath', // IE doesn't like paths without the\n            // data definition, set empty\n            // default\n            'd': '',\n          },\n          this.svgRoot,\n        ),\n      );\n    }\n    this.remainingOutlines.delete(name);\n    return this.outlines.get(name)!;\n  }\n\n  /**\n   * Remove an outline path that is associated with the specified input.\n   *\n   * @param name The input name.\n   */\n  private removeOutlinePath(name: string) {\n    this.outlines.get(name)?.parentNode?.removeChild(this.outlines.get(name)!);\n    this.outlines.delete(name);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos.Renderer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {InsertionMarkerManager} from '../../insertion_marker_manager.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as deprecation from '../../utils/deprecation.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\n\n/**\n * The zelos renderer. This renderer emulates Scratch-style and MakeCode-style\n * rendering.\n *\n * Zelos is the ancient Greek spirit of rivalry and emulation.\n */\nexport class Renderer extends BaseRenderer {\n  protected override constants_!: ConstantProvider;\n\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected override makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(\n    block: BlockSvg,\n    info: BaseRenderInfo,\n  ): Drawer {\n    return new Drawer(block, info as RenderInfo);\n  }\n\n  /**\n   * Create a new instance of the renderer's cursor drawer.\n   *\n   * @param workspace The workspace the cursor belongs to.\n   * @param marker The marker.\n   * @returns The object in charge of drawing the marker.\n   */\n  override makeMarkerDrawer(\n    workspace: WorkspaceSvg,\n    marker: Marker,\n  ): MarkerSvg {\n    return new MarkerSvg(workspace, this.getConstants(), marker);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   */\n  override makePathObject(root: SVGElement, style: BlockStyle): PathObject {\n    return new PathObject(root, style, this.getConstants() as ConstantProvider);\n  }\n\n  /**\n   * Get the current renderer's constant provider.  We assume that when this is\n   * called, the renderer has already been initialized.\n   *\n   * @returns The constant provider.\n   */\n  override getConstants(): ConstantProvider {\n    return this.constants_;\n  }\n\n  /**\n   * @deprecated v10 - This function is no longer respected. A custom\n   *    IConnectionPreviewer may be able to fulfill the functionality.\n   */\n  override getConnectionPreviewMethod(\n    closest: RenderedConnection,\n    local: RenderedConnection,\n    topBlock: BlockSvg,\n  ) {\n    deprecation.warn(\n      'getConnectionPreviewMethod',\n      'v10',\n      'v12',\n      'an IConnectionPreviewer, if it fulfills your use case.',\n    );\n    if (local.type === ConnectionType.OUTPUT_VALUE) {\n      if (!closest.isConnected()) {\n        return InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE;\n      }\n      // TODO: Returning this is a total hack, because we don't want to show\n      //   a replacement fade, we want to show an outline affect.\n      //   Sadly zelos does not support showing an outline around filled\n      //   inputs, so we have to pretend like the connected block is getting\n      //   replaced.\n      return InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE;\n    }\n\n    return super.getConnectionPreviewMethod(closest, local, topBlock);\n  }\n}\n\nblockRendering.register('zelos', Renderer);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {BlockSvg} from './block_svg.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as eventUtils from './events/utils.js';\nimport {IConnectionPreviewer} from './interfaces/i_connection_previewer.js';\nimport * as registry from './registry.js';\nimport * as renderManagement from './render_management.js';\nimport {RenderedConnection} from './rendered_connection.js';\nimport {Renderer as ZelosRenderer} from './renderers/zelos/renderer.js';\nimport * as blocks from './serialization/blocks.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\nexport class InsertionMarkerPreviewer implements IConnectionPreviewer {\n  private readonly workspace: WorkspaceSvg;\n\n  private fadedBlock: BlockSvg | null = null;\n\n  private markerConn: RenderedConnection | null = null;\n\n  private draggedConn: RenderedConnection | null = null;\n\n  private staticConn: RenderedConnection | null = null;\n\n  constructor(draggedBlock: BlockSvg) {\n    this.workspace = draggedBlock.workspace;\n  }\n\n  /**\n   * Display a connection preview where the draggedCon connects to the\n   * staticCon, replacing the replacedBlock (currently connected to the\n   * staticCon).\n   *\n   * @param draggedConn The connection on the block stack being dragged.\n   * @param staticConn The connection not being dragged that we are\n   *     connecting to.\n   * @param replacedBlock The block currently connected to the staticCon that\n   *     is being replaced.\n   */\n  previewReplacement(\n    draggedConn: RenderedConnection,\n    staticConn: RenderedConnection,\n    replacedBlock: BlockSvg,\n  ) {\n    eventUtils.disable();\n    try {\n      this.hidePreview();\n      this.fadedBlock = replacedBlock;\n      replacedBlock.fadeForReplacement(true);\n      if (this.workspace.getRenderer().shouldHighlightConnection(staticConn)) {\n        staticConn.highlight();\n        this.staticConn = staticConn;\n      }\n    } finally {\n      eventUtils.enable();\n    }\n  }\n\n  /**\n   * Display a connection preview where the draggedCon connects to the\n   * staticCon, and no block is being relaced.\n   *\n   * @param draggedConn The connection on the block stack being dragged.\n   * @param staticConn The connection not being dragged that we are\n   *     connecting to.\n   */\n  previewConnection(\n    draggedConn: RenderedConnection,\n    staticConn: RenderedConnection,\n  ) {\n    if (draggedConn === this.draggedConn && staticConn === this.staticConn) {\n      return;\n    }\n\n    eventUtils.disable();\n    try {\n      this.hidePreview();\n\n      // TODO(7898): Instead of special casing, we should change the dragger to\n      //   track the change in distance between the dragged connection and the\n      //   static connection, so that it doesn't disconnect  unless that\n      //   (+ a bit) has been exceeded.\n      if (this.shouldUseMarkerPreview(draggedConn, staticConn)) {\n        this.markerConn = this.previewMarker(draggedConn, staticConn);\n      }\n\n      if (this.workspace.getRenderer().shouldHighlightConnection(staticConn)) {\n        staticConn.highlight();\n      }\n\n      this.draggedConn = draggedConn;\n      this.staticConn = staticConn;\n    } finally {\n      eventUtils.enable();\n    }\n  }\n\n  private shouldUseMarkerPreview(\n    _draggedConn: RenderedConnection,\n    staticConn: RenderedConnection,\n  ): boolean {\n    return (\n      staticConn.type === ConnectionType.PREVIOUS_STATEMENT ||\n      staticConn.type === ConnectionType.NEXT_STATEMENT ||\n      !(this.workspace.getRenderer() instanceof ZelosRenderer)\n    );\n  }\n\n  private previewMarker(\n    draggedConn: RenderedConnection,\n    staticConn: RenderedConnection,\n  ): RenderedConnection | null {\n    const dragged = draggedConn.getSourceBlock();\n    const marker = this.createInsertionMarker(dragged);\n    const markerConn = this.getMatchingConnection(dragged, marker, draggedConn);\n    if (!markerConn) return null;\n\n    // Render disconnected from everything else so that we have a valid\n    // connection location.\n    marker.queueRender();\n    renderManagement.triggerQueuedRenders();\n\n    // Connect() also renders the insertion marker.\n    markerConn.connect(staticConn);\n\n    const originalOffsetToTarget = {\n      x: staticConn.x - markerConn.x,\n      y: staticConn.y - markerConn.y,\n    };\n    const originalOffsetInBlock = markerConn.getOffsetInBlock().clone();\n    renderManagement.finishQueuedRenders().then(() => {\n      if (marker.isDeadOrDying()) return;\n      eventUtils.disable();\n      try {\n        // Position so that the existing block doesn't move.\n        marker?.positionNearConnection(\n          markerConn,\n          originalOffsetToTarget,\n          originalOffsetInBlock,\n        );\n        marker?.getSvgRoot().setAttribute('visibility', 'visible');\n      } finally {\n        eventUtils.enable();\n      }\n    });\n    return markerConn;\n  }\n\n  private createInsertionMarker(origBlock: BlockSvg) {\n    const blockJson = blocks.save(origBlock, {\n      addCoordinates: false,\n      addInputBlocks: false,\n      addNextBlocks: false,\n      doFullSerialization: false,\n    });\n\n    if (!blockJson) {\n      throw new Error(\n        `Failed to serialize source block. ${origBlock.toDevString()}`,\n      );\n    }\n\n    const result = blocks.append(blockJson, this.workspace) as BlockSvg;\n\n    // Turn shadow blocks that are created programmatically during\n    // initalization to insertion markers too.\n    for (const block of result.getDescendants(false)) {\n      block.setInsertionMarker(true);\n    }\n\n    result.initSvg();\n    result.getSvgRoot().setAttribute('visibility', 'hidden');\n    return result;\n  }\n\n  /**\n   * Gets the connection on the marker block that matches the original\n   * connection on the original block.\n   *\n   * @param orig The original block.\n   * @param marker The marker block (where we want to find the matching\n   *     connection).\n   * @param origConn The original connection.\n   */\n  private getMatchingConnection(\n    orig: BlockSvg,\n    marker: BlockSvg,\n    origConn: RenderedConnection,\n  ): RenderedConnection | null {\n    const origConns = orig.getConnections_(true);\n    const markerConns = marker.getConnections_(true);\n    if (origConns.length !== markerConns.length) return null;\n    for (let i = 0; i < origConns.length; i++) {\n      if (origConns[i] === origConn) {\n        return markerConns[i];\n      }\n    }\n    return null;\n  }\n\n  /** Hide any previews that are currently displayed. */\n  hidePreview() {\n    eventUtils.disable();\n    try {\n      if (this.staticConn) {\n        this.staticConn.unhighlight();\n        this.staticConn = null;\n      }\n      if (this.fadedBlock) {\n        this.fadedBlock.fadeForReplacement(false);\n        this.fadedBlock = null;\n      }\n      if (this.markerConn) {\n        this.hideInsertionMarker(this.markerConn);\n        this.markerConn = null;\n        this.draggedConn = null;\n      }\n    } finally {\n      eventUtils.enable();\n    }\n  }\n\n  private hideInsertionMarker(markerConn: RenderedConnection) {\n    const marker = markerConn.getSourceBlock();\n    const markerPrev = marker.previousConnection;\n    const markerOutput = marker.outputConnection;\n\n    if (!markerPrev?.targetConnection && !markerOutput?.targetConnection) {\n      // If we are the top block, unplugging doesn't do anything.\n      // The marker connection may not have a target block if we are hiding\n      // as part of applying connections.\n      markerConn.targetBlock()?.unplug(false);\n    } else {\n      marker.unplug(true);\n    }\n\n    marker.dispose();\n  }\n\n  /** Dispose of any references held by this connection previewer. */\n  dispose() {\n    this.hidePreview();\n  }\n}\n\nregistry.register(\n  registry.Type.CONNECTION_PREVIEWER,\n  registry.DEFAULT,\n  InsertionMarkerPreviewer,\n);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Align} from './inputs/align.js';\nimport {DummyInput} from './inputs/dummy_input.js';\nimport {EndRowInput} from './inputs/end_row_input.js';\nimport {Input} from './inputs/input.js';\nimport {inputTypes} from './inputs/input_types.js';\nimport {StatementInput} from './inputs/statement_input.js';\nimport {ValueInput} from './inputs/value_input.js';\n\nexport {\n  Align,\n  DummyInput,\n  EndRowInput,\n  Input,\n  inputTypes,\n  StatementInput,\n  ValueInput,\n};\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for generating executable code from\n * Blockly code.\n *\n * @class\n */\n// Former goog.module ID: Blockly.CodeGenerator\n\nimport type {Block} from './block.js';\nimport * as common from './common.js';\nimport {Names, NameType} from './names.js';\nimport type {Workspace} from './workspace.js';\n\n/**\n * Deprecated, no-longer used type declaration for per-block-type generator\n * functions.\n *\n * @deprecated\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/generating-code}\n * @param block The Block instance to generate code for.\n * @param generator The CodeGenerator calling the function.\n * @returns A string containing the generated code (for statement blocks),\n *     or a [code, precedence] tuple (for value/expression blocks), or\n *     null if no code should be emitted for block.\n */\nexport type BlockGenerator = (\n  block: Block,\n  generator: CodeGenerator,\n) => [string, number] | string | null;\n\n/**\n * Class for a code generator that translates the blocks into a language.\n */\nexport class CodeGenerator {\n  name_: string;\n\n  /**\n   * A dictionary of block generator functions, keyed by block type.\n   * Each block generator function takes two parameters:\n   *\n   * - the Block to generate code for, and\n   * - the calling CodeGenerator (or subclass) instance, so the\n   *   function can call methods defined below (e.g. blockToCode) or\n   *   on the relevant subclass (e.g. JavascripGenerator),\n   *\n   * and returns:\n   *\n   * - a [code, precedence] tuple (for value/expression blocks), or\n   * - a string containing the generated code (for statement blocks), or\n   * - null if no code should be emitted for block.\n   */\n  forBlock: Record<\n    string,\n    (block: Block, generator: this) => [string, number] | string | null\n  > = Object.create(null);\n\n  /**\n   * This is used as a placeholder in functions defined using\n   * CodeGenerator.provideFunction_.  It must not be legal code that could\n   * legitimately appear in a function definition (or comment), and it must\n   * not confuse the regular expression parser.\n   */\n  FUNCTION_NAME_PLACEHOLDER_ = '{leCUI8hutHZI4480Dc}';\n  FUNCTION_NAME_PLACEHOLDER_REGEXP_: RegExp;\n\n  /**\n   * Arbitrary code to inject into locations that risk causing infinite loops.\n   * Any instances of '%1' will be replaced by the block ID that failed.\n   * E.g. `  checkTimeout(%1);\\n`\n   */\n  INFINITE_LOOP_TRAP: string | null = null;\n\n  /**\n   * Arbitrary code to inject before every statement.\n   * Any instances of '%1' will be replaced by the block ID of the statement.\n   * E.g. `highlight(%1);\\n`\n   */\n  STATEMENT_PREFIX: string | null = null;\n\n  /**\n   * Arbitrary code to inject after every statement.\n   * Any instances of '%1' will be replaced by the block ID of the statement.\n   * E.g. `highlight(%1);\\n`\n   */\n  STATEMENT_SUFFIX: string | null = null;\n\n  /**\n   * The method of indenting.  Defaults to two spaces, but language generators\n   * may override this to increase indent or change to tabs.\n   */\n  INDENT = '  ';\n\n  /**\n   * Maximum length for a comment before wrapping.  Does not account for\n   * indenting level.\n   */\n  COMMENT_WRAP = 60;\n\n  /** List of outer-inner pairings that do NOT require parentheses. */\n  ORDER_OVERRIDES: number[][] = [];\n\n  /**\n   * Whether the init method has been called.\n   * Generators that set this flag to false after creation and true in init\n   * will cause blockToCode to emit a warning if the generator has not been\n   * initialized. If this flag is untouched, it will have no effect.\n   */\n  isInitialized: boolean | null = null;\n\n  /** Comma-separated list of reserved words. */\n  protected RESERVED_WORDS_ = '';\n\n  /** A dictionary of definitions to be printed before the code. */\n  protected definitions_: {[key: string]: string} = Object.create(null);\n\n  /**\n   * A dictionary mapping desired function names in definitions_ to actual\n   * function names (to avoid collisions with user functions).\n   */\n  protected functionNames_: {[key: string]: string} = Object.create(null);\n\n  /** A database of variable and procedure names. */\n  nameDB_?: Names = undefined;\n\n  /** @param name Language name of this generator. */\n  constructor(name: string) {\n    this.name_ = name;\n\n    this.FUNCTION_NAME_PLACEHOLDER_REGEXP_ = new RegExp(\n      this.FUNCTION_NAME_PLACEHOLDER_,\n      'g',\n    );\n  }\n\n  /**\n   * Generate code for all blocks in the workspace to the specified language.\n   *\n   * @param workspace Workspace to generate code from.\n   * @returns Generated code.\n   */\n  workspaceToCode(workspace?: Workspace): string {\n    if (!workspace) {\n      // Backwards compatibility from before there could be multiple workspaces.\n      console.warn(\n        'No workspace specified in workspaceToCode call.  Guessing.',\n      );\n      workspace = common.getMainWorkspace();\n    }\n    const code = [];\n    this.init(workspace);\n    const blocks = workspace.getTopBlocks(true);\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      let line = this.blockToCode(block);\n      if (Array.isArray(line)) {\n        // Value blocks return tuples of code and operator order.\n        // Top-level blocks don't care about operator order.\n        line = line[0];\n      }\n      if (line) {\n        if (block.outputConnection) {\n          // This block is a naked value.  Ask the language's code generator if\n          // it wants to append a semicolon, or something.\n          line = this.scrubNakedValue(line);\n          if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n            line = this.injectId(this.STATEMENT_PREFIX, block) + line;\n          }\n          if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n            line = line + this.injectId(this.STATEMENT_SUFFIX, block);\n          }\n        }\n        code.push(line);\n      }\n    }\n    // Blank line between each section.\n    let codeString = code.join('\\n');\n    codeString = this.finish(codeString);\n    // Final scrubbing of whitespace.\n    codeString = codeString.replace(/^\\s+\\n/, '');\n    codeString = codeString.replace(/\\n\\s+$/, '\\n');\n    codeString = codeString.replace(/[ \\t]+\\n/g, '\\n');\n    return codeString;\n  }\n\n  /**\n   * Prepend a common prefix onto each line of code.\n   * Intended for indenting code or adding comment markers.\n   *\n   * @param text The lines of code.\n   * @param prefix The common prefix.\n   * @returns The prefixed lines of code.\n   */\n  prefixLines(text: string, prefix: string): string {\n    return prefix + text.replace(/(?!\\n$)\\n/g, '\\n' + prefix);\n  }\n\n  /**\n   * Recursively spider a tree of blocks, returning all their comments.\n   *\n   * @param block The block from which to start spidering.\n   * @returns Concatenated list of comments.\n   */\n  allNestedComments(block: Block): string {\n    const comments = [];\n    const blocks = block.getDescendants(true);\n    for (let i = 0; i < blocks.length; i++) {\n      const comment = blocks[i].getCommentText();\n      if (comment) {\n        comments.push(comment);\n      }\n    }\n    // Append an empty string to create a trailing line break when joined.\n    if (comments.length) {\n      comments.push('');\n    }\n    return comments.join('\\n');\n  }\n\n  /**\n   * Generate code for the specified block (and attached blocks).\n   * The generator must be initialized before calling this function.\n   *\n   * @param block The block to generate code for.\n   * @param opt_thisOnly True to generate code for only this statement.\n   * @returns For statement blocks, the generated code.\n   *     For value blocks, an array containing the generated code and an\n   * operator order value.  Returns '' if block is null.\n   */\n  blockToCode(\n    block: Block | null,\n    opt_thisOnly?: boolean,\n  ): string | [string, number] {\n    if (this.isInitialized === false) {\n      console.warn(\n        'CodeGenerator init was not called before blockToCode was called.',\n      );\n    }\n    if (!block) {\n      return '';\n    }\n    if (!block.isEnabled()) {\n      // Skip past this block if it is disabled.\n      return opt_thisOnly ? '' : this.blockToCode(block.getNextBlock());\n    }\n    if (block.isInsertionMarker()) {\n      // Skip past insertion markers.\n      return opt_thisOnly ? '' : this.blockToCode(block.getChildren(false)[0]);\n    }\n\n    // Look up block generator function in dictionary - but fall back\n    // to looking up on this if not found, for backwards compatibility.\n    const func = this.forBlock[block.type];\n    if (typeof func !== 'function') {\n      throw Error(\n        `${this.name_} generator does not know how to generate code ` +\n          `for block type \"${block.type}\".`,\n      );\n    }\n    // First argument to func.call is the value of 'this' in the generator.\n    // Prior to 24 September 2013 'this' was the only way to access the block.\n    // The current preferred method of accessing the block is through the second\n    // argument to func.call, which becomes the first parameter to the\n    // generator.\n    let code = func.call(block, block, this);\n    if (Array.isArray(code)) {\n      // Value blocks return tuples of code and operator order.\n      if (!block.outputConnection) {\n        throw TypeError('Expecting string from statement block: ' + block.type);\n      }\n      return [this.scrub_(block, code[0], opt_thisOnly), code[1]];\n    } else if (typeof code === 'string') {\n      if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n        code = this.injectId(this.STATEMENT_PREFIX, block) + code;\n      }\n      if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n        code = code + this.injectId(this.STATEMENT_SUFFIX, block);\n      }\n      return this.scrub_(block, code, opt_thisOnly);\n    } else if (code === null) {\n      // Block has handled code generation itself.\n      return '';\n    }\n    throw SyntaxError('Invalid code generated: ' + code);\n  }\n\n  /**\n   * Generate code representing the specified value input.\n   *\n   * @param block The block containing the input.\n   * @param name The name of the input.\n   * @param outerOrder The maximum binding strength (minimum order value) of any\n   *     operators adjacent to \"block\".\n   * @returns Generated code or '' if no blocks are connected.\n   * @throws ReferenceError if the specified input does not exist.\n   */\n  valueToCode(block: Block, name: string, outerOrder: number): string {\n    if (isNaN(outerOrder)) {\n      throw TypeError('Expecting valid order from block: ' + block.type);\n    }\n    const targetBlock = block.getInputTargetBlock(name);\n    if (!targetBlock && !block.getInput(name)) {\n      throw ReferenceError(`Input \"${name}\" doesn't exist on \"${block.type}\"`);\n    }\n    if (!targetBlock) {\n      return '';\n    }\n    const tuple = this.blockToCode(targetBlock);\n    if (tuple === '') {\n      // Disabled block.\n      return '';\n    }\n    // Value blocks must return code and order of operations info.\n    // Statement blocks must only return code.\n    if (!Array.isArray(tuple)) {\n      throw TypeError(\n        `Expecting tuple from value block: ${targetBlock.type} See ` +\n          `developers.google.com/blockly/guides/create-custom-blocks/generating-code ` +\n          `for more information`,\n      );\n    }\n    let code = tuple[0];\n    const innerOrder = tuple[1];\n    if (isNaN(innerOrder)) {\n      throw TypeError(\n        'Expecting valid order from value block: ' + targetBlock.type,\n      );\n    }\n    if (!code) {\n      return '';\n    }\n\n    // Add parentheses if needed.\n    let parensNeeded = false;\n    const outerOrderClass = Math.floor(outerOrder);\n    const innerOrderClass = Math.floor(innerOrder);\n    if (outerOrderClass <= innerOrderClass) {\n      if (\n        outerOrderClass === innerOrderClass &&\n        (outerOrderClass === 0 || outerOrderClass === 99)\n      ) {\n        // Don't generate parens around NONE-NONE and ATOMIC-ATOMIC pairs.\n        // 0 is the atomic order, 99 is the none order.  No parentheses needed.\n        // In all known languages multiple such code blocks are not order\n        // sensitive.  In fact in Python ('a' 'b') 'c' would fail.\n      } else {\n        // The operators outside this code are stronger than the operators\n        // inside this code.  To prevent the code from being pulled apart,\n        // wrap the code in parentheses.\n        parensNeeded = true;\n        // Check for special exceptions.\n        for (let i = 0; i < this.ORDER_OVERRIDES.length; i++) {\n          if (\n            this.ORDER_OVERRIDES[i][0] === outerOrder &&\n            this.ORDER_OVERRIDES[i][1] === innerOrder\n          ) {\n            parensNeeded = false;\n            break;\n          }\n        }\n      }\n    }\n    if (parensNeeded) {\n      // Technically, this should be handled on a language-by-language basis.\n      // However all known (sane) languages use parentheses for grouping.\n      code = '(' + code + ')';\n    }\n    return code;\n  }\n\n  /**\n   * Generate a code string representing the blocks attached to the named\n   * statement input. Indent the code.\n   * This is mainly used in generators. When trying to generate code to evaluate\n   * look at using workspaceToCode or blockToCode.\n   *\n   * @param block The block containing the input.\n   * @param name The name of the input.\n   * @returns Generated code or '' if no blocks are connected.\n   * @throws ReferenceError if the specified input does not exist.\n   */\n  statementToCode(block: Block, name: string): string {\n    const targetBlock = block.getInputTargetBlock(name);\n    if (!targetBlock && !block.getInput(name)) {\n      throw ReferenceError(`Input \"${name}\" doesn't exist on \"${block.type}\"`);\n    }\n    let code = this.blockToCode(targetBlock);\n    // Value blocks must return code and order of operations info.\n    // Statement blocks must only return code.\n    if (typeof code !== 'string') {\n      throw TypeError(\n        'Expecting code from statement block: ' +\n          (targetBlock && targetBlock.type),\n      );\n    }\n    if (code) {\n      code = this.prefixLines(code, this.INDENT);\n    }\n    return code;\n  }\n\n  /**\n   * Add an infinite loop trap to the contents of a loop.\n   * Add statement suffix at the start of the loop block (right after the loop\n   * statement executes), and a statement prefix to the end of the loop block\n   * (right before the loop statement executes).\n   *\n   * @param branch Code for loop contents.\n   * @param block Enclosing block.\n   * @returns Loop contents, with infinite loop trap added.\n   */\n  addLoopTrap(branch: string, block: Block): string {\n    if (this.INFINITE_LOOP_TRAP) {\n      branch =\n        this.prefixLines(\n          this.injectId(this.INFINITE_LOOP_TRAP, block),\n          this.INDENT,\n        ) + branch;\n    }\n    if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n      branch =\n        this.prefixLines(\n          this.injectId(this.STATEMENT_SUFFIX, block),\n          this.INDENT,\n        ) + branch;\n    }\n    if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n      branch =\n        branch +\n        this.prefixLines(\n          this.injectId(this.STATEMENT_PREFIX, block),\n          this.INDENT,\n        );\n    }\n    return branch;\n  }\n\n  /**\n   * Inject a block ID into a message to replace '%1'.\n   * Used for STATEMENT_PREFIX, STATEMENT_SUFFIX, and INFINITE_LOOP_TRAP.\n   *\n   * @param msg Code snippet with '%1'.\n   * @param block Block which has an ID.\n   * @returns Code snippet with ID.\n   */\n  injectId(msg: string, block: Block): string {\n    const id = block.id.replace(/\\$/g, '$$$$'); // Issue 251.\n    return msg.replace(/%1/g, \"'\" + id + \"'\");\n  }\n\n  /**\n   * Add one or more words to the list of reserved words for this language.\n   *\n   * @param words Comma-separated list of words to add to the list.\n   *     No spaces.  Duplicates are ok.\n   */\n  addReservedWords(words: string) {\n    this.RESERVED_WORDS_ += words + ',';\n  }\n\n  /**\n   * Define a developer-defined function (not a user-defined procedure) to be\n   * included in the generated code.  Used for creating private helper\n   * functions. The first time this is called with a given desiredName, the code\n   * is saved and an actual name is generated.  Subsequent calls with the same\n   * desiredName have no effect but have the same return value.\n   *\n   * It is up to the caller to make sure the same desiredName is not\n   * used for different helper functions (e.g. use \"colourRandom\" and\n   * \"listRandom\", not \"random\").  There is no danger of colliding with reserved\n   * words, or user-defined variable or procedure names.\n   *\n   * The code gets output when CodeGenerator.finish() is called.\n   *\n   * @param desiredName The desired name of the function (e.g. mathIsPrime).\n   * @param code A list of statements or one multi-line code string.  Use '  '\n   *     for indents (they will be replaced).\n   * @returns The actual name of the new function.  This may differ from\n   *     desiredName if the former has already been taken by the user.\n   */\n  provideFunction_(desiredName: string, code: string[] | string): string {\n    if (!this.definitions_[desiredName]) {\n      const functionName = this.nameDB_!.getDistinctName(\n        desiredName,\n        NameType.PROCEDURE,\n      );\n      this.functionNames_[desiredName] = functionName;\n      if (Array.isArray(code)) {\n        code = code.join('\\n');\n      }\n      let codeText = code\n        .trim()\n        .replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_, functionName);\n      // Change all '  ' indents into the desired indent.\n      // To avoid an infinite loop of replacements, change all indents to '\\0'\n      // character first, then replace them all with the indent.\n      // We are assuming that no provided functions contain a literal null char.\n      let oldCodeText;\n      while (oldCodeText !== codeText) {\n        oldCodeText = codeText;\n        codeText = codeText.replace(/^(( {2})*) {2}/gm, '$1\\0');\n      }\n      codeText = codeText.replace(/\\0/g, this.INDENT);\n      this.definitions_[desiredName] = codeText;\n    }\n    return this.functionNames_[desiredName];\n  }\n\n  /**\n   * Gets a unique, legal name for a user-defined variable.\n   * Before calling this method, the `nameDB_` property of the class\n   * must have been initialized already. This is typically done in\n   * the `init` function of the code generator class.\n   *\n   * @param nameOrId The ID of the variable to get a name for,\n   *    or the proposed name for a variable not associated with an id.\n   * @returns A unique, legal name for the variable.\n   */\n  getVariableName(nameOrId: string): string {\n    return this.getName(nameOrId, NameType.VARIABLE);\n  }\n\n  /**\n   * Gets a unique, legal name for a user-defined procedure.\n   * Before calling this method, the `nameDB_` property of the class\n   * must have been initialized already. This is typically done in\n   * the `init` function of the code generator class.\n   *\n   * @param name The proposed name for a procedure.\n   * @returns A unique, legal name for the procedure.\n   */\n  getProcedureName(name: string): string {\n    return this.getName(name, NameType.PROCEDURE);\n  }\n\n  private getName(nameOrId: string, type: NameType): string {\n    if (!this.nameDB_) {\n      throw new Error(\n        'Name database is not defined. You must initialize `nameDB_` in your generator class and call `init` first.',\n      );\n    }\n    return this.nameDB_.getName(nameOrId, type);\n  }\n\n  /**\n   * Hook for code to run before code generation starts.\n   * Subclasses may override this, e.g. to initialise the database of variable\n   * names.\n   *\n   * @param _workspace Workspace to generate code from.\n   */\n  init(_workspace: Workspace) {\n    // Optionally override\n    // Create a dictionary of definitions to be printed before the code.\n    this.definitions_ = Object.create(null);\n    // Create a dictionary mapping desired developer-defined function names in\n    // definitions_ to actual function names (to avoid collisions with\n    // user-defined procedures).\n    this.functionNames_ = Object.create(null);\n  }\n\n  /**\n   * Common tasks for generating code from blocks.  This is called from\n   * blockToCode and is called on every block, not just top level blocks.\n   * Subclasses may override this, e.g. to generate code for statements\n   * following the block, or to handle comments for the specified block and any\n   * connected value blocks.\n   *\n   * @param _block The current block.\n   * @param code The code created for this block.\n   * @param _opt_thisOnly True to generate code for only this statement.\n   * @returns Code with comments and subsequent blocks added.\n   */\n  scrub_(_block: Block, code: string, _opt_thisOnly?: boolean): string {\n    // Optionally override\n    return code;\n  }\n\n  /**\n   * Hook for code to run at end of code generation.\n   * Subclasses may override this, e.g. to prepend the generated code with\n   * import statements or variable definitions.\n   *\n   * @param code Generated code.\n   * @returns Completed code.\n   */\n  finish(code: string): string {\n    // Optionally override\n    // Clean up temporary data.\n    this.definitions_ = Object.create(null);\n    this.functionNames_ = Object.create(null);\n    return code;\n  }\n\n  /**\n   * Naked values are top-level blocks with outputs that aren't plugged into\n   * anything.\n   * Subclasses may override this, e.g. if their language does not allow\n   * naked values.\n   *\n   * @param line Line of generated code.\n   * @returns Legal line of code.\n   */\n  scrubNakedValue(line: string): string {\n    // Optionally override\n    return line;\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Calculates and reports flyout workspace metrics.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FlyoutMetricsManager\n\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport {ContainerRegion, MetricsManager} from './metrics_manager.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Calculates metrics for a flyout's workspace.\n * The metrics are mainly used to size scrollbars for the flyout.\n */\nexport class FlyoutMetricsManager extends MetricsManager {\n  /** The flyout that owns the workspace to calculate metrics for. */\n  protected flyout_: IFlyout;\n\n  /**\n   * @param workspace The flyout's workspace.\n   * @param flyout The flyout.\n   */\n  constructor(workspace: WorkspaceSvg, flyout: IFlyout) {\n    super(workspace);\n    this.flyout_ = flyout;\n  }\n\n  /**\n   * Gets the bounding box of the blocks on the flyout's workspace.\n   * This is in workspace coordinates.\n   *\n   * @returns The bounding box of the blocks on the workspace.\n   */\n  private getBoundingBox():\n    | SVGRect\n    | {height: number; y: number; width: number; x: number} {\n    let blockBoundingBox;\n    try {\n      blockBoundingBox = this.workspace_.getCanvas().getBBox();\n    } catch {\n      // Firefox has trouble with hidden elements (Bug 528969).\n      // 2021 Update: It looks like this was fixed around Firefox 77 released in\n      // 2020.\n      blockBoundingBox = {height: 0, y: 0, width: 0, x: 0};\n    }\n    return blockBoundingBox;\n  }\n\n  override getContentMetrics(opt_getWorkspaceCoordinates?: boolean) {\n    // The bounding box is in workspace coordinates.\n    const blockBoundingBox = this.getBoundingBox();\n    const scale = opt_getWorkspaceCoordinates ? 1 : this.workspace_.scale;\n\n    return {\n      height: blockBoundingBox.height * scale,\n      width: blockBoundingBox.width * scale,\n      top: blockBoundingBox.y * scale,\n      left: blockBoundingBox.x * scale,\n    };\n  }\n\n  override getScrollMetrics(\n    opt_getWorkspaceCoordinates?: boolean,\n    opt_viewMetrics?: ContainerRegion,\n    opt_contentMetrics?: ContainerRegion,\n  ) {\n    const contentMetrics = opt_contentMetrics || this.getContentMetrics();\n    const margin = this.flyout_.MARGIN * this.workspace_.scale;\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n\n    // The left padding isn't just the margin. Some blocks are also offset by\n    // tabWidth so that value and statement blocks line up.\n    // The contentMetrics.left value is equivalent to the variable left padding.\n    const leftPadding = contentMetrics.left;\n\n    return {\n      height: (contentMetrics.height + 2 * margin) / scale,\n      width: (contentMetrics.width + leftPadding + margin) / scale,\n      top: 0,\n      left: 0,\n    };\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Flyout tray containing blocks which may be created.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Flyout\n\nimport type {Block} from './block.js';\nimport {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {MANUALLY_DISABLED} from './constants.js';\nimport {DeleteArea} from './delete_area.js';\nimport type {Abstract as AbstractEvent} from './events/events_abstract.js';\nimport {EventType} from './events/type.js';\nimport * as eventUtils from './events/utils.js';\nimport {FlyoutButton} from './flyout_button.js';\nimport {FlyoutMetricsManager} from './flyout_metrics_manager.js';\nimport {IAutoHideable} from './interfaces/i_autohideable.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {Options} from './options.js';\nimport * as renderManagement from './render_management.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as Tooltip from './tooltip.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {Svg} from './utils/svg.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as Variables from './variables.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\n\nenum FlyoutItemType {\n  BLOCK = 'block',\n  BUTTON = 'button',\n}\n\n/**\n * The language-neutral ID for when the reason why a block is disabled is\n * because the workspace is at block capacity.\n */\nconst WORKSPACE_AT_BLOCK_CAPACITY_DISABLED_REASON =\n  'WORKSPACE_AT_BLOCK_CAPACITY';\n\n/**\n * Class for a flyout.\n */\nexport abstract class Flyout\n  extends DeleteArea\n  implements IAutoHideable, IFlyout\n{\n  /**\n   * Position the flyout.\n   */\n  abstract position(): void;\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has\n   *     moved from the position at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   */\n  abstract isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean;\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float\n   *     between 0 and 1 specifying the degree of scrolling and a\n   *     similar x property.\n   */\n  protected abstract setMetrics_(xyRatio: {x?: number; y?: number}): void;\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected abstract layout_(contents: FlyoutItem[], gaps: number[]): void;\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected abstract wheel_(e: WheelEvent): void;\n\n  /**\n   * Compute height of flyout.  Position mat under each block.\n   * For RTL: Lay out the blocks right-aligned.\n   */\n  protected abstract reflowInternal_(): void;\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  abstract getX(): number;\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  abstract getY(): number;\n\n  /**\n   * Scroll the flyout to the beginning of its contents.\n   */\n  abstract scrollToStart(): void;\n\n  /**\n   * The type of a flyout content item.\n   */\n  static FlyoutItemType = FlyoutItemType;\n\n  protected workspace_: WorkspaceSvg;\n  RTL: boolean;\n  /**\n   * Whether the flyout should be laid out horizontally or not.\n   *\n   * @internal\n   */\n  horizontalLayout = false;\n  protected toolboxPosition_: number;\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /**\n   * Function that will be registered as a change listener on the workspace\n   * to reflow when blocks in the flyout workspace change.\n   */\n  private reflowWrapper: ((e: AbstractEvent) => void) | null = null;\n\n  /**\n   * Function that disables blocks in the flyout based on max block counts\n   * allowed in the target workspace. Registered as a change listener on the\n   * target workspace.\n   */\n  private filterWrapper: ((e: AbstractEvent) => void) | null = null;\n\n  /**\n   * List of background mats that lurk behind each block to catch clicks\n   * landing in the blocks' lakes and bays.\n   */\n  private mats: SVGElement[] = [];\n\n  /**\n   * List of visible buttons.\n   */\n  protected buttons_: FlyoutButton[] = [];\n\n  /**\n   * List of visible buttons and blocks.\n   */\n  protected contents: FlyoutItem[] = [];\n\n  /**\n   * List of event listeners.\n   */\n  private listeners: browserEvents.Data[] = [];\n\n  /**\n   * List of blocks that should always be disabled.\n   */\n  private permanentlyDisabled: Block[] = [];\n\n  protected readonly tabWidth_: number;\n\n  /**\n   * The target workspace.\n   *\n   * @internal\n   */\n  targetWorkspace!: WorkspaceSvg;\n\n  /**\n   * A list of blocks that can be reused.\n   */\n  private recycledBlocks: BlockSvg[] = [];\n\n  /**\n   * Does the flyout automatically close when a block is created?\n   */\n  autoClose = true;\n\n  /**\n   * Whether the flyout is visible.\n   */\n  private visible = false;\n\n  /**\n   * Whether the workspace containing this flyout is visible.\n   */\n  private containerVisible = true;\n  protected rectMap_: WeakMap<BlockSvg, SVGElement>;\n\n  /**\n   * Corner radius of the flyout background.\n   */\n  readonly CORNER_RADIUS: number = 8;\n  readonly MARGIN: number;\n  readonly GAP_X: number;\n  readonly GAP_Y: number;\n\n  /**\n   * Top/bottom padding between scrollbar and edge of flyout background.\n   */\n  readonly SCROLLBAR_MARGIN: number = 2.5;\n\n  /**\n   * Width of flyout.\n   */\n  protected width_ = 0;\n\n  /**\n   * Height of flyout.\n   */\n  protected height_ = 0;\n  // clang-format off\n  /**\n   * Range of a drag angle from a flyout considered \"dragging toward\n   * workspace\". Drags that are within the bounds of this many degrees from\n   * the orthogonal line to the flyout edge are considered to be \"drags toward\n   * the workspace\".\n   *\n   * @example\n   *\n   * ```\n   * Flyout                                                 Edge   Workspace\n   * [block] /  <-within this angle, drags \"toward workspace\" |\n   * [block] ---- orthogonal to flyout boundary ----          |\n   * [block] \\                                                |\n   * ```\n   *\n   * The angle is given in degrees from the orthogonal.\n   *\n   * This is used to know when to create a new block and when to scroll the\n   * flyout. Setting it to 360 means that all drags create a new block.\n   */\n  // clang-format on\n  protected dragAngleRange_ = 70;\n\n  /**\n   * The path around the background of the flyout, which will be filled with a\n   * background colour.\n   */\n  protected svgBackground_: SVGPathElement | null = null;\n\n  /**\n   * The root SVG group for the button or label.\n   */\n  protected svgGroup_: SVGGElement | null = null;\n  /**\n   * @param workspaceOptions Dictionary of options for the\n   *     workspace.\n   */\n  constructor(workspaceOptions: Options) {\n    super();\n    workspaceOptions.setMetrics = this.setMetrics_.bind(this);\n\n    this.workspace_ = new WorkspaceSvg(workspaceOptions);\n    this.workspace_.setMetricsManager(\n      new FlyoutMetricsManager(this.workspace_, this),\n    );\n\n    this.workspace_.internalIsFlyout = true;\n    // Keep the workspace visibility consistent with the flyout's visibility.\n    this.workspace_.setVisible(this.visible);\n\n    /**\n     * The unique id for this component that is used to register with the\n     * ComponentManager.\n     */\n    this.id = idGenerator.genUid();\n\n    /**\n     * Is RTL vs LTR.\n     */\n    this.RTL = !!workspaceOptions.RTL;\n\n    /**\n     * Position of the toolbox and flyout relative to the workspace.\n     */\n    this.toolboxPosition_ = workspaceOptions.toolboxPosition;\n\n    /**\n     * Width of output tab.\n     */\n    this.tabWidth_ = this.workspace_.getRenderer().getConstants().TAB_WIDTH;\n\n    /**\n     * A map from blocks to the rects which are beneath them to act as input\n     * targets.\n     *\n     * @internal\n     */\n    this.rectMap_ = new WeakMap();\n\n    /**\n     * Margin around the edges of the blocks in the flyout.\n     */\n    this.MARGIN = this.CORNER_RADIUS;\n\n    // TODO: Move GAP_X and GAP_Y to their appropriate files.\n    /**\n     * Gap between items in horizontal flyouts. Can be overridden with the \"sep\"\n     * element.\n     */\n    this.GAP_X = this.MARGIN * 3;\n\n    /**\n     * Gap between items in vertical flyouts. Can be overridden with the \"sep\"\n     * element.\n     */\n    this.GAP_Y = this.MARGIN * 3;\n  }\n\n  /**\n   * Creates the flyout's DOM.  Only needs to be called once.  The flyout can\n   * either exist as its own SVG element or be a g element nested inside a\n   * separate SVG element.\n   *\n   * @param tagName The type of tag to\n   *     put the flyout in. This should be <svg> or <g>.\n   * @returns The flyout's SVG group.\n   */\n  createDom(\n    tagName: string | Svg<SVGSVGElement> | Svg<SVGGElement>,\n  ): SVGElement {\n    /*\n        <svg | g>\n          <path class=\"blocklyFlyoutBackground\"/>\n          <g class=\"blocklyFlyout\"></g>\n        </ svg | g>\n        */\n    // Setting style to display:none to start. The toolbox and flyout\n    // hide/show code will set up proper visibility and size later.\n    this.svgGroup_ = dom.createSvgElement(tagName, {\n      'class': 'blocklyFlyout',\n    });\n    this.svgGroup_.style.display = 'none';\n    this.svgBackground_ = dom.createSvgElement(\n      Svg.PATH,\n      {'class': 'blocklyFlyoutBackground'},\n      this.svgGroup_,\n    );\n    this.svgGroup_.appendChild(this.workspace_.createDom());\n    this.workspace_\n      .getThemeManager()\n      .subscribe(this.svgBackground_, 'flyoutBackgroundColour', 'fill');\n    this.workspace_\n      .getThemeManager()\n      .subscribe(this.svgBackground_, 'flyoutOpacity', 'fill-opacity');\n    return this.svgGroup_;\n  }\n\n  /**\n   * Initializes the flyout.\n   *\n   * @param targetWorkspace The workspace in which to\n   *     create new blocks.\n   */\n  init(targetWorkspace: WorkspaceSvg) {\n    this.targetWorkspace = targetWorkspace;\n    this.workspace_.targetWorkspace = targetWorkspace;\n\n    this.workspace_.scrollbar = new ScrollbarPair(\n      this.workspace_,\n      this.horizontalLayout,\n      !this.horizontalLayout,\n      'blocklyFlyoutScrollbar',\n      this.SCROLLBAR_MARGIN,\n    );\n\n    this.hide();\n\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.svgGroup_ as SVGGElement,\n        'wheel',\n        this,\n        this.wheel_,\n      ),\n    );\n    this.filterWrapper = this.filterForCapacity.bind(this);\n    this.targetWorkspace.addChangeListener(this.filterWrapper);\n\n    // Dragging the flyout up and down.\n    this.boundEvents.push(\n      browserEvents.conditionalBind(\n        this.svgBackground_ as SVGPathElement,\n        'pointerdown',\n        this,\n        this.onMouseDown,\n      ),\n    );\n\n    // A flyout connected to a workspace doesn't have its own current gesture.\n    this.workspace_.getGesture = this.targetWorkspace.getGesture.bind(\n      this.targetWorkspace,\n    );\n\n    // Get variables from the main workspace rather than the target workspace.\n    this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap());\n\n    this.workspace_.createPotentialVariableMap();\n\n    targetWorkspace.getComponentManager().addComponent({\n      component: this,\n      weight: ComponentManager.ComponentWeight.FLYOUT_WEIGHT,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n      ],\n    });\n  }\n\n  /**\n   * Dispose of this flyout.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.hide();\n    this.targetWorkspace.getComponentManager().removeComponent(this.id);\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n    if (this.filterWrapper) {\n      this.targetWorkspace.removeChangeListener(this.filterWrapper);\n    }\n    if (this.workspace_) {\n      this.workspace_.getThemeManager().unsubscribe(this.svgBackground_!);\n      this.workspace_.dispose();\n    }\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n  }\n\n  /**\n   * Get the width of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Get the height of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Get the scale (zoom level) of the flyout. By default,\n   * this matches the target workspace scale, but this can be overridden.\n   *\n   * @returns Flyout workspace scale.\n   */\n  getFlyoutScale(): number {\n    return this.targetWorkspace.scale;\n  }\n\n  /**\n   * Get the workspace inside the flyout.\n   *\n   * @returns The workspace inside the flyout.\n   */\n  getWorkspace(): WorkspaceSvg {\n    return this.workspace_;\n  }\n\n  /**\n   * Sets whether this flyout automatically closes when blocks are dragged out,\n   * the workspace is clicked, etc, or not.\n   */\n  setAutoClose(autoClose: boolean) {\n    this.autoClose = autoClose;\n    this.targetWorkspace.recordDragTargets();\n    this.targetWorkspace.resizeContents();\n  }\n\n  /** Automatically hides the flyout if it is an autoclosing flyout. */\n  autoHide(onlyClosePopups: boolean): void {\n    if (\n      !onlyClosePopups &&\n      this.targetWorkspace.getFlyout(true) === this &&\n      this.autoClose\n    )\n      this.hide();\n  }\n\n  /**\n   * Get the target workspace inside the flyout.\n   *\n   * @returns The target workspace inside the flyout.\n   */\n  getTargetWorkspace(): WorkspaceSvg {\n    return this.targetWorkspace;\n  }\n\n  /**\n   * Is the flyout visible?\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.visible;\n  }\n\n  /**\n   * Set whether the flyout is visible. A value of true does not necessarily\n   * mean that the flyout is shown. It could be hidden because its container is\n   * hidden.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.isVisible();\n\n    this.visible = visible;\n    if (visibilityChanged) {\n      if (!this.autoClose) {\n        // Auto-close flyouts are ignored as drag targets, so only non\n        // auto-close flyouts need to have their drag target updated.\n        this.targetWorkspace.recordDragTargets();\n      }\n      this.updateDisplay();\n    }\n  }\n\n  /**\n   * Set whether this flyout's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.containerVisible;\n    this.containerVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay();\n    }\n  }\n\n  /**\n   * Get the list of buttons and blocks of the current flyout.\n   *\n   * @returns The array of flyout buttons and blocks.\n   */\n  getContents(): FlyoutItem[] {\n    return this.contents;\n  }\n\n  /**\n   * Store the list of buttons and blocks on the flyout.\n   *\n   * @param contents - The array of items for the flyout.\n   */\n  setContents(contents: FlyoutItem[]): void {\n    this.contents = contents;\n  }\n  /**\n   * Update the display property of the flyout based whether it thinks it should\n   * be visible and whether its containing workspace is visible.\n   */\n  private updateDisplay() {\n    let show = true;\n    if (!this.containerVisible) {\n      show = false;\n    } else {\n      show = this.isVisible();\n    }\n    if (this.svgGroup_) {\n      this.svgGroup_.style.display = show ? 'block' : 'none';\n    }\n    // Update the scrollbar's visibility too since it should mimic the\n    // flyout's visibility.\n    this.workspace_.scrollbar?.setContainerVisible(show);\n  }\n\n  /**\n   * Update the view based on coordinates calculated in position().\n   *\n   * @param width The computed width of the flyout's SVG group\n   * @param height The computed height of the flyout's SVG group.\n   * @param x The computed x origin of the flyout's SVG group.\n   * @param y The computed y origin of the flyout's SVG group.\n   */\n  protected positionAt_(width: number, height: number, x: number, y: number) {\n    this.svgGroup_?.setAttribute('width', `${width}`);\n    this.svgGroup_?.setAttribute('height', `${height}`);\n    this.workspace_.setCachedParentSvgSize(width, height);\n\n    if (this.svgGroup_) {\n      const transform = 'translate(' + x + 'px,' + y + 'px)';\n      dom.setCssTransform(this.svgGroup_, transform);\n    }\n\n    // Update the scrollbar (if one exists).\n    const scrollbar = this.workspace_.scrollbar;\n    if (scrollbar) {\n      // Set the scrollbars origin to be the top left of the flyout.\n      scrollbar.setOrigin(x, y);\n      scrollbar.resize();\n      // If origin changed and metrics haven't changed enough to trigger\n      // reposition in resize, we need to call setPosition. See issue #4692.\n      if (scrollbar.hScroll) {\n        scrollbar.hScroll.setPosition(\n          scrollbar.hScroll.position.x,\n          scrollbar.hScroll.position.y,\n        );\n      }\n      if (scrollbar.vScroll) {\n        scrollbar.vScroll.setPosition(\n          scrollbar.vScroll.position.x,\n          scrollbar.vScroll.position.y,\n        );\n      }\n    }\n  }\n\n  /**\n   * Hide and empty the flyout.\n   */\n  hide() {\n    if (!this.isVisible()) {\n      return;\n    }\n    this.setVisible(false);\n    // Delete all the event listeners.\n    for (const listen of this.listeners) {\n      browserEvents.unbind(listen);\n    }\n    this.listeners.length = 0;\n    if (this.reflowWrapper) {\n      this.workspace_.removeChangeListener(this.reflowWrapper);\n      this.reflowWrapper = null;\n    }\n    // Do NOT delete the blocks here.  Wait until Flyout.show.\n    // https://neil.fraser.name/news/2014/08/09/\n  }\n\n  /**\n   * Show and populate the flyout.\n   *\n   * @param flyoutDef Contents to display\n   *     in the flyout. This is either an array of Nodes, a NodeList, a\n   *     toolbox definition, or a string with the name of the dynamic category.\n   */\n  show(flyoutDef: toolbox.FlyoutDefinition | string) {\n    this.workspace_.setResizesEnabled(false);\n    this.hide();\n    this.clearOldBlocks();\n\n    // Handle dynamic categories, represented by a name instead of a list.\n    if (typeof flyoutDef === 'string') {\n      flyoutDef = this.getDynamicCategoryContents(flyoutDef);\n    }\n    this.setVisible(true);\n\n    // Parse the Array, Node or NodeList into a a list of flyout items.\n    const parsedContent = toolbox.convertFlyoutDefToJsonArray(flyoutDef);\n    const flyoutInfo = this.createFlyoutInfo(parsedContent);\n\n    renderManagement.triggerQueuedRenders(this.workspace_);\n\n    this.setContents(flyoutInfo.contents);\n\n    this.layout_(flyoutInfo.contents, flyoutInfo.gaps);\n\n    if (this.horizontalLayout) {\n      this.height_ = 0;\n    } else {\n      this.width_ = 0;\n    }\n    this.workspace_.setResizesEnabled(true);\n    this.reflow();\n\n    this.filterForCapacity();\n\n    // Correctly position the flyout's scrollbar when it opens.\n    this.position();\n\n    this.reflowWrapper = this.reflow.bind(this);\n    this.workspace_.addChangeListener(this.reflowWrapper);\n    this.emptyRecycledBlocks();\n  }\n\n  /**\n   * Create the contents array and gaps array necessary to create the layout for\n   * the flyout.\n   *\n   * @param parsedContent The array\n   *     of objects to show in the flyout.\n   * @returns The list of contents and gaps needed to lay out the flyout.\n   */\n  private createFlyoutInfo(parsedContent: toolbox.FlyoutItemInfoArray): {\n    contents: FlyoutItem[];\n    gaps: number[];\n  } {\n    const contents: FlyoutItem[] = [];\n    const gaps: number[] = [];\n    this.permanentlyDisabled.length = 0;\n    const defaultGap = this.horizontalLayout ? this.GAP_X : this.GAP_Y;\n    for (const info of parsedContent) {\n      if ('custom' in info) {\n        const customInfo = info as toolbox.DynamicCategoryInfo;\n        const categoryName = customInfo['custom'];\n        const flyoutDef = this.getDynamicCategoryContents(categoryName);\n        const parsedDynamicContent =\n          toolbox.convertFlyoutDefToJsonArray(flyoutDef);\n        const {contents: dynamicContents, gaps: dynamicGaps} =\n          this.createFlyoutInfo(parsedDynamicContent);\n        contents.push(...dynamicContents);\n        gaps.push(...dynamicGaps);\n      }\n\n      switch (info['kind'].toUpperCase()) {\n        case 'BLOCK': {\n          const blockInfo = info as toolbox.BlockInfo;\n          const block = this.createFlyoutBlock(blockInfo);\n          contents.push({type: FlyoutItemType.BLOCK, block: block});\n          this.addBlockGap(blockInfo, gaps, defaultGap);\n          break;\n        }\n        case 'SEP': {\n          const sepInfo = info as toolbox.SeparatorInfo;\n          this.addSeparatorGap(sepInfo, gaps, defaultGap);\n          break;\n        }\n        case 'LABEL': {\n          const labelInfo = info as toolbox.LabelInfo;\n          // A label is a button with different styling.\n          const label = this.createButton(labelInfo, /** isLabel */ true);\n          contents.push({type: FlyoutItemType.BUTTON, button: label});\n          gaps.push(defaultGap);\n          break;\n        }\n        case 'BUTTON': {\n          const buttonInfo = info as toolbox.ButtonInfo;\n          const button = this.createButton(buttonInfo, /** isLabel */ false);\n          contents.push({type: FlyoutItemType.BUTTON, button: button});\n          gaps.push(defaultGap);\n          break;\n        }\n      }\n    }\n\n    return {contents: contents, gaps: gaps};\n  }\n\n  /**\n   * Gets the flyout definition for the dynamic category.\n   *\n   * @param categoryName The name of the dynamic category.\n   * @returns The definition of the\n   *     flyout in one of its many forms.\n   */\n  private getDynamicCategoryContents(\n    categoryName: string,\n  ): toolbox.FlyoutDefinition {\n    // Look up the correct category generation function and call that to get a\n    // valid XML list.\n    const fnToApply =\n      this.workspace_.targetWorkspace!.getToolboxCategoryCallback(categoryName);\n    if (typeof fnToApply !== 'function') {\n      throw TypeError(\n        \"Couldn't find a callback function when opening\" +\n          ' a toolbox category.',\n      );\n    }\n    return fnToApply(this.workspace_.targetWorkspace!);\n  }\n\n  /**\n   * Creates a flyout button or a flyout label.\n   *\n   * @param btnInfo The object holding information about a button or a label.\n   * @param isLabel True if the button is a label, false otherwise.\n   * @returns The object used to display the button in the\n   *    flyout.\n   */\n  private createButton(\n    btnInfo: toolbox.ButtonOrLabelInfo,\n    isLabel: boolean,\n  ): FlyoutButton {\n    const curButton = new FlyoutButton(\n      this.workspace_,\n      this.targetWorkspace as WorkspaceSvg,\n      btnInfo,\n      isLabel,\n    );\n    return curButton;\n  }\n\n  /**\n   * Create a block from the xml and permanently disable any blocks that were\n   * defined as disabled.\n   *\n   * @param blockInfo The info of the block.\n   * @returns The block created from the blockInfo.\n   */\n  private createFlyoutBlock(blockInfo: toolbox.BlockInfo): BlockSvg {\n    let block;\n    if (blockInfo['blockxml']) {\n      const xml = (\n        typeof blockInfo['blockxml'] === 'string'\n          ? utilsXml.textToDom(blockInfo['blockxml'])\n          : blockInfo['blockxml']\n      ) as Element;\n      block = this.getRecycledBlock(xml.getAttribute('type')!);\n      if (!block) {\n        block = Xml.domToBlockInternal(xml, this.workspace_);\n      }\n    } else {\n      block = this.getRecycledBlock(blockInfo['type']!);\n      if (!block) {\n        if (blockInfo['enabled'] === undefined) {\n          blockInfo['enabled'] =\n            blockInfo['disabled'] !== 'true' && blockInfo['disabled'] !== true;\n        }\n        if (\n          blockInfo['disabledReasons'] === undefined &&\n          blockInfo['enabled'] === false\n        ) {\n          blockInfo['disabledReasons'] = [MANUALLY_DISABLED];\n        }\n        block = blocks.appendInternal(\n          blockInfo as blocks.State,\n          this.workspace_,\n        );\n      }\n    }\n\n    if (!block.isEnabled()) {\n      // Record blocks that were initially disabled.\n      // Do not enable these blocks as a result of capacity filtering.\n      this.permanentlyDisabled.push(block);\n    }\n    return block as BlockSvg;\n  }\n\n  /**\n   * Returns a block from the array of recycled blocks with the given type, or\n   * undefined if one cannot be found.\n   *\n   * @param blockType The type of the block to try to recycle.\n   * @returns The recycled block, or undefined if\n   *     one could not be recycled.\n   */\n  private getRecycledBlock(blockType: string): BlockSvg | undefined {\n    let index = -1;\n    for (let i = 0; i < this.recycledBlocks.length; i++) {\n      if (this.recycledBlocks[i].type === blockType) {\n        index = i;\n        break;\n      }\n    }\n    return index === -1 ? undefined : this.recycledBlocks.splice(index, 1)[0];\n  }\n\n  /**\n   * Adds a gap in the flyout based on block info.\n   *\n   * @param blockInfo Information about a block.\n   * @param gaps The list of gaps between items in the flyout.\n   * @param defaultGap The default gap between one element and the\n   *     next.\n   */\n  private addBlockGap(\n    blockInfo: toolbox.BlockInfo,\n    gaps: number[],\n    defaultGap: number,\n  ) {\n    let gap;\n    if (blockInfo['gap']) {\n      gap = parseInt(String(blockInfo['gap']));\n    } else if (blockInfo['blockxml']) {\n      const xml = (\n        typeof blockInfo['blockxml'] === 'string'\n          ? utilsXml.textToDom(blockInfo['blockxml'])\n          : blockInfo['blockxml']\n      ) as Element;\n      gap = parseInt(xml.getAttribute('gap')!);\n    }\n    gaps.push(!gap || isNaN(gap) ? defaultGap : gap);\n  }\n\n  /**\n   * Add the necessary gap in the flyout for a separator.\n   *\n   * @param sepInfo The object holding\n   *    information about a separator.\n   * @param gaps The list gaps between items in the flyout.\n   * @param defaultGap The default gap between the button and next\n   *     element.\n   */\n  private addSeparatorGap(\n    sepInfo: toolbox.SeparatorInfo,\n    gaps: number[],\n    defaultGap: number,\n  ) {\n    // Change the gap between two toolbox elements.\n    // <sep gap=\"36\"></sep>\n    // The default gap is 24, can be set larger or smaller.\n    // This overwrites the gap attribute on the previous element.\n    const newGap = parseInt(String(sepInfo['gap']));\n    // Ignore gaps before the first block.\n    if (!isNaN(newGap) && gaps.length > 0) {\n      gaps[gaps.length - 1] = newGap;\n    } else {\n      gaps.push(defaultGap);\n    }\n  }\n\n  /**\n   * Delete blocks, mats and buttons from a previous showing of the flyout.\n   */\n  private clearOldBlocks() {\n    // Delete any blocks from a previous showing.\n    const oldBlocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; (block = oldBlocks[i]); i++) {\n      if (this.blockIsRecyclable_(block)) {\n        this.recycleBlock(block);\n      } else {\n        block.dispose(false, false);\n      }\n    }\n    // Delete any mats from a previous showing.\n    for (let j = 0; j < this.mats.length; j++) {\n      const rect = this.mats[j];\n      if (rect) {\n        Tooltip.unbindMouseEvents(rect);\n        dom.removeNode(rect);\n      }\n    }\n    this.mats.length = 0;\n    // Delete any buttons from a previous showing.\n    for (let i = 0, button; (button = this.buttons_[i]); i++) {\n      button.dispose();\n    }\n    this.buttons_.length = 0;\n\n    // Clear potential variables from the previous showing.\n    this.workspace_.getPotentialVariableMap()?.clear();\n  }\n\n  /**\n   * Empties all of the recycled blocks, properly disposing of them.\n   */\n  private emptyRecycledBlocks() {\n    for (let i = 0; i < this.recycledBlocks.length; i++) {\n      this.recycledBlocks[i].dispose();\n    }\n    this.recycledBlocks = [];\n  }\n\n  /**\n   * Returns whether the given block can be recycled or not.\n   *\n   * @param _block The block to check for recyclability.\n   * @returns True if the block can be recycled. False otherwise.\n   */\n  protected blockIsRecyclable_(_block: BlockSvg): boolean {\n    // By default, recycling is disabled.\n    return false;\n  }\n\n  /**\n   * Puts a previously created block into the recycle bin and moves it to the\n   * top of the workspace. Used during large workspace swaps to limit the number\n   * of new DOM elements we need to create.\n   *\n   * @param block The block to recycle.\n   */\n  private recycleBlock(block: BlockSvg) {\n    const xy = block.getRelativeToSurfaceXY();\n    block.moveBy(-xy.x, -xy.y);\n    this.recycledBlocks.push(block);\n  }\n\n  /**\n   * Add listeners to a block that has been added to the flyout.\n   *\n   * @param root The root node of the SVG group the block is in.\n   * @param block The block to add listeners for.\n   * @param rect The invisible rectangle under the block that acts\n   *     as a mat for that block.\n   */\n  protected addBlockListeners_(\n    root: SVGElement,\n    block: BlockSvg,\n    rect: SVGElement,\n  ) {\n    this.listeners.push(\n      browserEvents.conditionalBind(\n        root,\n        'pointerdown',\n        null,\n        this.blockMouseDown(block),\n      ),\n    );\n    this.listeners.push(\n      browserEvents.conditionalBind(\n        rect,\n        'pointerdown',\n        null,\n        this.blockMouseDown(block),\n      ),\n    );\n    this.listeners.push(\n      browserEvents.bind(root, 'pointerenter', block, () => {\n        if (!this.targetWorkspace.isDragging()) {\n          block.addSelect();\n        }\n      }),\n    );\n    this.listeners.push(\n      browserEvents.bind(root, 'pointerleave', block, () => {\n        if (!this.targetWorkspace.isDragging()) {\n          block.removeSelect();\n        }\n      }),\n    );\n    this.listeners.push(\n      browserEvents.bind(rect, 'pointerenter', block, () => {\n        if (!this.targetWorkspace.isDragging()) {\n          block.addSelect();\n        }\n      }),\n    );\n    this.listeners.push(\n      browserEvents.bind(rect, 'pointerleave', block, () => {\n        if (!this.targetWorkspace.isDragging()) {\n          block.removeSelect();\n        }\n      }),\n    );\n  }\n\n  /**\n   * Handle a pointerdown on an SVG block in a non-closing flyout.\n   *\n   * @param block The flyout block to copy.\n   * @returns Function to call when block is clicked.\n   */\n  private blockMouseDown(block: BlockSvg) {\n    return (e: PointerEvent) => {\n      const gesture = this.targetWorkspace.getGesture(e);\n      if (gesture) {\n        gesture.setStartBlock(block);\n        gesture.handleFlyoutStart(e, this);\n      }\n    };\n  }\n\n  /**\n   * Pointer down on the flyout background.  Start a vertical scroll drag.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown(e: PointerEvent) {\n    const gesture = this.targetWorkspace.getGesture(e);\n    if (gesture) {\n      gesture.handleFlyoutStart(e, this);\n    }\n  }\n\n  /**\n   * Does this flyout allow you to create a new instance of the given block?\n   * Used for deciding if a block can be \"dragged out of\" the flyout.\n   *\n   * @param block The block to copy from the flyout.\n   * @returns True if you can create a new instance of the block, false\n   *    otherwise.\n   * @internal\n   */\n  isBlockCreatable(block: BlockSvg): boolean {\n    return block.isEnabled();\n  }\n\n  /**\n   * Create a copy of this block on the workspace.\n   *\n   * @param originalBlock The block to copy from the flyout.\n   * @returns The newly created block.\n   * @throws {Error} if something went wrong with deserialization.\n   * @internal\n   */\n  createBlock(originalBlock: BlockSvg): BlockSvg {\n    let newBlock = null;\n    eventUtils.disable();\n    const variablesBeforeCreation = this.targetWorkspace.getAllVariables();\n    this.targetWorkspace.setResizesEnabled(false);\n    try {\n      newBlock = this.placeNewBlock(originalBlock);\n    } finally {\n      eventUtils.enable();\n    }\n\n    // Close the flyout.\n    this.targetWorkspace.hideChaff();\n\n    const newVariables = Variables.getAddedVariables(\n      this.targetWorkspace,\n      variablesBeforeCreation,\n    );\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.setGroup(true);\n      // Fire a VarCreate event for each (if any) new variable created.\n      for (let i = 0; i < newVariables.length; i++) {\n        const thisVariable = newVariables[i];\n        eventUtils.fire(\n          new (eventUtils.get(EventType.VAR_CREATE))(thisVariable),\n        );\n      }\n\n      // Block events come after var events, in case they refer to newly created\n      // variables.\n      eventUtils.fire(new (eventUtils.get(EventType.BLOCK_CREATE))(newBlock));\n    }\n    if (this.autoClose) {\n      this.hide();\n    } else {\n      this.filterForCapacity();\n    }\n    return newBlock;\n  }\n\n  /**\n   * Initialize the given button: move it to the correct location,\n   * add listeners, etc.\n   *\n   * @param button The button to initialize and place.\n   * @param x The x position of the cursor during this layout pass.\n   * @param y The y position of the cursor during this layout pass.\n   */\n  protected initFlyoutButton_(button: FlyoutButton, x: number, y: number) {\n    const buttonSvg = button.createDom();\n    button.moveTo(x, y);\n    button.show();\n    // Clicking on a flyout button or label is a lot like clicking on the\n    // flyout background.\n    this.listeners.push(\n      browserEvents.conditionalBind(\n        buttonSvg,\n        'pointerdown',\n        this,\n        this.onMouseDown,\n      ),\n    );\n\n    this.buttons_.push(button);\n  }\n\n  /**\n   * Create and place a rectangle corresponding to the given block.\n   *\n   * @param block The block to associate the rect to.\n   * @param x The x position of the cursor during this layout pass.\n   * @param y The y position of the cursor during this layout pass.\n   * @param blockHW The height and width of\n   *     the block.\n   * @param index The index into the mats list where this rect should\n   *     be placed.\n   * @returns Newly created SVG element for the rectangle behind\n   *     the block.\n   */\n  protected createRect_(\n    block: BlockSvg,\n    x: number,\n    y: number,\n    blockHW: {height: number; width: number},\n    index: number,\n  ): SVGElement {\n    // Create an invisible rectangle under the block to act as a button.  Just\n    // using the block as a button is poor, since blocks have holes in them.\n    const rect = dom.createSvgElement(Svg.RECT, {\n      'fill-opacity': 0,\n      'x': x,\n      'y': y,\n      'height': blockHW.height,\n      'width': blockHW.width,\n    });\n    (rect as AnyDuringMigration).tooltip = block;\n    Tooltip.bindMouseEvents(rect);\n    // Add the rectangles under the blocks, so that the blocks' tooltips work.\n    this.workspace_.getCanvas().insertBefore(rect, block.getSvgRoot());\n\n    this.rectMap_.set(block, rect);\n    this.mats[index] = rect;\n    return rect;\n  }\n\n  /**\n   * Move a rectangle to sit exactly behind a block, taking into account tabs,\n   * hats, and any other protrusions we invent.\n   *\n   * @param rect The rectangle to move directly behind the block.\n   * @param block The block the rectangle should be behind.\n   */\n  protected moveRectToBlock_(rect: SVGElement, block: BlockSvg) {\n    const blockHW = block.getHeightWidth();\n    rect.setAttribute('width', String(blockHW.width));\n    rect.setAttribute('height', String(blockHW.height));\n\n    const blockXY = block.getRelativeToSurfaceXY();\n    rect.setAttribute('y', String(blockXY.y));\n    rect.setAttribute(\n      'x',\n      String(this.RTL ? blockXY.x - blockHW.width : blockXY.x),\n    );\n  }\n\n  /**\n   * Filter the blocks on the flyout to disable the ones that are above the\n   * capacity limit.  For instance, if the user may only place two more blocks\n   * on the workspace, an \"a + b\" block that has two shadow blocks would be\n   * disabled.\n   */\n  private filterForCapacity() {\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      if (!this.permanentlyDisabled.includes(block)) {\n        const enable = this.targetWorkspace.isCapacityAvailable(\n          common.getBlockTypeCounts(block),\n        );\n        while (block) {\n          block.setDisabledReason(\n            !enable,\n            WORKSPACE_AT_BLOCK_CAPACITY_DISABLED_REASON,\n          );\n          block = block.getNextBlock();\n        }\n      }\n    }\n  }\n\n  /**\n   * Reflow blocks and their mats.\n   */\n  reflow() {\n    if (this.reflowWrapper) {\n      this.workspace_.removeChangeListener(this.reflowWrapper);\n    }\n    this.reflowInternal_();\n    if (this.reflowWrapper) {\n      this.workspace_.addChangeListener(this.reflowWrapper);\n    }\n  }\n\n  /**\n   * @returns True if this flyout may be scrolled with a scrollbar or\n   *     by dragging.\n   * @internal\n   */\n  isScrollable(): boolean {\n    return this.workspace_.scrollbar\n      ? this.workspace_.scrollbar.isVisible()\n      : false;\n  }\n\n  /**\n   * Copy a block from the flyout to the workspace and position it correctly.\n   *\n   * @param oldBlock The flyout block to copy.\n   * @returns The new block in the main workspace.\n   */\n  private placeNewBlock(oldBlock: BlockSvg): BlockSvg {\n    const targetWorkspace = this.targetWorkspace;\n    const svgRootOld = oldBlock.getSvgRoot();\n    if (!svgRootOld) {\n      throw Error('oldBlock is not rendered');\n    }\n\n    // Clone the block.\n    const json = this.serializeBlock(oldBlock);\n    // Normally this resizes leading to weird jumps. Save it for terminateDrag.\n    targetWorkspace.setResizesEnabled(false);\n    const block = blocks.append(json, targetWorkspace) as BlockSvg;\n\n    this.positionNewBlock(oldBlock, block);\n\n    return block;\n  }\n\n  /**\n   * Serialize a block to JSON.\n   *\n   * @param block The block to serialize.\n   * @returns A serialized representation of the block.\n   */\n  protected serializeBlock(block: BlockSvg): blocks.State {\n    return blocks.save(block) as blocks.State;\n  }\n\n  /**\n   * Positions a block on the target workspace.\n   *\n   * @param oldBlock The flyout block being copied.\n   * @param block The block to posiiton.\n   */\n  private positionNewBlock(oldBlock: BlockSvg, block: BlockSvg) {\n    const targetWorkspace = this.targetWorkspace;\n\n    // The offset in pixels between the main workspace's origin and the upper\n    // left corner of the injection div.\n    const mainOffsetPixels = targetWorkspace.getOriginOffsetInPixels();\n\n    // The offset in pixels between the flyout workspace's origin and the upper\n    // left corner of the injection div.\n    const flyoutOffsetPixels = this.workspace_.getOriginOffsetInPixels();\n\n    // The position of the old block in flyout workspace coordinates.\n    const oldBlockPos = oldBlock.getRelativeToSurfaceXY();\n    // The position of the old block in pixels relative to the flyout\n    // workspace's origin.\n    oldBlockPos.scale(this.workspace_.scale);\n\n    // The position of the old block in pixels relative to the upper left corner\n    // of the injection div.\n    const oldBlockOffsetPixels = Coordinate.sum(\n      flyoutOffsetPixels,\n      oldBlockPos,\n    );\n\n    // The position of the old block in pixels relative to the origin of the\n    // main workspace.\n    const finalOffset = Coordinate.difference(\n      oldBlockOffsetPixels,\n      mainOffsetPixels,\n    );\n    // The position of the old block in main workspace coordinates.\n    finalOffset.scale(1 / targetWorkspace.scale);\n\n    // No 'reason' provided since events are disabled.\n    block.moveTo(new Coordinate(finalOffset.x, finalOffset.y));\n  }\n}\n\n/**\n * A flyout content item.\n */\nexport interface FlyoutItem {\n  type: FlyoutItemType;\n  button?: FlyoutButton | undefined;\n  block?: BlockSvg | undefined;\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Layout code for a vertical variant of the flyout.\n *\n * @class\n */\n// Former goog.module ID: Blockly.VerticalFlyout\n\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Flyout, FlyoutItem} from './flyout_base.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport type {Options} from './options.js';\nimport * as registry from './registry.js';\nimport {Scrollbar} from './scrollbar.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n/**\n * Class for a flyout.\n */\nexport class VerticalFlyout extends Flyout {\n  /** The name of the vertical flyout in the registry. */\n  static registryName = 'verticalFlyout';\n\n  /** @param workspaceOptions Dictionary of options for the workspace. */\n  constructor(workspaceOptions: Options) {\n    super(workspaceOptions);\n  }\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float between 0 and 1\n   *     specifying the degree of scrolling and a similar x property.\n   */\n  protected override setMetrics_(xyRatio: {x: number; y: number}) {\n    if (!this.isVisible()) {\n      return;\n    }\n    const metricsManager = this.workspace_.getMetricsManager();\n    const scrollMetrics = metricsManager.getScrollMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n\n    if (typeof xyRatio.y === 'number') {\n      this.workspace_.scrollY = -(\n        scrollMetrics.top +\n        (scrollMetrics.height - viewMetrics.height) * xyRatio.y\n      );\n    }\n    this.workspace_.translate(\n      this.workspace_.scrollX + absoluteMetrics.left,\n      this.workspace_.scrollY + absoluteMetrics.top,\n    );\n  }\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  override getX(): number {\n    if (!this.isVisible()) {\n      return 0;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const toolboxMetrics = metricsManager.getToolboxMetrics();\n    let x = 0;\n\n    // If this flyout is not the trashcan flyout (e.g. toolbox or mutator).\n    // Trashcan flyout is opposite the main flyout.\n    if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_) {\n      // If there is a category toolbox.\n      // Simple (flyout-only) toolbox.\n      if (this.targetWorkspace!.getToolbox()) {\n        if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n          x = toolboxMetrics.width;\n        } else {\n          x = viewMetrics.width - this.width_;\n        }\n      } else {\n        if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n          x = 0;\n        } else {\n          // The simple flyout does not cover the workspace.\n          x = viewMetrics.width;\n        }\n      }\n    } else {\n      if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n        x = 0;\n      } else {\n        // Because the anchor point of the flyout is on the left, but we want\n        // to align the right edge of the flyout with the right edge of the\n        // blocklyDiv, we calculate the full width of the div minus the width\n        // of the flyout.\n        x = viewMetrics.width + absoluteMetrics.left - this.width_;\n      }\n    }\n\n    return x;\n  }\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  override getY(): number {\n    // Y is always 0 since this is a vertical flyout.\n    return 0;\n  }\n\n  /** Move the flyout to the edge of the workspace. */\n  override position() {\n    if (!this.isVisible() || !this.targetWorkspace!.isVisible()) {\n      return;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const targetWorkspaceViewMetrics = metricsManager.getViewMetrics();\n    this.height_ = targetWorkspaceViewMetrics.height;\n\n    const edgeWidth = this.width_ - this.CORNER_RADIUS;\n    const edgeHeight =\n      targetWorkspaceViewMetrics.height - 2 * this.CORNER_RADIUS;\n    this.setBackgroundPath(edgeWidth, edgeHeight);\n\n    const x = this.getX();\n    const y = this.getY();\n\n    this.positionAt_(this.width_, this.height_, x, y);\n  }\n\n  /**\n   * Create and set the path for the visible boundaries of the flyout.\n   *\n   * @param width The width of the flyout, not including the rounded corners.\n   * @param height The height of the flyout, not including rounded corners.\n   */\n  private setBackgroundPath(width: number, height: number) {\n    const atRight = this.toolboxPosition_ === toolbox.Position.RIGHT;\n    const totalWidth = width + this.CORNER_RADIUS;\n\n    // Decide whether to start on the left or right.\n    const path: Array<string | number> = [\n      'M ' + (atRight ? totalWidth : 0) + ',0',\n    ];\n    // Top.\n    path.push('h', atRight ? -width : width);\n    // Rounded corner.\n    path.push(\n      'a',\n      this.CORNER_RADIUS,\n      this.CORNER_RADIUS,\n      0,\n      0,\n      atRight ? 0 : 1,\n      atRight ? -this.CORNER_RADIUS : this.CORNER_RADIUS,\n      this.CORNER_RADIUS,\n    );\n    // Side closest to workspace.\n    path.push('v', Math.max(0, height));\n    // Rounded corner.\n    path.push(\n      'a',\n      this.CORNER_RADIUS,\n      this.CORNER_RADIUS,\n      0,\n      0,\n      atRight ? 0 : 1,\n      atRight ? this.CORNER_RADIUS : -this.CORNER_RADIUS,\n      this.CORNER_RADIUS,\n    );\n    // Bottom.\n    path.push('h', atRight ? width : -width);\n    path.push('z');\n    this.svgBackground_!.setAttribute('d', path.join(' '));\n  }\n\n  /** Scroll the flyout to the top. */\n  override scrollToStart() {\n    this.workspace_.scrollbar?.setY(0);\n  }\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected override wheel_(e: WheelEvent) {\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n\n    if (scrollDelta.y) {\n      const metricsManager = this.workspace_.getMetricsManager();\n      const scrollMetrics = metricsManager.getScrollMetrics();\n      const viewMetrics = metricsManager.getViewMetrics();\n      const pos = viewMetrics.top - scrollMetrics.top + scrollDelta.y;\n\n      this.workspace_.scrollbar?.setY(pos);\n      // When the flyout moves from a wheel event, hide WidgetDiv and\n      // dropDownDiv.\n      WidgetDiv.hideIfOwnerIsInWorkspace(this.workspace_);\n      dropDownDiv.hideWithoutAnimation();\n    }\n    // Don't scroll the page.\n    e.preventDefault();\n    // Don't propagate mousewheel event (zooming).\n    e.stopPropagation();\n  }\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected override layout_(contents: FlyoutItem[], gaps: number[]) {\n    this.workspace_.scale = this.targetWorkspace!.scale;\n    const margin = this.MARGIN;\n    const cursorX = this.RTL ? margin : margin + this.tabWidth_;\n    let cursorY = margin;\n\n    for (let i = 0, item; (item = contents[i]); i++) {\n      if (item.type === 'block') {\n        const block = item.block;\n        if (!block) {\n          continue;\n        }\n        const allBlocks = block.getDescendants(false);\n        for (let j = 0, child; (child = allBlocks[j]); j++) {\n          // Mark blocks as being inside a flyout.  This is used to detect and\n          // prevent the closure of the flyout if the user right-clicks on such\n          // a block.\n          child.isInFlyout = true;\n        }\n        const root = block.getSvgRoot();\n        const blockHW = block.getHeightWidth();\n        const moveX = block.outputConnection\n          ? cursorX - this.tabWidth_\n          : cursorX;\n        block.moveBy(moveX, cursorY);\n\n        const rect = this.createRect_(\n          block,\n          this.RTL ? moveX - blockHW.width : moveX,\n          cursorY,\n          blockHW,\n          i,\n        );\n\n        this.addBlockListeners_(root, block, rect);\n\n        cursorY += blockHW.height + gaps[i];\n      } else if (item.type === 'button') {\n        const button = item.button as FlyoutButton;\n        this.initFlyoutButton_(button, cursorX, cursorY);\n        cursorY += button.height + gaps[i];\n      }\n    }\n  }\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   */\n  override isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean {\n    const dx = currentDragDeltaXY.x;\n    const dy = currentDragDeltaXY.y;\n    // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\n    const dragDirection = (Math.atan2(dy, dx) / Math.PI) * 180;\n\n    const range = this.dragAngleRange_;\n    // Check for left or right dragging.\n    if (\n      (dragDirection < range && dragDirection > -range) ||\n      dragDirection < -180 + range ||\n      dragDirection > 180 - range\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect | null {\n    if (!this.svgGroup_ || this.autoClose || !this.isVisible()) {\n      // The bounding rectangle won't compute correctly if the flyout is closed\n      // and auto-close flyouts aren't valid drag targets (or delete areas).\n      return null;\n    }\n\n    const flyoutRect = this.svgGroup_.getBoundingClientRect();\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the shown\n    // flyout area are still deleted.  Must be larger than the largest screen\n    // size, but be smaller than half Number.MAX_SAFE_INTEGER (not available on\n    // IE).\n    const BIG_NUM = 1000000000;\n    const left = flyoutRect.left;\n\n    if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n      const width = flyoutRect.width;\n      return new Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, left + width);\n    } else {\n      // Right\n      return new Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\n    }\n  }\n\n  /**\n   * Compute width of flyout.  toolbox.Position mat under each block.\n   * For RTL: Lay out the blocks and buttons to be right-aligned.\n   */\n  protected override reflowInternal_() {\n    this.workspace_.scale = this.getFlyoutScale();\n    let flyoutWidth = 0;\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      let width = block.getHeightWidth().width;\n      if (block.outputConnection) {\n        width -= this.tabWidth_;\n      }\n      flyoutWidth = Math.max(flyoutWidth, width);\n    }\n    for (let i = 0, button; (button = this.buttons_[i]); i++) {\n      flyoutWidth = Math.max(flyoutWidth, button.width);\n    }\n    flyoutWidth += this.MARGIN * 1.5 + this.tabWidth_;\n    flyoutWidth *= this.workspace_.scale;\n    flyoutWidth += Scrollbar.scrollbarThickness;\n\n    if (this.width_ !== flyoutWidth) {\n      for (let i = 0, block; (block = blocks[i]); i++) {\n        if (this.RTL) {\n          // With the flyoutWidth known, right-align the blocks.\n          const oldX = block.getRelativeToSurfaceXY().x;\n          let newX = flyoutWidth / this.workspace_.scale - this.MARGIN;\n          if (!block.outputConnection) {\n            newX -= this.tabWidth_;\n          }\n          block.moveBy(newX - oldX, 0);\n        }\n        if (this.rectMap_.has(block)) {\n          this.moveRectToBlock_(this.rectMap_.get(block)!, block);\n        }\n      }\n      if (this.RTL) {\n        // With the flyoutWidth known, right-align the buttons.\n        for (let i = 0, button; (button = this.buttons_[i]); i++) {\n          const y = button.getPosition().y;\n          const x =\n            flyoutWidth / this.workspace_.scale -\n            button.width -\n            this.MARGIN -\n            this.tabWidth_;\n          button.moveTo(x, y);\n        }\n      }\n\n      // TODO(#7689): Remove this.\n      // Workspace with no scrollbars where this is permanently\n      // open on the left.\n      // If scrollbars exist they properly update the metrics.\n      if (\n        !this.targetWorkspace.scrollbar &&\n        !this.autoClose &&\n        this.targetWorkspace.getFlyout() === this &&\n        this.toolboxPosition_ === toolbox.Position.LEFT\n      ) {\n        this.targetWorkspace.translate(\n          this.targetWorkspace.scrollX + flyoutWidth,\n          this.targetWorkspace.scrollY,\n        );\n      }\n\n      this.width_ = flyoutWidth;\n      this.position();\n      this.targetWorkspace.resizeContents();\n      this.targetWorkspace.recordDragTargets();\n    }\n  }\n}\n\nregistry.register(\n  registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n  registry.DEFAULT,\n  VerticalFlyout,\n);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Horizontal flyout tray containing blocks which may be created.\n *\n * @class\n */\n// Former goog.module ID: Blockly.HorizontalFlyout\n\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Flyout, FlyoutItem} from './flyout_base.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport type {Options} from './options.js';\nimport * as registry from './registry.js';\nimport {Scrollbar} from './scrollbar.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n/**\n * Class for a flyout.\n */\nexport class HorizontalFlyout extends Flyout {\n  override horizontalLayout = true;\n\n  /** @param workspaceOptions Dictionary of options for the workspace. */\n  constructor(workspaceOptions: Options) {\n    super(workspaceOptions);\n  }\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float between 0 and 1\n   *     specifying the degree of scrolling and a similar x property.\n   */\n  protected override setMetrics_(xyRatio: {x: number; y: number}) {\n    if (!this.isVisible()) {\n      return;\n    }\n\n    const metricsManager = this.workspace_.getMetricsManager();\n    const scrollMetrics = metricsManager.getScrollMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n\n    if (typeof xyRatio.x === 'number') {\n      this.workspace_.scrollX = -(\n        scrollMetrics.left +\n        (scrollMetrics.width - viewMetrics.width) * xyRatio.x\n      );\n    }\n\n    this.workspace_.translate(\n      this.workspace_.scrollX + absoluteMetrics.left,\n      this.workspace_.scrollY + absoluteMetrics.top,\n    );\n  }\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  override getX(): number {\n    // X is always 0 since this is a horizontal flyout.\n    return 0;\n  }\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  override getY(): number {\n    if (!this.isVisible()) {\n      return 0;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const toolboxMetrics = metricsManager.getToolboxMetrics();\n\n    let y = 0;\n    const atTop = this.toolboxPosition_ === toolbox.Position.TOP;\n    // If this flyout is not the trashcan flyout (e.g. toolbox or mutator).\n    // Trashcan flyout is opposite the main flyout.\n    if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_) {\n      // If there is a category toolbox.\n      // Simple (flyout-only) toolbox.\n      if (this.targetWorkspace!.getToolbox()) {\n        if (atTop) {\n          y = toolboxMetrics.height;\n        } else {\n          y = viewMetrics.height - this.height_;\n        }\n      } else {\n        if (atTop) {\n          y = 0;\n        } else {\n          // The simple flyout does not cover the workspace.\n          y = viewMetrics.height;\n        }\n      }\n    } else {\n      if (atTop) {\n        y = 0;\n      } else {\n        // Because the anchor point of the flyout is on the top, but we want\n        // to align the bottom edge of the flyout with the bottom edge of the\n        // blocklyDiv, we calculate the full height of the div minus the height\n        // of the flyout.\n        y = viewMetrics.height + absoluteMetrics.top - this.height_;\n      }\n    }\n\n    return y;\n  }\n\n  /** Move the flyout to the edge of the workspace. */\n  override position() {\n    if (!this.isVisible() || !this.targetWorkspace!.isVisible()) {\n      return;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const targetWorkspaceViewMetrics = metricsManager.getViewMetrics();\n    this.width_ = targetWorkspaceViewMetrics.width;\n\n    const edgeWidth = targetWorkspaceViewMetrics.width - 2 * this.CORNER_RADIUS;\n    const edgeHeight = this.height_ - this.CORNER_RADIUS;\n    this.setBackgroundPath(edgeWidth, edgeHeight);\n\n    const x = this.getX();\n    const y = this.getY();\n\n    this.positionAt_(this.width_, this.height_, x, y);\n  }\n\n  /**\n   * Create and set the path for the visible boundaries of the flyout.\n   *\n   * @param width The width of the flyout, not including the rounded corners.\n   * @param height The height of the flyout, not including rounded corners.\n   */\n  private setBackgroundPath(width: number, height: number) {\n    const atTop = this.toolboxPosition_ === toolbox.Position.TOP;\n    // Start at top left.\n    const path: (string | number)[] = [\n      'M 0,' + (atTop ? 0 : this.CORNER_RADIUS),\n    ];\n\n    if (atTop) {\n      // Top.\n      path.push('h', width + 2 * this.CORNER_RADIUS);\n      // Right.\n      path.push('v', height);\n      // Bottom.\n      path.push(\n        'a',\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n        0,\n        0,\n        1,\n        -this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n      );\n      path.push('h', -width);\n      // Left.\n      path.push(\n        'a',\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n        0,\n        0,\n        1,\n        -this.CORNER_RADIUS,\n        -this.CORNER_RADIUS,\n      );\n      path.push('z');\n    } else {\n      // Top.\n      path.push(\n        'a',\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n        0,\n        0,\n        1,\n        this.CORNER_RADIUS,\n        -this.CORNER_RADIUS,\n      );\n      path.push('h', width);\n      // Right.\n      path.push(\n        'a',\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n        0,\n        0,\n        1,\n        this.CORNER_RADIUS,\n        this.CORNER_RADIUS,\n      );\n      path.push('v', height);\n      // Bottom.\n      path.push('h', -width - 2 * this.CORNER_RADIUS);\n      // Left.\n      path.push('z');\n    }\n    this.svgBackground_!.setAttribute('d', path.join(' '));\n  }\n\n  /** Scroll the flyout to the top. */\n  override scrollToStart() {\n    this.workspace_.scrollbar?.setX(this.RTL ? Infinity : 0);\n  }\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected override wheel_(e: WheelEvent) {\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n    const delta = scrollDelta.x || scrollDelta.y;\n\n    if (delta) {\n      const metricsManager = this.workspace_.getMetricsManager();\n      const scrollMetrics = metricsManager.getScrollMetrics();\n      const viewMetrics = metricsManager.getViewMetrics();\n\n      const pos = viewMetrics.left - scrollMetrics.left + delta;\n      this.workspace_.scrollbar?.setX(pos);\n      // When the flyout moves from a wheel event, hide WidgetDiv and\n      // dropDownDiv.\n      WidgetDiv.hideIfOwnerIsInWorkspace(this.workspace_);\n      dropDownDiv.hideWithoutAnimation();\n    }\n    // Don't scroll the page.\n    e.preventDefault();\n    // Don't propagate mousewheel event (zooming).\n    e.stopPropagation();\n  }\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected override layout_(contents: FlyoutItem[], gaps: number[]) {\n    this.workspace_.scale = this.targetWorkspace!.scale;\n    const margin = this.MARGIN;\n    let cursorX = margin + this.tabWidth_;\n    const cursorY = margin;\n    if (this.RTL) {\n      contents = contents.reverse();\n    }\n\n    for (let i = 0, item; (item = contents[i]); i++) {\n      if (item.type === 'block') {\n        const block = item.block;\n\n        if (block === undefined || block === null) {\n          continue;\n        }\n\n        const allBlocks = block.getDescendants(false);\n\n        for (let j = 0, child; (child = allBlocks[j]); j++) {\n          // Mark blocks as being inside a flyout.  This is used to detect and\n          // prevent the closure of the flyout if the user right-clicks on such\n          // a block.\n          child.isInFlyout = true;\n        }\n        const root = block.getSvgRoot();\n        const blockHW = block.getHeightWidth();\n        // Figure out where to place the block.\n        const tab = block.outputConnection ? this.tabWidth_ : 0;\n        let moveX;\n        if (this.RTL) {\n          moveX = cursorX + blockHW.width;\n        } else {\n          moveX = cursorX - tab;\n        }\n        block.moveBy(moveX, cursorY);\n\n        const rect = this.createRect_(block, moveX, cursorY, blockHW, i);\n        cursorX += blockHW.width + gaps[i];\n\n        this.addBlockListeners_(root, block, rect);\n      } else if (item.type === 'button') {\n        const button = item.button as FlyoutButton;\n        this.initFlyoutButton_(button, cursorX, cursorY);\n        cursorX += button.width + gaps[i];\n      }\n    }\n  }\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   */\n  override isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean {\n    const dx = currentDragDeltaXY.x;\n    const dy = currentDragDeltaXY.y;\n    // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\n    const dragDirection = (Math.atan2(dy, dx) / Math.PI) * 180;\n\n    const range = this.dragAngleRange_;\n    // Check for up or down dragging.\n    if (\n      (dragDirection < 90 + range && dragDirection > 90 - range) ||\n      (dragDirection > -90 - range && dragDirection < -90 + range)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect | null {\n    if (!this.svgGroup_ || this.autoClose || !this.isVisible()) {\n      // The bounding rectangle won't compute correctly if the flyout is closed\n      // and auto-close flyouts aren't valid drag targets (or delete areas).\n      return null;\n    }\n\n    const flyoutRect = this.svgGroup_.getBoundingClientRect();\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the shown\n    // flyout area are still deleted.  Must be larger than the largest screen\n    // size, but be smaller than half Number.MAX_SAFE_INTEGER (not available on\n    // IE).\n    const BIG_NUM = 1000000000;\n    const top = flyoutRect.top;\n\n    if (this.toolboxPosition_ === toolbox.Position.TOP) {\n      const height = flyoutRect.height;\n      return new Rect(-BIG_NUM, top + height, -BIG_NUM, BIG_NUM);\n    } else {\n      // Bottom.\n      return new Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\n    }\n  }\n\n  /**\n   * Compute height of flyout.  toolbox.Position mat under each block.\n   * For RTL: Lay out the blocks right-aligned.\n   */\n  protected override reflowInternal_() {\n    this.workspace_.scale = this.getFlyoutScale();\n    let flyoutHeight = 0;\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; (block = blocks[i]); i++) {\n      flyoutHeight = Math.max(flyoutHeight, block.getHeightWidth().height);\n    }\n    const buttons = this.buttons_;\n    for (let i = 0, button; (button = buttons[i]); i++) {\n      flyoutHeight = Math.max(flyoutHeight, button.height);\n    }\n    flyoutHeight += this.MARGIN * 1.5;\n    flyoutHeight *= this.workspace_.scale;\n    flyoutHeight += Scrollbar.scrollbarThickness;\n\n    if (this.height_ !== flyoutHeight) {\n      for (let i = 0, block; (block = blocks[i]); i++) {\n        if (this.rectMap_.has(block)) {\n          this.moveRectToBlock_(this.rectMap_.get(block)!, block);\n        }\n      }\n\n      // TODO(#7689): Remove this.\n      // Workspace with no scrollbars where this is permanently open on the top.\n      // If scrollbars exist they properly update the metrics.\n      if (\n        !this.targetWorkspace.scrollbar &&\n        !this.autoClose &&\n        this.targetWorkspace.getFlyout() === this &&\n        this.toolboxPosition_ === toolbox.Position.TOP\n      ) {\n        this.targetWorkspace.translate(\n          this.targetWorkspace.scrollX,\n          this.targetWorkspace.scrollY + flyoutHeight,\n        );\n      }\n\n      this.height_ = flyoutHeight;\n      this.position();\n      this.targetWorkspace.resizeContents();\n      this.targetWorkspace.recordDragTargets();\n    }\n  }\n}\n\nregistry.register(\n  registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n  registry.DEFAULT,\n  HorizontalFlyout,\n);\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Variable input field.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldVariable\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport {Field, FieldConfig, UnattachedFieldError} from './field.js';\nimport {\n  FieldDropdown,\n  FieldDropdownValidator,\n  MenuGenerator,\n  MenuOption,\n} from './field_dropdown.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as internalConstants from './internal_constants.js';\nimport type {Menu} from './menu.js';\nimport type {MenuItem} from './menuitem.js';\nimport {Msg} from './msg.js';\nimport * as parsing from './utils/parsing.js';\nimport {Size} from './utils/size.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as Xml from './xml.js';\n\n/**\n * Class for a variable's dropdown field.\n */\nexport class FieldVariable extends FieldDropdown {\n  protected override menuGenerator_: MenuGenerator | undefined;\n  defaultVariableName: string;\n\n  /** The type of the default variable for this field. */\n  private defaultType = '';\n\n  /**\n   * All of the types of variables that will be available in this field's\n   * dropdown.\n   */\n  variableTypes: string[] | null = [];\n  protected override size_: Size;\n\n  /** The variable model associated with this field. */\n  private variable: VariableModel | null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * @param varName The default name for the variable.\n   *     If null, a unique variable name will be generated.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a variable ID  & returns a validated variable\n   *     ID, or null to abort the change.\n   * @param variableTypes A list of the types of variables to include in the\n   *     dropdown. Will only be used if config is not provided.\n   * @param defaultType The type of variable to create if this field's value\n   *     is not explicitly set.  Defaults to ''. Will only be used if config\n   *     is not provided.\n   * @param config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/variable#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    varName: string | null | typeof Field.SKIP_SETUP,\n    validator?: FieldVariableValidator,\n    variableTypes?: string[],\n    defaultType?: string,\n    config?: FieldVariableConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    /**\n     * An array of options for a dropdown list,\n     * or a function which generates these options.\n     */\n    this.menuGenerator_ = FieldVariable.dropdownCreate as MenuGenerator;\n\n    /**\n     * The initial variable name passed to this field's constructor, or an\n     * empty string if a name wasn't provided. Used to create the initial\n     * variable.\n     */\n    this.defaultVariableName = typeof varName === 'string' ? varName : '';\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(0, 0);\n\n    if (varName === Field.SKIP_SETUP) return;\n\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.setTypes(variableTypes, defaultType);\n    }\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldVariableConfig) {\n    super.configure_(config);\n    this.setTypes(config.variableTypes, config.defaultType);\n  }\n\n  /**\n   * Initialize the model for this field if it has not already been initialized.\n   * If the value has not been set to a variable by the first render, we make up\n   * a variable rather than let the value be invalid.\n   */\n  override initModel() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    if (this.variable) {\n      return; // Initialization already happened.\n    }\n    const variable = Variables.getOrCreateVariablePackage(\n      block.workspace,\n      null,\n      this.defaultVariableName,\n      this.defaultType,\n    );\n    // Don't call setValue because we don't want to cause a rerender.\n    this.doValueUpdate_(variable.getId());\n  }\n\n  override shouldAddBorderRect_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    return (\n      super.shouldAddBorderRect_() &&\n      (!this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW ||\n        block.type !== 'variables_get')\n    );\n  }\n\n  /**\n   * Initialize this field based on the given XML.\n   *\n   * @param fieldElement The element containing information about the variable\n   *     field's state.\n   */\n  override fromXml(fieldElement: Element) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const id = fieldElement.getAttribute('id');\n    const variableName = fieldElement.textContent;\n    // 'variabletype' should be lowercase, but until July 2019 it was sometimes\n    // recorded as 'variableType'.  Thus we need to check for both.\n    const variableType =\n      fieldElement.getAttribute('variabletype') ||\n      fieldElement.getAttribute('variableType') ||\n      '';\n\n    // AnyDuringMigration because:  Argument of type 'string | null' is not\n    // assignable to parameter of type 'string | undefined'.\n    const variable = Variables.getOrCreateVariablePackage(\n      block.workspace,\n      id,\n      variableName as AnyDuringMigration,\n      variableType,\n    );\n\n    // This should never happen :)\n    if (variableType !== null && variableType !== variable.type) {\n      throw Error(\n        \"Serialized variable type with id '\" +\n          variable.getId() +\n          \"' had type \" +\n          variable.type +\n          ', and ' +\n          'does not match variable field that references it: ' +\n          Xml.domToText(fieldElement) +\n          '.',\n      );\n    }\n\n    this.setValue(variable.getId());\n  }\n\n  /**\n   * Serialize this field to XML.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   */\n  override toXml(fieldElement: Element): Element {\n    // Make sure the variable is initialized.\n    this.initModel();\n\n    fieldElement.id = this.variable!.getId();\n    fieldElement.textContent = this.variable!.name;\n    if (this.variable!.type) {\n      fieldElement.setAttribute('variabletype', this.variable!.type);\n    }\n    return fieldElement;\n  }\n\n  /**\n   * Saves this field's value.\n   *\n   * @param doFullSerialization If true, the variable field will serialize the\n   *     full state of the field being referenced (ie ID, name, and type) rather\n   *     than just a reference to it (ie ID).\n   * @returns The state of the variable field.\n   * @internal\n   */\n  override saveState(doFullSerialization?: boolean): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldVariable);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    // Make sure the variable is initialized.\n    this.initModel();\n    const state = {'id': this.variable!.getId()};\n    if (doFullSerialization) {\n      (state as AnyDuringMigration)['name'] = this.variable!.name;\n      (state as AnyDuringMigration)['type'] = this.variable!.type;\n    }\n    return state;\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   *\n   * @param state The state of the variable to assign to this variable field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    if (this.loadLegacyState(FieldVariable, state)) {\n      return;\n    }\n    // This is necessary so that blocks in the flyout can have custom var names.\n    const variable = Variables.getOrCreateVariablePackage(\n      block.workspace,\n      state['id'] || null,\n      state['name'],\n      state['type'] || '',\n    );\n    this.setValue(variable.getId());\n  }\n\n  /**\n   * Attach this field to a block.\n   *\n   * @param block The block containing this field.\n   */\n  override setSourceBlock(block: Block) {\n    if (block.isShadow()) {\n      throw Error('Variable fields are not allowed to exist on shadow blocks.');\n    }\n    super.setSourceBlock(block);\n  }\n\n  /**\n   * Get the variable's ID.\n   *\n   * @returns Current variable's ID.\n   */\n  override getValue(): string | null {\n    return this.variable ? this.variable.getId() : null;\n  }\n\n  /**\n   * Get the text from this field, which is the selected variable's name.\n   *\n   * @returns The selected variable's name, or the empty string if no variable\n   *     is selected.\n   */\n  override getText(): string {\n    return this.variable ? this.variable.name : '';\n  }\n\n  /**\n   * Get the variable model for the selected variable.\n   * Not guaranteed to be in the variable map on the workspace (e.g. if accessed\n   * after the variable has been deleted).\n   *\n   * @returns The selected variable, or null if none was selected.\n   * @internal\n   */\n  getVariable(): VariableModel | null {\n    return this.variable;\n  }\n\n  /**\n   * Gets the validation function for this field, or null if not set.\n   * Returns null if the variable is not set, because validators should not\n   * run on the initial setValue call, because the field won't be attached to\n   * a block and workspace at that point.\n   *\n   * @returns Validation function, or null.\n   */\n  override getValidator(): FieldVariableValidator | null {\n    // Validators shouldn't operate on the initial setValue call.\n    // Normally this is achieved by calling setValidator after setValue, but\n    // this is not a possibility with variable fields.\n    if (this.variable) {\n      return this.validator_;\n    }\n    return null;\n  }\n\n  /**\n   * Ensure that the ID belongs to a valid variable of an allowed type.\n   *\n   * @param newValue The ID of the new variable to set.\n   * @returns The validated ID, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): string | null {\n    if (newValue === null) {\n      return null;\n    }\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const newId = newValue as string;\n    const variable = Variables.getVariable(block.workspace, newId);\n    if (!variable) {\n      console.warn(\n        \"Variable id doesn't point to a real variable! \" + 'ID was ' + newId,\n      );\n      return null;\n    }\n    // Type Checks.\n    const type = variable.type;\n    if (!this.typeIsAllowed(type)) {\n      console.warn(\"Variable type doesn't match this field!  Type was \" + type);\n      return null;\n    }\n    return newId;\n  }\n\n  /**\n   * Update the value of this variable field, as well as its variable and text.\n   *\n   * The variable ID should be valid at this point, but if a variable field\n   * validator returns a bad ID, this could break.\n   *\n   * @param newId The value to be saved.\n   */\n  protected override doValueUpdate_(newId: string) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.variable = Variables.getVariable(block.workspace, newId as string);\n    super.doValueUpdate_(newId);\n  }\n\n  /**\n   * Check whether the given variable type is allowed on this field.\n   *\n   * @param type The type to check.\n   * @returns True if the type is in the list of allowed types.\n   */\n  private typeIsAllowed(type: string): boolean {\n    const typeList = this.getVariableTypes();\n    if (!typeList) {\n      return true; // If it's null, all types are valid.\n    }\n    for (let i = 0; i < typeList.length; i++) {\n      if (type === typeList[i]) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Return a list of variable types to include in the dropdown.\n   *\n   * @returns Array of variable types.\n   * @throws {Error} if variableTypes is an empty array.\n   */\n  private getVariableTypes(): string[] {\n    let variableTypes = this.variableTypes;\n    if (variableTypes === null) {\n      // If variableTypes is null, return all variable types.\n      if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n        return this.sourceBlock_.workspace.getVariableTypes();\n      }\n    }\n    variableTypes = variableTypes || [''];\n    if (variableTypes.length === 0) {\n      // Throw an error if variableTypes is an empty list.\n      const name = this.getText();\n      throw Error(\n        \"'variableTypes' of field variable \" + name + ' was an empty list',\n      );\n    }\n    return variableTypes;\n  }\n\n  /**\n   * Parse the optional arguments representing the allowed variable types and\n   * the default variable type.\n   *\n   * @param variableTypes A list of the types of variables to include in the\n   *     dropdown.  If null or undefined, variables of all types will be\n   *     displayed in the dropdown.\n   * @param defaultType The type of the variable to create if this field's\n   *     value is not explicitly set.  Defaults to ''.\n   */\n  private setTypes(variableTypes: string[] | null = null, defaultType = '') {\n    // If you expected that the default type would be the same as the only entry\n    // in the variable types array, tell the Blockly team by commenting on\n    // #1499.\n    // Set the allowable variable types.  Null means all types on the workspace.\n    if (Array.isArray(variableTypes)) {\n      // Make sure the default type is valid.\n      let isInArray = false;\n      for (let i = 0; i < variableTypes.length; i++) {\n        if (variableTypes[i] === defaultType) {\n          isInArray = true;\n        }\n      }\n      if (!isInArray) {\n        throw Error(\n          \"Invalid default type '\" +\n            defaultType +\n            \"' in \" +\n            'the definition of a FieldVariable',\n        );\n      }\n    } else if (variableTypes !== null) {\n      throw Error(\n        \"'variableTypes' was not an array in the definition of \" +\n          'a FieldVariable',\n      );\n    }\n    // Only update the field once all checks pass.\n    this.defaultType = defaultType;\n    this.variableTypes = variableTypes;\n  }\n\n  /**\n   * Refreshes the name of the variable by grabbing the name of the model.\n   * Used when a variable gets renamed, but the ID stays the same. Should only\n   * be called by the block.\n   *\n   * @internal\n   */\n  override refreshVariableName() {\n    this.forceRerender();\n  }\n\n  /**\n   * Handle the selection of an item in the variable dropdown menu.\n   * Special case the 'Rename variable...' and 'Delete variable...' options.\n   * In the rename case, prompt the user for a new name.\n   *\n   * @param menu The Menu component clicked.\n   * @param menuItem The MenuItem selected within menu.\n   */\n  protected override onItemSelected_(menu: Menu, menuItem: MenuItem) {\n    const id = menuItem.getValue();\n    // Handle special cases.\n    if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n      if (id === internalConstants.RENAME_VARIABLE_ID) {\n        // Rename variable.\n        Variables.renameVariable(\n          this.sourceBlock_.workspace,\n          this.variable as VariableModel,\n        );\n        return;\n      } else if (id === internalConstants.DELETE_VARIABLE_ID) {\n        // Delete variable.\n        this.sourceBlock_.workspace.deleteVariableById(this.variable!.getId());\n        return;\n      }\n    }\n    // Handle unspecial case.\n    this.setValue(id);\n  }\n\n  /**\n   * Overrides referencesVariables(), indicating this field refers to a\n   * variable.\n   *\n   * @returns True.\n   * @internal\n   */\n  override referencesVariables(): boolean {\n    return true;\n  }\n\n  /**\n   * Construct a FieldVariable from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (variable, variableTypes, and\n   *     defaultType).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldVariableFromJsonConfig,\n  ): FieldVariable {\n    const varName = parsing.replaceMessageReferences(options.variable);\n    // `this` might be a subclass of FieldVariable if that class doesn't\n    // override the static fromJson method.\n    return new this(varName, undefined, undefined, undefined, options);\n  }\n\n  /**\n   * Return a sorted list of variable names for variable dropdown menus.\n   * Include a special option at the end for creating a new variable name.\n   *\n   * @returns Array of variable names/id tuples.\n   */\n  static dropdownCreate(this: FieldVariable): MenuOption[] {\n    if (!this.variable) {\n      throw Error(\n        'Tried to call dropdownCreate on a variable field with no' +\n          ' variable selected.',\n      );\n    }\n    const name = this.getText();\n    let variableModelList: VariableModel[] = [];\n    if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n      const variableTypes = this.getVariableTypes();\n      // Get a copy of the list, so that adding rename and new variable options\n      // doesn't modify the workspace's list.\n      for (let i = 0; i < variableTypes.length; i++) {\n        const variableType = variableTypes[i];\n        const variables =\n          this.sourceBlock_.workspace.getVariablesOfType(variableType);\n        variableModelList = variableModelList.concat(variables);\n      }\n    }\n    variableModelList.sort(VariableModel.compareByName);\n\n    const options: [string, string][] = [];\n    for (let i = 0; i < variableModelList.length; i++) {\n      // Set the UUID as the internal representation of the variable.\n      options[i] = [variableModelList[i].name, variableModelList[i].getId()];\n    }\n    options.push([\n      Msg['RENAME_VARIABLE'],\n      internalConstants.RENAME_VARIABLE_ID,\n    ]);\n    if (Msg['DELETE_VARIABLE']) {\n      options.push([\n        Msg['DELETE_VARIABLE'].replace('%1', name),\n        internalConstants.DELETE_VARIABLE_ID,\n      ]);\n    }\n\n    return options;\n  }\n}\n\nfieldRegistry.register('field_variable', FieldVariable);\n\n/**\n * Config options for the variable field.\n */\nexport interface FieldVariableConfig extends FieldConfig {\n  variableTypes?: string[];\n  defaultType?: string;\n}\n\n/**\n * fromJson config options for the variable field.\n */\nexport interface FieldVariableFromJsonConfig extends FieldVariableConfig {\n  variable?: string;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldVariableValidator = FieldDropdownValidator;\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Number input field\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldNumber\n\nimport {Field} from './field.js';\nimport {\n  FieldInput,\n  FieldInputConfig,\n  FieldInputValidator,\n} from './field_input.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as aria from './utils/aria.js';\n\n/**\n * Class for an editable number field.\n */\nexport class FieldNumber extends FieldInput<number> {\n  /** The minimum value this number field can contain. */\n  protected min_ = -Infinity;\n\n  /** The maximum value this number field can contain. */\n  protected max_ = Infinity;\n\n  /** The multiple to which this fields value is rounded. */\n  protected precision_ = 0;\n\n  /**\n   * The number of decimal places to allow, or null to allow any number of\n   * decimal digits.\n   */\n  private decimalPlaces: number | null = null;\n\n  /** Don't spellcheck numbers.  Our validator does a better job. */\n  protected override spellcheck_ = false;\n\n  /**\n   * @param value The initial value of the field. Should cast to a number.\n   *     Defaults to 0. Also accepts Field.SKIP_SETUP if you wish to skip setup\n   *     (only used by subclasses that want to handle configuration and setting\n   *     the field value after their own constructors have run).\n   * @param min Minimum value. Will only be used if config is not\n   *     provided.\n   * @param max Maximum value. Will only be used if config is not\n   *     provided.\n   * @param precision Precision for value. Will only be used if config\n   *     is not provided.\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a number & returns a validated number, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/number#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: string | number | typeof Field.SKIP_SETUP,\n    min?: string | number | null,\n    max?: string | number | null,\n    precision?: string | number | null,\n    validator?: FieldNumberValidator | null,\n    config?: FieldNumberConfig,\n  ) {\n    // Pass SENTINEL so that we can define properties before value validation.\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.setConstraints(min, max, precision);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldNumberConfig) {\n    super.configure_(config);\n    this.setMinInternal(config.min);\n    this.setMaxInternal(config.max);\n    this.setPrecisionInternal(config.precision);\n  }\n\n  /**\n   * Set the maximum, minimum and precision constraints on this field.\n   * Any of these properties may be undefined or NaN to be disabled.\n   * Setting precision (usually a power of 10) enforces a minimum step between\n   * values. That is, the user's value will rounded to the closest multiple of\n   * precision. The least significant digit place is inferred from the\n   * precision. Integers values can be enforces by choosing an integer\n   * precision.\n   *\n   * @param min Minimum value.\n   * @param max Maximum value.\n   * @param precision Precision for value.\n   */\n  setConstraints(\n    min: number | string | undefined | null,\n    max: number | string | undefined | null,\n    precision: number | string | undefined | null,\n  ) {\n    this.setMinInternal(min);\n    this.setMaxInternal(max);\n    this.setPrecisionInternal(precision);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the minimum value this field can contain. Updates the value to\n   * reflect.\n   *\n   * @param min Minimum value.\n   */\n  setMin(min: number | string | undefined | null) {\n    this.setMinInternal(min);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the minimum value this field can contain. Called internally to avoid\n   * value updates.\n   *\n   * @param min Minimum value.\n   */\n  private setMinInternal(min: number | string | undefined | null) {\n    if (min == null) {\n      this.min_ = -Infinity;\n    } else {\n      min = Number(min);\n      if (!isNaN(min)) {\n        this.min_ = min;\n      }\n    }\n  }\n\n  /**\n   * Returns the current minimum value this field can contain. Default is\n   * -Infinity.\n   *\n   * @returns The current minimum value this field can contain.\n   */\n  getMin(): number {\n    return this.min_;\n  }\n\n  /**\n   * Sets the maximum value this field can contain. Updates the value to\n   * reflect.\n   *\n   * @param max Maximum value.\n   */\n  setMax(max: number | string | undefined | null) {\n    this.setMaxInternal(max);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the maximum value this field can contain. Called internally to avoid\n   * value updates.\n   *\n   * @param max Maximum value.\n   */\n  private setMaxInternal(max: number | string | undefined | null) {\n    if (max == null) {\n      this.max_ = Infinity;\n    } else {\n      max = Number(max);\n      if (!isNaN(max)) {\n        this.max_ = max;\n      }\n    }\n  }\n\n  /**\n   * Returns the current maximum value this field can contain. Default is\n   * Infinity.\n   *\n   * @returns The current maximum value this field can contain.\n   */\n  getMax(): number {\n    return this.max_;\n  }\n\n  /**\n   * Sets the precision of this field's value, i.e. the number to which the\n   * value is rounded. Updates the field to reflect.\n   *\n   * @param precision The number to which the field's value is rounded.\n   */\n  setPrecision(precision: number | string | undefined | null) {\n    this.setPrecisionInternal(precision);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the precision of this field's value. Called internally to avoid\n   * value updates.\n   *\n   * @param precision The number to which the field's value is rounded.\n   */\n  private setPrecisionInternal(precision: number | string | undefined | null) {\n    this.precision_ = Number(precision) || 0;\n    let precisionString = String(this.precision_);\n    if (precisionString.includes('e')) {\n      // String() is fast.  But it turns .0000001 into '1e-7'.\n      // Use the much slower toLocaleString to access all the digits.\n      precisionString = this.precision_.toLocaleString('en-US', {\n        maximumFractionDigits: 20,\n      });\n    }\n    const decimalIndex = precisionString.indexOf('.');\n    if (decimalIndex === -1) {\n      // If the precision is 0 (float) allow any number of decimals,\n      // otherwise allow none.\n      this.decimalPlaces = precision ? 0 : null;\n    } else {\n      this.decimalPlaces = precisionString.length - decimalIndex - 1;\n    }\n  }\n\n  /**\n   * Returns the current precision of this field. The precision being the\n   * number to which the field's value is rounded. A precision of 0 means that\n   * the value is not rounded.\n   *\n   * @returns The number to which this field's value is rounded.\n   */\n  getPrecision(): number {\n    return this.precision_;\n  }\n\n  /**\n   * Ensure that the input value is a valid number (must fulfill the\n   * constraints placed on the field).\n   *\n   * @param newValue The input value.\n   * @returns A valid number, or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): number | null {\n    if (newValue === null) {\n      return null;\n    }\n\n    // Clean up text.\n    newValue = `${newValue}`;\n    // TODO: Handle cases like 'ten', '1.203,14', etc.\n    // 'O' is sometimes mistaken for '0' by inexperienced users.\n    newValue = newValue.replace(/O/gi, '0');\n    // Strip out thousands separators.\n    newValue = newValue.replace(/,/g, '');\n    // Ignore case of 'Infinity'.\n    newValue = newValue.replace(/infinity/i, 'Infinity');\n\n    // Clean up number.\n    let n = Number(newValue || 0);\n    if (isNaN(n)) {\n      // Invalid number.\n      return null;\n    }\n    // Get the value in range.\n    n = Math.min(Math.max(n, this.min_), this.max_);\n    // Round to nearest multiple of precision.\n    if (this.precision_ && isFinite(n)) {\n      n = Math.round(n / this.precision_) * this.precision_;\n    }\n    // Clean up floating point errors.\n    if (this.decimalPlaces !== null) {\n      n = Number(n.toFixed(this.decimalPlaces));\n    }\n    return n;\n  }\n\n  /**\n   * Create the number input editor widget.\n   *\n   * @returns The newly created number input editor.\n   */\n  protected override widgetCreate_(): HTMLInputElement {\n    const htmlInput = super.widgetCreate_() as HTMLInputElement;\n\n    // Set the accessibility state\n    if (this.min_ > -Infinity) {\n      htmlInput.min = `${this.min_}`;\n      aria.setState(htmlInput, aria.State.VALUEMIN, this.min_);\n    }\n    if (this.max_ < Infinity) {\n      htmlInput.max = `${this.max_}`;\n      aria.setState(htmlInput, aria.State.VALUEMAX, this.max_);\n    }\n    return htmlInput;\n  }\n\n  /**\n   * Construct a FieldNumber from a JSON arg object.\n   *\n   * @param options A JSON object with options (value, min, max, and precision).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(options: FieldNumberFromJsonConfig): FieldNumber {\n    // `this` might be a subclass of FieldNumber if that class doesn't override\n    // the static fromJson method.\n    return new this(\n      options.value,\n      undefined,\n      undefined,\n      undefined,\n      undefined,\n      options,\n    );\n  }\n}\n\nfieldRegistry.register('field_number', FieldNumber);\n\nFieldNumber.prototype.DEFAULT_VALUE = 0;\n\n/**\n * Config options for the number field.\n */\nexport interface FieldNumberConfig extends FieldInputConfig {\n  min?: number;\n  max?: number;\n  precision?: number;\n}\n\n/**\n * fromJson config options for the number field.\n */\nexport interface FieldNumberFromJsonConfig extends FieldNumberConfig {\n  value?: number;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldNumberValidator = FieldInputValidator<number>;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Non-editable, serializable text field. Behaves like a\n *    normal label but is serialized to XML. It may only be\n *    edited programmatically.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldLabelSerializable\n\nimport {\n  FieldLabel,\n  FieldLabelConfig,\n  FieldLabelFromJsonConfig,\n} from './field_label.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for a non-editable, serializable text field.\n */\nexport class FieldLabelSerializable extends FieldLabel {\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override EDITABLE = false;\n\n  /**\n   * Serializable fields are saved by the XML renderer, non-serializable\n   * fields are not.  This field should be serialized, but only edited\n   * programmatically.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined.\n   * @param textClass Optional CSS class for the field's text.\n   * @param config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/label-serializable#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(value?: string, textClass?: string, config?: FieldLabelConfig) {\n    super(String(value ?? ''), textClass, config);\n  }\n\n  /**\n   * Construct a FieldLabelSerializable from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and class).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldLabelFromJsonConfig,\n  ): FieldLabelSerializable {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldLabelSerializable if that class\n    // doesn't override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_label_serializable', FieldLabelSerializable);\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Checkbox field.  Checked or not checked.\n *\n * @class\n */\n// Former goog.module ID: Blockly.FieldCheckbox\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport {Field, FieldConfig, FieldValidator} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as dom from './utils/dom.js';\n\ntype BoolString = 'TRUE' | 'FALSE';\ntype CheckboxBool = BoolString | boolean;\n\n/**\n * Class for a checkbox field.\n */\nexport class FieldCheckbox extends Field<CheckboxBool> {\n  /** Default character for the checkmark. */\n  static readonly CHECK_CHAR = '';\n  private checkChar: string;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * Mouse cursor style when over the hotspot that initiates editability.\n   */\n  override CURSOR = 'default';\n\n  /**\n   * NOTE: The default value is set in `Field`, so maintain that value instead\n   * of overwriting it here or in the constructor.\n   */\n  override value_: boolean | null = this.value_;\n\n  /**\n   * @param value The initial value of the field. Should either be 'TRUE',\n   *     'FALSE' or a boolean. Defaults to 'FALSE'. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator  A function that is called to validate changes to the\n   *     field's value. Takes in a value ('TRUE' or 'FALSE') & returns a\n   *     validated value ('TRUE' or 'FALSE'), or null to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/checkbox#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n    value?: CheckboxBool | typeof Field.SKIP_SETUP,\n    validator?: FieldCheckboxValidator,\n    config?: FieldCheckboxConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    /**\n     * Character for the check mark. Used to apply a different check mark\n     * character to individual fields.\n     */\n    this.checkChar = FieldCheckbox.CHECK_CHAR;\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldCheckboxConfig) {\n    super.configure_(config);\n    if (config.checkCharacter) this.checkChar = config.checkCharacter;\n  }\n\n  /**\n   * Saves this field's value.\n   *\n   * @returns The boolean value held by this field.\n   * @internal\n   */\n  override saveState(): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldCheckbox);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValueBoolean();\n  }\n\n  /**\n   * Create the block UI for this checkbox.\n   */\n  override initView() {\n    super.initView();\n\n    const textElement = this.getTextElement();\n    dom.addClass(textElement, 'blocklyCheckbox');\n    textElement.style.display = this.value_ ? 'block' : 'none';\n  }\n\n  override render_() {\n    if (this.textContent_) {\n      this.textContent_.nodeValue = this.getDisplayText_();\n    }\n    this.updateSize_(this.getConstants()!.FIELD_CHECKBOX_X_OFFSET);\n  }\n\n  override getDisplayText_() {\n    return this.checkChar;\n  }\n\n  /**\n   * Set the character used for the check mark.\n   *\n   * @param character The character to use for the check mark, or null to use\n   *     the default.\n   */\n  setCheckCharacter(character: string | null) {\n    this.checkChar = character || FieldCheckbox.CHECK_CHAR;\n    this.forceRerender();\n  }\n\n  /** Toggle the state of the checkbox on click. */\n  protected override showEditor_() {\n    this.setValue(!this.value_);\n  }\n\n  /**\n   * Ensure that the input value is valid ('TRUE' or 'FALSE').\n   *\n   * @param newValue The input value.\n   * @returns A valid value ('TRUE' or 'FALSE), or null if invalid.\n   */\n  protected override doClassValidation_(\n    newValue?: AnyDuringMigration,\n  ): BoolString | null {\n    if (newValue === true || newValue === 'TRUE') {\n      return 'TRUE';\n    }\n    if (newValue === false || newValue === 'FALSE') {\n      return 'FALSE';\n    }\n    return null;\n  }\n\n  /**\n   * Update the value of the field, and update the checkElement.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a either 'TRUE' or 'FALSE'.\n   */\n  protected override doValueUpdate_(newValue: BoolString) {\n    this.value_ = this.convertValueToBool(newValue);\n    // Update visual.\n    if (this.textElement_) {\n      this.textElement_.style.display = this.value_ ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Get the value of this field, either 'TRUE' or 'FALSE'.\n   *\n   * @returns The value of this field.\n   */\n  override getValue(): BoolString {\n    return this.value_ ? 'TRUE' : 'FALSE';\n  }\n\n  /**\n   * Get the boolean value of this field.\n   *\n   * @returns The boolean value of this field.\n   */\n  getValueBoolean(): boolean | null {\n    return this.value_;\n  }\n\n  /**\n   * Get the text of this field. Used when the block is collapsed.\n   *\n   * @returns Text representing the value of this field ('true' or 'false').\n   */\n  override getText(): string {\n    return String(this.convertValueToBool(this.value_));\n  }\n\n  /**\n   * Convert a value into a pure boolean.\n   *\n   * Converts 'TRUE' to true and 'FALSE' to false correctly, everything else\n   * is cast to a boolean.\n   *\n   * @param value The value to convert.\n   * @returns The converted value.\n   */\n  private convertValueToBool(value: CheckboxBool | null): boolean {\n    if (typeof value === 'string') return value === 'TRUE';\n    return !!value;\n  }\n\n  /**\n   * Construct a FieldCheckbox from a JSON arg object.\n   *\n   * @param options A JSON object with options (checked).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(\n    options: FieldCheckboxFromJsonConfig,\n  ): FieldCheckbox {\n    // `this` might be a subclass of FieldCheckbox if that class doesn't\n    // 'override' the static fromJson method.\n    return new this(options.checked, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_checkbox', FieldCheckbox);\n\nFieldCheckbox.prototype.DEFAULT_VALUE = false;\n\n/**\n * Config options for the checkbox field.\n */\nexport interface FieldCheckboxConfig extends FieldConfig {\n  checkCharacter?: string;\n}\n\n/**\n * fromJson config options for the checkbox field.\n */\nexport interface FieldCheckboxFromJsonConfig extends FieldCheckboxConfig {\n  checked?: boolean;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldCheckboxValidator = FieldValidator<CheckboxBool>;\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as blockAnimations from '../block_animations.js';\nimport {BlockSvg} from '../block_svg.js';\nimport {ComponentManager} from '../component_manager.js';\nimport * as eventUtils from '../events/utils.js';\nimport {IDeletable, isDeletable} from '../interfaces/i_deletable.js';\nimport {IDeleteArea} from '../interfaces/i_delete_area.js';\nimport {IDragTarget} from '../interfaces/i_drag_target.js';\nimport {IDraggable} from '../interfaces/i_draggable.js';\nimport {IDragger} from '../interfaces/i_dragger.js';\nimport * as registry from '../registry.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\nexport class Dragger implements IDragger {\n  protected startLoc: Coordinate;\n\n  protected dragTarget: IDragTarget | null = null;\n\n  constructor(\n    protected draggable: IDraggable,\n    protected workspace: WorkspaceSvg,\n  ) {\n    this.startLoc = draggable.getRelativeToSurfaceXY();\n  }\n\n  /** Handles any drag startup. */\n  onDragStart(e: PointerEvent) {\n    this.draggable.startDrag(e);\n  }\n\n  /**\n   * Handles calculating where the element should actually be moved to.\n   *\n   * @param totalDelta The total amount in pixel coordinates the mouse has moved\n   *     since the start of the drag.\n   */\n  onDrag(e: PointerEvent, totalDelta: Coordinate) {\n    this.moveDraggable(e, totalDelta);\n    const root = this.getRoot(this.draggable);\n\n    // Must check `wouldDelete` before calling other hooks on drag targets\n    // since we have documented that we would do so.\n    if (isDeletable(root)) {\n      root.setDeleteStyle(this.wouldDeleteDraggable(e, root));\n    }\n    this.updateDragTarget(e);\n  }\n\n  /** Updates the drag target under the pointer (if there is one). */\n  protected updateDragTarget(e: PointerEvent) {\n    const newDragTarget = this.workspace.getDragTarget(e);\n    const root = this.getRoot(this.draggable);\n    if (this.dragTarget !== newDragTarget) {\n      this.dragTarget?.onDragExit(root);\n      newDragTarget?.onDragEnter(root);\n    }\n    newDragTarget?.onDragOver(root);\n    this.dragTarget = newDragTarget;\n  }\n\n  /**\n   * Calculates the correct workspace coordinate for the movable and tells\n   * the draggable to go to that location.\n   */\n  private moveDraggable(e: PointerEvent, totalDelta: Coordinate) {\n    const delta = this.pixelsToWorkspaceUnits(totalDelta);\n    const newLoc = Coordinate.sum(this.startLoc, delta);\n    this.draggable.drag(newLoc, e);\n  }\n\n  /**\n   * Returns true if we would delete the draggable if it was dropped\n   * at the current location.\n   */\n  protected wouldDeleteDraggable(\n    e: PointerEvent,\n    rootDraggable: IDraggable & IDeletable,\n  ) {\n    const dragTarget = this.workspace.getDragTarget(e);\n    if (!dragTarget) return false;\n\n    const componentManager = this.workspace.getComponentManager();\n    const isDeleteArea = componentManager.hasCapability(\n      dragTarget.id,\n      ComponentManager.Capability.DELETE_AREA,\n    );\n    if (!isDeleteArea) return false;\n\n    return (dragTarget as IDeleteArea).wouldDelete(rootDraggable);\n  }\n\n  /** Handles any drag cleanup. */\n  onDragEnd(e: PointerEvent) {\n    const origGroup = eventUtils.getGroup();\n    const dragTarget = this.workspace.getDragTarget(e);\n    const root = this.getRoot(this.draggable);\n\n    if (dragTarget) {\n      this.dragTarget?.onDrop(root);\n    }\n\n    if (this.shouldReturnToStart(e, root)) {\n      this.draggable.revertDrag();\n    }\n\n    const wouldDelete = isDeletable(root) && this.wouldDeleteDraggable(e, root);\n\n    // TODO(#8148): use a generalized API instead of an instanceof check.\n    if (wouldDelete && this.draggable instanceof BlockSvg) {\n      blockAnimations.disposeUiEffect(this.draggable.getRootBlock());\n    }\n\n    this.draggable.endDrag(e);\n\n    if (wouldDelete && isDeletable(root)) {\n      // We want to make sure the delete gets grouped with any possible\n      // move event.\n      const newGroup = eventUtils.getGroup();\n      eventUtils.setGroup(origGroup);\n      root.dispose();\n      eventUtils.setGroup(newGroup);\n    }\n  }\n\n  // We need to special case blocks for now so that we look at the root block\n  // instead of the one actually being dragged in most cases.\n  private getRoot(draggable: IDraggable): IDraggable {\n    return draggable instanceof BlockSvg ? draggable.getRootBlock() : draggable;\n  }\n\n  /**\n   * Returns true if we should return the draggable to its original location\n   * at the end of the drag.\n   */\n  protected shouldReturnToStart(e: PointerEvent, rootDraggable: IDraggable) {\n    const dragTarget = this.workspace.getDragTarget(e);\n    if (!dragTarget) return false;\n    return dragTarget.shouldPreventMove(rootDraggable);\n  }\n\n  protected pixelsToWorkspaceUnits(pixelCoord: Coordinate): Coordinate {\n    const result = new Coordinate(\n      pixelCoord.x / this.workspace.scale,\n      pixelCoord.y / this.workspace.scale,\n    );\n    if (this.workspace.isMutator) {\n      // If we're in a mutator, its scale is always 1, purely because of some\n      // oddities in our rendering optimizations.  The actual scale is the same\n      // as the scale on the parent workspace. Fix that for dragging.\n      const mainScale = this.workspace.options.parentWorkspace!.scale;\n      result.scale(1 / mainScale);\n    }\n    return result;\n  }\n}\n\nregistry.register(registry.Type.BLOCK_DRAGGER, registry.DEFAULT, Dragger);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {BlockDragStrategy} from './dragging/block_drag_strategy.js';\nimport {BubbleDragStrategy} from './dragging/bubble_drag_strategy.js';\nimport {CommentDragStrategy} from './dragging/comment_drag_strategy.js';\nimport {Dragger} from './dragging/dragger.js';\n\nexport {BlockDragStrategy, BubbleDragStrategy, CommentDragStrategy, Dragger};\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a block drag.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockDrag\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners when a block is being manually dragged/dropped.\n */\nexport class BlockDrag extends UiBase {\n  /** The ID of the top-level block being dragged. */\n  blockId?: string;\n\n  /** True if this is the start of a drag, false if this is the end of one. */\n  isStart?: boolean;\n\n  /**\n   * A list of all of the blocks (i.e. all descendants of the block associated\n   * with the block ID) being dragged.\n   */\n  blocks?: Block[];\n\n  override type = EventType.BLOCK_DRAG;\n\n  /**\n   * @param opt_block The top block in the stack that is being dragged.\n   *     Undefined for a blank event.\n   * @param opt_isStart Whether this is the start of a block drag.\n   *    Undefined for a blank event.\n   * @param opt_blocks The blocks affected by this drag. Undefined for a blank\n   *     event.\n   */\n  constructor(opt_block?: Block, opt_isStart?: boolean, opt_blocks?: Block[]) {\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    super(workspaceId);\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n    this.isStart = opt_isStart;\n    this.blocks = opt_blocks;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockDragJson {\n    const json = super.toJson() as BlockDragJson;\n    if (this.isStart === undefined) {\n      throw new Error(\n        'Whether this event is the start of a drag is undefined. ' +\n          'Either pass the value to the constructor, or call fromJson',\n      );\n    }\n    if (this.blockId === undefined) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['isStart'] = this.isStart;\n    json['blockId'] = this.blockId;\n    // TODO: I don't think we should actually apply the blocks array to the JSON\n    //   object b/c they have functions and aren't actually serializable.\n    json['blocks'] = this.blocks;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockDrag, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses..\n   * @internal\n   */\n  static fromJson(\n    json: BlockDragJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockDrag {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockDrag(),\n    ) as BlockDrag;\n    newEvent.isStart = json['isStart'];\n    newEvent.blockId = json['blockId'];\n    newEvent.blocks = json['blocks'];\n    return newEvent;\n  }\n}\n\nexport interface BlockDragJson extends AbstractEventJson {\n  isStart: boolean;\n  blockId: string;\n  blocks?: Block[];\n}\n\nregistry.register(registry.Type.EVENT, EventType.BLOCK_DRAG, BlockDrag);\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for an event representing an intermediate change to a block's field's\n * value.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockFieldIntermediateChange\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport {Workspace} from '../workspace.js';\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners when the value of a block's field has changed but the\n * change is not yet complete, and is expected to be followed by a block change\n * event.\n */\nexport class BlockFieldIntermediateChange extends BlockBase {\n  override type = EventType.BLOCK_FIELD_INTERMEDIATE_CHANGE;\n\n  // Intermediate events do not undo or redo. They may be fired frequently while\n  // the field editor widget is open. A separate BLOCK_CHANGE event is fired\n  // when the editor is closed, which combines all of the field value changes\n  // into a single change that is recorded in the undo history instead. The\n  // intermediate changes are important for reacting to immediate changes, but\n  // some event handlers would prefer to handle the less frequent final events,\n  // like when triggering workspace serialization. Technically, this method of\n  // grouping changes can result in undo perfoming actions out of order if some\n  // other event occurs between opening and closing the field editor, but such\n  // events are unlikely to cause a broken state.\n  override recordUndo = false;\n\n  /** The name of the field that changed. */\n  name?: string;\n\n  /** The original value of the element. */\n  oldValue: unknown;\n\n  /** The new value of the element. */\n  newValue: unknown;\n\n  /**\n   * @param opt_block The changed block. Undefined for a blank event.\n   * @param opt_name Name of the field affected.\n   * @param opt_oldValue Previous value of element.\n   * @param opt_newValue New value of element.\n   */\n  constructor(\n    opt_block?: Block,\n    opt_name?: string,\n    opt_oldValue?: unknown,\n    opt_newValue?: unknown,\n  ) {\n    super(opt_block);\n    if (!opt_block) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.name = opt_name;\n    this.oldValue = opt_oldValue;\n    this.newValue = opt_newValue;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockFieldIntermediateChangeJson {\n    const json = super.toJson() as BlockFieldIntermediateChangeJson;\n    if (!this.name) {\n      throw new Error(\n        'The changed field name is undefined. Either pass a ' +\n          'name to the constructor, or call fromJson.',\n      );\n    }\n    json['name'] = this.name;\n    json['oldValue'] = this.oldValue;\n    json['newValue'] = this.newValue;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockFieldIntermediateChange, but we can't specify that due to the\n   *     fact that parameters to static methods in subclasses must be supertypes\n   *     of parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockFieldIntermediateChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockFieldIntermediateChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockFieldIntermediateChange(),\n    ) as BlockFieldIntermediateChange;\n    newEvent.name = json['name'];\n    newEvent.oldValue = json['oldValue'];\n    newEvent.newValue = json['newValue'];\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldValue === this.newValue;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n        'The associated block is undefined. Either pass a ' +\n          'block to the constructor, or call fromJson',\n      );\n    }\n\n    const value = forward ? this.newValue : this.oldValue;\n    const field = block.getField(this.name!);\n    if (field) {\n      field.setValue(value);\n    } else {\n      console.warn(\"Can't set non-existent field: \" + this.name);\n    }\n  }\n}\n\nexport interface BlockFieldIntermediateChangeJson extends BlockBaseJson {\n  name: string;\n  newValue: unknown;\n  oldValue: unknown;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  EventType.BLOCK_FIELD_INTERMEDIATE_CHANGE,\n  BlockFieldIntermediateChange,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block move event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.BlockMove\n\nimport type {Block} from '../block.js';\nimport {ConnectionType} from '../connection_type.js';\nimport * as registry from '../registry.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport type {Workspace} from '../workspace.js';\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport {EventType} from './type.js';\n\ninterface BlockLocation {\n  parentId?: string;\n  inputName?: string;\n  coordinate?: Coordinate;\n}\n\n/**\n * Notifies listeners when a block is moved. This could be from one\n * connection to another, or from one location on the workspace to another.\n */\nexport class BlockMove extends BlockBase {\n  override type = EventType.BLOCK_MOVE;\n\n  /** The ID of the old parent block. Undefined if it was a top-level block. */\n  oldParentId?: string;\n\n  /**\n   * The name of the old input. Undefined if it was a top-level block or the\n   * parent's next block.\n   */\n  oldInputName?: string;\n\n  /**\n   * The old X and Y workspace coordinates of the block if it was a top level\n   * block. Undefined if it was not a top level block.\n   */\n  oldCoordinate?: Coordinate;\n\n  /** The ID of the new parent block. Undefined if it is a top-level block. */\n  newParentId?: string;\n\n  /**\n   * The name of the new input. Undefined if it is a top-level block or the\n   * parent's next block.\n   */\n  newInputName?: string;\n\n  /**\n   * The new X and Y workspace coordinates of the block if it is a top-level\n   * block. Undefined if it is not a top level block.\n   */\n  newCoordinate?: Coordinate;\n\n  /**\n   * An explanation of what this move is for.  Known values include:\n   *  'drag' -- A drag operation completed.\n   *  'bump' -- Block got bumped away from an invalid connection.\n   *  'snap' -- Block got shifted to line up with the grid.\n   *  'inbounds' -- Block got pushed back into a non-scrolling workspace.\n   *  'connect' -- Block got connected to another block.\n   *  'disconnect' -- Block got disconnected from another block.\n   *  'create' -- Block created via XML.\n   *  'cleanup' -- Workspace aligned top-level blocks.\n   * Event merging may create multiple reasons: ['drag', 'bump', 'snap'].\n   */\n  reason?: string[];\n\n  /** @param opt_block The moved block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return;\n    }\n    // Blank event to be populated by fromJson.\n    if (opt_block.isShadow()) {\n      // Moving shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    const location = this.currentLocation();\n    this.oldParentId = location.parentId;\n    this.oldInputName = location.inputName;\n    this.oldCoordinate = location.coordinate;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockMoveJson {\n    const json = super.toJson() as BlockMoveJson;\n    json['oldParentId'] = this.oldParentId;\n    json['oldInputName'] = this.oldInputName;\n    if (this.oldCoordinate) {\n      json['oldCoordinate'] =\n        `${Math.round(this.oldCoordinate.x)}, ` +\n        `${Math.round(this.oldCoordinate.y)}`;\n    }\n    json['newParentId'] = this.newParentId;\n    json['newInputName'] = this.newInputName;\n    if (this.newCoordinate) {\n      json['newCoordinate'] =\n        `${Math.round(this.newCoordinate.x)}, ` +\n        `${Math.round(this.newCoordinate.y)}`;\n    }\n    if (this.reason) {\n      json['reason'] = this.reason;\n    }\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockMove, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BlockMoveJson,\n    workspace: Workspace,\n    event?: any,\n  ): BlockMove {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BlockMove(),\n    ) as BlockMove;\n    newEvent.oldParentId = json['oldParentId'];\n    newEvent.oldInputName = json['oldInputName'];\n    if (json['oldCoordinate']) {\n      const xy = json['oldCoordinate'].split(',');\n      newEvent.oldCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    newEvent.newParentId = json['newParentId'];\n    newEvent.newInputName = json['newInputName'];\n    if (json['newCoordinate']) {\n      const xy = json['newCoordinate'].split(',');\n      newEvent.newCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    if (json['reason'] !== undefined) {\n      newEvent.reason = json['reason'];\n    }\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /** Record the block's new location.  Called after the move. */\n  recordNew() {\n    const location = this.currentLocation();\n    this.newParentId = location.parentId;\n    this.newInputName = location.inputName;\n    this.newCoordinate = location.coordinate;\n  }\n\n  /**\n   * Set the reason for a move event.\n   *\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  setReason(reason: string[]) {\n    this.reason = reason;\n  }\n\n  /**\n   * Returns the parentId and input if the block is connected,\n   *   or the XY location if disconnected.\n   *\n   * @returns Collection of location info.\n   */\n  private currentLocation(): BlockLocation {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n        'The block associated with the block move event ' +\n          'could not be found',\n      );\n    }\n    const location = {} as BlockLocation;\n    const parent = block.getParent();\n    if (parent) {\n      location.parentId = parent.id;\n      const input = parent.getInputWithBlock(block);\n      if (input) {\n        location.inputName = input.name;\n      }\n    } else {\n      location.coordinate = block.getRelativeToSurfaceXY();\n    }\n    return location;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return (\n      this.oldParentId === this.newParentId &&\n      this.oldInputName === this.newInputName &&\n      Coordinate.equals(this.oldCoordinate, this.newCoordinate)\n    );\n  }\n\n  /**\n   * Run a move event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n        'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      console.warn(\"Can't move non-existent block: \" + this.blockId);\n      return;\n    }\n    const parentId = forward ? this.newParentId : this.oldParentId;\n    const inputName = forward ? this.newInputName : this.oldInputName;\n    const coordinate = forward ? this.newCoordinate : this.oldCoordinate;\n    let parentBlock: Block | null;\n    if (parentId) {\n      parentBlock = workspace.getBlockById(parentId);\n      if (!parentBlock) {\n        console.warn(\"Can't connect to non-existent block: \" + parentId);\n        return;\n      }\n    }\n    if (block.getParent()) {\n      block.unplug();\n    }\n    if (coordinate) {\n      const xy = block.getRelativeToSurfaceXY();\n      block.moveBy(coordinate.x - xy.x, coordinate.y - xy.y, this.reason);\n    } else {\n      let blockConnection = block.outputConnection;\n      if (\n        !blockConnection ||\n        (block.previousConnection && block.previousConnection.isConnected())\n      ) {\n        blockConnection = block.previousConnection;\n      }\n      let parentConnection;\n      const connectionType = blockConnection?.type;\n      if (inputName) {\n        const input = parentBlock!.getInput(inputName);\n        if (input) {\n          parentConnection = input.connection;\n        }\n      } else if (connectionType === ConnectionType.PREVIOUS_STATEMENT) {\n        parentConnection = parentBlock!.nextConnection;\n      }\n      if (parentConnection && blockConnection) {\n        blockConnection.connect(parentConnection);\n      } else {\n        console.warn(\"Can't connect to non-existent input: \" + inputName);\n      }\n    }\n  }\n}\n\nexport interface BlockMoveJson extends BlockBaseJson {\n  oldParentId?: string;\n  oldInputName?: string;\n  oldCoordinate?: string;\n  newParentId?: string;\n  newInputName?: string;\n  newCoordinate?: string;\n  reason?: string[];\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, EventType.BLOCK_MOVE, BlockMove);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of bubble open.\n *\n * @class\n */\n\n// Former goog.module ID: Blockly.Events.BubbleOpen\n\nimport type {BlockSvg} from '../block_svg.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport type {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Class for a bubble open event.\n */\nexport class BubbleOpen extends UiBase {\n  /** The ID of the block the bubble is attached to. */\n  blockId?: string;\n\n  /** True if the bubble is opening, false if closing. */\n  isOpen?: boolean;\n\n  /** The type of bubble; one of 'mutator', 'comment', or 'warning'. */\n  bubbleType?: BubbleType;\n\n  override type = EventType.BUBBLE_OPEN;\n\n  /**\n   * @param opt_block The associated block. Undefined for a blank event.\n   * @param opt_isOpen Whether the bubble is opening (false if closing).\n   *     Undefined for a blank event.\n   * @param opt_bubbleType The type of bubble. One of 'mutator', 'comment' or\n   *     'warning'. Undefined for a blank event.\n   */\n  constructor(\n    opt_block?: BlockSvg,\n    opt_isOpen?: boolean,\n    opt_bubbleType?: BubbleType,\n  ) {\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    super(workspaceId);\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n    this.isOpen = opt_isOpen;\n    this.bubbleType = opt_bubbleType;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BubbleOpenJson {\n    const json = super.toJson() as BubbleOpenJson;\n    if (this.isOpen === undefined) {\n      throw new Error(\n        'Whether this event is for opening the bubble is undefined. ' +\n          'Either pass the value to the constructor, or call fromJson',\n      );\n    }\n    if (!this.bubbleType) {\n      throw new Error(\n        'The type of bubble is undefined. Either pass the ' +\n          'value to the constructor, or call fromJson',\n      );\n    }\n    json['isOpen'] = this.isOpen;\n    json['bubbleType'] = this.bubbleType;\n    json['blockId'] = this.blockId || '';\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BubbleOpen, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: BubbleOpenJson,\n    workspace: Workspace,\n    event?: any,\n  ): BubbleOpen {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new BubbleOpen(),\n    ) as BubbleOpen;\n    newEvent.isOpen = json['isOpen'];\n    newEvent.bubbleType = json['bubbleType'];\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport enum BubbleType {\n  MUTATOR = 'mutator',\n  COMMENT = 'comment',\n  WARNING = 'warning',\n}\n\nexport interface BubbleOpenJson extends AbstractEventJson {\n  isOpen: boolean;\n  bubbleType: BubbleType;\n  blockId: string;\n}\n\nregistry.register(registry.Type.EVENT, EventType.BUBBLE_OPEN, BubbleOpen);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for comment events.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentBase\n\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as comments from '../serialization/workspace_comments.js';\nimport type {Workspace} from '../workspace.js';\nimport {\n  Abstract as AbstractEvent,\n  AbstractEventJson,\n} from './events_abstract.js';\nimport type {CommentCreate} from './events_comment_create.js';\nimport type {CommentDelete} from './events_comment_delete.js';\nimport {getGroup, getRecordUndo} from './utils.js';\n\n/**\n * Abstract class for a comment event.\n */\nexport class CommentBase extends AbstractEvent {\n  override isBlank = true;\n\n  /** The ID of the comment that this event references. */\n  commentId?: string;\n\n  /**\n   * @param opt_comment The comment this event corresponds to.  Undefined for a\n   *     blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super();\n    /** Whether or not an event is blank. */\n    this.isBlank = !opt_comment;\n\n    if (!opt_comment) return;\n\n    this.commentId = opt_comment.id;\n    this.workspaceId = opt_comment.workspace.id;\n    this.group = getGroup();\n    this.recordUndo = getRecordUndo();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentBaseJson {\n    const json = super.toJson() as CommentBaseJson;\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['commentId'] = this.commentId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentBase, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentBaseJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentBase {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentBase(),\n    ) as CommentBase;\n    newEvent.commentId = json['commentId'];\n    return newEvent;\n  }\n\n  /**\n   * Helper function for Comment[Create|Delete]\n   *\n   * @param event The event to run.\n   * @param create if True then Create, if False then Delete\n   */\n  static CommentCreateDeleteHelper(\n    event: CommentCreate | CommentDelete,\n    create: boolean,\n  ) {\n    const workspace = event.getEventWorkspace_();\n    if (create) {\n      if (!event.json) {\n        throw new Error('Encountered a comment event without proper json');\n      }\n      comments.append(event.json, workspace);\n    } else {\n      if (!event.commentId) {\n        throw new Error(\n          'The comment ID is undefined. Either pass a comment to ' +\n            'the constructor, or call fromJson',\n        );\n      }\n      const comment = workspace.getCommentById(event.commentId);\n      if (comment) {\n        comment.dispose();\n      } else {\n        console.warn(\"Can't delete non-existent comment: \" + event.commentId);\n      }\n    }\n  }\n}\n\nexport interface CommentBaseJson extends AbstractEventJson {\n  commentId: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment change event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentChange\n\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that the contents of a workspace comment has changed.\n */\nexport class CommentChange extends CommentBase {\n  override type = EventType.COMMENT_CHANGE;\n\n  // TODO(#6774): We should remove underscores.\n  /** The previous contents of the comment. */\n  oldContents_?: string;\n\n  /** The new contents of the comment. */\n  newContents_?: string;\n\n  /**\n   * @param opt_comment The comment that is being changed.  Undefined for a\n   *     blank event.\n   * @param opt_oldContents Previous contents of the comment.\n   * @param opt_newContents New contents of the comment.\n   */\n  constructor(\n    opt_comment?: WorkspaceComment,\n    opt_oldContents?: string,\n    opt_newContents?: string,\n  ) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.oldContents_ =\n      typeof opt_oldContents === 'undefined' ? '' : opt_oldContents;\n    this.newContents_ =\n      typeof opt_newContents === 'undefined' ? '' : opt_newContents;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentChangeJson {\n    const json = super.toJson() as CommentChangeJson;\n    if (!this.oldContents_) {\n      throw new Error(\n        'The old contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newContents_) {\n      throw new Error(\n        'The new contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['oldContents'] = this.oldContents_;\n    json['newContents'] = this.newContents_;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentChangeJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentChange {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentChange(),\n    ) as CommentChange;\n    newEvent.oldContents_ = json['oldContents'];\n    newEvent.newContents_ = json['newContents'];\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldContents_ === this.newContents_;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    // TODO: Remove the cast when we fix the type of getCommentById.\n    const comment = workspace.getCommentById(\n      this.commentId,\n    ) as unknown as WorkspaceComment;\n    if (!comment) {\n      console.warn(\"Can't change non-existent comment: \" + this.commentId);\n      return;\n    }\n    const contents = forward ? this.newContents_ : this.oldContents_;\n    if (contents === undefined) {\n      if (forward) {\n        throw new Error(\n          'The new contents is undefined. Either pass a value to ' +\n            'the constructor, or call fromJson',\n        );\n      }\n      throw new Error(\n        'The old contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    comment.setText(contents);\n  }\n}\n\nexport interface CommentChangeJson extends CommentBaseJson {\n  oldContents: string;\n  newContents: string;\n}\n\nregistry.register(registry.Type.EVENT, EventType.COMMENT_CHANGE, CommentChange);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport {EventType} from './type.js';\n\nexport class CommentCollapse extends CommentBase {\n  override type = EventType.COMMENT_COLLAPSE;\n\n  constructor(\n    comment?: WorkspaceComment,\n    public newCollapsed?: boolean,\n  ) {\n    super(comment);\n\n    if (!comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentCollapseJson {\n    const json = super.toJson() as CommentCollapseJson;\n    if (this.newCollapsed === undefined) {\n      throw new Error(\n        'The new collapse value undefined. Either call recordNew, or ' +\n          'call fromJson',\n      );\n    }\n    json['newCollapsed'] = this.newCollapsed;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentCollapse, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentCollapseJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentCollapse {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentCollapse(),\n    ) as CommentCollapse;\n    newEvent.newCollapsed = json.newCollapsed;\n    return newEvent;\n  }\n\n  /**\n   * Run a collapse event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    // TODO: Remove cast when we update getCommentById.\n    const comment = workspace.getCommentById(\n      this.commentId,\n    ) as unknown as WorkspaceComment;\n    if (!comment) {\n      console.warn(\n        \"Can't collapse or uncollapse non-existent comment: \" + this.commentId,\n      );\n      return;\n    }\n\n    comment.setCollapsed(forward ? !!this.newCollapsed : !this.newCollapsed);\n  }\n}\n\nexport interface CommentCollapseJson extends CommentBaseJson {\n  newCollapsed: boolean;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  EventType.COMMENT_COLLAPSE,\n  CommentCollapse,\n);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment creation event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentCreate\n\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as registry from '../registry.js';\nimport * as comments from '../serialization/workspace_comments.js';\nimport * as utilsXml from '../utils/xml.js';\nimport type {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that a workspace comment was created.\n */\nexport class CommentCreate extends CommentBase {\n  override type = EventType.COMMENT_CREATE;\n\n  /** The XML representation of the created workspace comment. */\n  xml?: Element | DocumentFragment;\n\n  /** The JSON representation of the created workspace comment. */\n  json?: comments.State;\n\n  /**\n   * @param opt_comment The created comment.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.xml = Xml.saveWorkspaceComment(opt_comment);\n    this.json = comments.save(opt_comment, {addCoordinates: true});\n  }\n\n  // TODO (#1266): \"Full\" and \"minimal\" serialization.\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentCreateJson {\n    const json = super.toJson() as CommentCreateJson;\n    if (!this.xml) {\n      throw new Error(\n        'The comment XML is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.json) {\n      throw new Error(\n        'The comment JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    json['json'] = this.json;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentCreate, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentCreateJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentCreate {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentCreate(),\n    ) as CommentCreate;\n    newEvent.xml = utilsXml.textToDom(json['xml']);\n    newEvent.json = json['json'];\n    return newEvent;\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    CommentBase.CommentCreateDeleteHelper(this, forward);\n  }\n}\n\nexport interface CommentCreateJson extends CommentBaseJson {\n  xml: string;\n  json: object;\n}\n\nregistry.register(registry.Type.EVENT, EventType.COMMENT_CREATE, CommentCreate);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment deletion event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentDelete\n\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as registry from '../registry.js';\nimport * as comments from '../serialization/workspace_comments.js';\nimport * as utilsXml from '../utils/xml.js';\nimport type {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that a workspace comment has been deleted.\n */\nexport class CommentDelete extends CommentBase {\n  override type = EventType.COMMENT_DELETE;\n\n  /** The XML representation of the deleted workspace comment. */\n  xml?: Element;\n\n  /** The JSON representation of the created workspace comment. */\n  json?: comments.State;\n\n  /**\n   * @param opt_comment The deleted comment.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.xml = Xml.saveWorkspaceComment(opt_comment);\n    this.json = comments.save(opt_comment, {addCoordinates: true});\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    CommentBase.CommentCreateDeleteHelper(this, !forward);\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentDeleteJson {\n    const json = super.toJson() as CommentDeleteJson;\n    if (!this.xml) {\n      throw new Error(\n        'The comment XML is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.json) {\n      throw new Error(\n        'The comment JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    json['json'] = this.json;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentDelete, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentDeleteJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentDelete {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentDelete(),\n    ) as CommentDelete;\n    newEvent.xml = utilsXml.textToDom(json['xml']);\n    newEvent.json = json['json'];\n    return newEvent;\n  }\n}\n\nexport interface CommentDeleteJson extends CommentBaseJson {\n  xml: string;\n  json: object;\n}\n\nregistry.register(registry.Type.EVENT, EventType.COMMENT_DELETE, CommentDelete);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired when a workspace comment is dragged.\n */\n\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as registry from '../registry.js';\nimport {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners when a comment is being manually dragged/dropped.\n */\nexport class CommentDrag extends UiBase {\n  /** The ID of the top-level comment being dragged. */\n  commentId?: string;\n\n  /** True if this is the start of a drag, false if this is the end of one. */\n  isStart?: boolean;\n\n  override type = EventType.COMMENT_DRAG;\n\n  /**\n   * @param opt_comment The comment that is being dragged.\n   *     Undefined for a blank event.\n   * @param opt_isStart Whether this is the start of a comment drag.\n   *    Undefined for a blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment, opt_isStart?: boolean) {\n    const workspaceId = opt_comment ? opt_comment.workspace.id : undefined;\n    super(workspaceId);\n    if (!opt_comment) return;\n\n    this.commentId = opt_comment.id;\n    this.isStart = opt_isStart;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentDragJson {\n    const json = super.toJson() as CommentDragJson;\n    if (this.isStart === undefined) {\n      throw new Error(\n        'Whether this event is the start of a drag is undefined. ' +\n          'Either pass the value to the constructor, or call fromJson',\n      );\n    }\n    if (this.commentId === undefined) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    json['isStart'] = this.isStart;\n    json['commentId'] = this.commentId;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentDrag, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentDragJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentDrag {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentDrag(),\n    ) as CommentDrag;\n    newEvent.isStart = json['isStart'];\n    newEvent.commentId = json['commentId'];\n    return newEvent;\n  }\n}\n\nexport interface CommentDragJson extends AbstractEventJson {\n  isStart: boolean;\n  commentId: string;\n}\n\nregistry.register(registry.Type.EVENT, EventType.COMMENT_DRAG, CommentDrag);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment move event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.CommentMove\n\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as registry from '../registry.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport type {Workspace} from '../workspace.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that a workspace comment has moved.\n */\nexport class CommentMove extends CommentBase {\n  override type = EventType.COMMENT_MOVE;\n\n  /** The comment that is being moved. */\n  comment_?: WorkspaceComment;\n\n  // TODO(#6774): We should remove underscores.\n  /** The location of the comment before the move, in workspace coordinates. */\n  oldCoordinate_?: Coordinate;\n\n  /** The location of the comment after the move, in workspace coordinates. */\n  newCoordinate_?: Coordinate;\n\n  /**\n   * An explanation of what this move is for.  Known values include:\n   *  'drag' -- A drag operation completed.\n   *  'snap' -- Comment got shifted to line up with the grid.\n   *  'inbounds' -- Block got pushed back into a non-scrolling workspace.\n   *  'create' -- Block created via deserialization.\n   *  'cleanup' -- Workspace aligned top-level blocks.\n   * Event merging may create multiple reasons: ['drag', 'inbounds', 'snap'].\n   */\n  reason?: string[];\n\n  /**\n   * @param opt_comment The comment that is being moved.  Undefined for a blank\n   *     event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.comment_ = opt_comment;\n    this.oldCoordinate_ = opt_comment.getRelativeToSurfaceXY();\n  }\n\n  /**\n   * Record the comment's new location.  Called after the move.  Can only be\n   * called once.\n   */\n  recordNew() {\n    if (this.newCoordinate_) {\n      throw Error(\n        'Tried to record the new position of a comment on the ' +\n          'same event twice.',\n      );\n    }\n    if (!this.comment_) {\n      throw new Error(\n        'The comment is undefined. Pass a comment to ' +\n          'the constructor if you want to use the record functionality',\n      );\n    }\n    this.newCoordinate_ = this.comment_.getRelativeToSurfaceXY();\n  }\n\n  /**\n   * Sets the reason for a move event.\n   *\n   * @param reason Why is this move happening?  'drag', 'bump', 'snap', ...\n   */\n  setReason(reason: string[]) {\n    this.reason = reason;\n  }\n\n  /**\n   * Override the location before the move.  Use this if you don't create the\n   * event until the end of the move, but you know the original location.\n   *\n   * @param xy The location before the move, in workspace coordinates.\n   */\n  setOldCoordinate(xy: Coordinate) {\n    this.oldCoordinate_ = xy;\n  }\n\n  // TODO (#1266): \"Full\" and \"minimal\" serialization.\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentMoveJson {\n    const json = super.toJson() as CommentMoveJson;\n    if (!this.oldCoordinate_) {\n      throw new Error(\n        'The old comment position is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newCoordinate_) {\n      throw new Error(\n        'The new comment position is undefined. Either call recordNew, or ' +\n          'call fromJson',\n      );\n    }\n    json['oldCoordinate'] =\n      `${Math.round(this.oldCoordinate_.x)}, ` +\n      `${Math.round(this.oldCoordinate_.y)}`;\n    json['newCoordinate'] =\n      Math.round(this.newCoordinate_.x) +\n      ',' +\n      Math.round(this.newCoordinate_.y);\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentMove, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentMoveJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentMove {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentMove(),\n    ) as CommentMove;\n    let xy = json['oldCoordinate'].split(',');\n    newEvent.oldCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n    xy = json['newCoordinate'].split(',');\n    newEvent.newCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return Coordinate.equals(this.oldCoordinate_, this.newCoordinate_);\n  }\n\n  /**\n   * Run a move event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    // TODO: Remove cast when we update getCommentById.\n    const comment = workspace.getCommentById(\n      this.commentId,\n    ) as unknown as WorkspaceComment;\n    if (!comment) {\n      console.warn(\"Can't move non-existent comment: \" + this.commentId);\n      return;\n    }\n\n    const target = forward ? this.newCoordinate_ : this.oldCoordinate_;\n    if (!target) {\n      throw new Error(\n        'Either oldCoordinate_ or newCoordinate_ is undefined. ' +\n          'Either pass a comment to the constructor and call recordNew, ' +\n          'or call fromJson',\n      );\n    }\n    comment.moveTo(target);\n  }\n}\n\nexport interface CommentMoveJson extends CommentBaseJson {\n  oldCoordinate: string;\n  newCoordinate: string;\n}\n\nregistry.register(registry.Type.EVENT, EventType.COMMENT_MOVE, CommentMove);\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment resize event.\n */\n\nimport type {WorkspaceComment} from '../comments/workspace_comment.js';\nimport * as registry from '../registry.js';\nimport {Size} from '../utils/size.js';\nimport type {Workspace} from '../workspace.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that a workspace comment has resized.\n */\nexport class CommentResize extends CommentBase {\n  override type = EventType.COMMENT_RESIZE;\n\n  /** The size of the comment before the resize. */\n  oldSize?: Size;\n\n  /** The size of the comment after the resize. */\n  newSize?: Size;\n\n  /**\n   * @param opt_comment The comment that is being resized. Undefined for a blank\n   *     event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return; // Blank event to be populated by fromJson.\n    }\n\n    this.oldSize = opt_comment.getSize();\n  }\n\n  /**\n   * Record the comment's new size. Called after the resize. Can only be\n   * called once.\n   */\n  recordCurrentSizeAsNewSize() {\n    if (this.newSize) {\n      throw Error(\n        'Tried to record the new size of a comment on the ' +\n          'same event twice.',\n      );\n    }\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const comment = workspace.getCommentById(this.commentId);\n    if (!comment) {\n      throw new Error(\n        'The comment associated with the comment resize event ' +\n          'could not be found',\n      );\n    }\n    this.newSize = comment.getSize();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentResizeJson {\n    const json = super.toJson() as CommentResizeJson;\n    if (!this.oldSize) {\n      throw new Error(\n        'The old comment size is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    if (!this.newSize) {\n      throw new Error(\n        'The new comment size is undefined. Either call ' +\n          'recordCurrentSizeAsNewSize, or call fromJson',\n      );\n    }\n    json['oldWidth'] = Math.round(this.oldSize.width);\n    json['oldHeight'] = Math.round(this.oldSize.height);\n    json['newWidth'] = Math.round(this.newSize.width);\n    json['newHeight'] = Math.round(this.newSize.height);\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentResize, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: CommentResizeJson,\n    workspace: Workspace,\n    event?: any,\n  ): CommentResize {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new CommentResize(),\n    ) as CommentResize;\n    newEvent.oldSize = new Size(json['oldWidth'], json['oldHeight']);\n    newEvent.newSize = new Size(json['newWidth'], json['newHeight']);\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return Size.equals(this.oldSize, this.newSize);\n  }\n\n  /**\n   * Run a resize event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n        'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson',\n      );\n    }\n    const comment = workspace.getCommentById(this.commentId);\n    if (!comment) {\n      console.warn(\"Can't resize non-existent comment: \" + this.commentId);\n      return;\n    }\n\n    const size = forward ? this.newSize : this.oldSize;\n    if (!size) {\n      throw new Error(\n        'Either oldSize or newSize is undefined. ' +\n          'Either pass a comment to the constructor and call ' +\n          'recordCurrentSizeAsNewSize, or call fromJson',\n      );\n    }\n    comment.setSize(size);\n  }\n}\n\nexport interface CommentResizeJson extends CommentBaseJson {\n  oldWidth: number;\n  oldHeight: number;\n  newWidth: number;\n  newHeight: number;\n}\n\nregistry.register(registry.Type.EVENT, EventType.COMMENT_RESIZE, CommentResize);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of selecting an item on the toolbox.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.ToolboxItemSelect\n\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners that a toolbox item has been selected.\n */\nexport class ToolboxItemSelect extends UiBase {\n  /** The previously selected toolbox item. */\n  oldItem?: string;\n\n  /** The newly selected toolbox item. */\n  newItem?: string;\n\n  override type = EventType.TOOLBOX_ITEM_SELECT;\n\n  /**\n   * @param opt_oldItem The previously selected toolbox item.\n   *     Undefined for a blank event.\n   * @param opt_newItem The newly selected toolbox item. Undefined for a blank\n   *     event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(\n    opt_oldItem?: string | null,\n    opt_newItem?: string | null,\n    opt_workspaceId?: string,\n  ) {\n    super(opt_workspaceId);\n    this.oldItem = opt_oldItem ?? undefined;\n    this.newItem = opt_newItem ?? undefined;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ToolboxItemSelectJson {\n    const json = super.toJson() as ToolboxItemSelectJson;\n    json['oldItem'] = this.oldItem;\n    json['newItem'] = this.newItem;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of ToolboxItemSelect, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n    json: ToolboxItemSelectJson,\n    workspace: Workspace,\n    event?: any,\n  ): ToolboxItemSelect {\n    const newEvent = super.fromJson(\n      json,\n      workspace,\n      event ?? new ToolboxItemSelect(),\n    ) as ToolboxItemSelect;\n    newEvent.oldItem = json['oldItem'];\n    newEvent.newItem = json['newItem'];\n    return newEvent;\n  }\n}\n\nexport interface ToolboxItemSelectJson extends AbstractEventJson {\n  oldItem?: string;\n  newItem?: string;\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  EventType.TOOLBOX_ITEM_SELECT,\n  ToolboxItemSelect,\n);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a finished loading workspace event.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Events.FinishedLoading\n\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {Abstract as AbstractEvent} from './events_abstract.js';\nimport {EventType} from './type.js';\n\n/**\n * Notifies listeners when the workspace has finished deserializing from\n * JSON/XML.\n */\nexport class FinishedLoading extends AbstractEvent {\n  override isBlank = true;\n  override recordUndo = false;\n  override type = EventType.FINISHED_LOADING;\n\n  /**\n   * @param opt_workspace The workspace that has finished loading.  Undefined\n   *     for a blank event.\n   */\n  constructor(opt_workspace?: Workspace) {\n    super();\n    this.isBlank = !!opt_workspace;\n\n    if (!opt_workspace) return;\n\n    this.workspaceId = opt_workspace.id;\n  }\n}\n\nregistry.register(\n  registry.Type.EVENT,\n  EventType.FINISHED_LOADING,\n  FinishedLoading,\n);\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Events\n\nimport {EventType} from './type.js';\n\n// Events.\nexport {Abstract, AbstractEventJson} from './events_abstract.js';\nexport {BlockBase, BlockBaseJson} from './events_block_base.js';\nexport {BlockChange, BlockChangeJson} from './events_block_change.js';\nexport {BlockCreate, BlockCreateJson} from './events_block_create.js';\nexport {BlockDelete, BlockDeleteJson} from './events_block_delete.js';\nexport {BlockDrag, BlockDragJson} from './events_block_drag.js';\nexport {\n  BlockFieldIntermediateChange,\n  BlockFieldIntermediateChangeJson,\n} from './events_block_field_intermediate_change.js';\nexport {BlockMove, BlockMoveJson} from './events_block_move.js';\nexport {BubbleOpen, BubbleOpenJson, BubbleType} from './events_bubble_open.js';\nexport {Click, ClickJson, ClickTarget} from './events_click.js';\nexport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nexport {CommentChange, CommentChangeJson} from './events_comment_change.js';\nexport {\n  CommentCollapse,\n  CommentCollapseJson,\n} from './events_comment_collapse.js';\nexport {CommentCreate, CommentCreateJson} from './events_comment_create.js';\nexport {CommentDelete} from './events_comment_delete.js';\nexport {CommentDrag, CommentDragJson} from './events_comment_drag.js';\nexport {CommentMove, CommentMoveJson} from './events_comment_move.js';\nexport {CommentResize, CommentResizeJson} from './events_comment_resize.js';\nexport {MarkerMove, MarkerMoveJson} from './events_marker_move.js';\nexport {Selected, SelectedJson} from './events_selected.js';\nexport {ThemeChange, ThemeChangeJson} from './events_theme_change.js';\nexport {\n  ToolboxItemSelect,\n  ToolboxItemSelectJson,\n} from './events_toolbox_item_select.js';\nexport {TrashcanOpen, TrashcanOpenJson} from './events_trashcan_open.js';\nexport {UiBase} from './events_ui_base.js';\nexport {VarBase, VarBaseJson} from './events_var_base.js';\nexport {VarCreate, VarCreateJson} from './events_var_create.js';\nexport {VarDelete, VarDeleteJson} from './events_var_delete.js';\nexport {VarRename, VarRenameJson} from './events_var_rename.js';\nexport {ViewportChange, ViewportChangeJson} from './events_viewport.js';\nexport {FinishedLoading} from './workspace_events.js';\n\nexport type {BumpEvent} from './utils.js';\n\n// Event types.\nexport const BLOCK_CHANGE = EventType.BLOCK_CHANGE;\nexport const BLOCK_CREATE = EventType.BLOCK_CREATE;\nexport const BLOCK_DELETE = EventType.BLOCK_DELETE;\nexport const BLOCK_DRAG = EventType.BLOCK_DRAG;\nexport const BLOCK_MOVE = EventType.BLOCK_MOVE;\nexport const BLOCK_FIELD_INTERMEDIATE_CHANGE =\n  EventType.BLOCK_FIELD_INTERMEDIATE_CHANGE;\nexport const BUBBLE_OPEN = EventType.BUBBLE_OPEN;\n/** @deprecated Use BLOCK_CHANGE instead */\nexport const CHANGE = EventType.BLOCK_CHANGE;\nexport const CLICK = EventType.CLICK;\nexport const COMMENT_CHANGE = EventType.COMMENT_CHANGE;\nexport const COMMENT_CREATE = EventType.COMMENT_CREATE;\nexport const COMMENT_DELETE = EventType.COMMENT_DELETE;\nexport const COMMENT_MOVE = EventType.COMMENT_MOVE;\nexport const COMMENT_RESIZE = EventType.COMMENT_RESIZE;\nexport const COMMENT_DRAG = EventType.COMMENT_DRAG;\n/** @deprecated Use BLOCK_CREATE instead */\nexport const CREATE = EventType.BLOCK_CREATE;\n/** @deprecated Use BLOCK_DELETE instead */\nexport const DELETE = EventType.BLOCK_DELETE;\nexport const FINISHED_LOADING = EventType.FINISHED_LOADING;\nexport const MARKER_MOVE = EventType.MARKER_MOVE;\n/** @deprecated Use BLOCK_MOVE instead */\nexport const MOVE = EventType.BLOCK_MOVE;\nexport const SELECTED = EventType.SELECTED;\nexport const THEME_CHANGE = EventType.THEME_CHANGE;\nexport const TOOLBOX_ITEM_SELECT = EventType.TOOLBOX_ITEM_SELECT;\nexport const TRASHCAN_OPEN = EventType.TRASHCAN_OPEN;\nexport const UI = EventType.UI;\nexport const VAR_CREATE = EventType.VAR_CREATE;\nexport const VAR_DELETE = EventType.VAR_DELETE;\nexport const VAR_RENAME = EventType.VAR_RENAME;\nexport const VIEWPORT_CHANGE = EventType.VIEWPORT_CHANGE;\n\nexport {BUMP_EVENTS} from './type.js';\n\n// Event utils.\nexport {\n  clearPendingUndo,\n  disable,\n  disableOrphans,\n  enable,\n  filter,\n  fire,\n  fromJson,\n  get,\n  getDescendantIds,\n  getGroup,\n  getRecordUndo,\n  isEnabled,\n  setGroup,\n  setRecordUndo,\n} from './utils.js';\n", "/** @file Re-exports of Blockly.zelos.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.zelos\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {BottomRow} from './measurables/bottom_row.js';\nimport {StatementInput} from './measurables/inputs.js';\nimport {RightConnectionShape} from './measurables/row_elements.js';\nimport {TopRow} from './measurables/top_row.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\nexport {\n  BottomRow,\n  ConstantProvider,\n  Drawer,\n  MarkerSvg,\n  PathObject,\n  Renderer,\n  RenderInfo,\n  RightConnectionShape,\n  StatementInput,\n  TopRow,\n};\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport {CommentView} from './comments/comment_view.js';\nexport {RenderedWorkspaceComment} from './comments/rendered_workspace_comment.js';\nexport {WorkspaceComment} from './comments/workspace_comment.js';\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Bubble} from './bubbles/bubble.js';\nimport {MiniWorkspaceBubble} from './bubbles/mini_workspace_bubble.js';\nimport {TextBubble} from './bubbles/text_bubble.js';\nimport {TextInputBubble} from './bubbles/textinput_bubble.js';\n\nexport {Bubble, MiniWorkspaceBubble, TextBubble, TextInputBubble};\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.BlocklyOptions\n\nimport type {ITheme, Theme} from './theme.js';\nimport type {ToolboxDefinition} from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Blockly options.\n */\nexport interface BlocklyOptions {\n  collapse?: boolean;\n  comments?: boolean;\n  css?: boolean;\n  disable?: boolean;\n  grid?: GridOptions;\n  horizontalLayout?: boolean;\n  maxBlocks?: number;\n  maxInstances?: {[blockType: string]: number};\n  media?: string;\n  modalInputs?: boolean;\n  move?: MoveOptions;\n  oneBasedIndex?: boolean;\n  readOnly?: boolean;\n  renderer?: string;\n  rendererOverrides?: {[rendererConstant: string]: any};\n  rtl?: boolean;\n  scrollbars?: ScrollbarOptions | boolean;\n  sounds?: boolean;\n  theme?: Theme | string | ITheme;\n  toolbox?: string | ToolboxDefinition | Element;\n  toolboxPosition?: string;\n  trashcan?: boolean;\n  maxTrashcanContents?: number;\n  plugins?: {[key: string]: (new (...p1: any[]) => any) | string};\n  zoom?: ZoomOptions;\n  parentWorkspace?: WorkspaceSvg;\n}\n\nexport interface GridOptions {\n  colour?: string;\n  length?: number;\n  snap?: boolean;\n  spacing?: number;\n}\n\nexport interface MoveOptions {\n  drag?: boolean;\n  scrollbars?: boolean | ScrollbarOptions;\n  wheel?: boolean;\n}\n\nexport interface ScrollbarOptions {\n  horizontal?: boolean;\n  vertical?: boolean;\n}\n\nexport interface ZoomOptions {\n  controls?: boolean;\n  maxScale?: number;\n  minScale?: number;\n  pinch?: boolean;\n  scaleSpeed?: number;\n  startScale?: number;\n  wheel?: boolean;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.ConstantProvider\n\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\n\n/**\n * An object that provides constants for rendering blocks in Geras mode.\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  override FIELD_TEXT_BASELINE_CENTER = false;\n\n  // The dark/shadow path in classic rendering is the same as the normal block\n  // path, but translated down one and right one.\n  DARK_PATH_OFFSET = 1;\n\n  /**\n   * The maximum width of a bottom row that follows a statement input and has\n   * inputs inline.\n   */\n  MAX_BOTTOM_WIDTH = 30;\n  override STATEMENT_BOTTOM_SPACER = -this.NOTCH_HEIGHT / 2;\n\n  constructor() {\n    super();\n  }\n\n  override getCSS_(selector: string) {\n    return super.getCSS_(selector).concat([\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPathLight,`,\n      `${selector} .blocklyInsertionMarker>.blocklyPathDark {`,\n      `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n      `stroke: none;`,\n      '}',\n    ]);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.Highlighter\n\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport type {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\nimport type {\n  HighlightConstantProvider,\n  InsideCorner,\n  JaggedTeeth,\n  Notch,\n  OutsideCorner,\n  PuzzleTab,\n  StartHat,\n} from './highlight_constants.js';\nimport type {RenderInfo} from './info.js';\nimport type {InlineInput} from './measurables/inline_input.js';\n\n/**\n * An object that adds highlights to a block based on the given rendering\n * information.\n *\n * Highlighting is interesting because the highlights do not fully enclose the\n * block.  Instead, they are positioned based on a light source in the top left.\n * This means that rendering highlights requires exact information about the\n * position of each part of the block.  The resulting paths are not continuous\n * or closed paths.  The highlights for tabs and notches are loosely based on\n * tab and notch shapes, but are not exactly the same.\n */\nexport class Highlighter {\n  info_: RenderInfo;\n  steps_ = '';\n  inlineSteps_ = '';\n  RTL_: boolean;\n  constants_: ConstantProvider;\n  highlightConstants_: HighlightConstantProvider;\n  private readonly highlightOffset: number;\n  outsideCornerPaths_: OutsideCorner;\n  insideCornerPaths_: InsideCorner;\n  puzzleTabPaths_: PuzzleTab;\n  notchPaths_: Notch;\n  startPaths_: StartHat;\n  jaggedTeethPaths_: JaggedTeeth;\n\n  /**\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(info: RenderInfo) {\n    this.info_ = info;\n\n    this.RTL_ = this.info_.RTL;\n\n    const renderer = info.getRenderer();\n\n    /** The renderer's constant provider. */\n    this.constants_ = renderer.getConstants();\n\n    this.highlightConstants_ = renderer.getHighlightConstants();\n    /** The offset between the block's main path and highlight path. */\n    this.highlightOffset = this.highlightConstants_.OFFSET;\n\n    this.outsideCornerPaths_ = this.highlightConstants_.OUTSIDE_CORNER;\n    this.insideCornerPaths_ = this.highlightConstants_.INSIDE_CORNER;\n    this.puzzleTabPaths_ = this.highlightConstants_.PUZZLE_TAB;\n    this.notchPaths_ = this.highlightConstants_.NOTCH;\n    this.startPaths_ = this.highlightConstants_.START_HAT;\n    this.jaggedTeethPaths_ = this.highlightConstants_.JAGGED_TEETH;\n  }\n\n  /**\n   * Get the steps for the highlight path.\n   *\n   * @returns The steps for the highlight path.\n   */\n  getPath(): string {\n    return this.steps_ + '\\n' + this.inlineSteps_;\n  }\n\n  /**\n   * Add a highlight to the top corner of a block.\n   *\n   * @param row The top row of the block.\n   */\n  drawTopCorner(row: TopRow) {\n    this.steps_ += svgPaths.moveBy(row.xPos, this.info_.startY);\n    for (let i = 0, elem; (elem = row.elements[i]); i++) {\n      if (Types.isLeftSquareCorner(elem)) {\n        this.steps_ += this.highlightConstants_.START_POINT;\n      } else if (Types.isLeftRoundedCorner(elem)) {\n        this.steps_ += this.outsideCornerPaths_.topLeft(this.RTL_);\n      } else if (Types.isPreviousConnection(elem)) {\n        this.steps_ += this.notchPaths_.pathLeft;\n      } else if (Types.isHat(elem)) {\n        this.steps_ += this.startPaths_.path(this.RTL_);\n      } else if (Types.isSpacer(elem) && elem.width !== 0) {\n        // The end point of the spacer needs to be offset by the highlight\n        // amount. So instead of using the spacer's width for a relative\n        // horizontal, use its width and position for an absolute horizontal\n        // move.\n        this.steps_ += svgPaths.lineOnAxis(\n          'H',\n          elem.xPos + elem.width - this.highlightOffset,\n        );\n      }\n    }\n\n    const right = row.xPos + row.width - this.highlightOffset;\n    this.steps_ += svgPaths.lineOnAxis('H', right);\n  }\n\n  /**\n   * Add a highlight on a jagged edge for a collapsed block.\n   *\n   * @param row  The row to highlight.\n   */\n  drawJaggedEdge_(row: Row) {\n    if (this.info_.RTL) {\n      const remainder =\n        row.height - this.jaggedTeethPaths_.height - this.highlightOffset;\n      this.steps_ +=\n        this.jaggedTeethPaths_.pathLeft + svgPaths.lineOnAxis('v', remainder);\n    }\n  }\n\n  /**\n   * Add a highlight on a value input.\n   *\n   * @param row The row the input belongs to.\n   */\n  drawValueInput(row: Row) {\n    const input = row.getLastInput() as InlineInput;\n    if (this.RTL_) {\n      const belowTabHeight = row.height - input.connectionHeight;\n\n      this.steps_ +=\n        svgPaths.moveTo(\n          input.xPos + input.width - this.highlightOffset,\n          row.yPos,\n        ) +\n        this.puzzleTabPaths_.pathDown(this.RTL_) +\n        svgPaths.lineOnAxis('v', belowTabHeight);\n    } else {\n      this.steps_ +=\n        svgPaths.moveTo(input.xPos + input.width, row.yPos) +\n        this.puzzleTabPaths_.pathDown(this.RTL_);\n    }\n  }\n\n  /**\n   * Add a highlight on a statement input.\n   *\n   * @param row The row to highlight.\n   */\n  drawStatementInput(row: Row) {\n    const input = row.getLastInput();\n    if (!input) return;\n    if (this.RTL_) {\n      const innerHeight = row.height - 2 * this.insideCornerPaths_.height;\n      this.steps_ +=\n        svgPaths.moveTo(input.xPos, row.yPos) +\n        this.insideCornerPaths_.pathTop(this.RTL_) +\n        svgPaths.lineOnAxis('v', innerHeight) +\n        this.insideCornerPaths_.pathBottom(this.RTL_) +\n        svgPaths.lineTo(\n          row.width - input.xPos - this.insideCornerPaths_.width,\n          0,\n        );\n    } else {\n      this.steps_ +=\n        svgPaths.moveTo(input.xPos, row.yPos + row.height) +\n        this.insideCornerPaths_.pathBottom(this.RTL_) +\n        svgPaths.lineTo(\n          row.width - input.xPos - this.insideCornerPaths_.width,\n          0,\n        );\n    }\n  }\n\n  /**\n   * Add a highlight on the right side of a row.\n   *\n   * @param row The row to highlight.\n   */\n  drawRightSideRow(row: Row) {\n    const rightEdge = row.xPos + row.width - this.highlightOffset;\n    if (row instanceof SpacerRow && row.followsStatement) {\n      this.steps_ += svgPaths.lineOnAxis('H', rightEdge);\n    }\n    if (this.RTL_) {\n      this.steps_ += svgPaths.lineOnAxis('H', rightEdge);\n      if (row.height > this.highlightOffset) {\n        this.steps_ += svgPaths.lineOnAxis(\n          'V',\n          row.yPos + row.height - this.highlightOffset,\n        );\n      }\n    }\n  }\n\n  /**\n   * Add a highlight to the bottom row.\n   *\n   * @param row The row to highlight.\n   */\n  drawBottomRow(row: BottomRow) {\n    // Highlight the vertical edge of the bottom row on the input side.\n    // Highlighting is always from the top left, both in LTR and RTL.\n    if (this.RTL_) {\n      this.steps_ += svgPaths.lineOnAxis(\n        'V',\n        row.baseline - this.highlightOffset,\n      );\n    } else {\n      const cornerElem = this.info_.bottomRow.elements[0];\n      if (Types.isLeftSquareCorner(cornerElem)) {\n        this.steps_ += svgPaths.moveTo(\n          row.xPos + this.highlightOffset,\n          row.baseline - this.highlightOffset,\n        );\n      } else if (Types.isLeftRoundedCorner(cornerElem)) {\n        this.steps_ += svgPaths.moveTo(row.xPos, row.baseline);\n        this.steps_ += this.outsideCornerPaths_.bottomLeft();\n      }\n    }\n  }\n\n  /**\n   * Draw the highlight on the left side of the block.\n   */\n  drawLeft() {\n    const outputConnection = this.info_.outputConnection;\n    if (outputConnection) {\n      const tabBottom =\n        outputConnection.connectionOffsetY + outputConnection.height;\n      // Draw a line up to the bottom of the tab.\n      if (this.RTL_) {\n        this.steps_ += svgPaths.moveTo(this.info_.startX, tabBottom);\n      } else {\n        const left = this.info_.startX + this.highlightOffset;\n        const bottom = this.info_.bottomRow.baseline - this.highlightOffset;\n        this.steps_ += svgPaths.moveTo(left, bottom);\n        this.steps_ += svgPaths.lineOnAxis('V', tabBottom);\n      }\n      this.steps_ += this.puzzleTabPaths_.pathUp(this.RTL_);\n    }\n\n    if (!this.RTL_) {\n      const topRow = this.info_.topRow;\n      if (Types.isLeftRoundedCorner(topRow.elements[0])) {\n        this.steps_ += svgPaths.lineOnAxis(\n          'V',\n          this.outsideCornerPaths_.height,\n        );\n      } else {\n        this.steps_ += svgPaths.lineOnAxis(\n          'V',\n          topRow.capline + this.highlightOffset,\n        );\n      }\n    }\n  }\n\n  /**\n   * Add a highlight to an inline input.\n   *\n   * @param input The input to highlight.\n   */\n  drawInlineInput(input: InlineInput) {\n    const offset = this.highlightOffset;\n\n    // Relative to the block's left.\n    const connectionRight = input.xPos + input.connectionWidth;\n    const yPos = input.centerline - input.height / 2;\n    const bottomHighlightWidth = input.width - input.connectionWidth;\n    const startY = yPos + offset;\n\n    if (this.RTL_) {\n      const aboveTabHeight = input.connectionOffsetY - offset;\n      const belowTabHeight =\n        input.height -\n        (input.connectionOffsetY + input.connectionHeight) +\n        offset;\n\n      const startX = connectionRight - offset;\n\n      this.inlineSteps_ +=\n        svgPaths.moveTo(startX, startY) + // Right edge above tab.\n        svgPaths.lineOnAxis('v', aboveTabHeight) + // Back of tab.\n        this.puzzleTabPaths_.pathDown(this.RTL_) + // Right edge below tab.\n        svgPaths.lineOnAxis('v', belowTabHeight) + // Bottom.\n        svgPaths.lineOnAxis('h', bottomHighlightWidth);\n    } else {\n      this.inlineSteps_ += // Go to top right corner.\n        svgPaths.moveTo(input.xPos + input.width + offset, startY) + // Highlight right edge, bottom.\n        svgPaths.lineOnAxis('v', input.height) +\n        svgPaths.lineOnAxis('h', -bottomHighlightWidth) + // Go to top of tab.\n        svgPaths.moveTo(connectionRight, yPos + input.connectionOffsetY) + // Short highlight glint at\n        // bottom of tab.\n        this.puzzleTabPaths_.pathDown(this.RTL_);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.Drawer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\nimport type {Row} from '../measurables/row.js';\nimport type {ConstantProvider} from './constants.js';\nimport {Highlighter} from './highlighter.js';\nimport type {RenderInfo} from './info.js';\nimport type {InlineInput} from './measurables/inline_input.js';\nimport type {PathObject} from './path_object.js';\n\n/**\n * An object that draws a block based on the given rendering information,\n * customized for the geras renderer.\n */\nexport class Drawer extends BaseDrawer {\n  highlighter_: Highlighter;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override constants_!: ConstantProvider;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n    // Unlike Thrasos, Geras has highlights and drop shadows.\n    this.highlighter_ = new Highlighter(info);\n  }\n\n  override draw() {\n    this.drawOutline_();\n    this.drawInternals_();\n    this.updateConnectionHighlights();\n\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    pathObject.setHighlightPath(this.highlighter_.getPath());\n    if (this.info_.RTL) {\n      pathObject.flipRTL();\n    }\n    this.recordSizeOnBlock_();\n  }\n\n  override drawTop_() {\n    this.highlighter_.drawTopCorner(this.info_.topRow);\n    this.highlighter_.drawRightSideRow(this.info_.topRow);\n\n    super.drawTop_();\n  }\n\n  override drawJaggedEdge_(row: Row) {\n    this.highlighter_.drawJaggedEdge_(row);\n\n    super.drawJaggedEdge_(row);\n  }\n\n  override drawValueInput_(row: Row) {\n    this.highlighter_.drawValueInput(row);\n\n    super.drawValueInput_(row);\n  }\n\n  override drawStatementInput_(row: Row) {\n    this.highlighter_.drawStatementInput(row);\n\n    super.drawStatementInput_(row);\n  }\n\n  override drawRightSideRow_(row: Row) {\n    this.highlighter_.drawRightSideRow(row);\n\n    this.outlinePath_ +=\n      svgPaths.lineOnAxis('H', row.xPos + row.width) +\n      svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  override drawBottom_() {\n    this.highlighter_.drawBottomRow(this.info_.bottomRow);\n\n    super.drawBottom_();\n  }\n\n  /**\n   * Add steps for the left side of the block, which may include an output\n   * connection\n   */\n  protected override drawLeft_() {\n    this.highlighter_.drawLeft();\n\n    super.drawLeft_();\n  }\n\n  override drawInlineInput_(input: InlineInput) {\n    this.highlighter_.drawInlineInput(input as InlineInput);\n\n    super.drawInlineInput_(input);\n  }\n\n  override positionInlineInputConnection_(input: InlineInput) {\n    const yPos = input.centerline - input.height / 2;\n    // Move the connection.\n    if (input.connectionModel) {\n      // xPos already contains info about startX\n      let connX =\n        input.xPos + input.connectionWidth + this.constants_.DARK_PATH_OFFSET;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(\n        connX,\n        yPos + input.connectionOffsetY + this.constants_.DARK_PATH_OFFSET,\n      );\n    }\n  }\n\n  override positionStatementInputConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input?.connectionModel) {\n      let connX = row.xPos + row.statementEdge + input.notchOffset;\n      if (this.info_.RTL) {\n        connX *= -1;\n      } else {\n        connX += this.constants_.DARK_PATH_OFFSET;\n      }\n      input.connectionModel.setOffsetInBlock(\n        connX,\n        row.yPos + this.constants_.DARK_PATH_OFFSET,\n      );\n    }\n  }\n\n  override positionExternalValueConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input && input.connectionModel) {\n      let connX = row.xPos + row.width + this.constants_.DARK_PATH_OFFSET;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  override positionNextConnection_() {\n    const bottomRow = this.info_.bottomRow;\n\n    if (bottomRow.connection) {\n      const connInfo = bottomRow.connection;\n      const x = connInfo.xPos; // Already contains info about startX.\n      const connX =\n        (this.info_.RTL ? -x : x) + this.constants_.DARK_PATH_OFFSET / 2;\n      connInfo.connectionModel.setOffsetInBlock(\n        connX,\n        bottomRow.baseline + this.constants_.DARK_PATH_OFFSET,\n      );\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.HighlightConstantProvider\n\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\n/** An object containing sizing and path information about an outside corner. */\nexport interface OutsideCorner {\n  height: number;\n  topLeft: (p1: boolean) => string;\n  bottomLeft: () => string;\n}\n\n/** An object containing sizing and path information about an inside corner. */\nexport interface InsideCorner {\n  width: number;\n  height: number;\n  pathTop: (p1: boolean) => string;\n  pathBottom: (p1: boolean) => string;\n}\n\n/** An object containing sizing and path information about a start hat. */\nexport interface StartHat {\n  path: (p1: boolean) => string;\n}\n\n/** An object containing sizing and path information about a notch. */\nexport interface Notch {\n  pathLeft: string;\n}\n\n/** An object containing sizing and path information about a puzzle tab. */\nexport interface PuzzleTab {\n  width: number;\n  height: number;\n  pathDown: (p1: boolean) => string;\n  pathUp: (p1: boolean) => string;\n}\n\n/**\n * An object containing sizing and path information about collapsed block\n * indicators.\n */\nexport interface JaggedTeeth {\n  height: number;\n  width: number;\n  pathLeft: string;\n}\n\n/**\n * An object that provides constants for rendering highlights on blocks.\n * Some highlights are simple offsets of the parent paths and can be generated\n * programmatically.  Others, especially on curves, are just made out of piles\n * of constants and are hard to tweak.\n */\nexport class HighlightConstantProvider {\n  constantProvider: ConstantProvider;\n\n  /** The offset between the block's main path and highlight path. */\n  OFFSET = 0.5;\n  START_POINT: string;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  INSIDE_CORNER!: InsideCorner;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  OUTSIDE_CORNER!: OutsideCorner;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  PUZZLE_TAB!: PuzzleTab;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  NOTCH!: Notch;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  JAGGED_TEETH!: JaggedTeeth;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  START_HAT!: StartHat;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    /** The renderer's constant provider. */\n    this.constantProvider = constants;\n\n    /**\n     * The start point, which is offset in both X and Y, as an SVG path chunk.\n     */\n    this.START_POINT = svgPaths.moveBy(this.OFFSET, this.OFFSET);\n  }\n\n  /**\n   * Initialize shape objects based on the constants set in the constructor.\n   */\n  init() {\n    /**\n     * An object containing sizing and path information about inside corner\n     * highlights.\n     */\n    this.INSIDE_CORNER = this.makeInsideCorner();\n\n    /**\n     * An object containing sizing and path information about outside corner\n     * highlights.\n     */\n    this.OUTSIDE_CORNER = this.makeOutsideCorner();\n\n    /**\n     * An object containing sizing and path information about puzzle tab\n     * highlights.\n     */\n    this.PUZZLE_TAB = this.makePuzzleTab();\n\n    /**\n     * An object containing sizing and path information about notch highlights.\n     */\n    this.NOTCH = this.makeNotch();\n\n    /**\n     * An object containing sizing and path information about highlights for\n     * collapsed block indicators.\n     */\n    this.JAGGED_TEETH = this.makeJaggedTeeth();\n\n    /**\n     * An object containing sizing and path information about start hat\n     * highlights.\n     */\n    this.START_HAT = this.makeStartHat();\n  }\n\n  /**\n   * @returns An object containing sizing and path information about inside\n   *     corner highlights.\n   */\n  protected makeInsideCorner(): InsideCorner {\n    const radius = this.constantProvider.CORNER_RADIUS;\n    const offset = this.OFFSET;\n\n    /**\n     * Distance from shape edge to intersect with a curved corner at 45 degrees.\n     * Applies to highlighting on around the outside of a curve.\n     */\n    const distance45outside = (1 - Math.SQRT1_2) * (radius + offset) - offset;\n\n    const pathTopRtl =\n      svgPaths.moveBy(distance45outside, distance45outside) +\n      svgPaths.arc(\n        'a',\n        '0 0,0',\n        radius,\n        svgPaths.point(-distance45outside - offset, radius - distance45outside),\n      );\n\n    const pathBottomRtl = svgPaths.arc(\n      'a',\n      '0 0,0',\n      radius + offset,\n      svgPaths.point(radius + offset, radius + offset),\n    );\n\n    const pathBottomLtr =\n      svgPaths.moveBy(distance45outside, -distance45outside) +\n      svgPaths.arc(\n        'a',\n        '0 0,0',\n        radius + offset,\n        svgPaths.point(radius - distance45outside, distance45outside + offset),\n      );\n\n    return {\n      width: radius + offset,\n      height: radius,\n      pathTop(rtl) {\n        return rtl ? pathTopRtl : '';\n      },\n      pathBottom(rtl) {\n        return rtl ? pathBottomRtl : pathBottomLtr;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about outside\n   *     corner highlights.\n   */\n  protected makeOutsideCorner(): OutsideCorner {\n    const radius = this.constantProvider.CORNER_RADIUS;\n    const offset = this.OFFSET;\n\n    /**\n     * Distance from shape edge to intersect with a curved corner at 45 degrees.\n     * Applies to highlighting on around the inside of a curve.\n     */\n    const distance45inside = (1 - Math.SQRT1_2) * (radius - offset) + offset;\n\n    const topLeftStartX = distance45inside;\n    const topLeftStartY = distance45inside;\n    const topLeftCornerHighlightRtl =\n      svgPaths.moveBy(topLeftStartX, topLeftStartY) +\n      svgPaths.arc(\n        'a',\n        '0 0,1',\n        radius - offset,\n        svgPaths.point(radius - topLeftStartX, -topLeftStartY + offset),\n      );\n    /**\n     * SVG path for drawing the highlight on the rounded top-left corner.\n     */\n    const topLeftCornerHighlightLtr =\n      svgPaths.moveBy(offset, radius) +\n      svgPaths.arc(\n        'a',\n        '0 0,1',\n        radius - offset,\n        svgPaths.point(radius, -radius + offset),\n      );\n\n    const bottomLeftStartX = distance45inside;\n    const bottomLeftStartY = -distance45inside;\n    const bottomLeftPath =\n      svgPaths.moveBy(bottomLeftStartX, bottomLeftStartY) +\n      svgPaths.arc(\n        'a',\n        '0 0,1',\n        radius - offset,\n        svgPaths.point(-bottomLeftStartX + offset, -bottomLeftStartY - radius),\n      );\n\n    return {\n      height: radius,\n      topLeft(rtl) {\n        return rtl ? topLeftCornerHighlightRtl : topLeftCornerHighlightLtr;\n      },\n      bottomLeft() {\n        return bottomLeftPath;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about puzzle tab\n   *     highlights.\n   */\n  protected makePuzzleTab(): PuzzleTab {\n    const width = this.constantProvider.TAB_WIDTH;\n    const height = this.constantProvider.TAB_HEIGHT;\n\n    // This is how much of the vertical block edge is actually drawn by the\n    // puzzle tab.\n    const verticalOverlap = 2.5;\n\n    const highlightRtlUp =\n      svgPaths.moveBy(-2, -height + verticalOverlap + 0.9) +\n      svgPaths.lineTo(width * -0.45, -2.1);\n\n    const highlightRtlDown =\n      svgPaths.lineOnAxis('v', verticalOverlap) +\n      svgPaths.moveBy(-width * 0.97, 2.5) +\n      svgPaths.curve('q', [\n        svgPaths.point(-width * 0.05, 10),\n        svgPaths.point(width * 0.3, 9.5),\n      ]) +\n      svgPaths.moveBy(width * 0.67, -1.9) +\n      svgPaths.lineOnAxis('v', verticalOverlap);\n\n    const highlightLtrUp =\n      svgPaths.lineOnAxis('v', -1.5) +\n      svgPaths.moveBy(width * -0.92, -0.5) +\n      svgPaths.curve('q', [\n        svgPaths.point(width * -0.19, -5.5),\n        svgPaths.point(0, -11),\n      ]) +\n      svgPaths.moveBy(width * 0.92, 1);\n\n    const highlightLtrDown =\n      svgPaths.moveBy(-5, height - 0.7) + svgPaths.lineTo(width * 0.46, -2.1);\n\n    return {\n      width,\n      height,\n      pathUp(rtl) {\n        return rtl ? highlightRtlUp : highlightLtrUp;\n      },\n      pathDown(rtl) {\n        return rtl ? highlightRtlDown : highlightLtrDown;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about notch\n   *     highlights.\n   */\n  protected makeNotch(): Notch {\n    // This is only for the previous connection.\n    const pathLeft =\n      svgPaths.lineOnAxis('h', this.OFFSET) +\n      this.constantProvider.NOTCH.pathLeft;\n    return {pathLeft};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about collapsed\n   *     block edge highlights.\n   */\n  protected makeJaggedTeeth(): JaggedTeeth {\n    const pathLeft =\n      svgPaths.lineTo(5.1, 2.6) +\n      svgPaths.moveBy(-10.2, 6.8) +\n      svgPaths.lineTo(5.1, 2.6);\n    return {pathLeft, height: 12, width: 10.2};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about start\n   *     highlights.\n   */\n  protected makeStartHat(): StartHat {\n    const hatHeight = this.constantProvider.START_HAT.height;\n    const pathRtl =\n      svgPaths.moveBy(25, -8.7) +\n      svgPaths.curve('c', [\n        svgPaths.point(29.7, -6.2),\n        svgPaths.point(57.2, -0.5),\n        svgPaths.point(75, 8.7),\n      ]);\n\n    const pathLtr =\n      svgPaths.curve('c', [\n        svgPaths.point(17.8, -9.2),\n        svgPaths.point(45.3, -14.9),\n        svgPaths.point(75, -8.7),\n      ]) + svgPaths.moveTo(100.5, hatHeight + 0.5);\n    return {\n      path(rtl) {\n        return rtl ? pathRtl : pathLtr;\n      },\n    };\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.InlineInput\n\nimport type {Input} from '../../../inputs/input.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../../../renderers/common/constants.js';\nimport {InlineInput as BaseInlineInput} from '../../../renderers/measurables/inline_input.js';\nimport type {ConstantProvider as GerasConstantProvider} from '../constants.js';\n\n/**\n * An object containing information about the space an inline input takes up\n * during rendering.\n */\nexport class InlineInput extends BaseInlineInput {\n  override constants_: GerasConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The inline input to measure and store information for.\n   */\n  constructor(constants: BaseConstantProvider, input: Input) {\n    super(constants, input);\n    this.constants_ = constants as GerasConstantProvider;\n\n    if (this.connectedBlock) {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.width += this.constants_.DARK_PATH_OFFSET;\n      this.height += this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.StatementInput\n\nimport type {Input} from '../../../inputs/input.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../../../renderers/common/constants.js';\nimport {StatementInput as BaseStatementInput} from '../../../renderers/measurables/statement_input.js';\nimport type {ConstantProvider as GerasConstantProvider} from '../constants.js';\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering.\n */\nexport class StatementInput extends BaseStatementInput {\n  override constants_: GerasConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   */\n  constructor(constants: BaseConstantProvider, input: Input) {\n    super(constants, input);\n    this.constants_ = constants as GerasConstantProvider;\n\n    if (this.connectedBlock) {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.height += this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {DummyInput} from '../../inputs/dummy_input.js';\nimport {EndRowInput} from '../../inputs/end_row_input.js';\nimport type {Input} from '../../inputs/input.js';\nimport {StatementInput} from '../../inputs/statement_input.js';\nimport {ValueInput} from '../../inputs/value_input.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport type {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport type {InputRow} from '../measurables/input_row.js';\nimport type {Row} from '../measurables/row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\nimport type {ConstantProvider} from './constants.js';\nimport {InlineInput} from './measurables/inline_input.js';\nimport {StatementInput as StatementInputMeasurable} from './measurables/statement_input.js';\nimport type {Renderer} from './renderer.js';\n\n/**\n * An object containing all sizing information needed to draw this block,\n * customized for the geras renderer.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override constants_!: ConstantProvider;\n\n  protected override readonly renderer_: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n    this.renderer_ = renderer;\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  override populateBottomRow_() {\n    super.populateBottomRow_();\n\n    const followsStatement =\n      this.block_.inputList.length &&\n      this.block_.inputList[this.block_.inputList.length - 1] instanceof\n        StatementInput;\n    // The minimum height of the bottom row is smaller in Geras than in other\n    // renderers, because the dark path adds a pixel.\n    // If one of the row's elements has a greater height this will be\n    // overwritten in the compute pass.\n    if (!followsStatement) {\n      this.bottomRow.minHeight =\n        this.constants_.MEDIUM_PADDING - this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n\n  override addInput_(input: Input, activeRow: Row) {\n    // Non-dummy inputs have visual representations onscreen.\n    if (this.isInline && input instanceof ValueInput) {\n      activeRow.elements.push(new InlineInput(this.constants_, input));\n      activeRow.hasInlineInput = true;\n    } else if (input instanceof StatementInput) {\n      activeRow.elements.push(\n        new StatementInputMeasurable(this.constants_, input),\n      );\n      activeRow.hasStatement = true;\n    } else if (input instanceof ValueInput) {\n      activeRow.elements.push(new ExternalValueInput(this.constants_, input));\n      activeRow.hasExternalInput = true;\n    } else if (input instanceof DummyInput || input instanceof EndRowInput) {\n      // Dummy and end-row inputs have no visual representation, but the\n      // information is still important.\n      activeRow.minHeight = Math.max(\n        activeRow.minHeight,\n        this.constants_.DUMMY_INPUT_MIN_HEIGHT,\n      );\n      activeRow.hasDummyInput = true;\n    }\n    // Ignore row alignment if inline.\n    if (!this.isInline && activeRow.align === null) {\n      activeRow.align = input.align;\n    }\n  }\n\n  override addElemSpacing_() {\n    let hasExternalInputs = false;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      if (row.hasExternalInput) {\n        hasExternalInputs = true;\n      }\n    }\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(\n          new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(null, oldElems[0]),\n          ),\n        );\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        let spacing = this.getInRowSpacing_(\n          oldElems[oldElems.length - 1],\n          null,\n        );\n        if (hasExternalInputs && row.hasDummyInput) {\n          spacing += this.constants_.TAB_WIDTH;\n        }\n        // There's a spacer after the last element in the row.\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n    }\n  }\n\n  override getInRowSpacing_(prev: Measurable | null, next: Measurable | null) {\n    if (!prev) {\n      // Between an editable field and the beginning of the row.\n      if (next && Types.isField(next) && (next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Inline input at the beginning of the row.\n      if (next && Types.isInlineInput(next)) {\n        return this.constants_.MEDIUM_LARGE_PADDING;\n      }\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n      // Anything else at the beginning of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between a non-input and the end of the row or a statement input.\n    if (!Types.isInput(prev) && (!next || Types.isStatementInput(next))) {\n      // Between an editable field and the end of the row.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Padding at the end of an icon-only row to make the block shape clearer.\n      if (Types.isIcon(prev)) {\n        return this.constants_.LARGE_PADDING * 2 + 1;\n      }\n      if (Types.isHat(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Establish a minimum width for a block with a previous or next\n      // connection.\n      if (Types.isPreviousOrNextConnection(prev)) {\n        return this.constants_.LARGE_PADDING;\n      }\n      // Between rounded corner and the end of the row.\n      if (Types.isLeftRoundedCorner(prev)) {\n        return this.constants_.MIN_BLOCK_WIDTH;\n      }\n      // Between a jagged edge and the end of the row.\n      if (Types.isJaggedEdge(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Between noneditable fields and icons and the end of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Between inputs and the end of the row.\n    if (Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a non-input and an input.\n    if (!Types.isInput(prev) && next && Types.isInput(next)) {\n      // Between an editable field and an input.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        }\n      } else {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isStatementInput(next)) {\n          return this.constants_.LARGE_PADDING;\n        }\n      }\n      return this.constants_.LARGE_PADDING - 1;\n    }\n\n    // Spacing between an icon and an icon or field.\n    if (Types.isIcon(prev) && next && !Types.isInput(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n    // Spacing between an inline input and a field.\n    if (Types.isInlineInput(prev) && next && Types.isField(next)) {\n      // Editable field after inline input.\n      if ((next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      } else {\n        // Noneditable field after inline input.\n        return this.constants_.LARGE_PADDING;\n      }\n    }\n\n    if (Types.isLeftSquareCorner(prev) && next) {\n      // Spacing between a hat and a corner\n      if (Types.isHat(next)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Spacing between a square corner and a previous or next connection\n      if (Types.isPreviousConnection(next)) {\n        return next.notchOffset;\n      } else if (Types.isNextConnection(next)) {\n        // Next connections are shifted slightly to the left (in both LTR and\n        // RTL) to make the dark path under the previous connection show\n        // through.\n        const offset =\n          ((this.RTL ? 1 : -1) * this.constants_.DARK_PATH_OFFSET) / 2;\n        return next.notchOffset + offset;\n      }\n    }\n\n    // Spacing between a rounded corner and a previous or next connection.\n    if (Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      } else if (Types.isNextConnection(next)) {\n        // Next connections are shifted slightly to the left (in both LTR and\n        // RTL) to make the dark path under the previous connection show\n        // through.\n        const offset =\n          ((this.RTL ? 1 : -1) * this.constants_.DARK_PATH_OFFSET) / 2;\n        return next.notchOffset - this.constants_.CORNER_RADIUS + offset;\n      }\n    }\n\n    // Spacing between two fields of the same editability.\n    if (\n      Types.isField(prev) &&\n      next &&\n      Types.isField(next) &&\n      (prev as Field).isEditable === (next as Field).isEditable\n    ) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between anything and a jagged edge.\n    if (next && Types.isJaggedEdge(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row) {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev) || Types.isBottomRow(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    if (prev.hasExternalInput && next.hasExternalInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasStatement) {\n      return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\n    }\n    if (prev.hasStatement && next.hasStatement) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (prev.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable) {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n        bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n\n    let result = row.yPos;\n    if (Types.isField(elem) || Types.isIcon(elem)) {\n      result += elem.height / 2;\n      if (\n        (row.hasInlineInput || row.hasStatement) &&\n        elem.height + this.constants_.TALL_INPUT_FIELD_OFFSET_Y <= row.height\n      ) {\n        result += this.constants_.TALL_INPUT_FIELD_OFFSET_Y;\n      }\n    } else if (Types.isInlineInput(elem)) {\n      result += elem.height / 2;\n    } else {\n      result += row.height / 2;\n    }\n    return result;\n  }\n\n  override alignRowElements_() {\n    if (!this.isInline) {\n      super.alignRowElements_();\n      return;\n    }\n    // Walk backgrounds through rows on the block, keeping track of the right\n    // input edge.\n    let nextRightEdge = 0;\n    const rowNextRightEdges = new WeakMap();\n    let prevInput = null;\n    for (let i = this.rows.length - 1, row; (row = this.rows[i]); i--) {\n      rowNextRightEdges.set(row, nextRightEdge);\n      if (Types.isInputRow(row)) {\n        if (row.hasStatement) {\n          this.alignStatementRow_(row as InputRow);\n        }\n        if (\n          prevInput &&\n          prevInput.hasStatement &&\n          row.width < prevInput.width\n        ) {\n          rowNextRightEdges.set(row, prevInput.width);\n        } else if (row.hasStatement) {\n          nextRightEdge = row.width;\n        } else {\n          // To keep right edges of consecutive non-statement rows aligned, use\n          // the maximum width.\n          nextRightEdge = Math.max(nextRightEdge, row.width);\n        }\n        prevInput = row;\n      }\n    }\n    // Walk down each row from the top, comparing the prev and next right input\n    // edges and setting the desired width to the max of the two.\n    let prevRightEdge = 0;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      if (row.hasStatement) {\n        prevRightEdge = this.getDesiredRowWidth_(row);\n      } else if (Types.isSpacer(row)) {\n        // Set the spacer row to the max of the prev or next input width.\n        row.width = Math.max(prevRightEdge, rowNextRightEdges.get(row));\n      } else {\n        const currentWidth = row.width;\n        const desiredWidth = Math.max(\n          prevRightEdge,\n          rowNextRightEdges.get(row),\n        );\n        const missingSpace = desiredWidth - currentWidth;\n        if (missingSpace > 0) {\n          this.addAlignmentPadding_(row, missingSpace);\n        }\n        prevRightEdge = row.width;\n      }\n    }\n  }\n\n  override getDesiredRowWidth_(row: Row) {\n    // Limit the width of a statement row when a block is inline.\n    if (this.isInline && row.hasStatement) {\n      return (\n        this.statementEdge + this.constants_.MAX_BOTTOM_WIDTH + this.startX\n      );\n    }\n    return super.getDesiredRowWidth_(row);\n  }\n\n  override finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0, row; (row = this.rows[i]); i++) {\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks = Math.max(\n        widestRowWithConnectedBlocks,\n        row.widthWithConnectedBlocks,\n      );\n      // Add padding to the bottom row if block height is less than minimum\n      const heightWithoutHat = yCursor - this.topRow.ascenderHeight;\n      if (\n        row === this.bottomRow &&\n        heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT\n      ) {\n        // But the hat height shouldn't be part of this.\n        const diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\n        this.bottomRow.height += diff;\n        yCursor += diff;\n      }\n      this.recordElemPositions_(row);\n    }\n    if (\n      this.outputConnection &&\n      this.block_.nextConnection &&\n      this.block_.nextConnection.isConnected()\n    ) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n          widestRowWithConnectedBlocks,\n          target.getHeightWidth().width - this.constants_.DARK_PATH_OFFSET,\n        );\n      }\n    }\n\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n    this.widthWithChildren =\n      widestRowWithConnectedBlocks +\n      this.startX +\n      this.constants_.DARK_PATH_OFFSET;\n    this.width += this.constants_.DARK_PATH_OFFSET;\n    this.height = yCursor + this.constants_.DARK_PATH_OFFSET;\n    this.startY = this.topRow.capline;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.PathObject\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as colour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport {PathObject as BasePathObject} from '../common/path_object.js';\nimport type {ConstantProvider} from './constants.js';\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n */\nexport class PathObject extends BasePathObject {\n  svgPathDark: SVGElement;\n  svgPathLight: SVGElement;\n\n  /**\n   * The colour of the dark path on the block in '#RRGGBB' format.\n   */\n  colourDark = '#000000';\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   */\n  constructor(\n    root: SVGElement,\n    style: BlockStyle,\n    public override constants: ConstantProvider,\n  ) {\n    super(root, style, constants);\n\n    /** The dark path of the block. */\n    this.svgPathDark = dom.createSvgElement(Svg.PATH, {\n      'class': 'blocklyPathDark',\n      'transform': 'translate(1,1)',\n    });\n    // SVG draw order is based on the order of elements (top most = back most)\n    // So we need to insert the dark path before the base path to make sure it\n    // gets drawn first.\n    this.svgRoot.insertBefore(this.svgPathDark, this.svgPath);\n\n    /** The light path of the block. */\n    this.svgPathLight = dom.createSvgElement(\n      Svg.PATH,\n      {'class': 'blocklyPathLight'},\n      this.svgRoot,\n    );\n  }\n\n  override setPath(mainPath: string) {\n    this.svgPath.setAttribute('d', mainPath);\n    this.svgPathDark.setAttribute('d', mainPath);\n  }\n\n  /**\n   * Set the highlight path generated by the renderer onto the SVG element.\n   *\n   * @param highlightPath The highlight path.\n   */\n  setHighlightPath(highlightPath: string) {\n    this.svgPathLight.setAttribute('d', highlightPath);\n  }\n\n  override flipRTL() {\n    // Mirror the block's path.\n    this.svgPath.setAttribute('transform', 'scale(-1 1)');\n    this.svgPathLight.setAttribute('transform', 'scale(-1 1)');\n    this.svgPathDark.setAttribute('transform', 'translate(1,1) scale(-1 1)');\n  }\n\n  override applyColour(block: BlockSvg) {\n    this.svgPathLight.style.display = '';\n    this.svgPathDark.style.display = '';\n    if (!this.style.colourTertiary) {\n      throw new Error(\n        'The renderer did not properly initialize the tertiary colour of ' +\n          'the block style',\n      );\n    }\n    this.svgPathLight.setAttribute('stroke', this.style.colourTertiary);\n    this.svgPathDark.setAttribute('fill', this.colourDark);\n\n    super.applyColour(block);\n\n    this.svgPath.setAttribute('stroke', 'none');\n  }\n\n  override setStyle(blockStyle: BlockStyle) {\n    this.style = blockStyle;\n    this.colourDark =\n      colour.blend('#000', this.style.colourPrimary, 0.2) || this.colourDark;\n  }\n\n  override updateHighlighted(highlighted: boolean) {\n    if (highlighted) {\n      this.svgPath.setAttribute(\n        'filter',\n        'url(#' + this.constants.embossFilterId + ')',\n      );\n      this.svgPathLight.style.display = 'none';\n    } else {\n      this.svgPath.setAttribute('filter', 'none');\n      this.svgPathLight.style.display = 'inline';\n    }\n  }\n\n  override updateShadow_(shadow: boolean) {\n    if (shadow) {\n      this.svgPathLight.style.display = 'none';\n      if (!this.style.colourSecondary) {\n        throw new Error(\n          'The renderer did not properly initialize the secondary colour ' +\n            'of the block style block style',\n        );\n      }\n      this.svgPathDark.setAttribute('fill', this.style.colourSecondary);\n      this.svgPath.setAttribute('stroke', 'none');\n      this.svgPath.setAttribute('fill', this.style.colourSecondary);\n    }\n  }\n\n  override updateDisabled_(disabled: boolean) {\n    super.updateDisabled_(disabled);\n    if (disabled) {\n      this.svgPath.setAttribute('stroke', 'none');\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras.Renderer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {HighlightConstantProvider} from './highlight_constants.js';\nimport {RenderInfo} from './info.js';\nimport {PathObject} from './path_object.js';\n\n/**\n * The geras renderer. This renderer was designed to be backwards compatible\n * with pre-2019 Blockly. Newer projects that are not constrained by backwards\n * compatibility should use thrasos, which is a more modern take on this\n * renderer.\n *\n * Geras is the ancient Greek spirit of old age.\n */\nexport class Renderer extends BaseRenderer {\n  /** The renderer's highlight constant provider. */\n  private highlightConstants: HighlightConstantProvider | null = null;\n\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Initialize the renderer.  Geras has a highlight provider in addition to\n   * the normal constant provider.\n   */\n  override init(\n    theme: Theme,\n    opt_rendererOverrides?: {[rendererConstant: string]: any},\n  ) {\n    super.init(theme, opt_rendererOverrides);\n    this.highlightConstants = this.makeHighlightConstants_();\n    this.highlightConstants.init();\n  }\n\n  override refreshDom(svg: SVGElement, theme: Theme) {\n    super.refreshDom(svg, theme);\n    this.getHighlightConstants().init();\n  }\n\n  override makeConstants_() {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(\n    block: BlockSvg,\n    info: BaseRenderInfo,\n  ): Drawer {\n    return new Drawer(block, info as RenderInfo);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   */\n  override makePathObject(root: SVGElement, style: BlockStyle): PathObject {\n    return new PathObject(root, style, this.getConstants() as ConstantProvider);\n  }\n\n  /**\n   * Create a new instance of the renderer's highlight constant provider.\n   *\n   * @returns The highlight constant provider.\n   */\n  protected makeHighlightConstants_(): HighlightConstantProvider {\n    return new HighlightConstantProvider(this.getConstants());\n  }\n\n  /**\n   * Get the renderer's highlight constant provider.  We assume that when this\n   * is called, the renderer has already been initialized.\n   *\n   * @returns The highlight constant provider.\n   */\n  getHighlightConstants(): HighlightConstantProvider {\n    if (!this.highlightConstants) {\n      throw new Error(\n        'Cannot access the highlight constants because init has not ' +\n          'been called',\n      );\n    }\n    return this.highlightConstants;\n  }\n}\n\nblockRendering.register('geras', Renderer);\n", "/** @file Re-exports of Blockly.geras.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.geras\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {HighlightConstantProvider} from './highlight_constants.js';\nimport {Highlighter} from './highlighter.js';\nimport {RenderInfo} from './info.js';\nimport {InlineInput} from './measurables/inline_input.js';\nimport {StatementInput} from './measurables/statement_input.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\nexport {\n  ConstantProvider,\n  Drawer,\n  HighlightConstantProvider,\n  Highlighter,\n  InlineInput,\n  PathObject,\n  Renderer,\n  RenderInfo,\n  StatementInput,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.thrasos.RenderInfo\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport type {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport type {Row} from '../measurables/row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\nimport type {Renderer} from './renderer.js';\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // Exclamation is fine b/c this is assigned by the super constructor.\n  protected override renderer_!: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  override addElemSpacing_() {\n    let hasExternalInputs = false;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      if (row.hasExternalInput) {\n        hasExternalInputs = true;\n        break;\n      }\n    }\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(\n          new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(null, oldElems[0]),\n          ),\n        );\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        let spacing = this.getInRowSpacing_(\n          oldElems[oldElems.length - 1],\n          null,\n        );\n        if (hasExternalInputs && row.hasDummyInput) {\n          spacing += this.constants_.TAB_WIDTH;\n        }\n        // There's a spacer after the last element in the row.\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n    }\n  }\n\n  override getInRowSpacing_(prev: Measurable | null, next: Measurable | null) {\n    if (!prev) {\n      // Between an editable field and the beginning of the row.\n      if (next && Types.isField(next) && (next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Inline input at the beginning of the row.\n      if (next && Types.isInlineInput(next)) {\n        return this.constants_.MEDIUM_LARGE_PADDING;\n      }\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n      // Anything else at the beginning of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between a non-input and the end of the row.\n    if (!Types.isInput(prev) && !next) {\n      // Between an editable field and the end of the row.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Padding at the end of an icon-only row to make the block shape clearer.\n      if (Types.isIcon(prev)) {\n        return this.constants_.LARGE_PADDING * 2 + 1;\n      }\n      if (Types.isHat(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Establish a minimum width for a block with a previous or next\n      // connection.\n      if (Types.isPreviousOrNextConnection(prev)) {\n        return this.constants_.LARGE_PADDING;\n      }\n      // Between rounded corner and the end of the row.\n      if (Types.isLeftRoundedCorner(prev)) {\n        return this.constants_.MIN_BLOCK_WIDTH;\n      }\n      // Between a jagged edge and the end of the row.\n      if (Types.isJaggedEdge(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Between noneditable fields and icons and the end of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n    // Between inputs and the end of the row.\n    if (Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a non-input and an input.\n    if (!Types.isInput(prev) && next && Types.isInput(next)) {\n      // Between an editable field and an input.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        }\n      } else {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isStatementInput(next)) {\n          return this.constants_.LARGE_PADDING;\n        }\n      }\n      return this.constants_.LARGE_PADDING - 1;\n    }\n\n    // Spacing between an icon and an icon or field.\n    if (Types.isIcon(prev) && next && !Types.isInput(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between an inline input and a field.\n    if (Types.isInlineInput(prev) && next && Types.isField(next)) {\n      // Editable field after inline input.\n      if ((next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      } else {\n        // Noneditable field after inline input.\n        return this.constants_.LARGE_PADDING;\n      }\n    }\n\n    if (Types.isLeftSquareCorner(prev) && next) {\n      // Spacing between a hat and a corner\n      if (Types.isHat(next)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Spacing between a square corner and a previous or next connection\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset;\n      }\n    }\n    // Spacing between a rounded corner and a previous or next connection.\n    if (Types.isLeftRoundedCorner(prev) && next) {\n      return next.notchOffset - this.constants_.CORNER_RADIUS;\n    }\n\n    // Spacing between two fields of the same editability.\n    if (\n      Types.isField(prev) &&\n      next &&\n      Types.isField(next) &&\n      (prev as Field).isEditable === (next as Field).isEditable\n    ) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between anything and a jagged edge.\n    if (next && Types.isJaggedEdge(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row) {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev) || Types.isBottomRow(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    if (prev.hasExternalInput && next.hasExternalInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasStatement) {\n      return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\n    }\n    if (prev.hasStatement && next.hasStatement) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (prev.hasDummyInput || next.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable) {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n        bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n\n    let result = row.yPos;\n    if (Types.isField(elem) && row.hasStatement) {\n      const offset =\n        this.constants_.TALL_INPUT_FIELD_OFFSET_Y + elem.height / 2;\n      result += offset;\n    } else {\n      result += row.height / 2;\n    }\n    return result;\n  }\n\n  override finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks = Math.max(\n        widestRowWithConnectedBlocks,\n        row.widthWithConnectedBlocks,\n      );\n      // Add padding to the bottom row if block height is less than minimum\n      const heightWithoutHat = yCursor - this.topRow.ascenderHeight;\n      if (\n        row === this.bottomRow &&\n        heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT\n      ) {\n        // But the hat height shouldn't be part of this.\n        const diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\n        this.bottomRow.height += diff;\n        yCursor += diff;\n      }\n      this.recordElemPositions_(row);\n    }\n    if (\n      this.outputConnection &&\n      this.block_.nextConnection &&\n      this.block_.nextConnection.isConnected()\n    ) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n          widestRowWithConnectedBlocks,\n          target.getHeightWidth().width,\n        );\n      }\n    }\n\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\n\n    this.height = yCursor;\n    this.startY = this.topRow.capline;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.thrasos.Renderer\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\nimport {RenderInfo} from './info.js';\n\n/**\n * The thrasos renderer. This is a more modern take on the legacy geras\n * renderer.\n *\n * Thrasos is the ancient Greek spirit of boldness.\n */\nexport class Renderer extends BaseRenderer {\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n}\n\nblockRendering.register('thrasos', Renderer);\n", "/** @file Re-exports of Blockly.thrasos.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.thrasos\n\nimport {RenderInfo} from './info.js';\nimport {Renderer} from './renderer.js';\n\nexport {Renderer, RenderInfo};\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Themes.Zelos\n\nimport {Theme} from '../theme.js';\n\nconst defaultBlockStyles = {\n  'colour_blocks': {\n    'colourPrimary': '#CF63CF',\n    'colourSecondary': '#C94FC9',\n    'colourTertiary': '#BD42BD',\n  },\n  'list_blocks': {\n    'colourPrimary': '#9966FF',\n    'colourSecondary': '#855CD6',\n    'colourTertiary': '#774DCB',\n  },\n  'logic_blocks': {\n    'colourPrimary': '#4C97FF',\n    'colourSecondary': '#4280D7',\n    'colourTertiary': '#3373CC',\n  },\n  'loop_blocks': {\n    'colourPrimary': '#0fBD8C',\n    'colourSecondary': '#0DA57A',\n    'colourTertiary': '#0B8E69',\n  },\n  'math_blocks': {\n    'colourPrimary': '#59C059',\n    'colourSecondary': '#46B946',\n    'colourTertiary': '#389438',\n  },\n  'procedure_blocks': {\n    'colourPrimary': '#FF6680',\n    'colourSecondary': '#FF4D6A',\n    'colourTertiary': '#FF3355',\n  },\n  'text_blocks': {\n    'colourPrimary': '#FFBF00',\n    'colourSecondary': '#E6AC00',\n    'colourTertiary': '#CC9900',\n  },\n  'variable_blocks': {\n    'colourPrimary': '#FF8C1A',\n    'colourSecondary': '#FF8000',\n    'colourTertiary': '#DB6E00',\n  },\n  'variable_dynamic_blocks': {\n    'colourPrimary': '#FF8C1A',\n    'colourSecondary': '#FF8000',\n    'colourTertiary': '#DB6E00',\n  },\n  'hat_blocks': {\n    'colourPrimary': '#4C97FF',\n    'colourSecondary': '#4280D7',\n    'colourTertiary': '#3373CC',\n    'hat': 'cap',\n  },\n};\n\nconst categoryStyles = {\n  'colour_category': {'colour': '#CF63CF'},\n  'list_category': {'colour': '#9966FF'},\n  'logic_category': {'colour': '#4C97FF'},\n  'loop_category': {'colour': '#0fBD8C'},\n  'math_category': {'colour': '#59C059'},\n  'procedure_category': {'colour': '#FF6680'},\n  'text_category': {'colour': '#FFBF00'},\n  'variable_category': {'colour': '#FF8C1A'},\n  'variable_dynamic_category': {'colour': '#FF8C1A'},\n};\n\n/**\n * Zelos theme.\n */\nexport const Zelos = new Theme('zelos', defaultBlockStyles, categoryStyles);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.Themes\n\nimport {Classic} from './classic.js';\nimport {Zelos} from './zelos.js';\n\nexport {Classic, Zelos};\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An item in the toolbox.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ToolboxItem\n\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport type * as toolbox from '../utils/toolbox.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\n/**\n * Class for an item in the toolbox.\n */\nexport class ToolboxItem implements IToolboxItem {\n  protected id_: string;\n  protected parent_: ICollapsibleToolboxItem | null;\n  protected level_: number;\n  protected toolboxItemDef_: toolbox.ToolboxItemInfo | null;\n  protected workspace_: WorkspaceSvg;\n  /** The toolbox this category belongs to. */\n  protected readonly parentToolbox_: IToolbox;\n\n  /**\n   * @param toolboxItemDef The JSON defining the toolbox item.\n   * @param parentToolbox The toolbox that holds the toolbox item.\n   * @param opt_parent The parent toolbox item or null if the category does not\n   *     have a parent.\n   */\n  constructor(\n    toolboxItemDef: toolbox.ToolboxItemInfo,\n    parentToolbox: IToolbox,\n    opt_parent?: ICollapsibleToolboxItem,\n  ) {\n    /** The ID for the category. */\n    this.id_ =\n      (toolboxItemDef as AnyDuringMigration)['toolboxitemid'] ||\n      idGenerator.getNextUniqueId();\n\n    /** The parent of the category. */\n    this.parent_ = opt_parent || null;\n\n    /** The level that the category is nested at. */\n    this.level_ = this.parent_ ? this.parent_.getLevel() + 1 : 0;\n\n    /** The JSON definition of the toolbox item. */\n    this.toolboxItemDef_ = toolboxItemDef;\n\n    this.parentToolbox_ = parentToolbox;\n\n    /** The workspace of the parent toolbox. */\n    this.workspace_ = this.parentToolbox_.getWorkspace();\n  }\n\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   */\n  init() {}\n  // No-op by default.\n\n  /**\n   * Gets the div for the toolbox item.\n   *\n   * @returns The div for the toolbox item.\n   */\n  getDiv(): Element | null {\n    return null;\n  }\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks, or null if this item should\n   *     not receive clicks.\n   */\n  getClickTarget(): Element | null {\n    return null;\n  }\n\n  /**\n   * Gets a unique identifier for this toolbox item.\n   *\n   * @returns The ID for the toolbox item.\n   */\n  getId(): string {\n    return this.id_;\n  }\n\n  /**\n   * Gets the parent if the toolbox item is nested.\n   *\n   * @returns The parent toolbox item, or null if this toolbox item is not\n   *     nested.\n   */\n  getParent(): ICollapsibleToolboxItem | null {\n    return null;\n  }\n\n  /**\n   * Gets the nested level of the category.\n   *\n   * @returns The nested level of the category.\n   * @internal\n   */\n  getLevel(): number {\n    return this.level_;\n  }\n\n  /**\n   * Whether the toolbox item is selectable.\n   *\n   * @returns True if the toolbox item can be selected.\n   */\n  isSelectable(): boolean {\n    return false;\n  }\n\n  /**\n   * Whether the toolbox item is collapsible.\n   *\n   * @returns True if the toolbox item is collapsible.\n   */\n  isCollapsible(): boolean {\n    return false;\n  }\n\n  /** Dispose of this toolbox item. No-op by default. */\n  dispose() {}\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param _isVisible True if category should be visible.\n   */\n  setVisible_(_isVisible: boolean) {}\n}\n// nop by default\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A toolbox category used to organize blocks in the toolbox.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ToolboxCategory\n\nimport * as Css from '../css.js';\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {ISelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport * as registry from '../registry.js';\nimport * as aria from '../utils/aria.js';\nimport * as colourUtils from '../utils/colour.js';\nimport * as dom from '../utils/dom.js';\nimport * as parsing from '../utils/parsing.js';\nimport type {\n  CategoryInfo,\n  DynamicCategoryInfo,\n  FlyoutDefinition,\n  FlyoutItemInfo,\n  FlyoutItemInfoArray,\n  StaticCategoryInfo,\n} from '../utils/toolbox.js';\nimport * as toolbox from '../utils/toolbox.js';\nimport {ToolboxItem} from './toolbox_item.js';\n\n/**\n * Class for a category in a toolbox.\n */\nexport class ToolboxCategory\n  extends ToolboxItem\n  implements ISelectableToolboxItem\n{\n  /** Name used for registering a toolbox category. */\n  static registrationName = 'category';\n\n  /** The number of pixels to move the category over at each nested level. */\n  static nestedPadding = 19;\n\n  /** The width in pixels of the strip of colour next to each category. */\n  static borderWidth = 8;\n\n  /**\n   * The default colour of the category. This is used as the background colour\n   * of the category when it is selected.\n   */\n  static defaultBackgroundColour = '#57e';\n\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override toolboxItemDef_!: CategoryInfo;\n\n  /** The name that will be displayed on the category. */\n  protected name_ = '';\n\n  /** The colour of the category. */\n  protected colour_ = '';\n\n  /** The HTML container for the category. */\n  protected htmlDiv_: HTMLDivElement | null = null;\n\n  /** The HTML element for the category row. */\n  protected rowDiv_: HTMLDivElement | null = null;\n\n  /** The HTML element that holds children elements of the category row. */\n  protected rowContents_: HTMLDivElement | null = null;\n\n  /** The HTML element for the toolbox icon. */\n  protected iconDom_: Element | null = null;\n\n  /** The HTML element for the toolbox label. */\n  protected labelDom_: Element | null = null;\n  protected cssConfig_: CssConfig;\n\n  /** True if the category is meant to be hidden, false otherwise. */\n  protected isHidden_ = false;\n\n  /** True if this category is disabled, false otherwise. */\n  protected isDisabled_ = false;\n\n  /** The flyout items for this category. */\n  protected flyoutItems_: string | FlyoutItemInfoArray = [];\n\n  /**\n   * @param categoryDef The information needed to create a category in the\n   *     toolbox.\n   * @param parentToolbox The parent toolbox for the category.\n   * @param opt_parent The parent category or null if the category does not have\n   *     a parent.\n   */\n  constructor(\n    categoryDef: CategoryInfo,\n    parentToolbox: IToolbox,\n    opt_parent?: ICollapsibleToolboxItem,\n  ) {\n    super(categoryDef, parentToolbox, opt_parent);\n\n    /** All the css class names that are used to create a category. */\n    this.cssConfig_ = this.makeDefaultCssConfig_();\n  }\n\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   * Init should be called immediately after the construction of the toolbox\n   * item, to ensure that the category contents are properly parsed.\n   */\n  override init() {\n    this.parseCategoryDef_(this.toolboxItemDef_);\n    this.parseContents_(this.toolboxItemDef_);\n    this.createDom_();\n    if (this.toolboxItemDef_['hidden'] === 'true') {\n      this.hide();\n    }\n  }\n\n  /**\n   * Creates an object holding the default classes for a category.\n   *\n   * @returns The configuration object holding all the CSS classes for a\n   *     category.\n   */\n  protected makeDefaultCssConfig_(): CssConfig {\n    return {\n      'container': 'blocklyToolboxCategory',\n      'row': 'blocklyTreeRow',\n      'rowcontentcontainer': 'blocklyTreeRowContentContainer',\n      'icon': 'blocklyTreeIcon',\n      'label': 'blocklyTreeLabel',\n      'contents': 'blocklyToolboxContents',\n      'selected': 'blocklyTreeSelected',\n      'openicon': 'blocklyTreeIconOpen',\n      'closedicon': 'blocklyTreeIconClosed',\n    };\n  }\n\n  /**\n   * Parses the contents array depending on if the category is a dynamic\n   * category, or if its contents are meant to be shown in the flyout.\n   *\n   * @param categoryDef The information needed to create a category.\n   */\n  protected parseContents_(categoryDef: CategoryInfo) {\n    if ('custom' in categoryDef) {\n      this.flyoutItems_ = categoryDef['custom'];\n    } else {\n      const contents = categoryDef['contents'];\n      if (!contents) return;\n\n      for (let i = 0; i < contents.length; i++) {\n        const itemDef = contents[i];\n        const flyoutItem = itemDef as FlyoutItemInfo;\n        if (Array.isArray(this.flyoutItems_)) {\n          this.flyoutItems_.push(flyoutItem);\n        }\n      }\n    }\n  }\n\n  /**\n   * Parses the non-contents parts of the category def.\n   *\n   * @param categoryDef The information needed to create a category.\n   */\n  protected parseCategoryDef_(categoryDef: CategoryInfo) {\n    this.name_ =\n      'name' in categoryDef\n        ? parsing.replaceMessageReferences(categoryDef['name'])\n        : '';\n    this.colour_ = this.getColour_(categoryDef);\n    Object.assign(\n      this.cssConfig_,\n      categoryDef['cssconfig'] || (categoryDef as any)['cssConfig'],\n    );\n  }\n\n  /**\n   * Creates the DOM for the category.\n   *\n   * @returns The parent element for the category.\n   */\n  protected createDom_(): HTMLDivElement {\n    this.htmlDiv_ = this.createContainer_();\n    aria.setRole(this.htmlDiv_, aria.Role.TREEITEM);\n    aria.setState(this.htmlDiv_, aria.State.SELECTED, false);\n    aria.setState(this.htmlDiv_, aria.State.LEVEL, this.level_ + 1);\n\n    this.rowDiv_ = this.createRowContainer_();\n    this.rowDiv_.style.pointerEvents = 'auto';\n    this.htmlDiv_.appendChild(this.rowDiv_);\n\n    this.rowContents_ = this.createRowContentsContainer_();\n    this.rowContents_.style.pointerEvents = 'none';\n    this.rowDiv_.appendChild(this.rowContents_);\n\n    this.iconDom_ = this.createIconDom_();\n    aria.setRole(this.iconDom_, aria.Role.PRESENTATION);\n    this.rowContents_.appendChild(this.iconDom_);\n\n    this.labelDom_ = this.createLabelDom_(this.name_);\n    this.rowContents_.appendChild(this.labelDom_);\n\n    const id = this.labelDom_.getAttribute('id');\n    if (id) {\n      aria.setState(this.htmlDiv_, aria.State.LABELLEDBY, id);\n    }\n\n    this.addColourBorder_(this.colour_);\n\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Creates the container that holds the row and any subcategories.\n   *\n   * @returns The div that holds the icon and the label.\n   */\n  protected createContainer_(): HTMLDivElement {\n    const container = document.createElement('div');\n    const className = this.cssConfig_['container'];\n    if (className) {\n      dom.addClass(container, className);\n    }\n    return container;\n  }\n\n  /**\n   * Creates the parent of the contents container. All clicks will happen on\n   * this div.\n   *\n   * @returns The div that holds the contents container.\n   */\n  protected createRowContainer_(): HTMLDivElement {\n    const rowDiv = document.createElement('div');\n    const className = this.cssConfig_['row'];\n    if (className) {\n      dom.addClass(rowDiv, className);\n    }\n    const nestedPadding = `${\n      ToolboxCategory.nestedPadding * this.getLevel()\n    }px`;\n    if (this.workspace_.RTL) {\n      rowDiv.style.paddingRight = nestedPadding;\n    } else {\n      rowDiv.style.paddingLeft = nestedPadding;\n    }\n    return rowDiv;\n  }\n\n  /**\n   * Creates the container for the label and icon.\n   * This is necessary so we can set all subcategory pointer events to none.\n   *\n   * @returns The div that holds the icon and the label.\n   */\n  protected createRowContentsContainer_(): HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    const className = this.cssConfig_['rowcontentcontainer'];\n    if (className) {\n      dom.addClass(contentsContainer, className);\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Creates the span that holds the category icon.\n   *\n   * @returns The span that holds the category icon.\n   */\n  protected createIconDom_(): Element {\n    const toolboxIcon = document.createElement('span');\n    if (!this.parentToolbox_.isHorizontal()) {\n      const className = this.cssConfig_['icon'];\n      if (className) {\n        dom.addClass(toolboxIcon, className);\n      }\n    }\n\n    toolboxIcon.style.display = 'inline-block';\n    return toolboxIcon;\n  }\n\n  /**\n   * Creates the span that holds the category label.\n   * This should have an ID for accessibility purposes.\n   *\n   * @param name The name of the category.\n   * @returns The span that holds the category label.\n   */\n  protected createLabelDom_(name: string): Element {\n    const toolboxLabel = document.createElement('span');\n    toolboxLabel.setAttribute('id', this.getId() + '.label');\n    toolboxLabel.textContent = name;\n    const className = this.cssConfig_['label'];\n    if (className) {\n      dom.addClass(toolboxLabel, className);\n    }\n    return toolboxLabel;\n  }\n\n  /** Updates the colour for this category. */\n  refreshTheme() {\n    this.colour_ = this.getColour_(this.toolboxItemDef_);\n    this.addColourBorder_(this.colour_);\n  }\n\n  /**\n   * Add the strip of colour to the toolbox category.\n   *\n   * @param colour The category colour.\n   */\n  protected addColourBorder_(colour: string) {\n    if (colour) {\n      const border =\n        ToolboxCategory.borderWidth + 'px solid ' + (colour || '#ddd');\n      if (this.workspace_.RTL) {\n        this.rowDiv_!.style.borderRight = border;\n      } else {\n        this.rowDiv_!.style.borderLeft = border;\n      }\n    }\n  }\n\n  /**\n   * Gets either the colour or the style for a category.\n   *\n   * @param categoryDef The object holding information on the category.\n   * @returns The hex colour for the category.\n   */\n  protected getColour_(categoryDef: CategoryInfo): string {\n    const styleName =\n      categoryDef['categorystyle'] || (categoryDef as any)['categoryStyle'];\n    const colour = categoryDef['colour'];\n\n    if (colour && styleName) {\n      console.warn(\n        'Toolbox category \"' +\n          this.name_ +\n          '\" must not have both a style and a colour',\n      );\n    } else if (styleName) {\n      return this.getColourfromStyle(styleName);\n    } else if (colour) {\n      return this.parseColour(colour);\n    }\n    return '';\n  }\n\n  /**\n   * Sets the colour for the category using the style name and returns the new\n   * colour as a hex string.\n   *\n   * @param styleName Name of the style.\n   * @returns The hex colour for the category.\n   */\n  private getColourfromStyle(styleName: string): string {\n    const theme = this.workspace_.getTheme();\n    if (styleName && theme) {\n      const style = theme.categoryStyles[styleName];\n      if (style && style.colour) {\n        return this.parseColour(style.colour);\n      } else {\n        console.warn(\n          'Style \"' + styleName + '\" must exist and contain a colour value',\n        );\n      }\n    }\n    return '';\n  }\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks.\n   */\n  override getClickTarget(): Element {\n    return this.rowDiv_ as Element;\n  }\n\n  /**\n   * Parses the colour on the category.\n   *\n   * @param colourValue HSV hue value (0 to 360), #RRGGBB string, or a message\n   *     reference string pointing to one of those two values.\n   * @returns The hex colour for the category.\n   */\n  private parseColour(colourValue: number | string): string {\n    // Decode the colour for any potential message references\n    // (eg. `%{BKY_MATH_HUE}`).\n    const colour = parsing.replaceMessageReferences(colourValue);\n    if (colour == null || colour === '') {\n      // No attribute. No colour.\n      return '';\n    } else {\n      const hue = Number(colour);\n      if (!isNaN(hue)) {\n        return colourUtils.hueToHex(hue);\n      } else {\n        const hex = colourUtils.parse(colour);\n        if (hex) {\n          return hex;\n        } else {\n          console.warn(\n            'Toolbox category \"' +\n              this.name_ +\n              '\" has unrecognized colour attribute: ' +\n              colour,\n          );\n          return '';\n        }\n      }\n    }\n  }\n\n  /**\n   * Adds appropriate classes to display an open icon.\n   *\n   * @param iconDiv The div that holds the icon.\n   */\n  protected openIcon_(iconDiv: Element | null) {\n    if (!iconDiv) {\n      return;\n    }\n    const closedIconClass = this.cssConfig_['closedicon'];\n    if (closedIconClass) {\n      dom.removeClasses(iconDiv, closedIconClass);\n    }\n    const className = this.cssConfig_['openicon'];\n    if (className) {\n      dom.addClass(iconDiv, className);\n    }\n  }\n\n  /**\n   * Adds appropriate classes to display a closed icon.\n   *\n   * @param iconDiv The div that holds the icon.\n   */\n  protected closeIcon_(iconDiv: Element | null) {\n    if (!iconDiv) {\n      return;\n    }\n    const openIconClass = this.cssConfig_['openicon'];\n    if (openIconClass) {\n      dom.removeClasses(iconDiv, openIconClass);\n    }\n    const className = this.cssConfig_['closedicon'];\n    if (className) {\n      dom.addClass(iconDiv, className);\n    }\n  }\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param isVisible True if category should be visible.\n   */\n  override setVisible_(isVisible: boolean) {\n    this.htmlDiv_!.style.display = isVisible ? 'block' : 'none';\n    this.isHidden_ = !isVisible;\n\n    if (this.parentToolbox_.getSelectedItem() === this) {\n      this.parentToolbox_.clearSelection();\n    }\n  }\n\n  /** Hide the category. */\n  hide() {\n    this.setVisible_(false);\n  }\n\n  /**\n   * Show the category. Category will only appear if its parent category is also\n   * expanded.\n   */\n  show() {\n    this.setVisible_(true);\n  }\n\n  /**\n   * Whether the category is visible.\n   * A category is only visible if all of its ancestors are expanded and\n   * isHidden_ is false.\n   *\n   * @returns True if the category is visible, false otherwise.\n   */\n  isVisible(): boolean {\n    return !this.isHidden_ && this.allAncestorsExpanded_();\n  }\n\n  /**\n   * Whether all ancestors of a category (parent and parent's parent, etc.) are\n   * expanded.\n   *\n   * @returns True only if every ancestor is expanded\n   */\n  protected allAncestorsExpanded_(): boolean {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let category: IToolboxItem = this;\n    while (category.getParent()) {\n      category = category.getParent()!;\n      if (!(category as ICollapsibleToolboxItem).isExpanded()) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  override isSelectable() {\n    return this.isVisible() && !this.isDisabled_;\n  }\n\n  /**\n   * Handles when the toolbox item is clicked.\n   *\n   * @param _e Click event to handle.\n   */\n  onClick(_e: Event) {}\n  // No-op\n\n  /**\n   * Sets the current category as selected.\n   *\n   * @param isSelected True if this category is selected, false otherwise.\n   */\n  setSelected(isSelected: boolean) {\n    if (!this.rowDiv_) {\n      return;\n    }\n    const className = this.cssConfig_['selected'];\n    if (isSelected) {\n      const defaultColour = this.parseColour(\n        ToolboxCategory.defaultBackgroundColour,\n      );\n      this.rowDiv_.style.backgroundColor = this.colour_ || defaultColour;\n      if (className) {\n        dom.addClass(this.rowDiv_, className);\n      }\n    } else {\n      this.rowDiv_.style.backgroundColor = '';\n      if (className) {\n        dom.removeClass(this.rowDiv_, className);\n      }\n    }\n    aria.setState(this.htmlDiv_ as Element, aria.State.SELECTED, isSelected);\n  }\n\n  /**\n   * Sets whether the category is disabled.\n   *\n   * @param isDisabled True to disable the category, false otherwise.\n   */\n  setDisabled(isDisabled: boolean) {\n    this.isDisabled_ = isDisabled;\n    this.getDiv()!.setAttribute('disabled', `${isDisabled}`);\n    if (isDisabled) {\n      this.getDiv()!.setAttribute('disabled', 'true');\n    } else {\n      this.getDiv()!.removeAttribute('disabled');\n    }\n  }\n\n  /**\n   * Gets the name of the category. Used for emitting events.\n   *\n   * @returns The name of the toolbox item.\n   */\n  getName(): string {\n    return this.name_;\n  }\n\n  override getParent() {\n    return this.parent_;\n  }\n\n  override getDiv() {\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Gets the contents of the category. These are items that are meant to be\n   * displayed in the flyout.\n   *\n   * @returns The definition of items to be displayed in the flyout.\n   */\n  getContents(): FlyoutItemInfoArray | string {\n    return this.flyoutItems_;\n  }\n\n  /**\n   * Updates the contents to be displayed in the flyout.\n   * If the flyout is open when the contents are updated, refreshSelection on\n   * the toolbox must also be called.\n   *\n   * @param contents The contents to be displayed in the flyout. A string can be\n   *     supplied to create a dynamic category.\n   */\n  updateFlyoutContents(contents: FlyoutDefinition | string) {\n    this.flyoutItems_ = [];\n\n    if (typeof contents === 'string') {\n      const newDefinition: DynamicCategoryInfo = {\n        kind: this.toolboxItemDef_.kind,\n        custom: contents,\n        id: this.toolboxItemDef_.id,\n        categorystyle: this.toolboxItemDef_.categorystyle,\n        colour: this.toolboxItemDef_.colour,\n        cssconfig: this.toolboxItemDef_.cssconfig,\n        hidden: this.toolboxItemDef_.hidden,\n      };\n      this.toolboxItemDef_ = newDefinition;\n    } else {\n      const newDefinition: StaticCategoryInfo = {\n        kind: this.toolboxItemDef_.kind,\n        name:\n          'name' in this.toolboxItemDef_ ? this.toolboxItemDef_['name'] : '',\n        contents: toolbox.convertFlyoutDefToJsonArray(contents),\n        id: this.toolboxItemDef_.id,\n        categorystyle: this.toolboxItemDef_.categorystyle,\n        colour: this.toolboxItemDef_.colour,\n        cssconfig: this.toolboxItemDef_.cssconfig,\n        hidden: this.toolboxItemDef_.hidden,\n      };\n      this.toolboxItemDef_ = newDefinition;\n    }\n    this.parseContents_(this.toolboxItemDef_);\n  }\n\n  override dispose() {\n    dom.removeNode(this.htmlDiv_);\n  }\n}\n\nexport namespace ToolboxCategory {\n  /** All the CSS class names that are used to create a category. */\n  export interface CssConfig {\n    container?: string;\n    row?: string;\n    rowcontentcontainer?: string;\n    icon?: string;\n    label?: string;\n    contents?: string;\n    selected?: string;\n    openicon?: string;\n    closedicon?: string;\n  }\n}\n\nexport type CssConfig = ToolboxCategory.CssConfig;\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyTreeRow:not(.blocklyTreeSelected):hover {\n  background-color: rgba(255, 255, 255, .2);\n}\n\n.blocklyToolboxDiv[layout=\"h\"] .blocklyToolboxCategory {\n  margin: 1px 5px 1px 0;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"][layout=\"h\"] .blocklyToolboxCategory {\n  margin: 1px 0 1px 5px;\n}\n\n.blocklyTreeRow {\n  height: 22px;\n  line-height: 22px;\n  margin-bottom: 3px;\n  padding-right: 8px;\n  white-space: nowrap;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeRow {\n  margin-left: 8px;\n  padding-right: 0;\n}\n\n.blocklyTreeIcon {\n  background-image: url(<<<PATH>>>/sprites.png);\n  height: 16px;\n  vertical-align: middle;\n  visibility: hidden;\n  width: 16px;\n}\n\n.blocklyTreeIconClosed {\n  background-position: -32px -1px;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeIconClosed {\n  background-position: 0 -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: -32px -17px;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: 0 -17px;\n}\n\n.blocklyTreeIconOpen {\n  background-position: -16px -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconOpen {\n  background-position: -16px -17px;\n}\n\n.blocklyTreeLabel {\n  cursor: default;\n  font: 16px sans-serif;\n  padding: 0 3px;\n  vertical-align: middle;\n}\n\n.blocklyToolboxDelete .blocklyTreeLabel {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyTreeSelected .blocklyTreeLabel {\n  color: #fff;\n}\n`);\n\nregistry.register(\n  registry.Type.TOOLBOX_ITEM,\n  ToolboxCategory.registrationName,\n  ToolboxCategory,\n);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A separator used for separating toolbox categories.\n *\n * @class\n */\n// Former goog.module ID: Blockly.ToolboxSeparator\n\nimport * as Css from '../css.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport * as registry from '../registry.js';\nimport * as dom from '../utils/dom.js';\nimport type * as toolbox from '../utils/toolbox.js';\nimport {ToolboxItem} from './toolbox_item.js';\n\n/**\n * Class for a toolbox separator. This is the thin visual line that appears on\n * the toolbox. This item is not interactable.\n */\nexport class ToolboxSeparator extends ToolboxItem {\n  /** Name used for registering a toolbox separator. */\n  static registrationName = 'sep';\n\n  /** All the CSS class names that are used to create a separator. */\n  protected cssConfig_: CssConfig = {'container': 'blocklyTreeSeparator'};\n\n  private htmlDiv: HTMLDivElement | null = null;\n\n  /**\n   * @param separatorDef The information needed to create a separator.\n   * @param toolbox The parent toolbox for the separator.\n   */\n  constructor(separatorDef: toolbox.SeparatorInfo, toolbox: IToolbox) {\n    super(separatorDef, toolbox);\n\n    const cssConfig =\n      separatorDef['cssconfig'] || (separatorDef as any)['cssConfig'];\n    Object.assign(this.cssConfig_, cssConfig);\n  }\n\n  override init() {\n    this.createDom_();\n  }\n\n  /**\n   * Creates the DOM for a separator.\n   *\n   * @returns The parent element for the separator.\n   */\n  protected createDom_(): HTMLDivElement {\n    const container = document.createElement('div');\n    const className = this.cssConfig_['container'];\n    if (className) {\n      dom.addClass(container, className);\n    }\n    this.htmlDiv = container;\n    return container;\n  }\n\n  override getDiv() {\n    return this.htmlDiv as HTMLDivElement;\n  }\n\n  override dispose() {\n    dom.removeNode(this.htmlDiv as HTMLDivElement);\n  }\n}\n\nexport namespace ToolboxSeparator {\n  export interface CssConfig {\n    container: string | undefined;\n  }\n}\n\nexport type CssConfig = ToolboxSeparator.CssConfig;\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyTreeSeparator {\n  border-bottom: solid #e5e5e5 1px;\n  height: 0;\n  margin: 5px 0;\n}\n\n.blocklyToolboxDiv[layout=\"h\"] .blocklyTreeSeparator {\n  border-right: solid #e5e5e5 1px;\n  border-bottom: none;\n  height: auto;\n  margin: 0 5px 0 5px;\n  padding: 5px 0;\n  width: 0;\n}\n`);\n\nregistry.register(\n  registry.Type.TOOLBOX_ITEM,\n  ToolboxSeparator.registrationName,\n  ToolboxSeparator,\n);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A toolbox category used to organize blocks in the toolbox.\n *\n * @class\n */\n// Former goog.module ID: Blockly.CollapsibleToolboxCategory\n\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport * as registry from '../registry.js';\nimport * as aria from '../utils/aria.js';\nimport * as dom from '../utils/dom.js';\nimport * as toolbox from '../utils/toolbox.js';\nimport {ToolboxCategory} from './category.js';\nimport {ToolboxSeparator} from './separator.js';\n\n/**\n * Class for a category in a toolbox that can be collapsed.\n */\nexport class CollapsibleToolboxCategory\n  extends ToolboxCategory\n  implements ICollapsibleToolboxItem\n{\n  /** Name used for registering a collapsible toolbox category. */\n  static override registrationName = 'collapsibleCategory';\n\n  /** Container for any child categories. */\n  protected subcategoriesDiv_: HTMLDivElement | null = null;\n\n  /** Whether or not the category should display its subcategories. */\n  protected expanded_ = false;\n\n  /** The child toolbox items for this category. */\n  protected toolboxItems_: IToolboxItem[] = [];\n\n  /**\n   * @param categoryDef The information needed to create a category in the\n   *     toolbox.\n   * @param toolbox The parent toolbox for the category.\n   * @param opt_parent The parent category or null if the category does not have\n   *     a parent.\n   */\n  constructor(\n    categoryDef: toolbox.CategoryInfo,\n    toolbox: IToolbox,\n    opt_parent?: ICollapsibleToolboxItem,\n  ) {\n    super(categoryDef, toolbox, opt_parent);\n  }\n\n  override makeDefaultCssConfig_() {\n    const cssConfig = super.makeDefaultCssConfig_();\n    cssConfig['contents'] = 'blocklyToolboxContents';\n    return cssConfig;\n  }\n\n  override parseContents_(categoryDef: toolbox.CategoryInfo) {\n    if ('custom' in categoryDef) {\n      this.flyoutItems_ = categoryDef['custom'];\n    } else {\n      const contents = categoryDef['contents'];\n      if (!contents) return;\n      this.flyoutItems_ = [];\n      let prevIsFlyoutItem = true;\n      for (let i = 0; i < contents.length; i++) {\n        const itemDef = contents[i];\n        // Separators can exist as either a flyout item or a toolbox item so\n        // decide where it goes based on the type of the previous item.\n        if (\n          !registry.hasItem(registry.Type.TOOLBOX_ITEM, itemDef['kind']) ||\n          (itemDef['kind'].toLowerCase() ===\n            ToolboxSeparator.registrationName &&\n            prevIsFlyoutItem)\n        ) {\n          const flyoutItem = itemDef as toolbox.FlyoutItemInfo;\n          this.flyoutItems_.push(flyoutItem);\n          prevIsFlyoutItem = true;\n        } else {\n          this.createToolboxItem(itemDef);\n          prevIsFlyoutItem = false;\n        }\n      }\n    }\n  }\n\n  /**\n   * Creates a toolbox item and adds it to the list of toolbox items.\n   *\n   * @param itemDef The information needed to create a toolbox item.\n   */\n  private createToolboxItem(itemDef: toolbox.ToolboxItemInfo) {\n    let registryName = itemDef['kind'];\n    const categoryDef = itemDef as toolbox.CategoryInfo;\n    // Categories that are collapsible are created using a class registered\n    // under a different name.\n    if (\n      registryName.toUpperCase() === 'CATEGORY' &&\n      toolbox.isCategoryCollapsible(categoryDef)\n    ) {\n      registryName = CollapsibleToolboxCategory.registrationName;\n    }\n    const ToolboxItemClass = registry.getClass(\n      registry.Type.TOOLBOX_ITEM,\n      registryName,\n    );\n    const toolboxItem = new ToolboxItemClass!(\n      itemDef,\n      this.parentToolbox_,\n      this,\n    );\n    this.toolboxItems_.push(toolboxItem);\n  }\n\n  override init() {\n    super.init();\n\n    this.setExpanded(\n      this.toolboxItemDef_['expanded'] === 'true' ||\n        this.toolboxItemDef_['expanded'] === true,\n    );\n  }\n\n  override createDom_() {\n    super.createDom_();\n\n    const subCategories = this.getChildToolboxItems();\n    this.subcategoriesDiv_ = this.createSubCategoriesDom_(subCategories);\n    aria.setRole(this.subcategoriesDiv_, aria.Role.GROUP);\n    this.htmlDiv_!.appendChild(this.subcategoriesDiv_);\n    this.closeIcon_(this.iconDom_);\n    aria.setState(this.htmlDiv_ as HTMLDivElement, aria.State.EXPANDED, false);\n\n    return this.htmlDiv_!;\n  }\n\n  override createIconDom_() {\n    const toolboxIcon = document.createElement('span');\n    if (!this.parentToolbox_.isHorizontal()) {\n      const className = this.cssConfig_['icon'];\n      if (className) {\n        dom.addClass(toolboxIcon, className);\n      }\n      toolboxIcon.style.visibility = 'visible';\n    }\n\n    toolboxIcon.style.display = 'inline-block';\n    return toolboxIcon;\n  }\n\n  /**\n   * Create the DOM for all subcategories.\n   *\n   * @param subcategories The subcategories.\n   * @returns The div holding all the subcategories.\n   */\n  protected createSubCategoriesDom_(\n    subcategories: IToolboxItem[],\n  ): HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    contentsContainer.style.display = 'none';\n    const className = this.cssConfig_['contents'];\n    if (className) {\n      dom.addClass(contentsContainer, className);\n    }\n\n    for (let i = 0; i < subcategories.length; i++) {\n      const newCategory = subcategories[i];\n      newCategory.init();\n      const newCategoryDiv = newCategory.getDiv();\n      contentsContainer.appendChild(newCategoryDiv!);\n      if (newCategory.getClickTarget) {\n        newCategory.getClickTarget()?.setAttribute('id', newCategory.getId());\n      }\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Opens or closes the current category and the associated flyout.\n   *\n   * @param isExpanded True to expand the category, false to close.\n   */\n  setExpanded(isExpanded: boolean) {\n    if (this.expanded_ === isExpanded) return;\n\n    this.expanded_ = isExpanded;\n    if (isExpanded) {\n      this.subcategoriesDiv_!.style.display = 'block';\n      this.openIcon_(this.iconDom_);\n    } else {\n      this.parentToolbox_.getFlyout()?.setVisible(false);\n      this.subcategoriesDiv_!.style.display = 'none';\n      this.closeIcon_(this.iconDom_);\n    }\n    aria.setState(\n      this.htmlDiv_ as HTMLDivElement,\n      aria.State.EXPANDED,\n      isExpanded,\n    );\n\n    this.parentToolbox_.handleToolboxItemResize();\n  }\n\n  override setVisible_(isVisible: boolean) {\n    this.htmlDiv_!.style.display = isVisible ? 'block' : 'none';\n    const childToolboxItems = this.getChildToolboxItems();\n    for (let i = 0; i < childToolboxItems.length; i++) {\n      const child = childToolboxItems[i];\n      child.setVisible_(isVisible);\n    }\n    this.isHidden_ = !isVisible;\n\n    if (this.parentToolbox_.getSelectedItem() === this) {\n      this.parentToolbox_.clearSelection();\n    }\n  }\n\n  /**\n   * Whether the category is expanded to show its child subcategories.\n   *\n   * @returns True if the toolbox item shows its children, false if it is\n   *     collapsed.\n   */\n  isExpanded(): boolean {\n    return this.expanded_;\n  }\n\n  override isCollapsible() {\n    return true;\n  }\n\n  override onClick(_e: Event) {\n    this.toggleExpanded();\n  }\n\n  /** Toggles whether or not the category is expanded. */\n  toggleExpanded() {\n    this.setExpanded(!this.expanded_);\n  }\n\n  override getDiv() {\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Gets any children toolbox items. (ex. Gets the subcategories)\n   *\n   * @returns The child toolbox items.\n   */\n  getChildToolboxItems(): IToolboxItem[] {\n    return this.toolboxItems_;\n  }\n}\n\nexport namespace CollapsibleToolboxCategory {\n  /**\n   * All the CSS class names that are used to create a collapsible\n   * category. This is all the properties from the regular category plus\n   * contents.\n   */\n  export interface CssConfig {\n    container: string | null;\n    row: string | null;\n    rowcontentcontainer: string | null;\n    icon: string | null;\n    label: string | null;\n    selected: string | null;\n    openicon: string | null;\n    closedicon: string | null;\n    contents: string | null;\n  }\n}\n\nexport type CssConfig = CollapsibleToolboxCategory.CssConfig;\n\nregistry.register(\n  registry.Type.TOOLBOX_ITEM,\n  CollapsibleToolboxCategory.registrationName,\n  CollapsibleToolboxCategory,\n);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Toolbox from whence to create blocks.\n *\n * @class\n */\n// Former goog.module ID: Blockly.Toolbox\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport {BlockSvg} from '../block_svg.js';\nimport type {BlocklyOptions} from '../blockly_options.js';\nimport * as browserEvents from '../browser_events.js';\nimport * as common from '../common.js';\nimport {ComponentManager} from '../component_manager.js';\nimport * as Css from '../css.js';\nimport {DeleteArea} from '../delete_area.js';\nimport '../events/events_toolbox_item_select.js';\nimport {EventType} from '../events/type.js';\nimport * as eventUtils from '../events/utils.js';\nimport type {IAutoHideable} from '../interfaces/i_autohideable.js';\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport {isDeletable} from '../interfaces/i_deletable.js';\nimport type {IDraggable} from '../interfaces/i_draggable.js';\nimport type {IFlyout} from '../interfaces/i_flyout.js';\nimport type {IKeyboardAccessible} from '../interfaces/i_keyboard_accessible.js';\nimport type {ISelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport {isSelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport type {IStyleable} from '../interfaces/i_styleable.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport {Options} from '../options.js';\nimport * as registry from '../registry.js';\nimport type {KeyboardShortcut} from '../shortcut_registry.js';\nimport * as Touch from '../touch.js';\nimport * as aria from '../utils/aria.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport * as toolbox from '../utils/toolbox.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport type {ToolboxCategory} from './category.js';\nimport {CollapsibleToolboxCategory} from './collapsible_category.js';\n\n/**\n * Class for a Toolbox.\n * Creates the toolbox's DOM.\n */\nexport class Toolbox\n  extends DeleteArea\n  implements IAutoHideable, IKeyboardAccessible, IStyleable, IToolbox\n{\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  override id = 'toolbox';\n  protected toolboxDef_: toolbox.ToolboxInfo;\n  private readonly horizontalLayout: boolean;\n\n  /** The HTML container for the toolbox. */\n  HtmlDiv: HTMLDivElement | null = null;\n\n  /** The HTML container for the contents of a toolbox. */\n  protected contentsDiv_: HTMLDivElement | null = null;\n\n  /** Whether the Toolbox is visible. */\n  protected isVisible_ = false;\n\n  /** The list of items in the toolbox. */\n  protected contents_: IToolboxItem[] = [];\n\n  /** The width of the toolbox. */\n  protected width_ = 0;\n\n  /** The height of the toolbox. */\n  protected height_ = 0;\n  RTL: boolean;\n\n  /** The flyout for the toolbox. */\n  private flyout: IFlyout | null = null;\n  protected contentMap_: {[key: string]: IToolboxItem};\n  toolboxPosition: toolbox.Position;\n\n  /** The currently selected item. */\n  protected selectedItem_: ISelectableToolboxItem | null = null;\n\n  /** The previously selected item. */\n  protected previouslySelectedItem_: ISelectableToolboxItem | null = null;\n\n  /**\n   * Array holding info needed to unbind event handlers.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  protected boundEvents_: browserEvents.Data[] = [];\n\n  /** The workspace this toolbox is on. */\n  protected readonly workspace_: WorkspaceSvg;\n\n  /** @param workspace The workspace in which to create new blocks. */\n  constructor(workspace: WorkspaceSvg) {\n    super();\n\n    this.workspace_ = workspace;\n\n    /** The JSON describing the contents of this toolbox. */\n    this.toolboxDef_ = workspace.options.languageTree || {\n      contents: new Array<toolbox.ToolboxItemInfo>(),\n    };\n\n    /** Whether the toolbox should be laid out horizontally. */\n    this.horizontalLayout = workspace.options.horizontalLayout;\n\n    /** Is RTL vs LTR. */\n    this.RTL = workspace.options.RTL;\n\n    /** A map from toolbox item IDs to toolbox items. */\n    this.contentMap_ = Object.create(null);\n\n    /** Position of the toolbox and flyout relative to the workspace. */\n    this.toolboxPosition = workspace.options.toolboxPosition;\n  }\n\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param _shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(_shortcut: KeyboardShortcut): boolean {\n    return false;\n  }\n\n  /** Initializes the toolbox */\n  init() {\n    const workspace = this.workspace_;\n    const svg = workspace.getParentSvg();\n\n    this.flyout = this.createFlyout_();\n\n    this.HtmlDiv = this.createDom_(this.workspace_);\n    dom.insertAfter(this.flyout.createDom('svg'), svg);\n    this.setVisible(true);\n    this.flyout.init(workspace);\n\n    this.render(this.toolboxDef_);\n    const themeManager = workspace.getThemeManager();\n    themeManager.subscribe(\n      this.HtmlDiv,\n      'toolboxBackgroundColour',\n      'background-color',\n    );\n    themeManager.subscribe(this.HtmlDiv, 'toolboxForegroundColour', 'color');\n    this.workspace_.getComponentManager().addComponent({\n      component: this,\n      weight: ComponentManager.ComponentWeight.TOOLBOX_WEIGHT,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n      ],\n    });\n  }\n\n  /**\n   * Creates the DOM for the toolbox.\n   *\n   * @param workspace The workspace this toolbox is on.\n   * @returns The HTML container for the toolbox.\n   */\n  protected createDom_(workspace: WorkspaceSvg): HTMLDivElement {\n    const svg = workspace.getParentSvg();\n\n    const container = this.createContainer_();\n\n    this.contentsDiv_ = this.createContentsContainer_();\n    this.contentsDiv_.tabIndex = 0;\n    aria.setRole(this.contentsDiv_, aria.Role.TREE);\n    container.appendChild(this.contentsDiv_);\n\n    svg.parentNode!.insertBefore(container, svg);\n\n    this.attachEvents_(container, this.contentsDiv_);\n    return container;\n  }\n\n  /**\n   * Creates the container div for the toolbox.\n   *\n   * @returns The HTML container for the toolbox.\n   */\n  protected createContainer_(): HTMLDivElement {\n    const toolboxContainer = document.createElement('div');\n    toolboxContainer.setAttribute('layout', this.isHorizontal() ? 'h' : 'v');\n    dom.addClass(toolboxContainer, 'blocklyToolboxDiv');\n    toolboxContainer.setAttribute('dir', this.RTL ? 'RTL' : 'LTR');\n    return toolboxContainer;\n  }\n\n  /**\n   * Creates the container for all the contents in the toolbox.\n   *\n   * @returns The HTML container for the toolbox contents.\n   */\n  protected createContentsContainer_(): HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    dom.addClass(contentsContainer, 'blocklyToolboxContents');\n    if (this.isHorizontal()) {\n      contentsContainer.style.flexDirection = 'row';\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Adds event listeners to the toolbox container div.\n   *\n   * @param container The HTML container for the toolbox.\n   * @param contentsContainer The HTML container for the contents of the\n   *     toolbox.\n   */\n  protected attachEvents_(\n    container: HTMLDivElement,\n    contentsContainer: HTMLDivElement,\n  ) {\n    // Clicking on toolbox closes popups.\n    const clickEvent = browserEvents.conditionalBind(\n      container,\n      'pointerdown',\n      this,\n      this.onClick_,\n      /* opt_noCaptureIdentifier */ false,\n    );\n    this.boundEvents_.push(clickEvent);\n\n    const keyDownEvent = browserEvents.conditionalBind(\n      contentsContainer,\n      'keydown',\n      this,\n      this.onKeyDown_,\n      /* opt_noCaptureIdentifier */ false,\n    );\n    this.boundEvents_.push(keyDownEvent);\n  }\n\n  /**\n   * Handles on click events for when the toolbox or toolbox items are clicked.\n   *\n   * @param e Click event to handle.\n   */\n  protected onClick_(e: PointerEvent) {\n    if (browserEvents.isRightButton(e) || e.target === this.HtmlDiv) {\n      // Close flyout.\n      (common.getMainWorkspace() as WorkspaceSvg).hideChaff(false);\n    } else {\n      const targetElement = e.target;\n      const itemId = (targetElement as Element).getAttribute('id');\n      if (itemId) {\n        const item = this.getToolboxItemById(itemId);\n        if (item!.isSelectable()) {\n          this.setSelectedItem(item);\n          (item as ISelectableToolboxItem).onClick(e);\n        }\n      }\n      // Just close popups.\n      (common.getMainWorkspace() as WorkspaceSvg).hideChaff(true);\n    }\n    Touch.clearTouchIdentifier();\n  }\n\n  /**\n   * Handles key down events for the toolbox.\n   *\n   * @param e The key down event.\n   */\n  protected onKeyDown_(e: KeyboardEvent) {\n    let handled = false;\n    switch (e.key) {\n      case 'ArrowDown':\n        handled = this.selectNext();\n        break;\n      case 'ArrowUp':\n        handled = this.selectPrevious();\n        break;\n      case 'ArrowLeft':\n        handled = this.selectParent();\n        break;\n      case 'ArrowRight':\n        handled = this.selectChild();\n        break;\n      case 'Enter':\n      case ' ':\n        if (this.selectedItem_ && this.selectedItem_.isCollapsible()) {\n          const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n          collapsibleItem.toggleExpanded();\n          handled = true;\n        }\n        break;\n      default:\n        handled = false;\n        break;\n    }\n    if (!handled && this.selectedItem_) {\n      // TODO(#6097): Figure out who implements onKeyDown and which interface it\n      // should be part of.\n      if ((this.selectedItem_ as any).onKeyDown) {\n        handled = (this.selectedItem_ as any).onKeyDown(e);\n      }\n    }\n\n    if (handled) {\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Creates the flyout based on the toolbox layout.\n   *\n   * @returns The flyout for the toolbox.\n   * @throws {Error} If missing a require for `Blockly.HorizontalFlyout`,\n   *     `Blockly.VerticalFlyout`, and no flyout plugin is specified.\n   */\n  protected createFlyout_(): IFlyout {\n    const workspace = this.workspace_;\n    // TODO (#4247): Look into adding a makeFlyout method to Blockly Options.\n    const workspaceOptions = new Options({\n      'parentWorkspace': workspace,\n      'rtl': workspace.RTL,\n      'oneBasedIndex': workspace.options.oneBasedIndex,\n      'horizontalLayout': workspace.horizontalLayout,\n      'renderer': workspace.options.renderer,\n      'rendererOverrides': workspace.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions);\n    // Options takes in either 'end' or 'start'. This has already been parsed to\n    // be either 0 or 1, so set it after.\n    workspaceOptions.toolboxPosition = workspace.options.toolboxPosition;\n    let FlyoutClass = null;\n    if (workspace.horizontalLayout) {\n      FlyoutClass = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n        workspace.options,\n        true,\n      );\n    } else {\n      FlyoutClass = registry.getClassFromOptions(\n        registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n        workspace.options,\n        true,\n      );\n    }\n    return new FlyoutClass!(workspaceOptions);\n  }\n\n  /**\n   * Fills the toolbox with new toolbox items and removes any old contents.\n   *\n   * @param toolboxDef Object holding information for creating a toolbox.\n   * @internal\n   */\n  render(toolboxDef: toolbox.ToolboxInfo) {\n    this.toolboxDef_ = toolboxDef;\n    for (let i = 0; i < this.contents_.length; i++) {\n      const toolboxItem = this.contents_[i];\n      if (toolboxItem) {\n        toolboxItem.dispose();\n      }\n    }\n    this.contents_ = [];\n    this.contentMap_ = Object.create(null);\n    this.renderContents_(toolboxDef['contents']);\n    this.position();\n    this.handleToolboxItemResize();\n  }\n\n  /**\n   * Adds all the toolbox items to the toolbox.\n   *\n   * @param toolboxDef Array holding objects containing information on the\n   *     contents of the toolbox.\n   */\n  protected renderContents_(toolboxDef: toolbox.ToolboxItemInfo[]) {\n    // This is for performance reasons. By using document fragment we only have\n    // to add to the DOM once.\n    const fragment = document.createDocumentFragment();\n    for (let i = 0; i < toolboxDef.length; i++) {\n      const toolboxItemDef = toolboxDef[i];\n      this.createToolboxItem(toolboxItemDef, fragment);\n    }\n    this.contentsDiv_!.appendChild(fragment);\n  }\n\n  /**\n   * Creates and renders the toolbox item.\n   *\n   * @param toolboxItemDef Any information that can be used to create an item in\n   *     the toolbox.\n   * @param fragment The document fragment to add the child toolbox elements to.\n   */\n  private createToolboxItem(\n    toolboxItemDef: toolbox.ToolboxItemInfo,\n    fragment: DocumentFragment,\n  ) {\n    let registryName = toolboxItemDef['kind'];\n\n    // Categories that are collapsible are created using a class registered\n    // under a different name.\n    if (\n      registryName.toUpperCase() === 'CATEGORY' &&\n      toolbox.isCategoryCollapsible(toolboxItemDef as toolbox.CategoryInfo)\n    ) {\n      registryName = CollapsibleToolboxCategory.registrationName;\n    }\n\n    const ToolboxItemClass = registry.getClass(\n      registry.Type.TOOLBOX_ITEM,\n      registryName.toLowerCase(),\n    );\n    if (ToolboxItemClass) {\n      const toolboxItem = new ToolboxItemClass(toolboxItemDef, this);\n      toolboxItem.init();\n      this.addToolboxItem_(toolboxItem);\n      const toolboxItemDom = toolboxItem.getDiv();\n      if (toolboxItemDom) {\n        fragment.appendChild(toolboxItemDom);\n      }\n      // Adds the ID to the HTML element that can receive a click.\n      // This is used in onClick_ to find the toolboxItem that was clicked.\n      if (toolboxItem.getClickTarget()) {\n        toolboxItem.getClickTarget()!.setAttribute('id', toolboxItem.getId());\n      }\n    }\n  }\n\n  /**\n   * Adds an item to the toolbox.\n   *\n   * @param toolboxItem The item in the toolbox.\n   */\n  protected addToolboxItem_(toolboxItem: IToolboxItem) {\n    this.contents_.push(toolboxItem);\n    this.contentMap_[toolboxItem.getId()] = toolboxItem;\n    if (toolboxItem.isCollapsible()) {\n      const collapsibleItem = toolboxItem as ICollapsibleToolboxItem;\n      const childToolboxItems = collapsibleItem.getChildToolboxItems();\n      for (let i = 0; i < childToolboxItems.length; i++) {\n        const child = childToolboxItems[i];\n        this.addToolboxItem_(child);\n      }\n    }\n  }\n\n  /**\n   * Gets the items in the toolbox.\n   *\n   * @returns The list of items in the toolbox.\n   */\n  getToolboxItems(): IToolboxItem[] {\n    return this.contents_;\n  }\n\n  /**\n   * Adds a style on the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to add.\n   * @internal\n   */\n  addStyle(style: string) {\n    if (style && this.HtmlDiv) {\n      dom.addClass(this.HtmlDiv, style);\n    }\n  }\n\n  /**\n   * Removes a style from the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to remove.\n   * @internal\n   */\n  removeStyle(style: string) {\n    if (style && this.HtmlDiv) {\n      dom.removeClass(this.HtmlDiv, style);\n    }\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect | null {\n    if (!this.HtmlDiv || !this.isVisible_) {\n      return null;\n    }\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the toolbox\n    // area are still deleted.  Must be smaller than Infinity, but larger than\n    // the largest screen size.\n    const BIG_NUM = 10000000;\n    const toolboxRect = this.HtmlDiv.getBoundingClientRect();\n\n    const top = toolboxRect.top;\n    const bottom = top + toolboxRect.height;\n    const left = toolboxRect.left;\n    const right = left + toolboxRect.width;\n\n    // Assumes that the toolbox is on the SVG edge.  If this changes\n    // (e.g. toolboxes in mutators) then this code will need to be more complex.\n    if (this.toolboxPosition === toolbox.Position.TOP) {\n      return new Rect(-BIG_NUM, bottom, -BIG_NUM, BIG_NUM);\n    } else if (this.toolboxPosition === toolbox.Position.BOTTOM) {\n      return new Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\n    } else if (this.toolboxPosition === toolbox.Position.LEFT) {\n      return new Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, right);\n    } else {\n      // Right\n      return new Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\n    }\n  }\n\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  override wouldDelete(element: IDraggable): boolean {\n    if (element instanceof BlockSvg) {\n      const block = element;\n      this.updateWouldDelete_(!block.getParent() && block.isDeletable());\n    } else {\n      this.updateWouldDelete_(isDeletable(element) && element.isDeletable());\n    }\n    return this.wouldDelete_;\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragEnter(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(true);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragExit(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(false);\n  }\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDrop(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(false);\n  }\n\n  /**\n   * Updates the internal wouldDelete_ state.\n   *\n   * @param wouldDelete The new value for the wouldDelete state.\n   */\n  protected override updateWouldDelete_(wouldDelete: boolean) {\n    if (wouldDelete === this.wouldDelete_) {\n      return;\n    }\n    // This logic handles updating the deleteStyle properly if the delete state\n    // changes while the block is over the Toolbox. This could happen if the\n    // implementation of wouldDeleteBlock depends on the couldConnect parameter\n    // or if the isDeletable property of the block currently being dragged\n    // changes during the drag.\n    this.updateCursorDeleteStyle_(false);\n    this.wouldDelete_ = wouldDelete;\n    this.updateCursorDeleteStyle_(true);\n  }\n\n  /**\n   * Adds or removes the CSS style of the cursor over the toolbox based whether\n   * the block or bubble over it is expected to be deleted if dropped (using the\n   * internal this.wouldDelete_ property).\n   *\n   * @param addStyle Whether the style should be added or removed.\n   */\n  protected updateCursorDeleteStyle_(addStyle: boolean) {\n    const style = this.wouldDelete_\n      ? 'blocklyToolboxDelete'\n      : 'blocklyToolboxGrab';\n    if (addStyle) {\n      this.addStyle(style);\n    } else {\n      this.removeStyle(style);\n    }\n  }\n\n  /**\n   * Gets the toolbox item with the given ID.\n   *\n   * @param id The ID of the toolbox item.\n   * @returns The toolbox item with the given ID, or null if no item exists.\n   */\n  getToolboxItemById(id: string): IToolboxItem | null {\n    return this.contentMap_[id] || null;\n  }\n\n  /**\n   * Gets the width of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Gets the height of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Gets the toolbox flyout.\n   *\n   * @returns The toolbox flyout.\n   */\n  getFlyout(): IFlyout | null {\n    return this.flyout;\n  }\n\n  /**\n   * Gets the workspace for the toolbox.\n   *\n   * @returns The parent workspace for the toolbox.\n   */\n  getWorkspace(): WorkspaceSvg {\n    return this.workspace_;\n  }\n\n  /**\n   * Gets the selected item.\n   *\n   * @returns The selected item, or null if no item is currently selected.\n   */\n  getSelectedItem(): ISelectableToolboxItem | null {\n    return this.selectedItem_;\n  }\n\n  /**\n   * Gets the previously selected item.\n   *\n   * @returns The previously selected item, or null if no item was previously\n   *     selected.\n   */\n  getPreviouslySelectedItem(): ISelectableToolboxItem | null {\n    return this.previouslySelectedItem_;\n  }\n\n  /**\n   * Gets whether or not the toolbox is horizontal.\n   *\n   * @returns True if the toolbox is horizontal, false if the toolbox is\n   *     vertical.\n   */\n  isHorizontal(): boolean {\n    return this.horizontalLayout;\n  }\n\n  /**\n   * Positions the toolbox based on whether it is a horizontal toolbox and\n   * whether the workspace is in rtl.\n   */\n  position() {\n    const workspaceMetrics = this.workspace_.getMetrics();\n    const toolboxDiv = this.HtmlDiv;\n    if (!toolboxDiv) {\n      // Not initialized yet.\n      return;\n    }\n\n    if (this.horizontalLayout) {\n      toolboxDiv.style.left = '0';\n      toolboxDiv.style.height = 'auto';\n      toolboxDiv.style.width = '100%';\n      this.height_ = toolboxDiv.offsetHeight;\n      this.width_ = workspaceMetrics.viewWidth;\n      if (this.toolboxPosition === toolbox.Position.TOP) {\n        toolboxDiv.style.top = '0';\n      } else {\n        // Bottom\n        toolboxDiv.style.bottom = '0';\n      }\n    } else {\n      if (this.toolboxPosition === toolbox.Position.RIGHT) {\n        toolboxDiv.style.right = '0';\n      } else {\n        // Left\n        toolboxDiv.style.left = '0';\n      }\n      toolboxDiv.style.height = '100%';\n      this.width_ = toolboxDiv.offsetWidth;\n      this.height_ = workspaceMetrics.viewHeight;\n    }\n    this.flyout!.position();\n  }\n\n  /**\n   * Handles resizing the toolbox when a toolbox item resizes.\n   *\n   * @internal\n   */\n  handleToolboxItemResize() {\n    // Reposition the workspace so that (0,0) is in the correct position\n    // relative to the new absolute edge (ie toolbox edge).\n    const workspace = this.workspace_;\n    const rect = this.HtmlDiv!.getBoundingClientRect();\n    const newX =\n      this.toolboxPosition === toolbox.Position.LEFT\n        ? workspace.scrollX + rect.width\n        : workspace.scrollX;\n    const newY =\n      this.toolboxPosition === toolbox.Position.TOP\n        ? workspace.scrollY + rect.height\n        : workspace.scrollY;\n    workspace.translate(newX, newY);\n\n    // Even though the div hasn't changed size, the visible workspace\n    // surface of the workspace has, so we may need to reposition everything.\n    common.svgResize(workspace);\n  }\n\n  /** Unhighlights any previously selected item. */\n  clearSelection() {\n    this.setSelectedItem(null);\n  }\n\n  /**\n   * Updates the category colours and background colour of selected categories.\n   *\n   * @internal\n   */\n  refreshTheme() {\n    for (let i = 0; i < this.contents_.length; i++) {\n      const child = this.contents_[i];\n      // TODO(#6097): Fix types or add refreshTheme to IToolboxItem.\n      const childAsCategory = child as ToolboxCategory;\n      if (childAsCategory.refreshTheme) {\n        childAsCategory.refreshTheme();\n      }\n    }\n  }\n\n  /**\n   * Updates the flyout's content without closing it.  Should be used in\n   * response to a change in one of the dynamic categories, such as variables or\n   * procedures.\n   */\n  refreshSelection() {\n    if (\n      this.selectedItem_ &&\n      this.selectedItem_.isSelectable() &&\n      this.selectedItem_.getContents().length\n    ) {\n      this.flyout!.show(this.selectedItem_.getContents());\n    }\n  }\n\n  /**\n   * Shows or hides the toolbox.\n   *\n   * @param isVisible True if toolbox should be visible.\n   */\n  setVisible(isVisible: boolean) {\n    if (this.isVisible_ === isVisible) {\n      return;\n    }\n\n    this.HtmlDiv!.style.display = isVisible ? 'block' : 'none';\n    this.isVisible_ = isVisible;\n    // Invisible toolbox is ignored as drag targets and must have the drag\n    // target updated.\n    this.workspace_.recordDragTargets();\n  }\n\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *     Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean) {\n    if (!onlyClosePopups && this.flyout && this.flyout.autoClose) {\n      this.clearSelection();\n    }\n  }\n\n  /**\n   * Sets the given item as selected.\n   * No-op if the item is not selectable.\n   *\n   * @param newItem The toolbox item to select.\n   */\n  setSelectedItem(newItem: IToolboxItem | null) {\n    const oldItem = this.selectedItem_;\n\n    if (\n      (!newItem && !oldItem) ||\n      (newItem && !isSelectableToolboxItem(newItem))\n    ) {\n      return;\n    }\n\n    if (this.shouldDeselectItem_(oldItem, newItem) && oldItem !== null) {\n      this.deselectItem_(oldItem);\n    }\n\n    if (this.shouldSelectItem_(oldItem, newItem) && newItem !== null) {\n      this.selectItem_(oldItem, newItem);\n    }\n\n    this.updateFlyout_(oldItem, newItem);\n    this.fireSelectEvent(oldItem, newItem);\n  }\n\n  /**\n   * Decides whether the old item should be deselected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   * @returns True if the old item should be deselected, false otherwise.\n   */\n  protected shouldDeselectItem_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem | null,\n  ): boolean {\n    // Deselect the old item unless the old item is collapsible and has been\n    // previously clicked on.\n    return (\n      oldItem !== null && (!oldItem.isCollapsible() || oldItem !== newItem)\n    );\n  }\n\n  /**\n   * Decides whether the new item should be selected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   * @returns True if the new item should be selected, false otherwise.\n   */\n  protected shouldSelectItem_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem | null,\n  ): boolean {\n    // Select the new item unless the old item equals the new item.\n    return newItem !== null && newItem !== oldItem;\n  }\n\n  /**\n   * Deselects the given item, marks it as unselected, and updates aria state.\n   *\n   * @param item The previously selected toolbox item which should be\n   *     deselected.\n   */\n  protected deselectItem_(item: ISelectableToolboxItem) {\n    this.selectedItem_ = null;\n    this.previouslySelectedItem_ = item;\n    item.setSelected(false);\n    aria.setState(\n      this.contentsDiv_ as Element,\n      aria.State.ACTIVEDESCENDANT,\n      '',\n    );\n  }\n\n  /**\n   * Selects the given item, marks it selected, and updates aria state.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  protected selectItem_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem,\n  ) {\n    this.selectedItem_ = newItem;\n    this.previouslySelectedItem_ = oldItem;\n    newItem.setSelected(true);\n    aria.setState(\n      this.contentsDiv_ as Element,\n      aria.State.ACTIVEDESCENDANT,\n      newItem.getId(),\n    );\n  }\n\n  /**\n   * Selects the toolbox item by its position in the list of toolbox items.\n   *\n   * @param position The position of the item to select.\n   */\n  selectItemByPosition(position: number) {\n    if (position > -1 && position < this.contents_.length) {\n      const item = this.contents_[position];\n      if (item.isSelectable()) {\n        this.setSelectedItem(item);\n      }\n    }\n  }\n\n  /**\n   * Decides whether to hide or show the flyout depending on the selected item.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  protected updateFlyout_(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem | null,\n  ) {\n    if (\n      !newItem ||\n      (oldItem === newItem && !newItem.isCollapsible()) ||\n      !newItem.getContents().length\n    ) {\n      this.flyout!.hide();\n    } else {\n      this.flyout!.show(newItem.getContents());\n      this.flyout!.scrollToStart();\n    }\n  }\n\n  /**\n   * Emits an event when a new toolbox item is selected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  private fireSelectEvent(\n    oldItem: ISelectableToolboxItem | null,\n    newItem: ISelectableToolboxItem | null,\n  ) {\n    const oldElement = oldItem && oldItem.getName();\n    let newElement = newItem && newItem.getName();\n    // In this case the toolbox closes, so the newElement should be null.\n    if (oldItem === newItem) {\n      newElement = null;\n    }\n    const event = new (eventUtils.get(EventType.TOOLBOX_ITEM_SELECT))(\n      oldElement,\n      newElement,\n      this.workspace_.id,\n    );\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Closes the current item if it is expanded, or selects the parent.\n   *\n   * @returns True if a parent category was selected, false otherwise.\n   */\n  private selectParent(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    if (\n      this.selectedItem_.isCollapsible() &&\n      (this.selectedItem_ as ICollapsibleToolboxItem).isExpanded()\n    ) {\n      const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n      collapsibleItem.toggleExpanded();\n      return true;\n    } else if (\n      this.selectedItem_.getParent() &&\n      this.selectedItem_.getParent()!.isSelectable()\n    ) {\n      this.setSelectedItem(this.selectedItem_.getParent());\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Selects the first child of the currently selected item, or nothing if the\n   * toolbox item has no children.\n   *\n   * @returns True if a child category was selected, false otherwise.\n   */\n  private selectChild(): boolean {\n    if (!this.selectedItem_ || !this.selectedItem_.isCollapsible()) {\n      return false;\n    }\n    const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n    if (!collapsibleItem.isExpanded()) {\n      collapsibleItem.toggleExpanded();\n      return true;\n    } else {\n      this.selectNext();\n      return true;\n    }\n  }\n\n  /**\n   * Selects the next visible toolbox item.\n   *\n   * @returns True if a next category was selected, false otherwise.\n   */\n  private selectNext(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    let nextItemIdx = this.contents_.indexOf(this.selectedItem_) + 1;\n    if (nextItemIdx > -1 && nextItemIdx < this.contents_.length) {\n      let nextItem = this.contents_[nextItemIdx];\n      while (nextItem && !nextItem.isSelectable()) {\n        nextItem = this.contents_[++nextItemIdx];\n      }\n      if (nextItem && nextItem.isSelectable()) {\n        this.setSelectedItem(nextItem);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Selects the previous visible toolbox item.\n   *\n   * @returns True if a previous category was selected, false otherwise.\n   */\n  private selectPrevious(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    let prevItemIdx = this.contents_.indexOf(this.selectedItem_) - 1;\n    if (prevItemIdx > -1 && prevItemIdx < this.contents_.length) {\n      let prevItem = this.contents_[prevItemIdx];\n      while (prevItem && !prevItem.isSelectable()) {\n        prevItem = this.contents_[--prevItemIdx];\n      }\n      if (prevItem && prevItem.isSelectable()) {\n        this.setSelectedItem(prevItem);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /** Disposes of this toolbox. */\n  dispose() {\n    this.workspace_.getComponentManager().removeComponent('toolbox');\n    this.flyout!.dispose();\n    for (let i = 0; i < this.contents_.length; i++) {\n      const toolboxItem = this.contents_[i];\n      toolboxItem.dispose();\n    }\n\n    for (let j = 0; j < this.boundEvents_.length; j++) {\n      browserEvents.unbind(this.boundEvents_[j]);\n    }\n    this.boundEvents_ = [];\n    this.contents_ = [];\n\n    if (this.HtmlDiv) {\n      this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv);\n      dom.removeNode(this.HtmlDiv);\n    }\n  }\n}\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyToolboxDelete {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyToolboxGrab {\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n/* Category tree in Toolbox. */\n.blocklyToolboxDiv {\n  background-color: #ddd;\n  overflow-x: visible;\n  overflow-y: auto;\n  padding: 4px 0 4px 0;\n  position: absolute;\n  z-index: 70;  /* so blocks go under toolbox when dragging */\n  -webkit-tap-highlight-color: transparent;  /* issue #1345 */\n}\n\n.blocklyToolboxContents {\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: column;\n}\n\n.blocklyToolboxContents:focus {\n  outline: none;\n}\n`);\n\nregistry.register(registry.Type.TOOLBOX, registry.DEFAULT, Toolbox);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.utils.Metrics\n\nexport interface Metrics {\n  /** Height of the visible portion of the workspace. */\n  viewHeight: number;\n\n  /** Width of the visible portion of the workspace. */\n  viewWidth: number;\n\n  /** Height of the content. */\n  contentHeight: number;\n\n  /** Width of the content. */\n  contentWidth: number;\n\n  /** Height of the scroll area. */\n  scrollHeight: number;\n\n  /** Width of the scroll area. */\n  scrollWidth: number;\n\n  /**\n   * Top-edge of the visible portion of the workspace, relative to the workspace\n   * origin.\n   */\n  viewTop: number;\n\n  /**\n   * Left-edge of the visible portion of the workspace, relative to the\n   * workspace origin.\n   */\n  viewLeft: number;\n\n  /** Top-edge of the content, relative to the workspace origin. */\n  contentTop: number;\n\n  /** Left-edge of the content relative to the workspace origin. */\n  contentLeft: number;\n\n  /** Top-edge of the scroll area, relative to the workspace origin. */\n  scrollTop: number;\n\n  /** Left-edge of the scroll area relative to the workspace origin. */\n  scrollLeft: number;\n\n  /**\n   * Top-edge of the visible portion of the workspace, relative to the\n   * blocklyDiv.\n   */\n  absoluteTop: number;\n\n  /**\n   * Left-edge of the visible portion of the workspace, relative to the\n   * blocklyDiv.\n   */\n  absoluteLeft: number;\n\n  /**\n   * Height of the Blockly div (the view + the toolbox, simple of otherwise).\n   */\n  svgHeight: number;\n\n  /** Width of the Blockly div (the view + the toolbox, simple or otherwise). */\n  svgWidth: number;\n\n  /** Width of the toolbox, if it exists.  Otherwise zero. */\n  toolboxWidth: number;\n\n  /** Height of the toolbox, if it exists.  Otherwise zero. */\n  toolboxHeight: number;\n\n  /** Top, bottom, left or right. Use TOOLBOX_AT constants to compare. */\n  toolboxPosition: number;\n\n  /** Width of the flyout if it is always open.  Otherwise zero. */\n  flyoutWidth: number;\n\n  /** Height of the flyout if it is always open.  Otherwise zero. */\n  flyoutHeight: number;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.blockRendering.IPathObject\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport type {Coordinate} from '../../utils/coordinate.js';\nimport type {ConstantProvider} from './constants.js';\n\n/**\n * An interface for a block's path object.\n *\n * @param _root The root SVG element.\n * @param _constants The renderer's constants.\n */\nexport interface IPathObject {\n  /**\n   * The primary path of the block.\n   */\n  svgPath: SVGElement;\n\n  /** The renderer's constant provider. */\n  constants: ConstantProvider;\n\n  /** The primary path of the block. */\n  style: BlockStyle;\n\n  /**\n   * Holds the cursors SVG element when the cursor is attached to the block.\n   * This is null if there is no cursor on the block.\n   */\n  cursorSvg: SVGElement | null;\n\n  /**\n   * Holds the markers SVG element when the marker is attached to the block.\n   * This is null if there is no marker on the block.\n   */\n  markerSvg: SVGElement | null;\n\n  /**\n   * Set the path generated by the renderer onto the respective SVG element.\n   *\n   * @param pathString The path.\n   */\n  setPath(pathString: string): void;\n\n  /**\n   * Apply the stored colours to the block's path, taking into account whether\n   * the paths belong to a shadow block.\n   *\n   * @param block The source block.\n   */\n  applyColour(block: BlockSvg): void;\n\n  /**\n   * Update the style.\n   *\n   * @param blockStyle The block style to use.\n   */\n  setStyle(blockStyle: BlockStyle): void;\n\n  /**\n   * Flip the SVG paths in RTL.\n   */\n  flipRTL(): void;\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   */\n  setCursorSvg(cursorSvg: SVGElement): void;\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   */\n  setMarkerSvg(markerSvg: SVGElement): void;\n\n  /**\n   * Set whether the block shows a highlight or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param highlighted True if highlighted.\n   */\n  updateHighlighted(highlighted: boolean): void;\n\n  /**\n   * Add or remove styling showing that a block is selected.\n   *\n   * @param enable True if selection is enabled, false otherwise.\n   */\n  updateSelected(enabled: boolean): void;\n\n  /**\n   * Add or remove styling showing that a block is dragged over a delete area.\n   *\n   * @param enable True if the block is being dragged over a delete area, false\n   *     otherwise.\n   */\n  updateDraggingDelete(enabled: boolean): void;\n\n  /**\n   * Add or remove styling showing that a block is an insertion marker.\n   *\n   * @param enable True if the block is an insertion marker, false otherwise.\n   */\n  updateInsertionMarker(enabled: boolean): void;\n\n  /**\n   * Add or remove styling showing that a block is movable.\n   *\n   * @param enable True if the block is movable, false otherwise.\n   */\n  updateMovable(enabled: boolean): void;\n\n  /** Adds the given path as a connection highlight for the given connection. */\n  addConnectionHighlight?(\n    connection: RenderedConnection,\n    connectionPath: string,\n    offset: Coordinate,\n    rtl: boolean,\n  ): void;\n\n  /**\n   * Removes any highlight associated with the given connection, if it exists.\n   */\n  removeConnectionHighlight?(connection: RenderedConnection): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IToolboxItem\n\n/**\n * Interface for an item in the toolbox.\n */\nexport interface IToolboxItem {\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   */\n  init(): void;\n\n  /**\n   * Gets the div for the toolbox item.\n   *\n   * @returns The div for the toolbox item.\n   */\n  getDiv(): Element | null;\n\n  /**\n   * Gets a unique identifier for this toolbox item.\n   *\n   * @returns The ID for the toolbox item.\n   */\n  getId(): string;\n\n  /**\n   * Gets the parent if the toolbox item is nested.\n   *\n   * @returns The parent toolbox item, or null if this toolbox item is not\n   *     nested.\n   */\n  getParent(): IToolboxItem | null;\n\n  /**\n   * Gets the nested level of the category.\n   *\n   * @returns The nested level of the category.\n   * @internal\n   */\n  getLevel(): number;\n\n  /**\n   * Whether the toolbox item is selectable.\n   *\n   * @returns True if the toolbox item can be selected.\n   */\n  isSelectable(): boolean;\n\n  /**\n   * Whether the toolbox item is collapsible.\n   *\n   * @returns True if the toolbox item is collapsible.\n   */\n  isCollapsible(): boolean;\n\n  /** Dispose of this toolbox item. No-op by default. */\n  dispose(): void;\n\n  /**\n   * Gets the HTML element that is clickable.\n   *\n   * @returns The HTML element that receives clicks.\n   */\n  getClickTarget(): Element | null;\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param isVisible True if category should be visible.\n   */\n  setVisible_(isVisible: boolean): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IToolbox\n\nimport type {ToolboxInfo} from '../utils/toolbox.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport type {IFlyout} from './i_flyout.js';\nimport type {IRegistrable} from './i_registrable.js';\nimport type {IToolboxItem} from './i_toolbox_item.js';\n\n/**\n * Interface for a toolbox.\n */\nexport interface IToolbox extends IRegistrable {\n  /** Initializes the toolbox. */\n  init(): void;\n\n  /**\n   * Fills the toolbox with new toolbox items and removes any old contents.\n   *\n   * @param toolboxDef Object holding information for creating a toolbox.\n   */\n  render(toolboxDef: ToolboxInfo): void;\n\n  /**\n   * Gets the width of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getWidth(): number;\n\n  /**\n   * Gets the height of the toolbox.\n   *\n   * @returns The height of the toolbox.\n   */\n  getHeight(): number;\n\n  /**\n   * Gets the toolbox flyout.\n   *\n   * @returns The toolbox flyout.\n   */\n  getFlyout(): IFlyout | null;\n\n  /**\n   * Gets the workspace for the toolbox.\n   *\n   * @returns The parent workspace for the toolbox.\n   */\n  getWorkspace(): WorkspaceSvg;\n\n  /**\n   * Gets whether or not the toolbox is horizontal.\n   *\n   * @returns True if the toolbox is horizontal, false if the toolbox is\n   *     vertical.\n   */\n  isHorizontal(): boolean;\n\n  /**\n   * Positions the toolbox based on whether it is a horizontal toolbox and\n   * whether the workspace is in rtl.\n   */\n  position(): void;\n\n  /** Handles resizing the toolbox when a toolbox item resizes. */\n  handleToolboxItemResize(): void;\n\n  /** Unhighlights any previously selected item. */\n  clearSelection(): void;\n\n  /**\n   * Updates the category colours and background colour of selected categories.\n   */\n  refreshTheme(): void;\n\n  /**\n   * Updates the flyout's content without closing it.  Should be used in\n   * response to a change in one of the dynamic categories, such as variables or\n   * procedures.\n   */\n  refreshSelection(): void;\n\n  /**\n   * Sets the visibility of the toolbox.\n   *\n   * @param isVisible True if toolbox should be visible.\n   */\n  setVisible(isVisible: boolean): void;\n\n  /**\n   * Selects the toolbox item by it's position in the list of toolbox items.\n   *\n   * @param position The position of the item to select.\n   */\n  selectItemByPosition(position: number): void;\n\n  /**\n   * Gets the selected item.\n   *\n   * @returns The selected item, or null if no item is currently selected.\n   */\n  getSelectedItem(): IToolboxItem | null;\n\n  /** Disposes of this toolbox. */\n  dispose(): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IStyleable\n\n/**\n * Interface for an object that a style can be added to.\n */\nexport interface IStyleable {\n  /**\n   * Adds a style on the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to add.\n   */\n  addStyle(style: string): void;\n\n  /**\n   * Removes a style from the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to remove.\n   */\n  removeStyle(style: string): void;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.serialization.ISerializer\n\nimport type {Workspace} from '../workspace.js';\n\n/**\n * Serializes and deserializes a plugin or system.\n */\nexport interface ISerializer {\n  /**\n   * A priority value used to determine the order of deserializing state.\n   * More positive priorities are deserialized before less positive\n   * priorities. Eg if you have priorities (0, -10, 10, 100) the order of\n   * deserialiation will be (100, 10, 0, -10).\n   * If two serializers have the same priority, they are deserialized in an\n   * arbitrary order relative to each other.\n   */\n  priority: number;\n\n  /**\n   * Saves the state of the plugin or system.\n   *\n   * @param workspace The workspace the system to serialize is associated with.\n   * @returns A JS object containing the system's state, or null if there is no\n   *     state to record.\n   */\n  save(workspace: Workspace): object | null;\n\n  /**\n   * Loads the state of the plugin or system.\n   *\n   * @param state The state of the system to deserialize. This will always be\n   *     non-null.\n   * @param workspace The workspace the system to deserialize is associated\n   *     with.\n   */\n  load(state: object, workspace: Workspace): void;\n\n  /**\n   * Clears the state of the plugin or system.\n   *\n   * @param workspace The workspace the system to clear the state of is\n   *     associated with.\n   */\n  clear(workspace: Workspace): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IRegistrable\n\n/**\n * The interface for a Blockly component that can be registered.\n */\nexport interface IRegistrable {}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {State} from '../serialization/procedures.js';\nimport {IParameterModel} from './i_parameter_model.js';\n\n/**\n * A data model for a procedure.\n */\nexport interface IProcedureModel {\n  /** Sets the human-readable name of the procedure. */\n  setName(name: string): this;\n\n  /**\n   * Inserts a parameter into the list of parameters.\n   *\n   * To move a parameter, first delete it, and then re-insert.\n   */\n  insertParameter(parameterModel: IParameterModel, index: number): this;\n\n  /** Removes the parameter at the given index from the parameter list. */\n  deleteParameter(index: number): this;\n\n  /**\n   * Sets the return type(s) of the procedure.\n   *\n   * Pass null to represent a procedure that does not return.\n   */\n  setReturnTypes(types: string[] | null): this;\n\n  /**\n   * Sets whether this procedure is enabled/disabled. If a procedure is disabled\n   * all procedure caller blocks should be disabled as well.\n   */\n  setEnabled(enabled: boolean): this;\n\n  /** Returns the unique language-neutral ID for the procedure. */\n  getId(): string;\n\n  /** Returns the human-readable name of the procedure. */\n  getName(): string;\n\n  /** Returns the parameter at the given index in the parameter list. */\n  getParameter(index: number): IParameterModel;\n\n  /** Returns an array of all of the parameters in the parameter list. */\n  getParameters(): IParameterModel[];\n\n  /**\n   * Returns the return type(s) of the procedure.\n   *\n   * Null represents a procedure that does not return a value.\n   */\n  getReturnTypes(): string[] | null;\n\n  /**\n   * Returns whether the procedure is enabled/disabled. If a procedure is\n   * disabled, all procedure caller blocks should be disabled as well.\n   */\n  getEnabled(): boolean;\n\n  /**\n   * Serializes the state of the procedure to JSON.\n   *\n   * @returns JSON serializable state of the procedure.\n   */\n  saveState(): State;\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IProcedureModel} from './i_procedure_model.js';\n\nexport interface IProcedureMap extends Map<string, IProcedureModel> {\n  /**\n   * Adds the given ProcedureModel to the map of procedure models, so that\n   * blocks can find it.\n   */\n  add(proc: IProcedureModel): this;\n\n  /** Returns all of the procedures stored in this map. */\n  getProcedures(): IProcedureModel[];\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IPositionable\n\nimport type {UiMetrics} from '../metrics_manager.js';\nimport type {Rect} from '../utils/rect.js';\nimport type {IComponent} from './i_component.js';\n\n/**\n * Interface for a component that is positioned on top of the workspace.\n */\nexport interface IPositionable extends IComponent {\n  /**\n   * Positions the element. Called when the window is resized.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]): void;\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect | null;\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {ParameterState} from '../serialization/procedures';\nimport {IProcedureModel} from './i_procedure_model';\n\n/**\n * A data model for a procedure.\n */\nexport interface IParameterModel {\n  /**\n   * Sets the name of this parameter to the given name.\n   */\n  setName(name: string): this;\n\n  /**\n   * Sets the types of this parameter to the given type.\n   */\n  setTypes(types: string[]): this;\n\n  /**\n   * Returns the name of this parameter.\n   */\n  getName(): string;\n\n  /**\n   * Return the types of this parameter.\n   */\n  getTypes(): string[];\n\n  /**\n   * Returns the unique language-neutral ID for the parameter.\n   *\n   * This represents the identify of the variable model which does not change\n   * over time.\n   */\n  getId(): string;\n\n  /** Sets the procedure model this parameter is associated with. */\n  setProcedureModel(model: IProcedureModel): this;\n\n  /**\n   * Serializes the state of the parameter to JSON.\n   *\n   * @returns JSON serializable state of the parameter.\n   */\n  saveState(): ParameterState;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IMovable\n\n/**\n * The interface for an object that is movable.\n */\nexport interface IMovable {\n  /**\n   * Get whether this is movable or not.\n   *\n   * @returns True if movable.\n   */\n  isMovable(): boolean;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IMetricsManager\n\nimport type {\n  AbsoluteMetrics,\n  ContainerRegion,\n  ToolboxMetrics,\n  UiMetrics,\n} from '../metrics_manager.js';\nimport type {Metrics} from '../utils/metrics.js';\nimport type {Size} from '../utils/size.js';\n\n/**\n * Interface for a metrics manager.\n */\nexport interface IMetricsManager {\n  /**\n   * Returns whether the scroll area has fixed edges.\n   *\n   * @returns Whether the scroll area has fixed edges.\n   * @internal\n   */\n  hasFixedEdges(): boolean;\n\n  /**\n   * Returns the metrics for the scroll area of the workspace.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the scroll metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @param opt_contentMetrics The content metrics if they have been previously\n   *     computed. Passing in null may cause the content metrics to be computed\n   *     again, if it is needed.\n   * @returns The metrics for the scroll container\n   */\n  getScrollMetrics(\n    opt_getWorkspaceCoordinates?: boolean,\n    opt_viewMetrics?: ContainerRegion,\n    opt_contentMetrics?: ContainerRegion,\n  ): ContainerRegion;\n\n  /**\n   * Gets the width and the height of the flyout in pixel\n   * coordinates. By default, will get metrics for either a simple flyout (owned\n   * directly by the workspace) or for the flyout owned by the toolbox. If you\n   * pass `opt_own` as `true` then only metrics for the simple flyout will be\n   * returned, and it will return 0 for the width and height if the workspace\n   * has a category toolbox instead of a simple toolbox.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout metrics.\n   * @returns The width and height of the flyout.\n   */\n  getFlyoutMetrics(opt_own?: boolean): ToolboxMetrics;\n\n  /**\n   * Gets the width, height and position of the toolbox on the workspace in\n   * pixel coordinates. Returns 0 for the width and height if the workspace has\n   * a simple toolbox instead of a category toolbox. To get the width and height\n   * of a simple toolbox, see {@link IMetricsManager#getFlyoutMetrics}.\n   *\n   * @returns The object with the width, height and position of the toolbox.\n   */\n  getToolboxMetrics(): ToolboxMetrics;\n\n  /**\n   * Gets the width and height of the workspace's parent SVG element in pixel\n   * coordinates. This area includes the toolbox and the visible workspace area.\n   *\n   * @returns The width and height of the workspace's parent SVG element.\n   */\n  getSvgMetrics(): Size;\n\n  /**\n   * Gets the absolute left and absolute top in pixel coordinates.\n   * This is where the visible workspace starts in relation to the SVG\n   * container.\n   *\n   * @returns The absolute metrics for the workspace.\n   */\n  getAbsoluteMetrics(): AbsoluteMetrics;\n\n  /**\n   * Gets the metrics for the visible workspace in either pixel or workspace\n   * coordinates. The visible workspace does not include the toolbox or flyout.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the view metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The width, height, top and left of the viewport in either\n   *     workspace coordinates or pixel coordinates.\n   */\n  getViewMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion;\n\n  /**\n   * Gets content metrics in either pixel or workspace coordinates.\n   * The content area is a rectangle around all the top bounded elements on the\n   * workspace (workspace comments and blocks).\n   *\n   * @param opt_getWorkspaceCoordinates True to get the content metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The metrics for the content container.\n   */\n  getContentMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion;\n\n  /**\n   * Returns an object with all the metrics required to size scrollbars for a\n   * top level workspace.  The following properties are computed:\n   * Coordinate system: pixel coordinates, -left, -up, +right, +down\n   * .viewHeight: Height of the visible portion of the workspace.\n   * .viewWidth: Width of the visible portion of the workspace.\n   * .contentHeight: Height of the content.\n   * .contentWidth: Width of the content.\n   * .svgHeight: Height of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .svgWidth: Width of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .viewTop: Top-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .viewLeft: Left-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .contentTop: Top-edge of the content, relative to the workspace origin.\n   * .contentLeft: Left-edge of the content relative to the workspace origin.\n   * .absoluteTop: Top-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .absoluteLeft: Left-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .toolboxWidth: Width of the toolbox, if it exists.  Otherwise zero.\n   * .toolboxHeight: Height of the toolbox, if it exists.  Otherwise zero.\n   * .flyoutWidth: Width of the flyout if it is always open.  Otherwise zero.\n   * .flyoutHeight: Height of the flyout if it is always open.  Otherwise zero.\n   * .toolboxPosition: Top, bottom, left or right. Use TOOLBOX_AT constants to\n   *     compare.\n   *\n   * @returns Contains size and position metrics of a top level workspace.\n   */\n  getMetrics(): Metrics;\n\n  /**\n   * Returns common metrics used by UI elements.\n   *\n   * @returns The UI metrics.\n   */\n  getUiMetrics(): UiMetrics;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IKeyboardAccessible\n\nimport {KeyboardShortcut} from '../shortcut_registry.js';\n\n/**\n * An interface for an object that handles keyboard shortcuts.\n */\nexport interface IKeyboardAccessible {\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(shortcut: KeyboardShortcut): boolean;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IFlyout\n\nimport type {BlockSvg} from '../block_svg.js';\nimport {FlyoutItem} from '../flyout_base.js';\nimport type {Coordinate} from '../utils/coordinate.js';\nimport type {Svg} from '../utils/svg.js';\nimport type {FlyoutDefinition} from '../utils/toolbox.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\nimport type {IRegistrable} from './i_registrable.js';\n\n/**\n * Interface for a flyout.\n */\nexport interface IFlyout extends IRegistrable {\n  /** Whether the flyout is laid out horizontally or not. */\n  horizontalLayout: boolean;\n\n  /** Is RTL vs LTR. */\n  RTL: boolean;\n\n  /** The target workspace */\n  targetWorkspace: WorkspaceSvg | null;\n\n  /** Margin around the edges of the blocks in the flyout. */\n  readonly MARGIN: number;\n\n  /** Does the flyout automatically close when a block is created? */\n  autoClose: boolean;\n\n  /** Corner radius of the flyout background. */\n  readonly CORNER_RADIUS: number;\n\n  /**\n   * Creates the flyout's DOM.  Only needs to be called once.  The flyout can\n   * either exist as its own svg element or be a g element nested inside a\n   * separate svg element.\n   *\n   * @param tagName The type of tag to put the flyout in. This should be <svg>\n   *     or <g>.\n   * @returns The flyout's SVG group.\n   */\n  createDom(\n    tagName: string | Svg<SVGSVGElement> | Svg<SVGGElement>,\n  ): SVGElement;\n\n  /**\n   * Initializes the flyout.\n   *\n   * @param targetWorkspace The workspace in which to create new blocks.\n   */\n  init(targetWorkspace: WorkspaceSvg): void;\n\n  /**\n   * Dispose of this flyout.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose(): void;\n\n  /**\n   * Get the width of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getWidth(): number;\n\n  /**\n   * Get the height of the flyout.\n   *\n   * @returns The height of the flyout.\n   */\n  getHeight(): number;\n\n  /**\n   * Get the workspace inside the flyout.\n   *\n   * @returns The workspace inside the flyout.\n   */\n  getWorkspace(): WorkspaceSvg;\n\n  /**\n   * Is the flyout visible?\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean;\n\n  /**\n   * Set whether the flyout is visible. A value of true does not necessarily\n   * mean that the flyout is shown. It could be hidden because its container is\n   * hidden.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean): void;\n\n  /**\n   * Set whether this flyout's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean): void;\n\n  /** Hide and empty the flyout. */\n  hide(): void;\n\n  /**\n   * Show and populate the flyout.\n   *\n   * @param flyoutDef Contents to display in the flyout. This is either an array\n   *     of Nodes, a NodeList, a toolbox definition, or a string with the name\n   *     of the dynamic category.\n   */\n  show(flyoutDef: FlyoutDefinition | string): void;\n\n  /**\n   * Returns the list of flyout items currently present in the flyout.\n   * The `show` method parses the flyout definition into a list of actual\n   * flyout items. This method should return those concrete items, which\n   * may be used for e.g. keyboard navigation.\n   *\n   * @returns List of flyout items.\n   */\n  getContents(): FlyoutItem[];\n\n  /**\n   * Create a copy of this block on the workspace.\n   *\n   * @param originalBlock The block to copy from the flyout.\n   * @returns The newly created block.\n   * @throws {Error} if something went wrong with deserialization.\n   */\n  createBlock(originalBlock: BlockSvg): BlockSvg;\n\n  /** Reflow blocks and their mats. */\n  reflow(): void;\n\n  /**\n   * @returns True if this flyout may be scrolled with a scrollbar or by\n   *     dragging.\n   */\n  isScrollable(): boolean;\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  getX(): number;\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  getY(): number;\n\n  /** Position the flyout. */\n  position(): void;\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   */\n  isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean;\n\n  /**\n   * Does this flyout allow you to create a new instance of the given block?\n   * Used for deciding if a block can be \"dragged out of\" the flyout.\n   *\n   * @param block The block to copy from the flyout.\n   * @returns True if you can create a new instance of the block, false\n   *     otherwise.\n   */\n  isBlockCreatable(block: BlockSvg): boolean;\n\n  /** Scroll the flyout to the beginning of its contents. */\n  scrollToStart(): void;\n}\n", "/**\n * @license\n * Copyright 2024 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Coordinate} from '../utils/coordinate';\n\nexport interface IDragger {\n  /**\n   * Handles any drag startup.\n   *\n   * @param e PointerEvent that started the drag.\n   */\n  onDragStart(e: PointerEvent): void;\n\n  /**\n   * Handles dragging, including calculating where the element should\n   * actually be moved to.\n   *\n   * @param e PointerEvent that continued the drag.\n   * @param totalDelta The total distance, in pixels, that the mouse\n   *     has moved since the start of the drag.\n   */\n  onDrag(e: PointerEvent, totalDelta: Coordinate): void;\n\n  /**\n   * Handles any drag cleanup.\n   *\n   * @param e PointerEvent that finished the drag.\n   * @param totalDelta The total distance, in pixels, that the mouse\n   *     has moved since the start of the drag.\n   */\n  onDragEnd(e: PointerEvent, totalDelta: Coordinate): void;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IDragTarget\n\nimport {Rect} from '../utils/rect.js';\nimport type {IComponent} from './i_component.js';\nimport {IDraggable} from './i_draggable.js';\n\n/**\n * Interface for a component with custom behaviour when a block or bubble is\n * dragged over or dropped on top of it.\n */\nexport interface IDragTarget extends IComponent {\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  getClientRect(): Rect | null;\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   */\n  onDragEnter(dragElement: IDraggable): void;\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   */\n  onDragOver(dragElement: IDraggable): void;\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   */\n  onDragExit(dragElement: IDraggable): void;\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   */\n  onDrop(dragElement: IDraggable): void;\n\n  /**\n   * Returns whether the provided block or bubble should not be moved after\n   * being dropped on this component. If true, the element will return to where\n   * it was when the drag started.\n   *\n   * @param dragElement The block or bubble currently being dragged.\n   * @returns Whether the block or bubble provided should be returned to drag\n   *     start.\n   */\n  shouldPreventMove(dragElement: IDraggable): boolean;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IDeleteArea\n\nimport type {IDragTarget} from './i_drag_target.js';\nimport type {IDraggable} from './i_draggable.js';\n\n/**\n * Interface for a component that can delete a block or bubble that is dropped\n * on top of it.\n */\nexport interface IDeleteArea extends IDragTarget {\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  wouldDelete(element: IDraggable): boolean;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IContextMenu\n\nexport interface IContextMenu {\n  /**\n   * Show the context menu for this object.\n   *\n   * @param e Mouse event.\n   */\n  showContextMenu(e: Event): void;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {BlockSvg} from '../block_svg';\nimport type {RenderedConnection} from '../rendered_connection';\n\n/**\n * Displays visual \"previews\" of where a block will be connected if it is\n * dropped.\n */\nexport interface IConnectionPreviewer {\n  /**\n   * Display a connection preview where the draggedCon connects to the\n   * staticCon, replacing the replacedBlock (currently connected to the\n   * staticCon).\n   *\n   * @param draggedCon The connection on the block stack being dragged.\n   * @param staticCon The connection not being dragged that we are\n   *     connecting to.\n   * @param replacedBlock The block currently connected to the staticCon that\n   *     is being replaced.\n   */\n  previewReplacement(\n    draggedConn: RenderedConnection,\n    staticConn: RenderedConnection,\n    replacedBlock: BlockSvg,\n  ): void;\n\n  /**\n   * Display a connection preview where the draggedCon connects to the\n   * staticCon, and no block is being relaced.\n   *\n   * @param draggedCon The connection on the block stack being dragged.\n   * @param staticCon The connection not being dragged that we are\n   *     connecting to.\n   */\n  previewConnection(\n    draggedConn: RenderedConnection,\n    staticConn: RenderedConnection,\n  ): void;\n\n  /** Hide any previews that are currently displayed. */\n  hidePreview(): void;\n\n  /** Dispose of any references held by this connection previewer. */\n  dispose(): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IConnectionChecker\n\nimport type {Connection} from '../connection.js';\nimport type {RenderedConnection} from '../rendered_connection.js';\n\n/**\n * Class for connection type checking logic.\n */\nexport interface IConnectionChecker {\n  /**\n   * Check whether the current connection can connect with the target\n   * connection.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Whether the connection is legal.\n   */\n  canConnect(\n    a: Connection | null,\n    b: Connection | null,\n    isDragging: boolean,\n    opt_distance?: number,\n  ): boolean;\n\n  /**\n   * Checks whether the current connection can connect with the target\n   * connection, and return an error code if there are problems.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Connection.CAN_CONNECT if the connection is legal, an error code\n   *     otherwise.\n   */\n  canConnectWithReason(\n    a: Connection | null,\n    b: Connection | null,\n    isDragging: boolean,\n    opt_distance?: number,\n  ): number;\n\n  /**\n   * Helper method that translates a connection error code into a string.\n   *\n   * @param errorCode The error code.\n   * @param a One of the two connections being checked.\n   * @param b The second of the two connections being checked.\n   * @returns A developer-readable error string.\n   */\n  getErrorMessage(\n    errorCode: number,\n    a: Connection | null,\n    b: Connection | null,\n  ): string;\n\n  /**\n   * Check that connecting the given connections is safe, meaning that it would\n   * not break any of Blockly's basic assumptions (e.g. no self connections).\n   *\n   * @param a The first of the connections to check.\n   * @param b The second of the connections to check.\n   * @returns An enum with the reason this connection is safe or unsafe.\n   */\n  doSafetyChecks(a: Connection | null, b: Connection | null): number;\n\n  /**\n   * Check whether this connection is compatible with another connection with\n   * respect to the value type system.  E.g. square_root(\"Hello\") is not\n   * compatible.\n   *\n   * @param a Connection to compare.\n   * @param b Connection to compare against.\n   * @returns True if the connections share a type.\n   */\n  doTypeChecks(a: Connection, b: Connection): boolean;\n\n  /**\n   * Check whether this connection can be made by dragging.\n   *\n   * @param a Connection to compare.\n   * @param b Connection to compare against.\n   * @param distance The maximum allowable distance between connections.\n   * @returns True if the connection is allowed during a drag.\n   */\n  doDragChecks(\n    a: RenderedConnection,\n    b: RenderedConnection,\n    distance: number,\n  ): boolean;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IComponent\n\n/**\n * The interface for a workspace component that can be registered with the\n * ComponentManager.\n */\nexport interface IComponent {\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  id: string;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.ICollapsibleToolboxItem\n\nimport type {ISelectableToolboxItem} from './i_selectable_toolbox_item.js';\nimport type {IToolboxItem} from './i_toolbox_item.js';\n\n/**\n * Interface for an item in the toolbox that can be collapsed.\n */\nexport interface ICollapsibleToolboxItem extends ISelectableToolboxItem {\n  /**\n   * Gets any children toolbox items. (ex. Gets the subcategories)\n   *\n   * @returns The child toolbox items.\n   */\n  getChildToolboxItems(): IToolboxItem[];\n\n  /**\n   * Whether the toolbox item is expanded to show its child subcategories.\n   *\n   * @returns True if the toolbox item shows its children, false if it is\n   *     collapsed.\n   */\n  isExpanded(): boolean;\n\n  /** Toggles whether or not the toolbox item is expanded. */\n  toggleExpanded(): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IBubble\n\nimport type {Coordinate} from '../utils/coordinate.js';\nimport type {IContextMenu} from './i_contextmenu.js';\nimport type {IDraggable} from './i_draggable.js';\n\n/**\n * A bubble interface.\n */\nexport interface IBubble extends IDraggable, IContextMenu {\n  /**\n   * Return the coordinates of the top-left corner of this bubble's body\n   * relative to the drawing surface's origin (0,0), in workspace units.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  getRelativeToSurfaceXY(): Coordinate;\n\n  /**\n   * Return the root node of the bubble's SVG group.\n   *\n   * @returns The root SVG node of the bubble's group.\n   */\n  getSvgRoot(): SVGElement;\n\n  /**\n   * Sets whether or not this bubble is being dragged.\n   *\n   * @param adding True if dragging, false otherwise.\n   */\n  setDragging(dragging: boolean): void;\n\n  /**\n   * Move this bubble during a drag.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   */\n  moveDuringDrag(newLoc: Coordinate): void;\n\n  /**\n   * Move the bubble to the specified location in workspace coordinates.\n   *\n   * @param x The x position to move to.\n   * @param y The y position to move to.\n   */\n  moveTo(x: number, y: number): void;\n\n  /**\n   * Update the style of this bubble when it is dragged over a delete area.\n   *\n   * @param enable True if the bubble is about to be deleted, false otherwise.\n   */\n  setDeleteStyle(enable: boolean): void;\n\n  /** Dispose of this bubble. */\n  dispose(): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IBoundedElement\n\nimport type {Rect} from '../utils/rect.js';\n\n/**\n * A bounded element interface.\n */\nexport interface IBoundedElement {\n  /**\n   * Returns the coordinates of a bounded element describing the dimensions of\n   * the element. Coordinate system: workspace coordinates.\n   *\n   * @returns Object with coordinates of the bounded element.\n   */\n  getBoundingRectangle(): Rect;\n\n  /**\n   * Move the element by a relative offset.\n   *\n   * @param dx Horizontal offset in workspace units.\n   * @param dy Vertical offset in workspace units.\n   * @param reason Why is this move happening?  'user', 'bump', 'snap'...\n   */\n  moveBy(dx: number, dy: number, reason?: string[]): void;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IAutoHideable\n\nimport type {IComponent} from './i_component.js';\n\n/**\n * Interface for a component that can be automatically hidden.\n */\nexport interface IAutoHideable extends IComponent {\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *   Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IASTNodeLocationWithBlock\n\nimport type {Block} from '../block.js';\nimport type {IASTNodeLocation} from './i_ast_node_location.js';\n\n/**\n * An AST node location that has an associated block.\n */\nexport interface IASTNodeLocationWithBlock extends IASTNodeLocation {\n  /**\n   * Get the source block associated with this node.\n   *\n   * @returns The source block.\n   */\n  getSourceBlock(): Block | null;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IASTNodeLocationSvg\n\nimport type {IASTNodeLocation} from './i_ast_node_location.js';\n\n/**\n * An AST node location SVG interface.\n */\nexport interface IASTNodeLocationSvg extends IASTNodeLocation {\n  /**\n   * Add the marker SVG to this node's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the SVG group.\n   */\n  setMarkerSvg(markerSvg: SVGElement | null): void;\n\n  /**\n   * Add the cursor SVG to this node's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the SVG group.\n   */\n  setCursorSvg(cursorSvg: SVGElement | null): void;\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Former goog.module ID: Blockly.IASTNodeLocation\n\n/**\n * An AST node location interface.\n */\nexport interface IASTNodeLocation {}\n"],
  "mappings": "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",
  "names": ["register", "validate", "unregister", "getItem", "hasItem", "getClass", "getObject", "getAllItems", "getClassFromOptions", "warn", "getNextUniqueId", "genUid", "isBlockCreate", "isBlockDelete", "isBlockChange", "isBlockFieldIntermediateChange", "isBlockMove", "isVarCreate", "isVarDelete", "isVarRename", "isBlockDrag", "isSelected", "isClick", "isMarkerMove", "isBubbleOpen", "isTrashcanOpen", "isToolboxItemSelect", "isThemeChange", "isViewportChange", "isCommentCreate", "isCommentDelete", "isCommentChange", "isCommentMove", "isCommentResize", "isCommentDrag", "isCommentCollapse", "isFinishedLoading", "getRecordUndo", "fire", "fireInternal", "fireNow", "enqueueEvent", "filter", "clearPendingUndo", "isEnabled", "setGroupInternal", "getDescendantIds", "fromJson", "get", "disableOrphans", "getWorkspaceById", "getAllWorkspaces", "registerWorkspace", "unregisterWorkpace", "getMainWorkspace", "setMainWorkspace", "getSelected", "getParentContainer", "setParentContainer", "svgResize", "getBlockTypeCounts", "jsonInitFactory", "defineBlocksWithJsonArray", "defineBlocksWithJsonArrayInternal", "longStart", "longStop", "clearTouchIdentifier", "shouldHandleEvent", "getTouchIdentifierFromEvent", "checkTouchIdentifier", "conditionalBind", "bind", "unbind", "isTargetInput", "isRightButton", "mouseToSvg", "getScrollDeltaPixels", "removeElem", "inject", "createSvgElement", "addClass", "removeClasses", "removeClass", "hasClass", "removeNode", "insertAfter", "setCssTransform", "startTextWidthCache", "stopTextWidthCache", "getTextWidth", "getFastTextWidth", "getFastTextWidthWithSizeString", "measureFontMetrics", "getSize", "getSizeInternal", "getSizeWithDisplay", "getComputedStyle", "getPageOffset", "getViewportPageOffset", "getBorderBox", "scrollIntoContainerView", "getContainerOffsetToScrollInto", "getRelativeXY", "getInjectionDivXY", "getViewportBBox", "getDocumentScroll", "screenToWsCoordinates", "wsToScreenCoordinates", "injectDependencies", "domToText", "sanitizeText", "convertToolboxDefToJson", "validateToolbox", "convertFlyoutDefToJsonArray", "hasCategories", "hasCategoriesInternal", "isCategoryCollapsible", "convertToToolboxJson", "xmlToJsonArray", "addAttributes", "parseToolboxTree", "getStartPositionRect", "getCornerOppositeToolbox", "bumpPositionRect", "save", "append", "moveCommentToNotConflict", "commentOverlapsOtherExactly", "setRole", "setState", "isSerializable", "queueRender", "finishQueuedRenders", "triggerQueuedRenders", "alwaysImmediatelyRender", "queueBlock", "doRenders", "dequeueBlock", "shouldRenderRootBlock", "renderBlock", "alert", "setAlert", "confirm", "confirmInternal", "setConfirm", "prompt", "setPrompt", "isLegacyProcedureDefBlock", "isLegacyProcedureCallBlock", "isVariableBackedParameterModel", "flyoutCategory", "flyoutCategoryBlocks", "generateUniqueName", "generateUniqueNameInternal", "generateUniqueNameFromOptions", "createVariableButtonHandler", "promptName", "nameUsedWithOtherType", "nameUsedWithAnyType", "nameUsedWithConflictingParam", "checkForConflictingParamWithProcedureModels", "checkForConflictingParamWithLegacyProcedures", "generateVariableFieldDom", "createVariable", "getAddedVariables", "saveAttributes", "saveCoords", "saveExtraState", "saveIcons", "saveFields", "saveInputBlocks", "saveNextBlocks", "saveConnection", "appendInternal", "appendPrivate", "checkNewVariables", "loadCoords", "loadAttributes", "loadExtraState", "tryToConnectParent", "loadIcons", "loadFields", "loadInputBlocks", "loadNextBlocks", "loadConnection", "initBlock", "hasBubble", "toRadians", "toDegrees", "clamp", "createDom", "setBoundsElement", "getOwner", "getContentDiv", "clearContent", "setColour", "showPositionedByBlock", "showPositionedByField", "getScaledBboxOfBlock", "getScaledBboxOfField", "showPositionedByRect", "show", "getPositionBelowMetrics", "getPositionAboveMetrics", "getPositionTopOfPageMetrics", "getPositionX", "isVisible", "hideIfOwner", "hide", "hideWithoutAnimation", "positionInternal", "repositionForWindowResize", "shortestStringLength", "commonWordPrefix", "commonWordSuffix", "wrapLine", "wrapScore", "wrapMutate", "wrapToText", "setCustomTooltip", "getCustomTooltip", "getDiv", "getTooltipOfObject", "getTargetObject", "bindMouseEvents", "unbindMouseEvents", "onMouseOver", "onMouseOut", "onMouseMove", "dispose", "block", "unblock", "renderContent", "renderDefaultContent", "getPosition", "getHsvSaturation", "setHsvSaturation", "getHsvValue", "setHsvValue", "parse", "rgbToHex", "hexToRgb", "hsvToHex", "blend", "hueToHex", "tokenizeInterpolationInternal", "tokenizeInterpolation", "replaceMessageReferences", "checkMessageReferences", "parseBlockColour", "testOnly_setDiv", "hideIfOwnerIsInWorkspace", "positionWithAnchor", "calculateX", "calculateY", "isRepositionable", "getCurrentBlock", "setCurrentBlock", "populate_", "position_", "createWidget_", "haltPropagation", "mouseToWorkspacePoint", "start", "move", "workspaceToDom", "saveWorkspaceComment", "variablesToDom", "blockToDomWithXY", "fieldToDom", "allFieldsToDom", "blockToDom", "cloneShadow", "domToPrettyText", "clearWorkspaceAndLoadFromXml", "loadWorkspaceComment", "appendDomToWorkspace", "domToBlockInternal", "domToVariables", "mapSupportedXmlTags", "applyMutationTagNodes", "applyCommentTagNodes", "applyDataTagNodes", "applyFieldTagNodes", "findChildBlocks", "applyInputTagNodes", "applyNextTagNodes", "domToBlockHeadless", "domToField", "deleteNext", "isElement", "disposeUiEffect", "disposeUiStep", "connectionUiEffect", "disconnectUiEffect", "disconnectUiStep", "disconnectUiStop", "isDraggable", "deepMerge", "fromJsonInternal", "isRegistered", "apply", "checkNoMutatorProperties", "checkXmlHooks", "checkJsonHooks", "checkMutatorDialog", "checkHasFunctionPair", "checkHasMutatorProperties", "getMutatorProperties", "mutatorPropertiesMatch", "runAfterPageLoad", "checkDropdownOptionsInTable", "extensionParentTooltip", "point", "curve", "moveTo", "moveBy", "lineTo", "line", "lineOnAxis", "arc", "isProcedureBlock", "isObservable", "allProcedures", "procTupleComparator", "isLegalName", "isNameUsed", "updateMutatorFlyout", "mutatorOpenListener", "mutatorChangeListener", "getCallers", "blockIsModernCallerFor", "isDynamicShape", "isPuzzleTab", "isNotch", "connectReciprocally", "getSingleConnection", "getConnectionForOrphanedOutput", "isIcon", "isCommentIcon", "getParentConnection", "init", "stringButtonClickHandler", "numberButtonClickHandler", "colourButtonClickHandler", "resizeSvgContents", "moveBlockToNotConflict", "blockOverlapsOtherExactly", "blockIsInSnapRadius", "bumpObjectIntoBounds", "bumpIntoBoundsHandler", "extractObjectFromEvent", "bumpTopObjectsIntoBounds", "isDeletable", "copyInternal", "paste", "pasteFromData", "duplicateInternal", "isCopyable", "registerEscape", "registerDelete", "registerCopy", "registerCut", "registerPaste", "registerUndo", "registerRedo", "registerDefaultShortcuts", "saveProcedure", "loadProcedure", "load", "createMainWorkspace", "onKeyDown", "bindDocumentEvents", "loadSounds", "registerCleanup", "toggleOption_", "registerCollapse", "registerExpand", "addDeletableBlocks_", "getDeletableBlocks_", "deleteNext_", "registerDeleteAll", "registerWorkspaceOptions_", "registerDuplicate", "registerComment", "registerInline", "registerCollapseExpandBlock", "registerDisable", "registerHelp", "registerCommentDelete", "registerCommentDuplicate", "registerCommentCreate", "pixelsToWorkspaceCoords", "registerBlockOptions_", "registerCommentOptions", "registerDefaultOptions", "isPaster", "isRenderedElement", "isSelectable", "isSelectableToolboxItem", "hideChaff", "type", "name", "registryItem", "opt_allowOverrides", "Type", "trim", "Error", "toLowerCase", "caselessName", "typeRegistry", "typeMap", "nameRegistry", "nameMap", "Object", "create", "String", "FIELD", "console", "opt_throwIfMissing", "msg", "opt_cased", "casedRegistry", "key", "keys", "options", "plugin", "plugins", "DEFAULT", "deprecationDate", "deletionDate", "opt_use", "previousWarnings", "has", "add", "nextId", "toString", "internal", "event", "EventType", "BLOCK_CREATE", "BLOCK_DELETE", "BLOCK_CHANGE", "BLOCK_FIELD_INTERMEDIATE_CHANGE", "BLOCK_MOVE", "VAR_CREATE", "VAR_DELETE", "VAR_RENAME", "BLOCK_DRAG", "SELECTED", "CLICK", "MARKER_MOVE", "BUBBLE_OPEN", "TRASHCAN_OPEN", "TOOLBOX_ITEM_SELECT", "THEME_CHANGE", "VIEWPORT_CHANGE", "COMMENT_CREATE", "COMMENT_DELETE", "COMMENT_CHANGE", "COMMENT_MOVE", "COMMENT_RESIZE", "COMMENT_DRAG", "COMMENT_COLLAPSE", "FINISHED_LOADING", "setRecordUndo", "newValue", "recordUndo", "TEST_ONLY", "FIRE_QUEUE", "length", "requestAnimationFrame", "setTimeout", "queue", "workspaceId", "fireChangeListener", "element", "i", "otherEvent", "group", "newParentId", "blockId", "splice", "push", "forward", "slice", "reverse", "mergedQueue", "lastEvent", "isNull", "newInputName", "newCoordinate", "reason", "Array", "from", "Set", "concat", "viewTop", "viewLeft", "scale", "oldScale", "e", "disable", "disabled", "enable", "getGroup", "setGroup", "state", "ids", "descendants", "getDescendants", "descendant", "id", "json", "workspace", "eventClass", "eventType", "EVENT", "eventWorkspace", "getBlockById", "initialUndoFlag", "parent", "getParent", "hasDisabledReason", "ORPHANED_BLOCK_DISABLED_REASON", "children", "child", "setDisabledReason", "outputConnection", "previousConnection", "isDragging", "getNextBlock", "WorkspaceDB_", "workspaces", "mainWorkspace", "selected", "setSelected", "newSelection", "unselect", "select", "parentContainer", "newParent", "parentWorkspace", "svg", "getParentSvg", "cachedSize", "getCachedParentSvgSize", "div", "parentElement", "HTMLElement", "width", "offsetWidth", "height", "offsetHeight", "setAttribute", "setCachedParentSvgSize", "resize", "opt_stripFollowing", "typeCountsMap", "nextBlock", "index", "indexOf", "checkBlock", "jsonDef", "jsonInit", "jsonArray", "defineBlocks", "createBlockDefinitionsFromJsonArray", "blocks", "elem", "definition", "Blocks", "gesture", "longPid_", "handleRightClick", "LONGPRESS", "clearTimeout", "touchIdentifier_", "startsWith", "PointerEvent", "pointerId", "identifier", "node", "thisObject", "func", "opt_noCaptureIdentifier", "wrapFunc", "call", "bindData", "TOUCH_MAP", "addEventListener", "callback", "pop", "removeEventListener", "target", "isContentEditable", "getAttribute", "HTMLInputElement", "HTMLTextAreaElement", "ctrlKey", "MAC", "button", "matrix", "svgPoint", "createSVGPoint", "x", "clientX", "y", "clientY", "getScreenCTM", "inverse", "matrixTransform", "deltaMode", "deltaX", "deltaY", "LINE_MODE_MULTIPLIER", "PAGE_MODE_MULTIPLIER", "arr", "value", "cssContent", "injected", "content", "hasCss", "pathToMedia", "mediaPath", "replace", "cssNode", "document", "createElement", "cssTextNode", "createTextNode", "appendChild", "head", "insertBefore", "firstChild", "attrs", "opt_parent", "createElementNS", "SVG_NS", "className", "classNames", "split", "every", "classList", "contains", "remove", "parentNode", "removeChild", "newNode", "refNode", "siblingNode", "nextSibling", "transform", "style", "cacheReference", "cacheWidths", "textElement", "textContent", "baseVal", "getComputedTextLength", "fontSize", "fontWeight", "fontFamily", "text", "canvasContext", "computeCanvas", "body", "getContext", "font", "measureText", "span", "display", "position", "top", "left", "result", "baseline", "alignItems", "offsetTop", "originalDisplay", "originalVisibility", "visibility", "originalPosition", "Size", "property", "styles", "window", "getPropertyValue", "el", "pos", "Coordinate", "box", "getBoundingClientRect", "documentElement", "scrollCoord", "pageXOffset", "scrollLeft", "pageYOffset", "scrollTop", "parseFloat", "right", "bottom", "Rect", "container", "opt_center", "offset", "elementPos", "containerPos", "containerBorder", "relX", "relY", "elementSize", "spaceX", "clientWidth", "spaceY", "clientHeight", "Math", "min", "max", "xy", "parseInt", "r", "match", "XY_REGEX", "Number", "includes", "styleComponents", "XY_STYLE_REGEX", "scrollOffset", "win", "ws", "screenCoordinates", "screenX", "screenY", "boundingRect", "getInjectionDiv", "injectionDiv", "clientOffsetPixels", "mainOffsetPixels", "getOriginOffsetInPixels", "difference", "finalOffsetPixels", "finalOffsetMainWs", "workspaceCoordinates", "mainOffset", "dependencies", "DOMParser", "XMLSerializer", "domParser", "xmlSerializer", "tagName", "NAME_SPACE", "textToDom", "doc", "parseFromString", "getElementsByTagName", "nodeName", "dom", "serializeToString", "INVALID_CONTROL_CHARS", "charCodeAt", "toolboxDef", "Element", "toolboxJson", "toolboxKind", "toolboxContents", "FLYOUT_TOOLBOX_KIND", "CATEGORY_TOOLBOX_KIND", "flyoutDef", "isArray", "nodeType", "item", "toUpperCase", "categories", "categoryInfo", "contents", "Node", "childNodes", "obj", "j", "attributes", "attr", "parsedToolboxDef", "TypeError", "size", "horizontalPadding", "verticalPadding", "metrics", "hasVerticalScrollbar", "scrollbar", "canScrollVertically", "horizontal", "horizontalPosition", "LEFT", "absoluteMetrics", "RTL", "Scrollbar", "scrollbarThickness", "viewMetrics", "vertical", "verticalPosition", "TOP", "canScrollHorizontally", "toolboxMetrics", "Position", "horizontalLayout", "RIGHT", "BOTTOM", "startRect", "margin", "bumpDir", "savedPositions", "otherEl", "intersects", "bumpDirection", "UP", "serializer", "SERIALIZER", "comment", "addCoordinates", "saveIds", "loc", "getRelativeToSurfaceXY", "getWidth", "getText", "isCollapsed", "collapsed", "isOwnEditable", "editable", "isOwnMovable", "movable", "isOwnDeletable", "deletable", "prevRecordUndo", "newComment", "undefined", "setText", "defaultLoc", "defaultSize", "setSize", "setCollapsed", "setEditable", "setMovable", "setDeletable", "paster", "PASTER", "coord", "otherCoords", "getTopComments", "otherComment", "map", "c", "sum", "translate", "translateDistance", "some", "otherCoord", "abs", "roleName", "ROLE_ATTRIBUTE", "stateName", "join", "ARIA_PREFIX", "saveState", "loadState", "Promise", "resolve", "afterRendersPromise", "afterRendersResolver", "animationRequestId", "cancelAnimationFrame", "JavaFx", "dirtyBlocks", "eventGroups", "set", "rootBlocks", "b", "resizeContents", "blockOrigin", "updateComponentLocations", "oldGroup", "newGroup", "bumpNeighbours", "delete", "getChildren", "isDisposed", "initialized", "renderEfficiently", "message", "opt_callback", "alertImplementation", "alertFunction", "confirmImplementation", "confirmFunction", "defaultValue", "promptImplementation", "promptFunction", "getProcedureDef", "getProcedureCall", "renameProcedure", "param", "getVariableModel", "allUsedVarModels", "getAllBlocks", "variables", "blockVariables", "getVarModels", "variable", "getId", "values", "allDeveloperVariables", "getDeveloperVariables", "devVars", "xmlList", "registerButtonCallback", "getTargetWorkspace", "blockList", "variableModelList", "getVariablesOfType", "mostRecentVariable", "sort", "VariableModel", "compareByName", "VAR_LETTER_OPTIONS", "charAt", "getAllVariableNames", "startChar", "usedNames", "letters", "suffix", "letterIndex", "inUse", "potName", "opt_type", "promptAndCheckWithAlert", "defaultName", "Msg", "existing", "renameVariable", "promptText", "newName", "procedure", "renameVariableById", "defaultText", "newVar", "allVariables", "getVariableMap", "getAllVariables", "oldName", "getProcedureMap", "getProcedures", "procedures", "params", "getParameters", "procHasOld", "procHasNew", "getName", "def", "blockHasOld", "blockHasNew", "variableModel", "field", "getOrCreateVariablePackage", "opt_name", "getVariable", "potentialVariableMap", "getPotentialVariableMap", "getVariableById", "isFlyout", "targetWorkspace", "originalVariables", "allCurrentVariables", "addedVariables", "addInputBlocks", "addNextBlocks", "doFullSerialization", "isInsertionMarker", "getDisabledReasons", "inputsInline", "inputsInlineDefault", "data", "round", "extraState", "mutationToDom", "icons", "icon", "getIcons", "getType", "fields", "inputList", "input", "fieldRow", "inputs", "connection", "connectionState", "nextConnection", "shadow", "getShadowState", "targetBlock", "isShadow", "rendered", "parentConnection", "existingGroup", "variablesBeforeCreation", "blockSvg", "disposed", "setConnectionTracking", "MissingBlockType", "newBlock", "setShadow", "newVariables", "thisVariable", "MANUALLY_DISABLED", "setInputsInline", "domToMutation", "getSourceBlock", "RealChildOfShadow", "inputTypes", "VALUE", "childConnection", "MissingConnection", "connect", "connected", "checker", "connectionChecker", "BadConnectionCheck", "getErrorMessage", "canConnectWithReason", "iconTypes", "iconType", "iconState", "getIcon", "constructor", "ICON", "UnregisteredIcon", "addIcon", "fieldName", "fieldState", "getField", "inputName", "getInput", "setShadowState", "initSvg", "onLocationChange", "initModel", "bubbleIsVisible", "setBubbleVisible", "angleDegrees", "PI", "angleRadians", "lowerBound", "number", "upperBound", "temp", "querySelector", "arrow", "opacity", "transition", "ANIMATION_TIME", "boundsElem", "boundsElement", "owner", "backgroundColour", "borderColour", "backgroundColor", "borderColor", "opt_onHide", "opt_secondaryYOffset", "positionToField", "getSvgRoot", "scaledHeight", "scaledWidth", "bBox", "getScaledBBox", "primaryX", "primaryY", "secondaryY", "sourceBlock", "newOwner", "rtl", "secondaryX", "onHide", "direction", "renderedClassName", "getRenderer", "getClassName", "themeClassName", "getTheme", "boundsInfo", "divSize", "xCoords", "initialX", "divX", "initialY", "finalX", "finalY", "PADDING_Y", "arrowX", "arrowY", "ARROW_SIZE", "BORDER_SIZE", "arrowAtTop", "arrowVisible", "sourceX", "boundsLeft", "boundsRight", "divWidth", "relativeArrowX", "horizPadding", "ARROW_HORIZONTAL_PADDING", "divOwner", "opt_withoutAnimation", "animateOutTimer", "markFocused", "getPositionMetrics", "floor", "array", "reduce", "a", "opt_shortest", "wordPrefix", "len", "letter", "substr", "wrap", "limit", "lines", "words", "score", "lastText", "lineCount", "lastScore", "wordBreaks", "steps", "insertedBreaks", "lineLengths", "linePunctuation", "maxLength", "pow", "bestScore", "bestBreaks", "mutatedWordBreaks", "mutatedScore", "isNumber", "str", "test", "customFn", "customTooltip", "visible", "containerDiv", "object", "tooltip", "mouseOverWrapper_", "mouseOutWrapper_", "blocked", "newElement", "currentTarget", "poisonedElement", "mouseOutPid", "_e", "showPid", "dx", "lastX", "pageX", "dy", "lastY", "pageY", "sqrt", "RADIUS_OK", "HOVER_MS", "tip", "LIMIT", "windowWidth", "windowHeight", "anchorX", "OFFSET_X", "anchorY", "OFFSET_Y", "scrollY", "MARGINS", "scrollX", "hsvSaturation", "newSaturation", "hsvValue", "hex", "names", "substring", "rgb", "g", "colour", "h", "s", "v", "red", "green", "blue", "sextant", "remainder", "val1", "val2", "val3", "colour1", "colour2", "factor", "hex1", "hex2", "rgb1", "rgb2", "hue", "parseInterpolationTokens", "tokenizeNewlines", "tokens", "chars", "buffer", "rawKey", "keyUpper", "bklyKey", "rawValue", "prototype", "mergedTokens", "interpolatedResult", "validSoFar", "msgTable", "m", "msgKey", "dereferenced", "isNaN", "errorMsg", "newDiv", "containerClassName", "newDispose", "Field", "ownerWorkspace", "rendererWorkspace", "rendererClassName", "oldOwner", "oldOwnerWorkspace", "viewportBBox", "anchorBBox", "widgetSize", "currentBlock", "dummyOwner", "menu", "menu_", "focus", "Menu", "Role", "MENU", "option", "menuItem", "MenuItem", "setRightToLeft", "MENUITEM", "addChild", "setEnabled", "enabled", "onAction", "actionHandler", "scope", "menuSize", "menuDom", "render", "preventDefault", "stopPropagation", "callbackFactory", "config", "snapRadius", "getInverseScreenCTM", "workspaceToDragDelta", "dragDelta", "skipId", "treeXml", "variablesElement", "hasChildNodes", "getTopBlocks", "variableList", "opt_noId", "DocumentFragment", "toXml", "fieldDom", "mutation", "hasAttributes", "commentText", "getCommentText", "IconType", "COMMENT", "getBubbleSize", "pinned", "commentElement", "dataElement", "empty", "DUMMY", "END_ROW", "childBlock", "STATEMENT", "childShadow", "getShadowDom", "childElem", "NodeType", "ELEMENT_NODE", "encodeURIComponent", "nextElem", "nextShadow", "cloneNode", "textNode", "removeAttribute", "TEXT_NODE", "blob", "indent", "xml", "setResizesEnabled", "clear", "blockIds", "domToWorkspace", "newBlockIds", "variablesFirst", "xmlChild", "xmlChildElement", "blockX", "blockY", "RenderedWorkspaceComment", "WorkspaceComment", "w", "getBlocksBoundingBox", "bbox", "farY", "topX", "newLeftX", "Infinity", "newRightX", "newY", "blockXY", "offsetY", "ySeparation", "offsetX", "domToBlock", "xmlBlock", "topBlock", "topBlockSvg", "xmlVariables", "childNodeMap", "next", "xmlChildren", "shouldCallInitSvg", "setCommentText", "setBubbleSize", "xmlNode", "childBlockElement", "childShadowElement", "prototypeName", "childBlockInfo", "setShadowDom", "isConnected", "connectedToParentNext", "outerHTML", "xmlChildNameMap", "inline", "disabledReasons", "decodeURIComponent", "fromXml", "svgGroup", "getAudioManager", "play", "clone", "getLayerManager", "appendToAnimationLayer", "cloneRect", "Date", "rect", "percent", "getTime", "getSvgXY", "ripple", "Svg", "CIRCLE", "scaleAnimation", "ANIMATE", "opacityAnimation", "beginElement", "getHeightWidth", "magnitude", "atan", "DISPLACEMENT", "wobblingBlock", "step", "WIGGLES", "skew", "DURATION", "val", "disconnectPid", "getTranslation", "isMovable", "startDrag", "drag", "endDrag", "revertDrag", "source", "fieldClass", "fieldObject", "initFn", "allExtensions", "registerMixin", "mixinObj", "mixin", "registerMutator", "opt_helperFn", "opt_blockList", "errorPrefix", "hasMutatorDialog", "setMutator", "MutatorIcon", "isMutator", "extensionFn", "mutatorProperties", "mutationName", "properties", "compose", "decompose", "func1", "func2", "hasXmlHooks", "hasJsonHooks", "oldProperties", "newProperties", "fn", "readyState", "readyStateCheckInterval", "setInterval", "clearInterval", "buildTooltipForDropdown", "dropdownName", "lookupTable", "blockTypesChecked", "setTooltip", "getFieldValue", "dropdown", "FieldDropdown", "isOptionListDynamic", "getOptions", "buildTooltipWithFieldText", "msgTemplate", "tooltipWhenNotConnected", "getInputsInline", "command", "points", "flags", "radius", "iconConstructor", "getProcedureModel", "doProcedureUpdate", "isProcedureDef", "startPublishing", "stopPublishing", "root", "proceduresNoReturn", "p", "getReturnTypes", "pa", "getBlocksByType", "forEach", "proceduresReturn", "ta", "tb", "localeCompare", "sensitivity", "findLegalName", "isInFlyout", "opt_exclude", "Names", "equals", "excludeModel", "model", "rename", "UnattachedFieldError", "legalName", "setName", "getValue", "procedureBlock", "populateProcedures", "procedureList", "templateName", "args", "arg", "nameField", "tuple", "xmlElement", "argBlock", "argValue", "DEFAULT_ARG", "fieldContent", "updateToolbox", "bubbleType", "isOpen", "TYPE", "getWorkspace", "addChangeListener", "procName", "mutateCallers", "defBlock", "oldRecordUndo", "callers", "caller", "oldMutation", "oldMutationDom", "newMutationDom", "newMutation", "getDefinition", "shape", "isDynamic", "pathDown", "pathUp", "pathLeft", "pathRight", "first", "second", "targetConnection", "orphanBlock", "foundConnection", "output", "typeChecker", "getConnectionChecker", "canConnect", "startBlock", "initView", "getWeight", "applyColour", "hideForInsertionMarker", "updateEditable", "updateCollapsed", "isShownWhenCollapsed", "setOffsetInBlock", "onClick", "topConnection", "rendererClass", "RENDERER", "theme", "opt_rendererOverrides", "renderer", "firstVariable", "bumpOffset", "otherBlock", "getConnections_", "closest", "bounds", "objectMetrics", "getBoundingRectangle", "newYPosition", "leftClamp", "rightClamp", "newXPosition", "metricsManager", "getMetricsManager", "hasFixedEdges", "BUMP_EVENTS", "scrollMetricsInWsCoords", "getScrollMetrics", "wasBumped", "getRootBlock", "getCommentById", "commentId", "topBlocks", "getTopBoundedElements", "toCopy", "toCopyData", "stashedCopyData", "stashedWorkspace", "copyData", "coordinate", "getRootWorkspace", "toDuplicate", "ShortcutRegistry", "registry", "escapeAction", "ESCAPE", "preconditionFn", "readOnly", "keyCodes", "KeyCodes", "ESC", "deleteShortcut", "DELETE", "Gesture", "inProgress", "BlockSvg", "checkAndDelete", "BACKSPACE", "ctrlC", "createSerializedKey", "C", "CTRL", "altC", "ALT", "metaC", "META", "copyShortcut", "COPY", "copyWorkspace", "WorkspaceSvg", "copyCoords", "ctrlX", "X", "altX", "metaX", "cutShortcut", "CUT", "ctrlV", "V", "altV", "metaV", "pasteShortcut", "PASTE", "getViewMetrics", "viewportRect", "centerCoords", "ctrlZ", "Z", "altZ", "metaZ", "undoShortcut", "UNDO", "undo", "ctrlShiftZ", "SHIFT", "altShiftZ", "metaShiftZ", "ctrlY", "Y", "redoShortcut", "REDO", "proc", "parameters", "procedureModelClass", "parameterModelClass", "entries", "insertParameter", "serializerMap", "deserializers", "priority", "deserializer", "pluginState", "opt_options", "containerElement", "getElementById", "ownerDocument", "Options", "subContainer", "tabIndex", "State", "LABEL", "widgetContainer", "SVG", "HTML_NS", "XLINK_NS", "defs", "DEFS", "rnd", "random", "gridPattern", "Grid", "gridOptions", "wsOptions", "zoomOptions", "startScale", "languageTree", "flyout", "addFlyout", "hasTrashcan", "addTrashcan", "controls", "addZoomControls", "getThemeManager", "subscribe", "workspaceResizeHandler", "hideComponents", "setResizeHandlerWrapper", "toolbox", "getToolbox", "getFlyout", "scrollToStart", "trashcan", "zoomControls_", "moveOptions", "scrollbars", "ScrollbarPair", "setMetrics", "hasSounds", "documentEventsBound", "updateInverseScreenCTM", "unbindSounds", "soundBinds", "oldSoundBinding", "audioMgr", "preload", "ContextMenuRegistry", "undoOption", "displayText", "getUndoStack", "scopeType", "ScopeType", "WORKSPACE", "weight", "redoOption", "getRedoStack", "cleanOption", "cleanUp", "shouldCollapse", "timeoutFn", "timeoutCounter", "ms", "DELAY", "collapseOption", "collapse", "expandOption", "deleteList", "eventGroup", "shift", "isDeadOrDying", "deleteOption", "deletableBlocksLength", "cancelCurrentGesture", "deletableBlocks", "ok", "duplicateOption", "isDuplicatable", "BLOCK", "commentOption", "hasIcon", "CommentIcon", "comments", "isEditable", "inlineOption", "StatementInput", "collapseExpandOption", "disableOption", "isDisabledForOtherReason", "getInheritedDisabled", "descendantCount", "helpOption", "helpUrl", "showHelp", "createOption", "pixelCoord", "finalOffset", "toolboxItem", "opt_onlyClosePopups", "CONNECTION_CHECKER", "CONNECTION_PREVIEWER", "CURSOR", "INPUT", "TOOLBOX", "THEME", "TOOLBOX_ITEM", "FLYOUTS_VERTICAL_TOOLBOX", "FLYOUTS_HORIZONTAL_TOOLBOX", "METRICS_MANAGER", "BLOCK_DRAGGER", "$jscomp$tmp$exports$module$name", "UI", "soup", "soupLength", "draggingConnections", "Abstract", "isUiEvent", "toJson", "isBlank", "run", "_forward", "getEventWorkspace_", "UiBase", "AbstractEvent", "opt_workspaceId", "Click", "opt_block", "opt_targetType", "targetType", "newEvent", "ClickTarget", "ZOOM_CONTROLS", "TOUCH_ENABLED", "globalThis", "rawUserAgent", "isJavaFx", "isWebKit", "isGecko", "isAndroid", "isIPad", "isIPhone", "isMac", "isTablet", "isMobile", "raw", "rawUpper", "maxTouchPoints", "GECKO", "ANDROID", "IPAD", "IPHONE", "MOBILE", "Capability", "POSITIONABLE", "DRAG_TARGET", "DELETE_AREA", "AUTOHIDEABLE", "ComponentManager", "componentData", "Map", "capabilityToComponentIds", "addComponent", "componentInfo", "component", "capabilities", "stringCapabilities", "capability", "removeComponent", "addCapability", "getComponent", "hasCapability", "removeCapability", "getComponents", "sorted", "componentIds", "components", "componentDataList", "componentDatum", "ComponentWeight", "TOOLBOX_WEIGHT", "FLYOUT_WEIGHT", "TRASHCAN_WEIGHT", "ZOOM_CONTROLS_WEIGHT", "tx", "ty", "distance", "COMMENT_NODE", "CLIPPATH", "FECOMPOSITE", "FECOMPONENTTRANSFER", "FEFLOOD", "FEFUNCA", "FEGAUSSIANBLUR", "FEPOINTLIGHT", "FESPECULARLIGHTING", "FILTER", "FOREIGNOBJECT", "G", "IMAGE", "LINE", "PATH", "PATTERN", "POLYGON", "RECT", "TEXT", "TSPAN", "getHeight", "other", "createFromPoint", "opt_pair", "opt_class", "opt_margin", "oldHostMetrics", "ratio", "origin", "startDragHandle", "handlePosition", "handleLength", "scrollbarLength", "startDragMouse", "containerVisible", "isHandleVisible", "onMouseMoveWrapper_", "onMouseUpWrapper_", "pair", "DEFAULT_SCROLLBAR_MARGIN", "outerSvg", "svgBackground", "svgHandle", "setInitialThickness", "lengthAttribute_", "positionAttribute_", "onMouseDownBarWrapper_", "onMouseDownBar", "onMouseDownHandleWrapper_", "onMouseDownHandle", "unsubscribe", "constrainHandleLength", "setHandleLength", "newLength", "constrainHandlePosition", "setHandlePosition", "newPosition", "setScrollbarLength", "newSize", "setPosition", "opt_metrics", "hostMetrics", "getMetrics", "metricsAreEquivalent", "resizeHorizontal", "resizeVertical", "updateMetrics", "requiresViewResize", "viewWidth", "viewHeight", "absoluteLeft", "absoluteTop", "resizeViewHorizontal", "resizeContentHorizontal", "viewSize", "xCoordinate", "scrollWidth", "setVisible", "maxScrollDistance", "maxHandleOffset", "handleOffset", "resizeViewVertical", "resizeContentVertical", "scrollHeight", "setContainerVisible", "visibilityChanged", "updateDisplay_", "setVisibleInternal", "mouseXY", "mouseLocation", "handleXY", "handleStart", "pageLength", "onMouseUpHandle", "onMouseMoveHandle", "getRatio_", "setOrigin", "DOWN", "SPRITE", "url", "ZoomControls", "boundEvents", "zoomResetGroup", "zoomOutGroup", "zoomInGroup", "HEIGHT", "WIDTH", "SMALL_SPACING", "LARGE_SPACING", "MARGIN_HORIZONTAL", "MARGIN_VERTICAL", "createZoomOutSvg", "createZoomInSvg", "createZoomResetSvg", "getComponentManager", "cornerPosition", "positionRect", "zoomInTranslateY", "zoomOutTranslateY", "clip", "zoomoutSvg", "setAttributeNS", "zoom", "zoominSvg", "amount", "zoomCenter", "fireZoomEvent", "zoomresetSvg", "resetZoom", "log", "scaleSpeed", "beginCanvasTransition", "scrollCenter", "endCanvasTransition", "uiEvent", "VARIABLES", "PROCEDURES", "BLOCKS", "WORKSPACE_COMMENTS", "saveComment", "WorkspaceCommentSerializer", "commentStates", "commentState", "WorkspaceCommentPaster", "DEFAULT_SNAP_RADIUS", "dragRadius", "flyoutDragRadius", "connectingSnapRadius", "currentConnectionPreference", "bumpDelay", "GRID", "GRIDCELL", "GROUP", "LISTBOX", "MENUITEMCHECKBOX", "OPTION", "PRESENTATION", "ROW", "TREE", "TREEITEM", "menuItems", "onKeyDownHandler", "pointerLeaveHandler", "pointerEnterHandler", "clickHandler", "pointerMoveHandler", "highlightedItem", "openingCoords", "handlePointerMove", "handleClick", "handlePointerEnter", "handlePointerLeave", "handleKeyEvent", "getElement", "preventScroll", "blur", "getMenuItem", "menuElem", "currentElement", "setHighlighted", "currentHighlighted", "menuElement", "scrollingParent", "menuItemElement", "ACTIVEDESCENDANT", "highlightNext", "highlightHelper", "highlightPrevious", "highlightFirst", "highlightLast", "startIndex", "delta", "movementX", "movementY", "oldCoords", "newCoords", "performAction", "shiftKey", "metaKey", "altKey", "highlighted", "opt_value", "rightToLeft", "highlight", "checked", "checkable", "checkbox", "contentDom", "DISABLED", "setCheckable", "setChecked", "nameDep", "COLLAPSED_INPUT_NAME", "COLLAPSED_FIELD_NAME", "CUSTOM", "WeakSet", "WeakMap", "setLocale", "locale", "k", "VarBase", "opt_variable", "varId", "VarCreate", "varType", "varName", "deleteVariableById", "opt_id", "var1", "var2", "CATEGORY_NAME", "DeserializationError", "toDevString", "childState", "saveBlock", "BlockSerializer", "blockStates", "MUTATOR", "WARNING", "BlockBase", "BlockChange", "opt_element", "opt_oldValue", "opt_newValue", "oldValue", "disabledReason", "setValue", "oldState", "getExtraBlockState_", "JSON", "stringify", "getBoundsInfo", "boundPosition", "boundSize", "clientTop", "MarkerManager", "cursorSvg", "cursor", "markers", "markerSvg", "registerMarker", "marker", "unregisterMarker", "setDrawer", "makeMarkerDrawer", "setMarkerSvg", "getDrawer", "getCursor", "getMarker", "setCursor", "drawer", "setCursorSvg", "getBlockCanvas", "updateMarkers", "keyboardAccessibilityMode", "draw", "markerIds", "markerId", "LOCAL_MARKER", "validator", "DEFAULT_VALUE", "constants_", "mouseDownWrapper", "textContent_", "textElement_", "borderRect_", "fieldGroup_", "validator_", "maxDisplayLength", "sourceBlock_", "enabled_", "visible_", "isDirty_", "suffixField", "prefixField", "clickTarget_", "EDITABLE", "SERIALIZABLE", "value_", "size_", "SKIP_SETUP", "configure_", "setValidator", "setSourceBlock", "getConstants", "bindEvents_", "createBorderRect_", "createTextElement_", "isFullBlockField", "FIELD_BORDER_RECT_RADIUS", "FIELD_TEXT_BASELINE_CENTER", "clickTarget", "getClickTarget_", "onMouseDown_", "fieldElement", "_doFullSerialization", "legacyState", "saveLegacyState", "loadLegacyState", "callingClass", "isClickable", "showEditor_", "isClickableInFlyout", "autoClosingFlyout", "isCurrentlyEditable", "handler", "getValidator", "getBorderRect", "getTextElement", "getTextContent", "render_", "nodeValue", "getDisplayText_", "updateSize_", "showEditor", "constants", "xOffset", "FIELD_BORDER_RECT_X_PADDING", "totalWidth", "totalHeight", "FIELD_TEXT_HEIGHT", "contentWidth", "FIELD_TEXT_FONTSIZE", "FIELD_TEXT_FONTWEIGHT", "FIELD_TEXT_FONTFAMILY", "FIELD_BORDER_RECT_HEIGHT", "positionTextElement_", "positionBorderRect_", "halfHeight", "FIELD_TEXT_BASELINE", "getAbsoluteXY_", "_", "NBSP", "getText_", "markDirty", "forceRerender", "fireChangeEvent", "classValidation", "doClassValidation_", "classValue", "processValidation", "localValidation", "localValue", "doValueUpdate_", "validatedValue", "doValueInvalid_", "_invalidValue", "_fireChangeEvent", "getGesture", "setStartField", "newTip", "getTooltip", "referencesVariables", "refreshVariableName", "getParentInput", "parentInput", "idx", "fieldRows", "getFlipRtl", "isTabNavigable", "onShortcut", "_shortcut", "updateMarkers_", "_options", "Symbol", "registeredItems", "reset", "getContextMenuOptions", "menuOptions", "precondition", "menuOption", "BUBBLE", "CommentDragStrategy", "startLoc", "inGroup", "fireDragStartEvent", "moveToDragLayer", "setDragging", "newLoc", "moveDuringDrag", "fireDragEndEvent", "fireMoveEvent", "moveOffDragLayer", "snapToGrid", "setReason", "oldCoordinate_", "recordNew", "CommentView", "location", "textChangeListeners", "sizeChangeListeners", "disposeListeners", "collapseChangeListeners", "resizePointerMoveListener", "resizePointerUpListener", "disposing", "svgRoot", "highlightRect", "createHighlightRect", "topBarGroup", "topBarBackground", "deleteIcon", "foldoutIcon", "textPreview", "textPreviewNode", "createTopBar", "foreignObject", "textArea", "createTextArea", "resizeHandle", "createResizeHandle", "setSizeWithoutFiringEvents", "onFoldoutDown", "onDeleteDown", "onTextChange", "onResizePointerDown", "getBBox", "topBarSize", "deleteSize", "foldoutSize", "textPreviewSize", "resizeSize", "calcMinSize", "updateHighlightRect", "updateTopBarSize", "updateTextAreaSize", "updateDeleteIconPosition", "updateFoldoutIconPosition", "updateTextPreviewSize", "updateResizeHandlePosition", "oldSize", "preResizeSize", "onSizeChange", "updateTextPreview", "textPreviewWidth", "foldoutMargin", "calcFoldoutMargin", "deleteMargin", "calcDeleteMargin", "checkVisibility", "textPreviewMargin", "addSizeChangeListener", "listener", "removeSizeChangeListener", "bringToFront", "onResizePointerUp", "onResizePointerMove", "onCollapse", "addOnCollapseListener", "removeOnCollapseListener", "addTextChangeListener", "removeTextChangeListener", "oldText", "truncateText", "addDisposeListener", "removeDisposeListener", "addTopComment", "fireCreateEvent", "fireDeleteEvent", "newText", "fireCollapseEvent", "newCollapsed", "recordCurrentSizeAsNewSize", "removeTopComment", "dragStrategy", "view", "addModelUpdateBindings", "startGesture", "dragging", "handleCommentStart", "setDeleteStyle", "wouldDelete", "showContextMenu", "grid", "getGrid", "shouldSnap", "currentXY", "alignedXY", "alignXY", "BlockCreate", "allShadowBlocks", "shadows", "ThemeChange", "opt_themeName", "themeName", "ViewportChange", "opt_top", "opt_left", "opt_scale", "opt_oldScale", "ConnectionType", "INPUT_VALUE", "OUTPUT_VALUE", "NEXT_STATEMENT", "PREVIOUS_STATEMENT", "ConnectionDB", "connections", "addConnection", "yPos", "calculateIndexForYPos", "findIndexOfConnection", "conn", "bestGuess", "pointer", "pointerMin", "pointerMax", "pointerMid", "removeConnection", "getNeighbours", "maxRadius", "checkConnection", "yIndex", "currentX", "db", "currentY", "neighbours", "isInYRange", "baseY", "searchForClosest", "dxy", "baseX", "closestIndex", "bestConnection", "bestRadius", "distanceFrom", "dbList", "WorkspaceDragger", "horizontalScrollEnabled", "isMovableHorizontally", "verticalScrollEnabled", "isMovableVertically", "startScrollXY_", "currentDragDeltaXY", "newXY", "scroll", "ZOOM_IN_MULTIPLIER", "ZOOM_OUT_MULTIPLIER", "creatorWorkspace", "mouseDownXY", "startWorkspace_", "startComment", "startIcon", "startField", "startBubble", "hasExceededDragRadius", "workspaceDragger", "dragger", "multiTouch", "isEnding_", "gestureHasStarted", "calledUpdateIsDragging", "cachedPoints", "startDistance", "previousScale", "currentDropdownOwner", "isPinchZoomEnabled", "mostRecentEvent", "clearGesture", "updateFromEvent", "updateDragDelta", "changed", "updateIsDragging", "currentDragDelta", "updateIsDraggingFromFlyout", "isBlockCreatable", "isScrollable", "isDragTowardWorkspace", "updateScreenCalculationsIfScrolled", "createBlock", "updateIsDraggingWorkspace", "createDragger", "onDragStart", "onDrag", "draggable", "DraggerClass", "doStart", "pinch", "cancel", "pointerType", "handleTouchStart", "handleMove", "handleUp", "isMultiTouch", "handleTouchMove", "handleTouchEnd", "onDragEnd", "isBubbleClick", "isCommentClick", "isFieldClick", "doFieldClick", "isIconClick", "doIconClick", "isBlockClick", "doBlockClick", "isWorkspaceClick", "doWorkspaceClick", "getTouchPoint", "pointers", "point0", "point1", "handlePinch", "moveDistance", "gestureScale", "bringBlockToFront", "handleWsStart", "setStartWorkspace", "fireWorkspaceClick", "handleFlyoutStart", "setStartFlyout", "handleBlockStart", "setStartBlock", "handleBubbleStart", "bubble", "setStartBubble", "setStartComment", "autoClose", "setStartIcon", "setTargetBlock", "hasStartBubble", "hasStartBlock", "handleInFlyout", "getCurrentDragger", "hasStarted", "currentGesture_", "pattern", "spacing", "line2", "line1", "setSpacing", "update", "getSpacing", "setLength", "getLength", "setSnapToGrid", "snap", "getPatternId", "safeSpacing", "half", "end", "setLineAttributes", "x1", "x2", "y1", "y2", "LayerManager", "layers", "dragLayer", "createDragLayer", "animationLayer", "createAnimationLayer", "blockLayer", "createLayer", "bubbleLayer", "currentTransform", "translateLayers", "newCoord", "newScale", "translation", "layer", "layerNum", "getSvgGroup", "inserted", "sortedLayers", "num", "sib", "hasLayer", "getBlockLayer", "getBubbleLayer", "Theme", "opt_blockStyles", "opt_categoryStyles", "opt_componentStyles", "startHats", "blockStyles", "categoryStyles", "componentStyles", "fontStyle", "setBlockStyle", "blockStyleName", "blockStyle", "setCategoryStyle", "categoryStyleName", "categoryStyle", "getComponentStyle", "componentName", "recursiveStyle", "setComponentStyle", "styleValue", "setFontStyle", "setStartHats", "defineTheme", "themeObj", "base", "defaultBlockStyles", "Classic", "toolboxJsonDef", "hasCollapse", "hasComments", "hasDisable", "rawHasTrashcan", "rawHasCollapse", "rawHasComments", "rawHasDisable", "rawHasSounds", "maxTrashcanContents", "toolboxAtStart", "toolboxPosition", "endsWith", "rawOneBasedIndex", "modalInputs", "oneBasedIndex", "maxBlocks", "maxInstances", "parseMoveOptions", "hasScrollbars", "parseGridOptions", "parseZoomOptions", "parseThemeOptions", "rendererOverrides", "wheel", "maxScale", "minScale", "menuGenerator", "svgArrow", "imageElement", "selectedMenuItem", "generatedOptions", "validateOptions", "trimmed", "trimOptions", "menuGenerator_", "prefix", "selectedOption", "shouldAddBorderRect_", "FIELD_DROPDOWN_SVG_ARROW", "createSVGArrow_", "createTextArrow_", "FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW", "ARROW_CHAR", "FIELD_DROPDOWN_SVG_ARROW_SIZE", "FIELD_DROPDOWN_SVG_ARROW_DATAURI", "dropdownCreate", "FIELD_DROPDOWN_COLOURED_DIV", "primaryColour", "getColour", "getColourTertiary", "dropdownDispose_", "label", "image", "Image", "src", "alt", "handleMenuActionEvent", "onItemSelected_", "useCache", "isValueValid", "fill", "getColourSecondary", "renderSelectedImage", "renderSelectedText", "imageJson", "imageHeight", "imageWidth", "hasBorder", "FIELD_DROPDOWN_BORDER_RECT_HEIGHT", "IMAGE_Y_PADDING", "xPadding", "arrowWidth", "positionSVGArrow", "textWidth", "textPadding", "FIELD_DROPDOWN_SVG_ARROW_PADDING", "svgArrowSize", "hasImages", "trimmedOptions", "stringLabels", "shortest", "prefixLength", "suffixLength", "applyTrim", "foundError", "error", "CHECKMARK_OVERHANG", "MAX_MENU_HEIGHT_VH", "IMAGE_Y_OFFSET", "BubbleDragStrategy", "_a", "Bubble", "anchor", "ownerRect", "relativeLeft", "relativeTop", "getBubbleCanvas", "embossGroup", "embossFilterId", "tail", "background", "BORDER_WIDTH", "contentContainer", "onMouseDown", "setAnchorLocation", "relayout", "positionByRect", "positionRelativeToAnchor", "renderTail", "setPositionRelativeToAnchor", "MIN_SIZE", "optimalLeft", "getOptimalRelativeLeft", "optimalTop", "getOptimalRelativeTop", "topPosition", "MIN_BLOCK_HEIGHT", "startPosition", "endPosition", "bottomPosition", "closerPosition", "fartherPosition", "topPositionOverlap", "getOverlap", "startPositionOverlap", "closerPositionOverlap", "fartherPositionOverlap", "mostOverlap", "relativeMin", "workspaceRect", "getWorkspaceViewRect", "bubbleRight", "bubbleLeft", "getScrollbarThickness", "relBubbleX", "relBubbleY", "relAnchorX", "relAnchorY", "hypotenuse", "rise", "angle", "acos", "rightAngle", "rightRise", "sin", "rightRun", "cos", "thickness", "TAIL_THICKNESS", "backoffRatio", "ANCHOR_RADIUS", "baseX1", "baseY1", "radians", "TAIL_ANGLE", "swirlAngle", "swirlRise", "TAIL_BEND", "swirlRun", "baseX2", "baseY2", "lastChild", "_start", "_enable", "DOUBLE_BORDER", "MiniWorkspaceBubble", "workspaceOptions", "autoLayout", "validateWorkspaceOptions", "svgDialog", "miniWorkspace", "newWorkspaceSvg", "internalIsMutator", "getCanvas", "onWorkspaceChange", "updateBubbleSize", "addWorkspaceChangeListener", "bumpBlocksIntoBounds", "MARGIN", "currSize", "calculateWorkspaceSize", "MINIMUM_VIEW_CHANGE", "recordDragTargets", "workspaceSize", "flyoutScrollMetrics", "updateBlockStyles", "setStyle", "getStyleName", "flyoutWs", "Icon", "offsetInBlock", "workspaceLocation", "pointerdownListener", "svgBlock", "updateSvgRootOffset", "SIZE", "WORKSPACE_MARGIN", "flyoutBlockTypes", "saveConnectionsListener", "updateWorkspacePid", "rootBlock", "miniWorkspaceBubble", "WEIGHT", "getAnchorLocation", "getMiniWorkspaceConfig", "getBubbleOwnerRect", "createRootBlock", "addSaveConnectionsListener", "createMiniWorkspaceChangeListener", "removeChangeListener", "midIcon", "flyoutWidth", "saveConnections", "isIgnorableMutatorEvent", "recomposeSourceBlock", "oldExtraState", "newExtraState", "WIN_KEY_FF_LINUX", "MAC_ENTER", "TAB", "NUM_CENTER", "ENTER", "PAUSE", "CAPS_LOCK", "SPACE", "PAGE_UP", "PAGE_DOWN", "END", "HOME", "PLUS_SIGN", "PRINT_SCREEN", "INSERT", "ZERO", "ONE", "TWO", "THREE", "FOUR", "FIVE", "SIX", "SEVEN", "EIGHT", "NINE", "FF_SEMICOLON", "FF_EQUALS", "FF_DASH", "FF_HASH", "QUESTION_MARK", "AT_SIGN", "A", "B", "D", "E", "F", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "W", "WIN_KEY_RIGHT", "CONTEXT_MENU", "NUM_ZERO", "NUM_ONE", "NUM_TWO", "NUM_THREE", "NUM_FOUR", "NUM_FIVE", "NUM_SIX", "NUM_SEVEN", "NUM_EIGHT", "NUM_NINE", "NUM_MULTIPLY", "NUM_PLUS", "NUM_MINUS", "NUM_PERIOD", "NUM_DIVISION", "F1", "F2", "F3", "F4", "F5", "F6", "F7", "F8", "F9", "F10", "F11", "F12", "NUMLOCK", "SCROLL_LOCK", "FIRST_MEDIA_KEY", "LAST_MEDIA_KEY", "SEMICOLON", "DASH", "EQUALS", "COMMA", "PERIOD", "SLASH", "APOSTROPHE", "TILDE", "SINGLE_QUOTE", "OPEN_SQUARE_BRACKET", "BACKSLASH", "CLOSE_SQUARE_BRACKET", "WIN_KEY", "MAC_FF_META", "MAC_WK_CMD_LEFT", "MAC_WK_CMD_RIGHT", "WIN_IME", "VK_NONAME", "PHANTOM", "aria", "arrayUtils", "browserEvents", "deprecation", "extensions", "idGenerator", "math", "parsing", "stringUtils", "svgMath", "svgPaths", "userAgent", "TextInputBubble", "DEFAULT_SIZE", "inputRoot", "createEditor", "resizeGroup", "bindTextAreaEvents", "onStartEdit", "widthMinusBorder", "heightMinusBorder", "DEFAULT_BUBBLE_WIDTH", "DEFAULT_BUBBLE_HEIGHT", "textInputBubble", "bubbleSize", "bubbleVisiblity", "anchorLocation", "showEditableBubble", "showNonEditableBubble", "hideBubble", "createBubble", "getBoundingRectangleWithoutChildren", "DuplicateIconType", "TextBubble", "paragraph", "stringToSvg", "createParagraph", "fragments", "createTextFragments", "rightAlignTextFragments", "lineNum", "fragment", "maxWidth", "WarningIcon", "textMap", "textBubble", "addMessage", "exceptions", "reservedWordsList", "opt_variablePrefix", "dbReverse", "variableMap", "variablePrefix", "reservedWords", "setVariableMap", "getNameForUserVariable", "populateVariables", "NameType", "VARIABLE", "nameOrId", "normalizedName", "DEVELOPER_VARIABLE", "typeDb", "safeName", "getDistinctName", "getUserNames", "userNames", "encodeURI", "name1", "name2", "PROCEDURE", "DEVELOPER_VARIABLE_TYPE", "ObservableProcedureMap", "existed", "TypesContainer", "NONE", "HAT", "SPACER", "BETWEEN_ROW_SPACER", "IN_ROW_SPACER", "EXTERNAL_VALUE_INPUT", "INLINE_INPUT", "STATEMENT_INPUT", "CONNECTION", "PREVIOUS_CONNECTION", "NEXT_CONNECTION", "OUTPUT_CONNECTION", "CORNER", "LEFT_SQUARE_CORNER", "LEFT_ROUND_CORNER", "RIGHT_SQUARE_CORNER", "RIGHT_ROUND_CORNER", "JAGGED_EDGE", "TOP_ROW", "BOTTOM_ROW", "INPUT_ROW", "LEFT_CORNER", "RIGHT_CORNER", "nextTypeValue_", "hasOwnProperty", "isField", "isHat", "isSpacer", "isInRowSpacer", "isInput", "isExternalInput", "isInlineInput", "isStatementInput", "isPreviousConnection", "isNextConnection", "isPreviousOrNextConnection", "isLeftRoundedCorner", "isRightRoundedCorner", "isLeftSquareCorner", "isRightSquareCorner", "isCorner", "isJaggedEdge", "isRow", "row", "isBetweenRowSpacer", "isTopRow", "isBottomRow", "isTopOrBottomRow", "isInputRow", "Types", "Measurable", "centerline", "xPos", "notchOffset", "NOTCH_OFFSET_LEFT", "Row", "elements", "widthWithConnectedBlocks", "minWidth", "minHeight", "hasStatement", "hasExternalInput", "statementEdge", "hasJaggedEdge", "hasDummyInput", "hasInlineInput", "align", "getLastInput", "measure", "startsWithElemSpacer", "endsWithElemSpacer", "getFirstSpacer", "getLastSpacer", "BottomRow", "hasNextConnection", "descenderHeight", "hasLeftSquareCorner", "hasRightSquareCorner", "_block", "Connection", "connectionModel", "shapeFor", "isHighlighted", "InputConnection", "connectionOffsetY", "connectionOffsetX", "connectedBlock", "connectedBlockWidth", "connectedBlockHeight", "ExternalValueInput", "TAB_OFFSET_FROM_TOP", "MEDIUM_PADDING", "EXTERNAL_VALUE_INPUT_PADDING", "connectionHeight", "connectionWidth", "flipRtl", "Hat", "START_HAT", "ascenderHeight", "InRowSpacer", "SPACER_DEFAULT_HEIGHT", "InlineInput", "EMPTY_INLINE_INPUT_HEIGHT", "EMPTY_INLINE_INPUT_PADDING", "STATEMENT_BOTTOM_SPACER", "EMPTY_STATEMENT_INPUT_HEIGHT", "STATEMENT_INPUT_NOTCH_OFFSET", "InputRow", "connectedBlockWidths", "JaggedEdge", "JAGGED_TEETH", "NextConnection", "OutputConnection", "startX", "PreviousConnection", "RoundCorner", "opt_position", "CORNER_RADIUS", "SpacerRow", "precedesStatement", "followsStatement", "SquareCorner", "NO_PADDING", "TopRow", "capline", "hasPreviousConnection", "hasHat", "hat", "ADD_START_HATS", "prevBlock", "getPreviousBlock", "ConstantProvider", "SMALL_PADDING", "MEDIUM_LARGE_PADDING", "LARGE_PADDING", "TAB_HEIGHT", "TAB_VERTICAL_OVERLAP", "TAB_WIDTH", "NOTCH_WIDTH", "NOTCH_HEIGHT", "MIN_BLOCK_WIDTH", "EMPTY_BLOCK_SPACER_HEIGHT", "STATEMENT_INPUT_PADDING_LEFT", "BETWEEN_STATEMENT_PADDING_Y", "START_HAT_HEIGHT", "START_HAT_WIDTH", "JAGGED_TEETH_HEIGHT", "JAGGED_TEETH_WIDTH", "FIELD_BORDER_RECT_Y_PADDING", "FIELD_BORDER_RECT_COLOUR", "FIELD_COLOUR_FULL_BLOCK", "FIELD_TEXTINPUT_BOX_SHADOW", "FIELD_COLOUR_DEFAULT_WIDTH", "embossFilter", "disabledPatternId", "disabledPattern", "debugFilterId", "debugFilter", "CURSOR_COLOUR", "MARKER_COLOUR", "CURSOR_WS_WIDTH", "WS_CURSOR_HEIGHT", "CURSOR_STACK_PADDING", "CURSOR_BLOCK_PADDING", "CURSOR_STROKE_WIDTH", "FULL_BLOCK_FIELDS", "INSERTION_MARKER_COLOUR", "INSERTION_MARKER_OPACITY", "SHAPES", "PUZZLE", "NOTCH", "TALL_INPUT_FIELD_OFFSET_Y", "DUMMY_INPUT_SHADOW_MIN_HEIGHT", "DUMMY_INPUT_MIN_HEIGHT", "TOP_ROW_MIN_HEIGHT", "TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT", "BOTTOM_ROW_MIN_HEIGHT", "BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT", "START_POINT", "FIELD_COLOUR_DEFAULT_HEIGHT", "FIELD_CHECKBOX_X_OFFSET", "randomIdentifier", "makeJaggedTeeth", "makeNotch", "makeStartHat", "PUZZLE_TAB", "makePuzzleTab", "INSIDE_CORNERS", "makeInsideCorners", "OUTSIDE_CORNERS", "makeOutsideCorners", "setTheme", "validatedBlockStyle_", "setDynamicProperties_", "setFontConstants_", "setComponentConstants_", "fontMetrics", "getBlockStyleForColour", "createBlockStyle_", "getBlockStyle", "valid", "assign", "parsedColour", "colourPrimary", "colourSecondary", "generateSecondaryColour_", "colourTertiary", "generateTertiaryColour_", "inputColour", "mainPath", "path", "makeMainPath", "up", "back", "control1Y", "overlap", "control2Y", "endPoint1", "endPoint2", "dir", "outerWidth", "innerWidth", "innerTopLeftCorner", "innerBottomLeftCorner", "pathTop", "pathBottom", "topLeft", "topRight", "bottomLeft", "bottomRight", "rightHeight", "selector", "injectCSS_", "feSpecularLighting", "createDebugFilter", "debugComponentTransfer", "cssArray", "getCSS_", "cssNodeId", "Drawer", "info", "inlinePath_", "outlinePath_", "block_", "info_", "topLeft_", "drawOutline_", "drawInternals_", "updateConnectionHighlights", "pathObject", "setPath", "flipRTL", "recordSizeOnBlock_", "widthWithChildren", "childlessWidth", "drawTop_", "rows", "drawJaggedEdge_", "drawStatementInput_", "drawValueInput_", "drawRightSideRow_", "drawBottom_", "drawLeft_", "topRow", "positionPreviousConnection_", "startY", "positionExternalValueConnection_", "innerHeight", "positionStatementInputConnection_", "bottomRow", "elems", "positionNextConnection_", "rightCornerYOffset", "outlinePath", "positionOutputConnection_", "tabBottom", "drawInlineInput_", "layoutField_", "fieldInfo", "connectionTop", "connectionBottom", "positionInlineInputConnection_", "connX", "connInfo", "drawConnectionHighlightPath", "removeConnectionHighlight", "measurable", "getExpressionConnectionHighlightPath", "getStatementConnectionHighlightPath", "addConnectionHighlight", "getOffsetInBlock", "connPath", "yLen", "xLen", "Align", "CENTRE", "FieldLabel", "textClass", "class", "setClass", "cssClass", "Input", "appendField", "insertFieldAt", "initField", "removeField", "opt_quiet", "renderList", "renderedConnection", "startTrackingAll", "stopTrackingAll", "setCheck", "check", "setAlign", "makeConnection", "makeConnection_", "DummyInput", "EndRowInput", "ValueInput", "RenderInfo", "inputRows", "renderer_", "isInline", "createRows_", "addElemSpacing_", "addRowSpacing_", "computeBounds_", "alignRowElements_", "finalize_", "populateTopRow_", "activeRow", "iconInfo", "lastInput", "shouldStartNewRow_", "addInput_", "populateBottomRow_", "hasPrevious", "cornerClass", "leftSquareCorner", "rightSquareCorner", "StatementInputMeasurable", "currInput", "prevInput", "oldElems", "getInRowSpacing_", "prev", "widestStatementRowFields", "blockWidth", "widestRowWithConnectedBlocks", "statementInput", "alignStatementRow_", "currentWidth", "missingSpace", "getDesiredRowWidth_", "desiredWidth", "addAlignmentPadding_", "_row", "firstSpacer", "lastSpacer", "oldRows", "makeSpacerRow_", "getSpacerRowHeight_", "getSpacerRowWidth_", "spacer", "_prev", "_next", "getElemCenterline_", "recordElemPositions_", "xCursor", "yCursor", "getMeasureableForConnection", "BlockDelete", "oldXml", "wasShadow", "oldJson", "shadowDom", "shadowState", "connect_", "parentBlock", "disconnectInternal", "orphan", "stashShadowState", "applyShadowState", "setParent", "orphanConnection", "getConnectionForOrphanedConnection", "onFailedConnect", "isSuperior", "setShadowStateInternal", "unplug", "_superiorConnection", "otherConnection", "disconnect", "getParentAndChildConnections", "respawnShadow_", "createShadowBlock", "reconnect", "connectionParent", "currentParent", "onCheckChanged_", "getCheck", "returnCurrent", "_maxLimit", "serializeShadow", "attemptToConnect", "blockShadow", "lastConnectionInStack", "CAN_CONNECT", "REASON_SELF_CONNECTION", "REASON_WRONG_TYPE", "REASON_TARGET_NULL", "REASON_CHECKS_FAILED", "REASON_DIFFERENT_WORKSPACES", "REASON_SHADOW_PARENT", "REASON_DRAG_CHECKS_FAILED", "REASON_PREVIOUS_AND_OUTPUT", "Block", "colour_", "styleName_", "suppressPrefixSuffix", "contextMenu", "parentBlock_", "childBlocks_", "collapsed_", "outputShape_", "isInsertionMarker_", "onchangeWrapper", "statementInputCount", "setBlockById", "isInMutator", "addTopBlock", "addTypedBlock", "doInit_", "onchange", "setOnChange", "healStack", "removeTopBlock", "disposeInternal", "removeTypedBlock", "removeBlockById", "destroy", "opt_healStack", "unplugFromRow", "unplugFromStack", "thisConnection", "getOnlyValueConnection", "previousTarget", "nextTarget", "_all", "myConnections", "ignoreShadows", "getInputWithBlock", "getSurroundParent", "getTopStackBlock", "previous", "ordered", "childBlocks", "hasBlockLimits", "isCapacityAvailable", "setInsertionMarker", "insertionMarker", "isSimpleReporter", "getMatchingConnection", "otherConnections", "setHelpUrl", "getHue", "parsed", "onchangeFn", "getVars", "vars", "updateVarName", "renameVarById", "oldId", "newId", "setFieldValue", "setPreviousStatement", "newBoolean", "opt_check", "setNextStatement", "setOutput", "setOutputShape", "outputShape", "getOutputShape", "blockChangeEvent", "ancestor", "opt_maxLength", "opt_emptyToken", "toTokens", "acc", "curr", "emptyToken", "checks", "shouldAddParens", "appendValueInput", "appendInput", "appendStatementInput", "appendDummyInput", "appendEndRowInput", "appendInputFromRegistry", "inputConstructor", "warningPrefix", "n", "jsonInitStyle", "jsonInitColour", "interpolate", "localizedText", "localizedValue", "extensionNames", "opt_disableCheck", "overwrites", "implicitAlign", "validateTokens", "interpolateArguments", "fieldStack", "isInputKeyword", "inputFromJson", "fieldFromJson", "argsCount", "visitedArgsHash", "visitedArgsCount", "token", "newlineInput", "stringToFieldJson", "dummyInput", "alignmentLookup", "alignment", "moveInputBefore", "refName", "inputIndex", "refIndex", "moveNumberedInputBefore", "RangeError", "removeInput", "getInputTargetBlock", "commentConstructor", "removeIcon", "setWarningText", "_text", "_opt_id", "_mutator", "find", "allInputsFilled", "opt_shadowBlocksAreFilled", "FlyoutButton", "isFlyoutLabel", "onMouseUpWrapper", "svgText", "callbackKey", "BORDER_RADIUS", "TEXT_MARGIN_X", "TEXT_MARGIN_Y", "updateTransform", "onMouseUp", "isLabel", "getButtonText", "getButtonCallback", "ASTNode", "opt_params", "wsCoordinate", "isConnectionLocation", "isConnectionType", "processParams", "getLocation", "getWsCoordinate", "isConnection", "findNextForInput", "curIdx", "NAVIGATE_ALL_FIELDS", "createFieldNode", "createInputNode", "findNextForField", "fieldIdx", "newInput", "findPrevForInput", "findPrevForField", "navigateBetweenStacks", "curLocation", "curLocationAsBlock", "navigateFlyoutContents", "curRoot", "resultIndex", "createStackNode", "types", "STACK", "BUTTON", "nextItem", "findNextLocationInFlyout", "getContents", "createButtonNode", "flyoutContents", "currentLocation", "currentIndex", "findIndex", "findTopASTNodeForBlock", "createConnectionNode", "createBlockNode", "getOutAstNodeForBlock", "findFirstFieldOrInput", "OUTPUT", "PREVIOUS", "NEXT", "in", "out", "blockPos", "DEFAULT_OFFSET_Y", "createWorkspaceNode", "createTopNode", "MarkerMove", "isCursor", "opt_oldNode", "opt_newNode", "oldNode", "CURSOR_CLASS", "MARKER_CLASS", "HEIGHT_MULTIPLIER", "MarkerSvg", "markerSvgRect_", "markerSvgLine_", "markerInput_", "markerBlock_", "svgGroup_", "markerSvg_", "currentMarkerSvg", "defaultColour", "createDomInternal_", "setParent_", "curNode", "applyColour_", "showAtLocation_", "fireMarkerEvent", "animate", "connectionType", "curNodeAsConnection", "showWithBlock_", "showWithOutput_", "showWithInput_", "showWithNext_", "showWithPrevious_", "showWithField_", "showWithCoordinates_", "showWithStack_", "showWithButton_", "showWithBlockPrevOutput", "markerHeight", "markerOffset", "connectionShape", "positionPrevious_", "positionOutput_", "positionBlock_", "showCurrent_", "positionLine_", "positionRect_", "positionInput_", "heightWidth", "yPadding", "markerPath", "curBlock", "getBlinkProperties_", "blinkProperties", "attributeName", "_curNode", "firstElementChild", "PathObject", "connectionHighlights", "highlightOffsets", "svgPath", "pathString", "updateShadow_", "updateDisabled_", "setClass_", "updateHighlighted", "updateSelected", "updateDraggingDelete", "updateInsertionMarker", "updateMovable", "updateReplacementFade", "updateShapeForInputHighlight", "_conn", "connectionPath", "currentHighlightMatchesNew", "newPath", "newOffset", "currPath", "currOffset", "InsertionMarkerManager", "activeCandidate", "lastMarker", "lastOnStack", "wouldDeleteBlock", "fadedBlock", "highlightedBlock", "markerConnection", "firstMarker", "createMarkerBlock", "availableConnections", "initAvailableConnections", "disposeInsertionMarker", "updateAvailableConnections", "wouldConnectBlock", "applyConnections", "hidePreview", "local", "inferiorConnection", "then", "dragTarget", "newCandidate", "getCandidate", "shouldDelete", "shouldUpdatePreviews", "maybeHidePreview", "maybeShowPreview", "blockJson", "available", "activeLocal", "activeClosest", "xDiff", "yDiff", "curDistance", "getStartRadius", "candidate", "myConnection", "neighbour", "componentManager", "isDeleteArea", "showPreview", "getConnectionPreviewMethod", "method", "PREVIEW_TYPE", "INPUT_OUTLINE", "showInsertionInputOutline", "INSERTION_MARKER", "showInsertionMarker", "REPLACEMENT_FADE", "showReplacementFade", "shouldHighlightConnection", "localChanged", "unhighlight", "hideReplacementFade", "hideInsertionInputOutline", "hideInsertionMarker", "isLastInStack", "imConn", "originalOffsetToTarget", "originalOffsetInBlock", "imConnConst", "positionNearConnection", "markerConn", "imBlock", "markerOutput", "markerPrev", "highlightShapeForInput", "fadeForReplacement", "getInsertionMarkers", "PreviewType", "Renderer", "overrides", "makeConstants_", "refreshDom", "previousConstants", "makeRenderInfo_", "makeDrawer_", "makePathObject", "orphanCanConnectAtEnd", "localType", "ThemeManager", "subscribedWorkspaces", "componentDB", "prevTheme", "oldClassName", "newClassName", "refreshTheme", "componentList", "propertyName", "setProperty", "subscribeWorkspace", "unsubscribeWorkspace", "onCreateVariableButtonClick_String", "onCreateVariableButtonClick_Number", "onCreateVariableButtonClick_Colour", "COLLAPSE_CHARS", "OPPOSITE_TYPE", "RENAME_VARIABLE_ID", "DELETE_VARIABLE_ID", "ConnectionChecker", "opt_distance", "safety", "doSafetyChecks", "doTypeChecks", "doDragChecks", "errorCode", "superiorBlock", "inferiorBlock", "superiorConnection", "checkArrayOne", "checkArrayTwo", "canConnectToPrevious_", "VarDelete", "VarRename", "VariableMap", "deleteVariable", "conflictVar", "renameVariableWithConflict", "renameVariableAndUses", "variableId", "tempVar", "variableName", "uses", "getVariableUsesById", "procedureName", "deleteText", "confirmText", "deleteVariableInternal", "list", "getVariableTypes", "variableTypes", "flat", "Workspace", "internalIsFlyout", "isClearing", "MAX_UNDO", "connectionDBList", "topComments", "commentDB", "listeners", "undoStack_", "redoStack_", "blockDB", "typedBlocksDB", "procedureMap", "connectionCheckerClass", "sortObjects", "SCAN_ANGLE", "aXY", "bXY", "remainingCapacity", "remainingCapacityOfType", "copyableBlocksCount", "redo", "inputStack", "outputStack", "inputEvent", "events", "clearUndo", "createPotentialVariableMap", "outerWs", "getById", "getAll", "SOUND_LIMIT", "WorkspaceAudio", "sounds", "lastSound", "muted", "filenames", "audioTest", "filename", "ext", "canPlayType", "sound", "volume", "playPromise", "pause", "catch", "opt_volume", "now", "mySound", "setMuted", "getMuted", "ZOOM_TO_FIT_MARGIN", "resizeHandlerWrapper", "resizesEnabled", "startScrollY", "startScrollX", "oldLeft", "oldTop", "inverseScreenCTM", "dummyWheelListener", "configureContextMenu", "lastRecordedPageScroll", "inverseScreenCTMDirty", "highlightedBlocks", "toolboxCategoryCallbacks", "flyoutButtonCallbacks", "cachedParentSvg", "topBoundedElements", "dragTargetAreas", "layerManager", "MetricsManagerClass", "setTopLevelWorkspaceMetrics", "audioManager", "markerManager", "Variables", "registerToolboxCategoryCallback", "VariablesDynamic", "Procedures", "themeManager_", "cachedParentSvgSize", "getMarkerManager", "setMetricsManager", "refreshToolboxSelection", "ctm", "opt_backgroundClass", "svgBackground_", "svgBlockCanvas_", "svgBubbleCanvas_", "onMouseWheel", "ToolboxClass", "CursorClass", "parentSvg", "newTrashcan", "svgTrashcan", "_workspace", "svgZoomControls", "HorizontalFlyout", "VerticalFlyout", "opt_own", "updateScreenCalculations", "positionables", "getUiMetrics", "positionable", "currScroll", "maybeFireViewportChangeEvent", "flatMap", "highlightBlock", "opt_state", "refreshSelection", "dragTargets", "targetArea", "getClientRect", "clientRect", "getDragTarget", "moveDrag", "canWheelZoom", "canWheelMove", "scrollDelta", "commandKey", "PIXELS_PER_ZOOM_STEP", "topElements", "boundary", "topElement", "blockBoundary", "movableBlocks", "immovableBlockBounds", "immovableBlocks", "getNextIntersectingImmovableBlock", "immovableRect", "cursorY", "minBlockHeight", "conflictingRect", "scaleChange", "getCTM", "center", "f", "setScale", "svgWidth", "svgHeight", "zoomToFit", "workspaceWidth", "workspaceHeight", "blocksBox", "doubleMargin", "blocksWidth", "blocksHeight", "ratioX", "ratioY", "centerOnBlock", "blockOnly", "pixelX", "pixelY", "reflow", "resizeView", "resizeContent", "getScale", "maxYScroll", "maxYDisplacement", "maxXDisplacement", "addTopBoundedElement", "removeTopBoundedElement", "reenabled", "removeButtonCallback", "getToolboxCategoryCallback", "removeToolboxCategoryCallback", "isStart", "onlyClosePopups", "autoHideables", "autoHideable", "autoHide", "xyRatio", "Selected", "opt_oldElementId", "opt_newElementId", "oldElementId", "newElementId", "BlockPaster", "typeCounts", "blockState", "initialCoordinates", "bumpIntoBounds", "BlockDragStrategy", "connectionPreviewer", "connectionCandidate", "startChildConn", "startParentConn", "dragOffset", "startDraggingShadow", "previewerConstructor", "shouldDisconnect", "disconnectBlock", "oldCoordinate", "updateConnectionPreview", "draggingBlock", "currCandidate", "getConnectionCandidate", "currCandidateIsBetter", "localIsOutputOrPrevious", "neighbourIsConnectedToRealBlock", "previewReplacement", "previewConnection", "currCandiate", "currLocal", "currNeighbour", "localPos", "neighbourPos", "currDistance", "localConns", "getLocalConnections", "rad", "disposeStep", "Marker", "getCurNode", "setCurNode", "Cursor", "BasicCursor", "getNextNode_", "validNode_", "getPreviousNode_", "isValid", "siblingOrParent", "findSiblingOrParent", "getRightMostChild", "nextNode", "registrationName", "TabNavigateCursor", "BUMP_RANDOMNESS", "RenderedConnection", "dbOpposite", "trackedState", "TrackedState", "WILL_TRACK", "TRACKED", "bumpAwayFrom", "initiatedByThis", "superiorRootBlock", "inferiorRootBlock", "moveInferior", "staticConnection", "dynamicConnection", "dynamicRootBlock", "addSelect", "removeSelect", "updated", "moveToOffset", "blockTL", "tightenEfficiently", "maxLimit", "setTracking", "doTracking", "UNTRACKED", "updateDisabled", "selection", "selectedBlock", "warningTextDb", "mutator", "visuallyDisabled", "relativeCoords", "createIconPointerDownListener", "oldParent", "oldXY", "layerManger", "eventsEnabled", "currLoc", "curXY", "getBoundingRectangleWithDimensions", "blockBounds", "collapsedInputName", "collapsedFieldName", "tab", "tabCursor", "currentNode", "nextField", "open", "generateContextMenu", "customContextMenu", "updateConnectionLocations", "updateIconLocations", "updateFieldLocations", "adding", "selectionAncestor", "timeout", "collapsedParent", "COLLAPSED_WARNING_ID", "removed", "wasEnabled", "styleObj", "getStyle", "track", "all", "scheduleSnapAndBump", "sourceConnection", "tightenChildrenEfficiently", "nextHeightWidth", "tabHeight", "setDragStrategy", "toFlyoutInfo", "kind", "toRemove", "traverseJson", "INLINE", "DragTarget", "onDragEnter", "_dragElement", "onDragOver", "onDragExit", "onDrop", "shouldPreventMove", "DeleteArea", "wouldDelete_", "couldDeleteBlock", "updateWouldDelete_", "TrashcanOpen", "opt_isOpen", "Trashcan", "isLidOpen", "minOpenness", "lidTask", "svgLid", "lidOpen", "flyoutWorkspaceOptions", "onDelete", "BODY_HEIGHT", "LID_HEIGHT", "SPRITE_LEFT", "SPRITE_TOP", "blockMouseDownWhenOpenable", "click", "mouseOver", "mouseOut", "animateLid", "setLidOpen", "hasContents", "contentsIsOpen", "openFlyout", "string", "blocklyStyle", "fireUiEvent", "closeFlyout", "emptyContents", "setMinOpenness", "trashRect", "MARGIN_HOTSPOT", "frames", "ANIMATION_FRAMES", "setLidAngle", "MAX_LID_ANGLE", "OPACITY_MIN", "OPACITY_MAX", "ANIMATION_LENGTH", "lidAngle", "openAtRight", "newMin", "closeLid", "trashcanOpen", "cleanedJson", "cleanBlockJson", "unshift", "HAS_BLOCKS_LID_ANGLE", "cleanRec", "blockInfo", "shortcuts", "keyMap", "shortcut", "allowOverrides", "registeredShortcut", "keyCode", "addKeyMapping", "allowCollision", "shortcutName", "removeAllKeyMappings", "shortcutNames", "removeKeyMapping", "quiet", "shortcutIdx", "setKeyMap", "newKeyMap", "getKeyMap", "legacyKeyMap", "getRegistry", "legacyRegistry", "serializeKeyEvent", "getShortcutNamesByKeyCode", "getKeyCodesByShortcutName", "serializedKey", "modifier", "modifierKeys", "getModifierState", "checkModifiers", "modifiers", "modifierKeyCode", "Shift", "Control", "Alt", "Meta", "ProcedureSerializer", "procState", "VariableSerializer", "variableStates", "varState", "priorities", "workspaceComments", "addHorizontal", "addVertical", "corner_", "vScroll", "hScroll", "isPair", "resizeH", "resizeV", "setX", "setY", "MetricsManager", "workspace_", "getDimensionsPx_", "getFlyoutMetrics", "flyoutDimensions", "getToolboxMetrics", "toolboxDimensions", "getSvgMetrics", "getAbsoluteMetrics", "flyoutMetrics", "respectToolbox", "respectFlyout", "atTop", "opt_getWorkspaceCoordinates", "svgMetrics", "vertToolbox", "getContentMetrics", "blockBox", "getComputedFixedEdges_", "opt_viewMetrics", "hScrollEnabled", "vScrollEnabled", "edges", "getPaddedContent_", "contentMetrics", "contentBottom", "contentRight", "halfWidth", "opt_contentMetrics", "fixedEdges", "paddedContent", "scrollMetrics", "contentHeight", "contentTop", "contentLeft", "toolboxWidth", "toolboxHeight", "flyoutHeight", "BaseConstantProvider", "GRID_UNIT", "CURSOR_RADIUS", "HEXAGONAL", "ROUND", "SQUARE", "SHAPE_IN_SHAPE_PADDING", "SELECTED_GLOW_COLOUR", "SELECTED_GLOW_SIZE", "REPLACEMENT_GLOW_COLOUR", "REPLACEMENT_GLOW_SIZE", "selectedGlowFilterId", "selectedGlowFilter", "replacementGlowFilterId", "SQUARED", "ROUNDED", "replacementGlowFilter", "STATEMENT_INPUT_SPACER_MIN_WIDTH", "MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH", "makeHexagonal", "makeRounded", "makeSquared", "rightWidth", "selectedGlowSize", "replacementGlowSize", "pathRightDown", "pathRightUp", "blockHeight", "remainingHeight", "maxHeight", "sweep", "_height", "curveWidth", "quarterHeight", "innerTopRightCorner", "innerBottomRightCorner", "pathTopRight", "pathBottomRight", "selectedComponentTransfer", "replacementComponentTransfer", "BaseDrawer", "beginDrawing", "outputShapeType", "endDrawing", "hasStatementInput", "drawFlatTop_", "drawRightDynamicConnection_", "drawFlatBottom_", "drawLeftDynamicConnection_", "insideCorners", "cornerHeight", "bottomRightPath", "verticalPath", "getInlineInputPath", "setOutlinePath", "connectedBottomNextConnection", "FieldImage", "altText", "Y_PADDING", "setAlt", "setOnClickHandler", "FieldInput", "spellcheck_", "htmlInput_", "isTextValid_", "isBeingEdited_", "onKeyInputWrapper", "onKeyDownWrapper", "valueWhenEditorWasOpened_", "fullBlockClickTarget_", "spellcheck", "resizeEditor_", "htmlInput", "INVALID", "setSpellcheck", "quietInput", "showPromptEditor", "showInlineEditor", "getValueFromEditorText_", "onFinishEditing_", "widgetDispose_", "widgetCreate_", "borderRadius", "BORDERRADIUS", "strokeColour", "border", "boxShadow", "getEditorText_", "bindInputEvents_", "unbindInputEvents_", "_value", "onHtmlInputKeyDown_", "onHtmlInputChange", "setEditorValue_", "bumped", "FieldTextInput", "BaseBottomRow", "BaseStatementInput", "RightConnectionShape", "BaseTopRow", "BaseRenderInfo", "isMultiRow", "rightSide", "rightAlignedDummyInputs", "adjustXPosition_", "alignmentDivider", "notchTotalWidth", "minXPos", "prevSpacer", "nextSpacer", "hasPrevNotch", "hasNextNotch", "prevInRowSpacer", "finalizeOutputConnection_", "outputConnectionShape", "rightConnectionWidth", "finalizeHorizontalAlignment_", "totalNegativeSpacing", "lastElem", "leftNegPadding", "getNegativeSpacing_", "firstElem", "rightNegPadding", "minBlockWidth", "outerShape", "innerShape", "finalizeVerticalAlignment_", "firstRow", "hasSingleTextOrImageField", "hasNonShadowConnectedBlocks", "minVerticalTightNestingHeight", "BaseMarkerSvg", "markerCircle", "showWithInputOutput", "positionCircle", "BasePathObject", "svgPathSelected", "outlines", "remainingOutlines", "outline", "getOutlinePath", "removeOutlinePath", "BaseRenderer", "InsertionMarkerPreviewer", "draggedBlock", "staticConn", "draggedConn", "replacedBlock", "shouldUseMarkerPreview", "previewMarker", "_draggedConn", "ZelosRenderer", "dragged", "createInsertionMarker", "origBlock", "orig", "origConn", "origConns", "markerConns", "CodeGenerator", "forBlock", "FUNCTION_NAME_PLACEHOLDER_", "STATEMENT_SUFFIX", "STATEMENT_PREFIX", "INFINITE_LOOP_TRAP", "INDENT", "COMMENT_WRAP", "ORDER_OVERRIDES", "isInitialized", "RESERVED_WORDS_", "definitions_", "functionNames_", "nameDB_", "name_", "FUNCTION_NAME_PLACEHOLDER_REGEXP_", "RegExp", "workspaceToCode", "code", "blockToCode", "scrubNakedValue", "injectId", "codeString", "finish", "prefixLines", "allNestedComments", "opt_thisOnly", "scrub_", "SyntaxError", "valueToCode", "outerOrder", "ReferenceError", "innerOrder", "parensNeeded", "outerOrderClass", "innerOrderClass", "statementToCode", "addLoopTrap", "branch", "addReservedWords", "provideFunction_", "desiredName", "functionName", "codeText", "oldCodeText", "getVariableName", "getProcedureName", "_opt_thisOnly", "FlyoutMetricsManager", "flyout_", "getBoundingBox", "blockBoundingBox", "FlyoutItemType", "WORKSPACE_AT_BLOCK_CAPACITY_DISABLED_REASON", "Flyout", "filterWrapper", "reflowWrapper", "mats", "buttons_", "permanentlyDisabled", "recycledBlocks", "SCROLLBAR_MARGIN", "height_", "width_", "dragAngleRange_", "setMetrics_", "toolboxPosition_", "tabWidth_", "rectMap_", "GAP_X", "GAP_Y", "wheel_", "filterForCapacity", "getFlyoutScale", "setAutoClose", "updateDisplay", "setContents", "positionAt_", "listen", "clearOldBlocks", "getDynamicCategoryContents", "parsedContent", "flyoutInfo", "createFlyoutInfo", "layout_", "gaps", "emptyRecycledBlocks", "defaultGap", "categoryName", "parsedDynamicContent", "dynamicContents", "dynamicGaps", "createFlyoutBlock", "addBlockGap", "addSeparatorGap", "createButton", "fnToApply", "btnInfo", "curButton", "getRecycledBlock", "blockType", "gap", "sepInfo", "newGap", "oldBlocks", "blockIsRecyclable_", "recycleBlock", "addBlockListeners_", "blockMouseDown", "originalBlock", "placeNewBlock", "initFlyoutButton_", "buttonSvg", "createRect_", "blockHW", "moveRectToBlock_", "reflowInternal_", "oldBlock", "svgRootOld", "serializeBlock", "positionNewBlock", "flyoutOffsetPixels", "oldBlockPos", "oldBlockOffsetPixels", "getX", "getY", "targetWorkspaceViewMetrics", "setBackgroundPath", "atRight", "cursorX", "allBlocks", "moveX", "dragDirection", "atan2", "range", "flyoutRect", "BIG_NUM", "oldX", "newX", "registryName", "buttons", "FieldVariable", "defaultType", "defaultVariableName", "setTypes", "variableType", "typeIsAllowed", "typeList", "isInArray", "FieldNumber", "precision", "min_", "max_", "precision_", "decimalPlaces", "setConstraints", "setMinInternal", "setMaxInternal", "setPrecisionInternal", "setMin", "getMin", "setMax", "getMax", "setPrecision", "precisionString", "toLocaleString", "maximumFractionDigits", "decimalIndex", "getPrecision", "isFinite", "toFixed", "VALUEMIN", "VALUEMAX", "FieldLabelSerializable", "FieldCheckbox", "checkChar", "CHECK_CHAR", "checkCharacter", "getValueBoolean", "setCheckCharacter", "character", "convertValueToBool", "Dragger", "totalDelta", "moveDraggable", "getRoot", "wouldDeleteDraggable", "updateDragTarget", "newDragTarget", "pixelsToWorkspaceUnits", "rootDraggable", "origGroup", "shouldReturnToStart", "BlockDrag", "opt_isStart", "opt_blocks", "BlockFieldIntermediateChange", "BlockMove", "oldParentId", "parentId", "oldInputName", "blockConnection", "BubbleOpen", "opt_bubbleType", "BubbleType", "CommentBase", "opt_comment", "CommentCreateDeleteHelper", "CommentChange", "opt_oldContents", "opt_newContents", "oldContents_", "newContents_", "CommentCollapse", "CommentCreate", "CommentDelete", "CommentDrag", "CommentMove", "comment_", "newCoordinate_", "setOldCoordinate", "CommentResize", "ToolboxItemSelect", "opt_oldItem", "opt_newItem", "oldItem", "newItem", "FinishedLoading", "opt_workspace", "CHANGE", "CREATE", "MOVE", "DARK_PATH_OFFSET", "MAX_BOTTOM_WIDTH", "Highlighter", "inlineSteps_", "steps_", "RTL_", "highlightConstants_", "getHighlightConstants", "highlightOffset", "OFFSET", "outsideCornerPaths_", "OUTSIDE_CORNER", "insideCornerPaths_", "INSIDE_CORNER", "puzzleTabPaths_", "notchPaths_", "startPaths_", "jaggedTeethPaths_", "getPath", "drawTopCorner", "drawValueInput", "belowTabHeight", "drawStatementInput", "drawRightSideRow", "rightEdge", "drawBottomRow", "cornerElem", "drawLeft", "drawInlineInput", "connectionRight", "bottomHighlightWidth", "aboveTabHeight", "highlighter_", "setHighlightPath", "HighlightConstantProvider", "constantProvider", "makeInsideCorner", "makeOutsideCorner", "distance45outside", "SQRT1_2", "pathTopRtl", "pathBottomRtl", "pathBottomLtr", "distance45inside", "topLeftCornerHighlightRtl", "topLeftCornerHighlightLtr", "bottomLeftStartY", "bottomLeftPath", "highlightRtlUp", "highlightRtlDown", "verticalOverlap", "highlightLtrUp", "highlightLtrDown", "hatHeight", "pathRtl", "pathLtr", "BaseInlineInput", "hasExternalInputs", "nextRightEdge", "rowNextRightEdges", "prevRightEdge", "heightWithoutHat", "diff", "colourDark", "svgPathDark", "svgPathLight", "highlightPath", "highlightConstants", "makeHighlightConstants_", "Zelos", "ToolboxItem", "toolboxItemDef", "parentToolbox", "id_", "level_", "parent_", "getLevel", "toolboxItemDef_", "parentToolbox_", "getClickTarget", "isCollapsible", "setVisible_", "_isVisible", "ToolboxCategory", "categoryDef", "labelDom_", "iconDom_", "rowContents_", "rowDiv_", "htmlDiv_", "isDisabled_", "isHidden_", "flyoutItems_", "cssConfig_", "makeDefaultCssConfig_", "parseCategoryDef_", "parseContents_", "createDom_", "flyoutItem", "itemDef", "getColour_", "createContainer_", "LEVEL", "createRowContainer_", "pointerEvents", "createRowContentsContainer_", "createIconDom_", "createLabelDom_", "LABELLEDBY", "addColourBorder_", "rowDiv", "nestedPadding", "paddingRight", "paddingLeft", "contentsContainer", "toolboxIcon", "isHorizontal", "toolboxLabel", "borderWidth", "borderRight", "borderLeft", "styleName", "getColourfromStyle", "parseColour", "colourValue", "openIcon_", "iconDiv", "closedIconClass", "closeIcon_", "openIconClass", "getSelectedItem", "clearSelection", "allAncestorsExpanded_", "category", "isExpanded", "defaultBackgroundColour", "setDisabled", "isDisabled", "updateFlyoutContents", "newDefinition", "custom", "categorystyle", "cssconfig", "hidden", "ToolboxSeparator", "separatorDef", "htmlDiv", "CollapsibleToolboxCategory", "subcategoriesDiv_", "expanded_", "toolboxItems_", "cssConfig", "prevIsFlyoutItem", "createToolboxItem", "ToolboxItemClass", "setExpanded", "subCategories", "getChildToolboxItems", "createSubCategoriesDom_", "EXPANDED", "subcategories", "newCategory", "newCategoryDiv", "handleToolboxItemResize", "childToolboxItems", "toggleExpanded", "Toolbox", "contentsDiv_", "HtmlDiv", "isVisible_", "contents_", "previouslySelectedItem_", "selectedItem_", "boundEvents_", "toolboxDef_", "contentMap_", "createFlyout_", "themeManager", "createContentsContainer_", "attachEvents_", "toolboxContainer", "flexDirection", "clickEvent", "onClick_", "keyDownEvent", "onKeyDown_", "itemId", "getToolboxItemById", "setSelectedItem", "handled", "selectNext", "selectPrevious", "selectParent", "selectChild", "renderContents_", "createDocumentFragment", "addToolboxItem_", "toolboxItemDom", "getToolboxItems", "addStyle", "removeStyle", "toolboxRect", "updateCursorDeleteStyle_", "getPreviouslySelectedItem", "workspaceMetrics", "toolboxDiv", "childAsCategory", "shouldDeselectItem_", "deselectItem_", "shouldSelectItem_", "selectItem_", "updateFlyout_", "fireSelectEvent", "selectItemByPosition", "oldElement", "collapsibleItem", "nextItemIdx", "prevItemIdx", "prevItem", "VERSION", "TOOLBOX_AT_TOP", "TOOLBOX_AT_BOTTOM", "TOOLBOX_AT_LEFT", "TOOLBOX_AT_RIGHT", "VARIABLE_CATEGORY_NAME", "VARIABLE_DYNAMIC_CATEGORY_NAME", "PROCEDURE_CATEGORY_NAME", "Workspace.prototype.newBlock", "WorkspaceSvg.prototype.newBlock", "Workspace.prototype.newComment", "WorkspaceSvg.prototype.newComment", "WorkspaceSvg.newTrashcan", "MiniWorkspaceBubble.prototype.newWorkspaceSvg", "Names.prototype.populateProcedures", "flattenedProcedures", "DropDownDiv", "dropDownDiv", "ContextMenu", "ContextMenuItems", "Css", "Events", "Extensions", "ShortcutItems", "Themes", "Tooltip", "Touch", "WidgetDiv", "Xml", "blockAnimations", "blockRendering", "bubbles", "bumpObjects", "clipboard", "common", "dialog", "fieldRegistry", "geras", "renderManagement", "serialization", "thrasos", "uiPosition", "utils", "zelos"]
}
